<a href="Monitor.hs178448449274243042.out.html">prev</a></br><a href="failures.html">home</a></br><a href="PadKontrol.hs2035308228158374933.out.html">next</a></br></br><pre>10d9
< haskadesBindinghsc escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [
11d9
<         {-# LINE 1 "HaskadesBinding.hsc.mustache" #-}
12d9
<         build "{",
13d9
<         {-# LINE 1 "HaskadesBinding.hsc.mustache" #-}
14d9
<         build "-# LANGUAGE ForeignFunctionInterface #-}\n",
15d9
<         {-# LINE 2 "HaskadesBinding.hsc.mustache" #-}
16d9
<         build "{",
17d9
<         {-# LINE 2 "HaskadesBinding.hsc.mustache" #-}
18d9
<         build "-# OPTIONS_GHC -fno-warn-unused-imports #-}\nmodule HaskadesBinding (\n#ifdef USE_SENSORS\n\tAccelerationMode,\n\tAxesOrientationMode,\n\taccelerometerStart,\n#endif\n\thaskadesRun,\n\temit\n) where\n\n#include \"",
19d9
<         {-# LINE 13 "HaskadesBinding.hsc.mustache" #-}
20d9
<         build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build headerPath,
21d9
<         {-# LINE 13 "HaskadesBinding.hsc.mustache" #-}
22d9
<         build "\"\n\nimport Control.Applicative (pure, (<*>))\nimport Control.Monad (when, ap, join, forever)\nimport Control.Monad.IO.Class (MonadIO, liftIO)\nimport Control.Concurrent (forkIO)\nimport System.Exit (exitWith, ExitCode(ExitFailure))\n\nimport Foreign.Storable\nimport Foreign.C.Types\nimport Foreign.C.String\nimport Foreign.Ptr\n\nimport Data.Time.Clock (UTCTime)\nimport Data.Time.Clock.POSIX (posixSecondsToUTCTime, utcTimeToPOSIXSeconds)\nimport qualified Data.Text as Text\nimport qualified Data.Text.Encoding as Text\nimport qualified Data.Text.Lazy as LText\nimport qualified Data.Text.Lazy.Encoding as LText\nimport qualified Data.ByteString as ByteString\n\nimport ",
23d9
<         {-# LINE 34 "HaskadesBinding.hsc.mustache" #-}
24d9
<         build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build modul,
25d9
<         {-# LINE 34 "HaskadesBinding.hsc.mustache" #-}
26d9
<         build "\n\nforeign import ccall safe \"haskades_run.cpp haskades_run\"\n\tc_haskades_run ::\n\tCString ->\n\t-- ^ QML file to load and render\n\tIO CInt\n\nforeign import ccall unsafe \"haskades_run.cpp emit_ToUIEvent\"\n\tc_emit_ToUIEvent ::\n\tCInt -> ",
27c10
<         {-# LINE 44 "HaskadesBinding.hsc.mustache" #-}
---
> haskadesBindinghsc escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [ "{", "-# LANGUAGE ForeignFunctionInterface #-}\n",
27a11
>         build "{", "-# OPTIONS_GHC -fno-warn-unused-imports #-}\nmodule HaskadesBinding (\n#ifdef USE_SENSORS\n\tAccelerationMode,\n\tAxesOrientationMode,\n\taccelerometerStart,\n#endif\n\thaskadesRun,\n\temit\n) where\n\n#include \"",
27a12
> 
27a13
> 
27a14
> 
27a15
> 
27a16
> 
27a17
> 
27a18
> 
27a19
> 
27a20
> 
27a21
> 
27a22
>         build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build headerPath, "\"\n\nimport Control.Applicative (pure, (<*>))\nimport Control.Monad (when, ap, join, forever)\nimport Control.Monad.IO.Class (MonadIO, liftIO)\nimport Control.Concurrent (forkIO)\nimport System.Exit (exitWith, ExitCode(ExitFailure))\n\nimport Foreign.Storable\nimport Foreign.C.Types\nimport Foreign.C.String\nimport Foreign.Ptr\n\nimport Data.Time.Clock (UTCTime)\nimport Data.Time.Clock.POSIX (posixSecondsToUTCTime, utcTimeToPOSIXSeconds)\nimport qualified Data.Text as Text\nimport qualified Data.Text.Encoding as Text\nimport qualified Data.Text.Lazy as LText\nimport qualified Data.Text.Lazy.Encoding as LText\nimport qualified Data.ByteString as ByteString\n\nimport ",
27a23
> 
27a24
> 
27a25
> 
27a26
> 
27a27
> 
27a28
> 
27a29
> 
27a30
> 
27a31
> 
27a32
> 
27a33
> 
27a34
> 
27a35
> 
27a36
> 
27a37
> 
27a38
> 
27a39
> 
27a40
> 
27a41
> 
27a42
> 
27a43
>         build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build modul, "\n\nforeign import ccall safe \"haskades_run.cpp haskades_run\"\n\tc_haskades_run ::\n\tCString ->\n\t-- ^ QML file to load and render\n\tIO CInt\n\nforeign import ccall unsafe \"haskades_run.cpp emit_ToUIEvent\"\n\tc_emit_ToUIEvent ::\n\tCInt -> ",
27a44
> 
27a45
> 
27a46
> 
27a47
> 
27a48
> 
27a49
> 
27a50
> 
27a51
> 
27a52
> 
29d53
<         {-# LINE 45 "HaskadesBinding.hsc.mustache" #-}
31c55
<         {-# LINE 52 "HaskadesBinding.hsc.mustache" #-}
---
> 
31a56
> 
31a57
> 
31a58
> 
31a59
> 
31a60
> 
33c62
<         {-# LINE 58 "HaskadesBinding.hsc.mustache" #-}
---
> 
33a63
> 
33a64
> 
33a65
> 
33a66
> 
35d67
<         {-# LINE 64 "HaskadesBinding.hsc.mustache" #-}
36d67
<         build "{",
37d67
<         {-# LINE 64 "HaskadesBinding.hsc.mustache" #-}
38d67
<         build "peek struct SignalFromUI, tag} ptr\n\tcase (tag :: CInt) of\n",
39c68
<         {-# LINE 66 "HaskadesBinding.hsc.mustache" #-}
---
> 
39a69
> 
39a70
> 
39a71
> 
39a72
> 
39a73
>         build "{", "peek struct SignalFromUI, tag} ptr\n\tcase (tag :: CInt) of\n",
39a74
> 
41c76
<         {-# LINE 71 "HaskadesBinding.hsc.mustache" #-}
---
> 
41a77
> 
41a78
> 
41a79
> 
45d82
<     toUItypes0 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [
46d82
<             {-# LINE 44 "HaskadesBinding.hsc.mustache" #-}
47d82
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build csigtype,
48d82
<             {-# LINE 44 "HaskadesBinding.hsc.mustache" #-}
49c83
<             build " -> "
---
>     toUItypes0 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [ $ escapeFunction $ TL.unpack $ TL.toLazyText $ build csigtype, " -> "
52d85
<             {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
53d85
<             build "emit (",
54d85
<             {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
55d85
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
56d85
<             {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
57d85
<             build " ",
58d85
<             {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
59d85
<             mconcat $ map (sigargs2 escapeFunction) sigargs,
60d85
<             {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
61d85
<             build ") = liftIO (\n\t\t",
62c86
<             {-# LINE 54 "HaskadesBinding.hsc.mustache" #-}
---
> 
62a87
> 
62a88
> 
62a89
> 
62a90
> 
62a91
> 
62a92
>             build "emit (", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, " ", $ map (sigargs2 escapeFunction) sigargs, ") = liftIO (\n\t\t",
64d93
<             {-# LINE 55 "HaskadesBinding.hsc.mustache" #-}
65d93
<             build "\t\t(c_emit_ToUIEvent ",
66d93
<             {-# LINE 55 "HaskadesBinding.hsc.mustache" #-}
67d93
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent,
68d93
<             {-# LINE 55 "HaskadesBinding.hsc.mustache" #-}
69c94
<             build ")\n\t)\n"
---
>             build "\t\t(c_emit_ToUIEvent ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent, ")\n\t)\n"
72d96
<         sigargs2 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
73d96
<                 {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
74d96
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame,
75d96
<                 {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
76c97
<                 build " "
---
>         sigargs2 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame, " "
78d98
<         sigcwrap3 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
79d98
<                 {-# LINE 54 "HaskadesBinding.hsc.mustache" #-}
80d98
<                 build "(",
81d98
<                 {-# LINE 54 "HaskadesBinding.hsc.mustache" #-}
82d98
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigcwrap,
83d98
<                 {-# LINE 54 "HaskadesBinding.hsc.mustache" #-}
84c99
<                 build ")"
---
>         sigcwrap3 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [ "(", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigcwrap,
87d101
<             {-# LINE 67 "HaskadesBinding.hsc.mustache" #-}
88d101
<             build "\t\t",
89d101
<             {-# LINE 67 "HaskadesBinding.hsc.mustache" #-}
90d101
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent,
91d101
<             {-# LINE 67 "HaskadesBinding.hsc.mustache" #-}
92d101
<             build " ->\n\t\t\tpure ",
93d101
<             {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
94d101
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
95d101
<             {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
96d101
<             mconcat $ map (sigargs5 escapeFunction) sigargs,
97c102
<             {-# LINE 69 "HaskadesBinding.hsc.mustache" #-}
---
> 
97a103
> 
97a104
> 
97a105
> 
97a106
> 
97a107
> 
97a108
> 
97a109
> 
97a110
> 
97a111
> 
97a112
>             build "\t\t", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent, " ->\n\t\t\tpure ",
97a113
>             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, $ map (sigargs5 escapeFunction) sigargs,
101d116
<         sigargs5 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
102d116
<                 {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
103d116
<                 build " <*> ((",
104d116
<                 {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
105d116
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargfromc,
106d116
<                 {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
107d116
<                 build ") (#",
108d116
<                 {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
109d116
<                 build "{",
110d116
<                 {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
111d116
<                 build "peek struct SignalFromUI, ",
112d116
<                 {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
113d116
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
114d116
<                 {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
115d116
<                 build ".",
116d116
<                 {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
117d116
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame,
118d116
<                 {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
119c117
<                 build "} ptr))"
---
>         sigargs5 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ " <*> ((", $ escapeFunction $ TL.unpack,$ TL.toLazyText $ build sigargfromc, ") (#", "{", "peek struct SignalFromUI, "  signame,  siganame,
122d119
< haskades_runcpp escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [
123d119
<         {-# LINE 1 "haskades_run.cpp.mustache" #-}
124d119
<         build "#include <QtDebug>\n#include <QLocale>\n#include <QTranslator>\n\n#include <QQueue>\n#include <QSemaphore>\n#include <QMutex>\n\n#include <bb/cascades/Application>\n#include <bb/cascades/QmlDocument>\n#include <bb/cascades/AbstractPane>\n\n#ifdef USE_SENSORS\n#include <QtSensors/QAccelerometer>\n#endif\n\n#ifdef USE_NOTIFICATIONS\n#include <bb/platform/Notification>\n#include <bb/platform/NotificationDialog>\n#endif\n\n#ifdef USE_INVOCATIONS\n#include <bb/system/InvokeManager>\n#endif\n\n#include \"",
125d119
<         {-# LINE 26 "haskades_run.cpp.mustache" #-}
126d119
<         build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build headerPath,
127d119
<         {-# LINE 26 "haskades_run.cpp.mustache" #-}
128d119
<         build "\"\n\nQEvent::Type toUIEventType;\n\ntemplate<class T> class ThreadSafeQueue ",
129d119
<         {-# LINE 30 "haskades_run.cpp.mustache" #-}
130d119
<         build "{",
131d119
<         {-# LINE 30 "haskades_run.cpp.mustache" #-}
132d119
<         build "\npublic:\n\tThreadSafeQueue() : semFree(32), semUsed(0), valid(true) ",
133d119
<         {-# LINE 32 "haskades_run.cpp.mustache" #-}
134d119
<         build "{",
135d119
<         {-# LINE 32 "haskades_run.cpp.mustache" #-}
136d119
<         build " }\n\n\tvoid enqueue(const T &value) ",
137d119
<         {-# LINE 34 "haskades_run.cpp.mustache" #-}
138d119
<         build "{",
139d119
<         {-# LINE 34 "haskades_run.cpp.mustache" #-}
140d119
<         build "\n\t\tif(!valid) return;\n\n\t\tsemFree.acquire(1);\n\t\tmutex.lock();\n\t\tqueue.enqueue(value);\n\t\tmutex.unlock();\n\t\tsemUsed.release(1);\n\t}\n\n\tT dequeue() ",
141d119
<         {-# LINE 44 "haskades_run.cpp.mustache" #-}
142d119
<         build "{",
143d119
<         {-# LINE 44 "haskades_run.cpp.mustache" #-}
144d119
<         build "\n\t\tif(!valid) return NULL;\n\n\t\tsemUsed.acquire(1);\n\t\tmutex.lock();\n\t\tT val = queue.dequeue();\n\t\tmutex.unlock();\n\t\tsemFree.release(1);\n\t\treturn val;\n\t}\n\n\tvoid stop() ",
145d119
<         {-# LINE 55 "haskades_run.cpp.mustache" #-}
146d119
<         build "{",
147d119
<         {-# LINE 55 "haskades_run.cpp.mustache" #-}
148d119
<         build "\n\t\t// Stop new calls\n\t\tvalid = false;\n\n\t\t// Make sure there is something to dequeue\n\t\tmutex.lock();\n\t\tqueue.enqueue(NULL);\n\t\tmutex.unlock();\n\n\t\t// Allow waiting dequeue\n\t\tsemUsed.release(32);\n\n\t\t// Allow waiting enqueue\n\t\tsemFree.release(32);\n\t}\n\nprotected:\n\tbool valid;\n\tQQueue<T> queue;\n\tQSemaphore semFree;\n\tQSemaphore semUsed;\n\tQMutex mutex;\n};\n\nThreadSafeQueue<SignalFromUI*> signalFromUIQ;\n\nclass ToUIEvent : public QEvent ",
149d119
<         {-# LINE 81 "haskades_run.cpp.mustache" #-}
150d119
<         build "{",
151d119
<         {-# LINE 81 "haskades_run.cpp.mustache" #-}
152d119
<         build "\n\npublic:\n\tToUIEvent(int signalEvent",
153d119
<         {-# LINE 84 "haskades_run.cpp.mustache" #-}
154d119
<         mconcat $ map (toUItypes0 escapeFunction) toUItypes,
155d119
<         {-# LINE 84 "haskades_run.cpp.mustache" #-}
156d119
<         build ") : QEvent(toUIEventType) ",
157d119
<         {-# LINE 84 "haskades_run.cpp.mustache" #-}
158d119
<         build "{",
159d119
<         {-# LINE 84 "haskades_run.cpp.mustache" #-}
160d119
<         build "\n\t\tthis->signalEvent = signalEvent;\n",
161c120
<         {-# LINE 86 "haskades_run.cpp.mustache" #-}
---
> haskades_runcpp escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [ "#include <QtDebug>\n#include <QLocale>\n#include <QTranslator>\n\n#include <QQueue>\n#include <QSemaphore>\n#include <QMutex>\n\n#include <bb/cascades/Application>\n#include <bb/cascades/QmlDocument>\n#include <bb/cascades/AbstractPane>\n\n#ifdef USE_SENSORS\n#include <QtSensors/QAccelerometer>\n#endif\n\n#ifdef USE_NOTIFICATIONS\n#include <bb/platform/Notification>\n#include <bb/platform/NotificationDialog>\n#endif\n\n#ifdef USE_INVOCATIONS\n#include <bb/system/InvokeManager>\n#endif\n\n#include \"",
161a121
> 
161a122
> 
161a123
> 
161a124
> 
161a125
> 
161a126
> 
161a127
> 
161a128
> 
161a129
> 
161a130
> 
161a131
> 
161a132
> 
161a133
> 
161a134
> 
161a135
> 
161a136
> 
161a137
> 
161a138
> 
161a139
> 
161a140
> 
161a141
> 
161a142
> 
161a143
> 
161a144
> 
161a145
>         build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build headerPath, "\"\n\nQEvent::Type toUIEventType;\n\ntemplate<class T> class ThreadSafeQueue ",
161a146
> 
161a147
> 
161a148
> 
161a149
>         build "{", "\npublic:\n\tThreadSafeQueue() : semFree(32), semUsed(0), valid(true) ",
161a150
> 
161a151
>         build "{", " }\n\n\tvoid enqueue(const T &value) ",
161a152
> 
161a153
>         build "{", "\n\t\tif(!valid) return;\n\n\t\tsemFree.acquire(1);\n\t\tmutex.lock();\n\t\tqueue.enqueue(value);\n\t\tmutex.unlock();\n\t\tsemUsed.release(1);\n\t}\n\n\tT dequeue() ",
161a154
> 
161a155
> 
161a156
> 
161a157
> 
161a158
> 
161a159
> 
161a160
> 
161a161
> 
161a162
> 
161a163
>         build "{", "\n\t\tif(!valid) return NULL;\n\n\t\tsemUsed.acquire(1);\n\t\tmutex.lock();\n\t\tT val = queue.dequeue();\n\t\tmutex.unlock();\n\t\tsemFree.release(1);\n\t\treturn val;\n\t}\n\n\tvoid stop() ",
161a164
> 
161a165
> 
161a166
> 
161a167
> 
161a168
> 
161a169
> 
161a170
> 
161a171
> 
161a172
> 
161a173
> 
161a174
>         build "{", "\n\t\t// Stop new calls\n\t\tvalid = false;\n\n\t\t// Make sure there is something to dequeue\n\t\tmutex.lock();\n\t\tqueue.enqueue(NULL);\n\t\tmutex.unlock();\n\n\t\t// Allow waiting dequeue\n\t\tsemUsed.release(32);\n\n\t\t// Allow waiting enqueue\n\t\tsemFree.release(32);\n\t}\n\nprotected:\n\tbool valid;\n\tQQueue<T> queue;\n\tQSemaphore semFree;\n\tQSemaphore semUsed;\n\tQMutex mutex;\n};\n\nThreadSafeQueue<SignalFromUI*> signalFromUIQ;\n\nclass ToUIEvent : public QEvent ",
161a175
> 
161a176
> 
161a177
> 
161a178
> 
161a179
> 
161a180
> 
161a181
> 
161a182
> 
161a183
> 
161a184
> 
161a185
> 
161a186
> 
161a187
> 
161a188
> 
161a189
> 
161a190
> 
161a191
> 
161a192
> 
161a193
> 
161a194
> 
161a195
> 
161a196
> 
161a197
> 
161a198
> 
161a199
> 
161a200
>         build "{", "\n\npublic:\n\tToUIEvent(int signalEvent",
161a201
> 
161a202
> 
161a203
>         mconcat $ map (toUItypes0 escapeFunction) toUItypes, ") : QEvent(toUIEventType) ", "{", "\n\t\tthis->signalEvent = signalEvent;\n",
161a204
> 
163c206
<         {-# LINE 89 "haskades_run.cpp.mustache" #-}
---
> 
163a207
> 
165c209
<         {-# LINE 92 "haskades_run.cpp.mustache" #-}
---
> 
165a210
> 
167c212
<         {-# LINE 95 "haskades_run.cpp.mustache" #-}
---
> 
167a213
> 
169d214
<         {-# LINE 97 "haskades_run.cpp.mustache" #-}
170d214
<         build "{",
171d214
<         {-# LINE 97 "haskades_run.cpp.mustache" #-}
172d214
<         build "\nQ_OBJECT\n\npublic:\n\t// This is our constructor that sets up the recipe.\n\tAppWrapper(QString qml_path) : qmlPath(qml_path) ",
173d214
<         {-# LINE 102 "haskades_run.cpp.mustache" #-}
174d214
<         build "{",
175d214
<         {-# LINE 102 "haskades_run.cpp.mustache" #-}
176d214
<         build "\n#ifdef USE_INVOCATIONS\n\t\tconnect(&this->invokeManager, SIGNAL(invoked(const bb::system::InvokeRequest&)), this, SLOT(wasInvoked(const bb::system::InvokeRequest&)));\n#endif\n#ifdef USE_NOTIFICATIONS\n\t\tqmlRegisterType<bb::platform::Notification>(\"bb.platform\", 1, 0, \"Notification\");\n\t\tqmlRegisterType<bb::platform::NotificationDialog>(\"bb.platform\", 1, 0, \"NotificationDialog\");\n#endif\n\t}\n\n\tvirtual void ready() ",
177d214
<         {-# LINE 112 "haskades_run.cpp.mustache" #-}
178d214
<         build "{",
179d214
<         {-# LINE 112 "haskades_run.cpp.mustache" #-}
180d214
<         build "\n\t\t// Obtain a QMLDocument and load it into the qml variable, using build patterns.\n\t\tbb::cascades::QmlDocument *qml = bb::cascades::QmlDocument::create(this->qmlPath);\n\n\t\t// If the QML document is valid, we process it.\n\t\tif(!qml->hasErrors()) ",
181d214
<         {-# LINE 117 "haskades_run.cpp.mustache" #-}
182d214
<         build "{",
183d214
<         {-# LINE 117 "haskades_run.cpp.mustache" #-}
184d214
<         build "\n\t\t\tqml->setContextProperty(\"app\", this);\n\n\t\t\t// Create the application root from QMLDocument\n\t\t\tbb::cascades::AbstractPane *appPage = qml->createRootObject<bb::cascades::AbstractPane>();\n\n\t\t\tif (appPage) ",
185d214
<         {-# LINE 123 "haskades_run.cpp.mustache" #-}
186d214
<         build "{",
187d214
<         {-# LINE 123 "haskades_run.cpp.mustache" #-}
188d214
<         build "\n\t\t\t\t// Set the main scene for the application to the Page.\n\t\t\t\tbb::cascades::Application::instance()->setScene(appPage);\n\t\t\t}\n\t\t} else ",
189d214
<         {-# LINE 127 "haskades_run.cpp.mustache" #-}
190d214
<         build "{",
191d214
<         {-# LINE 127 "haskades_run.cpp.mustache" #-}
192d214
<         build "\n\t\t\tqCritical() << qml->errors();\n\t\t}\n\t}\n\n\tvirtual bool event(QEvent *e) ",
193d214
<         {-# LINE 132 "haskades_run.cpp.mustache" #-}
194d214
<         build "{",
195d214
<         {-# LINE 132 "haskades_run.cpp.mustache" #-}
196d214
<         build "\n\t\tif(e->type() == toUIEventType) ",
197d214
<         {-# LINE 133 "haskades_run.cpp.mustache" #-}
198d214
<         build "{",
199d214
<         {-# LINE 133 "haskades_run.cpp.mustache" #-}
200d214
<         build "\n\t\t\tToUIEvent *ev = (ToUIEvent*)e;\n\t\t\tswitch(ev->signalEvent) ",
201d214
<         {-# LINE 135 "haskades_run.cpp.mustache" #-}
202d214
<         build "{",
203d214
<         {-# LINE 135 "haskades_run.cpp.mustache" #-}
204d214
<         build "\n",
205c215
<         {-# LINE 136 "haskades_run.cpp.mustache" #-}
---
> 
205a216
>         build "{", "\nQ_OBJECT\n\npublic:\n\t// This is our constructor that sets up the recipe.\n\tAppWrapper(QString qml_path) : qmlPath(qml_path) ",
205a217
> 
205a218
> 
205a219
> 
205a220
> 
205a221
>         build "{", "\n#ifdef USE_INVOCATIONS\n\t\tconnect(&this->invokeManager, SIGNAL(invoked(const bb::system::InvokeRequest&)), this, SLOT(wasInvoked(const bb::system::InvokeRequest&)));\n#endif\n#ifdef USE_NOTIFICATIONS\n\t\tqmlRegisterType<bb::platform::Notification>(\"bb.platform\", 1, 0, \"Notification\");\n\t\tqmlRegisterType<bb::platform::NotificationDialog>(\"bb.platform\", 1, 0, \"NotificationDialog\");\n#endif\n\t}\n\n\tvirtual void ready() ",
205a222
> 
205a223
> 
205a224
> 
205a225
> 
205a226
> 
205a227
> 
205a228
> 
205a229
> 
205a230
> 
205a231
>         build "{", "\n\t\t// Obtain a QMLDocument and load it into the qml variable, using build patterns.\n\t\tbb::cascades::QmlDocument *qml = bb::cascades::QmlDocument::create(this->qmlPath);\n\n\t\t// If the QML document is valid, we process it.\n\t\tif(!qml->hasErrors()) ",
205a232
> 
205a233
> 
205a234
> 
205a235
> 
205a236
>         build "{", "\n\t\t\tqml->setContextProperty(\"app\", this);\n\n\t\t\t// Create the application root from QMLDocument\n\t\t\tbb::cascades::AbstractPane *appPage = qml->createRootObject<bb::cascades::AbstractPane>();\n\n\t\t\tif (appPage) ",
205a237
> 
205a238
> 
205a239
> 
205a240
> 
205a241
> 
205a242
>         build "{", "\n\t\t\t\t// Set the main scene for the application to the Page.\n\t\t\t\tbb::cascades::Application::instance()->setScene(appPage);\n\t\t\t}\n\t\t} else ",
205a243
> 
205a244
> 
205a245
> 
205a246
>         build "{", "\n\t\t\tqCritical() << qml->errors();\n\t\t}\n\t}\n\n\tvirtual bool event(QEvent *e) ",
205a247
> 
205a248
> 
205a249
> 
205a250
> 
205a251
>         build "{", "\n\t\tif(e->type() == toUIEventType) ",
205a252
>         build "{", "\n\t\t\tToUIEvent *ev = (ToUIEvent*)e;\n\t\t\tswitch(ev->signalEvent) ",
205a253
> 
205a254
>         build "{", "\n",
207c256
<         {-# LINE 142 "haskades_run.cpp.mustache" #-}
---
> 
207a257
> 
207a258
> 
207a259
> 
207a260
> 
209d261
<         {-# LINE 144 "haskades_run.cpp.mustache" #-}
210d261
<         build "{",
211d261
<         {-# LINE 144 "haskades_run.cpp.mustache" #-}
212d261
<         build "\n\t\t\treturn QObject::event(e);\n\t\t}\n\t}\n\n",
213c262
<         {-# LINE 149 "haskades_run.cpp.mustache" #-}
---
> 
213a263
>         build "{", "\n\t\t\treturn QObject::event(e);\n\t\t}\n\t}\n\n",
213a264
> 
213a265
> 
213a266
> 
213a267
> 
215c269
<         {-# LINE 159 "haskades_run.cpp.mustache" #-}
---
> 
215a270
> 
215a271
> 
215a272
> 
215a273
> 
215a274
> 
215a275
> 
215a276
> 
215a277
> 
217d278
<         {-# LINE 162 "haskades_run.cpp.mustache" #-}
218d278
<         build "{",
219d278
<         {-# LINE 162 "haskades_run.cpp.mustache" #-}
220d278
<         build "\n\t\tbb::system::InvokeRequest invokeRequest;\n\t\tinvokeRequest.setTarget(target);\n\t\tinvokeRequest.setAction(action);\n\t\tinvokeRequest.setMimeType(mimeType);\n\t\tinvokeRequest.setUri(uri);\n\t\tinvokeRequest.setData(data.toUtf8());\n\t\tnotification->setInvokeRequest(invokeRequest);\n\t}\n#endif\n#endif\n\nsignals:\n",
221c279
<         {-# LINE 175 "haskades_run.cpp.mustache" #-}
---
> 
221a280
> 
221a281
>         build "{", "\n\t\tbb::system::InvokeRequest invokeRequest;\n\t\tinvokeRequest.setTarget(target);\n\t\tinvokeRequest.setAction(action);\n\t\tinvokeRequest.setMimeType(mimeType);\n\t\tinvokeRequest.setUri(uri);\n\t\tinvokeRequest.setData(data.toUtf8());\n\t\tnotification->setInvokeRequest(invokeRequest);\n\t}\n#endif\n#endif\n\nsignals:\n",
221a282
> 
221a283
> 
221a284
> 
221a285
> 
221a286
> 
221a287
> 
221a288
> 
221a289
> 
221a290
> 
221a291
> 
221a292
> 
221a293
> 
223c295
<         {-# LINE 178 "haskades_run.cpp.mustache" #-}
---
> 
223a296
> 
225d297
<         {-# LINE 183 "haskades_run.cpp.mustache" #-}
226d297
<         build "{",
227d297
<         {-# LINE 183 "haskades_run.cpp.mustache" #-}
228d297
<         build "\n\t\temit invoked(req.target(), req.action(), req.mimeType(), req.uri().toString(), QString::fromUtf8(req.data()));\n\t}\n#endif\n\nprotected:\n\tQString qmlPath;\n#ifdef USE_INVOCATIONS\n\tbb::system::InvokeManager invokeManager;\n#endif\n};\n\n#ifdef USE_SENSORS\nclass AccelerometerHandler : public QObject ",
229d297
<         {-# LINE 196 "haskades_run.cpp.mustache" #-}
230d297
<         build "{",
231d297
<         {-# LINE 196 "haskades_run.cpp.mustache" #-}
232d297
<         build "\nQ_OBJECT\n\npublic:\n\tAccelerometerHandler(QtMobility::QAccelerometer::AccelerationMode accelM, QtMobility::QAccelerometer::AxesOrientationMode axesM, int (*cb)(double, double, double)) : _cb(cb) ",
233d297
<         {-# LINE 200 "haskades_run.cpp.mustache" #-}
234d297
<         build "{",
235d297
<         {-# LINE 200 "haskades_run.cpp.mustache" #-}
236d297
<         build "\n\t\t_accel.setAccelerationMode(accelM);\n\t\t_accel.setAxesOrientationMode(axesM);\n\n\t\tconnect(&_accel, SIGNAL(readingChanged()), SLOT(callback()));\n\n\t\tif(!_accel.connectToBackend()) ",
237d297
<         {-# LINE 206 "haskades_run.cpp.mustache" #-}
238d297
<         build "{",
239d297
<         {-# LINE 206 "haskades_run.cpp.mustache" #-}
240d297
<         build "\n\t\t\tqCritical() << \"CONNECT TO ACCELEROMETER BACKEND FAILED!\";\n\t\t} else if(!_accel.start()) ",
241d297
<         {-# LINE 208 "haskades_run.cpp.mustache" #-}
242d297
<         build "{",
243d297
<         {-# LINE 208 "haskades_run.cpp.mustache" #-}
244d297
<         build "\n\t\t\tqCritical() << \"ACCELEROMETER START FAILED!\";\n\t\t}\n\t}\n\npublic slots:\n\tvoid callback() ",
245d297
<         {-# LINE 214 "haskades_run.cpp.mustache" #-}
246d297
<         build "{",
247d297
<         {-# LINE 214 "haskades_run.cpp.mustache" #-}
248d297
<         build "\n\t\tQtMobility::QAccelerometerReading *r = _accel.reading();\n\t\tif(!_cb((double)r->x(), (double)r->y(), (double)r->z())) ",
249d297
<         {-# LINE 216 "haskades_run.cpp.mustache" #-}
250d297
<         build "{",
251d297
<         {-# LINE 216 "haskades_run.cpp.mustache" #-}
252d297
<         build "\n\t\t\t_accel.stop();\n\t\t\tdelete this;\n\t\t}\n\t}\n\nprotected:\n\tQtMobility::QAccelerometer _accel;\n\tint (*_cb)(double, double, double);\n};\n#endif\n\nextern \"C\" ",
253d297
<         {-# LINE 228 "haskades_run.cpp.mustache" #-}
254d297
<         build "{",
255d297
<         {-# LINE 228 "haskades_run.cpp.mustache" #-}
256d297
<         build "\n\nQObject *mainAppGlobal;\n\nQ_DECL_EXPORT void emit_ToUIEvent(int signalEvent",
257d297
<         {-# LINE 232 "haskades_run.cpp.mustache" #-}
258d297
<         mconcat $ map (toUItypes13 escapeFunction) toUItypes,
259d297
<         {-# LINE 232 "haskades_run.cpp.mustache" #-}
260d297
<         build ") ",
261d297
<         {-# LINE 232 "haskades_run.cpp.mustache" #-}
262d297
<         build "{",
263d297
<         {-# LINE 232 "haskades_run.cpp.mustache" #-}
264d297
<         build "\n\tQEvent *e = (QEvent *)new ToUIEvent(signalEvent",
265d297
<         {-# LINE 233 "haskades_run.cpp.mustache" #-}
266d297
<         mconcat $ map (toUItypes14 escapeFunction) toUItypes,
267d297
<         {-# LINE 233 "haskades_run.cpp.mustache" #-}
268d297
<         build ");\n\tQCoreApplication::postEvent(mainAppGlobal, e);\n}\n\nvoid destroySignalFromUI(SignalFromUI *s) ",
269d297
<         {-# LINE 237 "haskades_run.cpp.mustache" #-}
270d297
<         build "{",
271d297
<         {-# LINE 237 "haskades_run.cpp.mustache" #-}
272d297
<         build "\n\tswitch(s->tag) ",
273d297
<         {-# LINE 238 "haskades_run.cpp.mustache" #-}
274d297
<         build "{",
275d297
<         {-# LINE 238 "haskades_run.cpp.mustache" #-}
276d297
<         build "\n",
277c298
<         {-# LINE 239 "haskades_run.cpp.mustache" #-}
---
> 
277a299
> 
277a300
> 
277a301
> 
277a302
>         build "{", "\n\t\temit invoked(req.target(), req.action(), req.mimeType(), req.uri().toString(), QString::fromUtf8(req.data()));\n\t}\n#endif\n\nprotected:\n\tQString qmlPath;\n#ifdef USE_INVOCATIONS\n\tbb::system::InvokeManager invokeManager;\n#endif\n};\n\n#ifdef USE_SENSORS\nclass AccelerometerHandler : public QObject ",
277a303
> 
277a304
> 
277a305
> 
277a306
> 
277a307
> 
277a308
> 
277a309
> 
277a310
> 
277a311
> 
277a312
> 
277a313
> 
277a314
> 
277a315
>         build "{", "\nQ_OBJECT\n\npublic:\n\tAccelerometerHandler(QtMobility::QAccelerometer::AccelerationMode accelM, QtMobility::QAccelerometer::AxesOrientationMode axesM, int (*cb)(double, double, double)) : _cb(cb) ",
277a316
> 
277a317
> 
277a318
> 
277a319
>         build "{", "\n\t\t_accel.setAccelerationMode(accelM);\n\t\t_accel.setAxesOrientationMode(axesM);\n\n\t\tconnect(&_accel, SIGNAL(readingChanged()), SLOT(callback()));\n\n\t\tif(!_accel.connectToBackend()) ",
277a320
> 
277a321
> 
277a322
> 
277a323
> 
277a324
> 
277a325
>         build "{", "\n\t\t\tqCritical() << \"CONNECT TO ACCELEROMETER BACKEND FAILED!\";\n\t\t} else if(!_accel.start()) ",
277a326
> 
277a327
>         build "{", "\n\t\t\tqCritical() << \"ACCELEROMETER START FAILED!\";\n\t\t}\n\t}\n\npublic slots:\n\tvoid callback() ",
277a328
> 
277a329
> 
277a330
> 
277a331
> 
277a332
> 
277a333
>         build "{", "\n\t\tQtMobility::QAccelerometerReading *r = _accel.reading();\n\t\tif(!_cb((double)r->x(), (double)r->y(), (double)r->z())) ",
277a334
> 
277a335
>         build "{", "\n\t\t\t_accel.stop();\n\t\t\tdelete this;\n\t\t}\n\t}\n\nprotected:\n\tQtMobility::QAccelerometer _accel;\n\tint (*_cb)(double, double, double);\n};\n#endif\n\nextern \"C\" ",
277a336
> 
277a337
> 
277a338
> 
277a339
> 
277a340
> 
277a341
> 
277a342
> 
277a343
> 
277a344
> 
277a345
> 
277a346
> 
277a347
>         build "{", "\n\nQObject *mainAppGlobal;\n\nQ_DECL_EXPORT void emit_ToUIEvent(int signalEvent",
277a348
> 
277a349
> 
277a350
> 
277a351
>         mconcat $ map (toUItypes13 escapeFunction) toUItypes, ") ", "{", "\n\tQEvent *e = (QEvent *)new ToUIEvent(signalEvent",
277a352
>         mconcat $ map (toUItypes14 escapeFunction) toUItypes, ");\n\tQCoreApplication::postEvent(mainAppGlobal, e);\n}\n\nvoid destroySignalFromUI(SignalFromUI *s) ",
277a353
> 
277a354
> 
277a355
> 
277a356
>         build "{", "\n\tswitch(s->tag) ",
277a357
>         build "{", "\n",
279c359
<         {-# LINE 248 "haskades_run.cpp.mustache" #-}
---
> 
279a360
> 
279a361
> 
279a362
> 
279a363
> 
279a364
> 
279a365
> 
279a366
> 
281d367
<         {-# LINE 255 "haskades_run.cpp.mustache" #-}
282d367
<         build "{",
283d367
<         {-# LINE 255 "haskades_run.cpp.mustache" #-}
284d367
<         build "\n\tif(lastFromUI) destroySignalFromUI(lastFromUI);\n\tlastFromUI = signalFromUIQ.dequeue();\n\treturn lastFromUI;\n}\n\nQ_DECL_EXPORT int haskades_run(char *qml_path) ",
285d367
<         {-# LINE 261 "haskades_run.cpp.mustache" #-}
286d367
<         build "{",
287d367
<         {-# LINE 261 "haskades_run.cpp.mustache" #-}
288d367
<         build "\n\tint argc = 0;\n\tchar *argv[] = ",
289d367
<         {-# LINE 263 "haskades_run.cpp.mustache" #-}
290d367
<         build "{",
291d367
<         {-# LINE 263 "haskades_run.cpp.mustache" #-}
292d367
<         build " NULL };\n\t// Instantiate the main application constructor.\n\tbb::cascades::Application app(argc, argv);\n\n\t// Set up the translator.\n\tQTranslator translator;\n\tQString locale_string = QLocale().name();\n\tQString filename = QString(\"sample_%1\").arg(locale_string); // TODO\n\tif (translator.load(filename, \"app/native/qm\")) ",
293d367
<         {-# LINE 271 "haskades_run.cpp.mustache" #-}
294d367
<         build "{",
295d367
<         {-# LINE 271 "haskades_run.cpp.mustache" #-}
296d367
<         build "\n\t\tapp.installTranslator(&translator);\n\t}\n\n\ttoUIEventType = (QEvent::Type)QEvent::registerEventType();\n\n\t// Initialize our application.\n\tAppWrapper mainApp(QString::fromUtf8(qml_path));\n\tmainAppGlobal = (QObject*)&mainApp;\n\tmainApp.ready();\n\n\t// We complete the transaction started in the main application constructor and start the\n\t// client event loop here. When loop is exited the Application deletes the scene which\n\t// deletes all its children.\n\tint status = bb::cascades::Application::exec();\n\tsignalFromUIQ.stop();\n\treturn status;\n}\n\n#ifdef USE_SENSORS\nvoid accelerometer_start(int accelM, int axesM, int (*cb)(double, double, double)) ",
297d367
<         {-# LINE 291 "haskades_run.cpp.mustache" #-}
298d367
<         build "{",
299d367
<         {-# LINE 291 "haskades_run.cpp.mustache" #-}
300d367
<         build "\n\tQtMobility::QAccelerometer::AccelerationMode _accelM;\n\tQtMobility::QAccelerometer::AxesOrientationMode _axesM;\n\n\tswitch(accelM) ",
301d367
<         {-# LINE 295 "haskades_run.cpp.mustache" #-}
302d367
<         build "{",
303d367
<         {-# LINE 295 "haskades_run.cpp.mustache" #-}
304d367
<         build "\n\t\tcase 0:\n\t\t\t_accelM = QtMobility::QAccelerometer::Gravity;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t_accelM = QtMobility::QAccelerometer::User;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t_accelM = QtMobility::QAccelerometer::Combined;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tqWarning() << \"Unknown AccelerationMode, defaulting to Combined\";\n\t\t\t_accelM = QtMobility::QAccelerometer::Combined;\n\t}\n\n\tswitch(axesM) ",
305d367
<         {-# LINE 310 "haskades_run.cpp.mustache" #-}
306d367
<         build "{",
307d367
<         {-# LINE 310 "haskades_run.cpp.mustache" #-}
308c368
<         build "\n\t\tcase 0:\n\t\t\t_axesM = QtMobility::QAccelerometer::FixedOrientation;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t_axesM = QtMobility::QAccelerometer::AutomaticOrientation;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t_axesM = QtMobility::QAccelerometer::UserOrientation;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tqWarning() << \"Unknown AxesOrientationMode, defaulting to Automatic\";\n\t\t\t_axesM = QtMobility::QAccelerometer::AutomaticOrientation;\n\t}\n\n\tnew AccelerometerHandler(_accelM, _axesM, cb);\n}\n#endif\n\n}\n\n// Tell MOC to run on this file\n#include \"haskades_run.moc\"\n"
---
> 
308a369
> 
308a370
> 
308a371
> 
308a372
> 
308a373
> 
308a374
>         build "{", "\n\tif(lastFromUI) destroySignalFromUI(lastFromUI);\n\tlastFromUI = signalFromUIQ.dequeue();\n\treturn lastFromUI;\n}\n\nQ_DECL_EXPORT int haskades_run(char *qml_path) ",
308a375
> 
308a376
> 
308a377
> 
308a378
> 
308a379
> 
308a380
>         build "{", "\n\tint argc = 0;\n\tchar *argv[] = ",
308a381
> 
308a382
>         build "{", " NULL };\n\t// Instantiate the main application constructor.\n\tbb::cascades::Application app(argc, argv);\n\n\t// Set up the translator.\n\tQTranslator translator;\n\tQString locale_string = QLocale().name();\n\tQString filename = QString(\"sample_%1\").arg(locale_string); // TODO\n\tif (translator.load(filename, \"app/native/qm\")) ",
308a383
> 
308a384
> 
308a385
> 
308a386
> 
308a387
> 
308a388
> 
308a389
> 
308a390
>         build "{", "\n\t\tapp.installTranslator(&translator);\n\t}\n\n\ttoUIEventType = (QEvent::Type)QEvent::registerEventType();\n\n\t// Initialize our application.\n\tAppWrapper mainApp(QString::fromUtf8(qml_path));\n\tmainAppGlobal = (QObject*)&mainApp;\n\tmainApp.ready();\n\n\t// We complete the transaction started in the main application constructor and start the\n\t// client event loop here. When loop is exited the Application deletes the scene which\n\t// deletes all its children.\n\tint status = bb::cascades::Application::exec();\n\tsignalFromUIQ.stop();\n\treturn status;\n}\n\n#ifdef USE_SENSORS\nvoid accelerometer_start(int accelM, int axesM, int (*cb)(double, double, double)) ",
308a391
> 
308a392
> 
308a393
> 
308a394
> 
308a395
> 
308a396
> 
308a397
> 
308a398
> 
308a399
> 
308a400
> 
308a401
> 
308a402
> 
308a403
> 
308a404
> 
308a405
> 
308a406
> 
308a407
> 
308a408
> 
308a409
> 
308a410
>         build "{", "\n\tQtMobility::QAccelerometer::AccelerationMode _accelM;\n\tQtMobility::QAccelerometer::AxesOrientationMode _axesM;\n\n\tswitch(accelM) ",
308a411
> 
308a412
> 
308a413
> 
308a414
>         build "{", "\n\t\tcase 0:\n\t\t\t_accelM = QtMobility::QAccelerometer::Gravity;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t_accelM = QtMobility::QAccelerometer::User;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t_accelM = QtMobility::QAccelerometer::Combined;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tqWarning() << \"Unknown AccelerationMode, defaulting to Combined\";\n\t\t\t_accelM = QtMobility::QAccelerometer::Combined;\n\t}\n\n\tswitch(axesM) ",
308a415
> 
308a416
> 
308a417
> 
308a418
> 
308a419
> 
308a420
> 
308a421
> 
308a422
> 
308a423
> 
308a424
> 
308a425
> 
308a426
> 
308a427
> 
308a428
> 
308a429
>         build "{", "\n\t\tcase 0:\n\t\t\t_axesM = QtMobility::QAccelerometer::FixedOrientation;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t_axesM = QtMobility::QAccelerometer::AutomaticOrientation;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t_axesM = QtMobility::QAccelerometer::UserOrientation;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tqWarning() << \"Unknown AxesOrientationMode, defaulting to Automatic\";\n\t\t\t_axesM = QtMobility::QAccelerometer::AutomaticOrientation;\n\t}\n\n\tnew AccelerometerHandler(_accelM, _axesM, cb);\n}\n#endif\n\n}\n\n// Tell MOC to run on this file\n#include \"haskades_run.moc\"\n"
311d431
<     toUItypes0 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [
312d431
<             {-# LINE 84 "haskades_run.cpp.mustache" #-}
313d431
<             build ", ",
314d431
<             {-# LINE 84 "haskades_run.cpp.mustache" #-}
315d431
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigtype,
316d431
<             {-# LINE 84 "haskades_run.cpp.mustache" #-}
317d431
<             build " ",
318d431
<             {-# LINE 84 "haskades_run.cpp.mustache" #-}
319c432
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename
---
>     toUItypes0 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [ ", ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigtype, " ",  sigtypename
322d434
<             {-# LINE 87 "haskades_run.cpp.mustache" #-}
323d434
<             build "\t\tthis->",
324d434
<             {-# LINE 87 "haskades_run.cpp.mustache" #-}
325d434
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename,
326d434
<             {-# LINE 87 "haskades_run.cpp.mustache" #-}
327d434
<             build " = ",
328d434
<             {-# LINE 87 "haskades_run.cpp.mustache" #-}
329d434
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename,
330d434
<             {-# LINE 87 "haskades_run.cpp.mustache" #-}
331c435
<             build ";\n"
---
>             build "\t\tthis->", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename, " = ",
334d437
<             {-# LINE 93 "haskades_run.cpp.mustache" #-}
335d437
<             build "\t",
336d437
<             {-# LINE 93 "haskades_run.cpp.mustache" #-}
337d437
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigtype,
338d437
<             {-# LINE 93 "haskades_run.cpp.mustache" #-}
339d437
<             build " ",
340d437
<             {-# LINE 93 "haskades_run.cpp.mustache" #-}
341d437
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename,
342d437
<             {-# LINE 93 "haskades_run.cpp.mustache" #-}
343c438
<             build ";\n"
---
> 
343a439
> 
343a440
> 
343a441
>             build "\t", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigtype, " ",  sigtypename, ";\n"
346d443
<             {-# LINE 137 "haskades_run.cpp.mustache" #-}
347d443
<             build "\t\t\t\tcase TOUI_",
348d443
<             {-# LINE 137 "haskades_run.cpp.mustache" #-}
349d443
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
350d443
<             {-# LINE 137 "haskades_run.cpp.mustache" #-}
351d443
<             build ":\n\t\t\t\t\temit ",
352d443
<             {-# LINE 138 "haskades_run.cpp.mustache" #-}
353d443
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
354d443
<             {-# LINE 138 "haskades_run.cpp.mustache" #-}
355d443
<             build "(",
356d443
<             {-# LINE 138 "haskades_run.cpp.mustache" #-}
357d443
<             mconcat $ map (sigargs4 escapeFunction) sigargs,
358d443
<             {-# LINE 138 "haskades_run.cpp.mustache" #-}
359c444
<             build ");\n\t\t\t\t\treturn true;\n\t\t\t\t\tbreak;\n"
---
> 
359a445
> 
359a446
> 
359a447
> 
359a448
> 
359a449
> 
359a450
> 
359a451
> 
359a452
> 
359a453
> 
359a454
> 
359a455
> 
359a456
> 
359a457
> 
359a458
> 
359a459
> 
359a460
> 
359a461
> 
359a462
> 
359a463
> 
359a464
> 
359a465
> 
359a466
> 
359a467
> 
359a468
> 
359a469
> 
359a470
> 
359a471
> 
359a472
> 
359a473
> 
359a474
> 
359a475
> 
359a476
> 
359a477
> 
359a478
> 
359a479
> 
359a480
> 
359a481
> 
359a482
> 
359a483
> 
359a484
> 
359a485
>             build "\t\t\t\tcase TOUI_", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
359a486
>             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, "(", $ map (sigargs4 escapeFunction) sigargs, ");\n\t\t\t\t\treturn true;\n\t\t\t\t\tbreak;\n"
362d488
<         sigargs4 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
363d488
<                 {-# LINE 138 "haskades_run.cpp.mustache" #-}
364d488
<                 if mempty == (Any sigargfirst) then sigargfirst5 escapeFunction ctx else mempty,
365d488
<                 {-# LINE 138 "haskades_run.cpp.mustache" #-}
366d488
<                 build "ev->",
367d488
<                 {-# LINE 138 "haskades_run.cpp.mustache" #-}
368c489
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargsigtypename
---
>         sigargs4 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ mempty == (Any sigargfirst) then sigargfirst5 escapeFunction ctx else mempty, "ev->", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargsigtypename
371d491
<             sigargfirst5 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
372d491
<                     {-# LINE 138 "haskades_run.cpp.mustache" #-}
373c492
<                     build ", "
---
>             sigargfirst5 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ ", "
376d494
<             {-# LINE 150 "haskades_run.cpp.mustache" #-}
377d494
<             build "\tQ_INVOKABLE void ",
378d494
<             {-# LINE 150 "haskades_run.cpp.mustache" #-}
379d494
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
380d494
<             {-# LINE 150 "haskades_run.cpp.mustache" #-}
381d494
<             build "(",
382d494
<             {-# LINE 150 "haskades_run.cpp.mustache" #-}
383d494
<             mconcat $ map (sigargs7 escapeFunction) sigargs,
384d494
<             {-# LINE 150 "haskades_run.cpp.mustache" #-}
385d494
<             build ") ",
386d494
<             {-# LINE 150 "haskades_run.cpp.mustache" #-}
387d494
<             build "{",
388d494
<             {-# LINE 150 "haskades_run.cpp.mustache" #-}
389d494
<             build "\n\t\tSignalFromUI *s = new SignalFromUI;\n\t\ts->tag = ",
390d494
<             {-# LINE 152 "haskades_run.cpp.mustache" #-}
391d494
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent,
392d494
<             {-# LINE 152 "haskades_run.cpp.mustache" #-}
393d494
<             build ";\n",
394c495
<             {-# LINE 153 "haskades_run.cpp.mustache" #-}
---
> 
394a496
> 
394a497
> 
394a498
> 
394a499
> 
394a500
> 
394a501
> 
394a502
> 
394a503
> 
394a504
>             build "\tQ_INVOKABLE void ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, "(", $ map (sigargs7 escapeFunction) sigargs, ") ", "\n\t\tSignalFromUI *s = new SignalFromUI;\n\t\ts->tag = ",
394a505
> 
394a506
>             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent, ";\n",
396c508
<             {-# LINE 156 "haskades_run.cpp.mustache" #-}
---
> 
396a509
> 
400d512
<         sigargs7 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
401d512
<                 {-# LINE 150 "haskades_run.cpp.mustache" #-}
402d512
<                 if mempty == (Any sigargfirst) then sigargfirst8 escapeFunction ctx else mempty,
403d512
<                 {-# LINE 150 "haskades_run.cpp.mustache" #-}
404d512
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigargtype,
405d512
<                 {-# LINE 150 "haskades_run.cpp.mustache" #-}
406d512
<                 build " ",
407d512
<                 {-# LINE 150 "haskades_run.cpp.mustache" #-}
408c513
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame
---
>         sigargs7 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ mempty == (Any sigargfirst) then sigargfirst8 escapeFunction ctx else mempty, $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigargtype, " ",  siganame
411d515
<             sigargfirst8 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
412d515
<                     {-# LINE 150 "haskades_run.cpp.mustache" #-}
413c516
<                     build ", "
---
>             sigargfirst8 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ ", "
416d518
<                 {-# LINE 154 "haskades_run.cpp.mustache" #-}
417d518
<                 build "\t\ts->",
418d518
<                 {-# LINE 154 "haskades_run.cpp.mustache" #-}
419d518
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
420d518
<                 {-# LINE 154 "haskades_run.cpp.mustache" #-}
421d518
<                 build ".",
422d518
<                 {-# LINE 154 "haskades_run.cpp.mustache" #-}
423d518
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame,
424d518
<                 {-# LINE 154 "haskades_run.cpp.mustache" #-}
425d518
<                 build " = ",
426d518
<                 {-# LINE 154 "haskades_run.cpp.mustache" #-}
427d518
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargfromqt,
428d518
<                 {-# LINE 154 "haskades_run.cpp.mustache" #-}
429c519
<                 build ";\n"
---
> 
429a520
>                 build "\t\ts->", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, ".",  siganame, " = ",  sigargfromqt,
432d522
<             {-# LINE 176 "haskades_run.cpp.mustache" #-}
433d522
<             build "\tvoid ",
434d522
<             {-# LINE 176 "haskades_run.cpp.mustache" #-}
435d522
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
436d522
<             {-# LINE 176 "haskades_run.cpp.mustache" #-}
437d522
<             build "(",
438d522
<             {-# LINE 176 "haskades_run.cpp.mustache" #-}
439d522
<             mconcat $ map (sigargs11 escapeFunction) sigargs,
440d522
<             {-# LINE 176 "haskades_run.cpp.mustache" #-}
441c523
<             build ");\n"
---
> 
441a524
> 
441a525
> 
441a526
> 
441a527
> 
441a528
> 
441a529
> 
441a530
> 
441a531
> 
441a532
> 
441a533
> 
441a534
> 
441a535
> 
441a536
> 
441a537
> 
441a538
> 
441a539
> 
441a540
> 
441a541
> 
441a542
>             build "\tvoid ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, "(", $ map (sigargs11 escapeFunction) sigargs, ");\n"
444d544
<         sigargs11 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
445d544
<                 {-# LINE 176 "haskades_run.cpp.mustache" #-}
446d544
<                 if mempty == (Any sigargfirst) then sigargfirst12 escapeFunction ctx else mempty,
447d544
<                 {-# LINE 176 "haskades_run.cpp.mustache" #-}
448c545
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigargtype
---
>         sigargs11 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ mempty == (Any sigargfirst) then sigargfirst12 escapeFunction ctx else mempty, $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigargtype
451d547
<             sigargfirst12 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
452d547
<                     {-# LINE 176 "haskades_run.cpp.mustache" #-}
453c548
<                     build ", "
---
>             sigargfirst12 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ ", "
456d550
<             {-# LINE 232 "haskades_run.cpp.mustache" #-}
457d550
<             build ", ",
458d550
<             {-# LINE 232 "haskades_run.cpp.mustache" #-}
459d550
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build lowcsigtype,
460d550
<             {-# LINE 232 "haskades_run.cpp.mustache" #-}
461d550
<             build " ",
462d550
<             {-# LINE 232 "haskades_run.cpp.mustache" #-}
463c551
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename
---
> 
463a552
> 
463a553
> 
463a554
> 
463a555
> 
463a556
> 
463a557
> 
463a558
> 
463a559
> 
463a560
> 
463a561
> 
463a562
> 
463a563
> 
463a564
> 
463a565
> 
463a566
> 
463a567
> 
463a568
> 
463a569
> 
463a570
> 
463a571
> 
463a572
> 
463a573
> 
463a574
> 
463a575
> 
463a576
> 
463a577
> 
463a578
> 
463a579
> 
463a580
> 
463a581
> 
463a582
> 
463a583
> 
463a584
> 
463a585
> 
463a586
> 
463a587
> 
463a588
> 
463a589
> 
463a590
> 
463a591
> 
463a592
> 
463a593
> 
463a594
> 
463a595
> 
463a596
> 
463a597
> 
463a598
> 
463a599
> 
463a600
> 
463a601
> 
463a602
> 
463a603
> 
463a604
>             build ", ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build lowcsigtype, " ",
465d605
<     toUItypes14 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [
466d605
<             {-# LINE 233 "haskades_run.cpp.mustache" #-}
467d605
<             build ", ",
468d605
<             {-# LINE 233 "haskades_run.cpp.mustache" #-}
469c606
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtwrapsig
---
>     toUItypes14 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [ ", ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtwrapsig
472d608
<             {-# LINE 240 "haskades_run.cpp.mustache" #-}
473d608
<             build "\t\t\tcase FROMUI_",
474d608
<             {-# LINE 240 "haskades_run.cpp.mustache" #-}
475d608
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
476d608
<             {-# LINE 240 "haskades_run.cpp.mustache" #-}
477d608
<             build ":\n",
478c609
<             {-# LINE 241 "haskades_run.cpp.mustache" #-}
---
> 
478a610
> 
478a611
> 
478a612
> 
478a613
>             build "\t\t\tcase FROMUI_", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, ":\n",
480c615
<             {-# LINE 246 "haskades_run.cpp.mustache" #-}
---
> 
480a616
> 
480a617
> 
480a618
> 
484d621
<         sigargs16 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
485d621
<                 {-# LINE 242 "haskades_run.cpp.mustache" #-}
486c622
<                 if mempty /= sigargdestroy then sigargdestroy17 escapeFunction ctx else mempty
---
>         sigargs16 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ mempty /= sigargdestroy then sigargdestroy17 escapeFunction ctx else mempty
489d624
<             sigargdestroy17 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
490d624
<                     {-# LINE 243 "haskades_run.cpp.mustache" #-}
491d624
<                     build "\t\t\t\t",
492d624
<                     {-# LINE 243 "haskades_run.cpp.mustache" #-}
493d624
<                     build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargdestroy,
494d624
<                     {-# LINE 243 "haskades_run.cpp.mustache" #-}
495d624
<                     build "(s->",
496d624
<                     {-# LINE 243 "haskades_run.cpp.mustache" #-}
497d624
<                     build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
498d624
<                     {-# LINE 243 "haskades_run.cpp.mustache" #-}
499d624
<                     build ".",
500d624
<                     {-# LINE 243 "haskades_run.cpp.mustache" #-}
501d624
<                     build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame,
502d624
<                     {-# LINE 243 "haskades_run.cpp.mustache" #-}
503c625
<                     build ");\n"
---
>             sigargdestroy17 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ "\t\t\t\t", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargdestroy, "(s->",  signame, ".",  siganame,
506d627
< haskades_runh escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [
507d627
<         {-# LINE 1 "haskades_run.h.mustache" #-}
508d627
<         build "#ifndef _HASKADES_RUN_H\n#define _HASKADES_RUN_H\n\n",
509c628
<         {-# LINE 4 "haskades_run.h.mustache" #-}
---
> haskades_runh escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [ "#ifndef _HASKADES_RUN_H\n#define _HASKADES_RUN_H\n\n",
509a629
> 
509a630
> 
511c632
<         {-# LINE 7 "haskades_run.h.mustache" #-}
---
> 
511a633
> 
513d634
<         {-# LINE 8 "haskades_run.h.mustache" #-}
515c636
<         {-# LINE 11 "haskades_run.h.mustache" #-}
---
> 
515a637
> 
517d638
<         {-# LINE 12 "haskades_run.h.mustache" #-}
518d638
<         build "{",
519d638
<         {-# LINE 12 "haskades_run.h.mustache" #-}
520d638
<         build "\n\tunsigned int tag;\n\tunion ",
521d638
<         {-# LINE 14 "haskades_run.h.mustache" #-}
522d638
<         build "{",
523d638
<         {-# LINE 14 "haskades_run.h.mustache" #-}
524d638
<         build "\n\t\t",
525c639
<         {-# LINE 15 "haskades_run.h.mustache" #-}
---
>         build "{", "\n\tunsigned int tag;\n\tunion ",
525a640
> 
525a641
>         build "{", "\n\t\t",
527c643
<         {-# LINE 22 "haskades_run.h.mustache" #-}
---
> 
527a644
> 
527a645
> 
527a646
> 
527a647
> 
527a648
> 
531d651
<     toUI0 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
532d651
<             {-# LINE 5 "haskades_run.h.mustache" #-}
533d651
<             build "#define TOUI_",
534d651
<             {-# LINE 5 "haskades_run.h.mustache" #-}
535d651
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
536d651
<             {-# LINE 5 "haskades_run.h.mustache" #-}
537d651
<             build " ",
538d651
<             {-# LINE 5 "haskades_run.h.mustache" #-}
539d651
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent,
540d651
<             {-# LINE 5 "haskades_run.h.mustache" #-}
541c652
<             build "\n"
---
>     toUI0 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [ "#define TOUI_", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, " ",  sigevent, "\n"
544d654
<             {-# LINE 9 "haskades_run.h.mustache" #-}
545d654
<             build "#define FROMUI_",
546d654
<             {-# LINE 9 "haskades_run.h.mustache" #-}
547d654
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
548d654
<             {-# LINE 9 "haskades_run.h.mustache" #-}
549d654
<             build " ",
550d654
<             {-# LINE 9 "haskades_run.h.mustache" #-}
551d654
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent,
552d654
<             {-# LINE 9 "haskades_run.h.mustache" #-}
553c655
<             build "\n"
---
> 
553a656
>             build "#define FROMUI_", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, " ",  sigevent, "\n"
556d658
<             {-# LINE 16 "haskades_run.h.mustache" #-}
557d658
<             build "\t\tstruct ",
558d658
<             {-# LINE 16 "haskades_run.h.mustache" #-}
559d658
<             build "{",
560d658
<             {-# LINE 16 "haskades_run.h.mustache" #-}
561d658
<             build "\n\t\t\t",
562c659
<             {-# LINE 17 "haskades_run.h.mustache" #-}
---
> 
562a660
> 
562a661
> 
562a662
> 
562a663
>             build "\t\tstruct ", "{", "\n\t\t\t",
564d664
<             {-# LINE 20 "haskades_run.h.mustache" #-}
565d664
<             build "\t\t} ",
566d664
<             {-# LINE 20 "haskades_run.h.mustache" #-}
567d664
<             build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
568d664
<             {-# LINE 20 "haskades_run.h.mustache" #-}
569c665
<             build ";\n\t\t"
---
> 
569a666
> 
569a667
>             build "\t\t} ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, ";\n\t\t"
572d669
<         sigargs3 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
573d669
<                 {-# LINE 18 "haskades_run.h.mustache" #-}
574d669
<                 build "\t\t\t",
575d669
<                 {-# LINE 18 "haskades_run.h.mustache" #-}
576d669
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build csigargtype,
577d669
<                 {-# LINE 18 "haskades_run.h.mustache" #-}
578d669
<                 build " ",
579d669
<                 {-# LINE 18 "haskades_run.h.mustache" #-}
580d669
<                 build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame,
581d669
<                 {-# LINE 18 "haskades_run.h.mustache" #-}
582c670
<                 build ";\n\t\t\t"
---
>         sigargs3 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ "\t\t\t", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build csigargtype, " ",  siganame, ";\n\t\t\t"
585a674
> 
</pre></br><h2>original</h2></br><pre>{-# OPTIONS_GHC -fno-warn-missing-signatures -fno-warn-unused-matches #-}
module MustacheTemplates where

import Data.Monoid
import Data.Text.Buildable (build)
import qualified Data.Text.Lazy as TL
import qualified Data.Text.Lazy.Builder as TL
import Records

haskadesBindinghsc escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [
        {-# LINE 1 "HaskadesBinding.hsc.mustache" #-}
        build "{",
        {-# LINE 1 "HaskadesBinding.hsc.mustache" #-}
        build "-# LANGUAGE ForeignFunctionInterface #-}\n",
        {-# LINE 2 "HaskadesBinding.hsc.mustache" #-}
        build "{",
        {-# LINE 2 "HaskadesBinding.hsc.mustache" #-}
        build "-# OPTIONS_GHC -fno-warn-unused-imports #-}\nmodule HaskadesBinding (\n#ifdef USE_SENSORS\n\tAccelerationMode,\n\tAxesOrientationMode,\n\taccelerometerStart,\n#endif\n\thaskadesRun,\n\temit\n) where\n\n#include \"",
        {-# LINE 13 "HaskadesBinding.hsc.mustache" #-}
        build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build headerPath,
        {-# LINE 13 "HaskadesBinding.hsc.mustache" #-}
        build "\"\n\nimport Control.Applicative (pure, (<*>))\nimport Control.Monad (when, ap, join, forever)\nimport Control.Monad.IO.Class (MonadIO, liftIO)\nimport Control.Concurrent (forkIO)\nimport System.Exit (exitWith, ExitCode(ExitFailure))\n\nimport Foreign.Storable\nimport Foreign.C.Types\nimport Foreign.C.String\nimport Foreign.Ptr\n\nimport Data.Time.Clock (UTCTime)\nimport Data.Time.Clock.POSIX (posixSecondsToUTCTime, utcTimeToPOSIXSeconds)\nimport qualified Data.Text as Text\nimport qualified Data.Text.Encoding as Text\nimport qualified Data.Text.Lazy as LText\nimport qualified Data.Text.Lazy.Encoding as LText\nimport qualified Data.ByteString as ByteString\n\nimport ",
        {-# LINE 34 "HaskadesBinding.hsc.mustache" #-}
        build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build modul,
        {-# LINE 34 "HaskadesBinding.hsc.mustache" #-}
        build "\n\nforeign import ccall safe \"haskades_run.cpp haskades_run\"\n\tc_haskades_run ::\n\tCString ->\n\t-- ^ QML file to load and render\n\tIO CInt\n\nforeign import ccall unsafe \"haskades_run.cpp emit_ToUIEvent\"\n\tc_emit_ToUIEvent ::\n\tCInt -> ",
        {-# LINE 44 "HaskadesBinding.hsc.mustache" #-}
        mconcat $ map (toUItypes0 escapeFunction) toUItypes,
        {-# LINE 45 "HaskadesBinding.hsc.mustache" #-}
        build "\tIO ()\n\nforeign import ccall safe \"haskades_run.cpp pop_SignalFromUI\"\n\tc_pop_SignalFromUI ::\n\tIO (Ptr SignalFromUI)\n\nemit :: (MonadIO m) => SignalToUI -> m ()\n",
        {-# LINE 52 "HaskadesBinding.hsc.mustache" #-}
        mconcat $ map (toUI1 escapeFunction) toUI,
        {-# LINE 58 "HaskadesBinding.hsc.mustache" #-}
        build "\npopSignalFromUI :: (MonadIO m) => m SignalFromUI\npopSignalFromUI = liftIO (c_pop_SignalFromUI >>= peekFromUI)\n\npeekFromUI :: Ptr SignalFromUI -> IO SignalFromUI\npeekFromUI ptr = do\n\ttag <- #",
        {-# LINE 64 "HaskadesBinding.hsc.mustache" #-}
        build "{",
        {-# LINE 64 "HaskadesBinding.hsc.mustache" #-}
        build "peek struct SignalFromUI, tag} ptr\n\tcase (tag :: CInt) of\n",
        {-# LINE 66 "HaskadesBinding.hsc.mustache" #-}
        mconcat $ map (fromUI4 escapeFunction) fromUI,
        {-# LINE 71 "HaskadesBinding.hsc.mustache" #-}
        build "\t\t_ -> error \"Corrupt SignalFromUI in peekFromUI (HaskadesBinding)\"\n\nhaskadesRun :: (MonadIO m) => String -> (SignalFromUI -> IO ()) -> m ()\nhaskadesRun qmlPath handler = liftIO $ do\n\n\t_ <- forkIO (forever $ popSignalFromUI >>= handler)\n\n\tcode <- ByteString.useAsCString (Text.encodeUtf8 $ Text.pack qmlPath) (\\qmlPath ->\n\t\t\tc_haskades_run qmlPath\n\t\t)\n\n\twhen (code /= 0) (exitWith $ ExitFailure $ fromIntegral code)\n\treturn ()\n\n#ifdef USE_SENSORS\ndata AccelerationMode = AccelerationGravity | AccelerationUser | AccelerationCombined deriving (Show, Read, Eq, Enum)\ndata AxesOrientationMode = AxesOrientationFixed | AxesOrientationAutomatic | AxesOrientationUser deriving (Show, Read, Eq, Enum)\n\nforeign import ccall \"wrapper\" _wrap_accelerometerCallback :: (CDouble -> CDouble -> CDouble -> IO CInt) -> IO (FunPtr (CDouble -> CDouble -> CDouble -> IO CInt))\n\nforeign import ccall safe \"haskades_run.cpp accelerometer_start\"\n\tc_accelerometer_start ::\n\tCInt -> CInt -> FunPtr (CDouble -> CDouble -> CDouble -> IO CInt) ->\n\tIO ()\n\nenumToCInt :: (Enum a) => a -> CInt\nenumToCInt = fromIntegral . fromEnum\n\naccelerometerStart :: AccelerationMode -> AxesOrientationMode -> ((Double, Double, Double) -> IO Bool) -> IO ()\naccelerometerStart accelM axesM cb = _wrap_accelerometerCallback cb' >>= c_accelerometer_start (enumToCInt accelM) (enumToCInt axesM)\n\twhere\n\tcb' x y z = fmap enumToCInt $ cb $! (realToFrac $! x, realToFrac $! y, realToFrac $! z)\n#endif\n"
    ]
    where
    toUItypes0 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [
            {-# LINE 44 "HaskadesBinding.hsc.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build csigtype,
            {-# LINE 44 "HaskadesBinding.hsc.mustache" #-}
            build " -> "
        ]
    toUI1 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
            {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
            build "emit (",
            {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
            {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
            build " ",
            {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
            mconcat $ map (sigargs2 escapeFunction) sigargs,
            {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
            build ") = liftIO (\n\t\t",
            {-# LINE 54 "HaskadesBinding.hsc.mustache" #-}
            if mempty /= sigcwrap then sigcwrap3 escapeFunction ctx else mempty,
            {-# LINE 55 "HaskadesBinding.hsc.mustache" #-}
            build "\t\t(c_emit_ToUIEvent ",
            {-# LINE 55 "HaskadesBinding.hsc.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent,
            {-# LINE 55 "HaskadesBinding.hsc.mustache" #-}
            build ")\n\t)\n"
        ]
        where
        sigargs2 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame,
                {-# LINE 53 "HaskadesBinding.hsc.mustache" #-}
                build " "
            ]
        sigcwrap3 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
                {-# LINE 54 "HaskadesBinding.hsc.mustache" #-}
                build "(",
                {-# LINE 54 "HaskadesBinding.hsc.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigcwrap,
                {-# LINE 54 "HaskadesBinding.hsc.mustache" #-}
                build ")"
            ]
    fromUI4 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
            {-# LINE 67 "HaskadesBinding.hsc.mustache" #-}
            build "\t\t",
            {-# LINE 67 "HaskadesBinding.hsc.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent,
            {-# LINE 67 "HaskadesBinding.hsc.mustache" #-}
            build " ->\n\t\t\tpure ",
            {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
            {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
            mconcat $ map (sigargs5 escapeFunction) sigargs,
            {-# LINE 69 "HaskadesBinding.hsc.mustache" #-}
            build "\n"
        ]
        where
        sigargs5 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
                build " <*> ((",
                {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargfromc,
                {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
                build ") (#",
                {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
                build "{",
                {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
                build "peek struct SignalFromUI, ",
                {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
                {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
                build ".",
                {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame,
                {-# LINE 68 "HaskadesBinding.hsc.mustache" #-}
                build "} ptr))"
            ]

haskades_runcpp escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [
        {-# LINE 1 "haskades_run.cpp.mustache" #-}
        build "#include <QtDebug>\n#include <QLocale>\n#include <QTranslator>\n\n#include <QQueue>\n#include <QSemaphore>\n#include <QMutex>\n\n#include <bb/cascades/Application>\n#include <bb/cascades/QmlDocument>\n#include <bb/cascades/AbstractPane>\n\n#ifdef USE_SENSORS\n#include <QtSensors/QAccelerometer>\n#endif\n\n#ifdef USE_NOTIFICATIONS\n#include <bb/platform/Notification>\n#include <bb/platform/NotificationDialog>\n#endif\n\n#ifdef USE_INVOCATIONS\n#include <bb/system/InvokeManager>\n#endif\n\n#include \"",
        {-# LINE 26 "haskades_run.cpp.mustache" #-}
        build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build headerPath,
        {-# LINE 26 "haskades_run.cpp.mustache" #-}
        build "\"\n\nQEvent::Type toUIEventType;\n\ntemplate<class T> class ThreadSafeQueue ",
        {-# LINE 30 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 30 "haskades_run.cpp.mustache" #-}
        build "\npublic:\n\tThreadSafeQueue() : semFree(32), semUsed(0), valid(true) ",
        {-# LINE 32 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 32 "haskades_run.cpp.mustache" #-}
        build " }\n\n\tvoid enqueue(const T &value) ",
        {-# LINE 34 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 34 "haskades_run.cpp.mustache" #-}
        build "\n\t\tif(!valid) return;\n\n\t\tsemFree.acquire(1);\n\t\tmutex.lock();\n\t\tqueue.enqueue(value);\n\t\tmutex.unlock();\n\t\tsemUsed.release(1);\n\t}\n\n\tT dequeue() ",
        {-# LINE 44 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 44 "haskades_run.cpp.mustache" #-}
        build "\n\t\tif(!valid) return NULL;\n\n\t\tsemUsed.acquire(1);\n\t\tmutex.lock();\n\t\tT val = queue.dequeue();\n\t\tmutex.unlock();\n\t\tsemFree.release(1);\n\t\treturn val;\n\t}\n\n\tvoid stop() ",
        {-# LINE 55 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 55 "haskades_run.cpp.mustache" #-}
        build "\n\t\t// Stop new calls\n\t\tvalid = false;\n\n\t\t// Make sure there is something to dequeue\n\t\tmutex.lock();\n\t\tqueue.enqueue(NULL);\n\t\tmutex.unlock();\n\n\t\t// Allow waiting dequeue\n\t\tsemUsed.release(32);\n\n\t\t// Allow waiting enqueue\n\t\tsemFree.release(32);\n\t}\n\nprotected:\n\tbool valid;\n\tQQueue<T> queue;\n\tQSemaphore semFree;\n\tQSemaphore semUsed;\n\tQMutex mutex;\n};\n\nThreadSafeQueue<SignalFromUI*> signalFromUIQ;\n\nclass ToUIEvent : public QEvent ",
        {-# LINE 81 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 81 "haskades_run.cpp.mustache" #-}
        build "\n\npublic:\n\tToUIEvent(int signalEvent",
        {-# LINE 84 "haskades_run.cpp.mustache" #-}
        mconcat $ map (toUItypes0 escapeFunction) toUItypes,
        {-# LINE 84 "haskades_run.cpp.mustache" #-}
        build ") : QEvent(toUIEventType) ",
        {-# LINE 84 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 84 "haskades_run.cpp.mustache" #-}
        build "\n\t\tthis->signalEvent = signalEvent;\n",
        {-# LINE 86 "haskades_run.cpp.mustache" #-}
        mconcat $ map (toUItypes1 escapeFunction) toUItypes,
        {-# LINE 89 "haskades_run.cpp.mustache" #-}
        build "\t}\n\n\tint signalEvent;\n",
        {-# LINE 92 "haskades_run.cpp.mustache" #-}
        mconcat $ map (toUItypes2 escapeFunction) toUItypes,
        {-# LINE 95 "haskades_run.cpp.mustache" #-}
        build "};\n\nclass AppWrapper: public QObject ",
        {-# LINE 97 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 97 "haskades_run.cpp.mustache" #-}
        build "\nQ_OBJECT\n\npublic:\n\t// This is our constructor that sets up the recipe.\n\tAppWrapper(QString qml_path) : qmlPath(qml_path) ",
        {-# LINE 102 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 102 "haskades_run.cpp.mustache" #-}
        build "\n#ifdef USE_INVOCATIONS\n\t\tconnect(&this->invokeManager, SIGNAL(invoked(const bb::system::InvokeRequest&)), this, SLOT(wasInvoked(const bb::system::InvokeRequest&)));\n#endif\n#ifdef USE_NOTIFICATIONS\n\t\tqmlRegisterType<bb::platform::Notification>(\"bb.platform\", 1, 0, \"Notification\");\n\t\tqmlRegisterType<bb::platform::NotificationDialog>(\"bb.platform\", 1, 0, \"NotificationDialog\");\n#endif\n\t}\n\n\tvirtual void ready() ",
        {-# LINE 112 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 112 "haskades_run.cpp.mustache" #-}
        build "\n\t\t// Obtain a QMLDocument and load it into the qml variable, using build patterns.\n\t\tbb::cascades::QmlDocument *qml = bb::cascades::QmlDocument::create(this->qmlPath);\n\n\t\t// If the QML document is valid, we process it.\n\t\tif(!qml->hasErrors()) ",
        {-# LINE 117 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 117 "haskades_run.cpp.mustache" #-}
        build "\n\t\t\tqml->setContextProperty(\"app\", this);\n\n\t\t\t// Create the application root from QMLDocument\n\t\t\tbb::cascades::AbstractPane *appPage = qml->createRootObject<bb::cascades::AbstractPane>();\n\n\t\t\tif (appPage) ",
        {-# LINE 123 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 123 "haskades_run.cpp.mustache" #-}
        build "\n\t\t\t\t// Set the main scene for the application to the Page.\n\t\t\t\tbb::cascades::Application::instance()->setScene(appPage);\n\t\t\t}\n\t\t} else ",
        {-# LINE 127 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 127 "haskades_run.cpp.mustache" #-}
        build "\n\t\t\tqCritical() << qml->errors();\n\t\t}\n\t}\n\n\tvirtual bool event(QEvent *e) ",
        {-# LINE 132 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 132 "haskades_run.cpp.mustache" #-}
        build "\n\t\tif(e->type() == toUIEventType) ",
        {-# LINE 133 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 133 "haskades_run.cpp.mustache" #-}
        build "\n\t\t\tToUIEvent *ev = (ToUIEvent*)e;\n\t\t\tswitch(ev->signalEvent) ",
        {-# LINE 135 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 135 "haskades_run.cpp.mustache" #-}
        build "\n",
        {-# LINE 136 "haskades_run.cpp.mustache" #-}
        mconcat $ map (toUI3 escapeFunction) toUI,
        {-# LINE 142 "haskades_run.cpp.mustache" #-}
        build "\t\t\t}\n\t\t\treturn false;\n\t\t} else ",
        {-# LINE 144 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 144 "haskades_run.cpp.mustache" #-}
        build "\n\t\t\treturn QObject::event(e);\n\t\t}\n\t}\n\n",
        {-# LINE 149 "haskades_run.cpp.mustache" #-}
        mconcat $ map (fromUI6 escapeFunction) fromUI,
        {-# LINE 159 "haskades_run.cpp.mustache" #-}
        build "\n#ifdef USE_NOTIFICATIONS\n#ifdef USE_INVOCATIONS\n\tQ_INVOKABLE void addInvokeRequestToNotification(bb::platform::Notification *  notification, QString target, QString action, QString mimeType, QString uri,     QString data) ",
        {-# LINE 162 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 162 "haskades_run.cpp.mustache" #-}
        build "\n\t\tbb::system::InvokeRequest invokeRequest;\n\t\tinvokeRequest.setTarget(target);\n\t\tinvokeRequest.setAction(action);\n\t\tinvokeRequest.setMimeType(mimeType);\n\t\tinvokeRequest.setUri(uri);\n\t\tinvokeRequest.setData(data.toUtf8());\n\t\tnotification->setInvokeRequest(invokeRequest);\n\t}\n#endif\n#endif\n\nsignals:\n",
        {-# LINE 175 "haskades_run.cpp.mustache" #-}
        mconcat $ map (toUI10 escapeFunction) toUI,
        {-# LINE 178 "haskades_run.cpp.mustache" #-}
        build "\n#ifdef USE_INVOCATIONS\n\tvoid invoked(QString, QString, QString, QString, QString);\n\nprotected slots:\n\tvoid wasInvoked(const bb::system::InvokeRequest &req) ",
        {-# LINE 183 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 183 "haskades_run.cpp.mustache" #-}
        build "\n\t\temit invoked(req.target(), req.action(), req.mimeType(), req.uri().toString(), QString::fromUtf8(req.data()));\n\t}\n#endif\n\nprotected:\n\tQString qmlPath;\n#ifdef USE_INVOCATIONS\n\tbb::system::InvokeManager invokeManager;\n#endif\n};\n\n#ifdef USE_SENSORS\nclass AccelerometerHandler : public QObject ",
        {-# LINE 196 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 196 "haskades_run.cpp.mustache" #-}
        build "\nQ_OBJECT\n\npublic:\n\tAccelerometerHandler(QtMobility::QAccelerometer::AccelerationMode accelM, QtMobility::QAccelerometer::AxesOrientationMode axesM, int (*cb)(double, double, double)) : _cb(cb) ",
        {-# LINE 200 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 200 "haskades_run.cpp.mustache" #-}
        build "\n\t\t_accel.setAccelerationMode(accelM);\n\t\t_accel.setAxesOrientationMode(axesM);\n\n\t\tconnect(&_accel, SIGNAL(readingChanged()), SLOT(callback()));\n\n\t\tif(!_accel.connectToBackend()) ",
        {-# LINE 206 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 206 "haskades_run.cpp.mustache" #-}
        build "\n\t\t\tqCritical() << \"CONNECT TO ACCELEROMETER BACKEND FAILED!\";\n\t\t} else if(!_accel.start()) ",
        {-# LINE 208 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 208 "haskades_run.cpp.mustache" #-}
        build "\n\t\t\tqCritical() << \"ACCELEROMETER START FAILED!\";\n\t\t}\n\t}\n\npublic slots:\n\tvoid callback() ",
        {-# LINE 214 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 214 "haskades_run.cpp.mustache" #-}
        build "\n\t\tQtMobility::QAccelerometerReading *r = _accel.reading();\n\t\tif(!_cb((double)r->x(), (double)r->y(), (double)r->z())) ",
        {-# LINE 216 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 216 "haskades_run.cpp.mustache" #-}
        build "\n\t\t\t_accel.stop();\n\t\t\tdelete this;\n\t\t}\n\t}\n\nprotected:\n\tQtMobility::QAccelerometer _accel;\n\tint (*_cb)(double, double, double);\n};\n#endif\n\nextern \"C\" ",
        {-# LINE 228 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 228 "haskades_run.cpp.mustache" #-}
        build "\n\nQObject *mainAppGlobal;\n\nQ_DECL_EXPORT void emit_ToUIEvent(int signalEvent",
        {-# LINE 232 "haskades_run.cpp.mustache" #-}
        mconcat $ map (toUItypes13 escapeFunction) toUItypes,
        {-# LINE 232 "haskades_run.cpp.mustache" #-}
        build ") ",
        {-# LINE 232 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 232 "haskades_run.cpp.mustache" #-}
        build "\n\tQEvent *e = (QEvent *)new ToUIEvent(signalEvent",
        {-# LINE 233 "haskades_run.cpp.mustache" #-}
        mconcat $ map (toUItypes14 escapeFunction) toUItypes,
        {-# LINE 233 "haskades_run.cpp.mustache" #-}
        build ");\n\tQCoreApplication::postEvent(mainAppGlobal, e);\n}\n\nvoid destroySignalFromUI(SignalFromUI *s) ",
        {-# LINE 237 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 237 "haskades_run.cpp.mustache" #-}
        build "\n\tswitch(s->tag) ",
        {-# LINE 238 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 238 "haskades_run.cpp.mustache" #-}
        build "\n",
        {-# LINE 239 "haskades_run.cpp.mustache" #-}
        mconcat $ map (fromUI15 escapeFunction) fromUI,
        {-# LINE 248 "haskades_run.cpp.mustache" #-}
        build "\t}\n\n\tfree(s);\n}\n\nSignalFromUI *lastFromUI = NULL;\n\nQ_DECL_EXPORT SignalFromUI *pop_SignalFromUI(void) ",
        {-# LINE 255 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 255 "haskades_run.cpp.mustache" #-}
        build "\n\tif(lastFromUI) destroySignalFromUI(lastFromUI);\n\tlastFromUI = signalFromUIQ.dequeue();\n\treturn lastFromUI;\n}\n\nQ_DECL_EXPORT int haskades_run(char *qml_path) ",
        {-# LINE 261 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 261 "haskades_run.cpp.mustache" #-}
        build "\n\tint argc = 0;\n\tchar *argv[] = ",
        {-# LINE 263 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 263 "haskades_run.cpp.mustache" #-}
        build " NULL };\n\t// Instantiate the main application constructor.\n\tbb::cascades::Application app(argc, argv);\n\n\t// Set up the translator.\n\tQTranslator translator;\n\tQString locale_string = QLocale().name();\n\tQString filename = QString(\"sample_%1\").arg(locale_string); // TODO\n\tif (translator.load(filename, \"app/native/qm\")) ",
        {-# LINE 271 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 271 "haskades_run.cpp.mustache" #-}
        build "\n\t\tapp.installTranslator(&translator);\n\t}\n\n\ttoUIEventType = (QEvent::Type)QEvent::registerEventType();\n\n\t// Initialize our application.\n\tAppWrapper mainApp(QString::fromUtf8(qml_path));\n\tmainAppGlobal = (QObject*)&mainApp;\n\tmainApp.ready();\n\n\t// We complete the transaction started in the main application constructor and start the\n\t// client event loop here. When loop is exited the Application deletes the scene which\n\t// deletes all its children.\n\tint status = bb::cascades::Application::exec();\n\tsignalFromUIQ.stop();\n\treturn status;\n}\n\n#ifdef USE_SENSORS\nvoid accelerometer_start(int accelM, int axesM, int (*cb)(double, double, double)) ",
        {-# LINE 291 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 291 "haskades_run.cpp.mustache" #-}
        build "\n\tQtMobility::QAccelerometer::AccelerationMode _accelM;\n\tQtMobility::QAccelerometer::AxesOrientationMode _axesM;\n\n\tswitch(accelM) ",
        {-# LINE 295 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 295 "haskades_run.cpp.mustache" #-}
        build "\n\t\tcase 0:\n\t\t\t_accelM = QtMobility::QAccelerometer::Gravity;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t_accelM = QtMobility::QAccelerometer::User;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t_accelM = QtMobility::QAccelerometer::Combined;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tqWarning() << \"Unknown AccelerationMode, defaulting to Combined\";\n\t\t\t_accelM = QtMobility::QAccelerometer::Combined;\n\t}\n\n\tswitch(axesM) ",
        {-# LINE 310 "haskades_run.cpp.mustache" #-}
        build "{",
        {-# LINE 310 "haskades_run.cpp.mustache" #-}
        build "\n\t\tcase 0:\n\t\t\t_axesM = QtMobility::QAccelerometer::FixedOrientation;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t_axesM = QtMobility::QAccelerometer::AutomaticOrientation;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t_axesM = QtMobility::QAccelerometer::UserOrientation;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tqWarning() << \"Unknown AxesOrientationMode, defaulting to Automatic\";\n\t\t\t_axesM = QtMobility::QAccelerometer::AutomaticOrientation;\n\t}\n\n\tnew AccelerometerHandler(_accelM, _axesM, cb);\n}\n#endif\n\n}\n\n// Tell MOC to run on this file\n#include \"haskades_run.moc\"\n"
    ]
    where
    toUItypes0 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [
            {-# LINE 84 "haskades_run.cpp.mustache" #-}
            build ", ",
            {-# LINE 84 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigtype,
            {-# LINE 84 "haskades_run.cpp.mustache" #-}
            build " ",
            {-# LINE 84 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename
        ]
    toUItypes1 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [
            {-# LINE 87 "haskades_run.cpp.mustache" #-}
            build "\t\tthis->",
            {-# LINE 87 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename,
            {-# LINE 87 "haskades_run.cpp.mustache" #-}
            build " = ",
            {-# LINE 87 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename,
            {-# LINE 87 "haskades_run.cpp.mustache" #-}
            build ";\n"
        ]
    toUItypes2 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [
            {-# LINE 93 "haskades_run.cpp.mustache" #-}
            build "\t",
            {-# LINE 93 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigtype,
            {-# LINE 93 "haskades_run.cpp.mustache" #-}
            build " ",
            {-# LINE 93 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename,
            {-# LINE 93 "haskades_run.cpp.mustache" #-}
            build ";\n"
        ]
    toUI3 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
            {-# LINE 137 "haskades_run.cpp.mustache" #-}
            build "\t\t\t\tcase TOUI_",
            {-# LINE 137 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
            {-# LINE 137 "haskades_run.cpp.mustache" #-}
            build ":\n\t\t\t\t\temit ",
            {-# LINE 138 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
            {-# LINE 138 "haskades_run.cpp.mustache" #-}
            build "(",
            {-# LINE 138 "haskades_run.cpp.mustache" #-}
            mconcat $ map (sigargs4 escapeFunction) sigargs,
            {-# LINE 138 "haskades_run.cpp.mustache" #-}
            build ");\n\t\t\t\t\treturn true;\n\t\t\t\t\tbreak;\n"
        ]
        where
        sigargs4 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                {-# LINE 138 "haskades_run.cpp.mustache" #-}
                if mempty == (Any sigargfirst) then sigargfirst5 escapeFunction ctx else mempty,
                {-# LINE 138 "haskades_run.cpp.mustache" #-}
                build "ev->",
                {-# LINE 138 "haskades_run.cpp.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargsigtypename
            ]
            where
            sigargfirst5 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                    {-# LINE 138 "haskades_run.cpp.mustache" #-}
                    build ", "
                ]
    fromUI6 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
            {-# LINE 150 "haskades_run.cpp.mustache" #-}
            build "\tQ_INVOKABLE void ",
            {-# LINE 150 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
            {-# LINE 150 "haskades_run.cpp.mustache" #-}
            build "(",
            {-# LINE 150 "haskades_run.cpp.mustache" #-}
            mconcat $ map (sigargs7 escapeFunction) sigargs,
            {-# LINE 150 "haskades_run.cpp.mustache" #-}
            build ") ",
            {-# LINE 150 "haskades_run.cpp.mustache" #-}
            build "{",
            {-# LINE 150 "haskades_run.cpp.mustache" #-}
            build "\n\t\tSignalFromUI *s = new SignalFromUI;\n\t\ts->tag = ",
            {-# LINE 152 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent,
            {-# LINE 152 "haskades_run.cpp.mustache" #-}
            build ";\n",
            {-# LINE 153 "haskades_run.cpp.mustache" #-}
            mconcat $ map (sigargs9 escapeFunction) sigargs,
            {-# LINE 156 "haskades_run.cpp.mustache" #-}
            build "\t\tsignalFromUIQ.enqueue(s);\n\t}\n"
        ]
        where
        sigargs7 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                {-# LINE 150 "haskades_run.cpp.mustache" #-}
                if mempty == (Any sigargfirst) then sigargfirst8 escapeFunction ctx else mempty,
                {-# LINE 150 "haskades_run.cpp.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigargtype,
                {-# LINE 150 "haskades_run.cpp.mustache" #-}
                build " ",
                {-# LINE 150 "haskades_run.cpp.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame
            ]
            where
            sigargfirst8 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                    {-# LINE 150 "haskades_run.cpp.mustache" #-}
                    build ", "
                ]
        sigargs9 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                {-# LINE 154 "haskades_run.cpp.mustache" #-}
                build "\t\ts->",
                {-# LINE 154 "haskades_run.cpp.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
                {-# LINE 154 "haskades_run.cpp.mustache" #-}
                build ".",
                {-# LINE 154 "haskades_run.cpp.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame,
                {-# LINE 154 "haskades_run.cpp.mustache" #-}
                build " = ",
                {-# LINE 154 "haskades_run.cpp.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargfromqt,
                {-# LINE 154 "haskades_run.cpp.mustache" #-}
                build ";\n"
            ]
    toUI10 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
            {-# LINE 176 "haskades_run.cpp.mustache" #-}
            build "\tvoid ",
            {-# LINE 176 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
            {-# LINE 176 "haskades_run.cpp.mustache" #-}
            build "(",
            {-# LINE 176 "haskades_run.cpp.mustache" #-}
            mconcat $ map (sigargs11 escapeFunction) sigargs,
            {-# LINE 176 "haskades_run.cpp.mustache" #-}
            build ");\n"
        ]
        where
        sigargs11 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                {-# LINE 176 "haskades_run.cpp.mustache" #-}
                if mempty == (Any sigargfirst) then sigargfirst12 escapeFunction ctx else mempty,
                {-# LINE 176 "haskades_run.cpp.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigargtype
            ]
            where
            sigargfirst12 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                    {-# LINE 176 "haskades_run.cpp.mustache" #-}
                    build ", "
                ]
    toUItypes13 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [
            {-# LINE 232 "haskades_run.cpp.mustache" #-}
            build ", ",
            {-# LINE 232 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build lowcsigtype,
            {-# LINE 232 "haskades_run.cpp.mustache" #-}
            build " ",
            {-# LINE 232 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename
        ]
    toUItypes14 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [
            {-# LINE 233 "haskades_run.cpp.mustache" #-}
            build ", ",
            {-# LINE 233 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtwrapsig
        ]
    fromUI15 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
            {-# LINE 240 "haskades_run.cpp.mustache" #-}
            build "\t\t\tcase FROMUI_",
            {-# LINE 240 "haskades_run.cpp.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
            {-# LINE 240 "haskades_run.cpp.mustache" #-}
            build ":\n",
            {-# LINE 241 "haskades_run.cpp.mustache" #-}
            mconcat $ map (sigargs16 escapeFunction) sigargs,
            {-# LINE 246 "haskades_run.cpp.mustache" #-}
            build "\t\t\t\tbreak;\n"
        ]
        where
        sigargs16 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                {-# LINE 242 "haskades_run.cpp.mustache" #-}
                if mempty /= sigargdestroy then sigargdestroy17 escapeFunction ctx else mempty
            ]
            where
            sigargdestroy17 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                    {-# LINE 243 "haskades_run.cpp.mustache" #-}
                    build "\t\t\t\t",
                    {-# LINE 243 "haskades_run.cpp.mustache" #-}
                    build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargdestroy,
                    {-# LINE 243 "haskades_run.cpp.mustache" #-}
                    build "(s->",
                    {-# LINE 243 "haskades_run.cpp.mustache" #-}
                    build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
                    {-# LINE 243 "haskades_run.cpp.mustache" #-}
                    build ".",
                    {-# LINE 243 "haskades_run.cpp.mustache" #-}
                    build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame,
                    {-# LINE 243 "haskades_run.cpp.mustache" #-}
                    build ");\n"
                ]

haskades_runh escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [
        {-# LINE 1 "haskades_run.h.mustache" #-}
        build "#ifndef _HASKADES_RUN_H\n#define _HASKADES_RUN_H\n\n",
        {-# LINE 4 "haskades_run.h.mustache" #-}
        mconcat $ map (toUI0 escapeFunction) toUI,
        {-# LINE 7 "haskades_run.h.mustache" #-}
        build "\n",
        {-# LINE 8 "haskades_run.h.mustache" #-}
        mconcat $ map (fromUI1 escapeFunction) fromUI,
        {-# LINE 11 "haskades_run.h.mustache" #-}
        build "\nstruct SignalFromUI ",
        {-# LINE 12 "haskades_run.h.mustache" #-}
        build "{",
        {-# LINE 12 "haskades_run.h.mustache" #-}
        build "\n\tunsigned int tag;\n\tunion ",
        {-# LINE 14 "haskades_run.h.mustache" #-}
        build "{",
        {-# LINE 14 "haskades_run.h.mustache" #-}
        build "\n\t\t",
        {-# LINE 15 "haskades_run.h.mustache" #-}
        mconcat $ map (fromUI2 escapeFunction) fromUI,
        {-# LINE 22 "haskades_run.h.mustache" #-}
        build "\t};\n};\n\n#endif /* _HASKADES_RUN_H */\n"
    ]
    where
    toUI0 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
            {-# LINE 5 "haskades_run.h.mustache" #-}
            build "#define TOUI_",
            {-# LINE 5 "haskades_run.h.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
            {-# LINE 5 "haskades_run.h.mustache" #-}
            build " ",
            {-# LINE 5 "haskades_run.h.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent,
            {-# LINE 5 "haskades_run.h.mustache" #-}
            build "\n"
        ]
    fromUI1 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
            {-# LINE 9 "haskades_run.h.mustache" #-}
            build "#define FROMUI_",
            {-# LINE 9 "haskades_run.h.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
            {-# LINE 9 "haskades_run.h.mustache" #-}
            build " ",
            {-# LINE 9 "haskades_run.h.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent,
            {-# LINE 9 "haskades_run.h.mustache" #-}
            build "\n"
        ]
    fromUI2 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [
            {-# LINE 16 "haskades_run.h.mustache" #-}
            build "\t\tstruct ",
            {-# LINE 16 "haskades_run.h.mustache" #-}
            build "{",
            {-# LINE 16 "haskades_run.h.mustache" #-}
            build "\n\t\t\t",
            {-# LINE 17 "haskades_run.h.mustache" #-}
            mconcat $ map (sigargs3 escapeFunction) sigargs,
            {-# LINE 20 "haskades_run.h.mustache" #-}
            build "\t\t} ",
            {-# LINE 20 "haskades_run.h.mustache" #-}
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
            {-# LINE 20 "haskades_run.h.mustache" #-}
            build ";\n\t\t"
        ]
        where
        sigargs3 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [
                {-# LINE 18 "haskades_run.h.mustache" #-}
                build "\t\t\t",
                {-# LINE 18 "haskades_run.h.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build csigargtype,
                {-# LINE 18 "haskades_run.h.mustache" #-}
                build " ",
                {-# LINE 18 "haskades_run.h.mustache" #-}
                build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame,
                {-# LINE 18 "haskades_run.h.mustache" #-}
                build ";\n\t\t\t"
            ]


</pre></br><h2>printed</h2></br><pre>{-# OPTIONS_GHC -fno-warn-missing-signatures -fno-warn-unused-matches #-}
module MustacheTemplates where

import Data.Monoid
import Data.Text.Buildable (build)
import qualified Data.Text.Lazy as TL
import qualified Data.Text.Lazy.Builder as TL
import Records

haskadesBindinghsc escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [ "{", "-# LANGUAGE ForeignFunctionInterface #-}\n",
        build "{", "-# OPTIONS_GHC -fno-warn-unused-imports #-}\nmodule HaskadesBinding (\n#ifdef USE_SENSORS\n\tAccelerationMode,\n\tAxesOrientationMode,\n\taccelerometerStart,\n#endif\n\thaskadesRun,\n\temit\n) where\n\n#include \"",










        build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build headerPath, "\"\n\nimport Control.Applicative (pure, (<*>))\nimport Control.Monad (when, ap, join, forever)\nimport Control.Monad.IO.Class (MonadIO, liftIO)\nimport Control.Concurrent (forkIO)\nimport System.Exit (exitWith, ExitCode(ExitFailure))\n\nimport Foreign.Storable\nimport Foreign.C.Types\nimport Foreign.C.String\nimport Foreign.Ptr\n\nimport Data.Time.Clock (UTCTime)\nimport Data.Time.Clock.POSIX (posixSecondsToUTCTime, utcTimeToPOSIXSeconds)\nimport qualified Data.Text as Text\nimport qualified Data.Text.Encoding as Text\nimport qualified Data.Text.Lazy as LText\nimport qualified Data.Text.Lazy.Encoding as LText\nimport qualified Data.ByteString as ByteString\n\nimport ",




















        build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build modul, "\n\nforeign import ccall safe \"haskades_run.cpp haskades_run\"\n\tc_haskades_run ::\n\tCString ->\n\t-- ^ QML file to load and render\n\tIO CInt\n\nforeign import ccall unsafe \"haskades_run.cpp emit_ToUIEvent\"\n\tc_emit_ToUIEvent ::\n\tCInt -> ",









        mconcat $ map (toUItypes0 escapeFunction) toUItypes,
        build "\tIO ()\n\nforeign import ccall safe \"haskades_run.cpp pop_SignalFromUI\"\n\tc_pop_SignalFromUI ::\n\tIO (Ptr SignalFromUI)\n\nemit :: (MonadIO m) => SignalToUI -> m ()\n",






        mconcat $ map (toUI1 escapeFunction) toUI,





        build "\npopSignalFromUI :: (MonadIO m) => m SignalFromUI\npopSignalFromUI = liftIO (c_pop_SignalFromUI >>= peekFromUI)\n\npeekFromUI :: Ptr SignalFromUI -> IO SignalFromUI\npeekFromUI ptr = do\n\ttag <- #",





        build "{", "peek struct SignalFromUI, tag} ptr\n\tcase (tag :: CInt) of\n",

        mconcat $ map (fromUI4 escapeFunction) fromUI,




        build "\t\t_ -> error \"Corrupt SignalFromUI in peekFromUI (HaskadesBinding)\"\n\nhaskadesRun :: (MonadIO m) => String -> (SignalFromUI -> IO ()) -> m ()\nhaskadesRun qmlPath handler = liftIO $ do\n\n\t_ <- forkIO (forever $ popSignalFromUI >>= handler)\n\n\tcode <- ByteString.useAsCString (Text.encodeUtf8 $ Text.pack qmlPath) (\\qmlPath ->\n\t\t\tc_haskades_run qmlPath\n\t\t)\n\n\twhen (code /= 0) (exitWith $ ExitFailure $ fromIntegral code)\n\treturn ()\n\n#ifdef USE_SENSORS\ndata AccelerationMode = AccelerationGravity | AccelerationUser | AccelerationCombined deriving (Show, Read, Eq, Enum)\ndata AxesOrientationMode = AxesOrientationFixed | AxesOrientationAutomatic | AxesOrientationUser deriving (Show, Read, Eq, Enum)\n\nforeign import ccall \"wrapper\" _wrap_accelerometerCallback :: (CDouble -> CDouble -> CDouble -> IO CInt) -> IO (FunPtr (CDouble -> CDouble -> CDouble -> IO CInt))\n\nforeign import ccall safe \"haskades_run.cpp accelerometer_start\"\n\tc_accelerometer_start ::\n\tCInt -> CInt -> FunPtr (CDouble -> CDouble -> CDouble -> IO CInt) ->\n\tIO ()\n\nenumToCInt :: (Enum a) => a -> CInt\nenumToCInt = fromIntegral . fromEnum\n\naccelerometerStart :: AccelerationMode -> AxesOrientationMode -> ((Double, Double, Double) -> IO Bool) -> IO ()\naccelerometerStart accelM axesM cb = _wrap_accelerometerCallback cb' >>= c_accelerometer_start (enumToCInt accelM) (enumToCInt axesM)\n\twhere\n\tcb' x y z = fmap enumToCInt $ cb $! (realToFrac $! x, realToFrac $! y, realToFrac $! z)\n#endif\n"
    ]
    where
    toUItypes0 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [ $ escapeFunction $ TL.unpack $ TL.toLazyText $ build csigtype, " -> "
        ]
    toUI1 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [






            build "emit (", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, " ", $ map (sigargs2 escapeFunction) sigargs, ") = liftIO (\n\t\t",
            if mempty /= sigcwrap then sigcwrap3 escapeFunction ctx else mempty,
            build "\t\t(c_emit_ToUIEvent ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent, ")\n\t)\n"
        ]
        where
        sigargs2 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ $ escapeFunction $ TL.unpack $ TL.toLazyText $ build siganame, " "
            ]
        sigcwrap3 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [ "(", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigcwrap,
            ]
    fromUI4 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [










            build "\t\t", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent, " ->\n\t\t\tpure ",
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, $ map (sigargs5 escapeFunction) sigargs,
            build "\n"
        ]
        where
        sigargs5 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ " <*> ((", $ escapeFunction $ TL.unpack,$ TL.toLazyText $ build sigargfromc, ") (#", "{", "peek struct SignalFromUI, "  signame,  siganame,
            ]

haskades_runcpp escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [ "#include <QtDebug>\n#include <QLocale>\n#include <QTranslator>\n\n#include <QQueue>\n#include <QSemaphore>\n#include <QMutex>\n\n#include <bb/cascades/Application>\n#include <bb/cascades/QmlDocument>\n#include <bb/cascades/AbstractPane>\n\n#ifdef USE_SENSORS\n#include <QtSensors/QAccelerometer>\n#endif\n\n#ifdef USE_NOTIFICATIONS\n#include <bb/platform/Notification>\n#include <bb/platform/NotificationDialog>\n#endif\n\n#ifdef USE_INVOCATIONS\n#include <bb/system/InvokeManager>\n#endif\n\n#include \"",
























        build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build headerPath, "\"\n\nQEvent::Type toUIEventType;\n\ntemplate<class T> class ThreadSafeQueue ",



        build "{", "\npublic:\n\tThreadSafeQueue() : semFree(32), semUsed(0), valid(true) ",

        build "{", " }\n\n\tvoid enqueue(const T &value) ",

        build "{", "\n\t\tif(!valid) return;\n\n\t\tsemFree.acquire(1);\n\t\tmutex.lock();\n\t\tqueue.enqueue(value);\n\t\tmutex.unlock();\n\t\tsemUsed.release(1);\n\t}\n\n\tT dequeue() ",









        build "{", "\n\t\tif(!valid) return NULL;\n\n\t\tsemUsed.acquire(1);\n\t\tmutex.lock();\n\t\tT val = queue.dequeue();\n\t\tmutex.unlock();\n\t\tsemFree.release(1);\n\t\treturn val;\n\t}\n\n\tvoid stop() ",










        build "{", "\n\t\t// Stop new calls\n\t\tvalid = false;\n\n\t\t// Make sure there is something to dequeue\n\t\tmutex.lock();\n\t\tqueue.enqueue(NULL);\n\t\tmutex.unlock();\n\n\t\t// Allow waiting dequeue\n\t\tsemUsed.release(32);\n\n\t\t// Allow waiting enqueue\n\t\tsemFree.release(32);\n\t}\n\nprotected:\n\tbool valid;\n\tQQueue<T> queue;\n\tQSemaphore semFree;\n\tQSemaphore semUsed;\n\tQMutex mutex;\n};\n\nThreadSafeQueue<SignalFromUI*> signalFromUIQ;\n\nclass ToUIEvent : public QEvent ",

























        build "{", "\n\npublic:\n\tToUIEvent(int signalEvent",


        mconcat $ map (toUItypes0 escapeFunction) toUItypes, ") : QEvent(toUIEventType) ", "{", "\n\t\tthis->signalEvent = signalEvent;\n",

        mconcat $ map (toUItypes1 escapeFunction) toUItypes,


        build "\t}\n\n\tint signalEvent;\n",


        mconcat $ map (toUItypes2 escapeFunction) toUItypes,


        build "};\n\nclass AppWrapper: public QObject ",

        build "{", "\nQ_OBJECT\n\npublic:\n\t// This is our constructor that sets up the recipe.\n\tAppWrapper(QString qml_path) : qmlPath(qml_path) ",




        build "{", "\n#ifdef USE_INVOCATIONS\n\t\tconnect(&this->invokeManager, SIGNAL(invoked(const bb::system::InvokeRequest&)), this, SLOT(wasInvoked(const bb::system::InvokeRequest&)));\n#endif\n#ifdef USE_NOTIFICATIONS\n\t\tqmlRegisterType<bb::platform::Notification>(\"bb.platform\", 1, 0, \"Notification\");\n\t\tqmlRegisterType<bb::platform::NotificationDialog>(\"bb.platform\", 1, 0, \"NotificationDialog\");\n#endif\n\t}\n\n\tvirtual void ready() ",









        build "{", "\n\t\t// Obtain a QMLDocument and load it into the qml variable, using build patterns.\n\t\tbb::cascades::QmlDocument *qml = bb::cascades::QmlDocument::create(this->qmlPath);\n\n\t\t// If the QML document is valid, we process it.\n\t\tif(!qml->hasErrors()) ",




        build "{", "\n\t\t\tqml->setContextProperty(\"app\", this);\n\n\t\t\t// Create the application root from QMLDocument\n\t\t\tbb::cascades::AbstractPane *appPage = qml->createRootObject<bb::cascades::AbstractPane>();\n\n\t\t\tif (appPage) ",





        build "{", "\n\t\t\t\t// Set the main scene for the application to the Page.\n\t\t\t\tbb::cascades::Application::instance()->setScene(appPage);\n\t\t\t}\n\t\t} else ",



        build "{", "\n\t\t\tqCritical() << qml->errors();\n\t\t}\n\t}\n\n\tvirtual bool event(QEvent *e) ",




        build "{", "\n\t\tif(e->type() == toUIEventType) ",
        build "{", "\n\t\t\tToUIEvent *ev = (ToUIEvent*)e;\n\t\t\tswitch(ev->signalEvent) ",

        build "{", "\n",
        mconcat $ map (toUI3 escapeFunction) toUI,





        build "\t\t\t}\n\t\t\treturn false;\n\t\t} else ",

        build "{", "\n\t\t\treturn QObject::event(e);\n\t\t}\n\t}\n\n",




        mconcat $ map (fromUI6 escapeFunction) fromUI,









        build "\n#ifdef USE_NOTIFICATIONS\n#ifdef USE_INVOCATIONS\n\tQ_INVOKABLE void addInvokeRequestToNotification(bb::platform::Notification *  notification, QString target, QString action, QString mimeType, QString uri,     QString data) ",


        build "{", "\n\t\tbb::system::InvokeRequest invokeRequest;\n\t\tinvokeRequest.setTarget(target);\n\t\tinvokeRequest.setAction(action);\n\t\tinvokeRequest.setMimeType(mimeType);\n\t\tinvokeRequest.setUri(uri);\n\t\tinvokeRequest.setData(data.toUtf8());\n\t\tnotification->setInvokeRequest(invokeRequest);\n\t}\n#endif\n#endif\n\nsignals:\n",












        mconcat $ map (toUI10 escapeFunction) toUI,


        build "\n#ifdef USE_INVOCATIONS\n\tvoid invoked(QString, QString, QString, QString, QString);\n\nprotected slots:\n\tvoid wasInvoked(const bb::system::InvokeRequest &req) ",




        build "{", "\n\t\temit invoked(req.target(), req.action(), req.mimeType(), req.uri().toString(), QString::fromUtf8(req.data()));\n\t}\n#endif\n\nprotected:\n\tQString qmlPath;\n#ifdef USE_INVOCATIONS\n\tbb::system::InvokeManager invokeManager;\n#endif\n};\n\n#ifdef USE_SENSORS\nclass AccelerometerHandler : public QObject ",












        build "{", "\nQ_OBJECT\n\npublic:\n\tAccelerometerHandler(QtMobility::QAccelerometer::AccelerationMode accelM, QtMobility::QAccelerometer::AxesOrientationMode axesM, int (*cb)(double, double, double)) : _cb(cb) ",



        build "{", "\n\t\t_accel.setAccelerationMode(accelM);\n\t\t_accel.setAxesOrientationMode(axesM);\n\n\t\tconnect(&_accel, SIGNAL(readingChanged()), SLOT(callback()));\n\n\t\tif(!_accel.connectToBackend()) ",





        build "{", "\n\t\t\tqCritical() << \"CONNECT TO ACCELEROMETER BACKEND FAILED!\";\n\t\t} else if(!_accel.start()) ",

        build "{", "\n\t\t\tqCritical() << \"ACCELEROMETER START FAILED!\";\n\t\t}\n\t}\n\npublic slots:\n\tvoid callback() ",





        build "{", "\n\t\tQtMobility::QAccelerometerReading *r = _accel.reading();\n\t\tif(!_cb((double)r->x(), (double)r->y(), (double)r->z())) ",

        build "{", "\n\t\t\t_accel.stop();\n\t\t\tdelete this;\n\t\t}\n\t}\n\nprotected:\n\tQtMobility::QAccelerometer _accel;\n\tint (*_cb)(double, double, double);\n};\n#endif\n\nextern \"C\" ",











        build "{", "\n\nQObject *mainAppGlobal;\n\nQ_DECL_EXPORT void emit_ToUIEvent(int signalEvent",



        mconcat $ map (toUItypes13 escapeFunction) toUItypes, ") ", "{", "\n\tQEvent *e = (QEvent *)new ToUIEvent(signalEvent",
        mconcat $ map (toUItypes14 escapeFunction) toUItypes, ");\n\tQCoreApplication::postEvent(mainAppGlobal, e);\n}\n\nvoid destroySignalFromUI(SignalFromUI *s) ",



        build "{", "\n\tswitch(s->tag) ",
        build "{", "\n",
        mconcat $ map (fromUI15 escapeFunction) fromUI,








        build "\t}\n\n\tfree(s);\n}\n\nSignalFromUI *lastFromUI = NULL;\n\nQ_DECL_EXPORT SignalFromUI *pop_SignalFromUI(void) ",






        build "{", "\n\tif(lastFromUI) destroySignalFromUI(lastFromUI);\n\tlastFromUI = signalFromUIQ.dequeue();\n\treturn lastFromUI;\n}\n\nQ_DECL_EXPORT int haskades_run(char *qml_path) ",





        build "{", "\n\tint argc = 0;\n\tchar *argv[] = ",

        build "{", " NULL };\n\t// Instantiate the main application constructor.\n\tbb::cascades::Application app(argc, argv);\n\n\t// Set up the translator.\n\tQTranslator translator;\n\tQString locale_string = QLocale().name();\n\tQString filename = QString(\"sample_%1\").arg(locale_string); // TODO\n\tif (translator.load(filename, \"app/native/qm\")) ",







        build "{", "\n\t\tapp.installTranslator(&translator);\n\t}\n\n\ttoUIEventType = (QEvent::Type)QEvent::registerEventType();\n\n\t// Initialize our application.\n\tAppWrapper mainApp(QString::fromUtf8(qml_path));\n\tmainAppGlobal = (QObject*)&mainApp;\n\tmainApp.ready();\n\n\t// We complete the transaction started in the main application constructor and start the\n\t// client event loop here. When loop is exited the Application deletes the scene which\n\t// deletes all its children.\n\tint status = bb::cascades::Application::exec();\n\tsignalFromUIQ.stop();\n\treturn status;\n}\n\n#ifdef USE_SENSORS\nvoid accelerometer_start(int accelM, int axesM, int (*cb)(double, double, double)) ",



















        build "{", "\n\tQtMobility::QAccelerometer::AccelerationMode _accelM;\n\tQtMobility::QAccelerometer::AxesOrientationMode _axesM;\n\n\tswitch(accelM) ",



        build "{", "\n\t\tcase 0:\n\t\t\t_accelM = QtMobility::QAccelerometer::Gravity;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t_accelM = QtMobility::QAccelerometer::User;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t_accelM = QtMobility::QAccelerometer::Combined;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tqWarning() << \"Unknown AccelerationMode, defaulting to Combined\";\n\t\t\t_accelM = QtMobility::QAccelerometer::Combined;\n\t}\n\n\tswitch(axesM) ",














        build "{", "\n\t\tcase 0:\n\t\t\t_axesM = QtMobility::QAccelerometer::FixedOrientation;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t_axesM = QtMobility::QAccelerometer::AutomaticOrientation;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t_axesM = QtMobility::QAccelerometer::UserOrientation;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tqWarning() << \"Unknown AxesOrientationMode, defaulting to Automatic\";\n\t\t\t_axesM = QtMobility::QAccelerometer::AutomaticOrientation;\n\t}\n\n\tnew AccelerometerHandler(_accelM, _axesM, cb);\n}\n#endif\n\n}\n\n// Tell MOC to run on this file\n#include \"haskades_run.moc\"\n"
    ]
    where
    toUItypes0 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [ ", ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigtype, " ",  sigtypename
        ]
    toUItypes1 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [
            build "\t\tthis->", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigtypename, " = ",
        ]
    toUItypes2 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [



            build "\t", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigtype, " ",  sigtypename, ";\n"
        ]
    toUI3 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [









































            build "\t\t\t\tcase TOUI_", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame,
            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, "(", $ map (sigargs4 escapeFunction) sigargs, ");\n\t\t\t\t\treturn true;\n\t\t\t\t\tbreak;\n"
        ]
        where
        sigargs4 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ mempty == (Any sigargfirst) then sigargfirst5 escapeFunction ctx else mempty, "ev->", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargsigtypename
            ]
            where
            sigargfirst5 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ ", "
                ]
    fromUI6 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [









            build "\tQ_INVOKABLE void ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, "(", $ map (sigargs7 escapeFunction) sigargs, ") ", "\n\t\tSignalFromUI *s = new SignalFromUI;\n\t\ts->tag = ",

            build $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigevent, ";\n",
            mconcat $ map (sigargs9 escapeFunction) sigargs,


            build "\t\tsignalFromUIQ.enqueue(s);\n\t}\n"
        ]
        where
        sigargs7 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ mempty == (Any sigargfirst) then sigargfirst8 escapeFunction ctx else mempty, $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigargtype, " ",  siganame
            ]
            where
            sigargfirst8 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ ", "
                ]
        sigargs9 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [

                build "\t\ts->", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, ".",  siganame, " = ",  sigargfromqt,
            ]
    toUI10 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [



















            build "\tvoid ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, "(", $ map (sigargs11 escapeFunction) sigargs, ");\n"
        ]
        where
        sigargs11 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ mempty == (Any sigargfirst) then sigargfirst12 escapeFunction ctx else mempty, $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtsigargtype
            ]
            where
            sigargfirst12 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ ", "
                ]
    toUItypes13 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [





















































            build ", ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build lowcsigtype, " ",
        ]
    toUItypes14 escapeFunction ctx@(SignalType {csigtype=csigtype, qtsigtype=qtsigtype, qtwrapsig=qtwrapsig, lowcsigtype=lowcsigtype, sigtypename=sigtypename}) = mconcat [ ", ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build qtwrapsig
        ]
    fromUI15 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [




            build "\t\t\tcase FROMUI_", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, ":\n",
            mconcat $ map (sigargs16 escapeFunction) sigargs,




            build "\t\t\t\tbreak;\n"
        ]
        where
        sigargs16 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ mempty /= sigargdestroy then sigargdestroy17 escapeFunction ctx else mempty
            ]
            where
            sigargdestroy17 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ "\t\t\t\t", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build sigargdestroy, "(s->",  signame, ".",  siganame,
                ]

haskades_runh escapeFunction ctx@(Template {headerPath=headerPath, modul=modul, toUItypes=toUItypes, toUI=toUI, fromUI=fromUI}) = mconcat [ "#ifndef _HASKADES_RUN_H\n#define _HASKADES_RUN_H\n\n",


        mconcat $ map (toUI0 escapeFunction) toUI,


        build "\n",
        mconcat $ map (fromUI1 escapeFunction) fromUI,


        build "\nstruct SignalFromUI ",
        build "{", "\n\tunsigned int tag;\n\tunion ",

        build "{", "\n\t\t",
        mconcat $ map (fromUI2 escapeFunction) fromUI,






        build "\t};\n};\n\n#endif /* _HASKADES_RUN_H */\n"
    ]
    where
    toUI0 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [ "#define TOUI_", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, " ",  sigevent, "\n"
        ]
    fromUI1 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [

            build "#define FROMUI_", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, " ",  sigevent, "\n"
        ]
    fromUI2 escapeFunction ctx@(Signal {sigfirst=sigfirst, signame=signame, sigargs=sigargs, sigevent=sigevent, sigcwrap=sigcwrap}) = mconcat [




            build "\t\tstruct ", "{", "\n\t\t\t",
            mconcat $ map (sigargs3 escapeFunction) sigargs,


            build "\t\t} ", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build signame, ";\n\t\t"
        ]
        where
        sigargs3 escapeFunction ctx@(SignalArg {sigargfirst=sigargfirst, siganame=siganame, qtsigargtype=qtsigargtype, csigargtype=csigargtype, sigargfromc=sigargfromc, sigargfromqt=sigargfromqt, sigargdestroy=sigargdestroy, sigargsigtypename=sigargsigtypename}) = mconcat [ "\t\t\t", $ escapeFunction $ TL.unpack $ TL.toLazyText $ build csigargtype, " ",  siganame, ";\n\t\t\t"
            ]



</pre>