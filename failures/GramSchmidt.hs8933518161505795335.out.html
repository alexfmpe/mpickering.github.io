<a href="GramSchmidt.hs14587779232007237709.out.html">prev</a></br><a href="failures.html">home</a></br><a href="GUI.hs585640194937186357.out.html">next</a></br></br><pre>8c8
< module Data.Vect.Flt.GramSchmidt
---
> module Data.Vect.Float.GramSchmidtData.Vect.Flt.GramSchmidt
13c13
< import Data.Vect.Flt.Base
---
> import Data.Vect.Float.BaseData.Vect.Flt.Base
39c39
< 
---
> --------------------------------------------------------------------------------
41c41
<   gramSchmidt = gramSchmidtPair
---
> instancegramSchmidt= gramSchmidtPairVec2,Vec2) where
41a42
>   gramSchmidtgramSchmidtNormalize= gramSchmidtPair= gramSchmidtNormalizePair
43d43
< 
45c45
<   gramSchmidt = gramSchmidtPair
---
> instancegramSchmidt= gramSchmidtPairVec3,Vec3) where
45a46
>   gramSchmidtgramSchmidtNormalize= gramSchmidtPair= gramSchmidtNormalizePair
47d47
< 
49c49
<   gramSchmidt = gramSchmidtPair
---
> instancegramSchmidt= gramSchmidtPairVec4,Vec4) where
49a50
>   gramSchmidtgramSchmidtNormalize= gramSchmidtPair= gramSchmidtNormalizePair
51d51
< 
53c53
< 
---
> ----------
55c55
<   gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal2!"
---
> instancegramSchmidt (Normal2= error,Normal2"use 'gramSchmidtNormalize' for Normal2!") where
55a56
>   gramSchmidtgramSchmidtNormalize = errorliftPairtoNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal
57d57
< 
59c59
<   gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal3!"
---
> instancegramSchmidt (Normal3= error,Normal3"use 'gramSchmidtNormalize' for Normal3!") where
59a60
>   gramSchmidtgramSchmidtNormalize = errorliftPairtoNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal
61d61
< 
63c63
<   gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal4!"
---
> instancegramSchmidt (Normal4= error,Normal4"use 'gramSchmidtNormalize' for Normal4!") where
63a64
>   gramSchmidtgramSchmidtNormalize = errorliftPairtoNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal
65d65
< 
67c67
< 
---
> ----------
69d68
< gramSchmidtPair (u,v) = (u',v') where
70c69
<   u' = u
---
> gramSchmidtPair ::(u,(Vector) = (u'v,v'DotProd) where v) => (v,v) -> (v,v)
70a70
> gramSchmidtPairu' = u        (u,v) = (u',v') where
70a71
>   u' = uproject v u'
72d72
< 
74d73
< gramSchmidtNormalizePair (u,v) = (u',v') where
75c74
<   u' = normalize u
---
> gramSchmidtNormalizePair ::(u,(Vector) = (u'v,v'DotProd) where v) => (v,v) -> (v,v)
75a75
> gramSchmidtNormalizePairu' = normalize u       (u,v) = (u',v') where
75a76
>   u' = normalize u projectUnsafe v u'
77d77
< 
79c79
< 
---
> ----------
81c81
<   gramSchmidt = gramSchmidtTriple
---
> instancegramSchmidt= gramSchmidtTripleVec3,Vec3,Vec3) where
81a82
>   gramSchmidtgramSchmidtNormalize= gramSchmidtTriple= gramSchmidtNormalizeTriple
83d83
< 
85c85
<   gramSchmidt = gramSchmidtTriple
---
> instancegramSchmidt= gramSchmidtTripleVec4,Vec4,Vec4) where
85a86
>   gramSchmidtgramSchmidtNormalize= gramSchmidtTriple= gramSchmidtNormalizeTriple
87d87
< 
89c89
<   gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal3!"
---
> instancegramSchmidt (Normal3= error,Normal3"use 'gramSchmidtNormalize' for Normal3!",Normal3) where
89a90
>   gramSchmidtgramSchmidtNormalize = errorliftTripletoNormalUnsafe . gramSchmidtNormalizeTriple . liftTriple fromNormal
91d91
< 
93c93
<   gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal4!"
---
> instancegramSchmidt (Normal4= error,Normal4"use 'gramSchmidtNormalize' for Normal4!",Normal4) where
93a94
>   gramSchmidtgramSchmidtNormalize = errorliftTripletoNormalUnsafe . gramSchmidtNormalizeTriple . liftTriple fromNormal
95d95
< 
97c97
< 
---
> ----------
99d98
< gramSchmidtTriple (u,v,w) = (u',v',w') where
100d98
<   u' = u
101c99
<   v' = project v u'
---
> gramSchmidtTriple ::(u,(Vector,w) = (vu',,DotProdv',w') where) => (v,v,v) -> (v,v,v)
101a100
> gramSchmidtTripleu' = u          (u,v,w) = (u',v',w') where
101a101
>   u' = uproject v u'
101a102
>   v' = project vproject     w u') v'
103d103
< 
105d104
< gramSchmidtNormalizeTriple (u,v,w) = (u',v',w') where
106d104
<   u' = normalize $ u
107c105
<   v' = normalize $ projectUnsafe v u'
---
> gramSchmidtNormalizeTriple ::(u,(Vector,w) = (vu',,DotProdv',w') where) => (v,v,v) -> (v,v,v)
107a106
> gramSchmidtNormalizeTripleu' = normalize $ u       (u,v,w) = (u',v',w') where
107a107
>   u' = normalize $ uprojectUnsafe v u'
107a108
>   v' = normalize $ projectUnsafe vprojectUnsafe           w u') v'
109d109
< 
111c111
< 
---
> ----------
113c113
<   gramSchmidt          = gramSchmidtQuadruple
---
> instancegramSchmidt (Vec4= gramSchmidtQuadruple,Vec4,Vec4,Vec4) where
113a114
>   gramSchmidtgramSchmidtNormalize = gramSchmidtQuadruplegramSchmidtNormalizeQuadruple
115d115
< 
117c117
<   gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal4!"
---
> instancegramSchmidt (Normal4= error,Normal4"use 'gramSchmidtNormalize' for Normal4!",Normal4,Normal4) where
117a118
>   gramSchmidtgramSchmidtNormalize = errorliftQuadrupletoNormalUnsafe . gramSchmidtNormalizeQuadruple . liftQuadruple fromNormal
119d119
< 
121c121
< 
---
> ----------
123d122
< gramSchmidtQuadruple (u,v,w,z) = (u',v',w',z') where
124d122
<   u' = u
125d122
<   v' = project v u'
126c123
<   w' = project (project w u') v'
---
> gramSchmidtQuadruple ::(u,(Vector,w,z) =v,u',v',w',vz'))=>wherev,v,v,v) -> (v,v,v,v)
126a124
> gramSchmidtQuadrupleu' = u             (u,v,w,z) = (u',v',w',z') where
126a125
>   u' = uproject v u'
126a126
>   v' = project vproject     w u') v'
126a127
>   w' = project (project wproject) v' z u') v') w'
128d128
< 
130d129
< gramSchmidtNormalizeQuadruple (u,v,w,z) = (u',v',w',z') where
131d129
<   u' = normalize $ u
132d129
<   v' = normalize $ projectUnsafe v u'
133c130
<   w' = normalize $ projectUnsafe (projectUnsafe w u') v'
---
> gramSchmidtNormalizeQuadruple ::(u,(Vector,w,z) =v,u',v',w',vz'))=>wherev,v,v,v) -> (v,v,v,v)
133a131
> gramSchmidtNormalizeQuadrupleu' = normalize $ u          (u,v,w,z) = (u',v',w',z') where
133a132
>   u' = normalize $ uprojectUnsafe v u'
133a133
>   v' = normalize $ projectUnsafe vprojectUnsafe           w u') v'
133a134
>   w' = normalize $ projectUnsafe (projectUnsafe wprojectUnsafe) v'       z u') v') w'
135d135
< 
136a137
> ----------
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE CPP #-}
#define Flt Float
#define VECT_Float

-- | Gram-Schmidt orthogonalization.
-- This module is not re-exported by "Data.Vect".

module Data.Vect.Flt.GramSchmidt
  ( GramSchmidt(..)
  )
  where

import Data.Vect.Flt.Base

--------------------------------------------------------------------------------

liftPair :: (a -> b) -> (a,a) -> (b,b)
liftPair f (x,y) = (f x, f y)

liftTriple :: (a -> b) -> (a,a,a) -> (b,b,b)
liftTriple f (x,y,z) = (f x, f y, f z)

liftQuadruple :: (a -> b) -> (a,a,a,a) -> (b,b,b,b)
liftQuadruple f (x,y,z,w) = (f x, f y, f z, f w)

--------------------------------------------------------------------------------

-- | produces orthogonal\/orthonormal vectors from a set of vectors
class GramSchmidt a where
  gramSchmidt          :: a -> a   -- ^ does not normalize the vectors!
  gramSchmidtNormalize :: a -> a   -- ^ normalizes the vectors.

{-# RULES
"gramSchmidt is idempotent"  forall a. gramSchmidt (gramSchmidt a) = gramSchmidt a
"gramSchmidtNormalize is idempotent"  forall a. gramSchmidtNormalize (gramSchmidtNormalize a) = gramSchmidtNormalize a
  #-}

--------------------------------------------------------------------------------

instance GramSchmidt (Vec2,Vec2) where
  gramSchmidt = gramSchmidtPair
  gramSchmidtNormalize = gramSchmidtNormalizePair

instance GramSchmidt (Vec3,Vec3) where
  gramSchmidt = gramSchmidtPair
  gramSchmidtNormalize = gramSchmidtNormalizePair

instance GramSchmidt (Vec4,Vec4) where
  gramSchmidt = gramSchmidtPair
  gramSchmidtNormalize = gramSchmidtNormalizePair

----------

instance GramSchmidt (Normal2,Normal2) where
  gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal2!"
  gramSchmidtNormalize = liftPair toNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal

instance GramSchmidt (Normal3,Normal3) where
  gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal3!"
  gramSchmidtNormalize = liftPair toNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal

instance GramSchmidt (Normal4,Normal4) where
  gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal4!"
  gramSchmidtNormalize = liftPair toNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal

----------

gramSchmidtPair :: (Vector v, DotProd v) => (v,v) -> (v,v)
gramSchmidtPair (u,v) = (u',v') where
  u' = u
  v' = project v u'

gramSchmidtNormalizePair :: (Vector v, DotProd v) => (v,v) -> (v,v)
gramSchmidtNormalizePair (u,v) = (u',v') where
  u' = normalize u
  v' = normalize $ projectUnsafe v u'

----------

instance GramSchmidt (Vec3,Vec3,Vec3) where
  gramSchmidt = gramSchmidtTriple
  gramSchmidtNormalize = gramSchmidtNormalizeTriple

instance GramSchmidt (Vec4,Vec4,Vec4) where
  gramSchmidt = gramSchmidtTriple
  gramSchmidtNormalize = gramSchmidtNormalizeTriple

instance GramSchmidt (Normal3,Normal3,Normal3) where
  gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal3!"
  gramSchmidtNormalize = liftTriple toNormalUnsafe . gramSchmidtNormalizeTriple . liftTriple fromNormal

instance GramSchmidt (Normal4,Normal4,Normal4) where
  gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal4!"
  gramSchmidtNormalize = liftTriple toNormalUnsafe . gramSchmidtNormalizeTriple . liftTriple fromNormal

----------

gramSchmidtTriple :: (Vector v, DotProd v) => (v,v,v) -> (v,v,v)
gramSchmidtTriple (u,v,w) = (u',v',w') where
  u' = u
  v' = project v u'
  w' = project (project w u') v'

gramSchmidtNormalizeTriple :: (Vector v, DotProd v) => (v,v,v) -> (v,v,v)
gramSchmidtNormalizeTriple (u,v,w) = (u',v',w') where
  u' = normalize $ u
  v' = normalize $ projectUnsafe v u'
  w' = normalize $ projectUnsafe (projectUnsafe w u') v'

----------

instance GramSchmidt (Vec4,Vec4,Vec4,Vec4) where
  gramSchmidt          = gramSchmidtQuadruple
  gramSchmidtNormalize = gramSchmidtNormalizeQuadruple

instance GramSchmidt (Normal4,Normal4,Normal4,Normal4) where
  gramSchmidt          = error "use 'gramSchmidtNormalize' for Normal4!"
  gramSchmidtNormalize = liftQuadruple toNormalUnsafe . gramSchmidtNormalizeQuadruple . liftQuadruple fromNormal

----------

gramSchmidtQuadruple :: (Vector v, DotProd v) => (v,v,v,v) -> (v,v,v,v)
gramSchmidtQuadruple (u,v,w,z) = (u',v',w',z') where
  u' = u
  v' = project v u'
  w' = project (project w u') v'
  z' = project (project (project z u') v') w'

gramSchmidtNormalizeQuadruple :: (Vector v, DotProd v) => (v,v,v,v) -> (v,v,v,v)
gramSchmidtNormalizeQuadruple (u,v,w,z) = (u',v',w',z') where
  u' = normalize $ u
  v' = normalize $ projectUnsafe v u'
  w' = normalize $ projectUnsafe (projectUnsafe w u') v'
  z' = normalize $ projectUnsafe (projectUnsafe (projectUnsafe z u') v') w'

----------

</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE CPP #-}
#define Flt Float
#define VECT_Float

-- | Gram-Schmidt orthogonalization.
-- This module is not re-exported by "Data.Vect".

module Data.Vect.Float.GramSchmidtData.Vect.Flt.GramSchmidt
  ( GramSchmidt(..)
  )
  where

import Data.Vect.Float.BaseData.Vect.Flt.Base

--------------------------------------------------------------------------------

liftPair :: (a -> b) -> (a,a) -> (b,b)
liftPair f (x,y) = (f x, f y)

liftTriple :: (a -> b) -> (a,a,a) -> (b,b,b)
liftTriple f (x,y,z) = (f x, f y, f z)

liftQuadruple :: (a -> b) -> (a,a,a,a) -> (b,b,b,b)
liftQuadruple f (x,y,z,w) = (f x, f y, f z, f w)

--------------------------------------------------------------------------------

-- | produces orthogonal\/orthonormal vectors from a set of vectors
class GramSchmidt a where
  gramSchmidt          :: a -> a   -- ^ does not normalize the vectors!
  gramSchmidtNormalize :: a -> a   -- ^ normalizes the vectors.

{-# RULES
"gramSchmidt is idempotent"  forall a. gramSchmidt (gramSchmidt a) = gramSchmidt a
"gramSchmidtNormalize is idempotent"  forall a. gramSchmidtNormalize (gramSchmidtNormalize a) = gramSchmidtNormalize a
  #-}

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
instance GramSchmidt (Vec2,Vec2) where
instancegramSchmidt= gramSchmidtPairVec2,Vec2) where
  gramSchmidtgramSchmidtNormalize= gramSchmidtPair= gramSchmidtNormalizePair
  gramSchmidtNormalize = gramSchmidtNormalizePair
instance GramSchmidt (Vec3,Vec3) where
instancegramSchmidt= gramSchmidtPairVec3,Vec3) where
  gramSchmidtgramSchmidtNormalize= gramSchmidtPair= gramSchmidtNormalizePair
  gramSchmidtNormalize = gramSchmidtNormalizePair
instance GramSchmidt (Vec4,Vec4) where
instancegramSchmidt= gramSchmidtPairVec4,Vec4) where
  gramSchmidtgramSchmidtNormalize= gramSchmidtPair= gramSchmidtNormalizePair
  gramSchmidtNormalize = gramSchmidtNormalizePair
----------
----------
instance GramSchmidt (Normal2,Normal2) where
instancegramSchmidt (Normal2= error,Normal2"use 'gramSchmidtNormalize' for Normal2!") where
  gramSchmidtgramSchmidtNormalize = errorliftPairtoNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal
  gramSchmidtNormalize = liftPair toNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal
instance GramSchmidt (Normal3,Normal3) where
instancegramSchmidt (Normal3= error,Normal3"use 'gramSchmidtNormalize' for Normal3!") where
  gramSchmidtgramSchmidtNormalize = errorliftPairtoNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal
  gramSchmidtNormalize = liftPair toNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal
instance GramSchmidt (Normal4,Normal4) where
instancegramSchmidt (Normal4= error,Normal4"use 'gramSchmidtNormalize' for Normal4!") where
  gramSchmidtgramSchmidtNormalize = errorliftPairtoNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal
  gramSchmidtNormalize = liftPair toNormalUnsafe . gramSchmidtNormalizePair . liftPair fromNormal
----------
----------
gramSchmidtPair :: (Vector v, DotProd v) => (v,v) -> (v,v)
gramSchmidtPair ::(u,(Vector) = (u'v,v'DotProd) where v) => (v,v) -> (v,v)
gramSchmidtPairu' = u        (u,v) = (u',v') where
  u' = uproject v u'
  v' = project v u'
gramSchmidtNormalizePair :: (Vector v, DotProd v) => (v,v) -> (v,v)
gramSchmidtNormalizePair ::(u,(Vector) = (u'v,v'DotProd) where v) => (v,v) -> (v,v)
gramSchmidtNormalizePairu' = normalize u       (u,v) = (u',v') where
  u' = normalize u projectUnsafe v u'
  v' = normalize $ projectUnsafe v u'
----------
----------
instance GramSchmidt (Vec3,Vec3,Vec3) where
instancegramSchmidt= gramSchmidtTripleVec3,Vec3,Vec3) where
  gramSchmidtgramSchmidtNormalize= gramSchmidtTriple= gramSchmidtNormalizeTriple
  gramSchmidtNormalize = gramSchmidtNormalizeTriple
instance GramSchmidt (Vec4,Vec4,Vec4) where
instancegramSchmidt= gramSchmidtTripleVec4,Vec4,Vec4) where
  gramSchmidtgramSchmidtNormalize= gramSchmidtTriple= gramSchmidtNormalizeTriple
  gramSchmidtNormalize = gramSchmidtNormalizeTriple
instance GramSchmidt (Normal3,Normal3,Normal3) where
instancegramSchmidt (Normal3= error,Normal3"use 'gramSchmidtNormalize' for Normal3!",Normal3) where
  gramSchmidtgramSchmidtNormalize = errorliftTripletoNormalUnsafe . gramSchmidtNormalizeTriple . liftTriple fromNormal
  gramSchmidtNormalize = liftTriple toNormalUnsafe . gramSchmidtNormalizeTriple . liftTriple fromNormal
instance GramSchmidt (Normal4,Normal4,Normal4) where
instancegramSchmidt (Normal4= error,Normal4"use 'gramSchmidtNormalize' for Normal4!",Normal4) where
  gramSchmidtgramSchmidtNormalize = errorliftTripletoNormalUnsafe . gramSchmidtNormalizeTriple . liftTriple fromNormal
  gramSchmidtNormalize = liftTriple toNormalUnsafe . gramSchmidtNormalizeTriple . liftTriple fromNormal
----------
----------
gramSchmidtTriple :: (Vector v, DotProd v) => (v,v,v) -> (v,v,v)
gramSchmidtTriple ::(u,(Vector,w) = (vu',,DotProdv',w') where) => (v,v,v) -> (v,v,v)
gramSchmidtTripleu' = u          (u,v,w) = (u',v',w') where
  u' = uproject v u'
  v' = project vproject     w u') v'
  w' = project (project w u') v'
gramSchmidtNormalizeTriple :: (Vector v, DotProd v) => (v,v,v) -> (v,v,v)
gramSchmidtNormalizeTriple ::(u,(Vector,w) = (vu',,DotProdv',w') where) => (v,v,v) -> (v,v,v)
gramSchmidtNormalizeTripleu' = normalize $ u       (u,v,w) = (u',v',w') where
  u' = normalize $ uprojectUnsafe v u'
  v' = normalize $ projectUnsafe vprojectUnsafe           w u') v'
  w' = normalize $ projectUnsafe (projectUnsafe w u') v'
----------
----------
instance GramSchmidt (Vec4,Vec4,Vec4,Vec4) where
instancegramSchmidt (Vec4= gramSchmidtQuadruple,Vec4,Vec4,Vec4) where
  gramSchmidtgramSchmidtNormalize = gramSchmidtQuadruplegramSchmidtNormalizeQuadruple
  gramSchmidtNormalize = gramSchmidtNormalizeQuadruple
instance GramSchmidt (Normal4,Normal4,Normal4,Normal4) where
instancegramSchmidt (Normal4= error,Normal4"use 'gramSchmidtNormalize' for Normal4!",Normal4,Normal4) where
  gramSchmidtgramSchmidtNormalize = errorliftQuadrupletoNormalUnsafe . gramSchmidtNormalizeQuadruple . liftQuadruple fromNormal
  gramSchmidtNormalize = liftQuadruple toNormalUnsafe . gramSchmidtNormalizeQuadruple . liftQuadruple fromNormal
----------
----------
gramSchmidtQuadruple :: (Vector v, DotProd v) => (v,v,v,v) -> (v,v,v,v)
gramSchmidtQuadruple ::(u,(Vector,w,z) =v,u',v',w',vz'))=>wherev,v,v,v) -> (v,v,v,v)
gramSchmidtQuadrupleu' = u             (u,v,w,z) = (u',v',w',z') where
  u' = uproject v u'
  v' = project vproject     w u') v'
  w' = project (project wproject) v' z u') v') w'
  z' = project (project (project z u') v') w'
gramSchmidtNormalizeQuadruple :: (Vector v, DotProd v) => (v,v,v,v) -> (v,v,v,v)
gramSchmidtNormalizeQuadruple ::(u,(Vector,w,z) =v,u',v',w',vz'))=>wherev,v,v,v) -> (v,v,v,v)
gramSchmidtNormalizeQuadrupleu' = normalize $ u          (u,v,w,z) = (u',v',w',z') where
  u' = normalize $ uprojectUnsafe v u'
  v' = normalize $ projectUnsafe vprojectUnsafe           w u') v'
  w' = normalize $ projectUnsafe (projectUnsafe wprojectUnsafe) v'       z u') v') w'
  z' = normalize $ projectUnsafe (projectUnsafe (projectUnsafe z u') v') w'
----------
----------

</pre>