<a href="Socket.hs1010275441457850878.out.html">prev</a></br><a href="failures.html">home</a></br><a href="Solver.hs10447881241927702196.out.html">next</a></br></br><pre>17d16
< playSodium ∷ Display -- ^ The display method
18d16
<            → Color   -- ^ The background colour
19d16
<            → Int     -- ^ The refresh rate, in Hertz
20d16
<            → (  Event Float
21d16
<               → Event InputEvent
22c17
<               → Reactive (Behavior Picture))
---
> playSodium :: Display -- ^ The display method
22a18
>            -> Color   -- ^ The background colour
22a19
>            -> Int     -- ^ The refresh rate, in Hertz
22a20
>            -> (  Event Float
22a21
>               -> Event InputEvent
22a22
>               -> Reactive (Behavior Picture))
27c27
<            → IO ()
---
>            -> IO ()
29d28
<   (unreg, bPicture, pushTick, pushInput) ← sync $ do
30d28
<     (eTick,  pushTick ) ← newEvent
31d28
<     (eInput, pushInput) ← newEvent
32c29
<     bPicture ← mPicture eTick eInput
---
>   (unreg, bPicture, pushTick, pushInput) <- sync $ do
32a30
>     (eTick,  pushTick ) <- newEvent
32a31
>     (eInput, pushInput) <- newEvent
32a32
>     bPicture <- mPicture eTick eInput
35c35
<     unreg ← listen (value bPicture) . const $ return ()
---
>     unreg <- listen (value bPicture) . const $ return ()
40d39
<     (\      _ →        sync $ sample bPicture)
41d39
<     (\ ev   _ → void . sync $ pushInput ev   )
42c40
<     (\ time _ → void . sync $ pushTick time  )
---
>     (\      _ ->        sync $ sample bPicture)
42a41
>     (\ ev   _ -> void . sync $ pushInput ev   )
42a42
>     (\ time _ -> void . sync $ pushTick time  )
44a45
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE UnicodeSyntax, Rank2Types #-}

module Graphics.Gloss.Interface.FRP.Sodium (playSodium, InputEvent) where

import Graphics.Gloss
import Graphics.Gloss.Interface.IO.Game (playIO)
import qualified Graphics.Gloss.Interface.IO.Game as G
import FRP.Sodium
import Control.Monad (void)

-- | A useful type synonym for Gloss event values, to avoid confusion between
--   Gloss and Sodium.
type InputEvent = G.Event

-- | Play the game in a window, updating when the value of the provided
--   Behavior Picture changes.
playSodium ∷ Display -- ^ The display method
           → Color   -- ^ The background colour
           → Int     -- ^ The refresh rate, in Hertz
           → (  Event Float
              → Event InputEvent
              → Reactive (Behavior Picture))
           -- ^ A Reactive action to generate the Picture Behavior, taking
           --   the refresh and input Events with respect to which to build it.
           --   The refresh event generates a Float indicating the time delta
           --   since the last refresh.
           → IO ()
playSodium display colour frequency mPicture = do
  (unreg, bPicture, pushTick, pushInput) ← sync $ do
    (eTick,  pushTick ) ← newEvent
    (eInput, pushInput) ← newEvent
    bPicture ← mPicture eTick eInput

    -- To avoid https://github.com/kentuckyfriedtakahe/sodium/issues/14
    unreg ← listen (value bPicture) . const $ return ()

    return (unreg, bPicture, pushTick, pushInput)

  playIO display colour frequency ()
    (\      _ →        sync $ sample bPicture)
    (\ ev   _ → void . sync $ pushInput ev   )
    (\ time _ → void . sync $ pushTick time  )

  unreg
</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE UnicodeSyntax, Rank2Types #-}

module Graphics.Gloss.Interface.FRP.Sodium (playSodium, InputEvent) where

import Graphics.Gloss
import Graphics.Gloss.Interface.IO.Game (playIO)
import qualified Graphics.Gloss.Interface.IO.Game as G
import FRP.Sodium
import Control.Monad (void)

-- | A useful type synonym for Gloss event values, to avoid confusion between
--   Gloss and Sodium.
type InputEvent = G.Event

-- | Play the game in a window, updating when the value of the provided
--   Behavior Picture changes.
playSodium :: Display -- ^ The display method
           -> Color   -- ^ The background colour
           -> Int     -- ^ The refresh rate, in Hertz
           -> (  Event Float
              -> Event InputEvent
              -> Reactive (Behavior Picture))
           -- ^ A Reactive action to generate the Picture Behavior, taking
           --   the refresh and input Events with respect to which to build it.
           --   The refresh event generates a Float indicating the time delta
           --   since the last refresh.
           -> IO ()
playSodium display colour frequency mPicture = do
  (unreg, bPicture, pushTick, pushInput) <- sync $ do
    (eTick,  pushTick ) <- newEvent
    (eInput, pushInput) <- newEvent
    bPicture <- mPicture eTick eInput

    -- To avoid https://github.com/kentuckyfriedtakahe/sodium/issues/14
    unreg <- listen (value bPicture) . const $ return ()

    return (unreg, bPicture, pushTick, pushInput)

  playIO display colour frequency ()
    (\      _ ->        sync $ sample bPicture)
    (\ ev   _ -> void . sync $ pushInput ev   )
    (\ time _ -> void . sync $ pushTick time  )

  unreg

</pre>