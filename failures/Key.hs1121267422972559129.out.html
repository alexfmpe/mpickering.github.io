<a href="JSON.hs9545262341019571748.out.html">prev</a></br><a href="failures.html">home</a></br><a href="KiGam.hs1277246680438415348.out.html">next</a></br></br><pre>21c21
< {-# LINE 35 "src/ehc/CHR/Key.chs" #-}
---
> 
21a22
> 
21a23
> 
21a24
> 
21a25
> 
21a26
> 
21a27
> 
21a28
> 
21a29
> 
21a30
> 
21a31
> 
21a32
> 
21a33
> 
21a34
> 
32c45
< {-# LINE 59 "src/ehc/CHR/Key.chs" #-}
---
> 
32a46
> 
32a47
> 
32a48
> 
32a49
> 
32a50
> 
32a51
> 
32a52
> 
32a53
> 
32a54
> 
32a55
> 
32a56
> 
32a57
> 
32a58
> 
40c66
< {-# LINE 73 "src/ehc/CHR/Key.chs" #-}
---
> 
40a67
> 
40a68
> 
40a69
> 
40a70
> 
40a71
> 
40a72
> 
48c80
< {-# LINE 140 "src/ehc/CHR/Key.chs" #-}
---
> 
48a81
> 
48a82
> 
48a83
> 
48a84
> 
48a85
> 
48a86
> 
48a87
> 
48a88
> 
48a89
> 
48a90
> 
48a91
> 
48a92
> 
48a93
> 
48a94
> 
48a95
> 
48a96
> 
48a97
> 
48a98
> 
48a99
> 
48a100
> 
48a101
> 
48a102
> 
48a103
> 
48a104
> 
48a105
> 
48a106
> 
48a107
> 
48a108
> 
48a109
> 
48a110
> 
48a111
> 
48a112
> 
48a113
> 
48a114
> 
48a115
> 
48a116
> 
48a117
> 
48a118
> 
48a119
> 
48a120
> 
48a121
> 
48a122
> 
48a123
> 
48a124
> 
48a125
> 
48a126
> 
48a127
> 
48a128
> 
48a129
> 
48a130
> 
48a131
> 
48a132
> 
48a133
> 
48a134
> 
48a135
> 
48a136
> 
48a137
> 
48a138
> 
48a139
> 
56c147
< {-# LINE 149 "src/ehc/CHR/Key.chs" #-}
---
> 
56a148
> 
66c158
< {-# LINE 160 "src/ehc/CHR/Key.chs" #-}
---
> 
66a159
> 
70c163
< {-# LINE 165 "src/ehc/CHR/Key.chs" #-}
---
> 
70a164
> 
74c168
< {-# LINE 174 "src/ehc/CHR/Key.chs" #-}
---
> 
74a169
> 
74a170
> 
74a171
> 
74a172
> 
74a173
> 
89a189
> 
</pre></br><h2>original</h2></br><pre>module UHC.Light.Compiler.CHR.Key
( Key (..)
, TTKeyableOpts (..), defaultTTKeyableOpts
, TTKeyable (..)
, toTTKey )
where
import UHC.Light.Compiler.Base.Common
import UHC.Light.Compiler.Base.TreeTrie
import UHC.Util.Pretty
import UHC.Util.Utils
import UHC.Light.Compiler.Ty
import UHC.Light.Compiler.Ty.Pretty
import Data.Typeable (Typeable)
import Data.Generics (Data)
import UHC.Util.Serialize
import Control.Monad




{-# LINE 35 "src/ehc/CHR/Key.chs" #-}
data Key
  = Key_HNm     !HsName         -- type constant, its name
  | Key_UID     !UID            -- type variable, its id, used with TKK_Partial
  | Key_Str     !String         -- arbitrary string
  | Key_TyQu    !TyQu           -- quantified type, used with TKK_Partial
  | Key_Ty      !Ty             -- catchall for the rest, used with TKK_Partial
  deriving ( Eq, Ord
           , Typeable, Data
           )

{-# LINE 59 "src/ehc/CHR/Key.chs" #-}
instance Show Key where
  show (Key_HNm  n) = "H:" ++ show n
  show (Key_UID  n) = "U:" ++ show n
  show (Key_Str  n) = "S:" ++ n
  show (Key_TyQu n) = "Q:" ++ show n
  show (Key_Ty   n) = "T:" ++ show n

{-# LINE 73 "src/ehc/CHR/Key.chs" #-}
instance PP Key where
  pp (Key_HNm  n) = "H:" >|< n
  pp (Key_UID  n) = "U:" >|< n
  pp (Key_Str  n) = "S:" >|< n
  pp (Key_TyQu n) = "Q:" >|< show n
  pp (Key_Ty   n) = "T:" >|< n

{-# LINE 140 "src/ehc/CHR/Key.chs" #-}
data TTKeyableOpts
  = TTKeyableOpts
      { ttkoptsVarsAsWild       :: Bool             -- treat vars as wildcards
      }

defaultTTKeyableOpts = TTKeyableOpts True

{-# LINE 149 "src/ehc/CHR/Key.chs" #-}
-- | TreeTrie key construction
class TTKeyable x where
  toTTKey'                  :: TTKeyableOpts -> x ->  TreeTrieKey  Key                          -- option parameterized constuction
  toTTKeyParentChildren'    :: TTKeyableOpts -> x -> (TreeTrie1Key Key, [TreeTrieMpKey  Key])   -- building block: parent of children + children

  -- default impl
  toTTKey' o                    = uncurry ttkAdd' . toTTKeyParentChildren' o
  toTTKeyParentChildren' o      = ttkParentChildren . toTTKey' o

{-# LINE 160 "src/ehc/CHR/Key.chs" #-}
toTTKey :: TTKeyable x => x -> TreeTrieKey Key
toTTKey = toTTKey' defaultTTKeyableOpts

{-# LINE 165 "src/ehc/CHR/Key.chs" #-}
instance TTKeyable x => TreeTrieKeyable x Key where
  toTreeTrieKey   = toTTKey

{-# LINE 174 "src/ehc/CHR/Key.chs" #-}
instance Serialize Key where
  sput (Key_HNm  a) = sputWord8 0 >> sput a
  sput (Key_UID  a) = sputWord8 1 >> sput a
  sput (Key_Str  a) = sputWord8 2 >> sput a
  sput (Key_TyQu a) = sputWord8 3 >> sput a
  sput (Key_Ty   a) = sputWord8 4 >> sput a
  sget = do
    t <- sgetWord8
    case t of
      0 -> liftM  Key_HNm  sget
      1 -> liftM  Key_UID  sget
      2 -> liftM  Key_Str  sget
      3 -> liftM  Key_TyQu sget
      4 -> liftM  Key_Ty   sget

</pre></br><h2>printed</h2></br><pre>module UHC.Light.Compiler.CHR.Key
( Key (..)
, TTKeyableOpts (..), defaultTTKeyableOpts
, TTKeyable (..)
, toTTKey )
where
import UHC.Light.Compiler.Base.Common
import UHC.Light.Compiler.Base.TreeTrie
import UHC.Util.Pretty
import UHC.Util.Utils
import UHC.Light.Compiler.Ty
import UHC.Light.Compiler.Ty.Pretty
import Data.Typeable (Typeable)
import Data.Generics (Data)
import UHC.Util.Serialize
import Control.Monad


















data Key
  = Key_HNm     !HsName         -- type constant, its name
  | Key_UID     !UID            -- type variable, its id, used with TKK_Partial
  | Key_Str     !String         -- arbitrary string
  | Key_TyQu    !TyQu           -- quantified type, used with TKK_Partial
  | Key_Ty      !Ty             -- catchall for the rest, used with TKK_Partial
  deriving ( Eq, Ord
           , Typeable, Data
           )















instance Show Key where
  show (Key_HNm  n) = "H:" ++ show n
  show (Key_UID  n) = "U:" ++ show n
  show (Key_Str  n) = "S:" ++ n
  show (Key_TyQu n) = "Q:" ++ show n
  show (Key_Ty   n) = "T:" ++ show n








instance PP Key where
  pp (Key_HNm  n) = "H:" >|< n
  pp (Key_UID  n) = "U:" >|< n
  pp (Key_Str  n) = "S:" >|< n
  pp (Key_TyQu n) = "Q:" >|< show n
  pp (Key_Ty   n) = "T:" >|< n





























































data TTKeyableOpts
  = TTKeyableOpts
      { ttkoptsVarsAsWild       :: Bool             -- treat vars as wildcards
      }

defaultTTKeyableOpts = TTKeyableOpts True



-- | TreeTrie key construction
class TTKeyable x where
  toTTKey'                  :: TTKeyableOpts -> x ->  TreeTrieKey  Key                          -- option parameterized constuction
  toTTKeyParentChildren'    :: TTKeyableOpts -> x -> (TreeTrie1Key Key, [TreeTrieMpKey  Key])   -- building block: parent of children + children

  -- default impl
  toTTKey' o                    = uncurry ttkAdd' . toTTKeyParentChildren' o
  toTTKeyParentChildren' o      = ttkParentChildren . toTTKey' o



toTTKey :: TTKeyable x => x -> TreeTrieKey Key
toTTKey = toTTKey' defaultTTKeyableOpts



instance TTKeyable x => TreeTrieKeyable x Key where
  toTreeTrieKey   = toTTKey







instance Serialize Key where
  sput (Key_HNm  a) = sputWord8 0 >> sput a
  sput (Key_UID  a) = sputWord8 1 >> sput a
  sput (Key_Str  a) = sputWord8 2 >> sput a
  sput (Key_TyQu a) = sputWord8 3 >> sput a
  sput (Key_Ty   a) = sputWord8 4 >> sput a
  sget = do
    t <- sgetWord8
    case t of
      0 -> liftM  Key_HNm  sget
      1 -> liftM  Key_UID  sget
      2 -> liftM  Key_Str  sget
      3 -> liftM  Key_TyQu sget
      4 -> liftM  Key_Ty   sget


</pre>