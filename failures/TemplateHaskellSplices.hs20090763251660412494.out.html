<a href="Template.hs13501439811557674465.out.html">prev</a></br><a href="failures.html">home</a></br><a href="Templates.hs1085614563902895429.out.html">next</a></br></br><pre>19c19
<                     then [| $(varE f) $a |]
---
>                     then [| $(varE f) a |]
21a22
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE TemplateHaskell,
             RankNTypes       #-}

-- | TH splices used in atommic-primops tests.
--   Splices defined in own module for technical reasons.

module TemplateHaskellSplices where

import Language.Haskell.TH
import Control.Monad (replicateM)

tmap :: forall a. (Enum a, Eq a, Num a)
        => a -> Int -> Q Exp
tmap i n = do
    f <- newName "f"
    as <- replicateM n (newName "a")
    lamE [varP f, tupP (map varP as)] $
        tupE [  if i == i'
                    then [| $(varE f) $a |]
                    else a
               | (a,i') <- map varE as `zip` [1..] ]
</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE TemplateHaskell,
             RankNTypes       #-}

-- | TH splices used in atommic-primops tests.
--   Splices defined in own module for technical reasons.

module TemplateHaskellSplices where

import Language.Haskell.TH
import Control.Monad (replicateM)

tmap :: forall a. (Enum a, Eq a, Num a)
        => a -> Int -> Q Exp
tmap i n = do
    f <- newName "f"
    as <- replicateM n (newName "a")
    lamE [varP f, tupP (map varP as)] $
        tupE [  if i == i'
                    then [| $(varE f) a |]
                    else a
               | (a,i') <- map varE as `zip` [1..] ]

</pre>