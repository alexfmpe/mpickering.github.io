<a href="Rotation.hs828530767832633821.out.html">prev</a></br><a href="failures.html">home</a></br><a href="Route.hs1580723810704877633.out.html">next</a></br></br><pre>24d23
< rotPortSpec ∷ (PortSpec n, View Rotation n) ⇒ n → [(Vector2, Vector2)]
25c24
< rotPortSpec n = map (\(v, u) → (rot v, rot u)) (portSpec n)
---
> rotPortSpec :: (PortSpec n, View Rotation n) => n -> [(Vector2, Vector2)]
25a25
> rotPortSpec n = map (\(v, u) -> (rot v, rot u)) (portSpec n)
28c28
< relRotPortPos ∷ (PortSpec n, View Rotation n) ⇒ n → [Vector2]
---
> relRotPortPos :: (PortSpec n, View Rotation n) => n -> [Vector2]
31d30
< absRotPortSpec ∷ (PortSpec n, View Position n, View Rotation n) ⇒ n → [(Vector2, Vector2)]
32c31
< absRotPortSpec n = map (\(p,d) → (examine position n + p, d)) $ rotPortSpec n
---
> absRotPortSpec :: (PortSpec n, View Position n, View Rotation n) => n -> [(Vector2, Vector2)]
32a32
> absRotPortSpec n = map (\(p,d) -> (examine position n + p, d)) $ rotPortSpec n
34c34
< absRotPortPos ∷ (PortSpec n, View Position n, View Rotation n) ⇒ n → [Vector2]
---
> absRotPortPos :: (PortSpec n, View Position n, View Rotation n) => n -> [Vector2]
37c37
< angularMomentum ∷ (View Position n, PortSpec n, View Rotation n, View [Port] n) ⇒ Node → WithGraph n Momentum
---
> angularMomentum :: (View Position n, PortSpec n, View Rotation n, View [Port] n) => Node -> WithGraph n Momentum
39c39
<     nv ← readNode n
---
>     nv <- readNode n
43c43
<         ns ← mapM readNode =<< adverseNodes n e
---
>         ns <- mapM readNode =<< adverseNodes n e
45c45
<         let angles = [angle np (nsp - npos) | np ← nps, nsp ← nsps]
---
>         let angles = [angle np (nsp - npos) | np <- nps, nsp <- nsps]
47a48
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE UnicodeSyntax, FlexibleContexts #-}
module GraphRewriting.Layout.RotPortSpec
    (module GraphRewriting.Layout.RotPortSpec,
     module GraphRewriting.Layout.Position,
     module GraphRewriting.Layout.Rotation,
     module GraphRewriting.Layout.PortSpec,
     module GraphRewriting.Layout.Geometry,
     module Data.Vector.V2,
     module Data.View)
where


import GraphRewriting.Graph
import GraphRewriting.Graph.Read
import GraphRewriting.Layout.Position
import GraphRewriting.Layout.Rotation
import GraphRewriting.Layout.PortSpec
import GraphRewriting.Layout.Geometry
import Data.Vector.V2
import Data.View
import Control.Monad


rotPortSpec ∷ (PortSpec n, View Rotation n) ⇒ n → [(Vector2, Vector2)]
rotPortSpec n = map (\(v, u) → (rot v, rot u)) (portSpec n)
    where rot = rotate (examine rotation n)

relRotPortPos ∷ (PortSpec n, View Rotation n) ⇒ n → [Vector2]
relRotPortPos = map fst . rotPortSpec

absRotPortSpec ∷ (PortSpec n, View Position n, View Rotation n) ⇒ n → [(Vector2, Vector2)]
absRotPortSpec n = map (\(p,d) → (examine position n + p, d)) $ rotPortSpec n

absRotPortPos ∷ (PortSpec n, View Position n, View Rotation n) ⇒ n → [Vector2]
absRotPortPos = map fst . absRotPortSpec

angularMomentum ∷ (View Position n, PortSpec n, View Rotation n, View [Port] n) ⇒ Node → WithGraph n Momentum
angularMomentum n = do
    nv ← readNode n
    let npos = examine position nv
    let edgePortions e = do
        let nps = propOfPort portDir e nv
        ns ← mapM readNode =<< adverseNodes n e
        let nsps = concatMap (propOfPort absRotPortPos e) ns
        let angles = [angle np (nsp - npos) | np ← nps, nsp ← nsps]
        return $ map (approach . Rotation) angles
    liftM (momSum . concat) (mapM edgePortions =<< attachedEdges n)
</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE UnicodeSyntax, FlexibleContexts #-}
module GraphRewriting.Layout.RotPortSpec
    (module GraphRewriting.Layout.RotPortSpec,
     module GraphRewriting.Layout.Position,
     module GraphRewriting.Layout.Rotation,
     module GraphRewriting.Layout.PortSpec,
     module GraphRewriting.Layout.Geometry,
     module Data.Vector.V2,
     module Data.View)
where


import GraphRewriting.Graph
import GraphRewriting.Graph.Read
import GraphRewriting.Layout.Position
import GraphRewriting.Layout.Rotation
import GraphRewriting.Layout.PortSpec
import GraphRewriting.Layout.Geometry
import Data.Vector.V2
import Data.View
import Control.Monad


rotPortSpec :: (PortSpec n, View Rotation n) => n -> [(Vector2, Vector2)]
rotPortSpec n = map (\(v, u) -> (rot v, rot u)) (portSpec n)
    where rot = rotate (examine rotation n)

relRotPortPos :: (PortSpec n, View Rotation n) => n -> [Vector2]
relRotPortPos = map fst . rotPortSpec

absRotPortSpec :: (PortSpec n, View Position n, View Rotation n) => n -> [(Vector2, Vector2)]
absRotPortSpec n = map (\(p,d) -> (examine position n + p, d)) $ rotPortSpec n

absRotPortPos :: (PortSpec n, View Position n, View Rotation n) => n -> [Vector2]
absRotPortPos = map fst . absRotPortSpec

angularMomentum :: (View Position n, PortSpec n, View Rotation n, View [Port] n) => Node -> WithGraph n Momentum
angularMomentum n = do
    nv <- readNode n
    let npos = examine position nv
    let edgePortions e = do
        let nps = propOfPort portDir e nv
        ns <- mapM readNode =<< adverseNodes n e
        let nsps = concatMap (propOfPort absRotPortPos e) ns
        let angles = [angle np (nsp - npos) | np <- nps, nsp <- nsps]
        return $ map (approach . Rotation) angles
    liftM (momSum . concat) (mapM edgePortions =<< attachedEdges n)

</pre>