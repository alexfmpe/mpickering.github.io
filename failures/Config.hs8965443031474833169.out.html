<a href="Config.hs2441166411174619517.out.html">prev</a></br><a href="failures.html">home</a></br><a href="ConfigInternalVersions.hs13418536351808266298.out.html">next</a></br></br><pre>16c16
<   getPredicate ∷ DateTime → c → (TodoItem → 𝔹)
---
>   getPredicate :: DateTime -> c -> (TodoItem -> 𝔹)
18c18
<   toBaseConfig ∷ c → BaseConfig
---
>   toBaseConfig :: c -> BaseConfig
22d21
<       outOnlyFirst ∷ 𝔹,           -- ^ Output only first matching entry
23c22
<       outColors ∷ 𝔹,              -- ^ Show colored output
---
>       outOnlyFirst :: 𝔹,           -- ^ Output only first matching entry
23a23
>       outColors :: 𝔹,              -- ^ Show colored output
25d24
<       outHighlight ∷ 𝔹,           -- ^ Highlight matching items
26d24
<       sorting ∷ SortingType,      -- ^ How to sort items
27d24
<       pruneL ∷ Limit,
28d24
<       minL   ∷ Limit,
29d24
<       commandToRun ∷ TodoCommand,
30d24
<       prefix ∷ Maybe String,      -- ^ Nothing — use default parser, Just p — use alternate parser with prefix «p»
31d24
<       outputFormat ∷ String,
32d24
<       indentString ∷ String,      -- ^ String to use for output tree indenting (two spaces by default)
33d24
<       skipStatus ∷ 𝔹,             -- ^ Skip status field in input
34d24
<       groupByFile ∷ 𝔹,
35d24
<       groupByTag ∷ 𝔹,
36d24
<       groupByStatus ∷ 𝔹,
37d24
<       forcedStatus ∷ Maybe String,
38c25
<       topStatus ∷ Maybe String
---
>       outHighlight :: 𝔹,           -- ^ Highlight matching items
38a26
>       sorting :: SortingType,      -- ^ How to sort items
38a27
>       pruneL :: Limit,
38a28
>       minL   :: Limit,
38a29
>       commandToRun :: TodoCommand,
38a30
>       prefix :: Maybe String,      -- ^ Nothing — use default parser, Just p — use alternate parser with prefix «p»
38a31
>       outputFormat :: String,
38a32
>       indentString :: String,      -- ^ String to use for output tree indenting (two spaces by default)
38a33
>       skipStatus :: 𝔹,             -- ^ Skip status field in input
38a34
>       groupByFile :: 𝔹,
38a35
>       groupByTag :: 𝔹,
38a36
>       groupByStatus :: 𝔹,
38a37
>       forcedStatus :: Maybe String,
38a38
>       topStatus :: Maybe String
44d43
<   printConfig ∷ c,
45d43
<   printStatusColor ∷  String → (ANSI.ColorIntensity, ANSI.Color),       -- ^ Color of status field from status
46d43
<   printItemColor ∷  TodoItem → Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Color of item name
47d43
<   printHighlightColor ∷ (ANSI.ColorIntensity, ANSI.Color),              -- ^ Color to use for highlighting
48c44
<   doHighlight ∷ TodoItem → 𝔹                                            -- ^ Whether to highlight given item
---
>   printConfig :: c,
48a45
>   printStatusColor ::  String -> (ANSI.ColorIntensity, ANSI.Color),       -- ^ Color of status field from status
48a46
>   printItemColor ::  TodoItem -> Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Color of item name
48a47
>   printHighlightColor :: (ANSI.ColorIntensity, ANSI.Color),              -- ^ Color to use for highlighting
48a48
>   doHighlight :: TodoItem -> 𝔹                                            -- ^ Whether to highlight given item
53d52
<      parseCommandLine ∷ DateTime → c → [String] → CmdLineParseResult c,     -- ^ Function to parse command line
54d52
<      filterTodos ∷ DateTime → c → [Todo] → [Todo],                          -- ^ Any function to be run to transform read TODOs tree
55d52
<      statusConsoleColor ∷ String → (ANSI.ColorIntensity, ANSI.Color),       -- ^ Function to select a color of item's status field in console output
56d52
<      itemConsoleColor ∷ TodoItem → Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Function to select a color of item's name in console output
57d52
<      highlightColor ∷ (ANSI.ColorIntensity, ANSI.Color),                    -- ^ Color to use for highlighting
58d52
<      itemColor ∷ TodoItem → HSV,                                            -- ^ Function to select color for item's node in DOT output
59d52
<      itemShape ∷ TodoItem → Shape,                                          -- ^ Function to select shape for item's node in DOT output
60d52
<      printTodos ∷ PrintConfig c → [Todo] → IO (),                           -- ^ Any function to output TODOs list
61c53
<      nullConfig ∷ c                                                         -- ^ Default Config (to be used without any options in command line and configs)
---
>      parseCommandLine :: DateTime -> c -> [String] -> CmdLineParseResult c,     -- ^ Function to parse command line
61a54
>      filterTodos :: DateTime -> c -> [Todo] -> [Todo],                          -- ^ Any function to be run to transform read TODOs tree
61a55
>      statusConsoleColor :: String -> (ANSI.ColorIntensity, ANSI.Color),       -- ^ Function to select a color of item's status field in console output
61a56
>      itemConsoleColor :: TodoItem -> Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Function to select a color of item's name in console output
61a57
>      highlightColor :: (ANSI.ColorIntensity, ANSI.Color),                    -- ^ Color to use for highlighting
61a58
>      itemColor :: TodoItem -> HSV,                                            -- ^ Function to select color for item's node in DOT output
61a59
>      itemShape :: TodoItem -> Shape,                                          -- ^ Function to select shape for item's node in DOT output
61a60
>      printTodos :: PrintConfig c -> [Todo] -> IO (),                           -- ^ Any function to output TODOs list
61a61
>      nullConfig :: c                                                         -- ^ Default Config (to be used without any options in command line and configs)
72c72
< askBase ∷ (RuntimeConfig c) ⇒ (BaseConfig → a) → Reader c a
---
> askBase :: (RuntimeConfig c) => (BaseConfig -> a) -> Reader c a
74a75
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE UnicodeSyntax, MultiParamTypeClasses #-}

module Todos.Config where

import Prelude.Unicode
import Control.Monad.Reader
import Data.Dates

import Todos.Types
import Todos.Dot
import qualified System.Console.ANSI as ANSI

-- | Any user-specified runtime config type should belong to this class
class RuntimeConfig c where
  -- | Does given TODO item match query?
  getPredicate ∷ DateTime → c → (TodoItem → 𝔹)
  -- | Get basic configuration
  toBaseConfig ∷ c → BaseConfig

-- | Any user-specified runtime config type should include at least this properties
data BaseConfig = BConfig {
      outOnlyFirst ∷ 𝔹,           -- ^ Output only first matching entry
      outColors ∷ 𝔹,              -- ^ Show colored output
      outIds :: 𝔹,                -- ^ Show IDs
      outHighlight ∷ 𝔹,           -- ^ Highlight matching items
      sorting ∷ SortingType,      -- ^ How to sort items
      pruneL ∷ Limit,
      minL   ∷ Limit,
      commandToRun ∷ TodoCommand,
      prefix ∷ Maybe String,      -- ^ Nothing — use default parser, Just p — use alternate parser with prefix «p»
      outputFormat ∷ String,
      indentString ∷ String,      -- ^ String to use for output tree indenting (two spaces by default)
      skipStatus ∷ 𝔹,             -- ^ Skip status field in input
      groupByFile ∷ 𝔹,
      groupByTag ∷ 𝔹,
      groupByStatus ∷ 𝔹,
      forcedStatus ∷ Maybe String,
      topStatus ∷ Maybe String
      }
    deriving (Eq, Show)

-- | Configuration for console output. Is generated in runtime from TodosConfig and Config.
data PrintConfig c = PConfig {
  printConfig ∷ c,
  printStatusColor ∷  String → (ANSI.ColorIntensity, ANSI.Color),       -- ^ Color of status field from status
  printItemColor ∷  TodoItem → Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Color of item name
  printHighlightColor ∷ (ANSI.ColorIntensity, ANSI.Color),              -- ^ Color to use for highlighting
  doHighlight ∷ TodoItem → 𝔹                                            -- ^ Whether to highlight given item
  }

-- | User Todos config. User can specify it in @~/.config/todos/todos.hs@.
data TodosConfig c = Todos {
     parseCommandLine ∷ DateTime → c → [String] → CmdLineParseResult c,     -- ^ Function to parse command line
     filterTodos ∷ DateTime → c → [Todo] → [Todo],                          -- ^ Any function to be run to transform read TODOs tree
     statusConsoleColor ∷ String → (ANSI.ColorIntensity, ANSI.Color),       -- ^ Function to select a color of item's status field in console output
     itemConsoleColor ∷ TodoItem → Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Function to select a color of item's name in console output
     highlightColor ∷ (ANSI.ColorIntensity, ANSI.Color),                    -- ^ Color to use for highlighting
     itemColor ∷ TodoItem → HSV,                                            -- ^ Function to select color for item's node in DOT output
     itemShape ∷ TodoItem → Shape,                                          -- ^ Function to select shape for item's node in DOT output
     printTodos ∷ PrintConfig c → [Todo] → IO (),                           -- ^ Any function to output TODOs list
     nullConfig ∷ c                                                         -- ^ Default Config (to be used without any options in command line and configs)
}

-- | Result of parsing command line
data CmdLineParseResult c =
     Parsed c [FilePath]       -- ^ Parsed successfully, got Config and list of source files
   | ParseError String         -- ^ Some error occured
   | CmdLineHelp               -- ^ User asked for help
   deriving (Eq,Show)

-- | ask field from BaseConfig
askBase ∷ (RuntimeConfig c) ⇒ (BaseConfig → a) → Reader c a
askBase field = asks (field ∘ toBaseConfig)

</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE UnicodeSyntax, MultiParamTypeClasses #-}

module Todos.Config where

import Prelude.Unicode
import Control.Monad.Reader
import Data.Dates

import Todos.Types
import Todos.Dot
import qualified System.Console.ANSI as ANSI

-- | Any user-specified runtime config type should belong to this class
class RuntimeConfig c where
  -- | Does given TODO item match query?
  getPredicate :: DateTime -> c -> (TodoItem -> 𝔹)
  -- | Get basic configuration
  toBaseConfig :: c -> BaseConfig

-- | Any user-specified runtime config type should include at least this properties
data BaseConfig = BConfig {
      outOnlyFirst :: 𝔹,           -- ^ Output only first matching entry
      outColors :: 𝔹,              -- ^ Show colored output
      outIds :: 𝔹,                -- ^ Show IDs
      outHighlight :: 𝔹,           -- ^ Highlight matching items
      sorting :: SortingType,      -- ^ How to sort items
      pruneL :: Limit,
      minL   :: Limit,
      commandToRun :: TodoCommand,
      prefix :: Maybe String,      -- ^ Nothing — use default parser, Just p — use alternate parser with prefix «p»
      outputFormat :: String,
      indentString :: String,      -- ^ String to use for output tree indenting (two spaces by default)
      skipStatus :: 𝔹,             -- ^ Skip status field in input
      groupByFile :: 𝔹,
      groupByTag :: 𝔹,
      groupByStatus :: 𝔹,
      forcedStatus :: Maybe String,
      topStatus :: Maybe String
      }
    deriving (Eq, Show)

-- | Configuration for console output. Is generated in runtime from TodosConfig and Config.
data PrintConfig c = PConfig {
  printConfig :: c,
  printStatusColor ::  String -> (ANSI.ColorIntensity, ANSI.Color),       -- ^ Color of status field from status
  printItemColor ::  TodoItem -> Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Color of item name
  printHighlightColor :: (ANSI.ColorIntensity, ANSI.Color),              -- ^ Color to use for highlighting
  doHighlight :: TodoItem -> 𝔹                                            -- ^ Whether to highlight given item
  }

-- | User Todos config. User can specify it in @~/.config/todos/todos.hs@.
data TodosConfig c = Todos {
     parseCommandLine :: DateTime -> c -> [String] -> CmdLineParseResult c,     -- ^ Function to parse command line
     filterTodos :: DateTime -> c -> [Todo] -> [Todo],                          -- ^ Any function to be run to transform read TODOs tree
     statusConsoleColor :: String -> (ANSI.ColorIntensity, ANSI.Color),       -- ^ Function to select a color of item's status field in console output
     itemConsoleColor :: TodoItem -> Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Function to select a color of item's name in console output
     highlightColor :: (ANSI.ColorIntensity, ANSI.Color),                    -- ^ Color to use for highlighting
     itemColor :: TodoItem -> HSV,                                            -- ^ Function to select color for item's node in DOT output
     itemShape :: TodoItem -> Shape,                                          -- ^ Function to select shape for item's node in DOT output
     printTodos :: PrintConfig c -> [Todo] -> IO (),                           -- ^ Any function to output TODOs list
     nullConfig :: c                                                         -- ^ Default Config (to be used without any options in command line and configs)
}

-- | Result of parsing command line
data CmdLineParseResult c =
     Parsed c [FilePath]       -- ^ Parsed successfully, got Config and list of source files
   | ParseError String         -- ^ Some error occured
   | CmdLineHelp               -- ^ User asked for help
   deriving (Eq,Show)

-- | ask field from BaseConfig
askBase :: (RuntimeConfig c) => (BaseConfig -> a) -> Reader c a
askBase field = asks (field ∘ toBaseConfig)


</pre>