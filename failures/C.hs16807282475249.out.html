<a href="ByteStringInternal.hs13418536351808266298.out.html">prev</a></br><a href="failures.html">home</a></br><a href="Cabal.hs1075260298824938981.out.html">next</a></br></br><pre>64d63
<     def = do weekDay ← shortWeekDayNameP
65d63
<              _       ← char ' '
66d63
<              month   ← shortMonthNameP
67d63
<              _       ← char ' '
68d63
<              day     ← read2'
69d63
<              _       ← char ' '
70d63
<              hour    ← read2
71d63
<              _       ← char ':'
72d63
<              minute  ← read2
73d63
<              _       ← char ':'
74d63
<              second  ← read2
75d63
<              _       ← char ' '
76c64
<              year    ← read4
---
>     def = do weekDay <- shortWeekDayNameP
76a65
>              _       <- char ' '
76a66
>              month   <- shortMonthNameP
76a67
>              _       <- char ' '
76a68
>              day     <- read2'
76a69
>              _       <- char ' '
76a70
>              hour    <- read2
76a71
>              _       <- char ':'
76a72
>              minute  <- read2
76a73
>              _       <- char ':'
76a74
>              second  <- read2
76a75
>              _       <- char ' '
76a76
>              year    <- read4
78d77
<              gregDay ← assertGregorianDateIsGood year month day
79d77
<              _       ← assertWeekDayIsGood weekDay gregDay
80c78
<              tod     ← assertTimeOfDayIsGood hour minute second
---
>              gregDay <- assertGregorianDateIsGood year month day
80a79
>              _       <- assertWeekDayIsGood weekDay gregDay
80a80
>              tod     <- assertTimeOfDayIsGood hour minute second
84c84
< toAsciiBuilder ∷ LocalTime → AsciiBuilder
---
> toAsciiBuilder :: LocalTime -> AsciiBuilder
100c100
<         ⊕ show2 (floor (todSec timeOfDay) ∷ Int)
---
>         ⊕ show2 (floor (todSec timeOfDay) :: Int)
106a107
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE
    FlexibleInstances
  , MultiParamTypeClasses
  , OverloadedStrings
  , TemplateHaskell
  , TypeSynonymInstances
  , UnicodeSyntax
  #-}
-- |This module provides functions for ANSI C's date and time strings.
--
-- ANSI C's @ctime(3)@/@asctime(3)@ format looks like:
--
-- @Wdy Mon [D]D HH:MM:SS YYYY@
--
-- The exact syntax is as follows:
--
-- > date-time ::= wday SP month SP day SP time SP year
-- > wday      ::= "Mon" | "Tue" | "Wed" | "Thu"
-- >             | "Fri" | "Sat" | "Sun"
-- > month     ::= "Jan" | "Feb" | "Mar" | "Apr"
-- >             | "May" | "Jun" | "Jul" | "Aug"
-- >             | "Sep" | "Oct" | "Nov" | "Dec"
-- > day       ::= 2DIGIT | SP 1DIGIT
-- > time      ::= 2DIGIT ':' 2DIGIT [':' 2DIGIT]
-- > year      ::= 4DIGIT
module Data.Time.Format.C
    ( C
    )
    where
import Data.Ascii (Ascii, AsciiBuilder)
import qualified Data.Ascii as A
import Data.Attoparsec.Char8
import Data.Convertible.Base
import Data.Default
import Data.Monoid.Unicode
import Data.Tagged
import Data.Time
import Data.Time.Calendar.WeekDate
import Data.Time.Format.HTTP.Common
import Prelude.Unicode

-- |The phantom type for conversions between ANSI C's date and time
-- strings and 'LocalTime'.
--
-- >>> convertSuccess (Tagged (LocalTime (ModifiedJulianDay 49662) (TimeOfDay 8 49 37)) :: Tagged C LocalTime)
-- "Sun Nov  6 08:49:37 1994"
data C

instance ConvertSuccess (Tagged C LocalTime) Ascii where
    {-# INLINE convertSuccess #-}
    convertSuccess = A.fromAsciiBuilder ∘ cs

instance ConvertSuccess (Tagged C LocalTime) AsciiBuilder where
    {-# INLINE convertSuccess #-}
    convertSuccess = toAsciiBuilder ∘ untag

instance ConvertAttempt Ascii (Tagged C LocalTime) where
    {-# INLINE convertAttempt #-}
    convertAttempt = parseAttempt' def

-- |Parse an ANSI C's date and time string.
instance Default (Parser (Tagged C LocalTime)) where
    {-# INLINEABLE def #-}
    def = do weekDay ← shortWeekDayNameP
             _       ← char ' '
             month   ← shortMonthNameP
             _       ← char ' '
             day     ← read2'
             _       ← char ' '
             hour    ← read2
             _       ← char ':'
             minute  ← read2
             _       ← char ':'
             second  ← read2
             _       ← char ' '
             year    ← read4

             gregDay ← assertGregorianDateIsGood year month day
             _       ← assertWeekDayIsGood weekDay gregDay
             tod     ← assertTimeOfDayIsGood hour minute second

             return ∘ Tagged $ LocalTime gregDay tod

toAsciiBuilder ∷ LocalTime → AsciiBuilder
toAsciiBuilder localTime
    = let (year, month, day) = toGregorian (localDay localTime)
          (_, _, week)       = toWeekDate  (localDay localTime)
          timeOfDay          = localTimeOfDay localTime
      in
        shortWeekDayName week
        ⊕ A.toAsciiBuilder " "
        ⊕ shortMonthName month
        ⊕ A.toAsciiBuilder " "
        ⊕ show2' day
        ⊕ A.toAsciiBuilder " "
        ⊕ show2 (todHour timeOfDay)
        ⊕ A.toAsciiBuilder ":"
        ⊕ show2 (todMin timeOfDay)
        ⊕ A.toAsciiBuilder ":"
        ⊕ show2 (floor (todSec timeOfDay) ∷ Int)
        ⊕ A.toAsciiBuilder " "
        ⊕ show4 year

deriveAttempts [ ([t| Tagged C LocalTime |], [t| Ascii        |])
               , ([t| Tagged C LocalTime |], [t| AsciiBuilder |])
               ]
</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE
    FlexibleInstances
  , MultiParamTypeClasses
  , OverloadedStrings
  , TemplateHaskell
  , TypeSynonymInstances
  , UnicodeSyntax
  #-}
-- |This module provides functions for ANSI C's date and time strings.
--
-- ANSI C's @ctime(3)@/@asctime(3)@ format looks like:
--
-- @Wdy Mon [D]D HH:MM:SS YYYY@
--
-- The exact syntax is as follows:
--
-- > date-time ::= wday SP month SP day SP time SP year
-- > wday      ::= "Mon" | "Tue" | "Wed" | "Thu"
-- >             | "Fri" | "Sat" | "Sun"
-- > month     ::= "Jan" | "Feb" | "Mar" | "Apr"
-- >             | "May" | "Jun" | "Jul" | "Aug"
-- >             | "Sep" | "Oct" | "Nov" | "Dec"
-- > day       ::= 2DIGIT | SP 1DIGIT
-- > time      ::= 2DIGIT ':' 2DIGIT [':' 2DIGIT]
-- > year      ::= 4DIGIT
module Data.Time.Format.C
    ( C
    )
    where
import Data.Ascii (Ascii, AsciiBuilder)
import qualified Data.Ascii as A
import Data.Attoparsec.Char8
import Data.Convertible.Base
import Data.Default
import Data.Monoid.Unicode
import Data.Tagged
import Data.Time
import Data.Time.Calendar.WeekDate
import Data.Time.Format.HTTP.Common
import Prelude.Unicode

-- |The phantom type for conversions between ANSI C's date and time
-- strings and 'LocalTime'.
--
-- >>> convertSuccess (Tagged (LocalTime (ModifiedJulianDay 49662) (TimeOfDay 8 49 37)) :: Tagged C LocalTime)
-- "Sun Nov  6 08:49:37 1994"
data C

instance ConvertSuccess (Tagged C LocalTime) Ascii where
    {-# INLINE convertSuccess #-}
    convertSuccess = A.fromAsciiBuilder ∘ cs

instance ConvertSuccess (Tagged C LocalTime) AsciiBuilder where
    {-# INLINE convertSuccess #-}
    convertSuccess = toAsciiBuilder ∘ untag

instance ConvertAttempt Ascii (Tagged C LocalTime) where
    {-# INLINE convertAttempt #-}
    convertAttempt = parseAttempt' def

-- |Parse an ANSI C's date and time string.
instance Default (Parser (Tagged C LocalTime)) where
    {-# INLINEABLE def #-}
    def = do weekDay <- shortWeekDayNameP
             _       <- char ' '
             month   <- shortMonthNameP
             _       <- char ' '
             day     <- read2'
             _       <- char ' '
             hour    <- read2
             _       <- char ':'
             minute  <- read2
             _       <- char ':'
             second  <- read2
             _       <- char ' '
             year    <- read4

             gregDay <- assertGregorianDateIsGood year month day
             _       <- assertWeekDayIsGood weekDay gregDay
             tod     <- assertTimeOfDayIsGood hour minute second

             return ∘ Tagged $ LocalTime gregDay tod

toAsciiBuilder :: LocalTime -> AsciiBuilder
toAsciiBuilder localTime
    = let (year, month, day) = toGregorian (localDay localTime)
          (_, _, week)       = toWeekDate  (localDay localTime)
          timeOfDay          = localTimeOfDay localTime
      in
        shortWeekDayName week
        ⊕ A.toAsciiBuilder " "
        ⊕ shortMonthName month
        ⊕ A.toAsciiBuilder " "
        ⊕ show2' day
        ⊕ A.toAsciiBuilder " "
        ⊕ show2 (todHour timeOfDay)
        ⊕ A.toAsciiBuilder ":"
        ⊕ show2 (todMin timeOfDay)
        ⊕ A.toAsciiBuilder ":"
        ⊕ show2 (floor (todSec timeOfDay) :: Int)
        ⊕ A.toAsciiBuilder " "
        ⊕ show4 year

deriveAttempts [ ([t| Tagged C LocalTime |], [t| Ascii        |])
               , ([t| Tagged C LocalTime |], [t| AsciiBuilder |])
               ]

</pre>