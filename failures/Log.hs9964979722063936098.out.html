<a href="Log.hs907225550605925150.out.html">prev</a></br><a href="failures.html">home</a></br><a href="Logic.hs1778878209338725129.out.html">next</a></br></br><pre>32c32
<     doesFileExist absdir >>= \case
---
>     doesFileExist absdir >>= 
41a42
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE LambdaCase #-}

module Log where

import Video

import System.Directory
import System.FilePath

import qualified Data.Text as T
import qualified Data.Text.IO as T

encVid :: [Video] -> T.Text
encVid vs = T.intercalate "\n" $ map vidName vs

decVid :: T.Text -> [Video]
decVid = map (\t -> Video t "" "" "") . T.lines

logname :: FilePath
logname = ".pgdl.cache"

writeVid :: [Video] -> IO ()
writeVid vs = do
    hdir <- getHomeDirectory
    T.writeFile (hdir </> logname) $ encVid vs

readVid :: IO [Video]
readVid = do
    hdir <- getHomeDirectory
    let absdir = hdir </> logname
    doesFileExist absdir >>= \case
        True -> do
            dat <- T.readFile (hdir </> logname)
            return $ decVid dat
        False -> return dlnVid

dlnVid :: [Video]
dlnVid = [Video "Downloading..." "" "" ""]


</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE LambdaCase #-}

module Log where

import Video

import System.Directory
import System.FilePath

import qualified Data.Text as T
import qualified Data.Text.IO as T

encVid :: [Video] -> T.Text
encVid vs = T.intercalate "\n" $ map vidName vs

decVid :: T.Text -> [Video]
decVid = map (\t -> Video t "" "" "") . T.lines

logname :: FilePath
logname = ".pgdl.cache"

writeVid :: [Video] -> IO ()
writeVid vs = do
    hdir <- getHomeDirectory
    T.writeFile (hdir </> logname) $ encVid vs

readVid :: IO [Video]
readVid = do
    hdir <- getHomeDirectory
    let absdir = hdir </> logname
    doesFileExist absdir >>= 
        True -> do
            dat <- T.readFile (hdir </> logname)
            return $ decVid dat
        False -> return dlnVid

dlnVid :: [Video]
dlnVid = [Video "Downloading..." "" "" ""]



</pre>