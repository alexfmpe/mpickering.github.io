<a href="Pty.hs8965443031474833169.out.html">prev</a></br><a href="failures.html">home</a></br><a href="PulseLatch.hs1212054001284660444.out.html">next</a></br></br><pre>15c15
<   (command:args) <- getArgs >>= \case [] -> error "usage: ptywrap [command to run]"
---
>   (command:args) <- getArgs >>=       [] -> error "usage: ptywrap [command to run]"
19d18
<   forever $ (tryIOError . readPty) pty >>= \
20c19
<     case Left e | isEOFError e -> waitForProcess proc >>= exitWith
---
>   forever $ (tryIOError . readPty) pty >>= 
20a20
>          Left e | isEOFError e -> waitForProcess proc >>= exitWith
22a23
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE LambdaCase #-}

import Control.Monad (forever, (>=>))
import qualified Data.ByteString.Char8 as C8

import System.Environment (getArgs)
import System.IO
import System.IO.Error
import System.Exit (exitWith)
import System.Process (waitForProcess)
import System.Posix.Pty

main :: IO ()
main = do
  (command:args) <- getArgs >>= \case [] -> error "usage: ptywrap [command to run]"
                                      x -> return x
  hSetBuffering stdout NoBuffering
  (pty, proc) <- spawnWithPty Nothing False command args (80, 25)
  forever $ (tryIOError . readPty) pty >>= \
    case Left e | isEOFError e -> waitForProcess proc >>= exitWith
         Left e -> ioError e
         Right s -> C8.putStr s
</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE LambdaCase #-}

import Control.Monad (forever, (>=>))
import qualified Data.ByteString.Char8 as C8

import System.Environment (getArgs)
import System.IO
import System.IO.Error
import System.Exit (exitWith)
import System.Process (waitForProcess)
import System.Posix.Pty

main :: IO ()
main = do
  (command:args) <- getArgs >>=       [] -> error "usage: ptywrap [command to run]"
                                      x -> return x
  hSetBuffering stdout NoBuffering
  (pty, proc) <- spawnWithPty Nothing False command args (80, 25)
  forever $ (tryIOError . readPty) pty >>= 
         Left e | isEOFError e -> waitForProcess proc >>= exitWith
         Left e -> ioError e
         Right s -> C8.putStr s

</pre>