<a href="Simple.hs11477222941070477904.out.html">prev</a></br><a href="failures.html">home</a></br><a href="Simple.hs12778441887638.out.html">next</a></br></br><pre>5c5
< import "monads-tf" Control.Monad.Trans
---
> import  Control.Monad.Trans
44a45
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE TypeFamilies, PackageImports #-}

module Network.XmlPush.Simple (SimplePusher, SimplePusherArgs(..)) where

import "monads-tf" Control.Monad.Trans
import Control.Monad
import Data.Maybe
import Data.HandleLike
import Data.Pipe
import Text.XML.Pipe
import Network.XmlPush

import qualified Data.ByteString as BS

data SimplePusher h = SimplePusher
    (Pipe () XmlNode (HandleMonad h) ())
    (Pipe XmlNode () (HandleMonad h) ())

data SimplePusherArgs h = SimplePusherArgsNull

instance XmlPusher SimplePusher where
    type NumOfHandle SimplePusher = One
    type PusherArgs SimplePusher = SimplePusherArgs
    generate (One h) _ = simplePusher h
    readFrom (SimplePusher r _) = r
    writeTo (SimplePusher _ w) = w

simplePusher :: HandleLike h => h -> HandleMonad h (SimplePusher h)
simplePusher h = return $ SimplePusher (readXml h) (writeXml h)

readXml :: HandleLike h => h -> Pipe () XmlNode (HandleMonad h) ()
readXml h = fromHandleLike h
    =$= xmlEvent
    =$= convert fromJust
    =$= void (xmlNode [])

writeXml :: HandleLike h => h -> Pipe XmlNode () (HandleMonad h) ()
writeXml h = convert (xmlString . (: [])) =$= toHandleLike h

fromHandleLike :: HandleLike h => h -> Pipe () BS.ByteString (HandleMonad h) ()
fromHandleLike h = lift (hlGetContent h) >>= yield >> fromHandleLike h

toHandleLike :: HandleLike h => h -> Pipe BS.ByteString () (HandleMonad h) ()
toHandleLike h = await >>= maybe (return ()) ((>> toHandleLike h) . lift . hlPut h)
</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE TypeFamilies, PackageImports #-}

module Network.XmlPush.Simple (SimplePusher, SimplePusherArgs(..)) where

import  Control.Monad.Trans
import Control.Monad
import Data.Maybe
import Data.HandleLike
import Data.Pipe
import Text.XML.Pipe
import Network.XmlPush

import qualified Data.ByteString as BS

data SimplePusher h = SimplePusher
    (Pipe () XmlNode (HandleMonad h) ())
    (Pipe XmlNode () (HandleMonad h) ())

data SimplePusherArgs h = SimplePusherArgsNull

instance XmlPusher SimplePusher where
    type NumOfHandle SimplePusher = One
    type PusherArgs SimplePusher = SimplePusherArgs
    generate (One h) _ = simplePusher h
    readFrom (SimplePusher r _) = r
    writeTo (SimplePusher _ w) = w

simplePusher :: HandleLike h => h -> HandleMonad h (SimplePusher h)
simplePusher h = return $ SimplePusher (readXml h) (writeXml h)

readXml :: HandleLike h => h -> Pipe () XmlNode (HandleMonad h) ()
readXml h = fromHandleLike h
    =$= xmlEvent
    =$= convert fromJust
    =$= void (xmlNode [])

writeXml :: HandleLike h => h -> Pipe XmlNode () (HandleMonad h) ()
writeXml h = convert (xmlString . (: [])) =$= toHandleLike h

fromHandleLike :: HandleLike h => h -> Pipe () BS.ByteString (HandleMonad h) ()
fromHandleLike h = lift (hlGetContent h) >>= yield >> fromHandleLike h

toHandleLike :: HandleLike h => h -> Pipe BS.ByteString () (HandleMonad h) ()
toHandleLike h = await >>= maybe (return ()) ((>> toHandleLike h) . lift . hlPut h)

</pre>