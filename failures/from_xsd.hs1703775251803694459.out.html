<a href="Framework.hs18238111511759921226.out.html">prev</a></br><a href="failures.html">home</a></br><a href="FromChurch.hs206327831030316714.out.html">next</a></br></br><pre>1d0
< #!/usr/bin/runhaskell
2a2
> 
35a36
> 
</pre></br><h2>original</h2></br><pre>#!/usr/bin/runhaskell

import Text.XML.HXT.Core
import Control.Monad

main :: IO ()
main = do
    [doc] <- runX $ readDocument [] "data/xhtml5.xsd"
    let elts = run doc $ this //> hasName "xs:element"
            >>> (getAttrValue0 "name" &&& this)
    forM_ elts $ \(name, node) ->
        processElement doc name node

processElement :: XmlTree -> String -> XmlTree -> IO ()
processElement doc name node = do
    let uattrs = run node $ this //> hasName "xs:attribute"
            >>> hasAttrValue "type" (== "uri") >>> getAttrValue0 "name"
    forM_ uattrs $ \attrb ->
        putStrLn $ name ++ " " ++ attrb

    let attrgs = run node $ this //> hasName "xs:attributeGroup"
            >>> getAttrValue0 "ref"
    forM_ attrgs $ \attrg -> do
        let l = run doc $ this //> hasName "xs:attributeGroup"
                >>> hasAttrValue "name" (== attrg)
        mapM_ (processElement doc name) l

    let typs = run node $ getAttrValue0 "type"
    forM_ typs $ \typ -> do
        let ctypes = run doc $ this //> hasName "xs:complexType"
                >>> hasAttrValue "name" (== typ)
        mapM_ (processElement doc name) ctypes

run :: a -> LA a b -> [b]
run = flip runLA
</pre></br><h2>printed</h2></br><pre>

import Text.XML.HXT.Core
import Control.Monad

main :: IO ()
main = do
    [doc] <- runX $ readDocument [] "data/xhtml5.xsd"
    let elts = run doc $ this //> hasName "xs:element"
            >>> (getAttrValue0 "name" &&& this)
    forM_ elts $ \(name, node) ->
        processElement doc name node

processElement :: XmlTree -> String -> XmlTree -> IO ()
processElement doc name node = do
    let uattrs = run node $ this //> hasName "xs:attribute"
            >>> hasAttrValue "type" (== "uri") >>> getAttrValue0 "name"
    forM_ uattrs $ \attrb ->
        putStrLn $ name ++ " " ++ attrb

    let attrgs = run node $ this //> hasName "xs:attributeGroup"
            >>> getAttrValue0 "ref"
    forM_ attrgs $ \attrg -> do
        let l = run doc $ this //> hasName "xs:attributeGroup"
                >>> hasAttrValue "name" (== attrg)
        mapM_ (processElement doc name) l

    let typs = run node $ getAttrValue0 "type"
    forM_ typs $ \typ -> do
        let ctypes = run doc $ this //> hasName "xs:complexType"
                >>> hasAttrValue "name" (== typ)
        mapM_ (processElement doc name) ctypes

run :: a -> LA a b -> [b]
run = flip runLA

</pre>