<a href="Lit.hs1473392040666082723.out.html">prev</a></br><a href="failures.html">home</a></br><a href="Literal.hs1194314738318153057.out.html">next</a></br></br><pre>35c35
<         , Just ""       <- stripPrefix "#" str2
---
>           Just ""       <- stripPrefix "#" str2
47c47
<         , not $ null ds
---
>           not $ null ds
64d63
<         , not $ null ds
65d63
<         , Just str4     <- stripPrefix "w" str3
66d63
<         , (bs, "#")     <- span isDigit str4
67d63
<         , not $ null bs
68d63
<         , bits          <- read bs
69c64
<         , length ds     <= bits
---
>           not $ null ds
69a65
>           Just str4     <- stripPrefix "w" str3
69a66
>           (bs, "#")     <- span isDigit str4
69a67
>           not $ null bs
69a68
>           bits          <- read bs
69a69
>           length ds     <= bits
75d74
<         , Just str3     <- stripPrefix "w" str2
76d74
<         , (bs, "#")     <- span isDigit str3
77c75
<         , not $ null bs
---
>           Just str3     <- stripPrefix "w" str2
77a76
>           (bs, "#")     <- span isDigit str3
77a77
>           not $ null bs
93d92
<         , Just str3     <- stripPrefix "." str2
94d92
<         , (ds2, str4)   <- span isDigit str3
95d92
<         , not $ null ds2
96d92
<         , Just str5     <- stripPrefix "f" str4
97d92
<         , (bs, "#")     <- span isDigit str5
98c93
<         , not $ null bs
---
>           Just str3     <- stripPrefix "." str2
98a94
>           (ds2, str4)   <- span isDigit str3
98a95
>           not $ null ds2
98a96
>           Just str5     <- stripPrefix "f" str4
98a97
>           (bs, "#")     <- span isDigit str5
98a98
>           not $ null bs
110a111
> 
</pre></br><h2>original</h2></br><pre>
-- | Reading literal values.
module DDC.Core.Salt.Name.Lit
        ( readLitInteger
        , readLitPrimNat
        , readLitPrimInt
        , readLitPrimWordOfBits
        , readLitPrimFloatOfBits)

where
import Data.List
import Data.Char


-- | Read a signed integer.
readLitInteger :: String -> Maybe Integer
readLitInteger []       = Nothing
readLitInteger str@(c:cs)
        | '-'   <- c
        , all isDigit cs
        = Just $ read str

        | all isDigit str
        = Just $ read str

        | otherwise
        = Nothing


-- | Read an integer with an explicit format specifier like @1234i#@.
readLitPrimNat :: String -> Maybe Integer
readLitPrimNat str1
        | (ds, str2)    <- span isDigit str1
        , not $ null ds
        , Just ""       <- stripPrefix "#" str2
        = Just $ read ds

        | otherwise
        = Nothing


-- | Read an integer literal with an explicit format specifier like @1234i#@.
readLitPrimInt :: String -> Maybe Integer
readLitPrimInt str1
        | '-' : str2    <- str1
        , (ds, "i#")    <- span isDigit str2
        , not $ null ds
        = Just $ read ds

        | (ds, "i#")    <- span isDigit str1
        , not $ null ds
        = Just $ read ds

        | otherwise
        = Nothing


-- | Read a word with an explicit format speficier.
readLitPrimWordOfBits :: String -> Maybe (Integer, Int)
readLitPrimWordOfBits str1
        -- binary like 0b01001w32#
        | Just str2     <- stripPrefix "0b" str1
        , (ds, str3)    <- span (\c -> c == '0' || c == '1') str2
        , not $ null ds
        , Just str4     <- stripPrefix "w" str3
        , (bs, "#")     <- span isDigit str4
        , not $ null bs
        , bits          <- read bs
        , length ds     <= bits
        = Just (readBinary ds, bits)

        -- decimal like 1234w32#
        | (ds, str2)    <- span isDigit str1
        , not $ null ds
        , Just str3     <- stripPrefix "w" str2
        , (bs, "#")     <- span isDigit str3
        , not $ null bs
        = Just (read ds, read bs)

        | otherwise
        = Nothing


-- | Read a float literal with an explicit format specifier like @123.00f32#@.
readLitPrimFloatOfBits :: String -> Maybe (Double, Int)
readLitPrimFloatOfBits str1
        | '-' : str2    <- str1
        , Just (d, bs)  <- readLitPrimFloatOfBits str2
        = Just (negate d, bs)

        | (ds1, str2)   <- span isDigit str1
        , not $ null ds1
        , Just str3     <- stripPrefix "." str2
        , (ds2, str4)   <- span isDigit str3
        , not $ null ds2
        , Just str5     <- stripPrefix "f" str4
        , (bs, "#")     <- span isDigit str5
        , not $ null bs
        = Just (read (ds1 ++ "." ++ ds2), read bs)

        | otherwise
        = Nothing


-- | Read a binary string as a number.
readBinary :: (Num a, Read a) => String -> a
readBinary digits
        = foldl' (\ acc b -> if b then 2 * acc + 1 else 2 * acc) 0
        $ map (/= '0') digits

</pre></br><h2>printed</h2></br><pre>
-- | Reading literal values.
module DDC.Core.Salt.Name.Lit
        ( readLitInteger
        , readLitPrimNat
        , readLitPrimInt
        , readLitPrimWordOfBits
        , readLitPrimFloatOfBits)

where
import Data.List
import Data.Char


-- | Read a signed integer.
readLitInteger :: String -> Maybe Integer
readLitInteger []       = Nothing
readLitInteger str@(c:cs)
        | '-'   <- c
        , all isDigit cs
        = Just $ read str

        | all isDigit str
        = Just $ read str

        | otherwise
        = Nothing


-- | Read an integer with an explicit format specifier like @1234i#@.
readLitPrimNat :: String -> Maybe Integer
readLitPrimNat str1
        | (ds, str2)    <- span isDigit str1
        , not $ null ds
          Just ""       <- stripPrefix "#" str2
        = Just $ read ds

        | otherwise
        = Nothing


-- | Read an integer literal with an explicit format specifier like @1234i#@.
readLitPrimInt :: String -> Maybe Integer
readLitPrimInt str1
        | '-' : str2    <- str1
        , (ds, "i#")    <- span isDigit str2
          not $ null ds
        = Just $ read ds

        | (ds, "i#")    <- span isDigit str1
        , not $ null ds
        = Just $ read ds

        | otherwise
        = Nothing


-- | Read a word with an explicit format speficier.
readLitPrimWordOfBits :: String -> Maybe (Integer, Int)
readLitPrimWordOfBits str1
        -- binary like 0b01001w32#
        | Just str2     <- stripPrefix "0b" str1
        , (ds, str3)    <- span (\c -> c == '0' || c == '1') str2
          not $ null ds
          Just str4     <- stripPrefix "w" str3
          (bs, "#")     <- span isDigit str4
          not $ null bs
          bits          <- read bs
          length ds     <= bits
        = Just (readBinary ds, bits)

        -- decimal like 1234w32#
        | (ds, str2)    <- span isDigit str1
        , not $ null ds
          Just str3     <- stripPrefix "w" str2
          (bs, "#")     <- span isDigit str3
          not $ null bs
        = Just (read ds, read bs)

        | otherwise
        = Nothing


-- | Read a float literal with an explicit format specifier like @123.00f32#@.
readLitPrimFloatOfBits :: String -> Maybe (Double, Int)
readLitPrimFloatOfBits str1
        | '-' : str2    <- str1
        , Just (d, bs)  <- readLitPrimFloatOfBits str2
        = Just (negate d, bs)

        | (ds1, str2)   <- span isDigit str1
        , not $ null ds1
          Just str3     <- stripPrefix "." str2
          (ds2, str4)   <- span isDigit str3
          not $ null ds2
          Just str5     <- stripPrefix "f" str4
          (bs, "#")     <- span isDigit str5
          not $ null bs
        = Just (read (ds1 ++ "." ++ ds2), read bs)

        | otherwise
        = Nothing


-- | Read a binary string as a number.
readBinary :: (Num a, Read a) => String -> a
readBinary digits
        = foldl' (\ acc b -> if b then 2 * acc + 1 else 2 * acc) 0
        $ map (/= '0') digits


</pre>