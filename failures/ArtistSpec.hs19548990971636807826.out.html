<a href="AppSpineGam.hs1974930991404280278.out.html">prev</a></br><a href="failures.html">home</a></br><a href="ArtistSpec.hs8933518161505795335.out.html">next</a></br></br><pre>17d16
<   it "addTags" $
18d16
<     shouldHaveXml_ . privately $
19c17
<       addTags <*> artist "Егор Летов" <*> tags ["russian", "black metal"]
---
>   it "addTags" $
19a18
>     shouldHaveXml_ . privately $
19a19
>       addTags <*> artist "Егор Летов" <*> tags ["russian", "black metal"]
21c21
<   it "getTags-authenticated" $
---
>   it "getTags-authenticated" $
24c24
<     root.node "tags".node "tag".node "name".text
---
>     root.node "tags".node "tag".node "name".text
26d25
<   it "removeTag" $
27c26
<     shouldHaveXml_ . privately $
---
>   it "removeTag" $
27a27
>     shouldHaveXml_ . privately $
30d29
<   it "share" $
31c30
<     shouldHaveXml_ . privately $
---
>   it "share" $
31a31
>     shouldHaveXml_ . privately $
34d33
<   it "getCorrection" $
35c34
<     publicly (getCorrection <*> artist "Meshugah")
---
>   it "getCorrection" $
35a35
>     publicly (getCorrection <*> artist "Meshugah")
37c37
<     root.node "corrections".node "correction".node "artist".node "name".text
---
>     root.node "corrections".node "correction".node "artist".node "name".text
43d42
<     it "getEvents" $
44c43
<       publicly (getEvents <*> artist "Meshuggah" <* limit 2)
---
>     it "getEvents" $
44a44
>       publicly (getEvents <*> artist "Meshuggah" <* limit 2)
46c46
<       xmlQuery
---
>       xmlQuery
48d47
<     it "getEvents_mbid" $
49c48
<       publicly (getEvents <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 2)
---
>     it "getEvents_mbid" $
49a49
>       publicly (getEvents <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 2)
51c51
<       xmlQuery
---
>       xmlQuery
57d56
<     it "getInfo" $
58c57
<       publicly (getInfo <*> artist "Meshuggah")
---
>     it "getInfo" $
58a58
>       publicly (getInfo <*> artist "Meshuggah")
60c60
<       xmlQuery
---
>       xmlQuery
62d61
<     it "getInfo_mbid" $
63c62
<       publicly (getInfo <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
---
>     it "getInfo_mbid" $
63a63
>       publicly (getInfo <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
65c65
<       xmlQuery
---
>       xmlQuery
71c71
<     it "getPastEvents" $
---
>     it "getPastEvents" $
74c74
<       xmlQuery
---
>       xmlQuery
76c76
<     it "getPastEvents_mbid" $
---
>     it "getPastEvents_mbid" $
79c79
<       xmlQuery
---
>       xmlQuery
85d84
<     it "getPodcast" $
86c85
<       publicly (getPodcast <*> artist "Meshuggah")
---
>     it "getPodcast" $
86a86
>       publicly (getPodcast <*> artist "Meshuggah")
88c88
<       xmlQuery
---
>       xmlQuery
90d89
<     it "getPodcast_mbid" $
91c90
<       publicly (getPodcast <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
---
>     it "getPodcast_mbid" $
91a91
>       publicly (getPodcast <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
93c93
<       xmlQuery
---
>       xmlQuery
99d98
<     it "getShouts" $
100c99
<       publicly (getShouts <*> artist "Meshuggah" <* limit 5)
---
>     it "getShouts" $
100a100
>       publicly (getShouts <*> artist "Meshuggah" <* limit 5)
102c102
<       xmlQuery
---
>       xmlQuery
104d103
<     it "getShouts_mbid" $
105c104
<       publicly (getShouts <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 5)
---
>     it "getShouts_mbid" $
105a105
>       publicly (getShouts <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 5)
107c107
<       xmlQuery
---
>       xmlQuery
113d112
<     it "getSimilar" $
114c113
<       publicly (getSimilar <*> artist "Meshuggah" <* limit 3)
---
>     it "getSimilar" $
114a114
>       publicly (getSimilar <*> artist "Meshuggah" <* limit 3)
116c116
<       xmlQuery
---
>       xmlQuery
118d117
<     it "getSimilar_mbid" $
119c118
<       publicly (getSimilar <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
---
>     it "getSimilar_mbid" $
119a119
>       publicly (getSimilar <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
121c121
<       xmlQuery
---
>       xmlQuery
127d126
<     it "getTags" $
128c127
<       publicly (getTags <*> artist "Егор Летов" <* user "liblastfm")
---
>     it "getTags" $
128a128
>       publicly (getTags <*> artist "Егор Летов" <* user "liblastfm")
130c130
<       xmlQuery
---
>       xmlQuery
132d131
<     it "getTags_mbid" $
133c132
<       publicly (getTags <*> mbid "cfb3d32e-d095-4d63-946d-9daf06932180" <* user "liblastfm")
---
>     it "getTags_mbid" $
133a133
>       publicly (getTags <*> mbid "cfb3d32e-d095-4d63-946d-9daf06932180" <* user "liblastfm")
135c135
<       xmlQuery
---
>       xmlQuery
141d140
<     it "getTopAlbums" $
142c141
<       publicly (getTopAlbums <*> artist "Meshuggah" <* limit 3)
---
>     it "getTopAlbums" $
142a142
>       publicly (getTopAlbums <*> artist "Meshuggah" <* limit 3)
144c144
<       xmlQuery
---
>       xmlQuery
146d145
<     it "getTopAlbums_mbid" $
147c146
<       publicly (getTopAlbums <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
---
>     it "getTopAlbums_mbid" $
147a147
>       publicly (getTopAlbums <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
149c149
<       xmlQuery
---
>       xmlQuery
155d154
<     it "getTopFans" $
156c155
<       publicly (getTopFans <*> artist "Meshuggah")
---
>     it "getTopFans" $
156a156
>       publicly (getTopFans <*> artist "Meshuggah")
158c158
<       xmlQuery
---
>       xmlQuery
160d159
<     it "getTopFans_mbid" $
161c160
<       publicly (getTopFans <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
---
>     it "getTopFans_mbid" $
161a161
>       publicly (getTopFans <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
163c163
<       xmlQuery
---
>       xmlQuery
169d168
<     it "getTopTags" $
170c169
<       publicly (getTopTags <*> artist "Meshuggah")
---
>     it "getTopTags" $
170a170
>       publicly (getTopTags <*> artist "Meshuggah")
172c172
<       xmlQuery
---
>       xmlQuery
174d173
<     it "getTopTags_mbid" $
175c174
<       publicly (getTopTags <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
---
>     it "getTopTags_mbid" $
175a175
>       publicly (getTopTags <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
177c177
<       xmlQuery
---
>       xmlQuery
183d182
<     it "getTopTracks" $
184c183
<       publicly (getTopTracks <*> artist "Meshuggah" <* limit 3)
---
>     it "getTopTracks" $
184a184
>       publicly (getTopTracks <*> artist "Meshuggah" <* limit 3)
186c186
<       xmlQuery
---
>       xmlQuery
188d187
<     it "getTopTracks_mbid" $
189c188
<       publicly (getTopTracks <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
---
>     it "getTopTracks_mbid" $
189a189
>       publicly (getTopTracks <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
191c191
<       xmlQuery
---
>       xmlQuery
193c193
<   it "search" $
---
>   it "search" $
196c196
<     root.node "results".node "artistmatches".node "artist".node "name".text
---
>     root.node "results".node "artistmatches".node "artist".node "name".text
196a197
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE DataKinds #-}
{-# LANGUAGE OverloadedStrings #-}
module Xml.ArtistSpec (spec) where

import Data.Text (Text)
import Data.Traversable (traverse)
import Network.Lastfm
import Network.Lastfm.Artist
import Test.Hspec
import Text.Xml.Lens

import SpecHelper


spec :: Spec
spec = do
  it "addTags" $
    shouldHaveXml_ . privately $
      addTags <*> artist "Егор Летов" <*> tags ["russian", "black metal"]

  it "getTags-authenticated" $
    privately (getTags <*> artist "Егор Летов")
   `shouldHaveXml`
    root.node "tags".node "tag".node "name".text

  it "removeTag" $
    shouldHaveXml_ . privately $
      removeTag <*> artist "Егор Летов" <*> tag "russian"

  it "share" $
    shouldHaveXml_ . privately $
      share <*> artist "Sleep" <*> recipient "liblastfm" <* message "Just listen!"

  it "getCorrection" $
    publicly (getCorrection <*> artist "Meshugah")
   `shouldHaveXml`
    root.node "corrections".node "correction".node "artist".node "name".text

  describe "getEvents*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "events".attr "artist".traverse

    it "getEvents" $
      publicly (getEvents <*> artist "Meshuggah" <* limit 2)
     `shouldHaveXml`
      xmlQuery

    it "getEvents_mbid" $
      publicly (getEvents <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 2)
     `shouldHaveXml`
      xmlQuery

  describe "getInfo*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "artist".node "stats".node "listeners".text

    it "getInfo" $
      publicly (getInfo <*> artist "Meshuggah")
     `shouldHaveXml`
      xmlQuery

    it "getInfo_mbid" $
      publicly (getInfo <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
     `shouldHaveXml`
      xmlQuery

  describe "getPastEvents*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "events".node "event".node "title".text

    it "getPastEvents" $
      publicly (getPastEvents <*> artist "Meshuggah" <* autocorrect True)
     `shouldHaveXml`
      xmlQuery

    it "getPastEvents_mbid" $
      publicly (getPastEvents <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* autocorrect True)
     `shouldHaveXml`
      xmlQuery

  describe "getPodcast*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "rss".node "channel".node "description".text

    it "getPodcast" $
      publicly (getPodcast <*> artist "Meshuggah")
     `shouldHaveXml`
      xmlQuery

    it "getPodcast_mbid" $
      publicly (getPodcast <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
     `shouldHaveXml`
      xmlQuery

  describe "getShouts*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "shouts".node "shout".node "author".text

    it "getShouts" $
      publicly (getShouts <*> artist "Meshuggah" <* limit 5)
     `shouldHaveXml`
      xmlQuery

    it "getShouts_mbid" $
      publicly (getShouts <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 5)
     `shouldHaveXml`
      xmlQuery

  describe "getSimilar*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "similarartists".node "artist".node "name".text

    it "getSimilar" $
      publicly (getSimilar <*> artist "Meshuggah" <* limit 3)
     `shouldHaveXml`
      xmlQuery

    it "getSimilar_mbid" $
      publicly (getSimilar <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
     `shouldHaveXml`
      xmlQuery

  describe "getTags*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "tags".node "tag".node "name".text

    it "getTags" $
      publicly (getTags <*> artist "Егор Летов" <* user "liblastfm")
     `shouldHaveXml`
      xmlQuery

    it "getTags_mbid" $
      publicly (getTags <*> mbid "cfb3d32e-d095-4d63-946d-9daf06932180" <* user "liblastfm")
     `shouldHaveXml`
      xmlQuery

  describe "getTopAlbums*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "topalbums".node "album".node "name".text

    it "getTopAlbums" $
      publicly (getTopAlbums <*> artist "Meshuggah" <* limit 3)
     `shouldHaveXml`
      xmlQuery

    it "getTopAlbums_mbid" $
      publicly (getTopAlbums <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
     `shouldHaveXml`
      xmlQuery

  describe "getTopFans*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "topfans".node "user".node "name".text

    it "getTopFans" $
      publicly (getTopFans <*> artist "Meshuggah")
     `shouldHaveXml`
      xmlQuery

    it "getTopFans_mbid" $
      publicly (getTopFans <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
     `shouldHaveXml`
      xmlQuery

  describe "getTopTags*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "toptags".node "tag".node "name".text

    it "getTopTags" $
      publicly (getTopTags <*> artist "Meshuggah")
     `shouldHaveXml`
      xmlQuery

    it "getTopTags_mbid" $
      publicly (getTopTags <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
     `shouldHaveXml`
      xmlQuery

  describe "getTopTracks*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "toptracks".node "track".node "name".text

    it "getTopTracks" $
      publicly (getTopTracks <*> artist "Meshuggah" <* limit 3)
     `shouldHaveXml`
      xmlQuery

    it "getTopTracks_mbid" $
      publicly (getTopTracks <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
     `shouldHaveXml`
      xmlQuery

  it "search" $
    publicly (search <*> artist "Mesh" <* limit 3)
   `shouldHaveXml`
    root.node "results".node "artistmatches".node "artist".node "name".text
</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE DataKinds #-}
{-# LANGUAGE OverloadedStrings #-}
module Xml.ArtistSpec (spec) where

import Data.Text (Text)
import Data.Traversable (traverse)
import Network.Lastfm
import Network.Lastfm.Artist
import Test.Hspec
import Text.Xml.Lens

import SpecHelper


spec :: Spec
spec = do
  it "addTags" $
    shouldHaveXml_ . privately $
      addTags <*> artist "Егор Летов" <*> tags ["russian", "black metal"]

  it "getTags-authenticated" $
    privately (getTags <*> artist "Егор Летов")
   `shouldHaveXml`
    root.node "tags".node "tag".node "name".text

  it "removeTag" $
    shouldHaveXml_ . privately $
      removeTag <*> artist "Егор Летов" <*> tag "russian"

  it "share" $
    shouldHaveXml_ . privately $
      share <*> artist "Sleep" <*> recipient "liblastfm" <* message "Just listen!"

  it "getCorrection" $
    publicly (getCorrection <*> artist "Meshugah")
   `shouldHaveXml`
    root.node "corrections".node "correction".node "artist".node "name".text

  describe "getEvents*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "events".attr "artist".traverse

    it "getEvents" $
      publicly (getEvents <*> artist "Meshuggah" <* limit 2)
     `shouldHaveXml`
      xmlQuery

    it "getEvents_mbid" $
      publicly (getEvents <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 2)
     `shouldHaveXml`
      xmlQuery

  describe "getInfo*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "artist".node "stats".node "listeners".text

    it "getInfo" $
      publicly (getInfo <*> artist "Meshuggah")
     `shouldHaveXml`
      xmlQuery

    it "getInfo_mbid" $
      publicly (getInfo <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
     `shouldHaveXml`
      xmlQuery

  describe "getPastEvents*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "events".node "event".node "title".text

    it "getPastEvents" $
      publicly (getPastEvents <*> artist "Meshuggah" <* autocorrect True)
     `shouldHaveXml`
      xmlQuery

    it "getPastEvents_mbid" $
      publicly (getPastEvents <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* autocorrect True)
     `shouldHaveXml`
      xmlQuery

  describe "getPodcast*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "rss".node "channel".node "description".text

    it "getPodcast" $
      publicly (getPodcast <*> artist "Meshuggah")
     `shouldHaveXml`
      xmlQuery

    it "getPodcast_mbid" $
      publicly (getPodcast <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
     `shouldHaveXml`
      xmlQuery

  describe "getShouts*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "shouts".node "shout".node "author".text

    it "getShouts" $
      publicly (getShouts <*> artist "Meshuggah" <* limit 5)
     `shouldHaveXml`
      xmlQuery

    it "getShouts_mbid" $
      publicly (getShouts <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 5)
     `shouldHaveXml`
      xmlQuery

  describe "getSimilar*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "similarartists".node "artist".node "name".text

    it "getSimilar" $
      publicly (getSimilar <*> artist "Meshuggah" <* limit 3)
     `shouldHaveXml`
      xmlQuery

    it "getSimilar_mbid" $
      publicly (getSimilar <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
     `shouldHaveXml`
      xmlQuery

  describe "getTags*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "tags".node "tag".node "name".text

    it "getTags" $
      publicly (getTags <*> artist "Егор Летов" <* user "liblastfm")
     `shouldHaveXml`
      xmlQuery

    it "getTags_mbid" $
      publicly (getTags <*> mbid "cfb3d32e-d095-4d63-946d-9daf06932180" <* user "liblastfm")
     `shouldHaveXml`
      xmlQuery

  describe "getTopAlbums*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "topalbums".node "album".node "name".text

    it "getTopAlbums" $
      publicly (getTopAlbums <*> artist "Meshuggah" <* limit 3)
     `shouldHaveXml`
      xmlQuery

    it "getTopAlbums_mbid" $
      publicly (getTopAlbums <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
     `shouldHaveXml`
      xmlQuery

  describe "getTopFans*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "topfans".node "user".node "name".text

    it "getTopFans" $
      publicly (getTopFans <*> artist "Meshuggah")
     `shouldHaveXml`
      xmlQuery

    it "getTopFans_mbid" $
      publicly (getTopFans <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
     `shouldHaveXml`
      xmlQuery

  describe "getTopTags*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "toptags".node "tag".node "name".text

    it "getTopTags" $
      publicly (getTopTags <*> artist "Meshuggah")
     `shouldHaveXml`
      xmlQuery

    it "getTopTags_mbid" $
      publicly (getTopTags <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413")
     `shouldHaveXml`
      xmlQuery

  describe "getTopTracks*" $ do
    let xmlQuery :: Fold Document Text
        xmlQuery = root.node "toptracks".node "track".node "name".text

    it "getTopTracks" $
      publicly (getTopTracks <*> artist "Meshuggah" <* limit 3)
     `shouldHaveXml`
      xmlQuery

    it "getTopTracks_mbid" $
      publicly (getTopTracks <*> mbid "cf8b3b8c-118e-4136-8d1d-c37091173413" <* limit 3)
     `shouldHaveXml`
      xmlQuery

  it "search" $
    publicly (search <*> artist "Mesh" <* limit 3)
   `shouldHaveXml`
    root.node "results".node "artistmatches".node "artist".node "name".text

</pre>