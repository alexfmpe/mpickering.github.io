<a href="Check.hs1290659378379847699.out.html">prev</a></br><a href="failures.html">home</a></br><a href="CheckBuildPlan.hs195400260589673557.out.html">next</a></br></br><pre>30d29
<                  , Just (TyConSpec TcConSusp, [_tEff, tRet]) <- takeTyConApps t2
31c30
<                  , tRet == tUnit
---
>                    Just (TyConSpec TcConSusp, [_tEff, tRet]) <- takeTyConApps t2
31a31
>                    tRet == tUnit
43a44
> 
</pre></br><h2>original</h2></br><pre>
module DDC.Core.Tetra.Check
        (checkModule)
where
import DDC.Core.Tetra.Compounds
import DDC.Core.Tetra.Error
import DDC.Core.Tetra.Prim
import DDC.Core.Module
import DDC.Type.Exp


-- | Perform Core Tetra specific checks on a module.
checkModule :: Module a Name -> Maybe (Error a)
checkModule mm

 -- Check that the 'Main' module exports a 'main' function.
 | moduleName mm == ModuleName ["Main"]
 = case lookup (NameVar "main") $ moduleExportValues mm of

        -- Main module does not export any main function.
        Nothing
         -> Just ErrorMainMissing

        -- Main function exports a main function with the correct mode.
        Just (ExportSourceLocal _ tMain)
         -> let -- .. and the type is ok.
                check
                 | Just (t1, t2)                             <- takeTFun tMain
                 , t1 == tUnit
                 , Just (TyConSpec TcConSusp, [_tEff, tRet]) <- takeTyConApps t2
                 , tRet == tUnit
                 = Nothing

                 -- .. but it has an invalid type.
                 | otherwise
                 = Just (ErrorMainInvalidType tMain)
            in check

        -- Main module exports
        Just _  -> Just ErrorMainInvalidMode

 | otherwise
 = Nothing
</pre></br><h2>printed</h2></br><pre>
module DDC.Core.Tetra.Check
        (checkModule)
where
import DDC.Core.Tetra.Compounds
import DDC.Core.Tetra.Error
import DDC.Core.Tetra.Prim
import DDC.Core.Module
import DDC.Type.Exp


-- | Perform Core Tetra specific checks on a module.
checkModule :: Module a Name -> Maybe (Error a)
checkModule mm

 -- Check that the 'Main' module exports a 'main' function.
 | moduleName mm == ModuleName ["Main"]
 = case lookup (NameVar "main") $ moduleExportValues mm of

        -- Main module does not export any main function.
        Nothing
         -> Just ErrorMainMissing

        -- Main function exports a main function with the correct mode.
        Just (ExportSourceLocal _ tMain)
         -> let -- .. and the type is ok.
                check
                 | Just (t1, t2)                             <- takeTFun tMain
                 , t1 == tUnit
                   Just (TyConSpec TcConSusp, [_tEff, tRet]) <- takeTyConApps t2
                   tRet == tUnit
                 = Nothing

                 -- .. but it has an invalid type.
                 | otherwise
                 = Just (ErrorMainInvalidType tMain)
            in check

        -- Main module exports
        Just _  -> Just ErrorMainInvalidMode

 | otherwise
 = Nothing

</pre>