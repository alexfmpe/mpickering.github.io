<a href="HMM.hs2020739063107554536.out.html">prev</a></br><a href="failures.html">home</a></br><a href="Hooks.hs3228420821463179852.out.html">next</a></br></br><pre>25c25
< class Monad m ⇒ HoistError m t e e' | t → e where
---
> class Monad m => HoistError m t e e' | t -> e where
31d30
<     ∷ (e → e')
32d30
<     → t α
33c31
<     → m α
---
>     :: (e -> e')
33a32
>     -> t α
33a33
>     -> m α
35c35
< instance MonadError e m ⇒ HoistError m Maybe () e where
---
> instance MonadError e m => HoistError m Maybe () e where
38c38
< instance MonadError e' m ⇒ HoistError m (Either e) e e' where
---
> instance MonadError e' m => HoistError m (Either e) e e' where
41c41
< instance (m ~ n, MonadError e' m) ⇒ HoistError m (EitherT e n) e e' where
---
> instance (m ~ n, MonadError e' m) => HoistError m (EitherT e n) e e' where
46d45
<   ∷ HoistError m t e e'
47d45
<   ⇒ t α
48d45
<   → (e → e')
49c46
<   → m α
---
>   :: HoistError m t e e'
49a47
>   => t α
49a48
>   -> (e -> e')
49a49
>   -> m α
58d57
<   ∷ HoistError m t e e'
59d57
<   ⇒ m (t α)
60d57
<   → (e → e')
61c58
<   → m α
---
>   :: HoistError m t e e'
61a59
>   => m (t α)
61a60
>   -> (e -> e')
61a61
>   -> m α
63c63
<   x ← m
---
>   x <- m
73d72
<   ∷ HoistError m t e e'
74d72
<   ⇒ t α
75d72
<   → e'
76c73
<   → m α
---
>   :: HoistError m t e e'
76a74
>   => t α
76a75
>   -> e'
76a76
>   -> m α
84d83
<   ∷ HoistError m t e e'
85d83
<   ⇒ m (t α)
86d83
<   → e'
87c84
<   → m α
---
>   :: HoistError m t e e'
87a85
>   => m (t α)
87a86
>   -> e'
87a87
>   -> m α
89c89
<   x ← m
---
>   x <- m
93a94
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE FlexibleInstances #-}
{-# LANGUAGE FunctionalDependencies #-}
{-# LANGUAGE GADTs #-}
{-# LANGUAGE MultiParamTypeClasses #-}
{-# LANGUAGE UnicodeSyntax #-}

module Control.Monad.Error.Hoist
( HoistError(..)
, (<%?>)
, (<%!?>)
, (<?>)
, (<!?>)
) where

import Control.Monad.Error.Class
import Control.Monad.Trans.Either

import Control.Monad.Trans

-- | A tricky class for easily hoisting errors out of partiality types (e.g.
-- 'Maybe', @'Either' e@) into a monad. The parameter @e@ represents the error
-- information carried by the partiality type @t@, and @e'@ represents the type
-- of error expected in the monad @m@.
--
class Monad m ⇒ HoistError m t e e' | t → e where

  -- | Given a conversion from the error in @t α@ to @e'@, we can hoist the
  -- computation into @m@.
  --
  hoistError
    ∷ (e → e')
    → t α
    → m α

instance MonadError e m ⇒ HoistError m Maybe () e where
  hoistError f = maybe (throwError $ f ()) return

instance MonadError e' m ⇒ HoistError m (Either e) e e' where
  hoistError f = either (throwError . f) return

instance (m ~ n, MonadError e' m) ⇒ HoistError m (EitherT e n) e e' where
  hoistError f = eitherT (throwError . f) return

-- | A flipped synonym for 'hoistError'.
(<%?>)
  ∷ HoistError m t e e'
  ⇒ t α
  → (e → e')
  → m α
(<%?>) = flip hoistError

infixl 8 <%?>
{-# INLINE (<%?>) #-}

-- | A version of '<%?>' that operates on values already in the monad.
--
(<%!?>)
  ∷ HoistError m t e e'
  ⇒ m (t α)
  → (e → e')
  → m α
m <%!?> e = do
  x ← m
  x <%?> e

infixl 8 <%!?>
{-# INLINE (<%!?>) #-}

-- | A version of @hoistError@ that ignores the error in @t α@ and replaces it
-- with a new one in @e'@.
--
(<?>)
  ∷ HoistError m t e e'
  ⇒ t α
  → e'
  → m α
m <?> e = m <%?> const e

infixl 8 <?>
{-# INLINE (<?>) #-}

-- | A version of @<?>@ that operates on values already in the monad.
(<!?>)
  ∷ HoistError m t e e'
  ⇒ m (t α)
  → e'
  → m α
m <!?> e = do
  x ← m
  x <?> e

infixl 8 <!?>
{-# INLINE (<!?>) #-}
</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE FlexibleInstances #-}
{-# LANGUAGE FunctionalDependencies #-}
{-# LANGUAGE GADTs #-}
{-# LANGUAGE MultiParamTypeClasses #-}
{-# LANGUAGE UnicodeSyntax #-}

module Control.Monad.Error.Hoist
( HoistError(..)
, (<%?>)
, (<%!?>)
, (<?>)
, (<!?>)
) where

import Control.Monad.Error.Class
import Control.Monad.Trans.Either

import Control.Monad.Trans

-- | A tricky class for easily hoisting errors out of partiality types (e.g.
-- 'Maybe', @'Either' e@) into a monad. The parameter @e@ represents the error
-- information carried by the partiality type @t@, and @e'@ represents the type
-- of error expected in the monad @m@.
--
class Monad m => HoistError m t e e' | t -> e where

  -- | Given a conversion from the error in @t α@ to @e'@, we can hoist the
  -- computation into @m@.
  --
  hoistError
    :: (e -> e')
    -> t α
    -> m α

instance MonadError e m => HoistError m Maybe () e where
  hoistError f = maybe (throwError $ f ()) return

instance MonadError e' m => HoistError m (Either e) e e' where
  hoistError f = either (throwError . f) return

instance (m ~ n, MonadError e' m) => HoistError m (EitherT e n) e e' where
  hoistError f = eitherT (throwError . f) return

-- | A flipped synonym for 'hoistError'.
(<%?>)
  :: HoistError m t e e'
  => t α
  -> (e -> e')
  -> m α
(<%?>) = flip hoistError

infixl 8 <%?>
{-# INLINE (<%?>) #-}

-- | A version of '<%?>' that operates on values already in the monad.
--
(<%!?>)
  :: HoistError m t e e'
  => m (t α)
  -> (e -> e')
  -> m α
m <%!?> e = do
  x <- m
  x <%?> e

infixl 8 <%!?>
{-# INLINE (<%!?>) #-}

-- | A version of @hoistError@ that ignores the error in @t α@ and replaces it
-- with a new one in @e'@.
--
(<?>)
  :: HoistError m t e e'
  => t α
  -> e'
  -> m α
m <?> e = m <%?> const e

infixl 8 <?>
{-# INLINE (<?>) #-}

-- | A version of @<?>@ that operates on values already in the monad.
(<!?>)
  :: HoistError m t e e'
  => m (t α)
  -> e'
  -> m α
m <!?> e = do
  x <- m
  x <?> e

infixl 8 <!?>
{-# INLINE (<!?>) #-}

</pre>