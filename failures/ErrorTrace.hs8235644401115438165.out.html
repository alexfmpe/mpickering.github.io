<a href="ErrorName.hs10040168551732267506.out.html">prev</a></br><a href="failures.html">home</a></br><a href="ESSA.hs5950286351962408013.out.html">next</a></br></br><pre>22d21
<   { _etError ∷ !e -- ^ The error
23c22
<   , _etTrace ∷ ![Seq t] -- ^ The list of traces (for each path tried)
---
>   { _etError :: !e -- ^ The error
23a23
>   , _etTrace :: ![Seq t] -- ^ The list of traces (for each path tried)
26c26
< instance Monoid e ⇒ Monoid (ErrorTrace t e) where
---
> instance Monoid e => Monoid (ErrorTrace t e) where
30c30
< instance (Show t, Show e) ⇒ Show (ErrorTrace t e) where
---
> instance (Show t, Show e) => Show (ErrorTrace t e) where
40c40
<   ∷ ( Choice p
---
>   :: ( Choice p
43d42
<   ⇒ p (ErrorTrace t e) (f (ErrorTrace t' e'))
44c43
<   → p (e, [Seq t]) (f (e', [Seq t']))
---
>   => p (ErrorTrace t e) (f (ErrorTrace t' e'))
44a44
>   -> p (e, [Seq t]) (f (e', [Seq t']))
47c47
<   . fmap $ \ErrorTrace{..} → (_etError, _etTrace)
---
>   . fmap $ \ErrorTrace{..} -> (_etError, _etTrace)
52d51
<   ∷ Functor f
53d51
<   ⇒ (e → f e')
54d51
<   → ErrorTrace t e
55c52
<   → f (ErrorTrace t e')
---
>   :: Functor f
55a53
>   => (e -> f e')
55a54
>   -> ErrorTrace t e
55a55
>   -> f (ErrorTrace t e')
63d62
<   ∷ Functor f
64d62
<   ⇒ ([Seq t] → f [Seq t'])
65d62
<   → ErrorTrace t e
66c63
<   → f (ErrorTrace t' e)
---
>   :: Functor f
66a64
>   => ([Seq t] -> f [Seq t'])
66a65
>   -> ErrorTrace t e
66a66
>   -> f (ErrorTrace t' e)
70a71
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE UnicodeSyntax #-}
{-# LANGUAGE RecordWildCards #-}

module Control.Monad.Trace.ErrorTrace
( ErrorTrace(..)
, _ErrorTrace
, etError
, etTrace
) where

import Control.Applicative
import qualified Data.Foldable as F
import Data.Monoid
import Data.Profunctor
import Data.Sequence as S
import Data.List

-- | A datatype containing an error and its provenience(s).
--
data ErrorTrace t e
  = ErrorTrace
  { _etError ∷ !e -- ^ The error
  , _etTrace ∷ ![Seq t] -- ^ The list of traces (for each path tried)
  }

instance Monoid e ⇒ Monoid (ErrorTrace t e) where
  mempty = ErrorTrace mempty mempty
  mappend (ErrorTrace e tr) (ErrorTrace e' tr') = ErrorTrace (e <> e') (tr <> tr')

instance (Show t, Show e) ⇒ Show (ErrorTrace t e) where
  showsPrec p ErrorTrace{..} =
    showParen (p > 10) $
      foldr (.) id (intersperse (" ∥ "++) $ (foldr (.) id . intersperse ('.':) . fmap shows . F.toList) <$> _etTrace)
      . (" ⇑ " ++)
      . shows _etError

-- | An isomorphism @'ErrorTrace' t e ≅ (e, 'Seq' t)@.
--
_ErrorTrace
  ∷ ( Choice p
    , Functor f
    )
  ⇒ p (ErrorTrace t e) (f (ErrorTrace t' e'))
  → p (e, [Seq t]) (f (e', [Seq t']))
_ErrorTrace =
  dimap (uncurry ErrorTrace)
  . fmap $ \ErrorTrace{..} → (_etError, _etTrace)

-- | A lens @'ErrorTrace' t e → e@.
--
etError
  ∷ Functor f
  ⇒ (e → f e')
  → ErrorTrace t e
  → f (ErrorTrace t e')
etError inj ErrorTrace{..} =
  flip ErrorTrace _etTrace
    <$> inj _etError

-- | A lens @'ErrorTrace' t e → Seq t@.
--
etTrace
  ∷ Functor f
  ⇒ ([Seq t] → f [Seq t'])
  → ErrorTrace t e
  → f (ErrorTrace t' e)
etTrace inj ErrorTrace{..} =
  ErrorTrace _etError
    <$> inj _etTrace

</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE UnicodeSyntax #-}
{-# LANGUAGE RecordWildCards #-}

module Control.Monad.Trace.ErrorTrace
( ErrorTrace(..)
, _ErrorTrace
, etError
, etTrace
) where

import Control.Applicative
import qualified Data.Foldable as F
import Data.Monoid
import Data.Profunctor
import Data.Sequence as S
import Data.List

-- | A datatype containing an error and its provenience(s).
--
data ErrorTrace t e
  = ErrorTrace
  { _etError :: !e -- ^ The error
  , _etTrace :: ![Seq t] -- ^ The list of traces (for each path tried)
  }

instance Monoid e => Monoid (ErrorTrace t e) where
  mempty = ErrorTrace mempty mempty
  mappend (ErrorTrace e tr) (ErrorTrace e' tr') = ErrorTrace (e <> e') (tr <> tr')

instance (Show t, Show e) => Show (ErrorTrace t e) where
  showsPrec p ErrorTrace{..} =
    showParen (p > 10) $
      foldr (.) id (intersperse (" ∥ "++) $ (foldr (.) id . intersperse ('.':) . fmap shows . F.toList) <$> _etTrace)
      . (" ⇑ " ++)
      . shows _etError

-- | An isomorphism @'ErrorTrace' t e ≅ (e, 'Seq' t)@.
--
_ErrorTrace
  :: ( Choice p
    , Functor f
    )
  => p (ErrorTrace t e) (f (ErrorTrace t' e'))
  -> p (e, [Seq t]) (f (e', [Seq t']))
_ErrorTrace =
  dimap (uncurry ErrorTrace)
  . fmap $ \ErrorTrace{..} -> (_etError, _etTrace)

-- | A lens @'ErrorTrace' t e → e@.
--
etError
  :: Functor f
  => (e -> f e')
  -> ErrorTrace t e
  -> f (ErrorTrace t e')
etError inj ErrorTrace{..} =
  flip ErrorTrace _etTrace
    <$> inj _etError

-- | A lens @'ErrorTrace' t e → Seq t@.
--
etTrace
  :: Functor f
  => ([Seq t] -> f [Seq t'])
  -> ErrorTrace t e
  -> f (ErrorTrace t' e)
etTrace inj ErrorTrace{..} =
  ErrorTrace _etError
    <$> inj _etTrace


</pre>