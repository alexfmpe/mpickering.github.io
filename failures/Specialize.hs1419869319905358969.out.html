<a href="spec.hs851753076287957430.out.html">prev</a></br><a href="failures.html">home</a></br><a href="Specs.hs1446552988553701629.out.html">next</a></br></br><pre>25c25
<         typeSize _ = $impossible
---
>         typeSize _ = impossible
25a26
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE TemplateHaskell #-}
{-| Provides a function that can replace groupByN occurences by a more specific one-}
module Database.Ferry.TypedCore.Convert.Specialize where

import Database.Ferry.TypedCore.Convert.Traverse
import Database.Ferry.TypedCore.Data.TypedCore
import Database.Ferry.TypedCore.Data.Type
import Database.Ferry.Impossible

groupNSpecialize :: CoreExpr -> CoreExpr
groupNSpecialize = traverse f
    where
        f :: FoldCore CoreExpr Param RecElem
        f = idFoldCore {varF = fnS}
        fnS :: Qual FType -> String -> CoreExpr
        fnS t s = case s of
                   "groupByN" -> case typeSize t of
                                     n | 0 < n && n <= 6 -> Var t $ "groupBy" ++ (show n)
                                       | otherwise       -> Var t "groupByN"
                   _  -> (Var t s)
        typeSize :: Qual FType -> Int
        typeSize (_ :=> (FFn (FFn _ t2) _)) = case t2 of
                                               (FRec r) -> length r
                                               _        -> 0
        typeSize _ = $impossible
</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE TemplateHaskell #-}
{-| Provides a function that can replace groupByN occurences by a more specific one-}
module Database.Ferry.TypedCore.Convert.Specialize where

import Database.Ferry.TypedCore.Convert.Traverse
import Database.Ferry.TypedCore.Data.TypedCore
import Database.Ferry.TypedCore.Data.Type
import Database.Ferry.Impossible

groupNSpecialize :: CoreExpr -> CoreExpr
groupNSpecialize = traverse f
    where
        f :: FoldCore CoreExpr Param RecElem
        f = idFoldCore {varF = fnS}
        fnS :: Qual FType -> String -> CoreExpr
        fnS t s = case s of
                   "groupByN" -> case typeSize t of
                                     n | 0 < n && n <= 6 -> Var t $ "groupBy" ++ (show n)
                                       | otherwise       -> Var t "groupByN"
                   _  -> (Var t s)
        typeSize :: Qual FType -> Int
        typeSize (_ :=> (FFn (FFn _ t2) _)) = case t2 of
                                               (FRec r) -> length r
                                               _        -> 0
        typeSize _ = impossible

</pre>