<a href="AudioExpr.hs1399125485156091745.out.html">prev</a></br><a href="failures.html">home</a></br><a href="Auth.hs5414373351049077006.out.html">next</a></br></br><pre>25c25
< explicitUserPermission ∷ Int → Text → Request a n r
---
> explicitUserPermission :: Int -> Text -> Request a n r
30c30
< explicitAccessToken ∷ Int → Text → Text → Text → Request a n Text
---
> explicitAccessToken :: Int -> Text -> Text -> Text -> Request a n Text
42d41
<     Right t → t
43c42
<     Left e → throw $ SEException bs ("libstackexchange.accessToken: " ++ show e)
---
>     Right t -> t
43a43
>     Left e -> throw $ SEException bs ("libstackexchange.accessToken: " ++ show e)
45c45
<   parser ∷ P.Parser Text
---
>   parser :: P.Parser Text
50c50
< implicitUserPermission ∷ Int → Text → Request a n r
---
> implicitUserPermission :: Int -> Text -> Request a n r
54c54
< userPermission ∷ Int → Text → Request a n r
---
> userPermission :: Int -> Text -> Request a n r
55a56
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE UnicodeSyntax #-}
-- | StackExchange authentication helpers
module Network.StackExchange.Auth
  ( -- * Explicit OAuth 2.0 flow
    explicitUserPermission, explicitAccessToken
    -- * Implicit OAuth 2.0 flow
  , implicitUserPermission
  ) where

import Control.Applicative ((<$>), (*>))
import Control.Exception (throw)
import Data.Monoid ((<>), mconcat)

import           Data.Text.Lazy (Text)
import qualified Data.Text.Lazy as T
import           Data.Text.Lazy.Encoding (decodeUtf8)
import qualified Data.Attoparsec.Text.Lazy as P

import Network.StackExchange.Response
import Network.StackExchange.Request


-- | Construct URI at which user should approve app
explicitUserPermission ∷ Int → Text → Request a n r
explicitUserPermission c r = userPermission c r <> host "https://stackexchange.com/oauth"


-- | Request access_token from StackExchange
explicitAccessToken ∷ Int → Text → Text → Text → Request a n Text
explicitAccessToken c s c' r = mconcat
  [ host "https://stackexchange.com/oauth/access_token"
  , client c
  , secret s
  , code c'
  , redirectURI r
  , parse parseToken
  , method "POST"
  ]
 where
  parseToken bs = case P.eitherResult $ P.parse parser (decodeUtf8 bs) of
    Right t → t
    Left e → throw $ SEException bs ("libstackexchange.accessToken: " ++ show e)

  parser ∷ P.Parser Text
  parser = P.string "access_token=" *> (T.pack <$> P.manyTill P.anyChar (P.char '&'))


-- | Construct URI at which user should approve app
implicitUserPermission ∷ Int → Text → Request a n r
implicitUserPermission c r = userPermission c r <> host "https://stackexchange.com/oauth/dialog"


userPermission ∷ Int → Text → Request a n r
userPermission c r = client c <> redirectURI r
</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE UnicodeSyntax #-}
-- | StackExchange authentication helpers
module Network.StackExchange.Auth
  ( -- * Explicit OAuth 2.0 flow
    explicitUserPermission, explicitAccessToken
    -- * Implicit OAuth 2.0 flow
  , implicitUserPermission
  ) where

import Control.Applicative ((<$>), (*>))
import Control.Exception (throw)
import Data.Monoid ((<>), mconcat)

import           Data.Text.Lazy (Text)
import qualified Data.Text.Lazy as T
import           Data.Text.Lazy.Encoding (decodeUtf8)
import qualified Data.Attoparsec.Text.Lazy as P

import Network.StackExchange.Response
import Network.StackExchange.Request


-- | Construct URI at which user should approve app
explicitUserPermission :: Int -> Text -> Request a n r
explicitUserPermission c r = userPermission c r <> host "https://stackexchange.com/oauth"


-- | Request access_token from StackExchange
explicitAccessToken :: Int -> Text -> Text -> Text -> Request a n Text
explicitAccessToken c s c' r = mconcat
  [ host "https://stackexchange.com/oauth/access_token"
  , client c
  , secret s
  , code c'
  , redirectURI r
  , parse parseToken
  , method "POST"
  ]
 where
  parseToken bs = case P.eitherResult $ P.parse parser (decodeUtf8 bs) of
    Right t -> t
    Left e -> throw $ SEException bs ("libstackexchange.accessToken: " ++ show e)

  parser :: P.Parser Text
  parser = P.string "access_token=" *> (T.pack <$> P.manyTill P.anyChar (P.char '&'))


-- | Construct URI at which user should approve app
implicitUserPermission :: Int -> Text -> Request a n r
implicitUserPermission c r = userPermission c r <> host "https://stackexchange.com/oauth/dialog"


userPermission :: Int -> Text -> Request a n r
userPermission c r = client c <> redirectURI r

</pre>