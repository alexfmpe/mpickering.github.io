<a href="Name.hs585640194937186357.out.html">prev</a></br><a href="failures.html">home</a></br><a href="NamedRecord.hs13564252281899894091.out.html">next</a></br></br><pre>22c22
< {-# LINE 60 "src/ehc/NameAspect.chs" #-}
---
> 
22a23
> 
22a24
> 
22a25
> 
22a26
> 
22a27
> 
22a28
> 
22a29
> 
22a30
> 
22a31
> 
22a32
> 
22a33
> 
22a34
> 
22a35
> 
22a36
> 
22a37
> 
22a38
> 
22a39
> 
22a40
> 
22a41
> 
22a42
> 
22a43
> 
22a44
> 
22a45
> 
22a46
> 
22a47
> 
22a48
> 
22a49
> 
22a50
> 
22a51
> 
22a52
> 
22a53
> 
22a54
> 
22a55
> 
22a56
> 
22a57
> 
22a58
> 
22a59
> 
48c85
< {-# LINE 101 "src/ehc/NameAspect.chs" #-}
---
> 
48a86
> 
48a87
> 
48a88
> 
48a89
> 
48a90
> 
48a91
> 
48a92
> 
48a93
> 
48a94
> 
48a95
> 
48a96
> 
48a97
> 
48a98
> 
48a99
> 
48a100
> 
69c121
< {-# LINE 123 "src/ehc/NameAspect.chs" #-}
---
> 
69a122
> 
74c127
< {-# LINE 129 "src/ehc/NameAspect.chs" #-}
---
> 
74a128
> 
87c141
< {-# LINE 143 "src/ehc/NameAspect.chs" #-}
---
> 
87a142
> 
92c147
< {-# LINE 149 "src/ehc/NameAspect.chs" #-}
---
> 
92a148
> 
97c153
< {-# LINE 155 "src/ehc/NameAspect.chs" #-}
---
> 
97a154
> 
102c159
< {-# LINE 161 "src/ehc/NameAspect.chs" #-}
---
> 
102a160
> 
106c164
< {-# LINE 166 "src/ehc/NameAspect.chs" #-}
---
> 
106a165
> 
131c190
< {-# LINE 210 "src/ehc/NameAspect.chs" #-}
---
> 
131a191
> 
131a192
> 
131a193
> 
131a194
> 
131a195
> 
131a196
> 
131a197
> 
131a198
> 
131a199
> 
131a200
> 
131a201
> 
131a202
> 
131a203
> 
131a204
> 
131a205
> 
131a206
> 
131a207
> 
131a208
> 
131a209
> 
145c223
< {-# LINE 232 "src/ehc/NameAspect.chs" #-}
---
> 
145a224
> 
145a225
> 
145a226
> 
145a227
> 
145a228
> 
145a229
> 
145a230
> 
145a231
> 
149c235
< {-# LINE 237 "src/ehc/NameAspect.chs" #-}
---
> 
149a236
> 
154c241
< {-# LINE 245 "src/ehc/NameAspect.chs" #-}
---
> 
154a242
> 
154a243
> 
154a244
> 
162c252
< {-# LINE 254 "src/ehc/NameAspect.chs" #-}
---
> 
162a253
> 
167c258
< {-# LINE 311 "src/ehc/NameAspect.chs" #-}
---
> 
167a259
> 
167a260
> 
167a261
> 
167a262
> 
167a263
> 
167a264
> 
167a265
> 
167a266
> 
167a267
> 
167a268
> 
167a269
> 
167a270
> 
167a271
> 
167a272
> 
167a273
> 
167a274
> 
167a275
> 
167a276
> 
167a277
> 
167a278
> 
167a279
> 
167a280
> 
167a281
> 
167a282
> 
167a283
> 
167a284
> 
167a285
> 
167a286
> 
167a287
> 
167a288
> 
167a289
> 
167a290
> 
167a291
> 
167a292
> 
167a293
> 
167a294
> 
167a295
> 
167a296
> 
167a297
> 
167a298
> 
167a299
> 
167a300
> 
167a301
> 
167a302
> 
167a303
> 
167a304
> 
167a305
> 
167a306
> 
167a307
> 
167a308
> 
167a309
> 
167a310
> 
170a314
> 
</pre></br><h2>original</h2></br><pre>module UHC.Light.Compiler.NameAspect
( IdDefOcc (..), emptyIdDefOcc, mkIdDefOcc
, IdAspect (..)
, iaspIsFun, iaspIsPat, iaspIsValSig, iaspIsValVar, iaspIsValFix
, iaspIsTypeVar
, iaspIsValCon, iaspIsTypeDef, iaspIsValFld
, iaspIsTypeSig
, iaspIsValForeign
, iaspIsClassDef
, idDefOccLCmb
, doccStrip )
where
import UHC.Light.Compiler.Base.Common
import UHC.Light.Compiler.Base.HsName.Builtin
import qualified UHC.Light.Compiler.EH as EH
import UHC.Util.Pretty
import qualified Data.Set as Set
import UHC.Util.Utils



{-# LINE 60 "src/ehc/NameAspect.chs" #-}
data IdAspect
  = IdAsp_Val_Var
  | IdAsp_Val_Pat           {iaspDecl   ::  EH.Decl                         }
  | IdAsp_Val_Fun           {iaspPatL   :: [EH.PatExpr], iaspBody :: EH.Expr, iaspUniq :: !UID}
  | IdAsp_Val_Sig           {iaspDecl   ::  EH.Decl                         }
  | IdAsp_Val_Fix
  | IdAsp_Val_Con
  | IdAsp_Val_Fld           {iaspDataNm :: !HsName, iaspConNm :: !HsName    }
  | IdAsp_Val_Fusion        {iaspDecl   ::  EH.Decl                         }
  | IdAsp_Fusion_Conv       {iaspDecl   ::  EH.Decl                         }
  | IdAsp_Type_Con
  | IdAsp_Type_Var
  | IdAsp_Type_Def          {iaspDecl   ::  EH.Decl                         }
  | IdAsp_Type_Sig          {iaspDecl   :: !EH.Decl                         }
  | IdAsp_Kind_Con
  | IdAsp_Kind_Var
  | IdAsp_Val_Foreign       {iaspDecl   :: !EH.Decl                         }
  | IdAsp_Class_Class
  | IdAsp_Class_Def         {iaspDecl   ::  EH.Decl, iaspDeclInst ::  EH.Decl}
  | IdAsp_Inst_Inst
  | IdAsp_Inst_Def          {iaspDecl   ::  EH.Decl, iaspClassNm  :: !HsName}
  | IdAsp_Dflt_Def          -- for now defaults without explicit class name are ignored
                            {iaspDecl   :: !EH.Decl, iaspIgnore   :: !Bool  }
  | IdAsp_Any

{-# LINE 101 "src/ehc/NameAspect.chs" #-}
iaspIsFun :: IdAspect -> Bool
iaspIsFun (IdAsp_Val_Fun _ _ _) = True
iaspIsFun _                     = False

iaspIsPat :: IdAspect -> Bool
iaspIsPat (IdAsp_Val_Pat _) = True
iaspIsPat _                 = False

iaspIsValSig :: IdAspect -> Bool
iaspIsValSig (IdAsp_Val_Sig _) = True
iaspIsValSig _                 = False

iaspIsValVar :: IdAspect -> Bool
iaspIsValVar IdAsp_Val_Var = True
iaspIsValVar _             = False

iaspIsValFix :: IdAspect -> Bool
iaspIsValFix IdAsp_Val_Fix = True
iaspIsValFix _             = False

{-# LINE 123 "src/ehc/NameAspect.chs" #-}
iaspIsTypeVar :: IdAspect -> Bool
iaspIsTypeVar IdAsp_Type_Var = True
iaspIsTypeVar _              = False

{-# LINE 129 "src/ehc/NameAspect.chs" #-}
iaspIsValCon :: IdAspect -> Bool
iaspIsValCon IdAsp_Val_Con = True
iaspIsValCon _             = False

iaspIsValFld :: IdAspect -> Bool
iaspIsValFld (IdAsp_Val_Fld _ _) = True
iaspIsValFld _                   = False

iaspIsTypeDef :: IdAspect -> Bool
iaspIsTypeDef (IdAsp_Type_Def _) = True
iaspIsTypeDef _                  = False

{-# LINE 143 "src/ehc/NameAspect.chs" #-}
iaspIsTypeSig :: IdAspect -> Bool
iaspIsTypeSig (IdAsp_Type_Sig _) = True
iaspIsTypeSig _                  = False

{-# LINE 149 "src/ehc/NameAspect.chs" #-}
iaspIsValForeign :: IdAspect -> Bool
iaspIsValForeign (IdAsp_Val_Foreign _) = True
iaspIsValForeign _                     = False

{-# LINE 155 "src/ehc/NameAspect.chs" #-}
iaspIsClassDef :: IdAspect -> Bool
iaspIsClassDef (IdAsp_Class_Def _ _) = True
iaspIsClassDef _                     = False

{-# LINE 161 "src/ehc/NameAspect.chs" #-}
instance Show IdAspect where
  show _ = "IdAspect"

{-# LINE 166 "src/ehc/NameAspect.chs" #-}
instance PP IdAspect where
  pp  IdAsp_Val_Var         = pp "value"
  pp (IdAsp_Val_Pat _    )  = pp "pattern"
  pp (IdAsp_Val_Fun _ _ _)  = pp "function"
  pp (IdAsp_Val_Sig _    )  = pp "type signature"
  pp  IdAsp_Val_Fix         = pp "fixity"
  pp  IdAsp_Val_Con         = pp "data constructor"
  pp (IdAsp_Val_Fld _ _  )  = pp "data field"
  pp (IdAsp_Val_Fusion  _)  = pp "fuse"
  pp (IdAsp_Fusion_Conv _)  = pp "convert"
  pp  IdAsp_Type_Con        = pp "type constructor"
  pp  IdAsp_Type_Var        = pp "type variable"
  pp (IdAsp_Type_Def _   )  = pp "type"
  pp (IdAsp_Type_Sig _   )  = pp "kind signature"
  pp  IdAsp_Kind_Con        = pp "kind constructor"
  pp  IdAsp_Kind_Var        = pp "kind variable"
  pp (IdAsp_Val_Foreign _)  = pp "foreign"
  pp  IdAsp_Class_Class     = pp "class"
  pp (IdAsp_Class_Def _ _)  = pp "class"
  pp  IdAsp_Inst_Inst       = pp "instance"
  pp (IdAsp_Inst_Def  _ _)  = pp "instance"
  pp (IdAsp_Dflt_Def  _ _)  = pp "default"
  pp  IdAsp_Any             = pp "ANY"

{-# LINE 210 "src/ehc/NameAspect.chs" #-}
data IdDefOcc
  = IdDefOcc
      { doccOcc     :: !IdOcc
      , doccAsp     :: !IdAspect
      , doccLev     :: !NmLev
      , doccRange   :: !Range
      , doccNmAlts  :: !(Set.Set HsName) -- !(Maybe [HsName])
      }
  deriving (Show)

emptyIdDefOcc :: IdDefOcc
emptyIdDefOcc = mkIdDefOcc (IdOcc hsnUnknown IdOcc_Any) IdAsp_Any nmLevAbsent emptyRange

{-# LINE 232 "src/ehc/NameAspect.chs" #-}
mkIdDefOcc :: IdOcc -> IdAspect -> NmLev -> Range -> IdDefOcc
mkIdDefOcc o a l r = IdDefOcc o a l r Set.empty

{-# LINE 237 "src/ehc/NameAspect.chs" #-}
instance PP IdDefOcc where
  pp o = doccOcc o >|< "/" >|< doccAsp o >|< "/" >|< doccLev o
         >|< (ppBracketsCommas $ Set.toList $ doccNmAlts o)

{-# LINE 245 "src/ehc/NameAspect.chs" #-}
-- | Collapse multiple 'IdDefOcc', remembering duplicates in doccNmAlts
idDefOccLCmb :: IdDefOcc -> [IdDefOcc] -> [IdDefOcc]
idDefOccLCmb l1 l2 =
  [ d {doccNmAlts = Set.unions [Set.insert (ioccNm o) a | (IdDefOcc {doccOcc = o, doccNmAlts = a}) <- g]}
  | g@(d:_) <- groupSortOn (\d -> (ioccKind $ doccOcc d {-, doccLev d -})) $ l1 : l2
  ]

{-# LINE 254 "src/ehc/NameAspect.chs" #-}
-- | Strip positional info
doccStrip :: IdDefOcc -> IdDefOcc
doccStrip o = o {doccRange = emptyRange}

{-# LINE 311 "src/ehc/NameAspect.chs" #-}
instance PP IdOcc where
  pp o = ppCurlysCommas [pp (ioccNm o),pp (ioccKind o)]

</pre></br><h2>printed</h2></br><pre>module UHC.Light.Compiler.NameAspect
( IdDefOcc (..), emptyIdDefOcc, mkIdDefOcc
, IdAspect (..)
, iaspIsFun, iaspIsPat, iaspIsValSig, iaspIsValVar, iaspIsValFix
, iaspIsTypeVar
, iaspIsValCon, iaspIsTypeDef, iaspIsValFld
, iaspIsTypeSig
, iaspIsValForeign
, iaspIsClassDef
, idDefOccLCmb
, doccStrip )
where
import UHC.Light.Compiler.Base.Common
import UHC.Light.Compiler.Base.HsName.Builtin
import qualified UHC.Light.Compiler.EH as EH
import UHC.Util.Pretty
import qualified Data.Set as Set
import UHC.Util.Utils









































data IdAspect
  = IdAsp_Val_Var
  | IdAsp_Val_Pat           {iaspDecl   ::  EH.Decl                         }
  | IdAsp_Val_Fun           {iaspPatL   :: [EH.PatExpr], iaspBody :: EH.Expr, iaspUniq :: !UID}
  | IdAsp_Val_Sig           {iaspDecl   ::  EH.Decl                         }
  | IdAsp_Val_Fix
  | IdAsp_Val_Con
  | IdAsp_Val_Fld           {iaspDataNm :: !HsName, iaspConNm :: !HsName    }
  | IdAsp_Val_Fusion        {iaspDecl   ::  EH.Decl                         }
  | IdAsp_Fusion_Conv       {iaspDecl   ::  EH.Decl                         }
  | IdAsp_Type_Con
  | IdAsp_Type_Var
  | IdAsp_Type_Def          {iaspDecl   ::  EH.Decl                         }
  | IdAsp_Type_Sig          {iaspDecl   :: !EH.Decl                         }
  | IdAsp_Kind_Con
  | IdAsp_Kind_Var
  | IdAsp_Val_Foreign       {iaspDecl   :: !EH.Decl                         }
  | IdAsp_Class_Class
  | IdAsp_Class_Def         {iaspDecl   ::  EH.Decl, iaspDeclInst ::  EH.Decl}
  | IdAsp_Inst_Inst
  | IdAsp_Inst_Def          {iaspDecl   ::  EH.Decl, iaspClassNm  :: !HsName}
  | IdAsp_Dflt_Def          -- for now defaults without explicit class name are ignored
                            {iaspDecl   :: !EH.Decl, iaspIgnore   :: !Bool  }
  | IdAsp_Any

















iaspIsFun :: IdAspect -> Bool
iaspIsFun (IdAsp_Val_Fun _ _ _) = True
iaspIsFun _                     = False

iaspIsPat :: IdAspect -> Bool
iaspIsPat (IdAsp_Val_Pat _) = True
iaspIsPat _                 = False

iaspIsValSig :: IdAspect -> Bool
iaspIsValSig (IdAsp_Val_Sig _) = True
iaspIsValSig _                 = False

iaspIsValVar :: IdAspect -> Bool
iaspIsValVar IdAsp_Val_Var = True
iaspIsValVar _             = False

iaspIsValFix :: IdAspect -> Bool
iaspIsValFix IdAsp_Val_Fix = True
iaspIsValFix _             = False



iaspIsTypeVar :: IdAspect -> Bool
iaspIsTypeVar IdAsp_Type_Var = True
iaspIsTypeVar _              = False



iaspIsValCon :: IdAspect -> Bool
iaspIsValCon IdAsp_Val_Con = True
iaspIsValCon _             = False

iaspIsValFld :: IdAspect -> Bool
iaspIsValFld (IdAsp_Val_Fld _ _) = True
iaspIsValFld _                   = False

iaspIsTypeDef :: IdAspect -> Bool
iaspIsTypeDef (IdAsp_Type_Def _) = True
iaspIsTypeDef _                  = False



iaspIsTypeSig :: IdAspect -> Bool
iaspIsTypeSig (IdAsp_Type_Sig _) = True
iaspIsTypeSig _                  = False



iaspIsValForeign :: IdAspect -> Bool
iaspIsValForeign (IdAsp_Val_Foreign _) = True
iaspIsValForeign _                     = False



iaspIsClassDef :: IdAspect -> Bool
iaspIsClassDef (IdAsp_Class_Def _ _) = True
iaspIsClassDef _                     = False



instance Show IdAspect where
  show _ = "IdAspect"



instance PP IdAspect where
  pp  IdAsp_Val_Var         = pp "value"
  pp (IdAsp_Val_Pat _    )  = pp "pattern"
  pp (IdAsp_Val_Fun _ _ _)  = pp "function"
  pp (IdAsp_Val_Sig _    )  = pp "type signature"
  pp  IdAsp_Val_Fix         = pp "fixity"
  pp  IdAsp_Val_Con         = pp "data constructor"
  pp (IdAsp_Val_Fld _ _  )  = pp "data field"
  pp (IdAsp_Val_Fusion  _)  = pp "fuse"
  pp (IdAsp_Fusion_Conv _)  = pp "convert"
  pp  IdAsp_Type_Con        = pp "type constructor"
  pp  IdAsp_Type_Var        = pp "type variable"
  pp (IdAsp_Type_Def _   )  = pp "type"
  pp (IdAsp_Type_Sig _   )  = pp "kind signature"
  pp  IdAsp_Kind_Con        = pp "kind constructor"
  pp  IdAsp_Kind_Var        = pp "kind variable"
  pp (IdAsp_Val_Foreign _)  = pp "foreign"
  pp  IdAsp_Class_Class     = pp "class"
  pp (IdAsp_Class_Def _ _)  = pp "class"
  pp  IdAsp_Inst_Inst       = pp "instance"
  pp (IdAsp_Inst_Def  _ _)  = pp "instance"
  pp (IdAsp_Dflt_Def  _ _)  = pp "default"
  pp  IdAsp_Any             = pp "ANY"





















data IdDefOcc
  = IdDefOcc
      { doccOcc     :: !IdOcc
      , doccAsp     :: !IdAspect
      , doccLev     :: !NmLev
      , doccRange   :: !Range
      , doccNmAlts  :: !(Set.Set HsName) -- !(Maybe [HsName])
      }
  deriving (Show)

emptyIdDefOcc :: IdDefOcc
emptyIdDefOcc = mkIdDefOcc (IdOcc hsnUnknown IdOcc_Any) IdAsp_Any nmLevAbsent emptyRange










mkIdDefOcc :: IdOcc -> IdAspect -> NmLev -> Range -> IdDefOcc
mkIdDefOcc o a l r = IdDefOcc o a l r Set.empty



instance PP IdDefOcc where
  pp o = doccOcc o >|< "/" >|< doccAsp o >|< "/" >|< doccLev o
         >|< (ppBracketsCommas $ Set.toList $ doccNmAlts o)





-- | Collapse multiple 'IdDefOcc', remembering duplicates in doccNmAlts
idDefOccLCmb :: IdDefOcc -> [IdDefOcc] -> [IdDefOcc]
idDefOccLCmb l1 l2 =
  [ d {doccNmAlts = Set.unions [Set.insert (ioccNm o) a | (IdDefOcc {doccOcc = o, doccNmAlts = a}) <- g]}
  | g@(d:_) <- groupSortOn (\d -> (ioccKind $ doccOcc d {-, doccLev d -})) $ l1 : l2
  ]



-- | Strip positional info
doccStrip :: IdDefOcc -> IdDefOcc
doccStrip o = o {doccRange = emptyRange}






















































instance PP IdOcc where
  pp o = ppCurlysCommas [pp (ioccNm o),pp (ioccKind o)]


</pre>