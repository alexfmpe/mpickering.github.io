<a href="failures.html">prev</a></br><a href="failures.html">home</a></br><a href="arx.hs1622650073984943658.out.html">next</a></br></br><pre>1d0
< #! /usr/bin/env runhaskell
2a2
> 
43a44
> 
</pre></br><h2>original</h2></br><pre>#! /usr/bin/env runhaskell

import Data.List ( isPrefixOf )
import System.Cmd
import System.Directory
import System.FilePath
import Text.Printf
import Text.Regex


--epubnameBin = return "epubname"
epubnameBin = canonicalizePath "dist/build/epubname/epubname"

tempDir = "/home/dino/temp"
allFile = "epubname-all"


renameRE = mkRegex "(.*) -> (.*)"

namesNotEqual oline = case matchRegex renameRE oline of
   Just [s, d] -> takeFileName s /= takeFileName d
   Nothing     -> True


main :: IO ()
main = do
   eb <- epubnameBin

   setCurrentDirectory "/var/local/archive/doc/books/fiction"

   system $ printf
      "find . -name '*.epub' | xargs -n 30 %s -n -t /tmp 2>&1 > %s/%s"
      eb tempDir allFile

   setCurrentDirectory tempDir

   allLines <- fmap (filter (not . isPrefixOf "No-action") . lines)
      $ readFile allFile

   let notEqual = filter namesNotEqual allLines
   writeFile "epubname-changed" $ unlines notEqual

   mapM_ putStrLn notEqual
</pre></br><h2>printed</h2></br><pre>

import Data.List ( isPrefixOf )
import System.Cmd
import System.Directory
import System.FilePath
import Text.Printf
import Text.Regex


--epubnameBin = return "epubname"
epubnameBin = canonicalizePath "dist/build/epubname/epubname"

tempDir = "/home/dino/temp"
allFile = "epubname-all"


renameRE = mkRegex "(.*) -> (.*)"

namesNotEqual oline = case matchRegex renameRE oline of
   Just [s, d] -> takeFileName s /= takeFileName d
   Nothing     -> True


main :: IO ()
main = do
   eb <- epubnameBin

   setCurrentDirectory "/var/local/archive/doc/books/fiction"

   system $ printf
      "find . -name '*.epub' | xargs -n 30 %s -n -t /tmp 2>&1 > %s/%s"
      eb tempDir allFile

   setCurrentDirectory tempDir

   allLines <- fmap (filter (not . isPrefixOf "No-action") . lines)
      $ readFile allFile

   let notEqual = filter namesNotEqual allLines
   writeFile "epubname-changed" $ unlines notEqual

   mapM_ putStrLn notEqual

</pre>