<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
Author: George Karachalias &lt;george.karachalias@cs.kuleuven.be&gt;

Haskell expressions (as used by the pattern matching checker) and utilities.
-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-10"></a><span>        </span><a href="PmExpr.html#PmExpr"><span class="hs-identifier hs-type">PmExpr</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="PmExpr.html#PmLit"><span class="hs-identifier hs-type">PmLit</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="PmExpr.html#SimpleEq"><span class="hs-identifier hs-type">SimpleEq</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#ComplexEq"><span class="hs-identifier hs-type">ComplexEq</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#toComplex"><span class="hs-identifier hs-var">toComplex</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#eqPmLit"><span class="hs-identifier hs-var">eqPmLit</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>        </span><a href="PmExpr.html#truePmExpr"><span class="hs-identifier hs-var">truePmExpr</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#falsePmExpr"><span class="hs-identifier hs-var">falsePmExpr</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#isTruePmExpr"><span class="hs-identifier hs-var">isTruePmExpr</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#isFalsePmExpr"><span class="hs-identifier hs-var">isFalsePmExpr</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#isNotPmExprOther"><span class="hs-identifier hs-var">isNotPmExprOther</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>        </span><a href="PmExpr.html#lhsExprToPmExpr"><span class="hs-identifier hs-var">lhsExprToPmExpr</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#hsExprToPmExpr"><span class="hs-identifier hs-var">hsExprToPmExpr</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#substComplexEq"><span class="hs-identifier hs-var">substComplexEq</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#filterComplex"><span class="hs-identifier hs-var">filterComplex</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="PmExpr.html#pprPmExprWithParens"><span class="hs-identifier hs-var">pprPmExprWithParens</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#runPmPprM"><span class="hs-identifier hs-var">runPmPprM</span></a><span>
</span><a name="line-14"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#groupBy"><span class="hs-identifier hs-var">groupBy</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#nubBy"><span class="hs-identifier hs-var">nubBy</span></a><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="../transformers-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.Trans.State.Lazy.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Trans</span><span class="hs-operator">.</span><span class="hs-identifier">State</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span></a><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                         Lifted Expressions
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-comment">{- Note [PmExprOther in PmExpr]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Since there is no plan to extend the (currently pretty naive) term oracle in
the near future, instead of playing with the verbose (HsExpr Id), we lift it to
PmExpr. All expressions the term oracle does not handle are wrapped by the
constructor PmExprOther. Note that we do not perform substitution in
PmExprOther. Because of this, we do not even print PmExprOther, since they may
refer to variables that are otherwise substituted away.
-}</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- ** Types</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-comment">-- | Lifted expressions for pattern match checking.</span><span>
</span><a name="line-54"></a><span class="hs-keyword">data</span><span> </span><a name="PmExpr"><a href="PmExpr.html#PmExpr"><span class="hs-identifier">PmExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PmExprVar"><a href="PmExpr.html#PmExprVar"><span class="hs-identifier">PmExprVar</span></a></a><span>   </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-55"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="PmExprCon"><a href="PmExpr.html#PmExprCon"><span class="hs-identifier">PmExprCon</span></a></a><span>   </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-special">[</span><a href="PmExpr.html#PmExpr"><span class="hs-identifier hs-type">PmExpr</span></a><span class="hs-special">]</span><span>
</span><a name="line-56"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="PmExprLit"><a href="PmExpr.html#PmExprLit"><span class="hs-identifier">PmExprLit</span></a></a><span>   </span><a href="PmExpr.html#PmLit"><span class="hs-identifier hs-type">PmLit</span></a><span>
</span><a name="line-57"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="PmExprEq"><a href="PmExpr.html#PmExprEq"><span class="hs-identifier">PmExprEq</span></a></a><span>    </span><a href="PmExpr.html#PmExpr"><span class="hs-identifier hs-type">PmExpr</span></a><span> </span><a href="PmExpr.html#PmExpr"><span class="hs-identifier hs-type">PmExpr</span></a><span>  </span><span class="hs-comment">-- Syntactic equality</span><span>
</span><a name="line-58"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="PmExprOther"><a href="PmExpr.html#PmExprOther"><span class="hs-identifier">PmExprOther</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Note [PmExprOther in PmExpr]</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-comment">-- | Literals (simple and overloaded ones) for pattern match checking.</span><span>
</span><a name="line-61"></a><span class="hs-keyword">data</span><span> </span><a name="PmLit"><a href="PmExpr.html#PmLit"><span class="hs-identifier">PmLit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PmSLit"><a href="PmExpr.html#PmSLit"><span class="hs-identifier">PmSLit</span></a></a><span> </span><a href="HsLit.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a><span>                                    </span><span class="hs-comment">-- simple</span><span>
</span><a name="line-62"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a name="PmOLit"><a href="PmExpr.html#PmOLit"><span class="hs-identifier">PmOLit</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">{- is it negated? -}</span><span> </span><span class="hs-special">(</span><a href="HsLit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- overloaded</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-comment">-- | Equality between literals for pattern match checking.</span><span>
</span><a name="line-65"></a><span class="hs-identifier">eqPmLit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PmExpr.html#PmLit"><span class="hs-identifier hs-type">PmLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PmExpr.html#PmLit"><span class="hs-identifier hs-type">PmLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-66"></a><a name="eqPmLit"><a href="PmExpr.html#eqPmLit"><span class="hs-identifier">eqPmLit</span></a></a><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmSLit"><span class="hs-identifier hs-var">PmSLit</span></a><span>    </span><a name="local-1627900003"><a href="#local-1627900003"><span class="hs-identifier">l1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmSLit"><span class="hs-identifier hs-var">PmSLit</span></a><span>    </span><a name="local-1627900004"><a href="#local-1627900004"><span class="hs-identifier">l2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627900003"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627900004"><span class="hs-identifier hs-var">l2</span></a><span>
</span><a name="line-67"></a><span class="hs-identifier">eqPmLit</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmOLit"><span class="hs-identifier hs-var">PmOLit</span></a><span> </span><a name="local-1627900005"><a href="#local-1627900005"><span class="hs-identifier">b1</span></a></a><span> </span><a name="local-1627900006"><a href="#local-1627900006"><span class="hs-identifier">l1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmOLit"><span class="hs-identifier hs-var">PmOLit</span></a><span> </span><a name="local-1627900007"><a href="#local-1627900007"><span class="hs-identifier">b2</span></a></a><span> </span><a name="local-1627900008"><a href="#local-1627900008"><span class="hs-identifier">l2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627900005"><span class="hs-identifier hs-var">b1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627900007"><span class="hs-identifier hs-var">b2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1627900006"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627900008"><span class="hs-identifier hs-var">l2</span></a><span>
</span><a name="line-68"></a><span>  </span><span class="hs-comment">-- See Note [Undecidable Equality for Overloaded Literals]</span><span>
</span><a name="line-69"></a><span class="hs-identifier">eqPmLit</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-comment">{- Note [Undecidable Equality for Overloaded Literals]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Equality on overloaded literals is undecidable in the general case. Consider
the following example:

  instance Num Bool where
    ...
    fromInteger 0 = False -- C-like representation of booleans
    fromInteger _ = True

    f :: Bool -&gt; ()
    f 1 = ()        -- Clause A
    f 2 = ()        -- Clause B

Clause B is redundant but to detect this, we should be able to solve the
constraint: False ~ (fromInteger 2 ~ fromInteger 1) which means that we
have to look through function `fromInteger`, whose implementation could
be anything. This poses difficulties for:

1. The expressive power of the check.
   We cannot expect a reasonable implementation of pattern matching to detect
   that fromInteger 2 ~ fromInteger 1 is True, unless we unfold function
   fromInteger. This puts termination at risk and is undecidable in the
   general case.

2. Performance.
   Having an unresolved constraint False ~ (fromInteger 2 ~ fromInteger 1)
   lying around could become expensive really fast. Ticket #11161 illustrates
   how heavy use of overloaded literals can generate plenty of those
   constraints, effectively undermining the term oracle's performance.

3. Error nessages/Warnings.
   What should our message for `f` above be? A reasonable approach would be
   to issue:

     Pattern matches are (potentially) redundant:
       f 2 = ...    under the assumption that 1 == 2

   but seems to complex and confusing for the user.

We choose to treat overloaded literals that look different as different. The
impact of this is the following:

  * Redundancy checking is rather conservative, since it cannot see that clause
    B above is redundant.

  * We have instant equality check for overloaded literals (we do not rely on
    the term oracle which is rather expensive, both in terms of performance and
    memory). This significantly improves the performance of functions `covered`
    `uncovered` and `divergent` in deSugar/Check.hs and effectively addresses
    #11161.

  * The warnings issued are simpler.

  * We do not play on the safe side, strictly speaking. The assumption that
    1 /= 2 makes the redundancy check more conservative but at the same time
    makes its dual (exhaustiveness check) unsafe. This we can live with, mainly
    for two reasons:
    1. At the moment we do not use the results of the check during compilation
       where this would be a disaster (could result in runtime errors even if
       our function was deemed exhaustive).
    2. Pattern matcing on literals can never be considered exhaustive unless we
       have a catch-all clause. Hence, this assumption affects mainly the
       appearance of the warnings and is, in practice safe.
-}</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-identifier">nubPmLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">PmLit</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">PmLit</span><span class="hs-special">]</span><span>
</span><a name="line-138"></a><span class="hs-identifier">nubPmLit</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nubBy</span><span> </span><span class="hs-identifier">eqPmLit</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">-- | Term equalities</span><span>
</span><a name="line-141"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">SimpleEq</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Id</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">PmExpr</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- We always use this orientation</span><span>
</span><a name="line-142"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">ComplexEq</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExpr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">PmExpr</span><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-comment">-- | Lift a `SimpleEq` to a `ComplexEq`</span><span>
</span><a name="line-145"></a><span class="hs-identifier">toComplex</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">SimpleEq</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ComplexEq</span><span>
</span><a name="line-146"></a><span class="hs-identifier">toComplex</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><a href="PmExpr.html#SimpleEq"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">idName</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-comment">-- | Expression `True'</span><span>
</span><a name="line-149"></a><span class="hs-identifier">truePmExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmExpr</span><span>
</span><a name="line-150"></a><span class="hs-identifier">truePmExpr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PmExprCon</span><span> </span><span class="hs-identifier">trueDataCon</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-comment">-- | Expression `False'</span><span>
</span><a name="line-153"></a><span class="hs-identifier">falsePmExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmExpr</span><span>
</span><a name="line-154"></a><span class="hs-identifier">falsePmExpr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PmExprCon</span><span> </span><span class="hs-identifier">falseDataCon</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- ** Predicates on PmExpr</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-comment">-- | Check if an expression is lifted or not</span><span>
</span><a name="line-160"></a><span class="hs-identifier">isNotPmExprOther</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-161"></a><span class="hs-identifier">isNotPmExprOther</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprOther</span><span> </span><span class="hs-identifier hs-type">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-162"></a><a name="isNotPmExprOther"><a href="PmExpr.html#isNotPmExprOther"><span class="hs-identifier">isNotPmExprOther</span></a></a><span> </span><span class="hs-identifier">_expr</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- | Check whether a literal is negated</span><span>
</span><a name="line-165"></a><span class="hs-identifier">isNegatedPmLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmLit</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-166"></a><span class="hs-identifier">isNegatedPmLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmOLit</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">b</span><span>
</span><a name="line-167"></a><a name="isNegatedPmLit"><a href="PmExpr.html#isNegatedPmLit"><span class="hs-identifier">isNegatedPmLit</span></a></a><span> </span><span class="hs-identifier">_other_lit</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span class="hs-comment">-- | Check whether a PmExpr is syntactically equal to term `True'.</span><span>
</span><a name="line-170"></a><span class="hs-identifier">isTruePmExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-171"></a><span class="hs-identifier">isTruePmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprCon</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">trueDataCon</span><span>
</span><a name="line-172"></a><a name="isTruePmExpr"><a href="PmExpr.html#isTruePmExpr"><span class="hs-identifier">isTruePmExpr</span></a></a><span> </span><span class="hs-identifier">_other_expr</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-comment">-- | Check whether a PmExpr is syntactically equal to term `False'.</span><span>
</span><a name="line-175"></a><span class="hs-identifier">isFalsePmExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-176"></a><span class="hs-identifier">isFalsePmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprCon</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">falseDataCon</span><span>
</span><a name="line-177"></a><a name="isFalsePmExpr"><a href="PmExpr.html#isFalsePmExpr"><span class="hs-identifier">isFalsePmExpr</span></a></a><span> </span><span class="hs-identifier">_other_expr</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span class="hs-comment">-- | Check whether a PmExpr is syntactically e</span><span>
</span><a name="line-180"></a><span class="hs-identifier">isNilPmExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-181"></a><span class="hs-identifier">isNilPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprCon</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier hs-type">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nilDataCon</span><span>
</span><a name="line-182"></a><a name="isNilPmExpr"><a href="PmExpr.html#isNilPmExpr"><span class="hs-identifier">isNilPmExpr</span></a></a><span> </span><span class="hs-identifier">_other_expr</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-comment">-- | Check whether a PmExpr is syntactically equal to (x == y).</span><span>
</span><a name="line-185"></a><span class="hs-comment">-- Since (==) is overloaded and can have an arbitrary implementation, we use</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- the PmExprEq constructor to represent only equalities with non-overloaded</span><span>
</span><a name="line-187"></a><span class="hs-comment">-- literals where it coincides with a syntactic equality check.</span><span>
</span><a name="line-188"></a><span class="hs-identifier">isPmExprEq</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExpr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">PmExpr</span><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span class="hs-identifier">isPmExprEq</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprEq</span><span> </span><span class="hs-identifier">e1</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">e2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e1</span><span class="hs-special">,</span><a href="PmExpr.html#PmExpr"><span class="hs-identifier hs-type">e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><a name="isPmExprEq"><a href="PmExpr.html#isPmExprEq"><span class="hs-identifier">isPmExprEq</span></a></a><span> </span><span class="hs-identifier">_other_expr</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">-- | Check if a DataCon is (:).</span><span>
</span><a name="line-193"></a><span class="hs-identifier">isConsDataCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-194"></a><span class="hs-identifier">isConsDataCon</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">consDataCon</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">con</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-197"></a><span class="hs-comment">-- ** Substitution in PmExpr</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-comment">-- | We return a boolean along with the expression. Hence, if substitution was</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- a no-op, we know that the expression still cannot progress.</span><span>
</span><a name="line-201"></a><span class="hs-identifier">substPmExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExpr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span class="hs-identifier">substPmExpr</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">e1</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-203"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a name="substPmExpr"><a href="PmExpr.html#substPmExpr"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-identifier">PmExprVar</span><span> </span><span class="hs-identifier">z</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">z</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">True</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627900025"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">False</span><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-identifier">PmExprCon</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">ps</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ps'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mapAndUnzip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">substPmExpr</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">e1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ps</span><span>
</span><a name="line-207"></a><span>                      </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">PmExprCon</span><span> </span><span class="hs-identifier">c</span><span> </span><a href="Util.html#mapAndUnzip"><span class="hs-identifier hs-var">ps'</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#mapAndUnzip"><span class="hs-identifier hs-var">or</span></a><span> </span><a href="Util.html#mapAndUnzip"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>    </span><span class="hs-identifier">PmExprEq</span><span> </span><span class="hs-identifier">ex</span><span> </span><span class="hs-identifier">ey</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmExprCon"><span class="hs-identifier hs-var">ex'</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#PmExprCon"><span class="hs-identifier hs-var">bx</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">substPmExpr</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">e1</span><span> </span><span class="hs-identifier">ex</span><span>
</span><a name="line-209"></a><span>                          </span><span class="hs-special">(</span><a name="local-1627900034"><a href="#local-1627900034"><span class="hs-identifier">ey'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627900035"><a href="#local-1627900035"><span class="hs-identifier">by</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#substPmExpr"><span class="hs-identifier hs-var">substPmExpr</span></a><span> </span><a href="#local-1627900024"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627900025"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-1627900032"><span class="hs-identifier hs-var">ey</span></a><span>
</span><a name="line-210"></a><span>                      </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">PmExprEq</span><span> </span><span class="hs-identifier">ex'</span><span> </span><a href="PmExpr.html#substPmExpr"><span class="hs-identifier hs-var">ey'</span></a><span class="hs-special">,</span><span> </span><a href="PmExpr.html#substPmExpr"><span class="hs-identifier hs-var">bx</span></a><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">by</span><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-identifier">_other_expr</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">False</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- The rest are terminals (We silently ignore</span><span>
</span><a name="line-212"></a><span>                                 </span><span class="hs-comment">-- Other). See Note [PmExprOther in PmExpr]</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span class="hs-comment">-- | Substitute in a complex equality. We return (Left eq) if the substitution</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- affected the equality or (Right eq) if nothing happened.</span><span>
</span><a name="line-216"></a><span class="hs-identifier">substComplexEq</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ComplexEq</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Either</span><span> </span><span class="hs-identifier">ComplexEq</span><span> </span><span class="hs-identifier">ComplexEq</span><span>
</span><a name="line-217"></a><span class="hs-identifier">substComplexEq</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">ex</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ey</span><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="substComplexEq"><a href="PmExpr.html#substComplexEq"><span class="hs-identifier">bx</span></a></a><span> </span><a name="substComplexEq"><a href="PmExpr.html#substComplexEq"><span class="hs-operator">||</span></a></a><span> </span><a name="substComplexEq"><a href="PmExpr.html#substComplexEq"><span class="hs-identifier">by</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Left</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">ex'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ey'</span><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627900043"><span class="hs-identifier hs-var">ex'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627900045"><span class="hs-identifier hs-var">ey'</span></a><span class="hs-special">)</span><span>
</span><a name="line-220"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-221"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">ex'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bx</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">substPmExpr</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">ex</span><span>
</span><a name="line-222"></a><span>    </span><span class="hs-special">(</span><a name="local-1627900043"><a href="#local-1627900043"><span class="hs-identifier">ey'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627900044"><a href="#local-1627900044"><span class="hs-identifier">by</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#substPmExpr"><span class="hs-identifier hs-var">substPmExpr</span></a><span> </span><a href="#local-1627900039"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627900040"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-1627900041"><span class="hs-identifier hs-var">ey</span></a><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span class="hs-comment">-- -----------------------------------------------------------------------</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- ** Lift source expressions (HsExpr Id) to PmExpr</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-identifier">lhsExprToPmExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">LHsExpr</span><span> </span><span class="hs-identifier">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PmExpr</span><span>
</span><a name="line-228"></a><span class="hs-identifier">lhsExprToPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">L</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">_</span></a><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HsExpr</span><span> </span><span class="hs-identifier">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PmExpr</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HsVar</span><span>         </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PmExprVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">idName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unLoc</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-233"></a><a name="hsExprToPmExpr"><a href="PmExpr.html#hsExprToPmExpr"><span class="hs-identifier">hsExprToPmExpr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">HsOverLit</span><span>  </span><span class="hs-identifier">olit</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#PmExprVar"><span class="hs-identifier hs-var">PmExprLit</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idName"><span class="hs-identifier hs-var">PmOLit</span></a><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-identifier">olit</span><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsOverLit"><span class="hs-identifier hs-var">HsLit</span></a><span>       </span><a name="local-1627900049"><a href="#local-1627900049"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#PmExprLit"><span class="hs-identifier hs-var">PmExprLit</span></a><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmOLit"><span class="hs-identifier hs-var">PmSLit</span></a><span> </span><span class="hs-identifier hs-var">lit</span><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-identifier">e</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">NegApp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">neg_e</span><span class="hs-special">)</span><span>
</span><a name="line-237"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">PmExprLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmOLit</span><span> </span><span class="hs-identifier">False</span><span> </span><a name="local-1627900052"><a href="#local-1627900052"><span class="hs-identifier">ol</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">synExprToPmExpr</span><span> </span><span class="hs-identifier">neg_e</span><span>
</span><a name="line-238"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#PmExprLit"><span class="hs-identifier hs-var">PmExprLit</span></a><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmOLit"><span class="hs-identifier hs-var">PmOLit</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier">ol</span><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="PmExpr.html#PmExprLit"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PmExprOther</span><span> </span><a href="#local-1627900053"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-240"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmExprOther"><span class="hs-identifier hs-var">HsPar</span></a><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmExprOther"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="PmExpr.html#PmExprOther"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-identifier">e</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">ExplicitTuple</span><span> </span><span class="hs-identifier">ps</span><span> </span><span class="hs-identifier">boxity</span><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">tupArgPresent</span><span> </span><a href="HsExpr.html#ExplicitTuple"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PmExprCon</span><span> </span><span class="hs-identifier">tuple_con</span><span> </span><span class="hs-identifier">tuple_args</span><span>
</span><a name="line-244"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PmExprOther</span><span> </span><a href="#local-1627900058"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-245"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-246"></a><span>    </span><span class="hs-identifier">tuple_con</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tupleDataCon</span><span> </span><span class="hs-identifier">boxity</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">ps</span><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>    </span><span class="hs-identifier">tuple_args</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">lhsExprToPmExpr</span><span> </span><a href="#local-1627900057"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Present</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ps</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-identifier">e</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">ExplicitList</span><span> </span><span class="hs-identifier">_elem_ty</span><span> </span><span class="hs-identifier">mb_ol</span><span> </span><span class="hs-identifier">elems</span><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mb_ol</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsExpr.html#ExplicitList"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-identifier">cons</span><span> </span><a name="local-1627900062"><a href="#local-1627900062"><span class="hs-identifier">nil</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">lhsExprToPmExpr</span><span> </span><span class="hs-identifier">elems</span><span class="hs-special">)</span><span>
</span><a name="line-251"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PmExprOther</span><span> </span><a href="#local-1627900066"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-comment">{- overloaded list: No PmExprApp -}</span><span>
</span><a name="line-252"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-253"></a><span>    </span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">xs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PmExprCon</span><span> </span><span class="hs-identifier">consDataCon</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span class="hs-identifier">xs</span><span class="hs-special">]</span><span>
</span><a name="line-254"></a><span>    </span><a name="local-1627900065"><a href="#local-1627900065"><span class="hs-identifier">nil</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#PmExprCon"><span class="hs-identifier hs-var">PmExprCon</span></a><span> </span><a href="TysWiredIn.html#consDataCon"><span class="hs-identifier hs-var">nilDataCon</span></a><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ExplicitPArr</span><span> </span><span class="hs-identifier">_elem_ty</span><span> </span><span class="hs-identifier">elems</span><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PmExprCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">parrFakeCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">elems</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">lhsExprToPmExpr</span><span> </span><span class="hs-identifier">elems</span><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-comment">-- we want this but we would have to make evrything monadic :/</span><span>
</span><a name="line-260"></a><span class="hs-comment">-- ./compiler/deSugar/DsMonad.hs:397:dsLookupDataCon :: Name -&gt; DsM DataCon</span><span>
</span><a name="line-261"></a><span class="hs-comment">--</span><span>
</span><a name="line-262"></a><span class="hs-comment">-- hsExprToPmExpr (RecordCon   c _ binds) = do</span><span>
</span><a name="line-263"></a><span class="hs-comment">--   con  &lt;- dsLookupDataCon (unLoc c)</span><span>
</span><a name="line-264"></a><span class="hs-comment">--   args &lt;- mapM lhsExprToPmExpr (hsRecFieldsArgs binds)</span><span>
</span><a name="line-265"></a><span class="hs-comment">--   return (PmExprCon con args)</span><span>
</span><a name="line-266"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-identifier">e</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">RecordCon</span><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PmExprOther</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HsTick</span><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">lhsExprToPmExpr</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-269"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HsBinTick</span><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627900072"><a href="#local-1627900072"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#lhsExprToPmExpr"><span class="hs-identifier hs-var">lhsExprToPmExpr</span></a><span> </span><a href="#local-1627900072"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-270"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HsTickPragma</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627900073"><a href="#local-1627900073"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#lhsExprToPmExpr"><span class="hs-identifier hs-var">lhsExprToPmExpr</span></a><span> </span><a href="#local-1627900073"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-271"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsTickPragma"><span class="hs-identifier hs-var">HsSCC</span></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627900074"><a href="#local-1627900074"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#lhsExprToPmExpr"><span class="hs-identifier hs-var">lhsExprToPmExpr</span></a><span> </span><a href="#local-1627900074"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-272"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HsCoreAnn</span><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627900075"><a href="#local-1627900075"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#lhsExprToPmExpr"><span class="hs-identifier hs-var">lhsExprToPmExpr</span></a><span> </span><a href="#local-1627900075"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-273"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ExprWithTySig</span><span>     </span><span class="hs-identifier">e</span><span> </span><a name="local-1627900076"><a href="#local-1627900076"><span class="hs-identifier">_</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#lhsExprToPmExpr"><span class="hs-identifier hs-var">lhsExprToPmExpr</span></a><span> </span><a href="#local-1627900076"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-274"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ExprWithTySigOut</span><span>  </span><a name="local-1627900077"><a href="#local-1627900077"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#lhsExprToPmExpr"><span class="hs-identifier hs-var">lhsExprToPmExpr</span></a><span> </span><a href="#local-1627900077"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-275"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#ExprWithTySigOut"><span class="hs-identifier hs-var">HsWrap</span></a><span>            </span><a name="local-1627900078"><a href="#local-1627900078"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="PmExpr.html#lhsExprToPmExpr"><span class="hs-identifier hs-var">hsExprToPmExpr</span></a><span> </span><a href="#local-1627900078"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-276"></a><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PmExprOther</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-comment">-- the rest are not handled by the oracle</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-identifier">synExprToPmExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">SyntaxExpr</span><span> </span><span class="hs-identifier">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PmExpr</span><span>
</span><a name="line-279"></a><span class="hs-identifier">synExprToPmExpr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsExprToPmExpr</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">syn_expr</span><span>  </span><span class="hs-comment">-- ignore the wrappers</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                            Pretty printing
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span class="hs-comment">{- 1. Literals
~~~~~~~~~~~~~~
Starting with a function definition like:

    f :: Int -&gt; Bool
    f 5 = True
    f 6 = True

The uncovered set looks like:
    { var |&gt; False == (var == 5), False == (var == 6) }

Yet, we would like to print this nicely as follows:
   x , where x not one of {5,6}

Function `filterComplex' takes the set of residual constraints and packs
together the negative constraints that refer to the same variable so we can do
just this. Since these variables will be shown to the programmer, we also give
them better names (t1, t2, ..), hence the SDoc in PmNegLitCt.

2. Residual Constraints
~~~~~~~~~~~~~~~~~~~~~~~
Unhandled constraints that refer to HsExpr are typically ignored by the solver
(it does not even substitute in HsExpr so they are even printed as wildcards).
Additionally, the oracle returns a substitution if it succeeds so we apply this
substitution to the vectors before printing them out (see function `pprOne' in
Check.hs) to be more precice.
-}</span><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-318"></a><span class="hs-comment">-- ** Transform residual constraints in appropriate form for pretty printing</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">PmNegLitCt</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Name</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SDoc</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">PmLit</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-identifier">filterComplex</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">ComplexEq</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">PmNegLitCt</span><span class="hs-special">]</span><span>
</span><a name="line-323"></a><span class="hs-identifier">filterComplex</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">zipWith</span><span> </span><span class="hs-identifier">rename</span><span> </span><span class="hs-identifier">nameList</span><span> </span><a href="PmExpr.html#PmNegLitCt"><span class="hs-operator hs-type">.</span></a><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">mkGroup</span><span>
</span><a name="line-324"></a><span>              </span><span class="hs-operator">.</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">groupBy</span></a><span> </span><a href="#local-1627900084"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1627900084"><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1627900087"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><span class="hs-identifier">order</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">mapMaybe</span><span> </span><span class="hs-identifier">isNegLitCs</span><span>
</span><a name="line-325"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-326"></a><span>    </span><span class="hs-identifier">order</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">y</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fst</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fst</span><span> </span><span class="hs-identifier">y</span><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>    </span><a name="local-1627900081"><a href="#local-1627900081"><span class="hs-identifier">name</span></a></a><span>  </span><a name="local-1627900088"><a href="#local-1627900088"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627900089"><a href="#local-1627900089"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-identifier hs-var">x</span><span> </span><span class="hs-operator">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1627900088"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-328"></a><span>    </span><span class="hs-identifier">mkGroup</span><span> </span><a name="local-1627900091"><a href="#local-1627900091"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">head</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nubPmLit</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">snd</span><span> </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>    </span><a name="local-1627900083"><a href="#local-1627900083"><span class="hs-identifier">rename</span></a></a><span> </span><span class="hs-identifier">new</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">old</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lits</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">old</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#nubPmLit"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">lits</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span>    </span><span class="hs-identifier">isNegLitCs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e1</span><span class="hs-special">,</span><span class="hs-identifier">e2</span><span class="hs-special">)</span><span>
</span><a name="line-332"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">isFalsePmExpr</span><span> </span><span class="hs-identifier">e1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span class="hs-identifier">y</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">isPmExprEq</span><span> </span><span class="hs-identifier">e2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isNegLitCs'</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">y</span><span>
</span><a name="line-333"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="PmExpr.html#isFalsePmExpr"><span class="hs-identifier hs-var">isFalsePmExpr</span></a><span> </span><a href="#local-1627900096"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627900098"><a href="#local-1627900098"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-1627900099"><a href="#local-1627900099"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PmExpr.html#isPmExprEq"><span class="hs-identifier hs-var">isPmExprEq</span></a><span> </span><a href="#local-1627900097"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627900086"><span class="hs-identifier hs-var">isNegLitCs'</span></a><span> </span><a href="#local-1627900098"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627900099"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-334"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="PmExpr.html#isFalsePmExpr"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span>    </span><span class="hs-identifier">isNegLitCs'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprVar</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprLit</span><span> </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span>
</span><a name="line-337"></a><span>    </span><a name="local-1627900086"><a href="#local-1627900086"><span class="hs-identifier">isNegLitCs'</span></a></a><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmExprVar"><span class="hs-identifier hs-var">PmExprLit</span></a><span> </span><a name="local-1627900102"><a href="#local-1627900102"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmExprLit"><span class="hs-identifier hs-var">PmExprVar</span></a><span> </span><a name="local-1627900103"><a href="#local-1627900103"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627900102"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627900103"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>    </span><span class="hs-identifier">isNegLitCs'</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="PmExpr.html#PmExprLit"><span class="hs-identifier hs-var">_</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-339"></a><span>
</span><a name="line-340"></a><span>    </span><span class="hs-comment">-- Try nice names p,q,r,s,t before using the (ugly) t_i</span><span>
</span><a name="line-341"></a><span>    </span><span class="hs-identifier">nameList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">SDoc</span><span class="hs-special">]</span><span>
</span><a name="line-342"></a><span>    </span><span class="hs-identifier">nameList</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;p&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;q&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;r&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;s&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;t&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-operator">++</span><span>
</span><a name="line-343"></a><span>                 </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><span class="hs-char">'t'</span><span class="hs-glyph">:</span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-346"></a><span>
</span><a name="line-347"></a><span class="hs-identifier">runPmPprM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmPprM</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">PmNegLitCt</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">SDoc</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier">PmLit</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span class="hs-identifier">runPmPprM</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-identifier">lit_env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">result</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mapMaybe</span><span> </span><span class="hs-identifier">is_used</span><span> </span><span class="hs-identifier">lit_env</span><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-350"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">result</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_lit_env</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">used</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runState</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">lit_env</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">emptyNameSet</span><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span>    </span><span class="hs-identifier">is_used</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier">name</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lits</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-353"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">elemNameSet</span><span> </span><span class="hs-identifier">x</span><span> </span><a name="local-1627900115"><a href="#local-1627900115"><span class="hs-identifier">used</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">name</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lits</span><span class="hs-special">)</span><span>
</span><a name="line-354"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-355"></a><span>
</span><a name="line-356"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">PmPprM</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">State</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier">PmNegLitCt</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">NameSet</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- (the first part of the state is read only. make it a reader?)</span><span>
</span><a name="line-358"></a><span>
</span><a name="line-359"></a><span class="hs-identifier">addUsed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PmPprM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-360"></a><span class="hs-identifier">addUsed</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">modify</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">negated</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">used</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">negated</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">extendNameSet</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-identifier">checkNegation</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PmPprM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">SDoc</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- the clean name if it is negated</span><span>
</span><a name="line-363"></a><span class="hs-identifier">checkNegation</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-364"></a><span>  </span><a name="checkNegation"><a href="PmExpr.html#checkNegation"><span class="hs-identifier">negated</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">gets</span><span> </span><span class="hs-identifier">fst</span><span>
</span><a name="line-365"></a><span>  </span><a name="local-1627900120"><a href="#local-1627900120"><span class="hs-identifier">return</span></a></a><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">lookup</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">negated</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-366"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">new</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Just</span><span> </span><a href="#local-1627900120"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-367"></a><span>    </span><span class="hs-identifier">Nothing</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-comment">-- | Pretty print a pmexpr, but remember to prettify the names of the variables</span><span>
</span><a name="line-370"></a><span class="hs-comment">-- that refer to neg-literals. The ones that cannot be shown are printed as</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- underscores.</span><span>
</span><a name="line-372"></a><span class="hs-identifier">pprPmExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PmPprM</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-373"></a><span class="hs-identifier">pprPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprVar</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-374"></a><span>  </span><a name="pprPmExpr"><a href="PmExpr.html#pprPmExpr"><span class="hs-identifier">mb_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">checkNegation</span><span> </span><span class="hs-identifier">x</span><span>
</span><a name="line-375"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">mb_name</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-376"></a><span>    </span><span class="hs-identifier">Just</span><span> </span><a href="#local-1627900123"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">addUsed</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-377"></a><span>    </span><span class="hs-identifier">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PmExpr.html#addUsed"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier">underscore</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-identifier">pprPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprCon</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-identifier">args</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pprPmExprCon</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-identifier">args</span><span>
</span><a name="line-380"></a><span class="hs-identifier">pprPmExpr</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmExprCon"><span class="hs-identifier hs-var">PmExprLit</span></a><span> </span><a name="local-1627900125"><a href="#local-1627900125"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#pprPmExprCon"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="PmExpr.html#pprPmExprCon"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span>
</span><a name="line-381"></a><span class="hs-identifier">pprPmExpr</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmExprLit"><span class="hs-identifier hs-var">PmExprEq</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier">underscore</span><span> </span><span class="hs-comment">-- don't show</span><span>
</span><a name="line-382"></a><span class="hs-identifier">pprPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprOther</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="Outputable.html#underscore"><span class="hs-identifier hs-var">underscore</span></a><span> </span><span class="hs-comment">-- don't show</span><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span class="hs-identifier">needsParens</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-385"></a><span class="hs-identifier">needsParens</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprVar</span><span>   </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-386"></a><a name="needsParens"><a href="PmExpr.html#needsParens"><span class="hs-identifier">needsParens</span></a></a><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmExprVar"><span class="hs-identifier hs-var">PmExprLit</span></a><span>    </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isNegatedPmLit</span><span> </span><span class="hs-identifier">l</span><span>
</span><a name="line-387"></a><span class="hs-identifier">needsParens</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmExprLit"><span class="hs-identifier hs-var">PmExprEq</span></a><span>    </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PmExpr.html#isNegatedPmLit"><span class="hs-identifier hs-var">False</span></a><span> </span><span class="hs-comment">-- will become a wildcard</span><span>
</span><a name="line-388"></a><span class="hs-identifier">needsParens</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmExprOther</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">-- will become a wildcard</span><span>
</span><a name="line-389"></a><span class="hs-identifier">needsParens</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmExprOther"><span class="hs-identifier hs-var">PmExprCon</span></a><span> </span><a href="PmExpr.html#PmExprOther"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-identifier">es</span><span class="hs-special">)</span><span>
</span><a name="line-390"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">isTupleDataCon</span><span> </span><a href="PmExpr.html#PmExprCon"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">isPArrFakeCon</span><span> </span><span class="hs-identifier">c</span><span>
</span><a name="line-391"></a><span>  </span><span class="hs-operator">||</span><span> </span><a href="DataCon.html#isTupleDataCon"><span class="hs-identifier hs-var">isConsDataCon</span></a><span> </span><a href="#local-1627900129"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="TysWiredIn.html#isPArrFakeCon"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="TysWiredIn.html#isPArrFakeCon"><span class="hs-identifier hs-var">es</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-392"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span class="hs-identifier">pprPmExprWithParens</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PmPprM</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-395"></a><span class="hs-identifier">pprPmExprWithParens</span><span> </span><span class="hs-identifier">expr</span><span>
</span><a name="line-396"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="pprPmExprWithParens"><a href="PmExpr.html#pprPmExprWithParens"><span class="hs-identifier">needsParens</span></a></a><span> </span><span class="hs-identifier">expr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">parens</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">pprPmExpr</span><span> </span><span class="hs-identifier">expr</span><span>
</span><a name="line-397"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="PmExpr.html#needsParens"><span class="hs-identifier hs-var">otherwise</span></a><span>        </span><span class="hs-glyph">=</span><span>            </span><a href="PmExpr.html#pprPmExpr"><span class="hs-identifier hs-var">pprPmExpr</span></a><span> </span><a href="#local-1627900131"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-identifier">pprPmExprCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">PmExpr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PmPprM</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-400"></a><span class="hs-identifier">pprPmExprCon</span><span> </span><span class="hs-identifier">con</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">args</span></a><span>
</span><a name="line-401"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">isTupleDataCon</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mkTuple</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">pprPmExpr</span><span> </span><span class="hs-identifier">args</span><span>
</span><a name="line-402"></a><span>  </span><span class="hs-glyph">|</span><span>  </span><a href="DataCon.html#isTupleDataCon"><span class="hs-identifier hs-var">isPArrFakeCon</span></a><span> </span><a href="#local-1627900132"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627900134"><span class="hs-identifier hs-var">mkPArr</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="PmExpr.html#pprPmExpr"><span class="hs-identifier hs-var">pprPmExpr</span></a><span> </span><a href="#local-1627900133"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-403"></a><span>  </span><span class="hs-glyph">|</span><span>  </span><a href="TysWiredIn.html#isPArrFakeCon"><span class="hs-identifier hs-var">isConsDataCon</span></a><span> </span><a href="#local-1627900132"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pretty_list</span><span>
</span><a name="line-404"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">dataConIsInfix</span><span> </span><a href="#local-1627900132"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627900136"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-405"></a><span>      </span><span class="hs-special">[</span><a href="DataCon.html#dataConIsInfix"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#dataConIsInfix"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="#local-1627900132"><span class="hs-identifier hs-var">x'</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">pprPmExprWithParens</span><span> </span><span class="hs-identifier">x</span><span>
</span><a name="line-406"></a><span>                   </span><a name="local-1627900148"><a href="#local-1627900148"><span class="hs-identifier">y'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PmExpr.html#pprPmExprWithParens"><span class="hs-identifier hs-var">pprPmExprWithParens</span></a><span> </span><a href="#local-1627900146"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-407"></a><span>                   </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#pprPmExprWithParens"><span class="hs-identifier hs-var">x'</span></a><span> </span><a href="PmExpr.html#pprPmExprWithParens"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="PmExpr.html#pprPmExprWithParens"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="PmExpr.html#pprPmExprWithParens"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">y'</span><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span>      </span><span class="hs-comment">-- can it be infix but have more than two arguments?</span><span>
</span><a name="line-409"></a><span>      </span><span class="hs-identifier">list</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pprPanic</span><span> </span><span class="hs-string">&quot;pprPmExprCon:&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">list</span><span class="hs-special">)</span><span>
</span><a name="line-410"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">con</span><span class="hs-special">)</span><span>
</span><a name="line-411"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">args'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">pprPmExprWithParens</span><span> </span><span class="hs-identifier">args</span><span>
</span><a name="line-412"></a><span>                   </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fsep</span><span> </span><span class="hs-special">(</span><a href="PmExpr.html#pprPmExprWithParens"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="PmExpr.html#pprPmExprWithParens"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="PmExpr.html#pprPmExprWithParens"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-413"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-414"></a><span>    </span><span class="hs-identifier">mkTuple</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkPArr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">SDoc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-415"></a><span>    </span><span class="hs-identifier">mkTuple</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">parens</span><span>     </span><a href="Outputable.html#SDoc"><span class="hs-operator hs-type">.</span></a><span> </span><span class="hs-identifier">fsep</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">punctuate</span><span> </span><span class="hs-identifier">comma</span><span>
</span><a name="line-416"></a><span>    </span><a name="local-1627900134"><a href="#local-1627900134"><span class="hs-identifier">mkPArr</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">paBrackets</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-417"></a><span>
</span><a name="line-418"></a><span>    </span><span class="hs-comment">-- lazily, to be used in the list case only</span><span>
</span><a name="line-419"></a><span>    </span><span class="hs-identifier">pretty_list</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PmPprM</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-420"></a><span>    </span><span class="hs-identifier">pretty_list</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">isNilPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">last</span><span> </span><span class="hs-identifier">list</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-421"></a><span>      </span><a name="local-1627900136"><a href="#local-1627900136"><span class="hs-identifier">True</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">brackets</span><span> </span><a href="PmExpr.html#isNilPmExpr"><span class="hs-operator hs-var">.</span></a><span> </span><a href="PmExpr.html#isNilPmExpr"><span class="hs-identifier hs-var">fsep</span></a><span> </span><a href="PmExpr.html#isNilPmExpr"><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">punctuate</span><span> </span><span class="hs-identifier">comma</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">pprPmExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">init</span><span> </span><span class="hs-identifier">list</span><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>      </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">parens</span></a><span>   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#fsep"><span class="hs-identifier hs-var">hcat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">colon</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="PmExpr.html#pprPmExpr"><span class="hs-identifier hs-var">pprPmExpr</span></a><span> </span><span class="hs-identifier">list</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span>    </span><span class="hs-identifier">list</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">list_elements</span><span> </span><span class="hs-identifier">args</span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span>    </span><span class="hs-identifier">list_elements</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span class="hs-identifier">y</span><span class="hs-special">]</span><span>
</span><a name="line-427"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a name="local-1627900138"><a href="#local-1627900138"><span class="hs-identifier">PmExprCon</span></a></a><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">es</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">y</span><span class="hs-special">,</span><span>  </span><span class="hs-identifier">nilDataCon</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">es</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span class="hs-identifier">y</span><span class="hs-special">]</span><span>
</span><a name="line-428"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="PmExpr.html#PmExprCon"><span class="hs-identifier hs-var">PmExprCon</span></a><span> </span><a name="local-1627900141"><a href="#local-1627900141"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-1627900142"><a href="#local-1627900142"><span class="hs-identifier">es</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627900140"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">consDataCon</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627900141"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">list_elements</span><span> </span><span class="hs-identifier">es</span><span>
</span><a name="line-429"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="PmExpr.html#PmExprCon"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a name="local-1627900144"><a href="#local-1627900144"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span class="hs-identifier">y</span><span class="hs-special">]</span><span>
</span><a name="line-430"></a><span>    </span><span class="hs-identifier">list_elements</span><span> </span><span class="hs-identifier">list</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pprPanic</span><span> </span><span class="hs-string">&quot;list_elements:&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">list</span><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Outputable</span><span> </span><span class="hs-identifier">PmLit</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-433"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PmSLit</span><span>     </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pmPprHsLit</span><span> </span><span class="hs-identifier">l</span><span>
</span><a name="line-434"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="PmExpr.html#PmSLit"><span class="hs-identifier hs-var">PmOLit</span></a><span> </span><span class="hs-identifier">neg</span><span> </span><a name="local-1627900153"><a href="#local-1627900153"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="HsLit.html#pmPprHsLit"><span class="hs-identifier hs-var">neg</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">char</span><span> </span><span class="hs-char">'-'</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">empty</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">l</span><span>
</span><a name="line-435"></a><span>
</span><a name="line-436"></a><span class="hs-comment">-- not really useful for pmexprs per se</span><span>
</span><a name="line-437"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Outputable</span><span> </span><span class="hs-identifier">PmExpr</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-438"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">fst</span></a><span> </span><a href="Outputable.html#Outputable"><span class="hs-operator hs-type">$</span></a><span> </span><span class="hs-identifier">runPmPprM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pprPmExpr</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-439"></a></pre></body></html>