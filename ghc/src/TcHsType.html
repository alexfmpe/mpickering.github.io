<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[TcMonoType]{Typechecking user-specified @MonoTypes@}
-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE CPP, TupleSections, MultiWayIf #-}</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcHsType</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-11"></a><span>        </span><span class="hs-comment">-- Type signatures</span><span>
</span><a name="line-12"></a><span>        </span><a href="TcHsType.html#kcHsSigType"><span class="hs-identifier hs-var">kcHsSigType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcClassSigType"><span class="hs-identifier hs-var">tcClassSigType</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="TcHsType.html#tcHsSigType"><span class="hs-identifier hs-var">tcHsSigType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcHsSigWcType"><span class="hs-identifier hs-var">tcHsSigWcType</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="TcHsType.html#funsSigCtxt"><span class="hs-identifier hs-var">funsSigCtxt</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span>        </span><a href="TcHsType.html#tcHsClsInstType"><span class="hs-identifier hs-var">tcHsClsInstType</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="TcHsType.html#tcHsDeriv"><span class="hs-identifier hs-var">tcHsDeriv</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcHsVectInst"><span class="hs-identifier hs-var">tcHsVectInst</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>        </span><a href="TcHsType.html#tcHsTypeApp"><span class="hs-identifier hs-var">tcHsTypeApp</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>        </span><a href="TcHsType.html#tcImplicitTKBndrs"><span class="hs-identifier hs-var">tcImplicitTKBndrs</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcImplicitTKBndrsType"><span class="hs-identifier hs-var">tcImplicitTKBndrsType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcExplicitTKBndrs"><span class="hs-identifier hs-var">tcExplicitTKBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>                </span><span class="hs-comment">-- Type checking type and class decls</span><span>
</span><a name="line-23"></a><span>        </span><a href="TcHsType.html#kcLookupKind"><span class="hs-identifier hs-var">kcLookupKind</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#kcTyClTyVars"><span class="hs-identifier hs-var">kcTyClTyVars</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcTyClTyVars"><span class="hs-identifier hs-var">tcTyClTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="TcHsType.html#tcHsConArgType"><span class="hs-identifier hs-var">tcHsConArgType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcDataKindSig"><span class="hs-identifier hs-var">tcDataKindSig</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span>        </span><span class="hs-comment">-- Kind-checking types</span><span>
</span><a name="line-27"></a><span>        </span><span class="hs-comment">-- No kind generalisation, no checkValidType</span><span>
</span><a name="line-28"></a><span>        </span><a href="TcHsType.html#tcWildCardBinders"><span class="hs-identifier hs-var">tcWildCardBinders</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="TcHsType.html#kcHsTyVarBndrs"><span class="hs-identifier hs-var">kcHsTyVarBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>        </span><a href="TcHsType.html#tcHsLiftedType"><span class="hs-identifier hs-var">tcHsLiftedType</span></a><span class="hs-special">,</span><span>   </span><a href="TcHsType.html#tcHsOpenType"><span class="hs-identifier hs-var">tcHsOpenType</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>        </span><a href="TcHsType.html#tcHsLiftedTypeNC"><span class="hs-identifier hs-var">tcHsLiftedTypeNC</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcHsOpenTypeNC"><span class="hs-identifier hs-var">tcHsOpenTypeNC</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="TcHsType.html#tcLHsType"><span class="hs-identifier hs-var">tcLHsType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>        </span><a href="TcHsType.html#tcHsContext"><span class="hs-identifier hs-var">tcHsContext</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcLHsPredType"><span class="hs-identifier hs-var">tcLHsPredType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcInferApps"><span class="hs-identifier hs-var">tcInferApps</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcInferArgs"><span class="hs-identifier hs-var">tcInferArgs</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>        </span><a href="TcSimplify.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- useful re-export</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>        </span><a href="TcHsType.html#kindGeneralize"><span class="hs-identifier hs-var">kindGeneralize</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>        </span><span class="hs-comment">-- Sort-checking kinds</span><span>
</span><a name="line-39"></a><span>        </span><a href="TcHsType.html#tcLHsKind"><span class="hs-identifier hs-var">tcLHsKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span>        </span><span class="hs-comment">-- Pattern type signatures</span><span>
</span><a name="line-42"></a><span>        </span><a href="TcHsType.html#tcHsPatSigType"><span class="hs-identifier hs-var">tcHsPatSigType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcPatSig"><span class="hs-identifier hs-var">tcPatSig</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#funAppCtxt"><span class="hs-identifier hs-var">funAppCtxt</span></a><span>
</span><a name="line-43"></a><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="TcEvidence.html"><span class="hs-identifier">TcEvidence</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="TcEnv.html"><span class="hs-identifier">TcEnv</span></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="TcMType.html"><span class="hs-identifier">TcMType</span></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="TcValidity.html"><span class="hs-identifier">TcValidity</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="TcUnify.html"><span class="hs-identifier">TcUnify</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="TcIface.html"><span class="hs-identifier">TcIface</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="TcSimplify.html"><span class="hs-identifier">TcSimplify</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcSimplify.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Inst.html"><span class="hs-identifier">Inst</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="Inst.html#tcInstBinders"><span class="hs-identifier hs-var">tcInstBinders</span></a><span class="hs-special">,</span><span> </span><a href="Inst.html#tcInstBindersX"><span class="hs-identifier hs-var">tcInstBindersX</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="Kind.html"><span class="hs-identifier">Kind</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span class="hs-special">(</span><span> </span><a href="RdrName.html#lookupLocalRdrOcc"><span class="hs-identifier hs-var">lookupLocalRdrOcc</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="ConLike.html"><span class="hs-identifier">ConLike</span></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="TysPrim.html"><span class="hs-identifier">TysPrim</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TysPrim.html#tYPE"><span class="hs-identifier hs-var">tYPE</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="Constants.html"><span class="hs-identifier">Constants</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Constants.html#mAX_CTUPLE_SIZE"><span class="hs-identifier hs-var">mAX_CTUPLE_SIZE</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span class="hs-special">(</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="PrelNames.html#wildCardName"><span class="hs-identifier hs-var">wildCardName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><a href="Pair.html"><span class="hs-identifier">Pair</span></a><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span></a><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-comment">{-
        ----------------------------
                General notes
        ----------------------------

Unlike with expressions, type-checking types both does some checking and
desugars at the same time. This is necessary because we often want to perform
equality checks on the types right away, and it would be incredibly painful
to do this on un-desugared types. Luckily, desugared types are close enough
to HsTypes to make the error messages sane.

During type-checking, we perform as little validity checking as possible.
This is because some type-checking is done in a mutually-recursive knot, and
if we look too closely at the tycons, we'll loop. This is why we always must
use mkNakedTyConApp and mkNakedAppTys, etc., which never look at a tycon.
The mkNamed... functions don't uphold Type invariants, but zonkTcTypeToType
will repair this for us. Note that zonkTcType *is* safe within a knot, and
can be done repeatedly with no ill effect: it just squeezes out metavariables.

Generally, after type-checking, you will want to do validity checking, say
with TcValidity.checkValidType.

Validity checking
~~~~~~~~~~~~~~~~~
Some of the validity check could in principle be done by the kind checker,
but not all:

- During desugaring, we normalise by expanding type synonyms.  Only
  after this step can we check things like type-synonym saturation
  e.g.  type T k = k Int
        type S a = a
  Then (T S) is ok, because T is saturated; (T S) expands to (S Int);
  and then S is saturated.  This is a GHC extension.

- Similarly, also a GHC extension, we look through synonyms before complaining
  about the form of a class or instance declaration

- Ambiguity checks involve functional dependencies, and it's easier to wait
  until knots have been resolved before poking into them

Also, in a mutually recursive group of types, we can't look at the TyCon until we've
finished building the loop.  So to keep things simple, we postpone most validity
checking until step (3).

Knot tying
~~~~~~~~~~
During step (1) we might fault in a TyCon defined in another module, and it might
(via a loop) refer back to a TyCon defined in this module. So when we tie a big
knot around type declarations with ARecThing, so that the fault-in code can get
the TyCon being defined.

%************************************************************************
%*                                                                      *
              Check types AND do validity checking
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-identifier">funsSigCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>
</span><a name="line-149"></a><span class="hs-comment">-- Returns FunSigCtxt, with no redundant-context-reporting,</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- form a list of located names</span><span>
</span><a name="line-151"></a><a name="funsSigCtxt"><a href="TcHsType.html#funsSigCtxt"><span class="hs-identifier">funsSigCtxt</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244568"><a href="#local-1628244568"><span class="hs-identifier">name1</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a href="#local-1628244568"><span class="hs-identifier hs-var">name1</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-152"></a><span class="hs-identifier">funsSigCtxt</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;funSigCtxt&quot;</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-identifier">addSigCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244567"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244567"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-155"></a><a name="addSigCtxt"><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier">addSigCtxt</span></a></a><span> </span><a name="local-1628244569"><a href="#local-1628244569"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-1628244570"><a href="#local-1628244570"><span class="hs-identifier">sig_ty</span></a></a><span> </span><a name="local-1628244571"><a href="#local-1628244571"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-156"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><a href="#local-1628244570"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-157"></a><span>    </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#pprSigCtxt"><span class="hs-identifier hs-var">pprSigCtxt</span></a><span> </span><a href="#local-1628244569"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244570"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-158"></a><span>    </span><a href="#local-1628244571"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-identifier">tcHsSigWcType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-161"></a><span class="hs-comment">-- This one is used when we have a LHsSigWcType, but in</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- a place where wildards aren't allowed. The renamer has</span><span>
</span><a name="line-163"></a><span class="hs-comment">-- alrady checked this, so we can simply ignore it.</span><span>
</span><a name="line-164"></a><a name="tcHsSigWcType"><a href="TcHsType.html#tcHsSigWcType"><span class="hs-identifier">tcHsSigWcType</span></a></a><span> </span><a name="local-1628244572"><a href="#local-1628244572"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-1628244573"><a href="#local-1628244573"><span class="hs-identifier">sig_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcHsSigType"><span class="hs-identifier hs-var">tcHsSigType</span></a><span> </span><a href="#local-1628244572"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#dropWildCards"><span class="hs-identifier hs-var">dropWildCards</span></a><span> </span><a href="#local-1628244573"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-identifier">kcHsSigType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-167"></a><a name="kcHsSigType"><a href="TcHsType.html#kcHsSigType"><span class="hs-identifier">kcHsSigType</span></a></a><span> </span><a name="local-1628244574"><a href="#local-1628244574"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244575"><a href="#local-1628244575"><span class="hs-identifier">hs_ty</span></a></a><span>
</span><a name="line-168"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244576"><a href="#local-1628244576"><span class="hs-identifier">sig_vars</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-169"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#funsSigCtxt"><span class="hs-identifier hs-var">funsSigCtxt</span></a><span> </span><a href="#local-1628244574"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244575"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-170"></a><span>    </span><a href="TcRnMonad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-171"></a><span>    </span><a href="TcHsType.html#tcImplicitTKBndrsType"><span class="hs-identifier hs-var">tcImplicitTKBndrsType</span></a><span> </span><a href="#local-1628244576"><span class="hs-identifier hs-var">sig_vars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-172"></a><span>    </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-1628244575"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-identifier">tcClassSigType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-175"></a><span class="hs-comment">-- Does not do validity checking; this must be done outside</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- the recursive class declaration &quot;knot&quot;</span><span>
</span><a name="line-177"></a><a name="tcClassSigType"><a href="TcHsType.html#tcClassSigType"><span class="hs-identifier">tcClassSigType</span></a></a><span> </span><a name="local-1628244577"><a href="#local-1628244577"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-1628244578"><a href="#local-1628244578"><span class="hs-identifier">sig_ty</span></a></a><span>
</span><a name="line-178"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#funsSigCtxt"><span class="hs-identifier hs-var">funsSigCtxt</span></a><span> </span><a href="#local-1628244577"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsSigType"><span class="hs-identifier hs-var">hsSigType</span></a><span> </span><a href="#local-1628244578"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-179"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244579"><a href="#local-1628244579"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_hs_sig_type"><span class="hs-identifier hs-var">tc_hs_sig_type</span></a><span> </span><a href="#local-1628244578"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-180"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#kindGeneralizeType"><span class="hs-identifier hs-var">kindGeneralizeType</span></a><span> </span><a href="#local-1628244579"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span class="hs-identifier">tcHsSigType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-183"></a><span class="hs-comment">-- Does validity checking</span><span>
</span><a name="line-184"></a><a name="tcHsSigType"><a href="TcHsType.html#tcHsSigType"><span class="hs-identifier">tcHsSigType</span></a></a><span> </span><a name="local-1628244580"><a href="#local-1628244580"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-1628244581"><a href="#local-1628244581"><span class="hs-identifier">sig_ty</span></a></a><span>
</span><a name="line-185"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a><span> </span><a href="#local-1628244580"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsSigType"><span class="hs-identifier hs-var">hsSigType</span></a><span> </span><a href="#local-1628244581"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-186"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244584"><a href="#local-1628244584"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcValidity.html#expectedKindInCtxt"><span class="hs-identifier hs-var">expectedKindInCtxt</span></a><span> </span><a href="#local-1628244580"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-187"></a><span>                    </span><a href="TcValidity.html#AnythingKind"><span class="hs-identifier hs-var">AnythingKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-188"></a><span>                    </span><a href="TcValidity.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a><span> </span><a name="local-1628244582"><a href="#local-1628244582"><span class="hs-identifier">k</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628244582"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-189"></a><span>                    </span><a href="TcValidity.html#OpenKind"><span class="hs-identifier hs-var">OpenKind</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244583"><a href="#local-1628244583"><span class="hs-identifier">rr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span> </span><a href="TysWiredIn.html#runtimeRepTy"><span class="hs-identifier hs-var">runtimeRepTy</span></a><span>
</span><a name="line-190"></a><span>                                       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TysPrim.html#tYPE"><span class="hs-identifier hs-var">tYPE</span></a><span> </span><a href="#local-1628244583"><span class="hs-identifier hs-var">rr</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-191"></a><span>              </span><span class="hs-comment">-- The kind is checked by checkValidType, and isn't necessarily</span><span>
</span><a name="line-192"></a><span>              </span><span class="hs-comment">-- of kind * in a Template Haskell quote eg [t| Maybe |]</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244585"><a href="#local-1628244585"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_hs_sig_type"><span class="hs-identifier hs-var">tc_hs_sig_type</span></a><span> </span><a href="#local-1628244581"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><a href="#local-1628244584"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-195"></a><span>          </span><span class="hs-comment">-- Generalise here: see Note [Kind generalisation]</span><span>
</span><a name="line-196"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244586"><a href="#local-1628244586"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#maybeKindGeneralizeType"><span class="hs-identifier hs-var">maybeKindGeneralizeType</span></a><span> </span><a href="#local-1628244585"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-comment">-- also zonks</span><span>
</span><a name="line-197"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a><span> </span><a href="#local-1628244580"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-1628244586"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-198"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628244586"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-identifier">tc_hs_sig_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-201"></a><span class="hs-comment">-- Does not do validity checking or zonking</span><span>
</span><a name="line-202"></a><a name="tc_hs_sig_type"><a href="TcHsType.html#tc_hs_sig_type"><span class="hs-identifier">tc_hs_sig_type</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244587"><a href="#local-1628244587"><span class="hs-identifier">hs_ty</span></a></a><span>
</span><a name="line-203"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244588"><a href="#local-1628244588"><span class="hs-identifier">sig_vars</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628244589"><a href="#local-1628244589"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-204"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628244590"><a href="#local-1628244590"><span class="hs-identifier">tkvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244591"><a href="#local-1628244591"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSimplify.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-205"></a><span>                       </span><a href="TcHsType.html#tcImplicitTKBndrsType"><span class="hs-identifier hs-var">tcImplicitTKBndrsType</span></a><span> </span><a href="#local-1628244588"><span class="hs-identifier hs-var">sig_vars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-206"></a><span>                       </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-1628244587"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="#local-1628244589"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-207"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a><span> </span><a href="#local-1628244590"><span class="hs-identifier hs-var">tkvs</span></a><span> </span><a href="#local-1628244591"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-210"></a><span class="hs-identifier">tcHsDeriv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- Like tcHsSigType, but for the ...deriving( C t1 ty2 ) clause</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- Returns the C, [ty1, ty2, and the kind of C's *next* argument</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- E.g.    class C (a::*) (b::k-&gt;k)</span><span>
</span><a name="line-214"></a><span class="hs-comment">--         data T a b = ... deriving( C Int )</span><span>
</span><a name="line-215"></a><span class="hs-comment">--    returns ([k], C, [k, Int],  k-&gt;k)</span><span>
</span><a name="line-216"></a><span class="hs-comment">-- Also checks that (C ty1 ty2 arg) :: Constraint</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- if arg has a suitable kind</span><span>
</span><a name="line-218"></a><a name="tcHsDeriv"><a href="TcHsType.html#tcHsDeriv"><span class="hs-identifier">tcHsDeriv</span></a></a><span> </span><a name="local-1628244592"><a href="#local-1628244592"><span class="hs-identifier">hs_ty</span></a></a><span>
</span><a name="line-219"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244593"><a href="#local-1628244593"><span class="hs-identifier">arg_kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-220"></a><span>                    </span><span class="hs-comment">-- always safe to kind-generalize, because there</span><span>
</span><a name="line-221"></a><span>                    </span><span class="hs-comment">-- can be no covars in an outer scope</span><span>
</span><a name="line-222"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244594"><a href="#local-1628244594"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-223"></a><span>                 </span><span class="hs-comment">-- avoid redundant error report with &quot;illegal deriving&quot;, below</span><span>
</span><a name="line-224"></a><span>               </span><a href="TcHsType.html#tc_hs_sig_type"><span class="hs-identifier hs-var">tc_hs_sig_type</span></a><span> </span><a href="#local-1628244592"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><a href="#local-1628244593"><span class="hs-identifier hs-var">arg_kind</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244595"><a href="#local-1628244595"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#kindGeneralizeType"><span class="hs-identifier hs-var">kindGeneralizeType</span></a><span> </span><a href="#local-1628244594"><span class="hs-identifier hs-var">ty</span></a><span>  </span><span class="hs-comment">-- also zonks</span><span>
</span><a name="line-226"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244596"><a href="#local-1628244596"><span class="hs-identifier">arg_kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-1628244593"><span class="hs-identifier hs-var">arg_kind</span></a><span>
</span><a name="line-227"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628244597"><a href="#local-1628244597"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244598"><a href="#local-1628244598"><span class="hs-identifier">pred</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitForAllTys"><span class="hs-identifier hs-var">splitForAllTys</span></a><span> </span><a href="#local-1628244595"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-228"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#getClassPredTys_maybe"><span class="hs-identifier hs-var">getClassPredTys_maybe</span></a><span> </span><a href="#local-1628244598"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-229"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628244599"><a href="#local-1628244599"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244600"><a href="#local-1628244600"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244597"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244599"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244600"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244596"><span class="hs-identifier hs-var">arg_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Illegal deriving item&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244592"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-identifier">tcHsClsInstType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>    </span><span class="hs-comment">-- InstDeclCtxt or SpecInstCtxt</span><span>
</span><a name="line-233"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-234"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">,</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- Like tcHsSigType, but for a class instance declaration</span><span>
</span><a name="line-236"></a><a name="tcHsClsInstType"><a href="TcHsType.html#tcHsClsInstType"><span class="hs-identifier">tcHsClsInstType</span></a></a><span> </span><a name="local-1628244601"><a href="#local-1628244601"><span class="hs-identifier">user_ctxt</span></a></a><span> </span><a name="local-1628244602"><a href="#local-1628244602"><span class="hs-identifier">hs_inst_ty</span></a></a><span>
</span><a name="line-237"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsSigType"><span class="hs-identifier hs-var">hsSigType</span></a><span> </span><a href="#local-1628244602"><span class="hs-identifier hs-var">hs_inst_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-238"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244603"><a href="#local-1628244603"><span class="hs-identifier">inst_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_hs_sig_type"><span class="hs-identifier hs-var">tc_hs_sig_type</span></a><span> </span><a href="#local-1628244602"><span class="hs-identifier hs-var">hs_inst_ty</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span>
</span><a name="line-239"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244604"><a href="#local-1628244604"><span class="hs-identifier">inst_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#kindGeneralizeType"><span class="hs-identifier hs-var">kindGeneralizeType</span></a><span> </span><a href="#local-1628244603"><span class="hs-identifier hs-var">inst_ty</span></a><span>
</span><a name="line-240"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidInstance"><span class="hs-identifier hs-var">checkValidInstance</span></a><span> </span><a href="#local-1628244601"><span class="hs-identifier hs-var">user_ctxt</span></a><span> </span><a href="#local-1628244602"><span class="hs-identifier hs-var">hs_inst_ty</span></a><span> </span><a href="#local-1628244604"><span class="hs-identifier hs-var">inst_ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span class="hs-comment">-- Used for 'VECTORISE [SCALAR] instance' declarations</span><span>
</span><a name="line-243"></a><span class="hs-identifier">tcHsVectInst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-244"></a><a name="tcHsVectInst"><a href="TcHsType.html#tcHsVectInst"><span class="hs-identifier">tcHsVectInst</span></a></a><span> </span><a name="local-1628244605"><a href="#local-1628244605"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-245"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244606"><a href="#local-1628244606"><span class="hs-identifier">cls_name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244607"><a href="#local-1628244607"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HsTypes.html#hsTyGetAppHead_maybe"><span class="hs-identifier hs-var">hsTyGetAppHead_maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsSigType"><span class="hs-identifier hs-var">hsSigType</span></a><span> </span><a href="#local-1628244605"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-246"></a><span>    </span><span class="hs-comment">-- Ignoring the binders looks pretty dodgy to me</span><span>
</span><a name="line-247"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628244608"><a href="#local-1628244608"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244609"><a href="#local-1628244609"><span class="hs-identifier">cls_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcClass"><span class="hs-identifier hs-var">tcClass</span></a><span> </span><a href="#local-1628244606"><span class="hs-identifier hs-var">cls_name</span></a><span>
</span><a name="line-248"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628244610"><a href="#local-1628244610"><span class="hs-identifier">applied_class</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244611"><a href="#local-1628244611"><span class="hs-identifier">_res_kind</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcInferApps"><span class="hs-identifier hs-var">tcInferApps</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-1628244606"><span class="hs-identifier hs-var">cls_name</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a><span> </span><a href="#local-1628244608"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-1628244609"><span class="hs-identifier hs-var">cls_kind</span></a><span> </span><a href="#local-1628244607"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-250"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-1628244610"><span class="hs-identifier hs-var">applied_class</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-251"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628244612"><a href="#local-1628244612"><span class="hs-identifier">_tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244613"><a href="#local-1628244613"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">_tc</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">classTyCon</span><span> </span><span class="hs-identifier">cls</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-252"></a><span>                               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244608"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244613"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Too many arguments passed to&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244606"><span class="hs-identifier hs-var">cls_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-254"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-255"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Malformed instance type&quot;</span><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span class="hs-comment">----------------------------------------------</span><span>
</span><a name="line-258"></a><span class="hs-comment">-- | Type-check a visible type application</span><span>
</span><a name="line-259"></a><span class="hs-identifier">tcHsTypeApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsWcType"><span class="hs-identifier hs-type">LHsWcType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-260"></a><a name="tcHsTypeApp"><a href="TcHsType.html#tcHsTypeApp"><span class="hs-identifier">tcHsTypeApp</span></a></a><span> </span><a name="local-1628244614"><a href="#local-1628244614"><span class="hs-identifier">wc_ty</span></a></a><span> </span><a name="local-1628244615"><a href="#local-1628244615"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-261"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="HsTypes.html#HsWC"><span class="hs-identifier hs-var">HsWC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_wcs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244616"><a href="#local-1628244616"><span class="hs-identifier">sig_wcs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hswc_ctx</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244617"><a href="#local-1628244617"><span class="hs-identifier">extra</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hswc_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244618"><a href="#local-1628244618"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628244614"><span class="hs-identifier hs-var">wc_ty</span></a><span>
</span><a name="line-262"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isNothing</span><span> </span><span class="hs-identifier">extra</span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- handled in RnTypes.rnExtraConstraintWildCard</span><span>
</span><a name="line-263"></a><span>    </span><a href="TcHsType.html#tcWildCardBinders"><span class="hs-identifier hs-var">tcWildCardBinders</span></a><span> </span><a href="#local-1628244616"><span class="hs-identifier hs-var">sig_wcs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-264"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244619"><a href="#local-1628244619"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a><span> </span><a href="#local-1628244618"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="#local-1628244615"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-265"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244620"><a href="#local-1628244620"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-1628244619"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-266"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a><span> </span><a href="TcType.html#TypeAppCtxt"><span class="hs-identifier hs-var">TypeAppCtxt</span></a><span> </span><a href="#local-1628244620"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-267"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628244620"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-268"></a><span>        </span><span class="hs-comment">-- NB: we don't call emitWildcardHoleConstraints here, because</span><span>
</span><a name="line-269"></a><span>        </span><span class="hs-comment">-- we want any holes in visible type applications to be used</span><span>
</span><a name="line-270"></a><span>        </span><span class="hs-comment">-- without fuss. No errors, warnings, extensions, etc.</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-comment">{-
        These functions are used during knot-tying in
        type and class declarations, when we have to
        separate kind-checking, desugaring, and validity checking


************************************************************************
*                                                                      *
            The main kind checker: no validity checks here
%*                                                                      *
%************************************************************************

        First a couple of simple wrappers for kcHsType
-}</span><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-identifier">tcHsConArgType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#NewOrData"><span class="hs-identifier hs-type">NewOrData</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-288"></a><span class="hs-comment">-- Permit a bang, but discard it</span><span>
</span><a name="line-289"></a><a name="tcHsConArgType"><a href="TcHsType.html#tcHsConArgType"><span class="hs-identifier">tcHsConArgType</span></a></a><span> </span><a href="HsDecls.html#NewType"><span class="hs-identifier hs-var">NewType</span></a><span>  </span><a name="local-1628244621"><a href="#local-1628244621"><span class="hs-identifier">bty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcHsLiftedType"><span class="hs-identifier hs-var">tcHsLiftedType</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#getBangType"><span class="hs-identifier hs-var">getBangType</span></a><span> </span><a href="#local-1628244621"><span class="hs-identifier hs-var">bty</span></a><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>  </span><span class="hs-comment">-- Newtypes can't have bangs, but we don't check that</span><span>
</span><a name="line-291"></a><span>  </span><span class="hs-comment">-- until checkValidDataCon, so do not want to crash here</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-identifier">tcHsConArgType</span><span> </span><a href="HsDecls.html#DataType"><span class="hs-identifier hs-var">DataType</span></a><span> </span><a name="local-1628244622"><a href="#local-1628244622"><span class="hs-identifier">bty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcHsOpenType"><span class="hs-identifier hs-var">tcHsOpenType</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#getBangType"><span class="hs-identifier hs-var">getBangType</span></a><span> </span><a href="#local-1628244622"><span class="hs-identifier hs-var">bty</span></a><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>  </span><span class="hs-comment">-- Can't allow an unlifted type for newtypes, because we're effectively</span><span>
</span><a name="line-295"></a><span>  </span><span class="hs-comment">-- going to remove the constructor while coercing it to a lifted type.</span><span>
</span><a name="line-296"></a><span>  </span><span class="hs-comment">-- And newtypes can't be bang'd</span><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-299"></a><span class="hs-identifier">tcHsOpenType</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcHsLiftedType</span><span class="hs-special">,</span><span>
</span><a name="line-300"></a><span>  </span><span class="hs-identifier">tcHsOpenTypeNC</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcHsLiftedTypeNC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-301"></a><span class="hs-comment">-- Used for type signatures</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- Do not do validity checking</span><span>
</span><a name="line-303"></a><a name="tcHsOpenType"><a href="TcHsType.html#tcHsOpenType"><span class="hs-identifier">tcHsOpenType</span></a></a><span> </span><a name="local-1628244623"><a href="#local-1628244623"><span class="hs-identifier">ty</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a><span> </span><a href="#local-1628244623"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcHsType.html#tcHsOpenTypeNC"><span class="hs-identifier hs-var">tcHsOpenTypeNC</span></a><span> </span><a href="#local-1628244623"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-304"></a><a name="tcHsLiftedType"><a href="TcHsType.html#tcHsLiftedType"><span class="hs-identifier">tcHsLiftedType</span></a></a><span> </span><a name="local-1628244624"><a href="#local-1628244624"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a><span> </span><a href="#local-1628244624"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcHsType.html#tcHsLiftedTypeNC"><span class="hs-identifier hs-var">tcHsLiftedTypeNC</span></a><span> </span><a href="#local-1628244624"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><a name="tcHsOpenTypeNC"><a href="TcHsType.html#tcHsOpenTypeNC"><span class="hs-identifier">tcHsOpenTypeNC</span></a></a><span>   </span><a name="local-1628244625"><a href="#local-1628244625"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244626"><a href="#local-1628244626"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#ekOpen"><span class="hs-identifier hs-var">ekOpen</span></a><span>
</span><a name="line-307"></a><span>                         </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-1628244625"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244626"><span class="hs-identifier hs-var">ek</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-308"></a><a name="tcHsLiftedTypeNC"><a href="TcHsType.html#tcHsLiftedTypeNC"><span class="hs-identifier">tcHsLiftedTypeNC</span></a></a><span> </span><a name="local-1628244627"><a href="#local-1628244627"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-1628244627"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span class="hs-comment">-- Like tcHsType, but takes an expected kind</span><span>
</span><a name="line-311"></a><span class="hs-identifier">tcCheckLHsType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-312"></a><a name="tcCheckLHsType"><a href="TcHsType.html#tcCheckLHsType"><span class="hs-identifier">tcCheckLHsType</span></a></a><span> </span><a name="local-1628244628"><a href="#local-1628244628"><span class="hs-identifier">hs_ty</span></a></a><span> </span><a name="local-1628244629"><a href="#local-1628244629"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-313"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a><span> </span><a href="#local-1628244628"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-314"></a><span>    </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-1628244628"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="#local-1628244629"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span class="hs-identifier">tcLHsType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span class="hs-comment">-- Called from outside: set the context</span><span>
</span><a name="line-318"></a><a name="tcLHsType"><a href="TcHsType.html#tcLHsType"><span class="hs-identifier">tcLHsType</span></a></a><span> </span><a name="local-1628244630"><a href="#local-1628244630"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a><span> </span><a href="#local-1628244630"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-1628244630"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-321"></a><span class="hs-comment">-- | Should we generalise the kind of this type?</span><span>
</span><a name="line-322"></a><span class="hs-comment">-- We *should* generalise if the type is mentions no scoped type variables</span><span>
</span><a name="line-323"></a><span class="hs-comment">-- or if NoMonoLocalBinds is set. Otherwise, nope.</span><span>
</span><a name="line-324"></a><span class="hs-identifier">decideKindGeneralisationPlan</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-325"></a><a name="decideKindGeneralisationPlan"><a href="TcHsType.html#decideKindGeneralisationPlan"><span class="hs-identifier">decideKindGeneralisationPlan</span></a></a><span> </span><a name="local-1628244631"><a href="#local-1628244631"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-326"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244632"><a href="#local-1628244632"><span class="hs-identifier">mono_locals</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#MonoLocalBinds"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">MonoLocalBinds</span></a><span>
</span><a name="line-327"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244633"><a href="#local-1628244633"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#getInLocalScope"><span class="hs-identifier hs-var">getInLocalScope</span></a><span>
</span><a name="line-328"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244634"><a href="#local-1628244634"><span class="hs-identifier">fvs</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeList"><span class="hs-identifier hs-var">tyCoVarsOfTypeList</span></a><span> </span><a href="#local-1628244631"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-329"></a><span>             </span><a name="local-1628244635"><a href="#local-1628244635"><span class="hs-identifier">should_gen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1628244632"><span class="hs-identifier hs-var">mono_locals</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1628244633"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244634"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-330"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;decideKindGeneralisationPlan&quot;</span><span>
</span><a name="line-331"></a><span>           </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;type:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244631"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-332"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ftvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244634"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-333"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;should gen?&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244635"><span class="hs-identifier hs-var">should_gen</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628244635"><span class="hs-identifier hs-var">should_gen</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-identifier">maybeKindGeneralizeType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-337"></a><a name="maybeKindGeneralizeType"><a href="TcHsType.html#maybeKindGeneralizeType"><span class="hs-identifier">maybeKindGeneralizeType</span></a></a><span> </span><a name="local-1628244636"><a href="#local-1628244636"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-338"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244637"><a href="#local-1628244637"><span class="hs-identifier">should_gen</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#decideKindGeneralisationPlan"><span class="hs-identifier hs-var">decideKindGeneralisationPlan</span></a><span> </span><a href="#local-1628244636"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-339"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628244637"><span class="hs-identifier hs-var">should_gen</span></a><span>
</span><a name="line-340"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="TcHsType.html#kindGeneralizeType"><span class="hs-identifier hs-var">kindGeneralizeType</span></a><span> </span><a href="#local-1628244636"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-341"></a><span>         </span><span class="hs-keyword">else</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-1628244636"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
      Type-checking modes
*                                                                      *
************************************************************************

The kind-checker is parameterised by a TcTyMode, which contains some
information about where we're checking a type.

The renamer issues errors about what it can. All errors issued here must
concern things that the renamer can't handle.

-}</span><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span class="hs-keyword">data</span><span> </span><a name="TcTyMode"><a href="TcHsType.html#TcTyMode"><span class="hs-identifier">TcTyMode</span></a></a><span>
</span><a name="line-359"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TcTyMode"><a href="TcHsType.html#TcTyMode"><span class="hs-identifier">TcTyMode</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="TcHsType.html#mode_level"><span class="hs-identifier">mode_level</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span>  </span><span class="hs-comment">-- True &lt;=&gt; type, False &lt;=&gt; kind</span><span>
</span><a name="line-360"></a><span>                                         </span><span class="hs-comment">-- used only for -XNoTypeInType errors</span><span>
</span><a name="line-361"></a><span>             </span><span class="hs-special">}</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-identifier">typeLevelMode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span>
</span><a name="line-364"></a><a name="typeLevelMode"><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier">typeLevelMode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-var">TcTyMode</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mode_level</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-identifier">kindLevelMode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span>
</span><a name="line-367"></a><a name="kindLevelMode"><a href="TcHsType.html#kindLevelMode"><span class="hs-identifier">kindLevelMode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-var">TcTyMode</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mode_level</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-comment">-- switch to kind level</span><span>
</span><a name="line-370"></a><span class="hs-identifier">kindLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span>
</span><a name="line-371"></a><a name="kindLevel"><a href="TcHsType.html#kindLevel"><span class="hs-identifier">kindLevel</span></a></a><span> </span><a name="local-1628244638"><a href="#local-1628244638"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628244638"><span class="hs-identifier hs-var">mode</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mode_level</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-372"></a><span>
</span><a name="line-373"></a><span class="hs-comment">{-
Note [Bidirectional type checking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In expressions, whenever we see a polymorphic identifier, say `id`, we are
free to instantiate it with metavariables, knowing that we can always
re-generalize with type-lambdas when necessary. For example:

  rank2 :: (forall a. a -&gt; a) -&gt; ()
  x = rank2 id

When checking the body of `x`, we can instantiate `id` with a metavariable.
Then, when we're checking the application of `rank2`, we notice that we really
need a polymorphic `id`, and then re-generalize over the unconstrained
metavariable.

In types, however, we're not so lucky, because *we cannot re-generalize*!
There is no lambda. So, we must be careful only to instantiate at the last
possible moment, when we're sure we're never going to want the lost polymorphism
again. This is done in calls to tcInstBinders and tcInstBindersX.

To implement this behavior, we use bidirectional type checking, where we
explicitly think about whether we know the kind of the type we're checking
or not. Note that there is a difference between not knowing a kind and
knowing a metavariable kind: the metavariables are TauTvs, and cannot become
forall-quantified kinds. Previously (before dependent types), there were
no higher-rank kinds, and so we could instantiate early and be sure that
no types would have polymorphic kinds, and so we could always assume that
the kind of a type was a fresh metavariable. Not so anymore, thus the
need for two algorithms.

For HsType forms that can never be kind-polymorphic, we implement only the
&quot;down&quot; direction, where we safely assume a metavariable kind. For HsType forms
that *can* be kind-polymorphic, we implement just the &quot;up&quot; (functions with
&quot;infer&quot; in their name) version, as we gain nothing by also implementing the
&quot;down&quot; version.

Note [Future-proofing the type checker]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As discussed in Note [Bidirectional type checking], each HsType form is
handled in *either* tc_infer_hs_type *or* tc_hs_type. These functions
are mutually recursive, so that either one can work for any type former.
But, we want to make sure that our pattern-matches are complete. So,
we have a bunch of repetitive code just so that we get warnings if we're
missing any patterns.
-}</span><span>
</span><a name="line-418"></a><span>
</span><a name="line-419"></a><span class="hs-comment">-- | Check and desugar a type, returning the core type and its</span><span>
</span><a name="line-420"></a><span class="hs-comment">-- possibly-polymorphic kind. Much like 'tcInferRho' at the expression</span><span>
</span><a name="line-421"></a><span class="hs-comment">-- level.</span><span>
</span><a name="line-422"></a><span class="hs-identifier">tc_infer_lhs_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-423"></a><a name="tc_infer_lhs_type"><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier">tc_infer_lhs_type</span></a></a><span> </span><a name="local-1628244639"><a href="#local-1628244639"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628244640"><a href="#local-1628244640"><span class="hs-identifier">span</span></a></a><span> </span><a name="local-1628244641"><a href="#local-1628244641"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-424"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628244640"><span class="hs-identifier hs-var">span</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-425"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tc_infer_lhs_type:&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244641"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#tc_infer_hs_type"><span class="hs-identifier hs-var">tc_infer_hs_type</span></a><span> </span><a href="#local-1628244639"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244641"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span class="hs-comment">-- | Infer the kind of a type and desugar. This is the &quot;up&quot; type-checker,</span><span>
</span><a name="line-429"></a><span class="hs-comment">-- as described in Note [Bidirectional type checking]</span><span>
</span><a name="line-430"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#HsType"><span class="hs-identifier hs-type">HsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-431"></a><a name="tc_infer_hs_type"><a href="TcHsType.html#tc_infer_hs_type"><span class="hs-identifier">tc_infer_hs_type</span></a></a><span> </span><a name="local-1628244642"><a href="#local-1628244642"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244643"><a href="#local-1628244643"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcTyVar"><span class="hs-identifier hs-var">tcTyVar</span></a><span> </span><a href="#local-1628244642"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244643"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-432"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-1628244644"><a href="#local-1628244644"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsAppTy"><span class="hs-identifier hs-var">HsAppTy</span></a><span> </span><a name="local-1628244645"><a href="#local-1628244645"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1628244646"><a href="#local-1628244646"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-433"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628244647"><a href="#local-1628244647"><span class="hs-identifier">fun_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244648"><a href="#local-1628244648"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#splitHsAppTys"><span class="hs-identifier hs-var">splitHsAppTys</span></a><span> </span><a href="#local-1628244645"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628244646"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-434"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628244649"><a href="#local-1628244649"><span class="hs-identifier">fun_ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244650"><a href="#local-1628244650"><span class="hs-identifier">fun_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-1628244644"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244647"><span class="hs-identifier hs-var">fun_ty</span></a><span>
</span><a name="line-435"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244651"><a href="#local-1628244651"><span class="hs-identifier">fun_kind'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-1628244650"><span class="hs-identifier hs-var">fun_kind</span></a><span>
</span><a name="line-436"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#tcInferApps"><span class="hs-identifier hs-var">tcInferApps</span></a><span> </span><a href="#local-1628244644"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244647"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-1628244649"><span class="hs-identifier hs-var">fun_ty'</span></a><span> </span><a href="#local-1628244651"><span class="hs-identifier hs-var">fun_kind'</span></a><span> </span><a href="#local-1628244648"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-437"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-1628244652"><a href="#local-1628244652"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsParTy"><span class="hs-identifier hs-var">HsParTy</span></a><span> </span><a name="local-1628244653"><a href="#local-1628244653"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-1628244652"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244653"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-438"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-1628244654"><a href="#local-1628244654"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsOpTy"><span class="hs-identifier hs-var">HsOpTy</span></a><span> </span><a name="local-1628244655"><a href="#local-1628244655"><span class="hs-identifier">lhs</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244656"><a href="#local-1628244656"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244657"><a href="#local-1628244657"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-439"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628244656"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#funTyConKey"><span class="hs-identifier hs-var">funTyConKey</span></a><span class="hs-special">)</span><span>
</span><a name="line-440"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628244658"><a href="#local-1628244658"><span class="hs-identifier">op'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244659"><a href="#local-1628244659"><span class="hs-identifier">op_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcTyVar"><span class="hs-identifier hs-var">tcTyVar</span></a><span> </span><a href="#local-1628244654"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244656"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-441"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244660"><a href="#local-1628244660"><span class="hs-identifier">op_kind'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-1628244659"><span class="hs-identifier hs-var">op_kind</span></a><span>
</span><a name="line-442"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#tcInferApps"><span class="hs-identifier hs-var">tcInferApps</span></a><span> </span><a href="#local-1628244654"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244656"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-1628244658"><span class="hs-identifier hs-var">op'</span></a><span> </span><a href="#local-1628244660"><span class="hs-identifier hs-var">op_kind'</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628244655"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244657"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-443"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-1628244661"><a href="#local-1628244661"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsKindSig"><span class="hs-identifier hs-var">HsKindSig</span></a><span> </span><a name="local-1628244662"><a href="#local-1628244662"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1628244663"><a href="#local-1628244663"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-444"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244664"><a href="#local-1628244664"><span class="hs-identifier">sig'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_kind"><span class="hs-identifier hs-var">tc_lhs_kind</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#kindLevel"><span class="hs-identifier hs-var">kindLevel</span></a><span> </span><a href="#local-1628244661"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244663"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-445"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244665"><a href="#local-1628244665"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244661"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244662"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244664"><span class="hs-identifier hs-var">sig'</span></a><span>
</span><a name="line-446"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244665"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244664"><span class="hs-identifier hs-var">sig'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-447"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-1628244666"><a href="#local-1628244666"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsDocTy"><span class="hs-identifier hs-var">HsDocTy</span></a><span> </span><a name="local-1628244667"><a href="#local-1628244667"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-1628244666"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244667"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-448"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">(</span><a href="HsTypes.html#HsCoreTy"><span class="hs-identifier hs-var">HsCoreTy</span></a><span> </span><a name="local-1628244668"><a href="#local-1628244668"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244668"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1628244668"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-449"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-1628244669"><a href="#local-1628244669"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244670"><a href="#local-1628244670"><span class="hs-identifier">other_ty</span></a></a><span>
</span><a name="line-450"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244671"><a href="#local-1628244671"><span class="hs-identifier">kv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-451"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244672"><a href="#local-1628244672"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_hs_type"><span class="hs-identifier hs-var">tc_hs_type</span></a><span> </span><a href="#local-1628244669"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244670"><span class="hs-identifier hs-var">other_ty</span></a><span> </span><a href="#local-1628244671"><span class="hs-identifier hs-var">kv</span></a><span>
</span><a name="line-452"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244672"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244671"><span class="hs-identifier hs-var">kv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-453"></a><span>
</span><a name="line-454"></a><span class="hs-identifier">tc_lhs_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-455"></a><a name="tc_lhs_type"><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier">tc_lhs_type</span></a></a><span> </span><a name="local-1628244673"><a href="#local-1628244673"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628244674"><a href="#local-1628244674"><span class="hs-identifier">span</span></a></a><span> </span><a name="local-1628244675"><a href="#local-1628244675"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244676"><a href="#local-1628244676"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-456"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628244674"><span class="hs-identifier hs-var">span</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-457"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tc_lhs_type:&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244675"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244676"><span class="hs-identifier hs-var">exp_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-458"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#tc_hs_type"><span class="hs-identifier hs-var">tc_hs_type</span></a><span> </span><a href="#local-1628244673"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244675"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244676"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span class="hs-comment">------------------------------------------</span><span>
</span><a name="line-461"></a><span class="hs-identifier">tc_fun_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-462"></a><a name="tc_fun_type"><a href="TcHsType.html#tc_fun_type"><span class="hs-identifier">tc_fun_type</span></a></a><span> </span><a name="local-1628244677"><a href="#local-1628244677"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244678"><a href="#local-1628244678"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1628244679"><a href="#local-1628244679"><span class="hs-identifier">ty2</span></a></a><span> </span><a name="local-1628244680"><a href="#local-1628244680"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-463"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244681"><a href="#local-1628244681"><span class="hs-identifier">arg_rr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span> </span><a href="TysWiredIn.html#runtimeRepTy"><span class="hs-identifier hs-var">runtimeRepTy</span></a><span>
</span><a name="line-464"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244682"><a href="#local-1628244682"><span class="hs-identifier">res_rr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span> </span><a href="TysWiredIn.html#runtimeRepTy"><span class="hs-identifier hs-var">runtimeRepTy</span></a><span>
</span><a name="line-465"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244683"><a href="#local-1628244683"><span class="hs-identifier">ty1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244677"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244678"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">(</span><a href="TysPrim.html#tYPE"><span class="hs-identifier hs-var">tYPE</span></a><span> </span><a href="#local-1628244681"><span class="hs-identifier hs-var">arg_rr</span></a><span class="hs-special">)</span><span>
</span><a name="line-466"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244684"><a href="#local-1628244684"><span class="hs-identifier">ty2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244677"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244679"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-special">(</span><a href="TysPrim.html#tYPE"><span class="hs-identifier hs-var">tYPE</span></a><span> </span><a href="#local-1628244682"><span class="hs-identifier hs-var">res_rr</span></a><span class="hs-special">)</span><span>
</span><a name="line-467"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><a href="#local-1628244683"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-1628244684"><span class="hs-identifier hs-var">ty2'</span></a><span class="hs-special">)</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span> </span><a href="#local-1628244680"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span class="hs-comment">------------------------------------------</span><span>
</span><a name="line-470"></a><span class="hs-comment">-- See also Note [Bidirectional type checking]</span><span>
</span><a name="line-471"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#HsType"><span class="hs-identifier hs-type">HsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-472"></a><a name="tc_hs_type"><a href="TcHsType.html#tc_hs_type"><span class="hs-identifier">tc_hs_type</span></a></a><span> </span><a name="local-1628244685"><a href="#local-1628244685"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsParTy"><span class="hs-identifier hs-var">HsParTy</span></a><span> </span><a name="local-1628244686"><a href="#local-1628244686"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>   </span><a name="local-1628244687"><a href="#local-1628244687"><span class="hs-identifier">exp_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244685"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244686"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244687"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-473"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244688"><a href="#local-1628244688"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsDocTy"><span class="hs-identifier hs-var">HsDocTy</span></a><span> </span><a name="local-1628244689"><a href="#local-1628244689"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1628244690"><a href="#local-1628244690"><span class="hs-identifier">exp_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244688"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244689"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244690"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-474"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244691"><a href="#local-1628244691"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsBangTy"><span class="hs-identifier hs-var">HsBangTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-475"></a><span>    </span><span class="hs-comment">-- While top-level bangs at this point are eliminated (eg !(Maybe Int)),</span><span>
</span><a name="line-476"></a><span>    </span><span class="hs-comment">-- other kinds of bangs are not (eg ((!Maybe) Int)). These kinds of</span><span>
</span><a name="line-477"></a><span>    </span><span class="hs-comment">-- bangs are invalid, so fail. (#7210)</span><span>
</span><a name="line-478"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Unexpected strictness annotation:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244691"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244692"><a href="#local-1628244692"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsRecTy"><span class="hs-identifier hs-var">HsRecTy</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-identifier">_</span><span>
</span><a name="line-480"></a><span>      </span><span class="hs-comment">-- Record types (which only show up temporarily in constructor</span><span>
</span><a name="line-481"></a><span>      </span><span class="hs-comment">-- signatures) should have been removed by now</span><span>
</span><a name="line-482"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Record syntax is illegal here:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244692"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-483"></a><span>
</span><a name="line-484"></a><span class="hs-comment">-- This should never happen; type splices are expanded by the renamer</span><span>
</span><a name="line-485"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244693"><a href="#local-1628244693"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsSpliceTy"><span class="hs-identifier hs-var">HsSpliceTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628244694"><a href="#local-1628244694"><span class="hs-identifier">_exp_kind</span></a></a><span>
</span><a name="line-486"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Unexpected type splice:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244693"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span class="hs-comment">---------- Functions and applications</span><span>
</span><a name="line-489"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244695"><a href="#local-1628244695"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsFunTy"><span class="hs-identifier hs-var">HsFunTy</span></a><span> </span><a name="local-1628244696"><a href="#local-1628244696"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1628244697"><a href="#local-1628244697"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244698"><a href="#local-1628244698"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-490"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_fun_type"><span class="hs-identifier hs-var">tc_fun_type</span></a><span> </span><a href="#local-1628244695"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244696"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1628244697"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-1628244698"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-491"></a><span>
</span><a name="line-492"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244699"><a href="#local-1628244699"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsOpTy"><span class="hs-identifier hs-var">HsOpTy</span></a><span> </span><a name="local-1628244700"><a href="#local-1628244700"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244701"><a href="#local-1628244701"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244702"><a href="#local-1628244702"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244703"><a href="#local-1628244703"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-493"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628244701"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#funTyConKey"><span class="hs-identifier hs-var">funTyConKey</span></a><span>
</span><a name="line-494"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_fun_type"><span class="hs-identifier hs-var">tc_fun_type</span></a><span> </span><a href="#local-1628244699"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244700"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1628244702"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-1628244703"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span class="hs-comment">--------- Foralls</span><span>
</span><a name="line-497"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244704"><a href="#local-1628244704"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsForAllTy"><span class="hs-identifier hs-var">HsForAllTy</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244705"><a href="#local-1628244705"><span class="hs-identifier">hs_tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244706"><a href="#local-1628244706"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628244707"><a href="#local-1628244707"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-498"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-499"></a><span>    </span><a href="TcHsType.html#tcExplicitTKBndrs"><span class="hs-identifier hs-var">tcExplicitTKBndrs</span></a><span> </span><a href="#local-1628244705"><span class="hs-identifier hs-var">hs_tvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628244708"><a href="#local-1628244708"><span class="hs-identifier">tvs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-500"></a><span>    </span><span class="hs-comment">-- Do not kind-generalise here!  See Note [Kind generalisation]</span><span>
</span><a name="line-501"></a><span>    </span><span class="hs-comment">-- Why exp_kind?  See Note [Body kind of HsForAllTy]</span><span>
</span><a name="line-502"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244709"><a href="#local-1628244709"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244704"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244706"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244707"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-503"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244710"><a href="#local-1628244710"><span class="hs-identifier">bound_vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#allBoundVariables"><span class="hs-identifier hs-var">allBoundVariables</span></a><span> </span><a href="#local-1628244709"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-504"></a><span>             </span><a name="local-1628244711"><a href="#local-1628244711"><span class="hs-identifier">bndrs</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkNamedBinder"><span class="hs-identifier hs-var">mkNamedBinder</span></a><span> </span><a href="TyCoRep.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244708"><span class="hs-identifier hs-var">tvs'</span></a><span>
</span><a name="line-505"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span> </span><a href="#local-1628244711"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-1628244709"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244710"><span class="hs-identifier hs-var">bound_vars</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244712"><a href="#local-1628244712"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsQualTy"><span class="hs-identifier hs-var">HsQualTy</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244713"><a href="#local-1628244713"><span class="hs-identifier">ctxt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244714"><a href="#local-1628244714"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628244715"><a href="#local-1628244715"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-508"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628244713"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-509"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244712"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244714"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244715"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-510"></a><span>
</span><a name="line-511"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-512"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244716"><a href="#local-1628244716"><span class="hs-identifier">ctxt'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_hs_context"><span class="hs-identifier hs-var">tc_hs_context</span></a><span> </span><a href="#local-1628244712"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244713"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span>         </span><span class="hs-comment">-- See Note [Body kind of a HsQualTy]</span><span>
</span><a name="line-515"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244719"><a href="#local-1628244719"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Kind.html#isConstraintKind"><span class="hs-identifier hs-var">isConstraintKind</span></a><span> </span><a href="#local-1628244715"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-516"></a><span>                </span><span class="hs-keyword">then</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244712"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244714"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span>
</span><a name="line-517"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244717"><a href="#local-1628244717"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#ekOpen"><span class="hs-identifier hs-var">ekOpen</span></a><span> </span><span class="hs-comment">-- The body kind (result of the</span><span>
</span><a name="line-518"></a><span>                                       </span><span class="hs-comment">-- function) can be * or #, hence ekOpen</span><span>
</span><a name="line-519"></a><span>                        </span><span class="hs-special">;</span><span> </span><a name="local-1628244718"><a href="#local-1628244718"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244712"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244714"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244717"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-520"></a><span>                        </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-1628244718"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span> </span><a href="#local-1628244715"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-521"></a><span>
</span><a name="line-522"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a><span> </span><a href="#local-1628244716"><span class="hs-identifier hs-var">ctxt'</span></a><span> </span><a href="#local-1628244719"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-523"></a><span>
</span><a name="line-524"></a><span class="hs-comment">--------- Lists, arrays, and tuples</span><span>
</span><a name="line-525"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244720"><a href="#local-1628244720"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsListTy"><span class="hs-identifier hs-var">HsListTy</span></a><span> </span><a name="local-1628244721"><a href="#local-1628244721"><span class="hs-identifier">elt_ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244722"><a href="#local-1628244722"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-526"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244723"><a href="#local-1628244723"><span class="hs-identifier">tau_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244720"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244721"><span class="hs-identifier hs-var">elt_ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-527"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="LoadIface.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a><span> </span><a href="TysWiredIn.html#listTyCon"><span class="hs-identifier hs-var">listTyCon</span></a><span>
</span><a name="line-528"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#mkListTy"><span class="hs-identifier hs-var">mkListTy</span></a><span> </span><a href="#local-1628244723"><span class="hs-identifier hs-var">tau_ty</span></a><span class="hs-special">)</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span> </span><a href="#local-1628244722"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244724"><a href="#local-1628244724"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsPArrTy"><span class="hs-identifier hs-var">HsPArrTy</span></a><span> </span><a name="local-1628244725"><a href="#local-1628244725"><span class="hs-identifier">elt_ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244726"><a href="#local-1628244726"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-531"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTypeLevel</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier hs-var">mode_level</span></a><span> </span><span class="hs-identifier">mode</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-532"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244727"><a href="#local-1628244727"><span class="hs-identifier">tau_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244724"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244725"><span class="hs-identifier hs-var">elt_ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-533"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="LoadIface.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a><span> </span><a href="TysWiredIn.html#parrTyCon"><span class="hs-identifier hs-var">parrTyCon</span></a><span>
</span><a name="line-534"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#mkPArrTy"><span class="hs-identifier hs-var">mkPArrTy</span></a><span> </span><a href="#local-1628244727"><span class="hs-identifier hs-var">tau_ty</span></a><span class="hs-special">)</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span> </span><a href="#local-1628244726"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span class="hs-comment">-- See Note [Distinguishing tuple kinds] in HsTypes</span><span>
</span><a name="line-537"></a><span class="hs-comment">-- See Note [Inferring tuple kinds]</span><span>
</span><a name="line-538"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244728"><a href="#local-1628244728"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsTupleTy"><span class="hs-identifier hs-var">HsTupleTy</span></a><span> </span><a href="HsTypes.html#HsBoxedOrConstraintTuple"><span class="hs-identifier hs-var">HsBoxedOrConstraintTuple</span></a><span> </span><a name="local-1628244729"><a href="#local-1628244729"><span class="hs-identifier">hs_tys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244730"><a href="#local-1628244730"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-539"></a><span>     </span><span class="hs-comment">-- (NB: not zonking before looking at exp_k, to avoid left-right bias)</span><span>
</span><a name="line-540"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628244731"><a href="#local-1628244731"><span class="hs-identifier">tup_sort</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var">tupKindSort_maybe</span></a><span> </span><a href="#local-1628244730"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-541"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tc_hs_type tuple&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244729"><span class="hs-identifier hs-var">hs_tys</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a><span>
</span><a name="line-542"></a><span>    </span><a href="TcHsType.html#tc_tuple"><span class="hs-identifier hs-var">tc_tuple</span></a><span> </span><a href="#local-1628244728"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244731"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><a href="#local-1628244729"><span class="hs-identifier hs-var">hs_tys</span></a><span> </span><a href="#local-1628244730"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-543"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-544"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tc_hs_type tuple 2&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244729"><span class="hs-identifier hs-var">hs_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-545"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628244732"><a href="#local-1628244732"><span class="hs-identifier">tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244733"><a href="#local-1628244733"><span class="hs-identifier">kinds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-1628244728"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244729"><span class="hs-identifier hs-var">hs_tys</span></a><span>
</span><a name="line-546"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244734"><a href="#local-1628244734"><span class="hs-identifier">kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-1628244733"><span class="hs-identifier hs-var">kinds</span></a><span>
</span><a name="line-547"></a><span>           </span><span class="hs-comment">-- Infer each arg type separately, because errors can be</span><span>
</span><a name="line-548"></a><span>           </span><span class="hs-comment">-- confusing if we give them a shared kind.  Eg Trac #7410</span><span>
</span><a name="line-549"></a><span>           </span><span class="hs-comment">-- (Either Int, Int), we do not want to get an error saying</span><span>
</span><a name="line-550"></a><span>           </span><span class="hs-comment">-- &quot;the second argument of a tuple should have kind *-&gt;*&quot;</span><span>
</span><a name="line-551"></a><span>
</span><a name="line-552"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628244735"><a href="#local-1628244735"><span class="hs-identifier">arg_kind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244736"><a href="#local-1628244736"><span class="hs-identifier">tup_sort</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-553"></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-1628244737"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><a href="#local-1628244738"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628244737"><a href="#local-1628244737"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628244734"><span class="hs-identifier hs-var">kinds</span></a><span>
</span><a name="line-554"></a><span>                              </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628244738"><a href="#local-1628244738"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="TcHsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var">tupKindSort_maybe</span></a><span> </span><a href="#local-1628244737"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-555"></a><span>                    </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628244739"><a href="#local-1628244739"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-1628244740"><a href="#local-1628244740"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1628244739"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><a href="#local-1628244740"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-556"></a><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span class="hs-special">)</span><span>
</span><a name="line-557"></a><span>         </span><span class="hs-comment">-- In the [] case, it's not clear what the kind is, so guess *</span><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244744"><a href="#local-1628244744"><span class="hs-identifier">tys'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#sequence"><span class="hs-identifier hs-var">sequence</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628244741"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-560"></a><span>                            </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-1628244742"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244743"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="#local-1628244735"><span class="hs-identifier hs-var">arg_kind</span></a><span>
</span><a name="line-561"></a><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628244741"><a href="#local-1628244741"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-1628244742"><a href="#local-1628244742"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><a name="local-1628244743"><a href="#local-1628244743"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a><span> </span><a href="#local-1628244729"><span class="hs-identifier hs-var">hs_tys</span></a><span> </span><a href="#local-1628244732"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628244734"><span class="hs-identifier hs-var">kinds</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#finish_tuple"><span class="hs-identifier hs-var">finish_tuple</span></a><span> </span><a href="#local-1628244736"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><a href="#local-1628244744"><span class="hs-identifier hs-var">tys'</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="#local-1628244735"><span class="hs-identifier hs-var">arg_kind</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244744"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244730"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-564"></a><span>
</span><a name="line-565"></a><span>
</span><a name="line-566"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244745"><a href="#local-1628244745"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsTupleTy"><span class="hs-identifier hs-var">HsTupleTy</span></a><span> </span><a name="local-1628244746"><a href="#local-1628244746"><span class="hs-identifier">hs_tup_sort</span></a></a><span> </span><a name="local-1628244747"><a href="#local-1628244747"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244748"><a href="#local-1628244748"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-567"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_tuple"><span class="hs-identifier hs-var">tc_tuple</span></a><span> </span><a href="#local-1628244745"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244749"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><a href="#local-1628244747"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628244748"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-568"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-569"></a><span>    </span><a name="local-1628244749"><a href="#local-1628244749"><span class="hs-identifier">tup_sort</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628244746"><span class="hs-identifier hs-var">hs_tup_sort</span></a><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- Fourth case dealt with above</span><span>
</span><a name="line-570"></a><span>                  </span><a href="HsTypes.html#HsUnboxedTuple"><span class="hs-identifier hs-var">HsUnboxedTuple</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a><span>
</span><a name="line-571"></a><span>                  </span><a href="HsTypes.html#HsBoxedTuple"><span class="hs-identifier hs-var">HsBoxedTuple</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>
</span><a name="line-572"></a><span>                  </span><a href="HsTypes.html#HsConstraintTuple"><span class="hs-identifier hs-var">HsConstraintTuple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span>
</span><a name="line-573"></a><span>                  </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tc_hs_type HsTupleTy&quot;</span><span>
</span><a name="line-574"></a><span>
</span><a name="line-575"></a><span>
</span><a name="line-576"></a><span class="hs-comment">--------- Promoted lists and tuples</span><span>
</span><a name="line-577"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244750"><a href="#local-1628244750"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsExplicitListTy"><span class="hs-identifier hs-var">HsExplicitListTy</span></a><span> </span><a name="local-1628244751"><a href="#local-1628244751"><span class="hs-identifier">_k</span></a></a><span> </span><a name="local-1628244752"><a href="#local-1628244752"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244753"><a href="#local-1628244753"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-578"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244760"><a href="#local-1628244760"><span class="hs-identifier">tks</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-1628244750"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244752"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-579"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628244761"><a href="#local-1628244761"><span class="hs-identifier">taus'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244762"><a href="#local-1628244762"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#unifyKinds"><span class="hs-identifier hs-var">unifyKinds</span></a><span> </span><a href="#local-1628244760"><span class="hs-identifier hs-var">tks</span></a><span>
</span><a name="line-580"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244763"><a href="#local-1628244763"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244754"><span class="hs-identifier hs-var">mk_cons</span></a><span> </span><a href="#local-1628244762"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628244755"><span class="hs-identifier hs-var">mk_nil</span></a><span> </span><a href="#local-1628244762"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244761"><span class="hs-identifier hs-var">taus'</span></a><span class="hs-special">)</span><span>
</span><a name="line-581"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-1628244763"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#mkListTy"><span class="hs-identifier hs-var">mkListTy</span></a><span> </span><a href="#local-1628244762"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244753"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-582"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-583"></a><span>    </span><a name="local-1628244754"><a href="#local-1628244754"><span class="hs-identifier">mk_cons</span></a></a><span> </span><a name="local-1628244756"><a href="#local-1628244756"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1628244757"><a href="#local-1628244757"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1628244758"><a href="#local-1628244758"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a><span> </span><a href="TysWiredIn.html#consDataCon"><span class="hs-identifier hs-var">consDataCon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-1628244756"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244757"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244758"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-584"></a><span>    </span><a name="local-1628244755"><a href="#local-1628244755"><span class="hs-identifier">mk_nil</span></a></a><span>  </span><a name="local-1628244759"><a href="#local-1628244759"><span class="hs-identifier">k</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a><span> </span><a href="TysWiredIn.html#nilDataCon"><span class="hs-identifier hs-var">nilDataCon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-1628244759"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">]</span><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244764"><a href="#local-1628244764"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsExplicitTupleTy"><span class="hs-identifier hs-var">HsExplicitTupleTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244765"><a href="#local-1628244765"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244766"><a href="#local-1628244766"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-587"></a><span>  </span><span class="hs-comment">-- using newMetaKindVar means that we force instantiations of any polykinded</span><span>
</span><a name="line-588"></a><span>  </span><span class="hs-comment">-- types. At first, I just used tc_infer_lhs_type, but that led to #11255.</span><span>
</span><a name="line-589"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244768"><a href="#local-1628244768"><span class="hs-identifier">ks</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#replicateM"><span class="hs-identifier hs-var">replicateM</span></a><span> </span><a href="#local-1628244767"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-590"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244769"><a href="#local-1628244769"><span class="hs-identifier">taus</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244764"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244765"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628244768"><span class="hs-identifier hs-var">ks</span></a><span>
</span><a name="line-591"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244770"><a href="#local-1628244770"><span class="hs-identifier">kind_con</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a><span>           </span><a href="BasicTypes.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a><span> </span><a href="#local-1628244767"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-592"></a><span>             </span><a name="local-1628244771"><a href="#local-1628244771"><span class="hs-identifier">ty_con</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#promotedTupleDataCon"><span class="hs-identifier hs-var">promotedTupleDataCon</span></a><span> </span><a href="BasicTypes.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a><span> </span><a href="#local-1628244767"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-593"></a><span>             </span><a name="local-1628244772"><a href="#local-1628244772"><span class="hs-identifier">tup_k</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628244770"><span class="hs-identifier hs-var">kind_con</span></a><span> </span><a href="#local-1628244768"><span class="hs-identifier hs-var">ks</span></a><span>
</span><a name="line-594"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628244771"><span class="hs-identifier hs-var">ty_con</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244768"><span class="hs-identifier hs-var">ks</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628244769"><span class="hs-identifier hs-var">taus</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628244772"><span class="hs-identifier hs-var">tup_k</span></a><span> </span><a href="#local-1628244766"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-595"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-596"></a><span>    </span><a name="local-1628244767"><a href="#local-1628244767"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1628244765"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-597"></a><span>
</span><a name="line-598"></a><span class="hs-comment">--------- Constraint types</span><span>
</span><a name="line-599"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244773"><a href="#local-1628244773"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsIParamTy"><span class="hs-identifier hs-var">HsIParamTy</span></a><span> </span><a name="local-1628244774"><a href="#local-1628244774"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1628244775"><a href="#local-1628244775"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244776"><a href="#local-1628244776"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-600"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTypeLevel</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier hs-var">mode_level</span></a><span> </span><span class="hs-identifier">mode</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-601"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244777"><a href="#local-1628244777"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244773"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244775"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-602"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244778"><a href="#local-1628244778"><span class="hs-identifier">n'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsTypes.html#hsIPNameFS"><span class="hs-identifier hs-var">hsIPNameFS</span></a><span> </span><a href="#local-1628244774"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-603"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244779"><a href="#local-1628244779"><span class="hs-identifier">ipClass</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a><span> </span><a href="PrelNames.html#ipClassName"><span class="hs-identifier hs-var">ipClassName</span></a><span>
</span><a name="line-604"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a><span> </span><a href="#local-1628244779"><span class="hs-identifier hs-var">ipClass</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628244778"><span class="hs-identifier hs-var">n'</span></a><span class="hs-special">,</span><a href="#local-1628244777"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-605"></a><span>           </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span> </span><a href="#local-1628244776"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-606"></a><span>
</span><a name="line-607"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244780"><a href="#local-1628244780"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsEqTy"><span class="hs-identifier hs-var">HsEqTy</span></a><span> </span><a name="local-1628244781"><a href="#local-1628244781"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1628244782"><a href="#local-1628244782"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244783"><a href="#local-1628244783"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-608"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628244784"><a href="#local-1628244784"><span class="hs-identifier">ty1'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244785"><a href="#local-1628244785"><span class="hs-identifier">kind1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-1628244780"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244781"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-609"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628244786"><a href="#local-1628244786"><span class="hs-identifier">ty2'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244787"><a href="#local-1628244787"><span class="hs-identifier">kind2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-1628244780"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244782"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-610"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244788"><a href="#local-1628244788"><span class="hs-identifier">ty2''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-1628244786"><span class="hs-identifier hs-var">ty2'</span></a><span> </span><a href="#local-1628244787"><span class="hs-identifier hs-var">kind2</span></a><span> </span><a href="#local-1628244785"><span class="hs-identifier hs-var">kind1</span></a><span>
</span><a name="line-611"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244789"><a href="#local-1628244789"><span class="hs-identifier">eq_tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a><span> </span><a href="PrelNames.html#eqTyConName"><span class="hs-identifier hs-var">eqTyConName</span></a><span>
</span><a name="line-612"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244790"><a href="#local-1628244790"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkNakedTyConApp"><span class="hs-identifier hs-var">mkNakedTyConApp</span></a><span> </span><a href="#local-1628244789"><span class="hs-identifier hs-var">eq_tc</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628244785"><span class="hs-identifier hs-var">kind1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244784"><span class="hs-identifier hs-var">ty1'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244788"><span class="hs-identifier hs-var">ty2''</span></a><span class="hs-special">]</span><span>
</span><a name="line-613"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-1628244790"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span> </span><a href="#local-1628244783"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-614"></a><span>
</span><a name="line-615"></a><span class="hs-comment">--------- Literals</span><span>
</span><a name="line-616"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsTyLit"><span class="hs-identifier hs-var">HsTyLit</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsNumTy"><span class="hs-identifier hs-var">HsNumTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244791"><a href="#local-1628244791"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-1628244792"><a href="#local-1628244792"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-617"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="LoadIface.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a><span> </span><a href="TysWiredIn.html#typeNatKindCon"><span class="hs-identifier hs-var">typeNatKindCon</span></a><span>
</span><a name="line-618"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkNumLitTy"><span class="hs-identifier hs-var">mkNumLitTy</span></a><span> </span><a href="#local-1628244791"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="TysWiredIn.html#typeNatKind"><span class="hs-identifier hs-var">typeNatKind</span></a><span> </span><a href="#local-1628244792"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-619"></a><span>
</span><a name="line-620"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsTyLit"><span class="hs-identifier hs-var">HsTyLit</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsStrTy"><span class="hs-identifier hs-var">HsStrTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244793"><a href="#local-1628244793"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-1628244794"><a href="#local-1628244794"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-621"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="LoadIface.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a><span> </span><a href="TysWiredIn.html#typeSymbolKindCon"><span class="hs-identifier hs-var">typeSymbolKindCon</span></a><span>
</span><a name="line-622"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a><span> </span><a href="#local-1628244793"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="TysWiredIn.html#typeSymbolKind"><span class="hs-identifier hs-var">typeSymbolKind</span></a><span> </span><a href="#local-1628244794"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-623"></a><span>
</span><a name="line-624"></a><span class="hs-comment">--------- Potentially kind-polymorphic types: call the &quot;up&quot; checker</span><span>
</span><a name="line-625"></a><span class="hs-comment">-- See Note [Future-proofing the type checker]</span><span>
</span><a name="line-626"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244795"><a href="#local-1628244795"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244796"><a href="#local-1628244796"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><a name="local-1628244797"><a href="#local-1628244797"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier hs-var">tc_infer_hs_type_ek</span></a><span> </span><a href="#local-1628244795"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244796"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244797"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-627"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244798"><a href="#local-1628244798"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244799"><a href="#local-1628244799"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsAppTy"><span class="hs-identifier hs-var">HsAppTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><a name="local-1628244800"><a href="#local-1628244800"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier hs-var">tc_infer_hs_type_ek</span></a><span> </span><a href="#local-1628244798"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244799"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244800"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-628"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244801"><a href="#local-1628244801"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244802"><a href="#local-1628244802"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsOpTy"><span class="hs-identifier hs-var">HsOpTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><a name="local-1628244803"><a href="#local-1628244803"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier hs-var">tc_infer_hs_type_ek</span></a><span> </span><a href="#local-1628244801"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244802"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244803"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-629"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244804"><a href="#local-1628244804"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244805"><a href="#local-1628244805"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsKindSig"><span class="hs-identifier hs-var">HsKindSig</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628244806"><a href="#local-1628244806"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier hs-var">tc_infer_hs_type_ek</span></a><span> </span><a href="#local-1628244804"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244805"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244806"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-630"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-1628244807"><a href="#local-1628244807"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244808"><a href="#local-1628244808"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsCoreTy"><span class="hs-identifier hs-var">HsCoreTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a name="local-1628244809"><a href="#local-1628244809"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier hs-var">tc_infer_hs_type_ek</span></a><span> </span><a href="#local-1628244807"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244808"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244809"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsWildCardTy"><span class="hs-identifier hs-var">HsWildCardTy</span></a><span> </span><a name="local-1628244810"><a href="#local-1628244810"><span class="hs-identifier">wc</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244811"><a href="#local-1628244811"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-633"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244812"><a href="#local-1628244812"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#wildCardName"><span class="hs-identifier hs-var">wildCardName</span></a><span> </span><a href="#local-1628244810"><span class="hs-identifier hs-var">wc</span></a><span>
</span><a name="line-634"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244813"><a href="#local-1628244813"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupTyVar"><span class="hs-identifier hs-var">tcLookupTyVar</span></a><span> </span><a href="#local-1628244812"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-635"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1628244813"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1628244813"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244811"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-636"></a><span>
</span><a name="line-637"></a><span class="hs-comment">-- disposed of by renamer</span><span>
</span><a name="line-638"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244814"><a href="#local-1628244814"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsAppsTy"><span class="hs-identifier hs-var">HsAppsTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-639"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tc_hs_tyep HsAppsTy&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244814"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-640"></a><span>
</span><a name="line-641"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-642"></a><span class="hs-comment">-- | Call 'tc_infer_hs_type' and check its result against an expected kind.</span><span>
</span><a name="line-643"></a><span class="hs-identifier">tc_infer_hs_type_ek</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#HsType"><span class="hs-identifier hs-type">HsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-644"></a><a name="tc_infer_hs_type_ek"><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier">tc_infer_hs_type_ek</span></a></a><span> </span><a name="local-1628244815"><a href="#local-1628244815"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244816"><a href="#local-1628244816"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1628244817"><a href="#local-1628244817"><span class="hs-identifier">ek</span></a></a><span>
</span><a name="line-645"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628244818"><a href="#local-1628244818"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244819"><a href="#local-1628244819"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_infer_hs_type"><span class="hs-identifier hs-var">tc_infer_hs_type</span></a><span> </span><a href="#local-1628244815"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244816"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-646"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-1628244818"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-1628244819"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1628244817"><span class="hs-identifier hs-var">ek</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-647"></a><span>
</span><a name="line-648"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-649"></a><span class="hs-identifier">tupKindSort_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#TupleSort"><span class="hs-identifier hs-type">TupleSort</span></a><span>
</span><a name="line-650"></a><a name="tupKindSort_maybe"><a href="TcHsType.html#tupKindSort_maybe"><span class="hs-identifier">tupKindSort_maybe</span></a></a><span> </span><a name="local-1628244820"><a href="#local-1628244820"><span class="hs-identifier">k</span></a></a><span>
</span><a name="line-651"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628244821"><a href="#local-1628244821"><span class="hs-identifier">k'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitCastTy_maybe"><span class="hs-identifier hs-var">splitCastTy_maybe</span></a><span> </span><a href="#local-1628244820"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var">tupKindSort_maybe</span></a><span> </span><a href="#local-1628244821"><span class="hs-identifier hs-var">k'</span></a><span>
</span><a name="line-652"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628244822"><a href="#local-1628244822"><span class="hs-identifier">k'</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-1628244820"><span class="hs-identifier hs-var">k</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var">tupKindSort_maybe</span></a><span> </span><a href="#local-1628244822"><span class="hs-identifier hs-var">k'</span></a><span>
</span><a name="line-653"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Kind.html#isConstraintKind"><span class="hs-identifier hs-var">isConstraintKind</span></a><span> </span><a href="#local-1628244820"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span>
</span><a name="line-654"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isLiftedTypeKind"><span class="hs-identifier hs-var">isLiftedTypeKind</span></a><span> </span><a href="#local-1628244820"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>
</span><a name="line-655"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-656"></a><span>
</span><a name="line-657"></a><span class="hs-identifier">tc_tuple</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#TupleSort"><span class="hs-identifier hs-type">TupleSort</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-658"></a><a name="tc_tuple"><a href="TcHsType.html#tc_tuple"><span class="hs-identifier">tc_tuple</span></a></a><span> </span><a name="local-1628244823"><a href="#local-1628244823"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244824"><a href="#local-1628244824"><span class="hs-identifier">tup_sort</span></a></a><span> </span><a name="local-1628244825"><a href="#local-1628244825"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-1628244826"><a href="#local-1628244826"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-659"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244829"><a href="#local-1628244829"><span class="hs-identifier">arg_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628244824"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-660"></a><span>           </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#nOfThem"><span class="hs-identifier hs-var">nOfThem</span></a><span> </span><a href="#local-1628244827"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-661"></a><span>           </span><a href="BasicTypes.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244828"><a href="#local-1628244828"><span class="hs-identifier">rrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newFlexiTyVarTys"><span class="hs-identifier hs-var">newFlexiTyVarTys</span></a><span> </span><a href="#local-1628244827"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="TysWiredIn.html#runtimeRepTy"><span class="hs-identifier hs-var">runtimeRepTy</span></a><span>
</span><a name="line-662"></a><span>                                 </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TysPrim.html#tYPE"><span class="hs-identifier hs-var">tYPE</span></a><span> </span><a href="#local-1628244828"><span class="hs-identifier hs-var">rrs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-663"></a><span>           </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#nOfThem"><span class="hs-identifier hs-var">nOfThem</span></a><span> </span><a href="#local-1628244827"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-664"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244830"><a href="#local-1628244830"><span class="hs-identifier">tau_tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244823"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244825"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628244829"><span class="hs-identifier hs-var">arg_kinds</span></a><span>
</span><a name="line-665"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#finish_tuple"><span class="hs-identifier hs-var">finish_tuple</span></a><span> </span><a href="#local-1628244824"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><a href="#local-1628244830"><span class="hs-identifier hs-var">tau_tys</span></a><span> </span><a href="#local-1628244829"><span class="hs-identifier hs-var">arg_kinds</span></a><span> </span><a href="#local-1628244826"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-666"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-667"></a><span>    </span><a name="local-1628244827"><a href="#local-1628244827"><span class="hs-identifier">arity</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1628244825"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-668"></a><span>
</span><a name="line-669"></a><span class="hs-identifier">finish_tuple</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#TupleSort"><span class="hs-identifier hs-type">TupleSort</span></a><span>
</span><a name="line-670"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ argument types</span><span>
</span><a name="line-671"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ of these kinds</span><span>
</span><a name="line-672"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>      </span><span class="hs-comment">-- ^ expected kind of the whole tuple</span><span>
</span><a name="line-673"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-674"></a><a name="finish_tuple"><a href="TcHsType.html#finish_tuple"><span class="hs-identifier">finish_tuple</span></a></a><span> </span><a name="local-1628244831"><a href="#local-1628244831"><span class="hs-identifier">tup_sort</span></a></a><span> </span><a name="local-1628244832"><a href="#local-1628244832"><span class="hs-identifier">tau_tys</span></a></a><span> </span><a name="local-1628244833"><a href="#local-1628244833"><span class="hs-identifier">tau_kinds</span></a></a><span> </span><a name="local-1628244834"><a href="#local-1628244834"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-675"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;finish_tuple&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244836"><span class="hs-identifier hs-var">res_kind</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244833"><span class="hs-identifier hs-var">tau_kinds</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244834"><span class="hs-identifier hs-var">exp_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-676"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244837"><a href="#local-1628244837"><span class="hs-identifier">arg_tys</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628244831"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-677"></a><span>                   </span><span class="hs-comment">-- See also Note [Unboxed tuple RuntimeRep vars] in TyCon</span><span>
</span><a name="line-678"></a><span>                 </span><a href="BasicTypes.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#getRuntimeRepFromKind"><span class="hs-identifier hs-var">getRuntimeRepFromKind</span></a><span> </span><span class="hs-string">&quot;finish_tuple&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628244833"><span class="hs-identifier hs-var">tau_kinds</span></a><span>
</span><a name="line-679"></a><span>                                    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628244832"><span class="hs-identifier hs-var">tau_tys</span></a><span>
</span><a name="line-680"></a><span>                 </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628244832"><span class="hs-identifier hs-var">tau_tys</span></a><span>
</span><a name="line-681"></a><span>                 </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628244832"><span class="hs-identifier hs-var">tau_tys</span></a><span>
</span><a name="line-682"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244839"><a href="#local-1628244839"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628244831"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-683"></a><span>           </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span>
</span><a name="line-684"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628244835"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="Constants.html#mAX_CTUPLE_SIZE"><span class="hs-identifier hs-var">mAX_CTUPLE_SIZE</span></a><span>
</span><a name="line-685"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#bigConstraintTuple"><span class="hs-identifier hs-var">bigConstraintTuple</span></a><span> </span><a href="#local-1628244835"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-686"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEnv.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#cTupleTyConName"><span class="hs-identifier hs-var">cTupleTyConName</span></a><span> </span><a href="#local-1628244835"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-687"></a><span>           </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244838"><a href="#local-1628244838"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a><span> </span><a href="BasicTypes.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a><span> </span><a href="#local-1628244835"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-688"></a><span>                               </span><span class="hs-special">;</span><span> </span><a href="LoadIface.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a><span> </span><a href="#local-1628244838"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-689"></a><span>                               </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628244838"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-690"></a><span>           </span><a href="BasicTypes.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a><span> </span><a href="BasicTypes.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a><span> </span><a href="#local-1628244835"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-691"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628244839"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-1628244837"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244836"><span class="hs-identifier hs-var">res_kind</span></a><span> </span><a href="#local-1628244834"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-692"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-693"></a><span>    </span><a name="local-1628244835"><a href="#local-1628244835"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1628244832"><span class="hs-identifier hs-var">tau_tys</span></a><span>
</span><a name="line-694"></a><span>    </span><a name="local-1628244836"><a href="#local-1628244836"><span class="hs-identifier">res_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628244831"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-695"></a><span>                 </span><a href="BasicTypes.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TysPrim.html#tYPE"><span class="hs-identifier hs-var">tYPE</span></a><span> </span><a href="TysWiredIn.html#unboxedTupleRepDataConTy"><span class="hs-identifier hs-var">unboxedTupleRepDataConTy</span></a><span>
</span><a name="line-696"></a><span>                 </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-697"></a><span>                 </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span>
</span><a name="line-698"></a><span>
</span><a name="line-699"></a><span class="hs-identifier">bigConstraintTuple</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span>
</span><a name="line-700"></a><a name="bigConstraintTuple"><a href="TcHsType.html#bigConstraintTuple"><span class="hs-identifier">bigConstraintTuple</span></a></a><span> </span><a name="local-1628244840"><a href="#local-1628244840"><span class="hs-identifier">arity</span></a></a><span>
</span><a name="line-701"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Constraint tuple arity too large:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-1628244840"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-702"></a><span>          </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;max arity =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="Constants.html#mAX_CTUPLE_SIZE"><span class="hs-identifier hs-var">mAX_CTUPLE_SIZE</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-703"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Instead, use a nested tuple&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-704"></a><span>
</span><a name="line-705"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-706"></a><span class="hs-comment">-- | Apply a type of a given kind to a list of arguments. This instantiates</span><span>
</span><a name="line-707"></a><span class="hs-comment">-- invisible parameters as necessary. However, it does *not* necessarily</span><span>
</span><a name="line-708"></a><span class="hs-comment">-- apply all the arguments, if the kind runs out of binders.</span><span>
</span><a name="line-709"></a><span class="hs-comment">-- This takes an optional @VarEnv Kind@ which maps kind variables to kinds.</span><span>
</span><a name="line-710"></a><span class="hs-comment">-- These kinds should be used to instantiate invisible kind variables;</span><span>
</span><a name="line-711"></a><span class="hs-comment">-- they come from an enclosing class for an associated type/data family.</span><span>
</span><a name="line-712"></a><span class="hs-comment">-- This version will instantiate all invisible arguments left over after</span><span>
</span><a name="line-713"></a><span class="hs-comment">-- the visible ones.</span><span>
</span><a name="line-714"></a><span class="hs-identifier">tcInferArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-1628244566"><span class="hs-identifier hs-type">fun</span></a><span>
</span><a name="line-715"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1628244566"><span class="hs-identifier hs-type">fun</span></a><span>                      </span><span class="hs-comment">-- ^ the function</span><span>
</span><a name="line-716"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- ^ function kind's binders</span><span>
</span><a name="line-717"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- ^ possibly, kind info (see above)</span><span>
</span><a name="line-718"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- ^ args</span><span>
</span><a name="line-719"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-720"></a><span>               </span><span class="hs-comment">-- ^ (instantiating subst, un-insted leftover binders,</span><span>
</span><a name="line-721"></a><span>               </span><span class="hs-comment">--   typechecked args, untypechecked args, n)</span><span>
</span><a name="line-722"></a><a name="tcInferArgs"><a href="TcHsType.html#tcInferArgs"><span class="hs-identifier">tcInferArgs</span></a></a><span> </span><a name="local-1628244841"><a href="#local-1628244841"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-1628244842"><a href="#local-1628244842"><span class="hs-identifier">binders</span></a></a><span> </span><a name="local-1628244843"><a href="#local-1628244843"><span class="hs-identifier">mb_kind_info</span></a></a><span> </span><a name="local-1628244844"><a href="#local-1628244844"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-723"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628244845"><a href="#local-1628244845"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244846"><a href="#local-1628244846"><span class="hs-identifier">leftover_binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244847"><a href="#local-1628244847"><span class="hs-identifier">args'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244848"><a href="#local-1628244848"><span class="hs-identifier">leftovers</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244849"><a href="#local-1628244849"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_infer_args"><span class="hs-identifier hs-var">tc_infer_args</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-1628244841"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-1628244842"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-1628244843"><span class="hs-identifier hs-var">mb_kind_info</span></a><span> </span><a href="#local-1628244844"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-725"></a><span>        </span><span class="hs-comment">-- now, we need to instantiate any remaining invisible arguments</span><span>
</span><a name="line-726"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628244850"><a href="#local-1628244850"><span class="hs-identifier">invis_bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244851"><a href="#local-1628244851"><span class="hs-identifier">other_binders</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#span"><span class="hs-identifier hs-var">span</span></a><span> </span><a href="TyCoRep.html#isInvisibleBinder"><span class="hs-identifier hs-var">isInvisibleBinder</span></a><span> </span><a href="#local-1628244846"><span class="hs-identifier hs-var">leftover_binders</span></a><span>
</span><a name="line-727"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628244852"><a href="#local-1628244852"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244853"><a href="#local-1628244853"><span class="hs-identifier">invis_args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-728"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#tcInstBindersX"><span class="hs-identifier hs-var">tcInstBindersX</span></a><span> </span><a href="#local-1628244845"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628244843"><span class="hs-identifier hs-var">mb_kind_info</span></a><span> </span><a href="#local-1628244850"><span class="hs-identifier hs-var">invis_bndrs</span></a><span>
</span><a name="line-729"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628244852"><span class="hs-identifier hs-var">subst'</span></a><span>
</span><a name="line-730"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-1628244851"><span class="hs-identifier hs-var">other_binders</span></a><span>
</span><a name="line-731"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-1628244847"><span class="hs-identifier hs-var">args'</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#chkAppend"><span class="hs-identifier hs-var">chkAppend</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628244853"><span class="hs-identifier hs-var">invis_args</span></a><span>
</span><a name="line-732"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-1628244848"><span class="hs-identifier hs-var">leftovers</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244849"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-733"></a><span>
</span><a name="line-734"></a><span class="hs-comment">-- | See comments for 'tcInferArgs'. But this version does not instantiate</span><span>
</span><a name="line-735"></a><span class="hs-comment">-- any remaining invisible arguments.</span><span>
</span><a name="line-736"></a><span class="hs-identifier">tc_infer_args</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-1628244565"><span class="hs-identifier hs-type">fun</span></a><span>
</span><a name="line-737"></a><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span>
</span><a name="line-738"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628244565"><span class="hs-identifier hs-type">fun</span></a><span>                      </span><span class="hs-comment">-- ^ the function</span><span>
</span><a name="line-739"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- ^ function kind's binders (zonked)</span><span>
</span><a name="line-740"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- ^ possibly, kind info (see above)</span><span>
</span><a name="line-741"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- ^ args</span><span>
</span><a name="line-742"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>                      </span><span class="hs-comment">-- ^ number to start arg counter at</span><span>
</span><a name="line-743"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-744"></a><a name="tc_infer_args"><a href="TcHsType.html#tc_infer_args"><span class="hs-identifier">tc_infer_args</span></a></a><span> </span><a name="local-1628244854"><a href="#local-1628244854"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244855"><a href="#local-1628244855"><span class="hs-identifier">orig_ty</span></a></a><span> </span><a name="local-1628244856"><a href="#local-1628244856"><span class="hs-identifier">binders</span></a></a><span> </span><a name="local-1628244857"><a href="#local-1628244857"><span class="hs-identifier">mb_kind_info</span></a></a><span> </span><a name="local-1628244858"><a href="#local-1628244858"><span class="hs-identifier">orig_args</span></a></a><span> </span><a name="local-1628244859"><a href="#local-1628244859"><span class="hs-identifier">n0</span></a></a><span>
</span><a name="line-745"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcInferApps&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244856"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244858"><span class="hs-identifier hs-var">orig_args</span></a><span class="hs-special">)</span><span>
</span><a name="line-746"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="#local-1628244860"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span> </span><a href="#local-1628244856"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-1628244858"><span class="hs-identifier hs-var">orig_args</span></a><span> </span><a href="#local-1628244859"><span class="hs-identifier hs-var">n0</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-747"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-748"></a><span>    </span><a name="local-1628244860"><a href="#local-1628244860"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1628244861"><a href="#local-1628244861"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1628244862"><a href="#local-1628244862"><span class="hs-identifier">binders</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><a name="local-1628244863"><a href="#local-1628244863"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1628244864"><a href="#local-1628244864"><span class="hs-identifier">acc</span></a></a><span>
</span><a name="line-749"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628244861"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244862"><span class="hs-identifier hs-var">binders</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1628244864"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628244863"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-750"></a><span>    </span><span class="hs-comment">-- when we call this when checking type family patterns, we really</span><span>
</span><a name="line-751"></a><span>    </span><span class="hs-comment">-- do want to instantiate all invisible arguments. During other</span><span>
</span><a name="line-752"></a><span>    </span><span class="hs-comment">-- typechecking, we don't.</span><span>
</span><a name="line-753"></a><span>
</span><a name="line-754"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-1628244865"><a href="#local-1628244865"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1628244866"><a href="#local-1628244866"><span class="hs-identifier">binders</span></a></a><span> </span><a name="local-1628244867"><a href="#local-1628244867"><span class="hs-identifier">all_args</span></a></a><span> </span><a name="local-1628244868"><a href="#local-1628244868"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1628244869"><a href="#local-1628244869"><span class="hs-identifier">acc</span></a></a><span>
</span><a name="line-755"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628244870"><a href="#local-1628244870"><span class="hs-identifier">inv_binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244871"><a href="#local-1628244871"><span class="hs-identifier">other_binders</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#span"><span class="hs-identifier hs-var">span</span></a><span> </span><a href="TyCoRep.html#isInvisibleBinder"><span class="hs-identifier hs-var">isInvisibleBinder</span></a><span> </span><a href="#local-1628244866"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-756"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628244870"><span class="hs-identifier hs-var">inv_binders</span></a><span class="hs-special">)</span><span>
</span><a name="line-757"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628244872"><a href="#local-1628244872"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244873"><a href="#local-1628244873"><span class="hs-identifier">args'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#tcInstBindersX"><span class="hs-identifier hs-var">tcInstBindersX</span></a><span> </span><a href="#local-1628244865"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628244857"><span class="hs-identifier hs-var">mb_kind_info</span></a><span> </span><a href="#local-1628244870"><span class="hs-identifier hs-var">inv_binders</span></a><span>
</span><a name="line-758"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-1628244860"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628244872"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-1628244871"><span class="hs-identifier hs-var">other_binders</span></a><span> </span><a href="#local-1628244867"><span class="hs-identifier hs-var">all_args</span></a><span> </span><a href="#local-1628244868"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1628244873"><span class="hs-identifier hs-var">args'</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628244869"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-759"></a><span>
</span><a name="line-760"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-1628244874"><a href="#local-1628244874"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628244875"><a href="#local-1628244875"><span class="hs-identifier">binder</span></a></a><span class="hs-glyph">:</span><a name="local-1628244876"><a href="#local-1628244876"><span class="hs-identifier">binders</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1628244877"><a href="#local-1628244877"><span class="hs-identifier">arg</span></a></a><span class="hs-glyph">:</span><a name="local-1628244878"><a href="#local-1628244878"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244879"><a href="#local-1628244879"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1628244880"><a href="#local-1628244880"><span class="hs-identifier">acc</span></a></a><span>
</span><a name="line-761"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isVisibleBinder</span><span> </span><a href="TyCoRep.html#isVisibleBinder"><span class="hs-identifier hs-var">binder</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-762"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244881"><a href="#local-1628244881"><span class="hs-identifier">mode'</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isNamedBinder"><span class="hs-identifier hs-var">isNamedBinder</span></a><span> </span><a href="#local-1628244875"><span class="hs-identifier hs-var">binder</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#kindLevel"><span class="hs-identifier hs-var">kindLevel</span></a><span> </span><a href="#local-1628244854"><span class="hs-identifier hs-var">mode</span></a><span>
</span><a name="line-763"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628244854"><span class="hs-identifier hs-var">mode</span></a><span>
</span><a name="line-764"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-1628244882"><a href="#local-1628244882"><span class="hs-identifier">arg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#funAppCtxt"><span class="hs-identifier hs-var">funAppCtxt</span></a><span> </span><a href="#local-1628244855"><span class="hs-identifier hs-var">orig_ty</span></a><span> </span><a href="#local-1628244877"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-1628244879"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-765"></a><span>                     </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244881"><span class="hs-identifier hs-var">mode'</span></a><span> </span><a href="#local-1628244877"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span> </span><a href="#local-1628244874"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#binderType"><span class="hs-identifier hs-var">binderType</span></a><span> </span><a href="#local-1628244875"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-766"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244883"><a href="#local-1628244883"><span class="hs-identifier">subst'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#binderVar_maybe"><span class="hs-identifier hs-var">binderVar_maybe</span></a><span> </span><a href="#local-1628244875"><span class="hs-identifier hs-var">binder</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-767"></a><span>                   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628244884"><a href="#local-1628244884"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a><span> </span><a href="#local-1628244874"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628244884"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1628244882"><span class="hs-identifier hs-var">arg'</span></a><span>
</span><a name="line-768"></a><span>                   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628244874"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-769"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-1628244860"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628244883"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-1628244876"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-1628244878"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244879"><span class="hs-identifier hs-var">n</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628244882"><span class="hs-identifier hs-var">arg'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628244880"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-770"></a><span>
</span><a name="line-771"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-1628244885"><a href="#local-1628244885"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-1628244886"><a href="#local-1628244886"><span class="hs-identifier">all_args</span></a></a><span> </span><a name="local-1628244887"><a href="#local-1628244887"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1628244888"><a href="#local-1628244888"><span class="hs-identifier">acc</span></a></a><span>
</span><a name="line-772"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244885"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1628244888"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244886"><span class="hs-identifier hs-var">all_args</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244887"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-773"></a><span>
</span><a name="line-774"></a><span class="hs-comment">-- | Applies a type to a list of arguments. Always consumes all the</span><span>
</span><a name="line-775"></a><span class="hs-comment">-- arguments.</span><span>
</span><a name="line-776"></a><span class="hs-identifier">tcInferApps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-1628244564"><span class="hs-identifier hs-type">fun</span></a><span>
</span><a name="line-777"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span>
</span><a name="line-778"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628244564"><span class="hs-identifier hs-type">fun</span></a><span>                  </span><span class="hs-comment">-- ^ Function (for printing only)</span><span>
</span><a name="line-779"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>               </span><span class="hs-comment">-- ^ Function (could be knot-tied)</span><span>
</span><a name="line-780"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>               </span><span class="hs-comment">-- ^ Function kind (zonked)</span><span>
</span><a name="line-781"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- ^ Args</span><span>
</span><a name="line-782"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ (f args, result kind)</span><span>
</span><a name="line-783"></a><a name="tcInferApps"><a href="TcHsType.html#tcInferApps"><span class="hs-identifier">tcInferApps</span></a></a><span> </span><a name="local-1628244889"><a href="#local-1628244889"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244890"><a href="#local-1628244890"><span class="hs-identifier">orig_ty</span></a></a><span> </span><a name="local-1628244891"><a href="#local-1628244891"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1628244892"><a href="#local-1628244892"><span class="hs-identifier">ki</span></a></a><span> </span><a name="local-1628244893"><a href="#local-1628244893"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628244894"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628244891"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244892"><span class="hs-identifier hs-var">ki</span></a><span> </span><a href="#local-1628244893"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-784"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-785"></a><span>    </span><a name="local-1628244894"><a href="#local-1628244894"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1628244895"><a href="#local-1628244895"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-1628244896"><a href="#local-1628244896"><span class="hs-identifier">fun_kind</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244895"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244896"><span class="hs-identifier hs-var">fun_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-786"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-1628244897"><a href="#local-1628244897"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-1628244898"><a href="#local-1628244898"><span class="hs-identifier">fun_kind</span></a></a><span> </span><a name="local-1628244899"><a href="#local-1628244899"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-1628244900"><a href="#local-1628244900"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-787"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628244901"><a href="#local-1628244901"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244902"><a href="#local-1628244902"><span class="hs-identifier">res_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a><span> </span><a href="#local-1628244898"><span class="hs-identifier hs-var">fun_kind</span></a><span>
</span><a name="line-788"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628244901"><span class="hs-identifier hs-var">binders</span></a><span class="hs-special">)</span><span>
</span><a name="line-789"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628244903"><a href="#local-1628244903"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244904"><a href="#local-1628244904"><span class="hs-identifier">leftover_binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244905"><a href="#local-1628244905"><span class="hs-identifier">args'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244906"><a href="#local-1628244906"><span class="hs-identifier">leftover_args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244907"><a href="#local-1628244907"><span class="hs-identifier">n'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-790"></a><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_infer_args"><span class="hs-identifier hs-var">tc_infer_args</span></a><span> </span><a href="#local-1628244889"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244890"><span class="hs-identifier hs-var">orig_ty</span></a><span> </span><a href="#local-1628244901"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-1628244899"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-1628244900"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-791"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244908"><a href="#local-1628244908"><span class="hs-identifier">fun_kind'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span> </span><a href="#local-1628244903"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-792"></a><span>                             </span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span> </span><a href="#local-1628244904"><span class="hs-identifier hs-var">leftover_binders</span></a><span> </span><a href="#local-1628244902"><span class="hs-identifier hs-var">res_kind</span></a><span>
</span><a name="line-793"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-1628244894"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkNakedAppTys"><span class="hs-identifier hs-var">mkNakedAppTys</span></a><span> </span><a href="#local-1628244897"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-1628244905"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244908"><span class="hs-identifier hs-var">fun_kind'</span></a><span> </span><a href="#local-1628244906"><span class="hs-identifier hs-var">leftover_args</span></a><span> </span><a href="#local-1628244907"><span class="hs-identifier hs-var">n'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-794"></a><span>
</span><a name="line-795"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-1628244909"><a href="#local-1628244909"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-1628244910"><a href="#local-1628244910"><span class="hs-identifier">fun_kind</span></a></a><span> </span><a name="local-1628244911"><a href="#local-1628244911"><span class="hs-identifier">all_args</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1628244912"><a href="#local-1628244912"><span class="hs-identifier">arg</span></a></a><span class="hs-glyph">:</span><a name="local-1628244913"><a href="#local-1628244913"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244914"><a href="#local-1628244914"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-796"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628244915"><a href="#local-1628244915"><span class="hs-identifier">co</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244916"><a href="#local-1628244916"><span class="hs-identifier">arg_k</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244917"><a href="#local-1628244917"><span class="hs-identifier">res_k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcUnify.html#matchExpectedFunKind"><span class="hs-identifier hs-var">matchExpectedFunKind</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1628244911"><span class="hs-identifier hs-var">all_args</span></a><span class="hs-special">)</span><span>
</span><a name="line-797"></a><span>                                                        </span><a href="#local-1628244909"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-1628244910"><span class="hs-identifier hs-var">fun_kind</span></a><span>
</span><a name="line-798"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-1628244918"><a href="#local-1628244918"><span class="hs-identifier">arg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#funAppCtxt"><span class="hs-identifier hs-var">funAppCtxt</span></a><span> </span><a href="#local-1628244890"><span class="hs-identifier hs-var">orig_ty</span></a><span> </span><a href="#local-1628244912"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-1628244914"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-799"></a><span>                     </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244889"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244912"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-1628244916"><span class="hs-identifier hs-var">arg_k</span></a><span>
</span><a name="line-800"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-1628244894"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkNakedAppTy"><span class="hs-identifier hs-var">mkNakedAppTy</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244909"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#mkNakedCastTy"><span class="hs-identifier hs-var">mkNakedCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628244915"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244918"><span class="hs-identifier hs-var">arg'</span></a><span class="hs-special">)</span><span>
</span><a name="line-801"></a><span>                </span><a href="#local-1628244917"><span class="hs-identifier hs-var">res_k</span></a><span> </span><a href="#local-1628244913"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244914"><span class="hs-identifier hs-var">n</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-802"></a><span>
</span><a name="line-803"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-804"></a><span class="hs-identifier">checkExpectedKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>               </span><span class="hs-comment">-- the type whose kind we're checking</span><span>
</span><a name="line-805"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>               </span><span class="hs-comment">-- the known kind of that type, k</span><span>
</span><a name="line-806"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>               </span><span class="hs-comment">-- the expected kind, exp_kind</span><span>
</span><a name="line-807"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>    </span><span class="hs-comment">-- a possibly-inst'ed, casted type :: exp_kind</span><span>
</span><a name="line-808"></a><span class="hs-comment">-- Instantiate a kind (if necessary) and then call unifyType</span><span>
</span><a name="line-809"></a><span class="hs-comment">--      (checkExpectedKind ty act_kind exp_kind)</span><span>
</span><a name="line-810"></a><span class="hs-comment">-- checks that the actual kind act_kind is compatible</span><span>
</span><a name="line-811"></a><span class="hs-comment">--      with the expected kind exp_kind</span><span>
</span><a name="line-812"></a><a name="checkExpectedKind"><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier">checkExpectedKind</span></a></a><span> </span><a name="local-1628244919"><a href="#local-1628244919"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1628244920"><a href="#local-1628244920"><span class="hs-identifier">act_kind</span></a></a><span> </span><a name="local-1628244921"><a href="#local-1628244921"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-813"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628244927"><a href="#local-1628244927"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244928"><a href="#local-1628244928"><span class="hs-identifier">act_kind'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628244922"><span class="hs-identifier hs-var">instantiate</span></a><span> </span><a href="#local-1628244919"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244920"><span class="hs-identifier hs-var">act_kind</span></a><span> </span><a href="#local-1628244921"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-814"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244929"><a href="#local-1628244929"><span class="hs-identifier">origin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TypeEqOrigin"><span class="hs-identifier hs-var">TypeEqOrigin</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">uo_actual</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628244928"><span class="hs-identifier hs-var">act_kind'</span></a><span>
</span><a name="line-815"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">uo_expected</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span> </span><a href="#local-1628244921"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-816"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">uo_thing</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcMType.html#mkTypeErrorThing"><span class="hs-identifier hs-var">mkTypeErrorThing</span></a><span> </span><a href="#local-1628244927"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-817"></a><span>                                  </span><span class="hs-special">}</span><span>
</span><a name="line-818"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-1628244930"><a href="#local-1628244930"><span class="hs-identifier">co_k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcUnify.html#uType"><span class="hs-identifier hs-var">uType</span></a><span> </span><a href="#local-1628244929"><span class="hs-identifier hs-var">origin</span></a><span> </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span> </span><a href="#local-1628244928"><span class="hs-identifier hs-var">act_kind'</span></a><span> </span><a href="#local-1628244921"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-819"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;checkExpectedKind&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244920"><span class="hs-identifier hs-var">act_kind</span></a><span>
</span><a name="line-820"></a><span>                                          </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244921"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-821"></a><span>                                          </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244930"><span class="hs-identifier hs-var">co_k</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-822"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244931"><a href="#local-1628244931"><span class="hs-identifier">result_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628244927"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#mkNakedCastTy"><span class="hs-identifier hs-var">mkNakedCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628244930"><span class="hs-identifier hs-var">co_k</span></a><span>
</span><a name="line-823"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628244931"><span class="hs-identifier hs-var">result_ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-824"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-825"></a><span>    </span><span class="hs-comment">-- we need to make sure that both kinds have the same number of implicit</span><span>
</span><a name="line-826"></a><span>    </span><span class="hs-comment">-- foralls out front. If the actual kind has more, instantiate accordingly.</span><span>
</span><a name="line-827"></a><span>    </span><span class="hs-comment">-- Otherwise, just pass the type &amp; kind through -- the errors are caught</span><span>
</span><a name="line-828"></a><span>    </span><span class="hs-comment">-- in unifyType.</span><span>
</span><a name="line-829"></a><span>    </span><span class="hs-identifier">instantiate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>    </span><span class="hs-comment">-- the type</span><span>
</span><a name="line-830"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>    </span><span class="hs-comment">-- of this kind</span><span>
</span><a name="line-831"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>   </span><span class="hs-comment">-- but expected to be of this one</span><span>
</span><a name="line-832"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>   </span><span class="hs-comment">-- the inst'ed type</span><span>
</span><a name="line-833"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- its new kind</span><span>
</span><a name="line-834"></a><span>    </span><a name="local-1628244922"><a href="#local-1628244922"><span class="hs-identifier">instantiate</span></a></a><span> </span><a name="local-1628244923"><a href="#local-1628244923"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1628244924"><a href="#local-1628244924"><span class="hs-identifier">act_ki</span></a></a><span> </span><a name="local-1628244925"><a href="#local-1628244925"><span class="hs-identifier">exp_ki</span></a></a><span>
</span><a name="line-835"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628244926"><a href="#local-1628244926"><span class="hs-identifier">exp_bndrs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitPiTysInvisible"><span class="hs-identifier hs-var">splitPiTysInvisible</span></a><span> </span><a href="#local-1628244925"><span class="hs-identifier hs-var">exp_ki</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-836"></a><span>        </span><a href="TcHsType.html#instantiateTyN"><span class="hs-identifier hs-var">instantiateTyN</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1628244926"><span class="hs-identifier hs-var">exp_bndrs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244923"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244924"><span class="hs-identifier hs-var">act_ki</span></a><span>
</span><a name="line-837"></a><span>
</span><a name="line-838"></a><span class="hs-comment">-- | Instantiate a type to have at most @n@ invisible arguments.</span><span>
</span><a name="line-839"></a><span class="hs-identifier">instantiateTyN</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>    </span><span class="hs-comment">-- ^ @n@</span><span>
</span><a name="line-840"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-comment">-- ^ the type</span><span>
</span><a name="line-841"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-comment">-- ^ its kind</span><span>
</span><a name="line-842"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ The inst'ed type with kind</span><span>
</span><a name="line-843"></a><a name="instantiateTyN"><a href="TcHsType.html#instantiateTyN"><span class="hs-identifier">instantiateTyN</span></a></a><span> </span><a name="local-1628244932"><a href="#local-1628244932"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1628244933"><a href="#local-1628244933"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1628244934"><a href="#local-1628244934"><span class="hs-identifier">ki</span></a></a><span>
</span><a name="line-844"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628244935"><a href="#local-1628244935"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244936"><a href="#local-1628244936"><span class="hs-identifier">inner_ki</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitPiTysInvisible"><span class="hs-identifier hs-var">splitPiTysInvisible</span></a><span> </span><a href="#local-1628244934"><span class="hs-identifier hs-var">ki</span></a><span>
</span><a name="line-845"></a><span>        </span><a name="local-1628244937"><a href="#local-1628244937"><span class="hs-identifier">num_to_inst</span></a></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1628244935"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-1628244932"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-846"></a><span>           </span><span class="hs-comment">-- NB: splitAt is forgiving with invalid numbers</span><span>
</span><a name="line-847"></a><span>        </span><span class="hs-special">(</span><a name="local-1628244938"><a href="#local-1628244938"><span class="hs-identifier">inst_bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244939"><a href="#local-1628244939"><span class="hs-identifier">leftover_bndrs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a><span> </span><a href="#local-1628244937"><span class="hs-identifier hs-var">num_to_inst</span></a><span> </span><a href="#local-1628244935"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-848"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-849"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628244937"><span class="hs-identifier hs-var">num_to_inst</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244933"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244934"><span class="hs-identifier hs-var">ki</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-850"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628244940"><a href="#local-1628244940"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628244941"><a href="#local-1628244941"><span class="hs-identifier">inst_args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#tcInstBinders"><span class="hs-identifier hs-var">tcInstBinders</span></a><span> </span><a href="#local-1628244938"><span class="hs-identifier hs-var">inst_bndrs</span></a><span>
</span><a name="line-851"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244942"><a href="#local-1628244942"><span class="hs-identifier">rebuilt_ki</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span> </span><a href="#local-1628244939"><span class="hs-identifier hs-var">leftover_bndrs</span></a><span> </span><a href="#local-1628244936"><span class="hs-identifier hs-var">inner_ki</span></a><span>
</span><a name="line-852"></a><span>             </span><a name="local-1628244943"><a href="#local-1628244943"><span class="hs-identifier">ki'</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-1628244940"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628244942"><span class="hs-identifier hs-var">rebuilt_ki</span></a><span>
</span><a name="line-853"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkNakedAppTys"><span class="hs-identifier hs-var">mkNakedAppTys</span></a><span> </span><a href="#local-1628244933"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244941"><span class="hs-identifier hs-var">inst_args</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244943"><span class="hs-identifier hs-var">ki'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-854"></a><span>
</span><a name="line-855"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-856"></a><span class="hs-identifier">tcHsContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsContext"><span class="hs-identifier hs-type">LHsContext</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span>
</span><a name="line-857"></a><a name="tcHsContext"><a href="TcHsType.html#tcHsContext"><span class="hs-identifier">tcHsContext</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_hs_context"><span class="hs-identifier hs-var">tc_hs_context</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span>
</span><a name="line-858"></a><span>
</span><a name="line-859"></a><span class="hs-identifier">tcLHsPredType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-860"></a><a name="tcLHsPredType"><a href="TcHsType.html#tcLHsPredType"><span class="hs-identifier">tcLHsPredType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_pred"><span class="hs-identifier hs-var">tc_lhs_pred</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span>
</span><a name="line-861"></a><span>
</span><a name="line-862"></a><span class="hs-identifier">tc_hs_context</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsContext"><span class="hs-identifier hs-type">LHsContext</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span>
</span><a name="line-863"></a><a name="tc_hs_context"><a href="TcHsType.html#tc_hs_context"><span class="hs-identifier">tc_hs_context</span></a></a><span> </span><a name="local-1628244944"><a href="#local-1628244944"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244945"><a href="#local-1628244945"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_lhs_pred"><span class="hs-identifier hs-var">tc_lhs_pred</span></a><span> </span><a href="#local-1628244944"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628244945"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-864"></a><span>
</span><a name="line-865"></a><span class="hs-identifier">tc_lhs_pred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-866"></a><a name="tc_lhs_pred"><a href="TcHsType.html#tc_lhs_pred"><span class="hs-identifier">tc_lhs_pred</span></a></a><span> </span><a name="local-1628244946"><a href="#local-1628244946"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244947"><a href="#local-1628244947"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-1628244946"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-1628244947"><span class="hs-identifier hs-var">pred</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span>
</span><a name="line-867"></a><span>
</span><a name="line-868"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-869"></a><span class="hs-identifier">tcTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-870"></a><span class="hs-comment">-- See Note [Type checking recursive type and class declarations]</span><span>
</span><a name="line-871"></a><span class="hs-comment">-- in TcTyClsDecls</span><span>
</span><a name="line-872"></a><a name="tcTyVar"><a href="TcHsType.html#tcTyVar"><span class="hs-identifier">tcTyVar</span></a></a><span> </span><a name="local-1628244948"><a href="#local-1628244948"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628244949"><a href="#local-1628244949"><span class="hs-identifier">name</span></a></a><span>         </span><span class="hs-comment">-- Could be a tyvar, a tycon, or a datacon</span><span>
</span><a name="line-873"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;lk1&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244949"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-874"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628244964"><a href="#local-1628244964"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookup"><span class="hs-identifier hs-var">tcLookup</span></a><span> </span><a href="#local-1628244949"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-875"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628244964"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-876"></a><span>           </span><a href="TcRnTypes.html#ATyVar"><span class="hs-identifier hs-var">ATyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244965"><a href="#local-1628244965"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1628244965"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1628244965"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-877"></a><span>
</span><a name="line-878"></a><span>           </span><a href="TcRnTypes.html#ATcTyCon"><span class="hs-identifier hs-var">ATcTyCon</span></a><span> </span><a name="local-1628244966"><a href="#local-1628244966"><span class="hs-identifier">tc_tc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="#local-1628244950"><span class="hs-identifier hs-var">check_tc</span></a><span> </span><a href="#local-1628244966"><span class="hs-identifier hs-var">tc_tc</span></a><span>
</span><a name="line-879"></a><span>                                </span><span class="hs-special">;</span><span> </span><a name="local-1628244967"><a href="#local-1628244967"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628244952"><span class="hs-identifier hs-var">get_loopy_tc</span></a><span> </span><a href="#local-1628244949"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628244966"><span class="hs-identifier hs-var">tc_tc</span></a><span>
</span><a name="line-880"></a><span>                                </span><span class="hs-special">;</span><span> </span><a href="#local-1628244951"><span class="hs-identifier hs-var">handle_tyfams</span></a><span> </span><a href="#local-1628244967"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1628244966"><span class="hs-identifier hs-var">tc_tc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-881"></a><span>                             </span><span class="hs-comment">-- mkNakedTyConApp: see Note [Type-checking inside the knot]</span><span>
</span><a name="line-882"></a><span>                 </span><span class="hs-comment">-- NB: we really should check if we're at the kind level</span><span>
</span><a name="line-883"></a><span>                 </span><span class="hs-comment">-- and if the tycon is promotable if -XNoTypeInType is set.</span><span>
</span><a name="line-884"></a><span>                 </span><span class="hs-comment">-- But this is a terribly large amount of work! Not worth it.</span><span>
</span><a name="line-885"></a><span>
</span><a name="line-886"></a><span>           </span><a href="TcRnTypes.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-1628244968"><a href="#local-1628244968"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-887"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="#local-1628244950"><span class="hs-identifier hs-var">check_tc</span></a><span> </span><a href="#local-1628244968"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-888"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="#local-1628244951"><span class="hs-identifier hs-var">handle_tyfams</span></a><span> </span><a href="#local-1628244968"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1628244968"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-889"></a><span>
</span><a name="line-890"></a><span>           </span><a href="TcRnTypes.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a name="local-1628244969"><a href="#local-1628244969"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-891"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244970"><a href="#local-1628244970"><span class="hs-identifier">data_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#DataKinds"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DataKinds</span></a><span>
</span><a name="line-892"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244970"><span class="hs-identifier hs-var">data_kinds</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="DataCon.html#specialPromotedDc"><span class="hs-identifier hs-var">specialPromotedDc</span></a><span> </span><a href="#local-1628244969"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-893"></a><span>                       </span><a href="TcHsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a><span> </span><a href="#local-1628244949"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="TcRnTypes.html#NoDataKindsDC"><span class="hs-identifier hs-var">NoDataKindsDC</span></a><span>
</span><a name="line-894"></a><span>                   </span><span class="hs-special">;</span><span> </span><a name="local-1628244971"><a href="#local-1628244971"><span class="hs-identifier">type_in_type</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#TypeInType"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TypeInType</span></a><span>
</span><a name="line-895"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628244971"><span class="hs-identifier hs-var">type_in_type</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-896"></a><span>                              </span><span class="hs-special">(</span><span> </span><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier hs-var">isTypeLevel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mode_level</span><span> </span><a href="#local-1628244948"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-897"></a><span>                                </span><a href="DataCon.html#isLegacyPromotableDataCon"><span class="hs-identifier hs-var">isLegacyPromotableDataCon</span></a><span> </span><a href="#local-1628244969"><span class="hs-identifier hs-var">dc</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-898"></a><span>                              </span><span class="hs-special">(</span><span> </span><a href="TcRnTypes.html#isKindLevel"><span class="hs-identifier hs-var">isKindLevel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mode_level</span><span> </span><a href="#local-1628244948"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-899"></a><span>                                </span><a href="DataCon.html#specialPromotedDc"><span class="hs-identifier hs-var">specialPromotedDc</span></a><span> </span><a href="#local-1628244969"><span class="hs-identifier hs-var">dc</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-900"></a><span>                       </span><a href="TcHsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a><span> </span><a href="#local-1628244949"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="TcRnTypes.html#NoTypeInTypeDC"><span class="hs-identifier hs-var">NoTypeInTypeDC</span></a><span>
</span><a name="line-901"></a><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628244972"><a href="#local-1628244972"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a><span> </span><a href="#local-1628244969"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-902"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkNakedTyConApp"><span class="hs-identifier hs-var">mkNakedTyConApp</span></a><span> </span><a href="#local-1628244972"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-1628244972"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-903"></a><span>
</span><a name="line-904"></a><span>           </span><a href="TcRnTypes.html#APromotionErr"><span class="hs-identifier hs-var">APromotionErr</span></a><span> </span><a name="local-1628244973"><a href="#local-1628244973"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a><span> </span><a href="#local-1628244949"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628244973"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-905"></a><span>
</span><a name="line-906"></a><span>           </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEnv.html#wrongThingErr"><span class="hs-identifier hs-var">wrongThingErr</span></a><span> </span><span class="hs-string">&quot;type&quot;</span><span> </span><a href="#local-1628244964"><span class="hs-identifier hs-var">thing</span></a><span> </span><a href="#local-1628244949"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-907"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-908"></a><span>    </span><span class="hs-identifier">check_tc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-909"></a><span>    </span><a name="local-1628244950"><a href="#local-1628244950"><span class="hs-identifier">check_tc</span></a></a><span> </span><a name="local-1628244953"><a href="#local-1628244953"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244954"><a href="#local-1628244954"><span class="hs-identifier">type_in_type</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#TypeInType"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TypeInType</span></a><span>
</span><a name="line-910"></a><span>                     </span><span class="hs-special">;</span><span> </span><a name="local-1628244955"><a href="#local-1628244955"><span class="hs-identifier">data_kinds</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#DataKinds"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DataKinds</span></a><span>
</span><a name="line-911"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier hs-var">isTypeLevel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mode_level</span><span> </span><a href="#local-1628244948"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-912"></a><span>                               </span><a href="#local-1628244955"><span class="hs-identifier hs-var">data_kinds</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-913"></a><span>                               </span><a href="TyCon.html#isKindTyCon"><span class="hs-identifier hs-var">isKindTyCon</span></a><span> </span><a href="#local-1628244953"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-914"></a><span>                       </span><a href="TcHsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a><span> </span><a href="#local-1628244949"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="TcRnTypes.html#NoDataKindsTC"><span class="hs-identifier hs-var">NoDataKindsTC</span></a><span>
</span><a name="line-915"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier hs-var">isTypeLevel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mode_level</span><span> </span><a href="#local-1628244948"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-916"></a><span>                               </span><a href="#local-1628244954"><span class="hs-identifier hs-var">type_in_type</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-917"></a><span>                               </span><a href="DataCon.html#isLegacyPromotableTyCon"><span class="hs-identifier hs-var">isLegacyPromotableTyCon</span></a><span> </span><a href="#local-1628244953"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-918"></a><span>                       </span><a href="TcHsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a><span> </span><a href="#local-1628244949"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="TcRnTypes.html#NoTypeInTypeTC"><span class="hs-identifier hs-var">NoTypeInTypeTC</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-919"></a><span>
</span><a name="line-920"></a><span>    </span><span class="hs-comment">-- if we are type-checking a type family tycon, we must instantiate</span><span>
</span><a name="line-921"></a><span>    </span><span class="hs-comment">-- any invisible arguments right away. Otherwise, we get #11246</span><span>
</span><a name="line-922"></a><span>    </span><span class="hs-identifier">handle_tyfams</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>   </span><span class="hs-comment">-- the tycon to instantiate (might be loopy)</span><span>
</span><a name="line-923"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>   </span><span class="hs-comment">-- a non-loopy version of the tycon</span><span>
</span><a name="line-924"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-925"></a><span>    </span><a name="local-1628244951"><a href="#local-1628244951"><span class="hs-identifier">handle_tyfams</span></a></a><span> </span><a name="local-1628244956"><a href="#local-1628244956"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1628244957"><a href="#local-1628244957"><span class="hs-identifier">tc_tc</span></a></a><span>
</span><a name="line-926"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#mightBeUnsaturatedTyCon"><span class="hs-identifier hs-var">mightBeUnsaturatedTyCon</span></a><span> </span><a href="#local-1628244957"><span class="hs-identifier hs-var">tc_tc</span></a><span>
</span><a name="line-927"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244958"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244959"><span class="hs-identifier hs-var">tc_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-928"></a><span>
</span><a name="line-929"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-930"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#instantiateTyN"><span class="hs-identifier hs-var">instantiateTyN</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-1628244958"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628244959"><span class="hs-identifier hs-var">tc_kind</span></a><span>
</span><a name="line-931"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-932"></a><span>        </span><a name="local-1628244958"><a href="#local-1628244958"><span class="hs-identifier">ty</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkNakedTyConApp"><span class="hs-identifier hs-var">mkNakedTyConApp</span></a><span> </span><a href="#local-1628244956"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-933"></a><span>        </span><a name="local-1628244959"><a href="#local-1628244959"><span class="hs-identifier">tc_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-1628244957"><span class="hs-identifier hs-var">tc_tc</span></a><span>
</span><a name="line-934"></a><span>
</span><a name="line-935"></a><span>    </span><span class="hs-identifier">get_loopy_tc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-936"></a><span>    </span><span class="hs-comment">-- Return the knot-tied global TyCon if there is one</span><span>
</span><a name="line-937"></a><span>    </span><span class="hs-comment">-- Otherwise the local TcTyCon; we must be doing kind checking</span><span>
</span><a name="line-938"></a><span>    </span><span class="hs-comment">-- but we still want to return a TyCon of some sort to use in</span><span>
</span><a name="line-939"></a><span>    </span><span class="hs-comment">-- error messages</span><span>
</span><a name="line-940"></a><span>    </span><a name="local-1628244952"><a href="#local-1628244952"><span class="hs-identifier">get_loopy_tc</span></a></a><span> </span><a name="local-1628244960"><a href="#local-1628244960"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-1628244961"><a href="#local-1628244961"><span class="hs-identifier">tc_tc</span></a></a><span>
</span><a name="line-941"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244962"><a href="#local-1628244962"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-942"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_type_env</span><span> </span><a href="#local-1628244962"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244960"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-943"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-1628244963"><a href="#local-1628244963"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628244963"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-944"></a><span>                </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;lk1 (loopy)&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244960"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-945"></a><span>                                       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628244961"><span class="hs-identifier hs-var">tc_tc</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-946"></a><span>
</span><a name="line-947"></a><span class="hs-identifier">tcClass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-948"></a><a name="tcClass"><a href="TcHsType.html#tcClass"><span class="hs-identifier">tcClass</span></a></a><span> </span><a name="local-1628244974"><a href="#local-1628244974"><span class="hs-identifier">cls</span></a></a><span>     </span><span class="hs-comment">-- Must be a class</span><span>
</span><a name="line-949"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244975"><a href="#local-1628244975"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookup"><span class="hs-identifier hs-var">tcLookup</span></a><span> </span><a href="#local-1628244974"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-950"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628244975"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-951"></a><span>           </span><a href="TcRnTypes.html#ATcTyCon"><span class="hs-identifier hs-var">ATcTyCon</span></a><span> </span><a name="local-1628244976"><a href="#local-1628244976"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#aThingErr"><span class="hs-identifier hs-var">aThingErr</span></a><span> </span><span class="hs-string">&quot;tcClass&quot;</span><span> </span><a href="#local-1628244974"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-1628244976"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-952"></a><span>           </span><a href="TcRnTypes.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-1628244977"><a href="#local-1628244977"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-953"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628244978"><a href="#local-1628244978"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="#local-1628244977"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-954"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244978"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-1628244977"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-955"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEnv.html#wrongThingErr"><span class="hs-identifier hs-var">wrongThingErr</span></a><span> </span><span class="hs-string">&quot;class&quot;</span><span> </span><a href="#local-1628244975"><span class="hs-identifier hs-var">thing</span></a><span> </span><a href="#local-1628244974"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-956"></a><span>
</span><a name="line-957"></a><span>
</span><a name="line-958"></a><span class="hs-identifier">aThingErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628244563"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-959"></a><span class="hs-comment">-- The type checker for types is sometimes called simply to</span><span>
</span><a name="line-960"></a><span class="hs-comment">-- do *kind* checking; and in that case it ignores the type</span><span>
</span><a name="line-961"></a><span class="hs-comment">-- returned. Which is a good thing since it may not be available yet!</span><span>
</span><a name="line-962"></a><a name="aThingErr"><a href="TcHsType.html#aThingErr"><span class="hs-identifier">aThingErr</span></a></a><span> </span><a name="local-1628244979"><a href="#local-1628244979"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-1628244980"><a href="#local-1628244980"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;AThing evaluated unexpectedly&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628244979"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244980"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-963"></a><span>
</span><a name="line-964"></a><span class="hs-comment">{-
Note [Type-checking inside the knot]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we are checking the argument types of a data constructor.  We
must zonk the types before making the DataCon, because once built we
can't change it.  So we must traverse the type.

BUT the parent TyCon is knot-tied, so we can't look at it yet.

So we must be careful not to use &quot;smart constructors&quot; for types that
look at the TyCon or Class involved.

  * Hence the use of mkNakedXXX functions. These do *not* enforce
    the invariants (for example that we use (ForAllTy (Anon s) t) rather
    than (TyConApp (-&gt;) [s,t])).

  * The zonking functions establish invariants (even zonkTcType, a change from
    previous behaviour). So we must never inspect the result of a
    zonk that might mention a knot-tied TyCon. This is generally OK
    because we zonk *kinds* while kind-checking types. And the TyCons
    in kinds shouldn't be knot-tied, because they come from a previous
    mutually recursive group.

  * TcHsSyn.zonkTcTypeToType also can safely check/establish
    invariants.

This is horribly delicate.  I hate it.  A good example of how
delicate it is can be seen in Trac #7903.

Note [Body kind of a HsForAllTy]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The body of a forall is usually a type, but in principle
there's no reason to prohibit *unlifted* types.
In fact, GHC can itself construct a function with an
unboxed tuple inside a for-all (via CPR analyis; see
typecheck/should_compile/tc170).

Moreover in instance heads we get forall-types with
kind Constraint.

It's tempting to check that the body kind is either * or #. But this is
wrong. For example:

  class C a b
  newtype N = Mk Foo deriving (C a)

We're doing newtype-deriving for C. But notice how `a` isn't in scope in
the predicate `C a`. So we quantify, yielding `forall a. C a` even though
`C a` has kind `* -&gt; Constraint`. The `forall a. C a` is a bit cheeky, but
convenient. Bottom line: don't check for * or # here.

Note [Body kind of a HsQualTy]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If ctxt is non-empty, the HsQualTy really is a /function/, so the
kind of the result really is '*', and in that case the kind of the
body-type can be lifted or unlifted.

However, consider
    instance Eq a =&gt; Eq [a] where ...
or
    f :: (Eq a =&gt; Eq [a]) =&gt; blah
Here both body-kind of the HsQualTy is Constraint rather than *.
Rather crudely we tell the difference by looking at exp_kind. It's
very convenient to typecheck instance types like any other HsSigType.

Admittedly the '(Eq a =&gt; Eq [a]) =&gt; blah' case is erroneous, but it's
better to reject in checkValidType.  If we say that the body kind
should be '*' we risk getting TWO error messages, one saying that Eq
[a] doens't have kind '*', and one saying that we need a Constraint to
the left of the outer (=&gt;).

How do we figure out the right body kind?  Well, it's a bit of a
kludge: I just look at the expected kind.  If it's Constraint, we
must be in this instance situation context. It's a kludge because it
wouldn't work if any unification was involved to compute that result
kind -- but it isn't.  (The true way might be to use the 'mode'
parameter, but that seemed like a sledgehammer to crack a nut.)

Note [Inferring tuple kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Give a tuple type (a,b,c), which the parser labels as HsBoxedOrConstraintTuple,
we try to figure out whether it's a tuple of kind * or Constraint.
  Step 1: look at the expected kind
  Step 2: infer argument kinds

If after Step 2 it's not clear from the arguments that it's
Constraint, then it must be *.  Once having decided that we re-check
the Check the arguments again to give good error messages
in eg. `(Maybe, Maybe)`

Note that we will still fail to infer the correct kind in this case:

  type T a = ((a,a), D a)
  type family D :: Constraint -&gt; Constraint

While kind checking T, we do not yet know the kind of D, so we will default the
kind of T to * -&gt; *. It works if we annotate `a` with kind `Constraint`.

Note [Desugaring types]
~~~~~~~~~~~~~~~~~~~~~~~
The type desugarer is phase 2 of dealing with HsTypes.  Specifically:

  * It transforms from HsType to Type

  * It zonks any kinds.  The returned type should have no mutable kind
    or type variables (hence returning Type not TcType):
      - any unconstrained kind variables are defaulted to (Any *) just
        as in TcHsSyn.
      - there are no mutable type variables because we are
        kind-checking a type
    Reason: the returned type may be put in a TyCon or DataCon where
    it will never subsequently be zonked.

You might worry about nested scopes:
        ..a:kappa in scope..
            let f :: forall b. T '[a,b] -&gt; Int
In this case, f's type could have a mutable kind variable kappa in it;
and we might then default it to (Any *) when dealing with f's type
signature.  But we don't expect this to happen because we can't get a
lexically scoped type variable with a mutable kind variable in it.  A
delicate point, this.  If it becomes an issue we might need to
distinguish top-level from nested uses.

Moreover
  * it cannot fail,
  * it does no unifications
  * it does no validity checking, except for structural matters, such as
        (a) spurious ! annotations.
        (b) a class used as a type

Note [Kind of a type splice]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider these terms, each with TH type splice inside:
     [| e1 :: Maybe $(..blah..) |]
     [| e2 :: $(..blah..) |]
When kind-checking the type signature, we'll kind-check the splice
$(..blah..); we want to give it a kind that can fit in any context,
as if $(..blah..) :: forall k. k.

In the e1 example, the context of the splice fixes kappa to *.  But
in the e2 example, we'll desugar the type, zonking the kind unification
variables as we go.  When we encounter the unconstrained kappa, we
want to default it to '*', not to (Any *).


Help functions for type applications
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-}</span><span>
</span><a name="line-1112"></a><span>
</span><a name="line-1113"></a><span class="hs-identifier">addTypeCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244562"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244562"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1114"></a><span>        </span><span class="hs-comment">-- Wrap a context around only if we want to show that contexts.</span><span>
</span><a name="line-1115"></a><span>        </span><span class="hs-comment">-- Omit invisble ones and ones user's won't grok</span><span>
</span><a name="line-1116"></a><a name="addTypeCtxt"><a href="TcHsType.html#addTypeCtxt"><span class="hs-identifier">addTypeCtxt</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628244981"><a href="#local-1628244981"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628244982"><a href="#local-1628244982"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-1117"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><a href="#local-1628244983"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628244982"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1118"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1119"></a><span>    </span><a name="local-1628244983"><a href="#local-1628244983"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In the type&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628244981"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1120"></a><span>
</span><a name="line-1121"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Type-variable binders
%*                                                                      *
%************************************************************************

Note [Scope-check inferred kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  data SameKind :: k -&gt; k -&gt; *
  foo :: forall a (b :: Proxy a) (c :: Proxy d). SameKind b c

d has no binding site. So it gets bound implicitly, at the top. The
problem is that d's kind mentions `a`. So it's all ill-scoped.

The way we check for this is to gather all variables *bound* in a
type variable's scope. The type variable's kind should not mention
any of these variables. That is, d's kind can't mention a, b, or c.
We can't just check to make sure that d's kind is in scope, because
we might be about to kindGeneralize.

A little messy, but it works.

-}</span><span>
</span><a name="line-1147"></a><span>
</span><a name="line-1148"></a><span class="hs-identifier">tcWildCardBinders</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1149"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244561"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1150"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244561"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1151"></a><span class="hs-comment">-- Use the Unique form the specified Name; don't clone it.  There is</span><span>
</span><a name="line-1152"></a><span class="hs-comment">-- no need to clone, and not doing so avoids the need to return a list</span><span>
</span><a name="line-1153"></a><span class="hs-comment">-- of pairs to bring into scope.</span><span>
</span><a name="line-1154"></a><a name="tcWildCardBinders"><a href="TcHsType.html#tcWildCardBinders"><span class="hs-identifier">tcWildCardBinders</span></a></a><span> </span><a name="local-1628244984"><a href="#local-1628244984"><span class="hs-identifier">wcs</span></a></a><span> </span><a name="local-1628244985"><a href="#local-1628244985"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1155"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244990"><a href="#local-1628244990"><span class="hs-identifier">wcs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628244986"><span class="hs-identifier hs-var">new_wildcard</span></a><span> </span><a href="#local-1628244984"><span class="hs-identifier hs-var">wcs</span></a><span>
</span><a name="line-1156"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv2"><span class="hs-identifier hs-var">tcExtendTyVarEnv2</span></a><span> </span><a href="#local-1628244990"><span class="hs-identifier hs-var">wcs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1157"></a><span>         </span><a href="#local-1628244985"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-1628244990"><span class="hs-identifier hs-var">wcs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1158"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1159"></a><span>   </span><span class="hs-identifier">new_wildcard</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-1160"></a><span>   </span><a name="local-1628244986"><a href="#local-1628244986"><span class="hs-identifier">new_wildcard</span></a></a><span> </span><a name="local-1628244987"><a href="#local-1628244987"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628244988"><a href="#local-1628244988"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-1161"></a><span>                          </span><span class="hs-special">;</span><span> </span><a name="local-1628244989"><a href="#local-1628244989"><span class="hs-identifier">tv</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newFlexiTyVar"><span class="hs-identifier hs-var">newFlexiTyVar</span></a><span> </span><a href="#local-1628244988"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1162"></a><span>                          </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244987"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244989"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1163"></a><span>
</span><a name="line-1164"></a><span class="hs-comment">-- | Kind-check a 'LHsQTyVars'. If the decl under consideration has a complete,</span><span>
</span><a name="line-1165"></a><span class="hs-comment">-- user-supplied kind signature (CUSK), generalise the result.</span><span>
</span><a name="line-1166"></a><span class="hs-comment">-- Used in 'getInitialKind' (for tycon kinds and other kinds)</span><span>
</span><a name="line-1167"></a><span class="hs-comment">-- and in kind-checking (but not for tycon kinds, which are checked with</span><span>
</span><a name="line-1168"></a><span class="hs-comment">-- tcTyClDecls). See also Note [Complete user-supplied kind signatures] in</span><span>
</span><a name="line-1169"></a><span class="hs-comment">-- HsDecls.</span><span>
</span><a name="line-1170"></a><span class="hs-comment">--</span><span>
</span><a name="line-1171"></a><span class="hs-comment">-- This function does not do telescope checking.</span><span>
</span><a name="line-1172"></a><span class="hs-identifier">kcHsTyVarBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>    </span><span class="hs-comment">-- ^ True &lt;=&gt; the decl being checked has a CUSK</span><span>
</span><a name="line-1173"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-1174"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244560"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1175"></a><span>                                  </span><span class="hs-comment">-- ^ the result kind, possibly with other info</span><span>
</span><a name="line-1176"></a><span>                                  </span><span class="hs-comment">-- ^ args are implicit vars, explicit vars</span><span>
</span><a name="line-1177"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcTyBinder"><span class="hs-identifier hs-type">TcTyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244560"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1178"></a><span>                                  </span><span class="hs-comment">-- ^ The full kind of the thing being declared,</span><span>
</span><a name="line-1179"></a><span>                                  </span><span class="hs-comment">-- with the other info</span><span>
</span><a name="line-1180"></a><a name="kcHsTyVarBndrs"><a href="TcHsType.html#kcHsTyVarBndrs"><span class="hs-identifier">kcHsTyVarBndrs</span></a></a><span> </span><a name="local-1628244991"><a href="#local-1628244991"><span class="hs-identifier">cusk</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsQTvs"><span class="hs-identifier hs-var">HsQTvs</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsq_implicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244992"><a href="#local-1628244992"><span class="hs-identifier">kv_ns</span></a></a><span>
</span><a name="line-1181"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsq_explicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628244993"><a href="#local-1628244993"><span class="hs-identifier">hs_tvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628244994"><a href="#local-1628244994"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1182"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245023"><a href="#local-1628245023"><span class="hs-identifier">meta_kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628244992"><span class="hs-identifier hs-var">kv_ns</span></a><span>
</span><a name="line-1183"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628245024"><a href="#local-1628245024"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628244991"><span class="hs-identifier hs-var">cusk</span></a><span>
</span><a name="line-1184"></a><span>                </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="TcHsType.html#new_skolem_tv"><span class="hs-identifier hs-var">new_skolem_tv</span></a><span> </span><a href="#local-1628244992"><span class="hs-identifier hs-var">kv_ns</span></a><span> </span><a href="#local-1628245023"><span class="hs-identifier hs-var">meta_kvs</span></a><span>
</span><a name="line-1185"></a><span>                     </span><span class="hs-comment">-- the names must line up in splitTelescopeTvs</span><span>
</span><a name="line-1186"></a><span>                </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><a href="TcMType.html#newSigTyVar"><span class="hs-identifier hs-var">newSigTyVar</span></a><span> </span><a href="#local-1628244992"><span class="hs-identifier hs-var">kv_ns</span></a><span> </span><a href="#local-1628245023"><span class="hs-identifier hs-var">meta_kvs</span></a><span>
</span><a name="line-1187"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv2"><span class="hs-identifier hs-var">tcExtendTyVarEnv2</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244992"><span class="hs-identifier hs-var">kv_ns</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628245024"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1188"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628245025"><a href="#local-1628245025"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245026"><a href="#local-1628245026"><span class="hs-identifier">res_kind</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628245027"><a href="#local-1628245027"><span class="hs-identifier">stuff</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628244995"><span class="hs-identifier hs-var">bind_telescope</span></a><span> </span><a href="#local-1628244993"><span class="hs-identifier hs-var">hs_tvs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244994"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-1628245024"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1189"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245028"><a href="#local-1628245028"><span class="hs-identifier">qkvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1190"></a><span>                    </span><a href="Type.html#tyCoVarsOfTypeWellScoped"><span class="hs-identifier hs-var">tyCoVarsOfTypeWellScoped</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span> </span><a href="#local-1628245025"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-1628245026"><span class="hs-identifier hs-var">res_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1191"></a><span>                      </span><span class="hs-comment">-- these have to be the vars made with new_skolem_tv</span><span>
</span><a name="line-1192"></a><span>                      </span><span class="hs-comment">-- above. Thus, they are known to the user and should</span><span>
</span><a name="line-1193"></a><span>                      </span><span class="hs-comment">-- be Specified, not Invisible, when kind-generalizing</span><span>
</span><a name="line-1194"></a><span>
</span><a name="line-1195"></a><span>                </span><span class="hs-comment">-- the free non-meta variables in the returned kind will</span><span>
</span><a name="line-1196"></a><span>                </span><span class="hs-comment">-- contain both *mentioned* kind vars and *unmentioned* kind</span><span>
</span><a name="line-1197"></a><span>                </span><span class="hs-comment">-- vars (See case (1) under Note [Typechecking telescopes])</span><span>
</span><a name="line-1198"></a><span>             </span><a name="local-1628245029"><a href="#local-1628245029"><span class="hs-identifier">all_binders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628244991"><span class="hs-identifier hs-var">cusk</span></a><span>
</span><a name="line-1199"></a><span>                           </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkNamedBinder"><span class="hs-identifier hs-var">mkNamedBinder</span></a><span> </span><a href="TyCoRep.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628245028"><span class="hs-identifier hs-var">qkvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628245025"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-1200"></a><span>                           </span><span class="hs-keyword">else</span><span> </span><a href="#local-1628245025"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-1201"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245029"><span class="hs-identifier hs-var">all_binders</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245026"><span class="hs-identifier hs-var">res_kind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245027"><span class="hs-identifier hs-var">stuff</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1202"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1203"></a><span>      </span><span class="hs-comment">-- there may be dependency between the explicit &quot;ty&quot; vars. So, we have</span><span>
</span><a name="line-1204"></a><span>      </span><span class="hs-comment">-- to handle them one at a time. We also produce the TyBinders here,</span><span>
</span><a name="line-1205"></a><span>      </span><span class="hs-comment">-- because this is the place we know whether to use Anon or Named.</span><span>
</span><a name="line-1206"></a><span>      </span><span class="hs-comment">-- We prefer using an anonymous binder over a trivial named</span><span>
</span><a name="line-1207"></a><span>      </span><span class="hs-comment">-- binder. If a user wants a trivial named one, use an explicit kind</span><span>
</span><a name="line-1208"></a><span>      </span><span class="hs-comment">-- signature.</span><span>
</span><a name="line-1209"></a><span>    </span><span class="hs-identifier">bind_telescope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1210"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244998"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1211"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcTyBinder"><span class="hs-identifier hs-type">TcTyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">,</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628244998"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1212"></a><span>    </span><a name="local-1628244995"><a href="#local-1628244995"><span class="hs-identifier">bind_telescope</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-1628245000"><a href="#local-1628245000"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-1213"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628245001"><a href="#local-1628245001"><span class="hs-identifier">res_kind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245002"><a href="#local-1628245002"><span class="hs-identifier">stuff</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628245000"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1214"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628245001"><span class="hs-identifier hs-var">res_kind</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1628245001"><span class="hs-identifier hs-var">res_kind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245002"><span class="hs-identifier hs-var">stuff</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1215"></a><span>    </span><span class="hs-identifier">bind_telescope</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628245003"><a href="#local-1628245003"><span class="hs-identifier">hs_tv</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628245004"><a href="#local-1628245004"><span class="hs-identifier">hs_tvs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628245005"><a href="#local-1628245005"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-1216"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245006"><a href="#local-1628245006"><span class="hs-identifier">tv_pair</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1628245007"><a href="#local-1628245007"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628244997"><span class="hs-identifier hs-var">kc_hs_tv</span></a><span> </span><a href="#local-1628245003"><span class="hs-identifier hs-var">hs_tv</span></a><span>
</span><a name="line-1217"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628245009"><a href="#local-1628245009"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245010"><a href="#local-1628245010"><span class="hs-identifier">res_kind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245011"><a href="#local-1628245011"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245012"><a href="#local-1628245012"><span class="hs-identifier">stuff</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628244996"><span class="hs-identifier hs-var">bind_unless_scoped</span></a><span> </span><a href="#local-1628245006"><span class="hs-identifier hs-var">tv_pair</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1218"></a><span>                                                </span><a href="#local-1628244995"><span class="hs-identifier hs-var">bind_telescope</span></a><span> </span><a href="#local-1628245004"><span class="hs-identifier hs-var">hs_tvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628245008"><a href="#local-1628245008"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1219"></a><span>                                                </span><a href="#local-1628245005"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245007"><span class="hs-identifier hs-var">tv</span></a><span class="hs-glyph">:</span><a href="#local-1628245008"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1220"></a><span>              </span><span class="hs-comment">-- we must be *lazy* in res_kind and fvs (assuming that the</span><span>
</span><a name="line-1221"></a><span>              </span><span class="hs-comment">-- caller of kcHsTyVarBndrs is, too), as sometimes these hold</span><span>
</span><a name="line-1222"></a><span>              </span><span class="hs-comment">-- panics. See kcConDecl.</span><span>
</span><a name="line-1223"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-1628245013"><a href="#local-1628245013"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1628245007"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1224"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245014"><a href="#local-1628245014"><span class="hs-identifier">k_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1628245013"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1225"></a><span>                 </span><span class="hs-special">(</span><a name="local-1628245015"><a href="#local-1628245015"><span class="hs-identifier">bndr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245016"><a href="#local-1628245016"><span class="hs-identifier">fvs'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1226"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628245007"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628245011"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-1227"></a><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="Type.html#mkNamedBinder"><span class="hs-identifier hs-var">mkNamedBinder</span></a><span> </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">Visible</span></a><span> </span><a href="#local-1628245007"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1228"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="#local-1628245011"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#delVarSet"><span class="hs-identifier hs-var">delVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628245007"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628245014"><span class="hs-identifier hs-var">k_fvs</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1229"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1230"></a><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Type.html#mkAnonBinder"><span class="hs-identifier hs-var">mkAnonBinder</span></a><span> </span><a href="#local-1628245013"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245011"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628245014"><span class="hs-identifier hs-var">k_fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1231"></a><span>
</span><a name="line-1232"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245015"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245009"><span class="hs-identifier hs-var">binders</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245010"><span class="hs-identifier hs-var">res_kind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245016"><span class="hs-identifier hs-var">fvs'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245012"><span class="hs-identifier hs-var">stuff</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1233"></a><span>
</span><a name="line-1234"></a><span>    </span><span class="hs-comment">-- | Bind the tyvar in the env't unless the bool is True</span><span>
</span><a name="line-1235"></a><span>    </span><span class="hs-identifier">bind_unless_scoped</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244999"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244999"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1236"></a><span>    </span><a name="local-1628244996"><a href="#local-1628244996"><span class="hs-identifier">bind_unless_scoped</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>   </span><a name="local-1628245017"><a href="#local-1628245017"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628245017"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1237"></a><span>    </span><span class="hs-identifier">bind_unless_scoped</span><span> </span><span class="hs-special">(</span><a name="local-1628245018"><a href="#local-1628245018"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><a name="local-1628245019"><a href="#local-1628245019"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1238"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628245018"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span> </span><a href="#local-1628245019"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1239"></a><span>
</span><a name="line-1240"></a><span>    </span><span class="hs-identifier">kc_hs_tv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#HsTyVarBndr"><span class="hs-identifier hs-type">HsTyVarBndr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-1241"></a><span>    </span><a name="local-1628244997"><a href="#local-1628244997"><span class="hs-identifier">kc_hs_tv</span></a></a><span> </span><a name="local-1628245020"><a href="#local-1628245020"><span class="hs-identifier">hs_tvb</span></a></a><span>
</span><a name="line-1242"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628245021"><a href="#local-1628245021"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245022"><a href="#local-1628245022"><span class="hs-identifier">scoped</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsTyVarBndr_Scoped"><span class="hs-identifier hs-var">tcHsTyVarBndr_Scoped</span></a><span> </span><a href="#local-1628245020"><span class="hs-identifier hs-var">hs_tvb</span></a><span>
</span><a name="line-1243"></a><span>
</span><a name="line-1244"></a><span>              </span><span class="hs-comment">-- in the CUSK case, we want to default any un-kinded tyvars</span><span>
</span><a name="line-1245"></a><span>              </span><span class="hs-comment">-- See Note [Complete user-supplied kind signatures] in HsDecls</span><span>
</span><a name="line-1246"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628245020"><span class="hs-identifier hs-var">hs_tvb</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1247"></a><span>               </span><a href="HsTypes.html#UserTyVar"><span class="hs-identifier hs-var">UserTyVar</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-1248"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628244991"><span class="hs-identifier hs-var">cusk</span></a><span>
</span><a name="line-1249"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1628245022"><span class="hs-identifier hs-var">scoped</span></a><span>  </span><span class="hs-comment">-- don't default class tyvars</span><span>
</span><a name="line-1250"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1251"></a><span>                    </span><a href="TcUnify.html#unifyKind"><span class="hs-identifier hs-var">unifyKind</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1628245021"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-1252"></a><span>                                                    </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1628245021"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1253"></a><span>               </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1254"></a><span>
</span><a name="line-1255"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245021"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245022"><span class="hs-identifier hs-var">scoped</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1256"></a><span>
</span><a name="line-1257"></a><span class="hs-identifier">tcImplicitTKBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1258"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244559"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- vars are bound somewhere in the scope</span><span>
</span><a name="line-1259"></a><span>                                         </span><span class="hs-comment">-- see Note [Scope-check inferred kinds]</span><span>
</span><a name="line-1260"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628244559"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1261"></a><a name="tcImplicitTKBndrs"><a href="TcHsType.html#tcImplicitTKBndrs"><span class="hs-identifier">tcImplicitTKBndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcImplicitTKBndrsX"><span class="hs-identifier hs-var">tcImplicitTKBndrsX</span></a><span> </span><a href="TcHsType.html#tcHsTyVarName"><span class="hs-identifier hs-var">tcHsTyVarName</span></a><span>
</span><a name="line-1262"></a><span>
</span><a name="line-1263"></a><span class="hs-comment">-- | Convenient specialization</span><span>
</span><a name="line-1264"></a><span class="hs-identifier">tcImplicitTKBndrsType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1265"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1266"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1267"></a><a name="tcImplicitTKBndrsType"><a href="TcHsType.html#tcImplicitTKBndrsType"><span class="hs-identifier">tcImplicitTKBndrsType</span></a></a><span> </span><a name="local-1628245030"><a href="#local-1628245030"><span class="hs-identifier">var_ns</span></a></a><span> </span><a name="local-1628245031"><a href="#local-1628245031"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1268"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcImplicitTKBndrs"><span class="hs-identifier hs-var">tcImplicitTKBndrs</span></a><span> </span><a href="#local-1628245030"><span class="hs-identifier hs-var">var_ns</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1269"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245032"><a href="#local-1628245032"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628245031"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1270"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245032"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#allBoundVariables"><span class="hs-identifier hs-var">allBoundVariables</span></a><span> </span><a href="#local-1628245032"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1271"></a><span>
</span><a name="line-1272"></a><span class="hs-comment">-- this more general variant is needed in tcHsPatSigType.</span><span>
</span><a name="line-1273"></a><span class="hs-comment">-- See Note [Pattern signature binders]</span><span>
</span><a name="line-1274"></a><span class="hs-identifier">tcImplicitTKBndrsX</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- new_tv function</span><span>
</span><a name="line-1275"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1276"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244558"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span class="hs-special">)</span><span>
</span><a name="line-1277"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628244558"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1278"></a><span class="hs-comment">-- Returned TcTyVars have the supplied Names</span><span>
</span><a name="line-1279"></a><span class="hs-comment">--   i.e. no cloning of fresh names</span><span>
</span><a name="line-1280"></a><a name="tcImplicitTKBndrsX"><a href="TcHsType.html#tcImplicitTKBndrsX"><span class="hs-identifier">tcImplicitTKBndrsX</span></a></a><span> </span><a name="local-1628245033"><a href="#local-1628245033"><span class="hs-identifier">new_tv</span></a></a><span> </span><a name="local-1628245034"><a href="#local-1628245034"><span class="hs-identifier">var_ns</span></a></a><span> </span><a name="local-1628245035"><a href="#local-1628245035"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1281"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245036"><a href="#local-1628245036"><span class="hs-identifier">tkvs_pairs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628245033"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><a href="#local-1628245034"><span class="hs-identifier hs-var">var_ns</span></a><span>
</span><a name="line-1282"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245037"><a href="#local-1628245037"><span class="hs-identifier">must_scope_tkvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628245039"><span class="hs-identifier hs-var">tkv</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628245039"><a href="#local-1628245039"><span class="hs-identifier">tkv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628245036"><span class="hs-identifier hs-var">tkvs_pairs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1283"></a><span>             </span><a name="local-1628245038"><a href="#local-1628245038"><span class="hs-identifier">tkvs</span></a></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1628245036"><span class="hs-identifier hs-var">tkvs_pairs</span></a><span>
</span><a name="line-1284"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628245040"><a href="#local-1628245040"><span class="hs-identifier">result</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245041"><a href="#local-1628245041"><span class="hs-identifier">bound_tvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><a href="#local-1628245037"><span class="hs-identifier hs-var">must_scope_tkvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1285"></a><span>                                </span><a href="#local-1628245035"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1286"></a><span>
</span><a name="line-1287"></a><span>         </span><span class="hs-comment">-- it's possible that we guessed the ordering of variables</span><span>
</span><a name="line-1288"></a><span>         </span><span class="hs-comment">-- wrongly. Adjust.</span><span>
</span><a name="line-1289"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628245042"><a href="#local-1628245042"><span class="hs-identifier">tkvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a><span> </span><a href="#local-1628245038"><span class="hs-identifier hs-var">tkvs</span></a><span>
</span><a name="line-1290"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245043"><a href="#local-1628245043"><span class="hs-identifier">extra</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;NB: Implicitly-bound variables always come&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1291"></a><span>                     </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;before other ones.&quot;</span><span>
</span><a name="line-1292"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidInferredKinds"><span class="hs-identifier hs-var">checkValidInferredKinds</span></a><span> </span><a href="#local-1628245042"><span class="hs-identifier hs-var">tkvs</span></a><span> </span><a href="#local-1628245041"><span class="hs-identifier hs-var">bound_tvs</span></a><span> </span><a href="#local-1628245043"><span class="hs-identifier hs-var">extra</span></a><span>
</span><a name="line-1293"></a><span>
</span><a name="line-1294"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245044"><a href="#local-1628245044"><span class="hs-identifier">final_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#toposortTyVars"><span class="hs-identifier hs-var">toposortTyVars</span></a><span> </span><a href="#local-1628245042"><span class="hs-identifier hs-var">tkvs</span></a><span>
</span><a name="line-1295"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcImplicitTKBndrs&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245034"><span class="hs-identifier hs-var">var_ns</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245044"><span class="hs-identifier hs-var">final_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1296"></a><span>
</span><a name="line-1297"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245044"><span class="hs-identifier hs-var">final_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245040"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1298"></a><span>
</span><a name="line-1299"></a><span class="hs-identifier">tcExplicitTKBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1300"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244557"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1301"></a><span>                        </span><span class="hs-comment">-- ^ Thing inside returns the set of variables bound</span><span>
</span><a name="line-1302"></a><span>                        </span><span class="hs-comment">-- in the scope. See Note [Scope-check inferred kinds]</span><span>
</span><a name="line-1303"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628244557"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ returns augmented bound vars</span><span>
</span><a name="line-1304"></a><span class="hs-comment">-- No cloning: returned TyVars have the same Name as the incoming LHsTyVarBndrs</span><span>
</span><a name="line-1305"></a><a name="tcExplicitTKBndrs"><a href="TcHsType.html#tcExplicitTKBndrs"><span class="hs-identifier">tcExplicitTKBndrs</span></a></a><span> </span><a name="local-1628245045"><a href="#local-1628245045"><span class="hs-identifier">orig_hs_tvs</span></a></a><span> </span><a name="local-1628245046"><a href="#local-1628245046"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1306"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628245047"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628245045"><span class="hs-identifier hs-var">orig_hs_tvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628245054"><a href="#local-1628245054"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1307"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628245055"><a href="#local-1628245055"><span class="hs-identifier">result</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245056"><a href="#local-1628245056"><span class="hs-identifier">bound_tvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628245046"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-1628245054"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-1308"></a><span>
</span><a name="line-1309"></a><span>         </span><span class="hs-comment">-- Issue an error if the ordering is bogus.</span><span>
</span><a name="line-1310"></a><span>         </span><span class="hs-comment">-- See Note [Bad telescopes] in TcValidity.</span><span>
</span><a name="line-1311"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628245057"><a href="#local-1628245057"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcValidity.html#checkZonkValidTelescope"><span class="hs-identifier hs-var">checkZonkValidTelescope</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#interppSP"><span class="hs-identifier hs-var">interppSP</span></a><span> </span><a href="#local-1628245045"><span class="hs-identifier hs-var">orig_hs_tvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628245054"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1312"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidInferredKinds"><span class="hs-identifier hs-var">checkValidInferredKinds</span></a><span> </span><a href="#local-1628245057"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1628245056"><span class="hs-identifier hs-var">bound_tvs</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1313"></a><span>
</span><a name="line-1314"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcExplicitTKBndrs&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1315"></a><span>           </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Hs vars:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245045"><span class="hs-identifier hs-var">orig_hs_tvs</span></a><span>
</span><a name="line-1316"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;tvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier hs-var">pprTvBndr</span></a><span> </span><a href="#local-1628245057"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1317"></a><span>
</span><a name="line-1318"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245055"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245056"><span class="hs-identifier hs-var">bound_tvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="VarSet.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a><span> </span><a href="#local-1628245057"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1319"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1320"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1321"></a><span>    </span><a name="local-1628245047"><a href="#local-1628245047"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-1628245048"><a href="#local-1628245048"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628245048"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1322"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628245049"><a href="#local-1628245049"><span class="hs-identifier">hs_tv</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628245050"><a href="#local-1628245050"><span class="hs-identifier">hs_tvs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628245051"><a href="#local-1628245051"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-1323"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245052"><a href="#local-1628245052"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsTyVarBndr"><span class="hs-identifier hs-var">tcHsTyVarBndr</span></a><span> </span><a href="#local-1628245049"><span class="hs-identifier hs-var">hs_tv</span></a><span>
</span><a name="line-1324"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628245052"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1325"></a><span>             </span><a href="#local-1628245047"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628245050"><span class="hs-identifier hs-var">hs_tvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628245053"><a href="#local-1628245053"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1326"></a><span>             </span><a href="#local-1628245051"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245052"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245053"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1327"></a><span>
</span><a name="line-1328"></a><span class="hs-identifier">tcHsTyVarBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#HsTyVarBndr"><span class="hs-identifier hs-type">HsTyVarBndr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-1329"></a><span class="hs-comment">-- Return a SkolemTv TcTyVar, initialised with a kind variable.</span><span>
</span><a name="line-1330"></a><span class="hs-comment">-- Typically the Kind inside the HsTyVarBndr will be a tyvar</span><span>
</span><a name="line-1331"></a><span class="hs-comment">-- with a mutable kind in it.</span><span>
</span><a name="line-1332"></a><span class="hs-comment">-- NB: These variables must not be in scope. This function</span><span>
</span><a name="line-1333"></a><span class="hs-comment">-- is not appropriate for use with associated types, for example.</span><span>
</span><a name="line-1334"></a><span class="hs-comment">--</span><span>
</span><a name="line-1335"></a><span class="hs-comment">-- Returned TcTyVar has the same name; no cloning</span><span>
</span><a name="line-1336"></a><span class="hs-comment">--</span><span>
</span><a name="line-1337"></a><span class="hs-comment">-- See also Note [Associated type tyvar names] in Class</span><span>
</span><a name="line-1338"></a><a name="tcHsTyVarBndr"><a href="TcHsType.html#tcHsTyVarBndr"><span class="hs-identifier">tcHsTyVarBndr</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#UserTyVar"><span class="hs-identifier hs-var">UserTyVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628245058"><a href="#local-1628245058"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1339"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245059"><a href="#local-1628245059"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-1340"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-1628245058"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628245059"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1341"></a><span class="hs-identifier">tcHsTyVarBndr</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#KindedTyVar"><span class="hs-identifier hs-var">KindedTyVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628245060"><a href="#local-1628245060"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628245061"><a href="#local-1628245061"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1342"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245062"><a href="#local-1628245062"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcLHsKind"><span class="hs-identifier hs-var">tcLHsKind</span></a><span> </span><a href="#local-1628245061"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1343"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-1628245060"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628245062"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1344"></a><span>
</span><a name="line-1345"></a><span class="hs-comment">-- | Type-check a user-written TyVarBndr, which binds a variable</span><span>
</span><a name="line-1346"></a><span class="hs-comment">-- that might already be in scope (e.g., in an associated type declaration)</span><span>
</span><a name="line-1347"></a><span class="hs-comment">-- The second return value says whether the variable is in scope (True)</span><span>
</span><a name="line-1348"></a><span class="hs-comment">-- or not (False).</span><span>
</span><a name="line-1349"></a><span class="hs-identifier">tcHsTyVarBndr_Scoped</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#HsTyVarBndr"><span class="hs-identifier hs-type">HsTyVarBndr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-1350"></a><a name="tcHsTyVarBndr_Scoped"><a href="TcHsType.html#tcHsTyVarBndr_Scoped"><span class="hs-identifier">tcHsTyVarBndr_Scoped</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#UserTyVar"><span class="hs-identifier hs-var">UserTyVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628245063"><a href="#local-1628245063"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1351"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcHsTyVarName"><span class="hs-identifier hs-var">tcHsTyVarName</span></a><span> </span><a href="#local-1628245063"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1352"></a><span class="hs-identifier">tcHsTyVarBndr_Scoped</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#KindedTyVar"><span class="hs-identifier hs-var">KindedTyVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628245064"><a href="#local-1628245064"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628245065"><a href="#local-1628245065"><span class="hs-identifier">lhs_kind</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1353"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245066"><a href="#local-1628245066"><span class="hs-identifier">tv_pair</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1628245067"><a href="#local-1628245067"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsTyVarName"><span class="hs-identifier hs-var">tcHsTyVarName</span></a><span> </span><a href="#local-1628245064"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1354"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628245068"><a href="#local-1628245068"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcLHsKind"><span class="hs-identifier hs-var">tcLHsKind</span></a><span> </span><a href="#local-1628245065"><span class="hs-identifier hs-var">lhs_kind</span></a><span>
</span><a name="line-1355"></a><span>               </span><span class="hs-comment">-- for a scoped variable: make sure annotation is consistent</span><span>
</span><a name="line-1356"></a><span>               </span><span class="hs-comment">-- for an unscoped variable: unify the meta-tyvar kind</span><span>
</span><a name="line-1357"></a><span>               </span><span class="hs-comment">-- either way: we can ignore the resulting coercion</span><span>
</span><a name="line-1358"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcUnify.html#unifyKind"><span class="hs-identifier hs-var">unifyKind</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1628245067"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628245068"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1628245067"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1359"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628245066"><span class="hs-identifier hs-var">tv_pair</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1360"></a><span>
</span><a name="line-1361"></a><span class="hs-comment">-- | Produce a tyvar of the given name (with a meta-tyvar kind). If</span><span>
</span><a name="line-1362"></a><span class="hs-comment">-- the name is already in scope, return the scoped variable. The</span><span>
</span><a name="line-1363"></a><span class="hs-comment">-- second return value says whether the variable is in scope (True)</span><span>
</span><a name="line-1364"></a><span class="hs-comment">-- or not (False). (Use this for associated types, for example.)</span><span>
</span><a name="line-1365"></a><span class="hs-identifier">tcHsTyVarName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-1366"></a><a name="tcHsTyVarName"><a href="TcHsType.html#tcHsTyVarName"><span class="hs-identifier">tcHsTyVarName</span></a></a><span> </span><a name="local-1628245069"><a href="#local-1628245069"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1367"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245070"><a href="#local-1628245070"><span class="hs-identifier">mb_tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupLcl_maybe"><span class="hs-identifier hs-var">tcLookupLcl_maybe</span></a><span> </span><a href="#local-1628245069"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1368"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628245070"><span class="hs-identifier hs-var">mb_tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1369"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ATyVar"><span class="hs-identifier hs-var">ATyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628245071"><a href="#local-1628245071"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245071"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1370"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245072"><a href="#local-1628245072"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-1371"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-1628245069"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628245072"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="TcType.html#vanillaSkolemTv"><span class="hs-identifier hs-var">vanillaSkolemTv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1372"></a><span>
</span><a name="line-1373"></a><span class="hs-comment">-- makes a new skolem tv</span><span>
</span><a name="line-1374"></a><span class="hs-identifier">new_skolem_tv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-1375"></a><a name="new_skolem_tv"><a href="TcHsType.html#new_skolem_tv"><span class="hs-identifier">new_skolem_tv</span></a></a><span> </span><a name="local-1628245073"><a href="#local-1628245073"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1628245074"><a href="#local-1628245074"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-1628245073"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-1628245074"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="TcType.html#vanillaSkolemTv"><span class="hs-identifier hs-var">vanillaSkolemTv</span></a><span>
</span><a name="line-1376"></a><span>
</span><a name="line-1377"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-1378"></a><span class="hs-identifier">kindGeneralizeType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1379"></a><span class="hs-comment">-- Result is zonked</span><span>
</span><a name="line-1380"></a><a name="kindGeneralizeType"><a href="TcHsType.html#kindGeneralizeType"><span class="hs-identifier">kindGeneralizeType</span></a></a><span> </span><a name="local-1628245075"><a href="#local-1628245075"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1381"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245076"><a href="#local-1628245076"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#kindGeneralize"><span class="hs-identifier hs-var">kindGeneralize</span></a><span> </span><a href="#local-1628245075"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1382"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkInvForAllTys"><span class="hs-identifier hs-var">mkInvForAllTys</span></a><span> </span><a href="#local-1628245076"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-1628245075"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1383"></a><span>
</span><a name="line-1384"></a><span class="hs-identifier">kindGeneralize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="Var.html#KindVar"><span class="hs-identifier hs-type">KindVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-1385"></a><a name="kindGeneralize"><a href="TcHsType.html#kindGeneralize"><span class="hs-identifier">kindGeneralize</span></a></a><span> </span><a name="local-1628245077"><a href="#local-1628245077"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1386"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245078"><a href="#local-1628245078"><span class="hs-identifier">gbl_tvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#tcGetGlobalTyCoVars"><span class="hs-identifier hs-var">tcGetGlobalTyCoVars</span></a><span> </span><span class="hs-comment">-- Already zonked</span><span>
</span><a name="line-1387"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628245079"><a href="#local-1628245079"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcTypeAndFV"><span class="hs-identifier hs-var">zonkTcTypeAndFV</span></a><span> </span><a href="#local-1628245077"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1388"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#quantifyTyVars"><span class="hs-identifier hs-var">quantifyTyVars</span></a><span> </span><a href="#local-1628245078"><span class="hs-identifier hs-var">gbl_tvs</span></a><span> </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-1628245079"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1389"></a><span>
</span><a name="line-1390"></a><span class="hs-comment">{-
Note [Kind generalisation]
~~~~~~~~~~~~~~~~~~~~~~~~~~
We do kind generalisation only at the outer level of a type signature.
For example, consider
  T :: forall k. k -&gt; *
  f :: (forall a. T a -&gt; Int) -&gt; Int
When kind-checking f's type signature we generalise the kind at
the outermost level, thus:
  f1 :: forall k. (forall (a:k). T k a -&gt; Int) -&gt; Int  -- YES!
and *not* at the inner forall:
  f2 :: (forall k. forall (a:k). T k a -&gt; Int) -&gt; Int  -- NO!
Reason: same as for HM inference on value level declarations,
we want to infer the most general type.  The f2 type signature
would be *less applicable* than f1, because it requires a more
polymorphic argument.

NB: There are no explicit kind variables written in f's signature.
When there are, the renamer adds these kind variables to the list of
variables bound by the forall, so you can indeed have a type that's
higher-rank in its kind. But only by explicit request.

Note [Kinds of quantified type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tcTyVarBndrsGen quantifies over a specified list of type variables,
*and* over the kind variables mentioned in the kinds of those tyvars.

Note that we must zonk those kinds (obviously) but less obviously, we
must return type variables whose kinds are zonked too. Example
    (a :: k7)  where  k7 := k9 -&gt; k9
We must return
    [k9, a:k9-&gt;k9]
and NOT
    [k9, a:k7]
Reason: we're going to turn this into a for-all type,
   forall k9. forall (a:k7). blah
which the type checker will then instantiate, and instantiate does not
look through unification variables!

Hence using zonked_kinds when forming tvs'.

Note [Typechecking telescopes]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The function tcTyClTyVars has to bind the scoped type and kind
variables in a telescope. For example:

class Foo k (t :: Proxy k -&gt; k2) where ...

By the time [kt]cTyClTyVars is called, we know *something* about the kind of Foo,
at least that it has the form

  Foo :: forall (k2 :: mk2). forall (k :: mk1) -&gt; (Proxy mk1 k -&gt; k2) -&gt; Constraint

if it has a CUSK (Foo does not, in point of fact) or

  Foo :: forall (k :: mk1) -&gt; (Proxy mk1 k -&gt; k2) -&gt; Constraint

if it does not, where mk1 and mk2 are meta-kind variables (mk1, mk2 :: *).

When calling tcTyClTyVars, this kind is further generalized w.r.t. any
free variables appearing in mk1 or mk2. So, mk_tvs must handle
that possibility. Perhaps we discover that mk1 := Maybe k3 and mk2 := *,
so we have

Foo :: forall (k3 :: *). forall (k2 :: *). forall (k :: Maybe k3) -&gt;
       (Proxy (Maybe k3) k -&gt; k2) -&gt; Constraint

We now have several sorts of variables to think about:
1) The variable k3 is not mentioned in the source at all. It is neither
   explicitly bound nor ever used. It is *not* a scoped kind variable,
   and should not be bound when type-checking the scope of the telescope.

2) The variable k2 is mentioned in the source, but it is not explicitly
   bound. It *is* a scoped kind variable, and will appear in the
   hsq_implicit field of a LHsTyVarBndrs.

   2a) In the non-CUSK case, these variables won't have been generalized
       yet and don't appear in the looked-up kind. So we just return these
       in a NameSet.

3) The variable k is mentioned in the source with an explicit binding.
   It *is* a scoped type variable, and will appear in the
   hsq_explicit field of a LHsTyVarBndrs.

4) The variable t is bound in the source, but it is never mentioned later
   in the kind. It *is* a scoped variable (it can appear in the telescope
   scope, even though it is non-dependent), and will appear in the
   hsq_explicit field of a LHsTyVarBndrs.

splitTelescopeTvs walks through the output of a splitPiTys on the
telescope head's kind (Foo, in our example), creating a list of tyvars
to be bound within the telescope scope. It must simultaneously walk
through the hsq_implicit and hsq_explicit fields of a LHsTyVarBndrs.
Comments in the code refer back to the cases in this Note.

Cases (1) and (2) can be mixed together, but these cases must appear before
cases (3) and (4) (the implicitly bound vars always precede the explicitly
bound ones). So, we handle the lists in two stages (mk_tvs and
mk_tvs2).

As a further wrinkle, it's possible that the variables in case (2) have
been reordered. This is because hsq_implicit is ordered by the renamer,
but there may be dependency among the variables. Of course, the order in
the kind must take dependency into account. So we use a NameSet to keep
these straightened out.

Note [Free-floating kind vars]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  data T = MkT (forall (a :: k). Proxy a)
  -- from test ghci/scripts/T7873

This is not an existential datatype, but a higher-rank one. Note that
the forall to the right of MkT. Also consider

  data S a = MkS (Proxy (a :: k))

According to the rules around implicitly-bound kind variables, those
k's scope over the whole declarations. The renamer grabs it and adds it
to the hsq_implicits field of the HsQTyVars of the tycon. So it must
be in scope during type-checking, but we want to reject T while accepting
S.

Why reject T? Because the kind variable isn't fixed by anything. For
a variable like k to be implicit, it needs to be mentioned in the kind
of a tycon tyvar. But it isn't.

Why accept S? Because kind inference tells us that a has kind k, so it's
all OK.

Here's the approach: in the first pass (&quot;kind-checking&quot;) we just bring
k into scope. In the second pass, we certainly hope that k has been
integrated into the type's (generalized) kind, and so it should be found
by splitTelescopeTvs. If it's not, then we must have a definition like
T, and we reject. (But see Note [Tiresome kind checking] about some extra
processing necessary in the second pass.)

Note [Tiresome kind matching]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Because of the use of SigTvs in kind inference (see #11203, for example)
sometimes kind variables come into tcTClTyVars (the second, desugaring
pass in TcTyClDecls) with the wrong names. The best way to fix this up
is just to unify the kinds, again. So we return HsKind/Kind pairs from
splitTelescopeTvs that can get unified in tcTyClTyVars, but only if there
are kind vars the didn't link up in splitTelescopeTvs.

-}</span><span>
</span><a name="line-1538"></a><span>
</span><a name="line-1539"></a><span class="hs-comment">--------------------</span><span>
</span><a name="line-1540"></a><span class="hs-comment">-- getInitialKind has made a suitably-shaped kind for the type or class</span><span>
</span><a name="line-1541"></a><span class="hs-comment">-- Unpack it, and attribute those kinds to the type variables</span><span>
</span><a name="line-1542"></a><span class="hs-comment">-- Extend the env with bindings for the tyvars, taken from</span><span>
</span><a name="line-1543"></a><span class="hs-comment">-- the kind of the tycon/class.  Give it to the thing inside, and</span><span>
</span><a name="line-1544"></a><span class="hs-comment">-- check the result kind matches</span><span>
</span><a name="line-1545"></a><span class="hs-identifier">kcLookupKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1546"></a><a name="kcLookupKind"><a href="TcHsType.html#kcLookupKind"><span class="hs-identifier">kcLookupKind</span></a></a><span> </span><a name="local-1628245080"><a href="#local-1628245080"><span class="hs-identifier">nm</span></a></a><span>
</span><a name="line-1547"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245081"><a href="#local-1628245081"><span class="hs-identifier">tc_ty_thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookup"><span class="hs-identifier hs-var">tcLookup</span></a><span> </span><a href="#local-1628245080"><span class="hs-identifier hs-var">nm</span></a><span>
</span><a name="line-1548"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628245081"><span class="hs-identifier hs-var">tc_ty_thing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1549"></a><span>           </span><a href="TcRnTypes.html#ATcTyCon"><span class="hs-identifier hs-var">ATcTyCon</span></a><span> </span><a name="local-1628245082"><a href="#local-1628245082"><span class="hs-identifier">tc</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConBinders</span><span> </span><a href="#local-1628245082"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tyConResKind</span><span> </span><a href="#local-1628245082"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1550"></a><span>           </span><a href="TcRnTypes.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-1628245083"><a href="#local-1628245083"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConBinders</span><span> </span><a href="#local-1628245083"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tyConResKind</span><span> </span><a href="#local-1628245083"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1551"></a><span>           </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;kcLookupKind&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245081"><span class="hs-identifier hs-var">tc_ty_thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1552"></a><span>
</span><a name="line-1553"></a><span class="hs-comment">-- See Note [Typechecking telescopes]</span><span>
</span><a name="line-1554"></a><span class="hs-identifier">splitTelescopeTvs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- telescope binders</span><span>
</span><a name="line-1555"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-1556"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- scoped type variables</span><span>
</span><a name="line-1557"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>    </span><span class="hs-comment">-- ungeneralized implicit variables (case 2a)</span><span>
</span><a name="line-1558"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- implicit type variables (cases 1 &amp; 2)</span><span>
</span><a name="line-1559"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- explicit type variables (cases 3 &amp; 4)</span><span>
</span><a name="line-1560"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsTypes.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- see Note [Tiresome kind matching]</span><span>
</span><a name="line-1561"></a><a name="splitTelescopeTvs"><a href="TcHsType.html#splitTelescopeTvs"><span class="hs-identifier">splitTelescopeTvs</span></a></a><span> </span><a name="local-1628245084"><a href="#local-1628245084"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-1628245085"><a href="#local-1628245085"><span class="hs-identifier">tvbs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsQTvs"><span class="hs-identifier hs-var">HsQTvs</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsq_implicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628245086"><a href="#local-1628245086"><span class="hs-identifier">hs_kvs</span></a></a><span>
</span><a name="line-1562"></a><span>                                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsq_explicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628245087"><a href="#local-1628245087"><span class="hs-identifier">hs_tvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1563"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628245125"><a href="#local-1628245125"><span class="hs-identifier">scoped_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245126"><a href="#local-1628245126"><span class="hs-identifier">non_cusk_imp_names</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245127"><a href="#local-1628245127"><span class="hs-identifier">imp_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245128"><a href="#local-1628245128"><span class="hs-identifier">exp_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245129"><a href="#local-1628245129"><span class="hs-identifier">kind_matches</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1564"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628245088"><span class="hs-identifier hs-var">mk_tvs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1628245084"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-special">(</span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-1628245086"><span class="hs-identifier hs-var">hs_kvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628245087"><span class="hs-identifier hs-var">hs_tvs</span></a><span>
</span><a name="line-1565"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-1566"></a><span>    </span><span class="hs-special">(</span><a href="#local-1628245125"><span class="hs-identifier hs-var">scoped_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245126"><span class="hs-identifier hs-var">non_cusk_imp_names</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245127"><span class="hs-identifier hs-var">imp_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245128"><span class="hs-identifier hs-var">exp_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245129"><span class="hs-identifier hs-var">kind_matches</span></a><span class="hs-special">)</span><span>
</span><a name="line-1567"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1568"></a><span>    </span><span class="hs-identifier">mk_tvs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- scoped tv accum (reversed)</span><span>
</span><a name="line-1569"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- implicit tv accum (reversed)</span><span>
</span><a name="line-1570"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>
</span><a name="line-1571"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>             </span><span class="hs-comment">-- implicit variables</span><span>
</span><a name="line-1572"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- explicit variables</span><span>
</span><a name="line-1573"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- the tyvars to be lexically bound</span><span>
</span><a name="line-1574"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>           </span><span class="hs-comment">-- Case 2a names</span><span>
</span><a name="line-1575"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- implicit tyvars</span><span>
</span><a name="line-1576"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- explicit tyvars</span><span>
</span><a name="line-1577"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsTypes.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- tiresome kind matches</span><span>
</span><a name="line-1578"></a><span>    </span><a name="local-1628245088"><a href="#local-1628245088"><span class="hs-identifier">mk_tvs</span></a></a><span> </span><a name="local-1628245090"><a href="#local-1628245090"><span class="hs-identifier">scoped_tv_acc</span></a></a><span> </span><a name="local-1628245091"><a href="#local-1628245091"><span class="hs-identifier">imp_tv_acc</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628245092"><a href="#local-1628245092"><span class="hs-identifier">bndr</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628245093"><a href="#local-1628245093"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628245094"><a href="#local-1628245094"><span class="hs-identifier">all_hs_kvs</span></a></a><span> </span><a name="local-1628245095"><a href="#local-1628245095"><span class="hs-identifier">all_hs_tvs</span></a></a><span>
</span><a name="line-1579"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628245096"><a href="#local-1628245096"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#binderVar_maybe"><span class="hs-identifier hs-var">binderVar_maybe</span></a><span> </span><a href="#local-1628245092"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-1580"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isInvisibleBinder"><span class="hs-identifier hs-var">isInvisibleBinder</span></a><span> </span><a href="#local-1628245092"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-1581"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245097"><a href="#local-1628245097"><span class="hs-identifier">tv_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-1628245096"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1582"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-1628245097"><span class="hs-identifier hs-var">tv_name</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628245094"><span class="hs-identifier hs-var">all_hs_kvs</span></a><span>
</span><a name="line-1583"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628245088"><span class="hs-identifier hs-var">mk_tvs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245096"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245090"><span class="hs-identifier hs-var">scoped_tv_acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628245096"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245091"><span class="hs-identifier hs-var">imp_tv_acc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1584"></a><span>               </span><a href="#local-1628245093"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245094"><span class="hs-identifier hs-var">all_hs_kvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#delFromNameSet"><span class="hs-identifier hs-var">delFromNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628245097"><span class="hs-identifier hs-var">tv_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628245095"><span class="hs-identifier hs-var">all_hs_tvs</span></a><span>      </span><span class="hs-comment">-- Case (2)</span><span>
</span><a name="line-1585"></a><span>
</span><a name="line-1586"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628245098"><a href="#local-1628245098"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#binderVar_maybe"><span class="hs-identifier hs-var">binderVar_maybe</span></a><span> </span><a href="#local-1628245092"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-1587"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isInvisibleBinder"><span class="hs-identifier hs-var">isInvisibleBinder</span></a><span> </span><a href="#local-1628245092"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-1588"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628245088"><span class="hs-identifier hs-var">mk_tvs</span></a><span> </span><a href="#local-1628245090"><span class="hs-identifier hs-var">scoped_tv_acc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245098"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245091"><span class="hs-identifier hs-var">imp_tv_acc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1589"></a><span>               </span><a href="#local-1628245093"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-1628245094"><span class="hs-identifier hs-var">all_hs_kvs</span></a><span> </span><a href="#local-1628245095"><span class="hs-identifier hs-var">all_hs_tvs</span></a><span>  </span><span class="hs-comment">-- Case (1)</span><span>
</span><a name="line-1590"></a><span>
</span><a name="line-1591"></a><span>     </span><span class="hs-comment">-- there may actually still be some hs_kvs, if we're kind checking</span><span>
</span><a name="line-1592"></a><span>     </span><span class="hs-comment">-- a non-CUSK. The kinds *aren't* generalized, so we won't see them</span><span>
</span><a name="line-1593"></a><span>     </span><span class="hs-comment">-- here.</span><span>
</span><a name="line-1594"></a><span>    </span><span class="hs-identifier">mk_tvs</span><span> </span><a name="local-1628245099"><a href="#local-1628245099"><span class="hs-identifier">scoped_tv_acc</span></a></a><span> </span><a name="local-1628245100"><a href="#local-1628245100"><span class="hs-identifier">imp_tv_acc</span></a></a><span> </span><a name="local-1628245101"><a href="#local-1628245101"><span class="hs-identifier">all_bndrs</span></a></a><span> </span><a name="local-1628245102"><a href="#local-1628245102"><span class="hs-identifier">all_hs_kvs</span></a></a><span> </span><a name="local-1628245103"><a href="#local-1628245103"><span class="hs-identifier">all_hs_tvs</span></a></a><span>
</span><a name="line-1595"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628245104"><a href="#local-1628245104"><span class="hs-identifier">scoped</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245105"><a href="#local-1628245105"><span class="hs-identifier">exp_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245106"><a href="#local-1628245106"><span class="hs-identifier">kind_matches</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1596"></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628245089"><span class="hs-identifier hs-var">mk_tvs2</span></a><span> </span><a href="#local-1628245099"><span class="hs-identifier hs-var">scoped_tv_acc</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1628245101"><span class="hs-identifier hs-var">all_bndrs</span></a><span> </span><a href="#local-1628245103"><span class="hs-identifier hs-var">all_hs_tvs</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1597"></a><span>        </span><span class="hs-special">(</span><a href="#local-1628245104"><span class="hs-identifier hs-var">scoped</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245102"><span class="hs-identifier hs-var">all_hs_kvs</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1628245100"><span class="hs-identifier hs-var">imp_tv_acc</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245105"><span class="hs-identifier hs-var">exp_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245106"><span class="hs-identifier hs-var">kind_matches</span></a><span class="hs-special">)</span><span>
</span><a name="line-1598"></a><span>           </span><span class="hs-comment">-- no more Case (1) or (2)</span><span>
</span><a name="line-1599"></a><span>
</span><a name="line-1600"></a><span>    </span><span class="hs-comment">-- This can't handle Case (1) or Case (2) from [Typechecking telescopes]</span><span>
</span><a name="line-1601"></a><span>    </span><span class="hs-identifier">mk_tvs2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-1602"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- new parameter: explicit tv accum (reversed)</span><span>
</span><a name="line-1603"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsTypes.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- tiresome kind matches accum</span><span>
</span><a name="line-1604"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>
</span><a name="line-1605"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1606"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-1607"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- explicit tvs only</span><span>
</span><a name="line-1608"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsTypes.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- tiresome kind matches</span><span>
</span><a name="line-1609"></a><span>    </span><a name="local-1628245089"><a href="#local-1628245089"><span class="hs-identifier">mk_tvs2</span></a></a><span> </span><a name="local-1628245107"><a href="#local-1628245107"><span class="hs-identifier">scoped_tv_acc</span></a></a><span> </span><a name="local-1628245108"><a href="#local-1628245108"><span class="hs-identifier">exp_tv_acc</span></a></a><span> </span><a name="local-1628245109"><a href="#local-1628245109"><span class="hs-identifier">kind_match_acc</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628245110"><a href="#local-1628245110"><span class="hs-identifier">bndr</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628245111"><a href="#local-1628245111"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1628245112"><a href="#local-1628245112"><span class="hs-identifier">hs_tv</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628245113"><a href="#local-1628245113"><span class="hs-identifier">hs_tvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1610"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628245118"><a href="#local-1628245118"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#binderVar_maybe"><span class="hs-identifier hs-var">binderVar_maybe</span></a><span> </span><a href="#local-1628245110"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-1611"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isVisibleBinder</span><span> </span><a href="TyCoRep.html#isVisibleBinder"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">err_doc</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1612"></a><span>        </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">getName</span><span> </span><span class="hs-identifier hs-var">tv</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">hsLTyVarName</span><span> </span><span class="hs-identifier">hs_tv</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1613"></a><span>        </span><a href="#local-1628245089"><span class="hs-identifier hs-var">mk_tvs2</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245118"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245107"><span class="hs-identifier hs-var">scoped_tv_acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628245118"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245108"><span class="hs-identifier hs-var">exp_tv_acc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628245115"><span class="hs-identifier hs-var">kind_match_acc'</span></a><span> </span><a href="#local-1628245111"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-1628245113"><span class="hs-identifier hs-var">hs_tvs</span></a><span>
</span><a name="line-1614"></a><span>            </span><span class="hs-comment">-- Case (3)</span><span>
</span><a name="line-1615"></a><span>
</span><a name="line-1616"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1617"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isVisibleBinder</span><span> </span><a href="TyCoRep.html#isVisibleBinder"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1618"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245119"><a href="#local-1628245119"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkTyVar"><span class="hs-identifier hs-var">mkTyVar</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsLTyVarName"><span class="hs-identifier hs-var">hsLTyVarName</span></a><span> </span><a href="#local-1628245112"><span class="hs-identifier hs-var">hs_tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#binderType"><span class="hs-identifier hs-var">binderType</span></a><span> </span><a href="#local-1628245110"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1619"></a><span>        </span><a href="#local-1628245089"><span class="hs-identifier hs-var">mk_tvs2</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245119"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245107"><span class="hs-identifier hs-var">scoped_tv_acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628245119"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245108"><span class="hs-identifier hs-var">exp_tv_acc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628245115"><span class="hs-identifier hs-var">kind_match_acc'</span></a><span> </span><a href="#local-1628245111"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-1628245113"><span class="hs-identifier hs-var">hs_tvs</span></a><span>
</span><a name="line-1620"></a><span>               </span><span class="hs-comment">-- Case (4)</span><span>
</span><a name="line-1621"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1622"></a><span>        </span><a name="local-1628245114"><a href="#local-1628245114"><span class="hs-identifier">err_doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245110"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245111"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1623"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245112"><span class="hs-identifier hs-var">hs_tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245113"><span class="hs-identifier hs-var">hs_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1624"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245085"><span class="hs-identifier hs-var">tvbs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1625"></a><span>
</span><a name="line-1626"></a><span>        </span><a name="local-1628245115"><a href="#local-1628245115"><span class="hs-identifier">kind_match_acc'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628245112"><span class="hs-identifier hs-var">hs_tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1627"></a><span>          </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#UserTyVar"><span class="hs-identifier hs-var">UserTyVar</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628245109"><span class="hs-identifier hs-var">kind_match_acc</span></a><span>
</span><a name="line-1628"></a><span>          </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#KindedTyVar"><span class="hs-identifier hs-var">KindedTyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628245116"><a href="#local-1628245116"><span class="hs-identifier">hs_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1628245116"><span class="hs-identifier hs-var">hs_kind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245117"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628245109"><span class="hs-identifier hs-var">kind_match_acc</span></a><span>
</span><a name="line-1629"></a><span>            </span><span class="hs-keyword">where</span><span> </span><a name="local-1628245117"><a href="#local-1628245117"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#binderType"><span class="hs-identifier hs-var">binderType</span></a><span> </span><a href="#local-1628245110"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-1630"></a><span>
</span><a name="line-1631"></a><span>    </span><span class="hs-identifier">mk_tvs2</span><span> </span><a name="local-1628245120"><a href="#local-1628245120"><span class="hs-identifier">scoped_tv_acc</span></a></a><span> </span><a name="local-1628245121"><a href="#local-1628245121"><span class="hs-identifier">exp_tv_acc</span></a></a><span> </span><a name="local-1628245122"><a href="#local-1628245122"><span class="hs-identifier">kind_match_acc</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- All done!</span><span>
</span><a name="line-1632"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1628245120"><span class="hs-identifier hs-var">scoped_tv_acc</span></a><span>
</span><a name="line-1633"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1628245121"><span class="hs-identifier hs-var">exp_tv_acc</span></a><span>
</span><a name="line-1634"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-1628245122"><span class="hs-identifier hs-var">kind_match_acc</span></a><span> </span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- no need to reverse; it's not ordered</span><span>
</span><a name="line-1635"></a><span>
</span><a name="line-1636"></a><span>    </span><span class="hs-identifier">mk_tvs2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628245123"><a href="#local-1628245123"><span class="hs-identifier">all_bndrs</span></a></a><span> </span><a name="local-1628245124"><a href="#local-1628245124"><span class="hs-identifier">all_hs_tvs</span></a></a><span>
</span><a name="line-1637"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;splitTelescopeTvs 2&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245123"><span class="hs-identifier hs-var">all_bndrs</span></a><span>
</span><a name="line-1638"></a><span>                                             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245124"><span class="hs-identifier hs-var">all_hs_tvs</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1639"></a><span>
</span><a name="line-1640"></a><span>
</span><a name="line-1641"></a><span class="hs-comment">-----------------------</span><span>
</span><a name="line-1642"></a><span class="hs-comment">-- | &quot;Kind check&quot; the tyvars to a tycon. This is used during the &quot;kind-checking&quot;</span><span>
</span><a name="line-1643"></a><span class="hs-comment">-- pass in TcTyClsDecls. (Never in getInitialKind, never in the</span><span>
</span><a name="line-1644"></a><span class="hs-comment">-- &quot;type-checking&quot;/desugaring pass.) It works only for LHsQTyVars associated</span><span>
</span><a name="line-1645"></a><span class="hs-comment">-- with a tycon, whose kind is known (partially) via getInitialKinds.</span><span>
</span><a name="line-1646"></a><span class="hs-comment">-- Never emits constraints, though the thing_inside might.</span><span>
</span><a name="line-1647"></a><span class="hs-identifier">kcTyClTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>   </span><span class="hs-comment">-- ^ of the tycon</span><span>
</span><a name="line-1648"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-1649"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244556"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244556"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1650"></a><a name="kcTyClTyVars"><a href="TcHsType.html#kcTyClTyVars"><span class="hs-identifier">kcTyClTyVars</span></a></a><span> </span><a name="local-1628245130"><a href="#local-1628245130"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-1628245131"><a href="#local-1628245131"><span class="hs-identifier">hs_tvs</span></a></a><span> </span><a name="local-1628245132"><a href="#local-1628245132"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1651"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628245133"><a href="#local-1628245133"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245134"><a href="#local-1628245134"><span class="hs-identifier">res_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#kcLookupKind"><span class="hs-identifier hs-var">kcLookupKind</span></a><span> </span><a href="#local-1628245130"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1652"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628245135"><a href="#local-1628245135"><span class="hs-identifier">scoped_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245136"><a href="#local-1628245136"><span class="hs-identifier">non_cusk_kv_name_set</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245137"><a href="#local-1628245137"><span class="hs-identifier">all_kvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245138"><a href="#local-1628245138"><span class="hs-identifier">all_tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1653"></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#splitTelescopeTvs"><span class="hs-identifier hs-var">splitTelescopeTvs</span></a><span> </span><a href="#local-1628245133"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-1628245131"><span class="hs-identifier hs-var">hs_tvs</span></a><span>
</span><a name="line-1654"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;kcTyClTyVars splitTelescopeTvs:&quot;</span><span>
</span><a name="line-1655"></a><span>           </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Tycon:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245130"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1656"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Binders:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245133"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-1657"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;res_kind:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245134"><span class="hs-identifier hs-var">res_kind</span></a><span>
</span><a name="line-1658"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hs_tvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245131"><span class="hs-identifier hs-var">hs_tvs</span></a><span>
</span><a name="line-1659"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;scoped tvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier hs-var">pprTvBndr</span></a><span> </span><a href="#local-1628245135"><span class="hs-identifier hs-var">scoped_tvs</span></a><span>
</span><a name="line-1660"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;implicit tvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier hs-var">pprTvBndr</span></a><span> </span><a href="#local-1628245137"><span class="hs-identifier hs-var">all_kvs</span></a><span>
</span><a name="line-1661"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;explicit tvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier hs-var">pprTvBndr</span></a><span> </span><a href="#local-1628245138"><span class="hs-identifier hs-var">all_tvs</span></a><span>
</span><a name="line-1662"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;non-CUSK kvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245136"><span class="hs-identifier hs-var">non_cusk_kv_name_set</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1663"></a><span>
</span><a name="line-1664"></a><span>            </span><span class="hs-comment">-- need to look up the non-cusk kvs in order to get their</span><span>
</span><a name="line-1665"></a><span>            </span><span class="hs-comment">-- kinds right, in case the kinds were informed by</span><span>
</span><a name="line-1666"></a><span>            </span><span class="hs-comment">-- the getInitialKinds pass</span><span>
</span><a name="line-1667"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245139"><a href="#local-1628245139"><span class="hs-identifier">non_cusk_kv_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#nameSetElems"><span class="hs-identifier hs-var">nameSetElems</span></a><span> </span><a href="#local-1628245136"><span class="hs-identifier hs-var">non_cusk_kv_name_set</span></a><span>
</span><a name="line-1668"></a><span>             </span><a name="local-1628245140"><a href="#local-1628245140"><span class="hs-identifier">free_kvs</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1669"></a><span>                                 </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245137"><span class="hs-identifier hs-var">all_kvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628245138"><span class="hs-identifier hs-var">all_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1670"></a><span>             </span><a name="local-1628245141"><a href="#local-1628245141"><span class="hs-identifier">mk_kv</span></a></a><span> </span><a name="local-1628245142"><a href="#local-1628245142"><span class="hs-identifier">kv_name</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="VarSet.html#lookupVarSetByName"><span class="hs-identifier hs-var">lookupVarSetByName</span></a><span> </span><a href="#local-1628245140"><span class="hs-identifier hs-var">free_kvs</span></a><span> </span><a href="#local-1628245142"><span class="hs-identifier hs-var">kv_name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1671"></a><span>                                   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628245143"><a href="#local-1628245143"><span class="hs-identifier">kv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628245143"><span class="hs-identifier hs-var">kv</span></a><span>
</span><a name="line-1672"></a><span>                                   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1673"></a><span>                                     </span><span class="hs-comment">-- this kv isn't mentioned in the</span><span>
</span><a name="line-1674"></a><span>                                     </span><span class="hs-comment">-- LHsQTyVars at all. But maybe</span><span>
</span><a name="line-1675"></a><span>                                     </span><span class="hs-comment">-- it's mentioned in the body</span><span>
</span><a name="line-1676"></a><span>                                     </span><span class="hs-comment">-- In any case, just gin up a</span><span>
</span><a name="line-1677"></a><span>                                     </span><span class="hs-comment">-- meta-kind for it</span><span>
</span><a name="line-1678"></a><span>                                     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245144"><a href="#local-1628245144"><span class="hs-identifier">kv_kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-1679"></a><span>                                        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#new_skolem_tv"><span class="hs-identifier hs-var">new_skolem_tv</span></a><span> </span><a href="#local-1628245142"><span class="hs-identifier hs-var">kv_name</span></a><span> </span><a href="#local-1628245144"><span class="hs-identifier hs-var">kv_kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1680"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628245145"><a href="#local-1628245145"><span class="hs-identifier">non_cusk_kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628245141"><span class="hs-identifier hs-var">mk_kv</span></a><span> </span><a href="#local-1628245139"><span class="hs-identifier hs-var">non_cusk_kv_names</span></a><span>
</span><a name="line-1681"></a><span>
</span><a name="line-1682"></a><span>             </span><span class="hs-comment">-- The non_cusk_kvs are still scoped; they are mentioned by</span><span>
</span><a name="line-1683"></a><span>             </span><span class="hs-comment">-- name by the user</span><span>
</span><a name="line-1684"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245145"><span class="hs-identifier hs-var">non_cusk_kvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628245135"><span class="hs-identifier hs-var">scoped_tvs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1685"></a><span>         </span><a href="#local-1628245132"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1686"></a><span>
</span><a name="line-1687"></a><span class="hs-identifier">tcTyClTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>      </span><span class="hs-comment">-- LHS of the type or class decl</span><span>
</span><a name="line-1688"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244555"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244555"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1689"></a><span class="hs-comment">-- ^ Used for the type variables of a type or class decl</span><span>
</span><a name="line-1690"></a><span class="hs-comment">-- on the second full pass (type-checking/desugaring) in TcTyClDecls.</span><span>
</span><a name="line-1691"></a><span class="hs-comment">-- This is *not* used in the initial-kind run, nor in the &quot;kind-checking&quot; pass.</span><span>
</span><a name="line-1692"></a><span class="hs-comment">--</span><span>
</span><a name="line-1693"></a><span class="hs-comment">-- (tcTyClTyVars T [a,b] thing_inside)</span><span>
</span><a name="line-1694"></a><span class="hs-comment">--   where T : forall k1 k2 (a:k1 -&gt; *) (b:k1). k2 -&gt; *</span><span>
</span><a name="line-1695"></a><span class="hs-comment">--   calls thing_inside with arguments</span><span>
</span><a name="line-1696"></a><span class="hs-comment">--      [k1,k2] [a,b] [k1:*, k2:*, a:k1 -&gt; *, b:k1] (k2 -&gt; *)</span><span>
</span><a name="line-1697"></a><span class="hs-comment">--   having also extended the type environment with bindings</span><span>
</span><a name="line-1698"></a><span class="hs-comment">--   for k1,k2,a,b</span><span>
</span><a name="line-1699"></a><span class="hs-comment">--</span><span>
</span><a name="line-1700"></a><span class="hs-comment">-- Never emits constraints.</span><span>
</span><a name="line-1701"></a><span class="hs-comment">--</span><span>
</span><a name="line-1702"></a><span class="hs-comment">-- The LHsTyVarBndrs is always user-written, and the full, generalised</span><span>
</span><a name="line-1703"></a><span class="hs-comment">-- kind of the tycon is available in the local env.</span><span>
</span><a name="line-1704"></a><a name="tcTyClTyVars"><a href="TcHsType.html#tcTyClTyVars"><span class="hs-identifier">tcTyClTyVars</span></a></a><span> </span><a name="local-1628245146"><a href="#local-1628245146"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-1628245147"><a href="#local-1628245147"><span class="hs-identifier">hs_tvs</span></a></a><span> </span><a name="local-1628245148"><a href="#local-1628245148"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1705"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628245166"><a href="#local-1628245166"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245167"><a href="#local-1628245167"><span class="hs-identifier">res_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#kcLookupKind"><span class="hs-identifier hs-var">kcLookupKind</span></a><span> </span><a href="#local-1628245146"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1706"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span> </span><a name="local-1628245168"><a href="#local-1628245168"><span class="hs-identifier">scoped_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245169"><a href="#local-1628245169"><span class="hs-identifier">float_kv_name_set</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245170"><a href="#local-1628245170"><span class="hs-identifier">all_kvs</span></a></a><span>
</span><a name="line-1707"></a><span>               </span><span class="hs-special">,</span><span> </span><a name="local-1628245171"><a href="#local-1628245171"><span class="hs-identifier">all_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245172"><a href="#local-1628245172"><span class="hs-identifier">kind_matches</span></a></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1708"></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#splitTelescopeTvs"><span class="hs-identifier hs-var">splitTelescopeTvs</span></a><span> </span><a href="#local-1628245166"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-1628245147"><span class="hs-identifier hs-var">hs_tvs</span></a><span>
</span><a name="line-1709"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcTyClTyVars splitTelescopeTvs:&quot;</span><span>
</span><a name="line-1710"></a><span>           </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Tycon:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245146"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1711"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Binders:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245166"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-1712"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;res_kind:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245167"><span class="hs-identifier hs-var">res_kind</span></a><span>
</span><a name="line-1713"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hs_tvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245147"><span class="hs-identifier hs-var">hs_tvs</span></a><span>
</span><a name="line-1714"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;scoped tvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier hs-var">pprTvBndr</span></a><span> </span><a href="#local-1628245168"><span class="hs-identifier hs-var">scoped_tvs</span></a><span>
</span><a name="line-1715"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;implicit tvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier hs-var">pprTvBndr</span></a><span> </span><a href="#local-1628245170"><span class="hs-identifier hs-var">all_kvs</span></a><span>
</span><a name="line-1716"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;explicit tvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier hs-var">pprTvBndr</span></a><span> </span><a href="#local-1628245171"><span class="hs-identifier hs-var">all_tvs</span></a><span>
</span><a name="line-1717"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;floating kvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245169"><span class="hs-identifier hs-var">float_kv_name_set</span></a><span>
</span><a name="line-1718"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Tiresome kind matches:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245172"><span class="hs-identifier hs-var">kind_matches</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1719"></a><span>
</span><a name="line-1720"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628245173"><a href="#local-1628245173"><span class="hs-identifier">float_kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628245149"><span class="hs-identifier hs-var">deal_with_float_kvs</span></a><span> </span><a href="#local-1628245169"><span class="hs-identifier hs-var">float_kv_name_set</span></a><span> </span><a href="#local-1628245172"><span class="hs-identifier hs-var">kind_matches</span></a><span>
</span><a name="line-1721"></a><span>                                          </span><a href="#local-1628245168"><span class="hs-identifier hs-var">scoped_tvs</span></a><span> </span><a href="#local-1628245171"><span class="hs-identifier hs-var">all_tvs</span></a><span>
</span><a name="line-1722"></a><span>
</span><a name="line-1723"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245173"><span class="hs-identifier hs-var">float_kvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628245168"><span class="hs-identifier hs-var">scoped_tvs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1724"></a><span>           </span><span class="hs-comment">-- the float_kvs are already in the all_kvs</span><span>
</span><a name="line-1725"></a><span>         </span><a href="#local-1628245148"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-1628245170"><span class="hs-identifier hs-var">all_kvs</span></a><span> </span><a href="#local-1628245171"><span class="hs-identifier hs-var">all_tvs</span></a><span> </span><a href="#local-1628245166"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-1628245167"><span class="hs-identifier hs-var">res_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1726"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1727"></a><span>         </span><span class="hs-comment">-- See Note [Free-floating kind vars]</span><span>
</span><a name="line-1728"></a><span>    </span><a name="local-1628245149"><a href="#local-1628245149"><span class="hs-identifier">deal_with_float_kvs</span></a></a><span> </span><a name="local-1628245151"><a href="#local-1628245151"><span class="hs-identifier">float_kv_name_set</span></a></a><span> </span><a name="local-1628245152"><a href="#local-1628245152"><span class="hs-identifier">kind_matches</span></a></a><span> </span><a name="local-1628245153"><a href="#local-1628245153"><span class="hs-identifier">scoped_tvs</span></a></a><span> </span><a name="local-1628245154"><a href="#local-1628245154"><span class="hs-identifier">all_tvs</span></a></a><span>
</span><a name="line-1729"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="NameSet.html#isEmptyNameSet"><span class="hs-identifier hs-var">isEmptyNameSet</span></a><span> </span><a href="#local-1628245151"><span class="hs-identifier hs-var">float_kv_name_set</span></a><span>
</span><a name="line-1730"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1731"></a><span>
</span><a name="line-1732"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1733"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- the floating kvs might just be renamed</span><span>
</span><a name="line-1734"></a><span>             </span><span class="hs-comment">-- see Note [Tiresome kind matching]</span><span>
</span><a name="line-1735"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245155"><a href="#local-1628245155"><span class="hs-identifier">float_kv_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#nameSetElems"><span class="hs-identifier hs-var">nameSetElems</span></a><span> </span><a href="#local-1628245151"><span class="hs-identifier hs-var">float_kv_name_set</span></a><span>
</span><a name="line-1736"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-1628245156"><a href="#local-1628245156"><span class="hs-identifier">float_kv_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628245155"><span class="hs-identifier hs-var">float_kv_names</span></a><span>
</span><a name="line-1737"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-1628245157"><a href="#local-1628245157"><span class="hs-identifier">float_kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><a href="TcMType.html#newSigTyVar"><span class="hs-identifier hs-var">newSigTyVar</span></a><span> </span><a href="#local-1628245155"><span class="hs-identifier hs-var">float_kv_names</span></a><span> </span><a href="#local-1628245156"><span class="hs-identifier hs-var">float_kv_kinds</span></a><span>
</span><a name="line-1738"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1739"></a><span>             </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245157"><span class="hs-identifier hs-var">float_kvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628245153"><span class="hs-identifier hs-var">scoped_tvs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1740"></a><span>             </span><a href="TcSimplify.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1741"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a><span> </span><a href="#local-1628245152"><span class="hs-identifier hs-var">kind_matches</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><a name="local-1628245158"><a href="#local-1628245158"><span class="hs-identifier">hs_kind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245159"><a href="#local-1628245159"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1742"></a><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245160"><a href="#local-1628245160"><span class="hs-identifier">tc_kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcLHsKind"><span class="hs-identifier hs-var">tcLHsKind</span></a><span> </span><a href="#local-1628245158"><span class="hs-identifier hs-var">hs_kind</span></a><span>
</span><a name="line-1743"></a><span>                </span><span class="hs-special">;</span><span> </span><a href="TcUnify.html#unifyKind"><span class="hs-identifier hs-var">unifyKind</span></a><span> </span><a href="TcUnify.html#noThing"><span class="hs-identifier hs-var">noThing</span></a><span> </span><a href="#local-1628245160"><span class="hs-identifier hs-var">tc_kind</span></a><span> </span><a href="#local-1628245159"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1744"></a><span>
</span><a name="line-1745"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-1628245161"><a href="#local-1628245161"><span class="hs-identifier">zonked_kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcType.html#tcGetTyVar"><span class="hs-identifier hs-var">tcGetTyVar</span></a><span> </span><span class="hs-string">&quot;tcTyClTyVars&quot;</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#%3C%3D%3C"><span class="hs-operator hs-var">&lt;=&lt;</span></a><span> </span><a href="TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-1746"></a><span>                                </span><a href="#local-1628245157"><span class="hs-identifier hs-var">float_kvs</span></a><span>
</span><a name="line-1747"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628245162"><a href="#local-1628245162"><span class="hs-identifier">still_sigs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245163"><a href="#local-1628245163"><span class="hs-identifier">matched_up</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span> </span><a href="TcType.html#isSigTyVar"><span class="hs-identifier hs-var">isSigTyVar</span></a><span> </span><a href="#local-1628245161"><span class="hs-identifier hs-var">zonked_kvs</span></a><span>
</span><a name="line-1748"></a><span>               </span><span class="hs-comment">-- the still_sigs didn't match with anything. They must be</span><span>
</span><a name="line-1749"></a><span>               </span><span class="hs-comment">-- &quot;free-floating&quot;, as in Note [Free-floating kind vars]</span><span>
</span><a name="line-1750"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245150"><span class="hs-identifier hs-var">report_floating_kv</span></a><span> </span><a href="#local-1628245154"><span class="hs-identifier hs-var">all_tvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628245162"><span class="hs-identifier hs-var">still_sigs</span></a><span>
</span><a name="line-1751"></a><span>
</span><a name="line-1752"></a><span>               </span><span class="hs-comment">-- the matched up kvs are proper scoped kvs.</span><span>
</span><a name="line-1753"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628245163"><span class="hs-identifier hs-var">matched_up</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1754"></a><span>
</span><a name="line-1755"></a><span>    </span><a name="local-1628245150"><a href="#local-1628245150"><span class="hs-identifier">report_floating_kv</span></a></a><span> </span><a name="local-1628245164"><a href="#local-1628245164"><span class="hs-identifier">all_tvs</span></a></a><span> </span><a name="local-1628245165"><a href="#local-1628245165"><span class="hs-identifier">kv</span></a></a><span>
</span><a name="line-1756"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1757"></a><span>        </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Kind variable&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245165"><span class="hs-identifier hs-var">kv</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1758"></a><span>               </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is implicitly bound in datatype&quot;</span><span>
</span><a name="line-1759"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245146"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1760"></a><span>               </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;but does not appear as the kind of any&quot;</span><span>
</span><a name="line-1761"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;of its type variables. Perhaps you meant&quot;</span><span>
</span><a name="line-1762"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;to bind it (with TypeInType) explicitly somewhere?&quot;</span><span>
</span><a name="line-1763"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628245164"><span class="hs-identifier hs-var">all_tvs</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-1764"></a><span>               </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type variables with inferred kinds:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1765"></a><span>                  </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#pprTvBndrs"><span class="hs-identifier hs-var">pprTvBndrs</span></a><span> </span><a href="#local-1628245164"><span class="hs-identifier hs-var">all_tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1766"></a><span>
</span><a name="line-1767"></a><span class="hs-comment">-----------------------------------</span><span>
</span><a name="line-1768"></a><span class="hs-identifier">tcDataKindSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1769"></a><span class="hs-comment">-- GADT decls can have a (perhaps partial) kind signature</span><span>
</span><a name="line-1770"></a><span class="hs-comment">--      e.g.  data T :: * -&gt; * -&gt; * where ...</span><span>
</span><a name="line-1771"></a><span class="hs-comment">-- This function makes up suitable (kinded) type variables for</span><span>
</span><a name="line-1772"></a><span class="hs-comment">-- the argument kinds, and checks that the result kind is indeed *.</span><span>
</span><a name="line-1773"></a><span class="hs-comment">-- We use it also to make up argument type variables for for data instances.</span><span>
</span><a name="line-1774"></a><span class="hs-comment">-- Never emits constraints.</span><span>
</span><a name="line-1775"></a><span class="hs-comment">-- Returns the new TyVars, the extracted TyBinders, and the new, reduced</span><span>
</span><a name="line-1776"></a><span class="hs-comment">-- result kind (which should always be Type or a synonym thereof)</span><span>
</span><a name="line-1777"></a><a name="tcDataKindSig"><a href="TcHsType.html#tcDataKindSig"><span class="hs-identifier">tcDataKindSig</span></a></a><span> </span><a name="local-1628245174"><a href="#local-1628245174"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-1778"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#isLiftedTypeKind"><span class="hs-identifier hs-var">isLiftedTypeKind</span></a><span> </span><a href="#local-1628245176"><span class="hs-identifier hs-var">res_kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcHsType.html#badKindSig"><span class="hs-identifier hs-var">badKindSig</span></a><span> </span><a href="#local-1628245174"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1779"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628245183"><a href="#local-1628245183"><span class="hs-identifier">span</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-1780"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628245184"><a href="#local-1628245184"><span class="hs-identifier">us</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a><span>
</span><a name="line-1781"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628245185"><a href="#local-1628245185"><span class="hs-identifier">rdr_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a><span>
</span><a name="line-1782"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245186"><a href="#local-1628245186"><span class="hs-identifier">uniqs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#uniqsFromSupply"><span class="hs-identifier hs-var">uniqsFromSupply</span></a><span> </span><a href="#local-1628245184"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-1783"></a><span>              </span><a name="local-1628245187"><a href="#local-1628245187"><span class="hs-identifier">occs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628245189"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628245188"><a href="#local-1628245188"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelNames.html#allNameStrings"><span class="hs-identifier hs-var">allNameStrings</span></a><span>
</span><a name="line-1784"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245189"><a href="#local-1628245189"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#mkOccName"><span class="hs-identifier hs-var">mkOccName</span></a><span> </span><a href="OccName.html#tvName"><span class="hs-identifier hs-var">tvName</span></a><span> </span><a href="#local-1628245188"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-1785"></a><span>                            </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#lookupLocalRdrOcc"><span class="hs-identifier hs-var">lookupLocalRdrOcc</span></a><span> </span><a href="#local-1628245185"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-1628245189"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1786"></a><span>                 </span><span class="hs-comment">-- Note [Avoid name clashes for associated data types]</span><span>
</span><a name="line-1787"></a><span>
</span><a name="line-1788"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628245178"><span class="hs-identifier hs-var">mk_tv</span></a><span> </span><a href="#local-1628245183"><span class="hs-identifier hs-var">span</span></a><span> </span><a href="#local-1628245192"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-1628245191"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-1628245190"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1789"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628245190"><a href="#local-1628245190"><span class="hs-identifier">kind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245191"><a href="#local-1628245191"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628245192"><a href="#local-1628245192"><span class="hs-identifier">uniq</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628245177"><span class="hs-identifier hs-var">arg_kinds</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628245187"><span class="hs-identifier hs-var">occs</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628245186"><span class="hs-identifier hs-var">uniqs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1790"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="#local-1628245175"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245176"><span class="hs-identifier hs-var">res_kind</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1791"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1792"></a><span>    </span><span class="hs-special">(</span><a name="local-1628245175"><a href="#local-1628245175"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245176"><a href="#local-1628245176"><span class="hs-identifier">res_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a><span> </span><a href="#local-1628245174"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1793"></a><span>    </span><a name="local-1628245177"><a href="#local-1628245177"><span class="hs-identifier">arg_kinds</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TyCoRep.html#binderType"><span class="hs-identifier hs-var">binderType</span></a><span> </span><a href="#local-1628245175"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-1794"></a><span>    </span><a name="local-1628245178"><a href="#local-1628245178"><span class="hs-identifier">mk_tv</span></a></a><span> </span><a name="local-1628245179"><a href="#local-1628245179"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628245180"><a href="#local-1628245180"><span class="hs-identifier">uniq</span></a></a><span> </span><a name="local-1628245181"><a href="#local-1628245181"><span class="hs-identifier">occ</span></a></a><span> </span><a name="local-1628245182"><a href="#local-1628245182"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-1795"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkTyVar"><span class="hs-identifier hs-var">mkTyVar</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a><span> </span><a href="#local-1628245180"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-1628245181"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-1628245179"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628245182"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1796"></a><span>
</span><a name="line-1797"></a><span class="hs-identifier">badKindSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1798"></a><a name="badKindSig"><a href="TcHsType.html#badKindSig"><span class="hs-identifier">badKindSig</span></a></a><span> </span><a name="local-1628245193"><a href="#local-1628245193"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-1799"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Kind signature on data type declaration has non-* return kind&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1800"></a><span>        </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245193"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1801"></a><span>
</span><a name="line-1802"></a><span class="hs-comment">{-
Note [Avoid name clashes for associated data types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider    class C a b where
               data D b :: * -&gt; *
When typechecking the decl for D, we'll invent an extra type variable
for D, to fill out its kind.  Ideally we don't want this type variable
to be 'a', because when pretty printing we'll get
            class C a b where
               data D b a0
(NB: the tidying happens in the conversion to IfaceSyn, which happens
as part of pretty-printing a TyThing.)

That's why we look in the LocalRdrEnv to see what's in scope. This is
important only to get nice-looking output when doing &quot;:info C&quot; in GHCi.
It isn't essential for correctness.


************************************************************************
*                                                                      *
                Scoped type variables
*                                                                      *
************************************************************************


tcAddScopedTyVars is used for scoped type variables added by pattern
type signatures
        e.g.  \ ((x::a), (y::a)) -&gt; x+y
They never have explicit kinds (because this is source-code only)
They are mutable (because they can get bound to a more specific type).

Usually we kind-infer and expand type splices, and then
tupecheck/desugar the type.  That doesn't work well for scoped type
variables, because they scope left-right in patterns.  (e.g. in the
example above, the 'a' in (y::a) is bound by the 'a' in (x::a).

The current not-very-good plan is to
  * find all the types in the patterns
  * find their free tyvars
  * do kind inference
  * bring the kinded type vars into scope
  * BUT throw away the kind-checked type
        (we'll kind-check it again when we type-check the pattern)

This is bad because throwing away the kind checked type throws away
its splices.  But too bad for now.  [July 03]

Historical note:
    We no longer specify that these type variables must be universally
    quantified (lots of email on the subject).  If you want to put that
    back in, you need to
        a) Do a checkSigTyVars after thing_inside
        b) More insidiously, don't pass in expected_ty, else
           we unify with it too early and checkSigTyVars barfs
           Instead you have to pass in a fresh ty var, and unify
           it with expected_ty afterwards
-}</span><span>
</span><a name="line-1859"></a><span>
</span><a name="line-1860"></a><span class="hs-identifier">tcHsPatSigType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>
</span><a name="line-1861"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>           </span><span class="hs-comment">-- The type signature</span><span>
</span><a name="line-1862"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>                  </span><span class="hs-comment">-- The signature</span><span>
</span><a name="line-1863"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- The new bit of type environment, binding</span><span>
</span><a name="line-1864"></a><span>                                      </span><span class="hs-comment">-- the scoped type variables</span><span>
</span><a name="line-1865"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- The wildcards</span><span>
</span><a name="line-1866"></a><span class="hs-comment">-- Used for type-checking type signatures in</span><span>
</span><a name="line-1867"></a><span class="hs-comment">-- (a) patterns           e.g  f (x::Int) = e</span><span>
</span><a name="line-1868"></a><span class="hs-comment">-- (b) RULE forall bndrs  e.g. forall (x::Int). f x = x</span><span>
</span><a name="line-1869"></a><span class="hs-comment">--</span><span>
</span><a name="line-1870"></a><span class="hs-comment">-- This may emit constraints</span><span>
</span><a name="line-1871"></a><span>
</span><a name="line-1872"></a><a name="tcHsPatSigType"><a href="TcHsType.html#tcHsPatSigType"><span class="hs-identifier">tcHsPatSigType</span></a></a><span> </span><a name="local-1628245194"><a href="#local-1628245194"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-1628245195"><a href="#local-1628245195"><span class="hs-identifier">sig_ty</span></a></a><span>
</span><a name="line-1873"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628245199"><a href="#local-1628245199"><span class="hs-identifier">sig_vars</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628245200"><a href="#local-1628245200"><span class="hs-identifier">wc_ty</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628245195"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-1874"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="HsTypes.html#HsWC"><span class="hs-identifier hs-var">HsWC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_wcs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628245201"><a href="#local-1628245201"><span class="hs-identifier">sig_wcs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hswc_ctx</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628245202"><a href="#local-1628245202"><span class="hs-identifier">extra</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hswc_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628245203"><a href="#local-1628245203"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628245200"><span class="hs-identifier hs-var">wc_ty</span></a><span>
</span><a name="line-1875"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isNothing</span><span> </span><span class="hs-identifier">extra</span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- No extra-constraint wildcard in pattern sigs</span><span>
</span><a name="line-1876"></a><span>    </span><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a><span> </span><a href="#local-1628245194"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-1628245203"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1877"></a><span>    </span><a href="TcHsType.html#tcWildCardBinders"><span class="hs-identifier hs-var">tcWildCardBinders</span></a><span> </span><a href="#local-1628245201"><span class="hs-identifier hs-var">sig_wcs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628245204"><a href="#local-1628245204"><span class="hs-identifier">wcs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1878"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#emitWildCardHoleConstraints"><span class="hs-identifier hs-var">emitWildCardHoleConstraints</span></a><span> </span><a href="#local-1628245204"><span class="hs-identifier hs-var">wcs</span></a><span>
</span><a name="line-1879"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628245206"><a href="#local-1628245206"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245207"><a href="#local-1628245207"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcImplicitTKBndrsX"><span class="hs-identifier hs-var">tcImplicitTKBndrsX</span></a><span> </span><a href="#local-1628245196"><span class="hs-identifier hs-var">new_tkv</span></a><span> </span><a href="#local-1628245199"><span class="hs-identifier hs-var">sig_vars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1880"></a><span>                            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245205"><a href="#local-1628245205"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsLiftedType"><span class="hs-identifier hs-var">tcHsLiftedType</span></a><span> </span><a href="#local-1628245203"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-1881"></a><span>                               </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245205"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#allBoundVariables"><span class="hs-identifier hs-var">allBoundVariables</span></a><span> </span><a href="#local-1628245205"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1882"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628245208"><a href="#local-1628245208"><span class="hs-identifier">sig_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-1628245207"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-1883"></a><span>              </span><span class="hs-comment">-- don't use zonkTcTypeToType; it mistreats wildcards</span><span>
</span><a name="line-1884"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a><span> </span><a href="#local-1628245194"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-1628245208"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-1885"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcHsPatSigType&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245199"><span class="hs-identifier hs-var">sig_vars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1886"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245208"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245206"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245204"><span class="hs-identifier hs-var">wcs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1887"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1888"></a><span>    </span><a name="local-1628245196"><a href="#local-1628245196"><span class="hs-identifier">new_tkv</span></a></a><span> </span><a name="local-1628245197"><a href="#local-1628245197"><span class="hs-identifier">name</span></a></a><span>   </span><span class="hs-comment">-- See Note [Pattern signature binders]</span><span>
</span><a name="line-1889"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span>  </span><span class="hs-comment">-- &quot;False&quot; means that these tyvars aren't yet in scope</span><span>
</span><a name="line-1890"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245198"><a href="#local-1628245198"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-1891"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628245194"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1892"></a><span>               </span><a href="TcType.html#RuleSigCtxt"><span class="hs-identifier hs-var">RuleSigCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcHsType.html#new_skolem_tv"><span class="hs-identifier hs-var">new_skolem_tv</span></a><span> </span><a href="#local-1628245197"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628245198"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1893"></a><span>               </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#newSigTyVar"><span class="hs-identifier hs-var">newSigTyVar</span></a><span> </span><a href="#local-1628245197"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628245198"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1894"></a><span>                                   </span><span class="hs-comment">-- See Note [Unifying SigTvs]</span><span>
</span><a name="line-1895"></a><span>
</span><a name="line-1896"></a><span class="hs-identifier">tcPatSig</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>                    </span><span class="hs-comment">-- True &lt;=&gt; pattern binding</span><span>
</span><a name="line-1897"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-1898"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a><span>
</span><a name="line-1899"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- The type to use for &quot;inside&quot; the signature</span><span>
</span><a name="line-1900"></a><span>                 </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- The new bit of type environment, binding</span><span>
</span><a name="line-1901"></a><span>                                    </span><span class="hs-comment">-- the scoped type variables</span><span>
</span><a name="line-1902"></a><span>                 </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- The wildcards</span><span>
</span><a name="line-1903"></a><span>                 </span><a href="TcEvidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Coercion due to unification with actual ty</span><span>
</span><a name="line-1904"></a><span>                                    </span><span class="hs-comment">-- Of shape:  res_ty ~ sig_ty</span><span>
</span><a name="line-1905"></a><a name="tcPatSig"><a href="TcHsType.html#tcPatSig"><span class="hs-identifier">tcPatSig</span></a></a><span> </span><a name="local-1628245209"><a href="#local-1628245209"><span class="hs-identifier">in_pat_bind</span></a></a><span> </span><a name="local-1628245210"><a href="#local-1628245210"><span class="hs-identifier">sig</span></a></a><span> </span><a name="local-1628245211"><a href="#local-1628245211"><span class="hs-identifier">res_ty</span></a></a><span>
</span><a name="line-1906"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628245221"><a href="#local-1628245221"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245222"><a href="#local-1628245222"><span class="hs-identifier">sig_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245223"><a href="#local-1628245223"><span class="hs-identifier">sig_wcs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsPatSigType"><span class="hs-identifier hs-var">tcHsPatSigType</span></a><span> </span><a href="TcType.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a><span> </span><a href="#local-1628245210"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-1907"></a><span>        </span><span class="hs-comment">-- sig_tvs are the type variables free in 'sig',</span><span>
</span><a name="line-1908"></a><span>        </span><span class="hs-comment">-- and not already in scope. These are the ones</span><span>
</span><a name="line-1909"></a><span>        </span><span class="hs-comment">-- that should be brought into scope</span><span>
</span><a name="line-1910"></a><span>
</span><a name="line-1911"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628245222"><span class="hs-identifier hs-var">sig_tvs</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1912"></a><span>                </span><span class="hs-comment">-- Just do the subsumption check and return</span><span>
</span><a name="line-1913"></a><span>                  </span><a name="local-1628245224"><a href="#local-1628245224"><span class="hs-identifier">wrap</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245212"><span class="hs-identifier hs-var">mk_msg</span></a><span> </span><a href="#local-1628245221"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1914"></a><span>                          </span><a href="TcUnify.html#tcSubTypeET_NC"><span class="hs-identifier hs-var">tcSubTypeET_NC</span></a><span> </span><a href="TcType.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a><span> </span><a href="#local-1628245211"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628245221"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-1915"></a><span>                </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245221"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628245223"><span class="hs-identifier hs-var">sig_wcs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245224"><span class="hs-identifier hs-var">wrap</span></a><span class="hs-special">)</span><span>
</span><a name="line-1916"></a><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1917"></a><span>                </span><span class="hs-comment">-- Type signature binds at least one scoped type variable</span><span>
</span><a name="line-1918"></a><span>
</span><a name="line-1919"></a><span>                </span><span class="hs-comment">-- A pattern binding cannot bind scoped type variables</span><span>
</span><a name="line-1920"></a><span>                </span><span class="hs-comment">-- It is more convenient to make the test here</span><span>
</span><a name="line-1921"></a><span>                </span><span class="hs-comment">-- than in the renamer</span><span>
</span><a name="line-1922"></a><span>        </span><span class="hs-special">{</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="#local-1628245209"><span class="hs-identifier hs-var">in_pat_bind</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#patBindSigErr"><span class="hs-identifier hs-var">patBindSigErr</span></a><span> </span><a href="#local-1628245222"><span class="hs-identifier hs-var">sig_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1923"></a><span>
</span><a name="line-1924"></a><span>                </span><span class="hs-comment">-- Check that all newly-in-scope tyvars are in fact</span><span>
</span><a name="line-1925"></a><span>                </span><span class="hs-comment">-- constrained by the pattern.  This catches tiresome</span><span>
</span><a name="line-1926"></a><span>                </span><span class="hs-comment">-- cases like</span><span>
</span><a name="line-1927"></a><span>                </span><span class="hs-comment">--      type T a = Int</span><span>
</span><a name="line-1928"></a><span>                </span><span class="hs-comment">--      f :: Int -&gt; Int</span><span>
</span><a name="line-1929"></a><span>                </span><span class="hs-comment">--      f (x :: T a) = ...</span><span>
</span><a name="line-1930"></a><span>                </span><span class="hs-comment">-- Here 'a' doesn't get a binding.  Sigh</span><span>
</span><a name="line-1931"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245225"><a href="#local-1628245225"><span class="hs-identifier">bad_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628245226"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628245226"><a href="#local-1628245226"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628245222"><span class="hs-identifier hs-var">sig_tvs</span></a><span>
</span><a name="line-1932"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628245226"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TcType.html#exactTyCoVarsOfType"><span class="hs-identifier hs-var">exactTyCoVarsOfType</span></a><span> </span><a href="#local-1628245221"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1933"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628245225"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcHsType.html#badPatSigTvs"><span class="hs-identifier hs-var">badPatSigTvs</span></a><span> </span><a href="#local-1628245221"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><a href="#local-1628245225"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1934"></a><span>
</span><a name="line-1935"></a><span>        </span><span class="hs-comment">-- Now do a subsumption check of the pattern signature against res_ty</span><span>
</span><a name="line-1936"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628245227"><a href="#local-1628245227"><span class="hs-identifier">wrap</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245212"><span class="hs-identifier hs-var">mk_msg</span></a><span> </span><a href="#local-1628245221"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1937"></a><span>                  </span><a href="TcUnify.html#tcSubTypeET_NC"><span class="hs-identifier hs-var">tcSubTypeET_NC</span></a><span> </span><a href="TcType.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a><span> </span><a href="#local-1628245211"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628245221"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-1938"></a><span>
</span><a name="line-1939"></a><span>        </span><span class="hs-comment">-- Phew!</span><span>
</span><a name="line-1940"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245221"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245222"><span class="hs-identifier hs-var">sig_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245223"><span class="hs-identifier hs-var">sig_wcs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245227"><span class="hs-identifier hs-var">wrap</span></a><span class="hs-special">)</span><span>
</span><a name="line-1941"></a><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1942"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1943"></a><span>    </span><a name="local-1628245212"><a href="#local-1628245212"><span class="hs-identifier">mk_msg</span></a></a><span> </span><a name="local-1628245213"><a href="#local-1628245213"><span class="hs-identifier">sig_ty</span></a></a><span> </span><a name="local-1628245214"><a href="#local-1628245214"><span class="hs-identifier">tidy_env</span></a></a><span>
</span><a name="line-1944"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628245215"><a href="#local-1628245215"><span class="hs-identifier">tidy_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245216"><a href="#local-1628245216"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-1628245214"><span class="hs-identifier hs-var">tidy_env</span></a><span> </span><a href="#local-1628245213"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-1945"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628245217"><a href="#local-1628245217"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a><span> </span><a href="#local-1628245211"><span class="hs-identifier hs-var">res_ty</span></a><span>   </span><span class="hs-comment">-- should be filled in by now</span><span>
</span><a name="line-1946"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628245218"><a href="#local-1628245218"><span class="hs-identifier">tidy_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245219"><a href="#local-1628245219"><span class="hs-identifier">res_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-1628245215"><span class="hs-identifier hs-var">tidy_env</span></a><span> </span><a href="#local-1628245217"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-1947"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245220"><a href="#local-1628245220"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;When checking that the pattern signature:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1948"></a><span>                                  </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245216"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1949"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;fits the type of its context:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1950"></a><span>                                          </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245219"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1951"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245218"><span class="hs-identifier hs-var">tidy_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245220"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1952"></a><span>
</span><a name="line-1953"></a><span class="hs-identifier">patBindSigErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1954"></a><a name="patBindSigErr"><a href="TcHsType.html#patBindSigErr"><span class="hs-identifier">patBindSigErr</span></a></a><span> </span><a name="local-1628245228"><a href="#local-1628245228"><span class="hs-identifier">sig_tvs</span></a></a><span>
</span><a name="line-1955"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;You cannot bind scoped type variable&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a><span> </span><a href="#local-1628245228"><span class="hs-identifier hs-var">sig_tvs</span></a><span>
</span><a name="line-1956"></a><span>          </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprQuotedList"><span class="hs-identifier hs-var">pprQuotedList</span></a><span> </span><a href="#local-1628245228"><span class="hs-identifier hs-var">sig_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1957"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in a pattern binding signature&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1958"></a><span>
</span><a name="line-1959"></a><span class="hs-comment">{-
Note [Pattern signature binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
   data T = forall a. T a (a-&gt;Int)
   f (T x (f :: a-&gt;Int) = blah)

Here
 * The pattern (T p1 p2) creates a *skolem* type variable 'a_sk',
   It must be a skolem so that that it retains its identity, and
   TcErrors.getSkolemInfo can thereby find the binding site for the skolem.

 * The type signature pattern (f :: a-&gt;Int) binds &quot;a&quot; -&gt; a_sig in the envt

 * Then unification makes a_sig := a_sk

That's why we must make a_sig a MetaTv (albeit a SigTv),
not a SkolemTv, so that it can unify to a_sk.

For RULE binders, though, things are a bit different (yuk).
  RULE &quot;foo&quot; forall (x::a) (y::[a]).  f x y = ...
Here this really is the binding site of the type variable so we'd like
to use a skolem, so that we get a complaint if we unify two of them
together.

Note [Unifying SigTvs]
~~~~~~~~~~~~~~~~~~~~~~
ALAS we have no decent way of avoiding two SigTvs getting unified.
Consider
  f (x::(a,b)) (y::c)) = [fst x, y]
Here we'd really like to complain that 'a' and 'c' are unified. But
for the reasons above we can't make a,b,c into skolems, so they
are just SigTvs that can unify.  And indeed, this would be ok,
  f x (y::c) = case x of
                 (x1 :: a1, True) -&gt; [x,y]
                 (x1 :: a2, False) -&gt; [x,y,y]
Here the type of x's first component is called 'a1' in one branch and
'a2' in the other.  We could try insisting on the same OccName, but
they definitely won't have the sane lexical Name.

I think we could solve this by recording in a SigTv a list of all the
in-scope variables that it should not unify with, but it's fiddly.


************************************************************************
*                                                                      *
        Checking kinds
*                                                                      *
************************************************************************

-}</span><span>
</span><a name="line-2010"></a><span>
</span><a name="line-2011"></a><span class="hs-comment">-- | Produce an 'TcKind' suitable for a checking a type that can be * or #.</span><span>
</span><a name="line-2012"></a><span class="hs-identifier">ekOpen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>
</span><a name="line-2013"></a><a name="ekOpen"><a href="TcHsType.html#ekOpen"><span class="hs-identifier">ekOpen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245229"><a href="#local-1628245229"><span class="hs-identifier">rr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span> </span><a href="TysWiredIn.html#runtimeRepTy"><span class="hs-identifier hs-var">runtimeRepTy</span></a><span>
</span><a name="line-2014"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TysPrim.html#tYPE"><span class="hs-identifier hs-var">tYPE</span></a><span> </span><a href="#local-1628245229"><span class="hs-identifier hs-var">rr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2015"></a><span>
</span><a name="line-2016"></a><span class="hs-identifier">unifyKinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-2017"></a><a name="unifyKinds"><a href="TcHsType.html#unifyKinds"><span class="hs-identifier">unifyKinds</span></a></a><span> </span><a name="local-1628245230"><a href="#local-1628245230"><span class="hs-identifier">act_kinds</span></a></a><span>
</span><a name="line-2018"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628245231"><a href="#local-1628245231"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-2019"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628245232"><a href="#local-1628245232"><span class="hs-identifier">check</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628245233"><a href="#local-1628245233"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628245234"><a href="#local-1628245234"><span class="hs-identifier">act_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-1628245233"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1628245234"><span class="hs-identifier hs-var">act_kind</span></a><span> </span><a href="#local-1628245231"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-2020"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628245235"><a href="#local-1628245235"><span class="hs-identifier">tys'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628245232"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-1628245230"><span class="hs-identifier hs-var">act_kinds</span></a><span>
</span><a name="line-2021"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628245235"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628245231"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2022"></a><span>
</span><a name="line-2023"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Sort checking kinds
*                                                                      *
************************************************************************

tcLHsKind converts a user-written kind to an internal, sort-checked kind.
It does sort checking and desugaring at the same time, in one single pass.
-}</span><span>
</span><a name="line-2033"></a><span>
</span><a name="line-2034"></a><span class="hs-identifier">tcLHsKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-2035"></a><a name="tcLHsKind"><a href="TcHsType.html#tcLHsKind"><span class="hs-identifier">tcLHsKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_kind"><span class="hs-identifier hs-var">tc_lhs_kind</span></a><span> </span><a href="TcHsType.html#kindLevelMode"><span class="hs-identifier hs-var">kindLevelMode</span></a><span>
</span><a name="line-2036"></a><span>
</span><a name="line-2037"></a><span class="hs-identifier">tc_lhs_kind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-2038"></a><a name="tc_lhs_kind"><a href="TcHsType.html#tc_lhs_kind"><span class="hs-identifier">tc_lhs_kind</span></a></a><span> </span><a name="local-1628245236"><a href="#local-1628245236"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-1628245237"><a href="#local-1628245237"><span class="hs-identifier">k</span></a></a><span>
</span><a name="line-2039"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In the kind&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245237"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2040"></a><span>    </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#kindLevel"><span class="hs-identifier hs-var">kindLevel</span></a><span> </span><a href="#local-1628245236"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628245237"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-2041"></a><span>
</span><a name="line-2042"></a><span class="hs-identifier">promotionErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#PromotionErr"><span class="hs-identifier hs-type">PromotionErr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628244554"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2043"></a><a name="promotionErr"><a href="TcHsType.html#promotionErr"><span class="hs-identifier">promotionErr</span></a></a><span> </span><a name="local-1628245238"><a href="#local-1628245238"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-1628245239"><a href="#local-1628245239"><span class="hs-identifier">err</span></a></a><span>
</span><a name="line-2044"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#pprPECategory"><span class="hs-identifier hs-var">pprPECategory</span></a><span> </span><a href="#local-1628245239"><span class="hs-identifier hs-var">err</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245238"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;cannot be used here&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2045"></a><span>                   </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><a href="#local-1628245240"><span class="hs-identifier hs-var">reason</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2046"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2047"></a><span>    </span><a name="local-1628245240"><a href="#local-1628245240"><span class="hs-identifier">reason</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628245239"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2048"></a><span>               </span><a href="TcRnTypes.html#FamDataConPE"><span class="hs-identifier hs-var">FamDataConPE</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;it comes from a data family instance&quot;</span><span>
</span><a name="line-2049"></a><span>               </span><a href="TcRnTypes.html#NoDataKindsTC"><span class="hs-identifier hs-var">NoDataKindsTC</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Perhaps you intended to use DataKinds&quot;</span><span>
</span><a name="line-2050"></a><span>               </span><a href="TcRnTypes.html#NoDataKindsDC"><span class="hs-identifier hs-var">NoDataKindsDC</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Perhaps you intended to use DataKinds&quot;</span><span>
</span><a name="line-2051"></a><span>               </span><a href="TcRnTypes.html#NoTypeInTypeTC"><span class="hs-identifier hs-var">NoTypeInTypeTC</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Perhaps you intended to use TypeInType&quot;</span><span>
</span><a name="line-2052"></a><span>               </span><a href="TcRnTypes.html#NoTypeInTypeDC"><span class="hs-identifier hs-var">NoTypeInTypeDC</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Perhaps you intended to use TypeInType&quot;</span><span>
</span><a name="line-2053"></a><span>               </span><a href="TcRnTypes.html#PatSynPE"><span class="hs-identifier hs-var">PatSynPE</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Pattern synonyms cannot be promoted&quot;</span><span>
</span><a name="line-2054"></a><span>               </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;it is defined and used in the same recursive group&quot;</span><span>
</span><a name="line-2055"></a><span>
</span><a name="line-2056"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Scoped type variables
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2063"></a><span>
</span><a name="line-2064"></a><span class="hs-identifier">badPatSigTvs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2065"></a><a name="badPatSigTvs"><a href="TcHsType.html#badPatSigTvs"><span class="hs-identifier">badPatSigTvs</span></a></a><span> </span><a name="local-1628245241"><a href="#local-1628245241"><span class="hs-identifier">sig_ty</span></a></a><span> </span><a name="local-1628245242"><a href="#local-1628245242"><span class="hs-identifier">bad_tvs</span></a></a><span>
</span><a name="line-2066"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The type variable&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a><span> </span><a href="#local-1628245242"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">,</span><span>
</span><a name="line-2067"></a><span>                 </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245242"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2068"></a><span>                 </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;should be bound by the pattern signature&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245241"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2069"></a><span>                 </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;but are actually discarded by a type synonym&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2070"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;To fix this, expand the type synonym&quot;</span><span>
</span><a name="line-2071"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;[Note: I hope to lift this restriction in due course]&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2072"></a><span>
</span><a name="line-2073"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
          Error messages and such
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2080"></a><span>
</span><a name="line-2081"></a><span class="hs-comment">-- | Make an appropriate message for an error in a function argument.</span><span>
</span><a name="line-2082"></a><span class="hs-comment">-- Used for both expressions and types.</span><span>
</span><a name="line-2083"></a><span class="hs-identifier">funAppCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-1628244552"><span class="hs-identifier hs-type">fun</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-1628244553"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1628244552"><span class="hs-identifier hs-type">fun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628244553"><span class="hs-identifier hs-type">arg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2084"></a><a name="funAppCtxt"><a href="TcHsType.html#funAppCtxt"><span class="hs-identifier">funAppCtxt</span></a></a><span> </span><a name="local-1628245243"><a href="#local-1628245243"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-1628245244"><a href="#local-1628245244"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-1628245245"><a href="#local-1628245245"><span class="hs-identifier">arg_no</span></a></a><span>
</span><a name="line-2085"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In the&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#speakNth"><span class="hs-identifier hs-var">speakNth</span></a><span> </span><a href="#local-1628245245"><span class="hs-identifier hs-var">arg_no</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;argument of&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2086"></a><span>                    </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245243"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;, namely&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2087"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628245244"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2088"></a></pre></body></html>