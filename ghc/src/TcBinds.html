<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[TcBinds]{TcBinds}
-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE CPP, RankNTypes, ScopedTypeVariables #-}</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcBinds</span><span> </span><span class="hs-special">(</span><span> </span><a href="TcBinds.html#tcLocalBinds"><span class="hs-identifier hs-var">tcLocalBinds</span></a><span class="hs-special">,</span><span> </span><a href="TcBinds.html#tcTopBinds"><span class="hs-identifier hs-var">tcTopBinds</span></a><span class="hs-special">,</span><span> </span><a href="TcBinds.html#tcRecSelBinds"><span class="hs-identifier hs-var">tcRecSelBinds</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>                 </span><a href="TcBinds.html#tcValBinds"><span class="hs-identifier hs-var">tcValBinds</span></a><span class="hs-special">,</span><span> </span><a href="TcBinds.html#tcHsBootSigs"><span class="hs-identifier hs-var">tcHsBootSigs</span></a><span class="hs-special">,</span><span> </span><a href="TcBinds.html#tcPolyCheck"><span class="hs-identifier hs-var">tcPolyCheck</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>                 </span><a href="TcBinds.html#tcSpecPrags"><span class="hs-identifier hs-var">tcSpecPrags</span></a><span class="hs-special">,</span><span> </span><a href="TcBinds.html#tcSpecWrapper"><span class="hs-identifier hs-var">tcSpecWrapper</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>                 </span><a href="TcBinds.html#tcVectDecls"><span class="hs-identifier hs-var">tcVectDecls</span></a><span class="hs-special">,</span><span> </span><a href="TcBinds.html#addTypecheckedBinds"><span class="hs-identifier hs-var">addTypecheckedBinds</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>                 </span><a href="TcRnTypes.html#TcSigInfo"><span class="hs-identifier hs-type">TcSigInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>                 </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcBinds.html#mkPragEnv"><span class="hs-identifier hs-var">mkPragEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>                 </span><a href="TcBinds.html#tcUserTypeSig"><span class="hs-identifier hs-var">tcUserTypeSig</span></a><span class="hs-special">,</span><span> </span><a href="TcBinds.html#instTcTySig"><span class="hs-identifier hs-var">instTcTySig</span></a><span class="hs-special">,</span><span> </span><a href="TcBinds.html#chooseInferredQuantifiers"><span class="hs-identifier hs-var">chooseInferredQuantifiers</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>                 </span><a href="TcBinds.html#instTcTySigFromId"><span class="hs-identifier hs-var">instTcTySigFromId</span></a><span class="hs-special">,</span><span> </span><a href="TcBinds.html#tcExtendTyVarEnvFromSig"><span class="hs-identifier hs-var">tcExtendTyVarEnvFromSig</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>                 </span><a href="TcBinds.html#badBootDeclErr"><span class="hs-identifier hs-var">badBootDeclErr</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="TcMatches.html"><span class="hs-identifier">TcMatches</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcMatches.html#tcGRHSsPat"><span class="hs-identifier hs-var">tcGRHSsPat</span></a><span class="hs-special">,</span><span> </span><a href="TcMatches.html#tcMatchesFun"><span class="hs-identifier hs-var">tcMatchesFun</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="TcExpr.html"><span class="hs-identifier">TcExpr</span></a><span>  </span><span class="hs-special">(</span><span> </span><a href="TcExpr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="TcPatSyn.html"><span class="hs-identifier">TcPatSyn</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcPatSyn.html#tcInferPatSynDecl"><span class="hs-identifier hs-var">tcInferPatSynDecl</span></a><span class="hs-special">,</span><span> </span><a href="TcPatSyn.html#tcCheckPatSynDecl"><span class="hs-identifier hs-var">tcCheckPatSynDecl</span></a><span>
</span><a name="line-23"></a><span>                               </span><span class="hs-special">,</span><span> </span><a href="TcPatSyn.html#tcPatSynBuilderBind"><span class="hs-identifier hs-var">tcPatSynBuilderBind</span></a><span class="hs-special">,</span><span> </span><a href="TcPatSyn.html#tcPatSynSig"><span class="hs-identifier hs-var">tcPatSynSig</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span class="hs-special">(</span><span> </span><a href="DriverPhases.html#isHsBootOrSig"><span class="hs-identifier hs-var">isHsBootOrSig</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="TcEnv.html"><span class="hs-identifier">TcEnv</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="TcUnify.html"><span class="hs-identifier">TcUnify</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="TcSimplify.html"><span class="hs-identifier">TcSimplify</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="TcEvidence.html"><span class="hs-identifier">TcEvidence</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="TcHsType.html"><span class="hs-identifier">TcHsType</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="TcPat.html"><span class="hs-identifier">TcPat</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="TcMType.html"><span class="hs-identifier">TcMType</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="Inst.html"><span class="hs-identifier">Inst</span></a><span class="hs-special">(</span><span> </span><a href="Inst.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a><span class="hs-special">,</span><span> </span><a href="Inst.html#deeplyInstantiate"><span class="hs-identifier hs-var">deeplyInstantiate</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span class="hs-special">(</span><span> </span><a href="FamInstEnv.html#normaliseType"><span class="hs-identifier hs-var">normaliseType</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="FamInst.html"><span class="hs-identifier">FamInst</span></a><span class="hs-special">(</span><span> </span><a href="FamInst.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="TysPrim.html"><span class="hs-identifier">TysPrim</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span class="hs-special">(</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="Digraph.html"><span class="hs-identifier">Digraph</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span class="hs-special">(</span><a href="Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tidyOpenType"><span class="hs-identifier hs-var">tidyOpenType</span></a><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span class="hs-special">(</span><span> </span><a href="PrelNames.html#mkUnboundName"><span class="hs-identifier hs-var">mkUnboundName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#gHC_PRIM"><span class="hs-identifier hs-var">gHC_PRIM</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#ipClassName"><span class="hs-identifier hs-var">ipClassName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="TcValidity.html"><span class="hs-identifier">TcValidity</span></a><span> </span><span class="hs-special">(</span><a href="TcValidity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
               A useful helper function
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-identifier">addTypecheckedBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-74"></a><a name="addTypecheckedBinds"><a href="TcBinds.html#addTypecheckedBinds"><span class="hs-identifier">addTypecheckedBinds</span></a></a><span> </span><a name="local-1628251649"><a href="#local-1628251649"><span class="hs-identifier">tcg_env</span></a></a><span> </span><a name="local-1628251650"><a href="#local-1628251650"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-75"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DriverPhases.html#isHsBootOrSig"><span class="hs-identifier hs-var">isHsBootOrSig</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_src</span><span> </span><a href="#local-1628251649"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251649"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-76"></a><span>    </span><span class="hs-comment">-- Do not add the code for record-selector bindings</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-comment">-- when compiling hs-boot files</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251649"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span>
</span><a name="line-79"></a><span>                                            </span><span class="hs-special">(</span><span class="hs-identifier">tcg_binds</span><span> </span><a href="#local-1628251649"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>                                            </span><a href="#local-1628251650"><span class="hs-identifier hs-var">binds</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Type-checking bindings}
*                                                                      *
************************************************************************

@tcBindsAndThen@ typechecks a @HsBinds@.  The &quot;and then&quot; part is because
it needs to know something about the {\em usage} of the things bound,
so that it can create specialisations of them.  So @tcBindsAndThen@
takes a function which, given an extended environment, E, typechecks
the scope of the bindings returning a typechecked thing and (most
important) an LIE.  It is this LIE which is then used as the basis for
specialising the things bound.

@tcBindsAndThen@ also takes a &quot;combiner&quot; which glues together the
bindings and the &quot;thing&quot; to make a new &quot;thing&quot;.

The real work is done by @tcBindWithSigsAndThen@.

Recursive and non-recursive binds are handled in essentially the same
way: because of uniques there are no scoping issues left.  The only
difference is that non-recursive bindings can bind primitive values.

Even for non-recursive binding groups we add typings for each binder
to the LVE for the following reason.  When each individual binding is
checked the type of its LHS is unified with that of its RHS; and
type-checking the LHS of course requires that the binder is in scope.

At the top-level the LIE is sure to contain nothing but constant
dictionaries, which we resolve at the module level.

Note [Polymorphic recursion]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The game plan for polymorphic recursion in the code above is

        * Bind any variable for which we have a type signature
          to an Id with a polymorphic type.  Then when type-checking
          the RHSs we'll make a full polymorphic call.

This fine, but if you aren't a bit careful you end up with a horrendous
amount of partial application and (worse) a huge space leak. For example:

        f :: Eq a =&gt; [a] -&gt; [a]
        f xs = ...f...

If we don't take care, after typechecking we get

        f = /\a -&gt; \d::Eq a -&gt; let f' = f a d
                               in
                               \ys:[a] -&gt; ...f'...

Notice the the stupid construction of (f a d), which is of course
identical to the function we're executing.  In this case, the
polymorphic recursion isn't being used (but that's a very common case).
This can lead to a massive space leak, from the following top-level defn
(post-typechecking)

        ff :: [Int] -&gt; [Int]
        ff = f Int dEqInt

Now (f dEqInt) evaluates to a lambda that has f' as a free variable; but
f' is another thunk which evaluates to the same thing... and you end
up with a chain of identical values all hung onto by the CAF ff.

        ff = f Int dEqInt

           = let f' = f Int dEqInt in \ys. ...f'...

           = let f' = let f' = f Int dEqInt in \ys. ...f'...
                      in \ys. ...f'...

Etc.

NOTE: a bit of arity anaysis would push the (f a d) inside the (\ys...),
which would make the space leak go away in this case

Solution: when typechecking the RHSs we always have in hand the
*monomorphic* Ids for each binding.  So we just need to make sure that
if (Method f a d) shows up in the constraints emerging from (...f...)
we just use the monomorphic Id.  We achieve this by adding monomorphic Ids
to the &quot;givens&quot; when simplifying constraints.  That's what the &quot;lies_avail&quot;
is doing.

Then we get

        f = /\a -&gt; \d::Eq a -&gt; letrec
                                 fm = \ys:[a] -&gt; ...fm...
                               in
                               fm
-}</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-identifier">tcTopBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span class="hs-comment">-- The TcGblEnv contains the new tcg_binds and tcg_spects</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- The TcLclEnv has an extended type envt for the new bindings</span><span>
</span><a name="line-177"></a><a name="tcTopBinds"><a href="TcBinds.html#tcTopBinds"><span class="hs-identifier">tcTopBinds</span></a></a><span> </span><a name="local-1628251651"><a href="#local-1628251651"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-1628251652"><a href="#local-1628251652"><span class="hs-identifier">sigs</span></a></a><span>
</span><a name="line-178"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Pattern synonym bindings populate the global environment</span><span>
</span><a name="line-179"></a><span>          </span><span class="hs-special">(</span><a name="local-1628251655"><a href="#local-1628251655"><span class="hs-identifier">binds'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1628251656"><a href="#local-1628251656"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251657"><a href="#local-1628251657"><span class="hs-identifier">tcl_env</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcValBinds"><span class="hs-identifier hs-var">tcValBinds</span></a><span> </span><a href="BasicTypes.html#TopLevel"><span class="hs-identifier hs-var">TopLevel</span></a><span> </span><a href="#local-1628251651"><span class="hs-identifier hs-var">binds</span></a><span> </span><a href="#local-1628251652"><span class="hs-identifier hs-var">sigs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-180"></a><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628251653"><a href="#local-1628251653"><span class="hs-identifier">gbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-181"></a><span>               </span><span class="hs-special">;</span><span> </span><a name="local-1628251654"><a href="#local-1628251654"><span class="hs-identifier">lcl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span>
</span><a name="line-182"></a><span>               </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251653"><span class="hs-identifier hs-var">gbl</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251654"><span class="hs-identifier hs-var">lcl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-183"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628251658"><a href="#local-1628251658"><span class="hs-identifier">specs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcImpPrags"><span class="hs-identifier hs-var">tcImpPrags</span></a><span> </span><a href="#local-1628251652"><span class="hs-identifier hs-var">sigs</span></a><span>   </span><span class="hs-comment">-- SPECIALISE prags for imported Ids</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628251659"><a href="#local-1628251659"><span class="hs-identifier">tcg_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251656"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_imp_specs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251658"><span class="hs-identifier hs-var">specs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-identifier">tcg_imp_specs</span><span> </span><a href="#local-1628251656"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-186"></a><span>                           </span><span class="hs-special">`</span><a href="TcBinds.html#addTypecheckedBinds"><span class="hs-identifier hs-var">addTypecheckedBinds</span></a><span class="hs-special">`</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-1628251655"><span class="hs-identifier hs-var">binds'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251659"><span class="hs-identifier hs-var">tcg_env'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251657"><span class="hs-identifier hs-var">tcl_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-189"></a><span>        </span><span class="hs-comment">-- The top level bindings are flattened into a giant</span><span>
</span><a name="line-190"></a><span>        </span><span class="hs-comment">-- implicitly-mutually-recursive LHsBinds</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-identifier">tcRecSelBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-193"></a><a name="tcRecSelBinds"><a href="TcBinds.html#tcRecSelBinds"><span class="hs-identifier">tcRecSelBinds</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsOut"><span class="hs-identifier hs-var">ValBindsOut</span></a><span> </span><a name="local-1628251660"><a href="#local-1628251660"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-1628251661"><a href="#local-1628251661"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcEnv.html#tcExtendGlobalValEnv"><span class="hs-identifier hs-var">tcExtendGlobalValEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628251662"><span class="hs-identifier hs-var">sel_id</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#IdSig"><span class="hs-identifier hs-var">IdSig</span></a><span> </span><a name="local-1628251662"><a href="#local-1628251662"><span class="hs-identifier">sel_id</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251661"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-195"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628251663"><a href="#local-1628251663"><span class="hs-identifier">rec_sel_binds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251664"><a href="#local-1628251664"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#discardWarnings"><span class="hs-identifier hs-var">discardWarnings</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-196"></a><span>                                     </span><a href="TcBinds.html#tcValBinds"><span class="hs-identifier hs-var">tcValBinds</span></a><span> </span><a href="BasicTypes.html#TopLevel"><span class="hs-identifier hs-var">TopLevel</span></a><span> </span><a href="#local-1628251660"><span class="hs-identifier hs-var">binds</span></a><span> </span><a href="#local-1628251661"><span class="hs-identifier hs-var">sigs</span></a><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-197"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251665"><a href="#local-1628251665"><span class="hs-identifier">tcg_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251664"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">`</span><a href="TcBinds.html#addTypecheckedBinds"><span class="hs-identifier hs-var">addTypecheckedBinds</span></a><span class="hs-special">`</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-1628251663"><span class="hs-identifier hs-var">rec_sel_binds</span></a><span>
</span><a name="line-198"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628251665"><span class="hs-identifier hs-var">tcg_env'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-199"></a><span class="hs-identifier">tcRecSelBinds</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tcRecSelBinds&quot;</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-identifier">tcHsBootSigs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- A hs-boot file has only one BindGroup, and it only has type</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- signatures in it.  The renamer checked all this</span><span>
</span><a name="line-204"></a><a name="tcHsBootSigs"><a href="TcBinds.html#tcHsBootSigs"><span class="hs-identifier">tcHsBootSigs</span></a></a><span> </span><a name="local-1628251666"><a href="#local-1628251666"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-1628251667"><a href="#local-1628251667"><span class="hs-identifier">sigs</span></a></a><span>
</span><a name="line-205"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628251666"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span> </span><a href="TcBinds.html#badBootDeclErr"><span class="hs-identifier hs-var">badBootDeclErr</span></a><span>
</span><a name="line-206"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a><span> </span><a href="#local-1628251668"><span class="hs-identifier hs-var">tc_boot_sig</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="HsBinds.html#isTypeLSig"><span class="hs-identifier hs-var">isTypeLSig</span></a><span> </span><a href="#local-1628251667"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-207"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-208"></a><span>    </span><a name="local-1628251668"><a href="#local-1628251668"><span class="hs-identifier">tc_boot_sig</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#TypeSig"><span class="hs-identifier hs-var">TypeSig</span></a><span> </span><a name="local-1628251669"><a href="#local-1628251669"><span class="hs-identifier">lnames</span></a></a><span> </span><a name="local-1628251670"><a href="#local-1628251670"><span class="hs-identifier">hs_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628251671"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628251669"><span class="hs-identifier hs-var">lnames</span></a><span>
</span><a name="line-209"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-210"></a><span>        </span><a name="local-1628251671"><a href="#local-1628251671"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628251672"><a href="#local-1628251672"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628251673"><a href="#local-1628251673"><span class="hs-identifier">sigma_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSimplify.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-212"></a><span>                             </span><a href="TcHsType.html#tcHsSigWcType"><span class="hs-identifier hs-var">tcHsSigWcType</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a href="#local-1628251672"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><a href="#local-1628251670"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-213"></a><span>               </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#mkVanillaGlobal"><span class="hs-identifier hs-var">mkVanillaGlobal</span></a><span> </span><a href="#local-1628251672"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628251673"><span class="hs-identifier hs-var">sigma_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-214"></a><span>        </span><span class="hs-comment">-- Notice that we make GlobalIds, not LocalIds</span><span>
</span><a name="line-215"></a><span>    </span><span class="hs-identifier">tc_boot_sig</span><span> </span><a name="local-1628251674"><a href="#local-1628251674"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcHsBootSigs/tc_boot_sig&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251674"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-identifier">badBootDeclErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span>
</span><a name="line-218"></a><a name="badBootDeclErr"><a href="TcBinds.html#badBootDeclErr"><span class="hs-identifier">badBootDeclErr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Illegal declarations in an hs-boot file&quot;</span><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span class="hs-comment">------------------------</span><span>
</span><a name="line-221"></a><span class="hs-identifier">tcLocalBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#HsLocalBinds"><span class="hs-identifier hs-type">HsLocalBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251648"><span class="hs-identifier hs-type">thing</span></a><span>
</span><a name="line-222"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#HsLocalBinds"><span class="hs-identifier hs-type">HsLocalBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251648"><span class="hs-identifier hs-type">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><a name="tcLocalBinds"><a href="TcBinds.html#tcLocalBinds"><span class="hs-identifier">tcLocalBinds</span></a></a><span> </span><a href="HsBinds.html#EmptyLocalBinds"><span class="hs-identifier hs-var">EmptyLocalBinds</span></a><span> </span><a name="local-1628251675"><a href="#local-1628251675"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-225"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628251676"><a href="#local-1628251676"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251675"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-226"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#EmptyLocalBinds"><span class="hs-identifier hs-var">EmptyLocalBinds</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251676"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-identifier">tcLocalBinds</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-var">HsValBinds</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsOut"><span class="hs-identifier hs-var">ValBindsOut</span></a><span> </span><a name="local-1628251677"><a href="#local-1628251677"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-1628251678"><a href="#local-1628251678"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-1628251679"><a href="#local-1628251679"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-229"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628251680"><a href="#local-1628251680"><span class="hs-identifier">binds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251681"><a href="#local-1628251681"><span class="hs-identifier">thing</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcValBinds"><span class="hs-identifier hs-var">tcValBinds</span></a><span> </span><a href="BasicTypes.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a><span> </span><a href="#local-1628251677"><span class="hs-identifier hs-var">binds</span></a><span> </span><a href="#local-1628251678"><span class="hs-identifier hs-var">sigs</span></a><span> </span><a href="#local-1628251679"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-230"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-var">HsValBinds</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsOut"><span class="hs-identifier hs-var">ValBindsOut</span></a><span> </span><a href="#local-1628251680"><span class="hs-identifier hs-var">binds'</span></a><span> </span><a href="#local-1628251678"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628251681"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-231"></a><span class="hs-identifier">tcLocalBinds</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-var">HsValBinds</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tcLocalBinds&quot;</span><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-identifier">tcLocalBinds</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#HsIPBinds"><span class="hs-identifier hs-var">HsIPBinds</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#IPBinds"><span class="hs-identifier hs-var">IPBinds</span></a><span> </span><a name="local-1628251682"><a href="#local-1628251682"><span class="hs-identifier">ip_binds</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-1628251683"><a href="#local-1628251683"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-234"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628251699"><a href="#local-1628251699"><span class="hs-identifier">ipClass</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a><span> </span><a href="PrelNames.html#ipClassName"><span class="hs-identifier hs-var">ipClassName</span></a><span>
</span><a name="line-235"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628251700"><a href="#local-1628251700"><span class="hs-identifier">given_ips</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251701"><a href="#local-1628251701"><span class="hs-identifier">ip_binds'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-236"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocSndM"><span class="hs-identifier hs-var">wrapLocSndM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251685"><span class="hs-identifier hs-var">tc_ip_bind</span></a><span> </span><a href="#local-1628251699"><span class="hs-identifier hs-var">ipClass</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628251682"><span class="hs-identifier hs-var">ip_binds</span></a><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span>        </span><span class="hs-comment">-- If the binding binds ?x = E, we  must now</span><span>
</span><a name="line-239"></a><span>        </span><span class="hs-comment">-- discharge any ?x constraints in expr_lie</span><span>
</span><a name="line-240"></a><span>        </span><span class="hs-comment">-- See Note [Implicit parameter untouchables]</span><span>
</span><a name="line-241"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628251702"><a href="#local-1628251702"><span class="hs-identifier">ev_binds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251703"><a href="#local-1628251703"><span class="hs-identifier">result</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcUnify.html#checkConstraints"><span class="hs-identifier hs-var">checkConstraints</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#IPSkol"><span class="hs-identifier hs-var">IPSkol</span></a><span> </span><a href="#local-1628251684"><span class="hs-identifier hs-var">ips</span></a><span class="hs-special">)</span><span>
</span><a name="line-242"></a><span>                                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1628251700"><span class="hs-identifier hs-var">given_ips</span></a><span> </span><a href="#local-1628251683"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#HsIPBinds"><span class="hs-identifier hs-var">HsIPBinds</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#IPBinds"><span class="hs-identifier hs-var">IPBinds</span></a><span> </span><a href="#local-1628251701"><span class="hs-identifier hs-var">ip_binds'</span></a><span> </span><a href="#local-1628251702"><span class="hs-identifier hs-var">ev_binds</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628251703"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-245"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-246"></a><span>    </span><a name="local-1628251684"><a href="#local-1628251684"><span class="hs-identifier">ips</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1628251687"><span class="hs-identifier hs-var">ip</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#IPBind"><span class="hs-identifier hs-var">IPBind</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628251687"><a href="#local-1628251687"><span class="hs-identifier">ip</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251682"><span class="hs-identifier hs-var">ip_binds</span></a><span class="hs-special">]</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span>        </span><span class="hs-comment">-- I wonder if we should do these one at at time</span><span>
</span><a name="line-249"></a><span>        </span><span class="hs-comment">-- Consider     ?x = 4</span><span>
</span><a name="line-250"></a><span>        </span><span class="hs-comment">--              ?y = ?x + 1</span><span>
</span><a name="line-251"></a><span>    </span><a name="local-1628251685"><a href="#local-1628251685"><span class="hs-identifier">tc_ip_bind</span></a></a><span> </span><a name="local-1628251688"><a href="#local-1628251688"><span class="hs-identifier">ipClass</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#IPBind"><span class="hs-identifier hs-var">IPBind</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628251689"><a href="#local-1628251689"><span class="hs-identifier">ip</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-1628251690"><a href="#local-1628251690"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-252"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628251691"><a href="#local-1628251691"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiTyVarTy</span></a><span>
</span><a name="line-253"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251692"><a href="#local-1628251692"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsTypes.html#hsIPNameFS"><span class="hs-identifier hs-var">hsIPNameFS</span></a><span> </span><a href="#local-1628251689"><span class="hs-identifier hs-var">ip</span></a><span>
</span><a name="line-254"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628251693"><a href="#local-1628251693"><span class="hs-identifier">ip_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newDict"><span class="hs-identifier hs-var">newDict</span></a><span> </span><a href="#local-1628251688"><span class="hs-identifier hs-var">ipClass</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628251692"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251691"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-255"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628251694"><a href="#local-1628251694"><span class="hs-identifier">expr'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcExpr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a><span> </span><a href="#local-1628251690"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span> </span><a href="#local-1628251691"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251695"><a href="#local-1628251695"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251686"><span class="hs-identifier hs-var">toDict</span></a><span> </span><a href="#local-1628251688"><span class="hs-identifier hs-var">ipClass</span></a><span> </span><a href="#local-1628251692"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1628251691"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628251694"><span class="hs-identifier hs-var">expr'</span></a><span>
</span><a name="line-257"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251693"><span class="hs-identifier hs-var">ip_id</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#IPBind"><span class="hs-identifier hs-var">IPBind</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><a href="#local-1628251693"><span class="hs-identifier hs-var">ip_id</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628251695"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-258"></a><span>    </span><span class="hs-identifier">tc_ip_bind</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#IPBind"><span class="hs-identifier hs-var">IPBind</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tc_ip_bind&quot;</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span>    </span><span class="hs-comment">-- Coerces a `t` into a dictionry for `IP &quot;x&quot; t`.</span><span>
</span><a name="line-261"></a><span>    </span><span class="hs-comment">-- co : t -&gt; IP &quot;x&quot; t</span><span>
</span><a name="line-262"></a><span>    </span><a name="local-1628251686"><a href="#local-1628251686"><span class="hs-identifier">toDict</span></a></a><span> </span><a name="local-1628251696"><a href="#local-1628251696"><span class="hs-identifier">ipClass</span></a></a><span> </span><a name="local-1628251697"><a href="#local-1628251697"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1628251698"><a href="#local-1628251698"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsExpr.html#HsWrap"><span class="hs-identifier hs-var">HsWrap</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcEvidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-263"></a><span>                          </span><a href="TcEvidence.html#wrapIP"><span class="hs-identifier hs-var">wrapIP</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Type.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a><span> </span><a href="#local-1628251696"><span class="hs-identifier hs-var">ipClass</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628251697"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-1628251698"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span class="hs-comment">{- Note [Implicit parameter untouchables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We add the type variables in the types of the implicit parameters
as untouchables, not so much because we really must not unify them,
but rather because we otherwise end up with constraints like this
    Num alpha, Implic { wanted = alpha ~ Int }
The constraint solver solves alpha~Int by unification, but then
doesn't float that solved constraint out (it's not an unsolved
wanted).  Result disaster: the (Num alpha) is again solved, this
time by defaulting.  No no no.

However [Oct 10] this is all handled automatically by the
untouchable-range idea.

Note [Inlining and hs-boot files]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this example (Trac #10083):

    ---------- RSR.hs-boot ------------
    module RSR where
      data RSR
      eqRSR :: RSR -&gt; RSR -&gt; Bool

    ---------- SR.hs ------------
    module SR where
      import {-# SOURCE #-} RSR
      data SR = MkSR RSR
      eqSR (MkSR r1) (MkSR r2) = eqRSR r1 r2

    ---------- RSR.hs ------------
    module RSR where
      import SR
      data RSR = MkRSR SR -- deriving( Eq )
      eqRSR (MkRSR s1) (MkRSR s2) = (eqSR s1 s2)
      foo x y = not (eqRSR x y)

When compiling RSR we get this code

    RSR.eqRSR :: RSR -&gt; RSR -&gt; Bool
    RSR.eqRSR = \ (ds1 :: RSR.RSR) (ds2 :: RSR.RSR) -&gt;
                case ds1 of _ { RSR.MkRSR s1 -&gt;
                case ds2 of _ { RSR.MkRSR s2 -&gt;
                SR.eqSR s1 s2 }}

    RSR.foo :: RSR -&gt; RSR -&gt; Bool
    RSR.foo = \ (x :: RSR) (y :: RSR) -&gt; not (RSR.eqRSR x y)

Now, when optimising foo:
    Inline eqRSR (small, non-rec)
    Inline eqSR  (small, non-rec)
but the result of inlining eqSR from SR is another call to eqRSR, so
everything repeats.  Neither eqSR nor eqRSR are (apparently) loop
breakers.

Solution: when compiling RSR, add a NOINLINE pragma to every function
exported by the boot-file for RSR (if it exists).

ALAS: doing so makes the boostrappted GHC itself slower by 8% overall
      (on Trac #9872a-d, and T1969.  So I un-did this change, and
      parked it for now.  Sigh.
-}</span><span>
</span><a name="line-326"></a><span>
</span><a name="line-327"></a><span class="hs-identifier">tcValBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a><span>
</span><a name="line-328"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-329"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251647"><span class="hs-identifier hs-type">thing</span></a><span>
</span><a name="line-330"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628251647"><span class="hs-identifier hs-type">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><a name="tcValBinds"><a href="TcBinds.html#tcValBinds"><span class="hs-identifier">tcValBinds</span></a></a><span> </span><a name="local-1628251704"><a href="#local-1628251704"><span class="hs-identifier">top_lvl</span></a></a><span> </span><a name="local-1628251705"><a href="#local-1628251705"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-1628251706"><a href="#local-1628251706"><span class="hs-identifier">sigs</span></a></a><span> </span><a name="local-1628251707"><a href="#local-1628251707"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-333"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251708"><a href="#local-1628251708"><span class="hs-identifier">patsyns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcEnv.html#getPatSynBinds"><span class="hs-identifier hs-var">getPatSynBinds</span></a><span> </span><a href="#local-1628251705"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span>            </span><span class="hs-comment">-- Typecheck the signature</span><span>
</span><a name="line-336"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628251709"><a href="#local-1628251709"><span class="hs-identifier">poly_ids</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251710"><a href="#local-1628251710"><span class="hs-identifier">sig_fn</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcAddPatSynPlaceholders"><span class="hs-identifier hs-var">tcAddPatSynPlaceholders</span></a><span> </span><a href="#local-1628251708"><span class="hs-identifier hs-var">patsyns</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-337"></a><span>                                </span><a href="TcBinds.html#tcTySigs"><span class="hs-identifier hs-var">tcTySigs</span></a><span> </span><a href="#local-1628251706"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628251711"><a href="#local-1628251711"><span class="hs-identifier">_self_boot</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#tcSelfBootInfo"><span class="hs-identifier hs-var">tcSelfBootInfo</span></a><span>
</span><a name="line-340"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251712"><a href="#local-1628251712"><span class="hs-identifier">prag_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcBinds.html#mkPragEnv"><span class="hs-identifier hs-var">mkPragEnv</span></a><span> </span><a href="#local-1628251706"><span class="hs-identifier hs-var">sigs</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span class="hs-special">)</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span> </span><a href="#local-1628251705"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-comment">-- -------  See Note [Inlining and hs-boot files] (change parked) --------</span><span>
</span><a name="line-343"></a><span class="hs-comment">--              prag_fn | isTopLevel top_lvl   -- See Note [Inlining and hs-boot files]</span><span>
</span><a name="line-344"></a><span class="hs-comment">--                      , SelfBoot { sb_ids = boot_id_names } &lt;- self_boot</span><span>
</span><a name="line-345"></a><span class="hs-comment">--                      = foldNameSet add_no_inl prag_fn1 boot_id_names</span><span>
</span><a name="line-346"></a><span class="hs-comment">--                      | otherwise</span><span>
</span><a name="line-347"></a><span class="hs-comment">--                      = prag_fn1</span><span>
</span><a name="line-348"></a><span class="hs-comment">--              add_no_inl boot_id_name prag_fn</span><span>
</span><a name="line-349"></a><span class="hs-comment">--                = extendPragEnv prag_fn (boot_id_name, no_inl_sig boot_id_name)</span><span>
</span><a name="line-350"></a><span class="hs-comment">--              no_inl_sig name = L boot_loc (InlineSig (L boot_loc name) neverInlinePragma)</span><span>
</span><a name="line-351"></a><span class="hs-comment">--              boot_loc = mkGeneralSrcSpan (fsLit &quot;The hs-boot file for this module&quot;)</span><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span>                </span><span class="hs-comment">-- Extend the envt right away with all the Ids</span><span>
</span><a name="line-354"></a><span>                </span><span class="hs-comment">-- declared with complete type signatures</span><span>
</span><a name="line-355"></a><span>                </span><span class="hs-comment">-- Do not extend the TcIdBinderStack; instead</span><span>
</span><a name="line-356"></a><span>                </span><span class="hs-comment">-- we extend it on a per-rhs basis in tcExtendForRhs</span><span>
</span><a name="line-357"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#tcExtendLetEnvIds"><span class="hs-identifier hs-var">tcExtendLetEnvIds</span></a><span> </span><a href="#local-1628251704"><span class="hs-identifier hs-var">top_lvl</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628251713"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251713"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628251713"><a href="#local-1628251713"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251709"><span class="hs-identifier hs-var">poly_ids</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-358"></a><span>            </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628251718"><a href="#local-1628251718"><span class="hs-identifier">binds'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1628251719"><a href="#local-1628251719"><span class="hs-identifier">extra_binds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251720"><a href="#local-1628251720"><span class="hs-identifier">thing</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcBindGroups"><span class="hs-identifier hs-var">tcBindGroups</span></a><span> </span><a href="#local-1628251704"><span class="hs-identifier hs-var">top_lvl</span></a><span> </span><a href="#local-1628251710"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251712"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628251705"><span class="hs-identifier hs-var">binds</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-359"></a><span>                   </span><span class="hs-special">{</span><span> </span><a name="local-1628251714"><a href="#local-1628251714"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251707"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-360"></a><span>                     </span><span class="hs-comment">-- See Note [Pattern synonym builders don't yield dependencies]</span><span>
</span><a name="line-361"></a><span>                   </span><span class="hs-special">;</span><span> </span><a name="local-1628251715"><a href="#local-1628251715"><span class="hs-identifier">patsyn_builders</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcPatSyn.html#tcPatSynBuilderBind"><span class="hs-identifier hs-var">tcPatSynBuilderBind</span></a><span> </span><a href="#local-1628251710"><span class="hs-identifier hs-var">sig_fn</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628251708"><span class="hs-identifier hs-var">patsyns</span></a><span>
</span><a name="line-362"></a><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251716"><a href="#local-1628251716"><span class="hs-identifier">extra_binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251717"><span class="hs-identifier hs-var">builder</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628251717"><a href="#local-1628251717"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251715"><span class="hs-identifier hs-var">patsyn_builders</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-363"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251716"><span class="hs-identifier hs-var">extra_binds</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251714"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-364"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251718"><span class="hs-identifier hs-var">binds'</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628251719"><span class="hs-identifier hs-var">extra_binds'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251720"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-comment">------------------------</span><span>
</span><a name="line-367"></a><span class="hs-identifier">tcBindGroups</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span>
</span><a name="line-368"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251646"><span class="hs-identifier hs-type">thing</span></a><span>
</span><a name="line-369"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628251646"><span class="hs-identifier hs-type">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-370"></a><span class="hs-comment">-- Typecheck a whole lot of value bindings,</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- one strongly-connected component at a time</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- Here a &quot;strongly connected component&quot; has the strightforward</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- meaning of a group of bindings that mention each other,</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- ignoring type signatures (that part comes later)</span><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><a name="tcBindGroups"><a href="TcBinds.html#tcBindGroups"><span class="hs-identifier">tcBindGroups</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-1628251721"><a href="#local-1628251721"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-377"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628251722"><a href="#local-1628251722"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251721"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-378"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628251722"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-379"></a><span>
</span><a name="line-380"></a><span class="hs-identifier">tcBindGroups</span><span> </span><a name="local-1628251723"><a href="#local-1628251723"><span class="hs-identifier">top_lvl</span></a></a><span> </span><a name="local-1628251724"><a href="#local-1628251724"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-1628251725"><a href="#local-1628251725"><span class="hs-identifier">prag_fn</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628251726"><a href="#local-1628251726"><span class="hs-identifier">group</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1628251727"><a href="#local-1628251727"><span class="hs-identifier">groups</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628251728"><a href="#local-1628251728"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-381"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628251729"><a href="#local-1628251729"><span class="hs-identifier">group'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1628251730"><a href="#local-1628251730"><span class="hs-identifier">groups'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251731"><a href="#local-1628251731"><span class="hs-identifier">thing</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-382"></a><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tc_group"><span class="hs-identifier hs-var">tc_group</span></a><span> </span><a href="#local-1628251723"><span class="hs-identifier hs-var">top_lvl</span></a><span> </span><a href="#local-1628251724"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251725"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628251726"><span class="hs-identifier hs-var">group</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-383"></a><span>                   </span><a href="TcBinds.html#tcBindGroups"><span class="hs-identifier hs-var">tcBindGroups</span></a><span> </span><a href="#local-1628251723"><span class="hs-identifier hs-var">top_lvl</span></a><span> </span><a href="#local-1628251724"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251725"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628251727"><span class="hs-identifier hs-var">groups</span></a><span> </span><a href="#local-1628251728"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-384"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251729"><span class="hs-identifier hs-var">group'</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628251730"><span class="hs-identifier hs-var">groups'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251731"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-comment">------------------------</span><span>
</span><a name="line-387"></a><span class="hs-identifier">tc_group</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1628251645"><a href="#local-1628251645"><span class="hs-identifier">thing</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-388"></a><span>            </span><a href="BasicTypes.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span>
</span><a name="line-389"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251645"><span class="hs-identifier hs-type">thing</span></a><span>
</span><a name="line-390"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628251645"><span class="hs-identifier hs-type">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-comment">-- Typecheck one strongly-connected component of the original program.</span><span>
</span><a name="line-393"></a><span class="hs-comment">-- We get a list of groups back, because there may</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- be specialisations etc as well</span><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><a name="tc_group"><a href="TcBinds.html#tc_group"><span class="hs-identifier">tc_group</span></a></a><span> </span><a name="local-1628251732"><a href="#local-1628251732"><span class="hs-identifier">top_lvl</span></a></a><span> </span><a name="local-1628251733"><a href="#local-1628251733"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-1628251734"><a href="#local-1628251734"><span class="hs-identifier">prag_fn</span></a></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a><span class="hs-special">,</span><span> </span><a name="local-1628251735"><a href="#local-1628251735"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628251736"><a href="#local-1628251736"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-397"></a><span>        </span><span class="hs-comment">-- A single non-recursive binding</span><span>
</span><a name="line-398"></a><span>        </span><span class="hs-comment">-- We want to keep non-recursive things non-recursive</span><span>
</span><a name="line-399"></a><span>        </span><span class="hs-comment">-- so that we desugar unlifted bindings correctly</span><span>
</span><a name="line-400"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251737"><a href="#local-1628251737"><span class="hs-identifier">bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628251735"><span class="hs-identifier hs-var">binds</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-401"></a><span>                 </span><span class="hs-special">[</span><a name="local-1628251738"><a href="#local-1628251738"><span class="hs-identifier">bind</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628251738"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-402"></a><span>                 </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tc_group: empty list of binds&quot;</span><span>
</span><a name="line-403"></a><span>                 </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tc_group: NonRecursive binds is not a singleton bag&quot;</span><span>
</span><a name="line-404"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628251739"><a href="#local-1628251739"><span class="hs-identifier">bind'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251740"><a href="#local-1628251740"><span class="hs-identifier">thing</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tc_single"><span class="hs-identifier hs-var">tc_single</span></a><span> </span><a href="#local-1628251732"><span class="hs-identifier hs-var">top_lvl</span></a><span> </span><a href="#local-1628251733"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251734"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628251737"><span class="hs-identifier hs-var">bind</span></a><span> </span><a href="#local-1628251736"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-405"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="BasicTypes.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251739"><span class="hs-identifier hs-var">bind'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628251740"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-406"></a><span>
</span><a name="line-407"></a><span class="hs-identifier">tc_group</span><span> </span><a name="local-1628251741"><a href="#local-1628251741"><span class="hs-identifier">top_lvl</span></a></a><span> </span><a name="local-1628251742"><a href="#local-1628251742"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-1628251743"><a href="#local-1628251743"><span class="hs-identifier">prag_fn</span></a></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a><span class="hs-special">,</span><span> </span><a name="local-1628251744"><a href="#local-1628251744"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628251745"><a href="#local-1628251745"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-408"></a><span>  </span><span class="hs-glyph">=</span><span>     </span><span class="hs-comment">-- To maximise polymorphism, we do a new</span><span>
</span><a name="line-409"></a><span>        </span><span class="hs-comment">-- strongly-connected-component analysis, this time omitting</span><span>
</span><a name="line-410"></a><span>        </span><span class="hs-comment">-- any references to variables with type signatures.</span><span>
</span><a name="line-411"></a><span>        </span><span class="hs-comment">-- (This used to be optional, but isn't now.)</span><span>
</span><a name="line-412"></a><span>        </span><span class="hs-comment">-- See Note [Polymorphic recursion] in HsBinds.</span><span>
</span><a name="line-413"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tc_group rec&quot;</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#pprLHsBinds"><span class="hs-identifier hs-var">pprLHsBinds</span></a><span> </span><a href="#local-1628251744"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-414"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="#local-1628251746"><span class="hs-identifier hs-var">hasPatSyn</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcBinds.html#recursivePatSynErr"><span class="hs-identifier hs-var">recursivePatSynErr</span></a><span> </span><a href="#local-1628251744"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-415"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628251761"><a href="#local-1628251761"><span class="hs-identifier">binds1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251762"><a href="#local-1628251762"><span class="hs-identifier">thing</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251749"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628251748"><span class="hs-identifier hs-var">sccs</span></a><span>
</span><a name="line-416"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="BasicTypes.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251761"><span class="hs-identifier hs-var">binds1</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628251762"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-417"></a><span>                </span><span class="hs-comment">-- Rec them all together</span><span>
</span><a name="line-418"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-419"></a><span>    </span><a name="local-1628251746"><a href="#local-1628251746"><span class="hs-identifier">hasPatSyn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#anyBag"><span class="hs-identifier hs-var">anyBag</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251747"><span class="hs-identifier hs-var">isPatSyn</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628251744"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-420"></a><span>    </span><a name="local-1628251747"><a href="#local-1628251747"><span class="hs-identifier">isPatSyn</span></a></a><span> </span><a href="HsBinds.html#PatSynBind"><span class="hs-identifier hs-var">PatSynBind</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-421"></a><span>    </span><span class="hs-identifier">isPatSyn</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-422"></a><span>
</span><a name="line-423"></a><span>    </span><span class="hs-identifier">sccs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-424"></a><span>    </span><a name="local-1628251748"><a href="#local-1628251748"><span class="hs-identifier">sccs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#stronglyConnCompFromEdgedVertices"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVertices</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#mkEdges"><span class="hs-identifier hs-var">mkEdges</span></a><span> </span><a href="#local-1628251742"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251744"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251645"><span class="hs-identifier hs-type">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-427"></a><span>    </span><a name="local-1628251749"><a href="#local-1628251749"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628251752"><a href="#local-1628251752"><span class="hs-identifier">scc</span></a></a><span class="hs-glyph">:</span><a name="local-1628251753"><a href="#local-1628251753"><span class="hs-identifier">sccs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628251754"><a href="#local-1628251754"><span class="hs-identifier">binds1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251755"><a href="#local-1628251755"><span class="hs-identifier">ids1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251750"><span class="hs-identifier hs-var">tc_scc</span></a><span> </span><a href="#local-1628251752"><span class="hs-identifier hs-var">scc</span></a><span>
</span><a name="line-428"></a><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628251756"><a href="#local-1628251756"><span class="hs-identifier">binds2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251757"><a href="#local-1628251757"><span class="hs-identifier">thing</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcExtendLetEnv"><span class="hs-identifier hs-var">tcExtendLetEnv</span></a><span> </span><a href="#local-1628251741"><span class="hs-identifier hs-var">top_lvl</span></a><span> </span><a href="#local-1628251755"><span class="hs-identifier hs-var">ids1</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-429"></a><span>                                             </span><a href="#local-1628251749"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628251753"><span class="hs-identifier hs-var">sccs</span></a><span>
</span><a name="line-430"></a><span>                        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251754"><span class="hs-identifier hs-var">binds1</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628251756"><span class="hs-identifier hs-var">binds2</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251757"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-431"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628251758"><a href="#local-1628251758"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251745"><span class="hs-identifier hs-var">thing_inside</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251758"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span>    </span><a name="local-1628251750"><a href="#local-1628251750"><span class="hs-identifier">tc_scc</span></a></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-var">AcyclicSCC</span></a><span> </span><a name="local-1628251759"><a href="#local-1628251759"><span class="hs-identifier">bind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251751"><span class="hs-identifier hs-var">tc_sub_group</span></a><span> </span><a href="BasicTypes.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628251759"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">]</span><span>
</span><a name="line-434"></a><span>    </span><span class="hs-identifier">tc_scc</span><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-var">CyclicSCC</span></a><span> </span><a name="local-1628251760"><a href="#local-1628251760"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251751"><span class="hs-identifier hs-var">tc_sub_group</span></a><span> </span><a href="BasicTypes.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a><span>    </span><a href="#local-1628251760"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-435"></a><span>
</span><a name="line-436"></a><span>    </span><a name="local-1628251751"><a href="#local-1628251751"><span class="hs-identifier">tc_sub_group</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcBinds.html#tcPolyBinds"><span class="hs-identifier hs-var">tcPolyBinds</span></a><span> </span><a href="#local-1628251741"><span class="hs-identifier hs-var">top_lvl</span></a><span> </span><a href="#local-1628251742"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251743"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="BasicTypes.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span class="hs-identifier">recursivePatSynErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#OutputableBndr"><span class="hs-identifier hs-type">OutputableBndr</span></a><span> </span><a href="#local-1628251643"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="#local-1628251643"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251644"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-439"></a><a name="recursivePatSynErr"><a href="TcBinds.html#recursivePatSynErr"><span class="hs-identifier">recursivePatSynErr</span></a></a><span> </span><a name="local-1628251763"><a href="#local-1628251763"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-440"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-441"></a><span>    </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Recursive pattern synonym definition with following bindings:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-442"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628251765"><span class="hs-identifier hs-var">pprLBind</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1628251763"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-443"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-444"></a><span>    </span><a name="local-1628251764"><a href="#local-1628251764"><span class="hs-identifier">pprLoc</span></a></a><span> </span><a name="local-1628251766"><a href="#local-1628251766"><span class="hs-identifier">loc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;defined at&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251766"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-445"></a><span>    </span><a name="local-1628251765"><a href="#local-1628251765"><span class="hs-identifier">pprLBind</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628251767"><a href="#local-1628251767"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628251768"><a href="#local-1628251768"><span class="hs-identifier">bind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#collectHsBindBinders"><span class="hs-identifier hs-var">collectHsBindBinders</span></a><span> </span><a href="#local-1628251768"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-446"></a><span>                            </span><a href="#local-1628251764"><span class="hs-identifier hs-var">pprLoc</span></a><span> </span><a href="#local-1628251767"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-447"></a><span>
</span><a name="line-448"></a><span class="hs-identifier">tc_single</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1628251642"><a href="#local-1628251642"><span class="hs-identifier">thing</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-449"></a><span>            </span><a href="BasicTypes.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span>
</span><a name="line-450"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251642"><span class="hs-identifier hs-type">thing</span></a><span>
</span><a name="line-451"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251642"><span class="hs-identifier hs-type">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-452"></a><a name="tc_single"><a href="TcBinds.html#tc_single"><span class="hs-identifier">tc_single</span></a></a><span> </span><a name="local-1628251769"><a href="#local-1628251769"><span class="hs-identifier">_top_lvl</span></a></a><span> </span><a name="local-1628251770"><a href="#local-1628251770"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-1628251771"><a href="#local-1628251771"><span class="hs-identifier">_prag_fn</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PatSynBind"><span class="hs-identifier hs-var">PatSynBind</span></a><span> </span><a name="local-1628251772"><a href="#local-1628251772"><span class="hs-identifier">psb</span></a></a><span class="hs-glyph">@</span><a href="HsBinds.html#PSB"><span class="hs-identifier hs-var">PSB</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628251773"><a href="#local-1628251773"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-1628251774"><a href="#local-1628251774"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-453"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628251777"><a href="#local-1628251777"><span class="hs-identifier">aux_binds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251778"><a href="#local-1628251778"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251775"><span class="hs-identifier hs-var">tc_pat_syn_decl</span></a><span>
</span><a name="line-454"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628251779"><a href="#local-1628251779"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628251778"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="#local-1628251774"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-455"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251777"><span class="hs-identifier hs-var">aux_binds</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251779"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-456"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-457"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-458"></a><span>    </span><span class="hs-identifier">tc_pat_syn_decl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span>    </span><a name="local-1628251775"><a href="#local-1628251775"><span class="hs-identifier">tc_pat_syn_decl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628251770"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251773"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-460"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPatSyn.html#tcInferPatSynDecl"><span class="hs-identifier hs-var">tcInferPatSynDecl</span></a><span> </span><a href="#local-1628251772"><span class="hs-identifier hs-var">psb</span></a><span>
</span><a name="line-461"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcPatSynSig"><span class="hs-identifier hs-var">TcPatSynSig</span></a><span> </span><a name="local-1628251776"><a href="#local-1628251776"><span class="hs-identifier">tpsi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPatSyn.html#tcCheckPatSynDecl"><span class="hs-identifier hs-var">tcCheckPatSynDecl</span></a><span> </span><a href="#local-1628251772"><span class="hs-identifier hs-var">psb</span></a><span> </span><a href="#local-1628251776"><span class="hs-identifier hs-var">tpsi</span></a><span>
</span><a name="line-462"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span>                 </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tc_single&quot;</span><span>
</span><a name="line-463"></a><span>
</span><a name="line-464"></a><span class="hs-identifier">tc_single</span><span> </span><a name="local-1628251780"><a href="#local-1628251780"><span class="hs-identifier">top_lvl</span></a></a><span> </span><a name="local-1628251781"><a href="#local-1628251781"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-1628251782"><a href="#local-1628251782"><span class="hs-identifier">prag_fn</span></a></a><span> </span><a name="local-1628251783"><a href="#local-1628251783"><span class="hs-identifier">lbind</span></a></a><span> </span><a name="local-1628251784"><a href="#local-1628251784"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-465"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628251785"><a href="#local-1628251785"><span class="hs-identifier">binds1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251786"><a href="#local-1628251786"><span class="hs-identifier">ids</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcPolyBinds"><span class="hs-identifier hs-var">tcPolyBinds</span></a><span> </span><a href="#local-1628251780"><span class="hs-identifier hs-var">top_lvl</span></a><span> </span><a href="#local-1628251781"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251782"><span class="hs-identifier hs-var">prag_fn</span></a><span>
</span><a name="line-466"></a><span>                                      </span><a href="BasicTypes.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a><span> </span><a href="BasicTypes.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a><span>
</span><a name="line-467"></a><span>                                      </span><span class="hs-special">[</span><a href="#local-1628251783"><span class="hs-identifier hs-var">lbind</span></a><span class="hs-special">]</span><span>
</span><a name="line-468"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628251787"><a href="#local-1628251787"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcExtendLetEnv"><span class="hs-identifier hs-var">tcExtendLetEnv</span></a><span> </span><a href="#local-1628251780"><span class="hs-identifier hs-var">top_lvl</span></a><span> </span><a href="#local-1628251786"><span class="hs-identifier hs-var">ids</span></a><span> </span><a href="#local-1628251784"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-469"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251785"><span class="hs-identifier hs-var">binds1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251787"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-470"></a><span>
</span><a name="line-471"></a><span class="hs-comment">------------------------</span><span>
</span><a name="line-472"></a><span class="hs-keyword">type</span><span> </span><a name="BKey"><a href="TcBinds.html#BKey"><span class="hs-identifier">BKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- Just number off the bindings</span><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span class="hs-identifier">mkEdges</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="TcBinds.html#BKey"><span class="hs-identifier hs-type">BKey</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-475"></a><span class="hs-comment">-- See Note [Polymorphic recursion] in HsBinds.</span><span>
</span><a name="line-476"></a><a name="mkEdges"><a href="TcBinds.html#mkEdges"><span class="hs-identifier">mkEdges</span></a></a><span> </span><a name="local-1628251788"><a href="#local-1628251788"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-1628251789"><a href="#local-1628251789"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-477"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-1628251797"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251798"><span class="hs-identifier hs-var">key</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-1628251800"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628251799"><a href="#local-1628251799"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NameSet.html#nameSetElems"><span class="hs-identifier hs-var">nameSetElems</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">bind_fvs</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628251797"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-478"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628251800"><a href="#local-1628251800"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-1628251792"><span class="hs-identifier hs-var">key_map</span></a><span> </span><a href="#local-1628251799"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628251790"><span class="hs-identifier hs-var">no_sig</span></a><span> </span><a href="#local-1628251799"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628251797"><a href="#local-1628251797"><span class="hs-identifier">bind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251798"><a href="#local-1628251798"><span class="hs-identifier">key</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251791"><span class="hs-identifier hs-var">keyd_binds</span></a><span>
</span><a name="line-480"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-481"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-482"></a><span>    </span><span class="hs-identifier">no_sig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-483"></a><span>    </span><a name="local-1628251790"><a href="#local-1628251790"><span class="hs-identifier">no_sig</span></a></a><span> </span><a name="local-1628251793"><a href="#local-1628251793"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#noCompleteSig"><span class="hs-identifier hs-var">noCompleteSig</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251788"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251793"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span>    </span><a name="local-1628251791"><a href="#local-1628251791"><span class="hs-identifier">keyd_binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628251789"><span class="hs-identifier hs-var">binds</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">::</span><a href="TcBinds.html#BKey"><span class="hs-identifier hs-type">BKey</span></a><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><a name="line-486"></a><span>
</span><a name="line-487"></a><span>    </span><span class="hs-identifier">key_map</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="TcBinds.html#BKey"><span class="hs-identifier hs-type">BKey</span></a><span>     </span><span class="hs-comment">-- Which binding it comes from</span><span>
</span><a name="line-488"></a><span>    </span><a name="local-1628251792"><a href="#local-1628251792"><span class="hs-identifier">key_map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1628251796"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251795"><span class="hs-identifier hs-var">key</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628251794"><a href="#local-1628251794"><span class="hs-identifier">bind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251795"><a href="#local-1628251795"><span class="hs-identifier">key</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251791"><span class="hs-identifier hs-var">keyd_binds</span></a><span>
</span><a name="line-489"></a><span>                                     </span><span class="hs-special">,</span><span> </span><a name="local-1628251796"><a href="#local-1628251796"><span class="hs-identifier">bndr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HsUtils.html#collectHsBindBinders"><span class="hs-identifier hs-var">collectHsBindBinders</span></a><span> </span><a href="#local-1628251794"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-490"></a><span>
</span><a name="line-491"></a><span class="hs-comment">------------------------</span><span>
</span><a name="line-492"></a><span class="hs-identifier">tcPolyBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span>
</span><a name="line-493"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span>         </span><span class="hs-comment">-- Whether the group is really recursive</span><span>
</span><a name="line-494"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span>         </span><span class="hs-comment">-- Whether it's recursive after breaking</span><span>
</span><a name="line-495"></a><span>                               </span><span class="hs-comment">-- dependencies based on type signatures</span><span>
</span><a name="line-496"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- None are PatSynBind</span><span>
</span><a name="line-497"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-498"></a><span>
</span><a name="line-499"></a><span class="hs-comment">-- Typechecks a single bunch of values bindings all together,</span><span>
</span><a name="line-500"></a><span class="hs-comment">-- and generalises them.  The bunch may be only part of a recursive</span><span>
</span><a name="line-501"></a><span class="hs-comment">-- group, because we use type signatures to maximise polymorphism</span><span>
</span><a name="line-502"></a><span class="hs-comment">--</span><span>
</span><a name="line-503"></a><span class="hs-comment">-- Returns a list because the input may be a single non-recursive binding,</span><span>
</span><a name="line-504"></a><span class="hs-comment">-- in which case the dependency order of the resulting bindings is</span><span>
</span><a name="line-505"></a><span class="hs-comment">-- important.</span><span>
</span><a name="line-506"></a><span class="hs-comment">--</span><span>
</span><a name="line-507"></a><span class="hs-comment">-- Knows nothing about the scope of the bindings</span><span>
</span><a name="line-508"></a><span class="hs-comment">-- None of the bindings are pattern synonyms</span><span>
</span><a name="line-509"></a><span>
</span><a name="line-510"></a><a name="tcPolyBinds"><a href="TcBinds.html#tcPolyBinds"><span class="hs-identifier">tcPolyBinds</span></a></a><span> </span><a name="local-1628251801"><a href="#local-1628251801"><span class="hs-identifier">top_lvl</span></a></a><span> </span><a name="local-1628251802"><a href="#local-1628251802"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-1628251803"><a href="#local-1628251803"><span class="hs-identifier">prag_fn</span></a></a><span> </span><a name="local-1628251804"><a href="#local-1628251804"><span class="hs-identifier">rec_group</span></a></a><span> </span><a name="local-1628251805"><a href="#local-1628251805"><span class="hs-identifier">rec_tc</span></a></a><span> </span><a name="local-1628251806"><a href="#local-1628251806"><span class="hs-identifier">bind_list</span></a></a><span>
</span><a name="line-511"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628251808"><span class="hs-identifier hs-var">loc</span></a><span>                              </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-512"></a><span>    </span><a href="TcRnMonad.html#recoverM"><span class="hs-identifier hs-var">recoverM</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#recoveryCode"><span class="hs-identifier hs-var">recoveryCode</span></a><span> </span><a href="#local-1628251807"><span class="hs-identifier hs-var">binder_names</span></a><span> </span><a href="#local-1628251802"><span class="hs-identifier hs-var">sig_fn</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-513"></a><span>        </span><span class="hs-comment">-- Set up main recover; take advantage of any type sigs</span><span>
</span><a name="line-514"></a><span>
</span><a name="line-515"></a><span>    </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;------------------------------------------------&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-516"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Bindings for {&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251807"><span class="hs-identifier hs-var">binder_names</span></a><span class="hs-special">)</span><span>
</span><a name="line-517"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-1628251809"><a href="#local-1628251809"><span class="hs-identifier">dflags</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-518"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-1628251810"><a href="#local-1628251810"><span class="hs-identifier">type_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclTypeEnv"><span class="hs-identifier hs-var">getLclTypeEnv</span></a><span>
</span><a name="line-519"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251811"><a href="#local-1628251811"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcBinds.html#decideGeneralisationPlan"><span class="hs-identifier hs-var">decideGeneralisationPlan</span></a><span> </span><a href="#local-1628251809"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628251810"><span class="hs-identifier hs-var">type_env</span></a><span>
</span><a name="line-520"></a><span>                         </span><a href="#local-1628251807"><span class="hs-identifier hs-var">binder_names</span></a><span> </span><a href="#local-1628251806"><span class="hs-identifier hs-var">bind_list</span></a><span> </span><a href="#local-1628251802"><span class="hs-identifier hs-var">sig_fn</span></a><span>
</span><a name="line-521"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Generalisation plan&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251811"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">)</span><span>
</span><a name="line-522"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-1628251815"><a href="#local-1628251815"><span class="hs-identifier">result</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1628251816"><a href="#local-1628251816"><span class="hs-identifier">tc_binds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251817"><a href="#local-1628251817"><span class="hs-identifier">poly_ids</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628251811"><span class="hs-identifier hs-var">plan</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-523"></a><span>         </span><a href="TcBinds.html#NoGen"><span class="hs-identifier hs-var">NoGen</span></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcBinds.html#tcPolyNoGen"><span class="hs-identifier hs-var">tcPolyNoGen</span></a><span> </span><a href="#local-1628251805"><span class="hs-identifier hs-var">rec_tc</span></a><span> </span><a href="#local-1628251803"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628251802"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251806"><span class="hs-identifier hs-var">bind_list</span></a><span>
</span><a name="line-524"></a><span>         </span><a href="TcBinds.html#InferGen"><span class="hs-identifier hs-var">InferGen</span></a><span> </span><a name="local-1628251812"><a href="#local-1628251812"><span class="hs-identifier">mn</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcBinds.html#tcPolyInfer"><span class="hs-identifier hs-var">tcPolyInfer</span></a><span> </span><a href="#local-1628251805"><span class="hs-identifier hs-var">rec_tc</span></a><span> </span><a href="#local-1628251803"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628251802"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251812"><span class="hs-identifier hs-var">mn</span></a><span> </span><a href="#local-1628251806"><span class="hs-identifier hs-var">bind_list</span></a><span>
</span><a name="line-525"></a><span>         </span><a href="TcBinds.html#CheckGen"><span class="hs-identifier hs-var">CheckGen</span></a><span> </span><a name="local-1628251813"><a href="#local-1628251813"><span class="hs-identifier">lbind</span></a></a><span> </span><a name="local-1628251814"><a href="#local-1628251814"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcBinds.html#tcPolyCheck"><span class="hs-identifier hs-var">tcPolyCheck</span></a><span> </span><a href="#local-1628251805"><span class="hs-identifier hs-var">rec_tc</span></a><span> </span><a href="#local-1628251803"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628251814"><span class="hs-identifier hs-var">sig</span></a><span> </span><a href="#local-1628251813"><span class="hs-identifier hs-var">lbind</span></a><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span>        </span><span class="hs-comment">-- Check whether strict bindings are ok</span><span>
</span><a name="line-528"></a><span>        </span><span class="hs-comment">-- These must be non-recursive etc, and are not generalised</span><span>
</span><a name="line-529"></a><span>        </span><span class="hs-comment">-- They desugar to a case expression in the end</span><span>
</span><a name="line-530"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="TcBinds.html#checkStrictBinds"><span class="hs-identifier hs-var">checkStrictBinds</span></a><span> </span><a href="#local-1628251801"><span class="hs-identifier hs-var">top_lvl</span></a><span> </span><a href="#local-1628251804"><span class="hs-identifier hs-var">rec_group</span></a><span> </span><a href="#local-1628251806"><span class="hs-identifier hs-var">bind_list</span></a><span> </span><a href="#local-1628251816"><span class="hs-identifier hs-var">tc_binds</span></a><span> </span><a href="#local-1628251817"><span class="hs-identifier hs-var">poly_ids</span></a><span>
</span><a name="line-531"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;} End of bindings for&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251807"><span class="hs-identifier hs-var">binder_names</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251804"><span class="hs-identifier hs-var">rec_group</span></a><span>
</span><a name="line-532"></a><span>                                            </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251818"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628251818"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628251818"><a href="#local-1628251818"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251817"><span class="hs-identifier hs-var">poly_ids</span></a><span class="hs-special">]</span><span>
</span><a name="line-533"></a><span>                                          </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-534"></a><span>
</span><a name="line-535"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628251815"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-536"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-537"></a><span>    </span><a name="local-1628251807"><a href="#local-1628251807"><span class="hs-identifier">binder_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#collectHsBindListBinders"><span class="hs-identifier hs-var">collectHsBindListBinders</span></a><span> </span><a href="#local-1628251806"><span class="hs-identifier hs-var">bind_list</span></a><span>
</span><a name="line-538"></a><span>    </span><a name="local-1628251808"><a href="#local-1628251808"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr1"><span class="hs-identifier hs-var">foldr1</span></a><span> </span><a href="SrcLoc.html#combineSrcSpans"><span class="hs-identifier hs-var">combineSrcSpans</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><a href="#local-1628251806"><span class="hs-identifier hs-var">bind_list</span></a><span class="hs-special">)</span><span>
</span><a name="line-539"></a><span>         </span><span class="hs-comment">-- The mbinds have been dependency analysed and</span><span>
</span><a name="line-540"></a><span>         </span><span class="hs-comment">-- may no longer be adjacent; so find the narrowest</span><span>
</span><a name="line-541"></a><span>         </span><span class="hs-comment">-- span that includes them all</span><span>
</span><a name="line-542"></a><span>
</span><a name="line-543"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-544"></a><span class="hs-identifier">tcPolyNoGen</span><span>     </span><span class="hs-comment">-- No generalisation whatsoever</span><span>
</span><a name="line-545"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span>       </span><span class="hs-comment">-- Whether it's recursive after breaking</span><span>
</span><a name="line-546"></a><span>                   </span><span class="hs-comment">-- dependencies based on type signatures</span><span>
</span><a name="line-547"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span>
</span><a name="line-548"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-549"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-550"></a><span>
</span><a name="line-551"></a><a name="tcPolyNoGen"><a href="TcBinds.html#tcPolyNoGen"><span class="hs-identifier">tcPolyNoGen</span></a></a><span> </span><a name="local-1628251819"><a href="#local-1628251819"><span class="hs-identifier">rec_tc</span></a></a><span> </span><a name="local-1628251820"><a href="#local-1628251820"><span class="hs-identifier">prag_fn</span></a></a><span> </span><a name="local-1628251821"><a href="#local-1628251821"><span class="hs-identifier">tc_sig_fn</span></a></a><span> </span><a name="local-1628251822"><a href="#local-1628251822"><span class="hs-identifier">bind_list</span></a></a><span>
</span><a name="line-552"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628251829"><a href="#local-1628251829"><span class="hs-identifier">binds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251830"><a href="#local-1628251830"><span class="hs-identifier">mono_infos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcMonoBinds"><span class="hs-identifier hs-var">tcMonoBinds</span></a><span> </span><a href="#local-1628251819"><span class="hs-identifier hs-var">rec_tc</span></a><span> </span><a href="#local-1628251821"><span class="hs-identifier hs-var">tc_sig_fn</span></a><span>
</span><a name="line-553"></a><span>                                             </span><span class="hs-special">(</span><a href="TcPat.html#LetGblBndr"><span class="hs-identifier hs-var">LetGblBndr</span></a><span> </span><a href="#local-1628251820"><span class="hs-identifier hs-var">prag_fn</span></a><span class="hs-special">)</span><span>
</span><a name="line-554"></a><span>                                             </span><a href="#local-1628251822"><span class="hs-identifier hs-var">bind_list</span></a><span>
</span><a name="line-555"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628251831"><a href="#local-1628251831"><span class="hs-identifier">mono_ids'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628251823"><span class="hs-identifier hs-var">tc_mono_info</span></a><span> </span><a href="#local-1628251830"><span class="hs-identifier hs-var">mono_infos</span></a><span>
</span><a name="line-556"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251829"><span class="hs-identifier hs-var">binds'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251831"><span class="hs-identifier hs-var">mono_ids'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-557"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-558"></a><span>    </span><a name="local-1628251823"><a href="#local-1628251823"><span class="hs-identifier">tc_mono_info</span></a></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#MBI"><span class="hs-identifier hs-var">MBI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mbi_poly_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251824"><a href="#local-1628251824"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_mono_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251825"><a href="#local-1628251825"><span class="hs-identifier">mono_id</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-559"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628251826"><a href="#local-1628251826"><span class="hs-identifier">mono_ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628251825"><span class="hs-identifier hs-var">mono_id</span></a><span class="hs-special">)</span><span>
</span><a name="line-560"></a><span>             </span><span class="hs-comment">-- Zonk, mainly to expose unboxed types to checkStrictBinds</span><span>
</span><a name="line-561"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251827"><a href="#local-1628251827"><span class="hs-identifier">mono_id'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#setIdType"><span class="hs-identifier hs-var">setIdType</span></a><span> </span><a href="#local-1628251825"><span class="hs-identifier hs-var">mono_id</span></a><span> </span><a href="#local-1628251826"><span class="hs-identifier hs-var">mono_ty'</span></a><span>
</span><a name="line-562"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-1628251828"><a href="#local-1628251828"><span class="hs-identifier">_specs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcSpecPrags"><span class="hs-identifier hs-var">tcSpecPrags</span></a><span> </span><a href="#local-1628251827"><span class="hs-identifier hs-var">mono_id'</span></a><span> </span><span class="hs-special">(</span><a href="TcPat.html#lookupPragEnv"><span class="hs-identifier hs-var">lookupPragEnv</span></a><span> </span><a href="#local-1628251820"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628251824"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-563"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628251827"><span class="hs-identifier hs-var">mono_id'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-564"></a><span>           </span><span class="hs-comment">-- NB: tcPrags generates error messages for</span><span>
</span><a name="line-565"></a><span>           </span><span class="hs-comment">--     specialisation pragmas for non-overloaded sigs</span><span>
</span><a name="line-566"></a><span>           </span><span class="hs-comment">-- Indeed that is why we call it here!</span><span>
</span><a name="line-567"></a><span>           </span><span class="hs-comment">-- So we can safely ignore _specs</span><span>
</span><a name="line-568"></a><span>
</span><a name="line-569"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-570"></a><span class="hs-identifier">tcPolyCheck</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span>       </span><span class="hs-comment">-- Whether it's recursive after breaking</span><span>
</span><a name="line-571"></a><span>                             </span><span class="hs-comment">-- dependencies based on type signatures</span><span>
</span><a name="line-572"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span>
</span><a name="line-573"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span>
</span><a name="line-574"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-575"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-576"></a><span class="hs-comment">-- There is just one binding,</span><span>
</span><a name="line-577"></a><span class="hs-comment">--   it binds a single variable,</span><span>
</span><a name="line-578"></a><span class="hs-comment">--   it has a complete type signature,</span><span>
</span><a name="line-579"></a><a name="tcPolyCheck"><a href="TcBinds.html#tcPolyCheck"><span class="hs-identifier">tcPolyCheck</span></a></a><span> </span><a name="local-1628251832"><a href="#local-1628251832"><span class="hs-identifier">rec_tc</span></a></a><span> </span><a name="local-1628251833"><a href="#local-1628251833"><span class="hs-identifier">prag_fn</span></a></a><span>
</span><a name="line-580"></a><span>            </span><a name="local-1628251834"><a href="#local-1628251834"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#TISI"><span class="hs-identifier hs-var">TISI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_bndr</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CompleteSig"><span class="hs-identifier hs-var">CompleteSig</span></a><span> </span><a name="local-1628251835"><a href="#local-1628251835"><span class="hs-identifier">poly_id</span></a></a><span>
</span><a name="line-581"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_skols</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251836"><a href="#local-1628251836"><span class="hs-identifier">skol_prs</span></a></a><span>
</span><a name="line-582"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_theta</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251837"><a href="#local-1628251837"><span class="hs-identifier">theta</span></a></a><span>
</span><a name="line-583"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_tau</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251838"><a href="#local-1628251838"><span class="hs-identifier">tau</span></a></a><span>
</span><a name="line-584"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_ctxt</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251839"><a href="#local-1628251839"><span class="hs-identifier">ctxt</span></a></a><span>
</span><a name="line-585"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_loc</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251840"><a href="#local-1628251840"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-586"></a><span>            </span><a name="local-1628251841"><a href="#local-1628251841"><span class="hs-identifier">bind</span></a></a><span>
</span><a name="line-587"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628251842"><a href="#local-1628251842"><span class="hs-identifier">ev_vars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newEvVars"><span class="hs-identifier hs-var">newEvVars</span></a><span> </span><a href="#local-1628251837"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-588"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251843"><a href="#local-1628251843"><span class="hs-identifier">skol_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#SigSkol"><span class="hs-identifier hs-var">SigSkol</span></a><span> </span><a href="#local-1628251839"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a><span> </span><a href="#local-1628251837"><span class="hs-identifier hs-var">theta</span></a><span> </span><a href="#local-1628251838"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span>
</span><a name="line-589"></a><span>             </span><a name="local-1628251844"><a href="#local-1628251844"><span class="hs-identifier">prag_sigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcPat.html#lookupPragEnv"><span class="hs-identifier hs-var">lookupPragEnv</span></a><span> </span><a href="#local-1628251833"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628251846"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-590"></a><span>             </span><a name="local-1628251845"><a href="#local-1628251845"><span class="hs-identifier">skol_tvs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-1628251836"><span class="hs-identifier hs-var">skol_prs</span></a><span>
</span><a name="line-591"></a><span>                 </span><span class="hs-comment">-- Find the location of the original source type sig, if</span><span>
</span><a name="line-592"></a><span>                 </span><span class="hs-comment">-- there is was one.  This will appear in messages like</span><span>
</span><a name="line-593"></a><span>                 </span><span class="hs-comment">-- &quot;type variable x is bound by .. at &lt;loc&gt;&quot;</span><span>
</span><a name="line-594"></a><span>             </span><a name="local-1628251846"><a href="#local-1628251846"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628251835"><span class="hs-identifier hs-var">poly_id</span></a><span>
</span><a name="line-595"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628251847"><a href="#local-1628251847"><span class="hs-identifier">ev_binds</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1628251848"><a href="#local-1628251848"><span class="hs-identifier">binds'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-596"></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628251840"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-597"></a><span>               </span><a href="TcUnify.html#checkConstraints"><span class="hs-identifier hs-var">checkConstraints</span></a><span> </span><a href="#local-1628251843"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-1628251845"><span class="hs-identifier hs-var">skol_tvs</span></a><span> </span><a href="#local-1628251842"><span class="hs-identifier hs-var">ev_vars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-598"></a><span>               </span><a href="TcBinds.html#tcMonoBinds"><span class="hs-identifier hs-var">tcMonoBinds</span></a><span> </span><a href="#local-1628251832"><span class="hs-identifier hs-var">rec_tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcIdSig"><span class="hs-identifier hs-var">TcIdSig</span></a><span> </span><a href="#local-1628251834"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="TcPat.html#LetLclBndr"><span class="hs-identifier hs-var">LetLclBndr</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628251841"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">]</span><span>
</span><a name="line-599"></a><span>
</span><a name="line-600"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628251849"><a href="#local-1628251849"><span class="hs-identifier">spec_prags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcSpecPrags"><span class="hs-identifier hs-var">tcSpecPrags</span></a><span> </span><a href="#local-1628251835"><span class="hs-identifier hs-var">poly_id</span></a><span> </span><a href="#local-1628251844"><span class="hs-identifier hs-var">prag_sigs</span></a><span>
</span><a name="line-601"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628251850"><a href="#local-1628251850"><span class="hs-identifier">poly_id</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcPat.html#addInlinePrags"><span class="hs-identifier hs-var">addInlinePrags</span></a><span> </span><a href="#local-1628251835"><span class="hs-identifier hs-var">poly_id</span></a><span> </span><a href="#local-1628251844"><span class="hs-identifier hs-var">prag_sigs</span></a><span>
</span><a name="line-602"></a><span>
</span><a name="line-603"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251851"><a href="#local-1628251851"><span class="hs-identifier">bind'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628251848"><span class="hs-identifier hs-var">binds'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-604"></a><span>                       </span><span class="hs-special">[</span><a name="local-1628251853"><a href="#local-1628251853"><span class="hs-identifier">b</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628251853"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-605"></a><span>                       </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcPolyCheck&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251848"><span class="hs-identifier hs-var">binds'</span></a><span class="hs-special">)</span><span>
</span><a name="line-606"></a><span>             </span><a name="local-1628251852"><a href="#local-1628251852"><span class="hs-identifier">abs_bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628251840"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsBinds.html#AbsBindsSig"><span class="hs-identifier hs-var">AbsBindsSig</span></a><span>
</span><a name="line-607"></a><span>                        </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">abs_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251845"><span class="hs-identifier hs-var">skol_tvs</span></a><span>
</span><a name="line-608"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_ev_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251842"><span class="hs-identifier hs-var">ev_vars</span></a><span>
</span><a name="line-609"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_sig_export</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251850"><span class="hs-identifier hs-var">poly_id</span></a><span>
</span><a name="line-610"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_sig_prags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsBinds.html#SpecPrags"><span class="hs-identifier hs-var">SpecPrags</span></a><span> </span><a href="#local-1628251849"><span class="hs-identifier hs-var">spec_prags</span></a><span>
</span><a name="line-611"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_sig_ev_bind</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251847"><span class="hs-identifier hs-var">ev_binds</span></a><span>
</span><a name="line-612"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_sig_bind</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251851"><span class="hs-identifier hs-var">bind'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-613"></a><span>
</span><a name="line-614"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a><span> </span><a href="#local-1628251852"><span class="hs-identifier hs-var">abs_bind</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-1628251850"><span class="hs-identifier hs-var">poly_id</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-615"></a><span>
</span><a name="line-616"></a><span class="hs-identifier">tcPolyCheck</span><span> </span><a name="local-1628251854"><a href="#local-1628251854"><span class="hs-identifier">_rec_tc</span></a></a><span> </span><a name="local-1628251855"><a href="#local-1628251855"><span class="hs-identifier">_prag_fn</span></a></a><span> </span><a name="local-1628251856"><a href="#local-1628251856"><span class="hs-identifier">sig</span></a></a><span> </span><a name="local-1628251857"><a href="#local-1628251857"><span class="hs-identifier">_bind</span></a></a><span>
</span><a name="line-617"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcPolyCheck&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251856"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span>
</span><a name="line-618"></a><span>
</span><a name="line-619"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-620"></a><span class="hs-identifier">tcPolyInfer</span><span>
</span><a name="line-621"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span>       </span><span class="hs-comment">-- Whether it's recursive after breaking</span><span>
</span><a name="line-622"></a><span>                   </span><span class="hs-comment">-- dependencies based on type signatures</span><span>
</span><a name="line-623"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span>
</span><a name="line-624"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>         </span><span class="hs-comment">-- True &lt;=&gt; apply the monomorphism restriction</span><span>
</span><a name="line-625"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-626"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-627"></a><a name="tcPolyInfer"><a href="TcBinds.html#tcPolyInfer"><span class="hs-identifier">tcPolyInfer</span></a></a><span> </span><a name="local-1628251858"><a href="#local-1628251858"><span class="hs-identifier">rec_tc</span></a></a><span> </span><a name="local-1628251859"><a href="#local-1628251859"><span class="hs-identifier">prag_fn</span></a></a><span> </span><a name="local-1628251860"><a href="#local-1628251860"><span class="hs-identifier">tc_sig_fn</span></a></a><span> </span><a name="local-1628251861"><a href="#local-1628251861"><span class="hs-identifier">mono</span></a></a><span> </span><a name="local-1628251862"><a href="#local-1628251862"><span class="hs-identifier">bind_list</span></a></a><span>
</span><a name="line-628"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628251863"><a href="#local-1628251863"><span class="hs-identifier">tclvl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251864"><a href="#local-1628251864"><span class="hs-identifier">wanted</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1628251865"><a href="#local-1628251865"><span class="hs-identifier">binds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251866"><a href="#local-1628251866"><span class="hs-identifier">mono_infos</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-629"></a><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier hs-var">pushLevelAndCaptureConstraints</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-630"></a><span>                </span><a href="TcBinds.html#tcMonoBinds"><span class="hs-identifier hs-var">tcMonoBinds</span></a><span> </span><a href="#local-1628251858"><span class="hs-identifier hs-var">rec_tc</span></a><span> </span><a href="#local-1628251860"><span class="hs-identifier hs-var">tc_sig_fn</span></a><span> </span><a href="TcPat.html#LetLclBndr"><span class="hs-identifier hs-var">LetLclBndr</span></a><span> </span><a href="#local-1628251862"><span class="hs-identifier hs-var">bind_list</span></a><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251867"><a href="#local-1628251867"><span class="hs-identifier">name_taus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mbi_poly_name</span><span> </span><a href="#local-1628251869"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mbi_mono_id</span><span> </span><a href="#local-1628251869"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-633"></a><span>                         </span><span class="hs-glyph">|</span><span> </span><a name="local-1628251869"><a href="#local-1628251869"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251866"><span class="hs-identifier hs-var">mono_infos</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-634"></a><span>             </span><a name="local-1628251868"><a href="#local-1628251868"><span class="hs-identifier">sigs</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628251870"><span class="hs-identifier hs-var">sig</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TcBinds.html#MBI"><span class="hs-identifier hs-var">MBI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mbi_sig</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628251870"><a href="#local-1628251870"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251866"><span class="hs-identifier hs-var">mono_infos</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-635"></a><span>
</span><a name="line-636"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;simplifyInfer call&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251863"><span class="hs-identifier hs-var">tclvl</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251867"><span class="hs-identifier hs-var">name_taus</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251864"><span class="hs-identifier hs-var">wanted</span></a><span class="hs-special">)</span><span>
</span><a name="line-637"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628251871"><a href="#local-1628251871"><span class="hs-identifier">qtvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251872"><a href="#local-1628251872"><span class="hs-identifier">givens</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251873"><a href="#local-1628251873"><span class="hs-identifier">ev_binds</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-638"></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSimplify.html#simplifyInfer"><span class="hs-identifier hs-var">simplifyInfer</span></a><span> </span><a href="#local-1628251863"><span class="hs-identifier hs-var">tclvl</span></a><span> </span><a href="#local-1628251861"><span class="hs-identifier hs-var">mono</span></a><span> </span><a href="#local-1628251868"><span class="hs-identifier hs-var">sigs</span></a><span> </span><a href="#local-1628251867"><span class="hs-identifier hs-var">name_taus</span></a><span> </span><a href="#local-1628251864"><span class="hs-identifier hs-var">wanted</span></a><span>
</span><a name="line-639"></a><span>
</span><a name="line-640"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251874"><a href="#local-1628251874"><span class="hs-identifier">inferred_theta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TcType.html#evVarPred"><span class="hs-identifier hs-var">evVarPred</span></a><span> </span><a href="#local-1628251872"><span class="hs-identifier hs-var">givens</span></a><span>
</span><a name="line-641"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628251875"><a href="#local-1628251875"><span class="hs-identifier">exports</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-642"></a><span>                    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#mkExport"><span class="hs-identifier hs-var">mkExport</span></a><span> </span><a href="#local-1628251859"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628251871"><span class="hs-identifier hs-var">qtvs</span></a><span> </span><a href="#local-1628251874"><span class="hs-identifier hs-var">inferred_theta</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628251866"><span class="hs-identifier hs-var">mono_infos</span></a><span>
</span><a name="line-643"></a><span>
</span><a name="line-644"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628251876"><a href="#local-1628251876"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-645"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251877"><a href="#local-1628251877"><span class="hs-identifier">poly_ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">abe_poly</span><span> </span><a href="#local-1628251875"><span class="hs-identifier hs-var">exports</span></a><span>
</span><a name="line-646"></a><span>             </span><a name="local-1628251878"><a href="#local-1628251878"><span class="hs-identifier">abs_bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628251876"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-647"></a><span>                        </span><a href="HsBinds.html#AbsBinds"><span class="hs-identifier hs-var">AbsBinds</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">abs_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251871"><span class="hs-identifier hs-var">qtvs</span></a><span>
</span><a name="line-648"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_ev_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251872"><span class="hs-identifier hs-var">givens</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_ev_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1628251873"><span class="hs-identifier hs-var">ev_binds</span></a><span class="hs-special">]</span><span>
</span><a name="line-649"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_exports</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251875"><span class="hs-identifier hs-var">exports</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251865"><span class="hs-identifier hs-var">binds'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-650"></a><span>
</span><a name="line-651"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Binding:&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251877"><span class="hs-identifier hs-var">poly_ids</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span class="hs-special">`</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628251877"><span class="hs-identifier hs-var">poly_ids</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a><span> </span><a href="#local-1628251878"><span class="hs-identifier hs-var">abs_bind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251877"><span class="hs-identifier hs-var">poly_ids</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-653"></a><span>         </span><span class="hs-comment">-- poly_ids are guaranteed zonked by mkExport</span><span>
</span><a name="line-654"></a><span>
</span><a name="line-655"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-656"></a><span class="hs-identifier">mkExport</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span>
</span><a name="line-657"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span>      </span><span class="hs-comment">-- Both already zonked</span><span>
</span><a name="line-658"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcBinds.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a><span>
</span><a name="line-659"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ABExport"><span class="hs-identifier hs-type">ABExport</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">)</span><span>
</span><a name="line-660"></a><span class="hs-comment">-- Only called for generalisation plan InferGen, not by CheckGen or NoGen</span><span>
</span><a name="line-661"></a><span class="hs-comment">--</span><span>
</span><a name="line-662"></a><span class="hs-comment">-- mkExport generates exports with</span><span>
</span><a name="line-663"></a><span class="hs-comment">--      zonked type variables,</span><span>
</span><a name="line-664"></a><span class="hs-comment">--      zonked poly_ids</span><span>
</span><a name="line-665"></a><span class="hs-comment">-- The former is just because no further unifications will change</span><span>
</span><a name="line-666"></a><span class="hs-comment">-- the quantified type variables, so we can fix their final form</span><span>
</span><a name="line-667"></a><span class="hs-comment">-- right now.</span><span>
</span><a name="line-668"></a><span class="hs-comment">-- The latter is needed because the poly_ids are used to extend the</span><span>
</span><a name="line-669"></a><span class="hs-comment">-- type environment; see the invariant on TcEnv.tcExtendIdEnv</span><span>
</span><a name="line-670"></a><span>
</span><a name="line-671"></a><span class="hs-comment">-- Pre-condition: the qtvs and theta are already zonked</span><span>
</span><a name="line-672"></a><span>
</span><a name="line-673"></a><a name="mkExport"><a href="TcBinds.html#mkExport"><span class="hs-identifier">mkExport</span></a></a><span> </span><a name="local-1628251879"><a href="#local-1628251879"><span class="hs-identifier">prag_fn</span></a></a><span> </span><a name="local-1628251880"><a href="#local-1628251880"><span class="hs-identifier">qtvs</span></a></a><span> </span><a name="local-1628251881"><a href="#local-1628251881"><span class="hs-identifier">theta</span></a></a><span>
</span><a name="line-674"></a><span>         </span><a name="local-1628251882"><a href="#local-1628251882"><span class="hs-identifier">mono_info</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcBinds.html#MBI"><span class="hs-identifier hs-var">MBI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mbi_poly_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251883"><a href="#local-1628251883"><span class="hs-identifier">poly_name</span></a></a><span>
</span><a name="line-675"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_sig</span><span>       </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251884"><a href="#local-1628251884"><span class="hs-identifier">mb_sig</span></a></a><span>
</span><a name="line-676"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_mono_id</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251885"><a href="#local-1628251885"><span class="hs-identifier">mono_id</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-677"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628251888"><a href="#local-1628251888"><span class="hs-identifier">mono_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628251885"><span class="hs-identifier hs-var">mono_id</span></a><span class="hs-special">)</span><span>
</span><a name="line-678"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628251892"><a href="#local-1628251892"><span class="hs-identifier">poly_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628251884"><span class="hs-identifier hs-var">mb_sig</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-679"></a><span>              </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628251889"><a href="#local-1628251889"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628251890"><a href="#local-1628251890"><span class="hs-identifier">poly_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnTypes.html#completeIdSigPolyId_maybe"><span class="hs-identifier hs-var">completeIdSigPolyId_maybe</span></a><span> </span><a href="#local-1628251889"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-680"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628251890"><span class="hs-identifier hs-var">poly_id</span></a><span>
</span><a name="line-681"></a><span>              </span><a name="local-1628251891"><a href="#local-1628251891"><span class="hs-identifier">_other</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-682"></a><span>                          </span><a href="TcBinds.html#mkInferredPolyId"><span class="hs-identifier hs-var">mkInferredPolyId</span></a><span> </span><a href="#local-1628251880"><span class="hs-identifier hs-var">qtvs</span></a><span> </span><a href="#local-1628251881"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-683"></a><span>                                           </span><a href="#local-1628251883"><span class="hs-identifier hs-var">poly_name</span></a><span> </span><a href="#local-1628251884"><span class="hs-identifier hs-var">mb_sig</span></a><span> </span><a href="#local-1628251888"><span class="hs-identifier hs-var">mono_ty</span></a><span>
</span><a name="line-684"></a><span>              </span><span class="hs-comment">-- The checkNoErrs ensures that if the type is ambiguous</span><span>
</span><a name="line-685"></a><span>              </span><span class="hs-comment">-- we don't carry on to the impedence matching, and generate</span><span>
</span><a name="line-686"></a><span>              </span><span class="hs-comment">-- a duplicate ambiguity error.  There is a similar</span><span>
</span><a name="line-687"></a><span>              </span><span class="hs-comment">-- checkNoErrs for complete type signatures too.</span><span>
</span><a name="line-688"></a><span>
</span><a name="line-689"></a><span>        </span><span class="hs-comment">-- NB: poly_id has a zonked type</span><span>
</span><a name="line-690"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628251893"><a href="#local-1628251893"><span class="hs-identifier">poly_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcPat.html#addInlinePrags"><span class="hs-identifier hs-var">addInlinePrags</span></a><span> </span><a href="#local-1628251892"><span class="hs-identifier hs-var">poly_id</span></a><span> </span><a href="#local-1628251886"><span class="hs-identifier hs-var">prag_sigs</span></a><span>
</span><a name="line-691"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628251894"><a href="#local-1628251894"><span class="hs-identifier">spec_prags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcSpecPrags"><span class="hs-identifier hs-var">tcSpecPrags</span></a><span> </span><a href="#local-1628251893"><span class="hs-identifier hs-var">poly_id</span></a><span> </span><a href="#local-1628251886"><span class="hs-identifier hs-var">prag_sigs</span></a><span>
</span><a name="line-692"></a><span>                </span><span class="hs-comment">-- tcPrags requires a zonked poly_id</span><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span>        </span><span class="hs-comment">-- See Note [Impedence matching]</span><span>
</span><a name="line-695"></a><span>        </span><span class="hs-comment">-- NB: we have already done checkValidType, including an ambiguity check,</span><span>
</span><a name="line-696"></a><span>        </span><span class="hs-comment">--     on the type; either when we checked the sig or in mkInferredPolyId</span><span>
</span><a name="line-697"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251895"><a href="#local-1628251895"><span class="hs-identifier">sel_poly_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkInvSigmaTy"><span class="hs-identifier hs-var">mkInvSigmaTy</span></a><span> </span><a href="#local-1628251880"><span class="hs-identifier hs-var">qtvs</span></a><span> </span><a href="#local-1628251881"><span class="hs-identifier hs-var">theta</span></a><span> </span><a href="#local-1628251888"><span class="hs-identifier hs-var">mono_ty</span></a><span>
</span><a name="line-698"></a><span>                </span><span class="hs-comment">-- this type is just going into tcSubType, so Inv vs. Spec doesn't</span><span>
</span><a name="line-699"></a><span>                </span><span class="hs-comment">-- matter</span><span>
</span><a name="line-700"></a><span>
</span><a name="line-701"></a><span>              </span><a name="local-1628251896"><a href="#local-1628251896"><span class="hs-identifier">poly_ty</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628251893"><span class="hs-identifier hs-var">poly_id</span></a><span>
</span><a name="line-702"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628251897"><a href="#local-1628251897"><span class="hs-identifier">wrap</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628251895"><span class="hs-identifier hs-var">sel_poly_ty</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628251896"><span class="hs-identifier hs-var">poly_ty</span></a><span>  </span><span class="hs-comment">-- NB: eqType ignores visibility</span><span>
</span><a name="line-703"></a><span>                  </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="TcEvidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a><span>  </span><span class="hs-comment">-- Fast path; also avoids complaint when we infer</span><span>
</span><a name="line-704"></a><span>                                           </span><span class="hs-comment">-- an ambiguouse type and have AllowAmbiguousType</span><span>
</span><a name="line-705"></a><span>                                           </span><span class="hs-comment">-- e..g infer  x :: forall a. F a -&gt; Int</span><span>
</span><a name="line-706"></a><span>                  </span><span class="hs-keyword">else</span><span> </span><a href="TcRnMonad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#mk_impedence_match_msg"><span class="hs-identifier hs-var">mk_impedence_match_msg</span></a><span> </span><a href="#local-1628251882"><span class="hs-identifier hs-var">mono_info</span></a><span> </span><a href="#local-1628251895"><span class="hs-identifier hs-var">sel_poly_ty</span></a><span> </span><a href="#local-1628251896"><span class="hs-identifier hs-var">poly_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-707"></a><span>                       </span><a href="TcUnify.html#tcSubType_NC"><span class="hs-identifier hs-var">tcSubType_NC</span></a><span> </span><a href="#local-1628251887"><span class="hs-identifier hs-var">sig_ctxt</span></a><span> </span><a href="#local-1628251895"><span class="hs-identifier hs-var">sel_poly_ty</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span> </span><a href="#local-1628251896"><span class="hs-identifier hs-var">poly_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-708"></a><span>
</span><a name="line-709"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628251898"><a href="#local-1628251898"><span class="hs-identifier">warn_missing_sigs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a><span> </span><a href="DynFlags.html#Opt_WarnMissingLocalSignatures"><span class="hs-identifier hs-var">Opt_WarnMissingLocalSignatures</span></a><span>
</span><a name="line-710"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="#local-1628251898"><span class="hs-identifier hs-var">warn_missing_sigs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-711"></a><span>              </span><a href="TcBinds.html#localSigWarn"><span class="hs-identifier hs-var">localSigWarn</span></a><span> </span><a href="DynFlags.html#Opt_WarnMissingLocalSignatures"><span class="hs-identifier hs-var">Opt_WarnMissingLocalSignatures</span></a><span> </span><a href="#local-1628251893"><span class="hs-identifier hs-var">poly_id</span></a><span> </span><a href="#local-1628251884"><span class="hs-identifier hs-var">mb_sig</span></a><span>
</span><a name="line-712"></a><span>
</span><a name="line-713"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ABE"><span class="hs-identifier hs-var">ABE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">abe_wrap</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251897"><span class="hs-identifier hs-var">wrap</span></a><span>
</span><a name="line-714"></a><span>                        </span><span class="hs-comment">-- abe_wrap :: idType poly_id ~ (forall qtvs. theta =&gt; mono_ty)</span><span>
</span><a name="line-715"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abe_poly</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251893"><span class="hs-identifier hs-var">poly_id</span></a><span>
</span><a name="line-716"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abe_mono</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251885"><span class="hs-identifier hs-var">mono_id</span></a><span>
</span><a name="line-717"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abe_prags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsBinds.html#SpecPrags"><span class="hs-identifier hs-var">SpecPrags</span></a><span> </span><a href="#local-1628251894"><span class="hs-identifier hs-var">spec_prags</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-718"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-719"></a><span>    </span><a name="local-1628251886"><a href="#local-1628251886"><span class="hs-identifier">prag_sigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcPat.html#lookupPragEnv"><span class="hs-identifier hs-var">lookupPragEnv</span></a><span> </span><a href="#local-1628251879"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628251883"><span class="hs-identifier hs-var">poly_name</span></a><span>
</span><a name="line-720"></a><span>    </span><a name="local-1628251887"><a href="#local-1628251887"><span class="hs-identifier">sig_ctxt</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#InfSigCtxt"><span class="hs-identifier hs-var">InfSigCtxt</span></a><span> </span><a href="#local-1628251883"><span class="hs-identifier hs-var">poly_name</span></a><span>
</span><a name="line-721"></a><span>
</span><a name="line-722"></a><span class="hs-identifier">mkInferredPolyId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span>
</span><a name="line-723"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-724"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span>
</span><a name="line-725"></a><a name="mkInferredPolyId"><a href="TcBinds.html#mkInferredPolyId"><span class="hs-identifier">mkInferredPolyId</span></a></a><span> </span><a name="local-1628251899"><a href="#local-1628251899"><span class="hs-identifier">qtvs</span></a></a><span> </span><a name="local-1628251900"><a href="#local-1628251900"><span class="hs-identifier">inferred_theta</span></a></a><span> </span><a name="local-1628251901"><a href="#local-1628251901"><span class="hs-identifier">poly_name</span></a></a><span> </span><a name="local-1628251902"><a href="#local-1628251902"><span class="hs-identifier">mb_sig</span></a></a><span> </span><a name="local-1628251903"><a href="#local-1628251903"><span class="hs-identifier">mono_ty</span></a></a><span>
</span><a name="line-726"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628251904"><a href="#local-1628251904"><span class="hs-identifier">fam_envs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="FamInst.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a><span>
</span><a name="line-727"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628251905"><a href="#local-1628251905"><span class="hs-identifier">_co</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251906"><a href="#local-1628251906"><span class="hs-identifier">mono_ty'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FamInstEnv.html#normaliseType"><span class="hs-identifier hs-var">normaliseType</span></a><span> </span><a href="#local-1628251904"><span class="hs-identifier hs-var">fam_envs</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-1628251903"><span class="hs-identifier hs-var">mono_ty</span></a><span>
</span><a name="line-728"></a><span>               </span><span class="hs-comment">-- Unification may not have normalised the type,</span><span>
</span><a name="line-729"></a><span>               </span><span class="hs-comment">-- (see Note [Lazy flattening] in TcFlatten) so do it</span><span>
</span><a name="line-730"></a><span>               </span><span class="hs-comment">-- here to make it as uncomplicated as possible.</span><span>
</span><a name="line-731"></a><span>               </span><span class="hs-comment">-- Example: f :: [F Int] -&gt; Bool</span><span>
</span><a name="line-732"></a><span>               </span><span class="hs-comment">-- should be rewritten to f :: [Char] -&gt; Bool, if possible</span><span>
</span><a name="line-733"></a><span>               </span><span class="hs-comment">--</span><span>
</span><a name="line-734"></a><span>               </span><span class="hs-comment">-- We can discard the coercion _co, because we'll reconstruct</span><span>
</span><a name="line-735"></a><span>               </span><span class="hs-comment">-- it in the call to tcSubType below</span><span>
</span><a name="line-736"></a><span>
</span><a name="line-737"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628251907"><a href="#local-1628251907"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251908"><a href="#local-1628251908"><span class="hs-identifier">theta'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#chooseInferredQuantifiers"><span class="hs-identifier hs-var">chooseInferredQuantifiers</span></a><span> </span><a href="#local-1628251900"><span class="hs-identifier hs-var">inferred_theta</span></a><span>
</span><a name="line-738"></a><span>                                </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1628251906"><span class="hs-identifier hs-var">mono_ty'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628251899"><span class="hs-identifier hs-var">qtvs</span></a><span> </span><a href="#local-1628251902"><span class="hs-identifier hs-var">mb_sig</span></a><span>
</span><a name="line-739"></a><span>
</span><a name="line-740"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251909"><a href="#local-1628251909"><span class="hs-identifier">inferred_poly_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span> </span><a href="#local-1628251907"><span class="hs-identifier hs-var">binders</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a><span> </span><a href="#local-1628251908"><span class="hs-identifier hs-var">theta'</span></a><span> </span><a href="#local-1628251906"><span class="hs-identifier hs-var">mono_ty'</span></a><span class="hs-special">)</span><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;mkInferredPolyId&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251901"><span class="hs-identifier hs-var">poly_name</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251899"><span class="hs-identifier hs-var">qtvs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251908"><span class="hs-identifier hs-var">theta'</span></a><span>
</span><a name="line-743"></a><span>                                          </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251909"><span class="hs-identifier hs-var">inferred_poly_ty</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-744"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#mk_inf_msg"><span class="hs-identifier hs-var">mk_inf_msg</span></a><span> </span><a href="#local-1628251901"><span class="hs-identifier hs-var">poly_name</span></a><span> </span><a href="#local-1628251909"><span class="hs-identifier hs-var">inferred_poly_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-745"></a><span>         </span><a href="TcValidity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#InfSigCtxt"><span class="hs-identifier hs-var">InfSigCtxt</span></a><span> </span><a href="#local-1628251901"><span class="hs-identifier hs-var">poly_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628251909"><span class="hs-identifier hs-var">inferred_poly_ty</span></a><span>
</span><a name="line-746"></a><span>         </span><span class="hs-comment">-- See Note [Validity of inferred types]</span><span>
</span><a name="line-747"></a><span>
</span><a name="line-748"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a><span> </span><a href="#local-1628251901"><span class="hs-identifier hs-var">poly_name</span></a><span> </span><a href="#local-1628251909"><span class="hs-identifier hs-var">inferred_poly_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-749"></a><span>
</span><a name="line-750"></a><span>
</span><a name="line-751"></a><span class="hs-identifier">chooseInferredQuantifiers</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span>   </span><span class="hs-comment">-- inferred</span><span>
</span><a name="line-752"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a><span>    </span><span class="hs-comment">-- tvs free in tau type</span><span>
</span><a name="line-753"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- inferred quantified tvs</span><span>
</span><a name="line-754"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span>
</span><a name="line-755"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcTyBinder"><span class="hs-identifier hs-type">TcTyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span class="hs-special">)</span><span>
</span><a name="line-756"></a><a name="chooseInferredQuantifiers"><a href="TcBinds.html#chooseInferredQuantifiers"><span class="hs-identifier">chooseInferredQuantifiers</span></a></a><span> </span><a name="local-1628251910"><a href="#local-1628251910"><span class="hs-identifier">inferred_theta</span></a></a><span> </span><a name="local-1628251911"><a href="#local-1628251911"><span class="hs-identifier">tau_tvs</span></a></a><span> </span><a name="local-1628251912"><a href="#local-1628251912"><span class="hs-identifier">qtvs</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-757"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251913"><a href="#local-1628251913"><span class="hs-identifier">free_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#closeOverKinds"><span class="hs-identifier hs-var">closeOverKinds</span></a><span> </span><span class="hs-special">(</span><a href="TcSimplify.html#growThetaTyVars"><span class="hs-identifier hs-var">growThetaTyVars</span></a><span> </span><a href="#local-1628251910"><span class="hs-identifier hs-var">inferred_theta</span></a><span> </span><a href="#local-1628251911"><span class="hs-identifier hs-var">tau_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-758"></a><span>                        </span><span class="hs-comment">-- Include kind variables!  Trac #7916</span><span>
</span><a name="line-759"></a><span>             </span><a name="local-1628251914"><a href="#local-1628251914"><span class="hs-identifier">my_theta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#pickQuantifiablePreds"><span class="hs-identifier hs-var">pickQuantifiablePreds</span></a><span> </span><a href="#local-1628251913"><span class="hs-identifier hs-var">free_tvs</span></a><span> </span><a href="#local-1628251910"><span class="hs-identifier hs-var">inferred_theta</span></a><span>
</span><a name="line-760"></a><span>             </span><a name="local-1628251915"><a href="#local-1628251915"><span class="hs-identifier">binders</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="Type.html#mkNamedBinder"><span class="hs-identifier hs-var">mkNamedBinder</span></a><span> </span><a href="TyCoRep.html#Invisible"><span class="hs-identifier hs-var">Invisible</span></a><span> </span><a href="#local-1628251916"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-761"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="local-1628251916"><a href="#local-1628251916"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251912"><span class="hs-identifier hs-var">qtvs</span></a><span>
</span><a name="line-762"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="#local-1628251916"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628251913"><span class="hs-identifier hs-var">free_tvs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-763"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251915"><span class="hs-identifier hs-var">binders</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251914"><span class="hs-identifier hs-var">my_theta</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-764"></a><span>
</span><a name="line-765"></a><span class="hs-identifier">chooseInferredQuantifiers</span><span> </span><a name="local-1628251917"><a href="#local-1628251917"><span class="hs-identifier">inferred_theta</span></a></a><span> </span><a name="local-1628251918"><a href="#local-1628251918"><span class="hs-identifier">tau_tvs</span></a></a><span> </span><a name="local-1628251919"><a href="#local-1628251919"><span class="hs-identifier">qtvs</span></a></a><span>
</span><a name="line-766"></a><span>                          </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TISI"><span class="hs-identifier hs-var">TISI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_bndr</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251920"><a href="#local-1628251920"><span class="hs-identifier">bndr_info</span></a></a><span>
</span><a name="line-767"></a><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251921"><a href="#local-1628251921"><span class="hs-identifier">ctxt</span></a></a><span>
</span><a name="line-768"></a><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_theta</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251922"><a href="#local-1628251922"><span class="hs-identifier">annotated_theta</span></a></a><span>
</span><a name="line-769"></a><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_skols</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251923"><a href="#local-1628251923"><span class="hs-identifier">annotated_tvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-770"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#PartialSig"><span class="hs-identifier hs-var">PartialSig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_cts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251933"><a href="#local-1628251933"><span class="hs-identifier">extra</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251920"><span class="hs-identifier hs-var">bndr_info</span></a><span>
</span><a name="line-771"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251933"><span class="hs-identifier hs-var">extra</span></a><span>
</span><a name="line-772"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628251934"><a href="#local-1628251934"><span class="hs-identifier">annotated_theta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcTypes"><span class="hs-identifier hs-var">zonkTcTypes</span></a><span> </span><a href="#local-1628251922"><span class="hs-identifier hs-var">annotated_theta</span></a><span>
</span><a name="line-773"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251935"><a href="#local-1628251935"><span class="hs-identifier">free_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#closeOverKinds"><span class="hs-identifier hs-var">closeOverKinds</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1628251934"><span class="hs-identifier hs-var">annotated_theta</span></a><span>
</span><a name="line-774"></a><span>                                        </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628251918"><span class="hs-identifier hs-var">tau_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-775"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;ciq&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251920"><span class="hs-identifier hs-var">bndr_info</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251934"><span class="hs-identifier hs-var">annotated_theta</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251935"><span class="hs-identifier hs-var">free_tvs</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-776"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251927"><span class="hs-identifier hs-var">mk_binders</span></a><span> </span><a href="#local-1628251935"><span class="hs-identifier hs-var">free_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251934"><span class="hs-identifier hs-var">annotated_theta</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-777"></a><span>
</span><a name="line-778"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#PartialSig"><span class="hs-identifier hs-var">PartialSig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_cts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251936"><a href="#local-1628251936"><span class="hs-identifier">extra</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251920"><span class="hs-identifier hs-var">bndr_info</span></a><span>
</span><a name="line-779"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628251937"><a href="#local-1628251937"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251936"><span class="hs-identifier hs-var">extra</span></a><span>
</span><a name="line-780"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628251938"><a href="#local-1628251938"><span class="hs-identifier">annotated_theta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcTypes"><span class="hs-identifier hs-var">zonkTcTypes</span></a><span> </span><a href="#local-1628251922"><span class="hs-identifier hs-var">annotated_theta</span></a><span>
</span><a name="line-781"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251939"><a href="#local-1628251939"><span class="hs-identifier">free_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#closeOverKinds"><span class="hs-identifier hs-var">closeOverKinds</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1628251938"><span class="hs-identifier hs-var">annotated_theta</span></a><span>
</span><a name="line-782"></a><span>                                        </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628251918"><span class="hs-identifier hs-var">tau_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-783"></a><span>             </span><a name="local-1628251940"><a href="#local-1628251940"><span class="hs-identifier">my_theta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#pickQuantifiablePreds"><span class="hs-identifier hs-var">pickQuantifiablePreds</span></a><span> </span><a href="#local-1628251939"><span class="hs-identifier hs-var">free_tvs</span></a><span> </span><a href="#local-1628251917"><span class="hs-identifier hs-var">inferred_theta</span></a><span>
</span><a name="line-784"></a><span>
</span><a name="line-785"></a><span>       </span><span class="hs-comment">-- Report the inferred constraints for an extra-constraints wildcard/hole as</span><span>
</span><a name="line-786"></a><span>       </span><span class="hs-comment">-- an error message, unless the PartialTypeSignatures flag is enabled. In this</span><span>
</span><a name="line-787"></a><span>       </span><span class="hs-comment">-- case, the extra inferred constraints are accepted without complaining.</span><span>
</span><a name="line-788"></a><span>       </span><span class="hs-comment">-- Returns the annotated constraints combined with the inferred constraints.</span><span>
</span><a name="line-789"></a><span>             </span><a name="local-1628251941"><a href="#local-1628251941"><span class="hs-identifier">inferred_diff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628251943"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-790"></a><span>                             </span><span class="hs-glyph">|</span><span> </span><a name="local-1628251943"><a href="#local-1628251943"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251940"><span class="hs-identifier hs-var">my_theta</span></a><span>
</span><a name="line-791"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628251943"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628251938"><span class="hs-identifier hs-var">annotated_theta</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-792"></a><span>             </span><a name="local-1628251942"><a href="#local-1628251942"><span class="hs-identifier">final_theta</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251938"><span class="hs-identifier hs-var">annotated_theta</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628251941"><span class="hs-identifier hs-var">inferred_diff</span></a><span>
</span><a name="line-793"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628251944"><a href="#local-1628251944"><span class="hs-identifier">partial_sigs</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#PartialTypeSignatures"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">PartialTypeSignatures</span></a><span>
</span><a name="line-794"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628251945"><a href="#local-1628251945"><span class="hs-identifier">warn_partial_sigs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a><span> </span><a href="DynFlags.html#Opt_WarnPartialTypeSignatures"><span class="hs-identifier hs-var">Opt_WarnPartialTypeSignatures</span></a><span>
</span><a name="line-795"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628251946"><a href="#local-1628251946"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#mkLongErrAt"><span class="hs-identifier hs-var">mkLongErrAt</span></a><span> </span><a href="#local-1628251937"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251925"><span class="hs-identifier hs-var">mk_msg</span></a><span> </span><a href="#local-1628251941"><span class="hs-identifier hs-var">inferred_diff</span></a><span> </span><a href="#local-1628251944"><span class="hs-identifier hs-var">partial_sigs</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-796"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;completeTheta&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-797"></a><span>            </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251920"><span class="hs-identifier hs-var">bndr_info</span></a><span>
</span><a name="line-798"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251938"><span class="hs-identifier hs-var">annotated_theta</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251917"><span class="hs-identifier hs-var">inferred_theta</span></a><span>
</span><a name="line-799"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251941"><span class="hs-identifier hs-var">inferred_diff</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-800"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628251944"><span class="hs-identifier hs-var">partial_sigs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-801"></a><span>           </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628251945"><span class="hs-identifier hs-var">warn_partial_sigs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-802"></a><span>                      </span><a href="TcRnMonad.html#reportWarning"><span class="hs-identifier hs-var">reportWarning</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="DynFlags.html#Opt_WarnPartialTypeSignatures"><span class="hs-identifier hs-var">Opt_WarnPartialTypeSignatures</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628251946"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-803"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-804"></a><span>           </span><span class="hs-identifier hs-var">False</span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#reportError"><span class="hs-identifier hs-var">reportError</span></a><span> </span><a href="#local-1628251946"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-805"></a><span>
</span><a name="line-806"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251927"><span class="hs-identifier hs-var">mk_binders</span></a><span> </span><a href="#local-1628251939"><span class="hs-identifier hs-var">free_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251942"><span class="hs-identifier hs-var">final_theta</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;chooseInferredQuantifiers&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251920"><span class="hs-identifier hs-var">bndr_info</span></a><span class="hs-special">)</span><span>
</span><a name="line-809"></a><span>
</span><a name="line-810"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-811"></a><span>    </span><a name="local-1628251924"><a href="#local-1628251924"><span class="hs-identifier">pts_hint</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;To use the inferred type, enable PartialTypeSignatures&quot;</span><span>
</span><a name="line-812"></a><span>    </span><a name="local-1628251925"><a href="#local-1628251925"><span class="hs-identifier">mk_msg</span></a></a><span> </span><a name="local-1628251928"><a href="#local-1628251928"><span class="hs-identifier">inferred_diff</span></a></a><span> </span><a name="local-1628251929"><a href="#local-1628251929"><span class="hs-identifier">suppress_hint</span></a></a><span>
</span><a name="line-813"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Found constraint wildcard&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'_'</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-814"></a><span>                   </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;standing for&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#pprTheta"><span class="hs-identifier hs-var">pprTheta</span></a><span> </span><a href="#local-1628251928"><span class="hs-identifier hs-var">inferred_diff</span></a><span class="hs-special">)</span><span>
</span><a name="line-815"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628251929"><span class="hs-identifier hs-var">suppress_hint</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-1628251924"><span class="hs-identifier hs-var">pts_hint</span></a><span>
</span><a name="line-816"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="TcBinds.html#typeSigCtxt"><span class="hs-identifier hs-var">typeSigCtxt</span></a><span> </span><a href="#local-1628251921"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-1628251920"><span class="hs-identifier hs-var">bndr_info</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-817"></a><span>
</span><a name="line-818"></a><span>    </span><a name="local-1628251926"><a href="#local-1628251926"><span class="hs-identifier">spec_tv_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-1628251923"><span class="hs-identifier hs-var">annotated_tvs</span></a><span>
</span><a name="line-819"></a><span>    </span><a name="local-1628251927"><a href="#local-1628251927"><span class="hs-identifier">mk_binders</span></a></a><span> </span><a name="local-1628251930"><a href="#local-1628251930"><span class="hs-identifier">free_tvs</span></a></a><span>
</span><a name="line-820"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="Type.html#mkNamedBinder"><span class="hs-identifier hs-var">mkNamedBinder</span></a><span> </span><a href="#local-1628251932"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-1628251931"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-821"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="local-1628251931"><a href="#local-1628251931"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251919"><span class="hs-identifier hs-var">qtvs</span></a><span>
</span><a name="line-822"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-1628251931"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628251930"><span class="hs-identifier hs-var">free_tvs</span></a><span>
</span><a name="line-823"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251932"><a href="#local-1628251932"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628251931"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628251926"><span class="hs-identifier hs-var">spec_tv_set</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span>
</span><a name="line-824"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Invisible"><span class="hs-identifier hs-var">Invisible</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-825"></a><span>                          </span><span class="hs-comment">-- Pulling from qtvs maintains original order</span><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span class="hs-identifier">mk_impedence_match_msg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcBinds.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a><span>
</span><a name="line-828"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-829"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-830"></a><span class="hs-comment">-- This is a rare but rather awkward error messages</span><span>
</span><a name="line-831"></a><a name="mk_impedence_match_msg"><a href="TcBinds.html#mk_impedence_match_msg"><span class="hs-identifier">mk_impedence_match_msg</span></a></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#MBI"><span class="hs-identifier hs-var">MBI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mbi_poly_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251947"><a href="#local-1628251947"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_sig</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628251948"><a href="#local-1628251948"><span class="hs-identifier">mb_sig</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-832"></a><span>                       </span><a name="local-1628251949"><a href="#local-1628251949"><span class="hs-identifier">inf_ty</span></a></a><span> </span><a name="local-1628251950"><a href="#local-1628251950"><span class="hs-identifier">sig_ty</span></a></a><span> </span><a name="local-1628251951"><a href="#local-1628251951"><span class="hs-identifier">tidy_env</span></a></a><span>
</span><a name="line-833"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628251954"><a href="#local-1628251954"><span class="hs-identifier">tidy_env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251955"><a href="#local-1628251955"><span class="hs-identifier">inf_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-1628251951"><span class="hs-identifier hs-var">tidy_env</span></a><span>  </span><a href="#local-1628251949"><span class="hs-identifier hs-var">inf_ty</span></a><span>
</span><a name="line-834"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628251956"><a href="#local-1628251956"><span class="hs-identifier">tidy_env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251957"><a href="#local-1628251957"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-1628251954"><span class="hs-identifier hs-var">tidy_env1</span></a><span> </span><a href="#local-1628251950"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-835"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251958"><a href="#local-1628251958"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;When checking that the inferred type&quot;</span><span>
</span><a name="line-836"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251947"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251955"><span class="hs-identifier hs-var">inf_ty</span></a><span>
</span><a name="line-837"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is as general as its&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628251952"><span class="hs-identifier hs-var">what</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;signature&quot;</span><span>
</span><a name="line-838"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251947"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251957"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-839"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251956"><span class="hs-identifier hs-var">tidy_env2</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251958"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-840"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-841"></a><span>    </span><a name="local-1628251952"><a href="#local-1628251952"><span class="hs-identifier">what</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628251948"><span class="hs-identifier hs-var">mb_sig</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-842"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;inferred&quot;</span><span>
</span><a name="line-843"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628251953"><a href="#local-1628251953"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#isPartialSig"><span class="hs-identifier hs-var">isPartialSig</span></a><span> </span><a href="#local-1628251953"><span class="hs-identifier hs-var">sig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(partial)&quot;</span><span>
</span><a name="line-844"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-845"></a><span>
</span><a name="line-846"></a><span>
</span><a name="line-847"></a><span class="hs-identifier">mk_inf_msg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-848"></a><a name="mk_inf_msg"><a href="TcBinds.html#mk_inf_msg"><span class="hs-identifier">mk_inf_msg</span></a></a><span> </span><a name="local-1628251959"><a href="#local-1628251959"><span class="hs-identifier">poly_name</span></a></a><span> </span><a name="local-1628251960"><a href="#local-1628251960"><span class="hs-identifier">poly_ty</span></a></a><span> </span><a name="local-1628251961"><a href="#local-1628251961"><span class="hs-identifier">tidy_env</span></a></a><span>
</span><a name="line-849"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628251962"><a href="#local-1628251962"><span class="hs-identifier">tidy_env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251963"><a href="#local-1628251963"><span class="hs-identifier">poly_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-1628251961"><span class="hs-identifier hs-var">tidy_env</span></a><span> </span><a href="#local-1628251960"><span class="hs-identifier hs-var">poly_ty</span></a><span>
</span><a name="line-850"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251964"><a href="#local-1628251964"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;When checking the inferred type&quot;</span><span>
</span><a name="line-851"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251959"><span class="hs-identifier hs-var">poly_name</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251963"><span class="hs-identifier hs-var">poly_ty</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-852"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251962"><span class="hs-identifier hs-var">tidy_env1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251964"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-853"></a><span>
</span><a name="line-854"></a><span>
</span><a name="line-855"></a><span class="hs-comment">-- | Warn the user about polymorphic local binders that lack type signatures.</span><span>
</span><a name="line-856"></a><span class="hs-identifier">localSigWarn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-857"></a><a name="localSigWarn"><a href="TcBinds.html#localSigWarn"><span class="hs-identifier">localSigWarn</span></a></a><span> </span><a name="local-1628251965"><a href="#local-1628251965"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-1628251966"><a href="#local-1628251966"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-1628251967"><a href="#local-1628251967"><span class="hs-identifier">mb_sig</span></a></a><span>
</span><a name="line-858"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251967"><span class="hs-identifier hs-var">mb_sig</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-859"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcType.html#isSigmaTy"><span class="hs-identifier hs-var">isSigmaTy</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628251966"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-860"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                      </span><span class="hs-glyph">=</span><span> </span><a href="TcBinds.html#warnMissingSignatures"><span class="hs-identifier hs-var">warnMissingSignatures</span></a><span> </span><a href="#local-1628251965"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="#local-1628251968"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-1628251966"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-861"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-862"></a><span>    </span><a name="local-1628251968"><a href="#local-1628251968"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Polymorphic local binding with no type signature:&quot;</span><span>
</span><a name="line-863"></a><span>
</span><a name="line-864"></a><span class="hs-identifier">warnMissingSignatures</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-865"></a><a name="warnMissingSignatures"><a href="TcBinds.html#warnMissingSignatures"><span class="hs-identifier">warnMissingSignatures</span></a></a><span> </span><a name="local-1628251969"><a href="#local-1628251969"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-1628251970"><a href="#local-1628251970"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-1628251971"><a href="#local-1628251971"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-866"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628251974"><a href="#local-1628251974"><span class="hs-identifier">env0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#tcInitTidyEnv"><span class="hs-identifier hs-var">tcInitTidyEnv</span></a><span>
</span><a name="line-867"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628251975"><a href="#local-1628251975"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628251976"><a href="#local-1628251976"><span class="hs-identifier">tidy_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyOpenType"><span class="hs-identifier hs-var">tidyOpenType</span></a><span> </span><a href="#local-1628251974"><span class="hs-identifier hs-var">env0</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628251971"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-868"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#addWarnTcM"><span class="hs-identifier hs-var">addWarnTcM</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="#local-1628251969"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628251975"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251972"><span class="hs-identifier hs-var">mk_msg</span></a><span> </span><a href="#local-1628251976"><span class="hs-identifier hs-var">tidy_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-869"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-870"></a><span>    </span><a name="local-1628251972"><a href="#local-1628251972"><span class="hs-identifier">mk_msg</span></a></a><span> </span><a name="local-1628251973"><a href="#local-1628251973"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628251970"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Name.html#pprPrefixName"><span class="hs-identifier hs-var">pprPrefixName</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628251971"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251973"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-871"></a><span>
</span><a name="line-872"></a><span class="hs-comment">{-
Note [Partial type signatures and generalisation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we have a partial type signature, like
   f :: _ -&gt; Int
then we *always* use the InferGen plan, and hence tcPolyInfer.
We do this even for a local binding with -XMonoLocalBinds.
Reasons:
  * The TcSigInfo for 'f' has a unification variable for the '_',
    whose TcLevel is one level deeper than the current level.
    (See pushTcLevelM in tcTySig.)  But NoGen doesn't increase
    the TcLevel like InferGen, so we lose the level invariant.

  * The signature might be   f :: forall a. _ -&gt; a
    so it really is polymorphic.  It's not clear what it would
    mean to use NoGen on this, and indeed the ASSERT in tcLhs,
    in the (Just sig) case, checks that if there is a signature
    then we are using LetLclBndr, and hence a nested AbsBinds with
    increased TcLevel

It might be possible to fix these difficulties somehow, but there
doesn't seem much point.  Indeed, adding a partial type signature is a
way to get per-binding inferred generalisation.

Note [Validity of inferred types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We need to check inferred type for validity, in case it uses language
extensions that are not turned on.  The principle is that if the user
simply adds the inferred type to the program source, it'll compile fine.
See #8883.

Examples that might fail:
 - the type might be ambiguous

 - an inferred theta that requires type equalities e.g. (F a ~ G b)
                                or multi-parameter type classes
 - an inferred type that includes unboxed tuples


Note [Impedence matching]
~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
   f 0 x = x
   f n x = g [] (not x)

   g [] y = f 10 y
   g _  y = f 9  y

After typechecking we'll get
  f_mono_ty :: a -&gt; Bool -&gt; Bool
  g_mono_ty :: [b] -&gt; Bool -&gt; Bool
with constraints
  (Eq a, Num a)

Note that f is polymorphic in 'a' and g in 'b'; and these are not linked.
The types we really want for f and g are
   f :: forall a. (Eq a, Num a) =&gt; a -&gt; Bool -&gt; Bool
   g :: forall b. [b] -&gt; Bool -&gt; Bool

We can get these by &quot;impedance matching&quot;:
   tuple :: forall a b. (Eq a, Num a) =&gt; (a -&gt; Bool -&gt; Bool, [b] -&gt; Bool -&gt; Bool)
   tuple a b d1 d1 = let ...bind f_mono, g_mono in (f_mono, g_mono)

   f a d1 d2 = case tuple a Any d1 d2 of (f, g) -&gt; f
   g b = case tuple Integer b dEqInteger dNumInteger of (f,g) -&gt; g

Suppose the shared quantified tyvars are qtvs and constraints theta.
Then we want to check that
     forall qtvs. theta =&gt; f_mono_ty   is more polymorphic than   f's polytype
and the proof is the impedance matcher.

Notice that the impedance matcher may do defaulting.  See Trac #7173.

It also cleverly does an ambiguity check; for example, rejecting
   f :: F a -&gt; F a
where F is a non-injective type function.
-}</span><span>
</span><a name="line-949"></a><span>
</span><a name="line-950"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-951"></a><span class="hs-comment">-- If typechecking the binds fails, then return with each</span><span>
</span><a name="line-952"></a><span class="hs-comment">-- signature-less binder given type (forall a.a), to minimise</span><span>
</span><a name="line-953"></a><span class="hs-comment">-- subsequent error messages</span><span>
</span><a name="line-954"></a><span class="hs-identifier">recoveryCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-955"></a><a name="recoveryCode"><a href="TcBinds.html#recoveryCode"><span class="hs-identifier">recoveryCode</span></a></a><span> </span><a name="local-1628251977"><a href="#local-1628251977"><span class="hs-identifier">binder_names</span></a></a><span> </span><a name="local-1628251978"><a href="#local-1628251978"><span class="hs-identifier">sig_fn</span></a></a><span>
</span><a name="line-956"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcBindsWithSigs: error recovery&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628251977"><span class="hs-identifier hs-var">binder_names</span></a><span class="hs-special">)</span><span>
</span><a name="line-957"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628251983"><a href="#local-1628251983"><span class="hs-identifier">poly_ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628251979"><span class="hs-identifier hs-var">mk_dummy</span></a><span> </span><a href="#local-1628251977"><span class="hs-identifier hs-var">binder_names</span></a><span>
</span><a name="line-958"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628251983"><span class="hs-identifier hs-var">poly_ids</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-959"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-960"></a><span>    </span><a name="local-1628251979"><a href="#local-1628251979"><span class="hs-identifier">mk_dummy</span></a></a><span> </span><a name="local-1628251980"><a href="#local-1628251980"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-961"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628251981"><a href="#local-1628251981"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628251978"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628251980"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-962"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628251982"><a href="#local-1628251982"><span class="hs-identifier">poly_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnTypes.html#completeSigPolyId_maybe"><span class="hs-identifier hs-var">completeSigPolyId_maybe</span></a><span> </span><a href="#local-1628251981"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-963"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628251982"><span class="hs-identifier hs-var">poly_id</span></a><span>
</span><a name="line-964"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-965"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a><span> </span><a href="#local-1628251980"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="TcBinds.html#forall_a_a"><span class="hs-identifier hs-var">forall_a_a</span></a><span>
</span><a name="line-966"></a><span>
</span><a name="line-967"></a><span class="hs-identifier">forall_a_a</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-968"></a><a name="forall_a_a"><a href="TcBinds.html#forall_a_a"><span class="hs-identifier">forall_a_a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a><span> </span><span class="hs-special">[</span><a href="TysPrim.html#runtimeRep1TyVar"><span class="hs-identifier hs-var">runtimeRep1TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TysPrim.html#openAlphaTyVar"><span class="hs-identifier hs-var">openAlphaTyVar</span></a><span class="hs-special">]</span><span> </span><a href="TysPrim.html#openAlphaTy"><span class="hs-identifier hs-var">openAlphaTy</span></a><span>
</span><a name="line-969"></a><span>
</span><a name="line-970"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   Pragmas, including SPECIALISE
*                                                                      *
************************************************************************

Note [Handling SPECIALISE pragmas]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The basic idea is this:

   foo :: Num a =&gt; a -&gt; b -&gt; a
   {-# SPECIALISE foo :: Int -&gt; b -&gt; Int #-}

We check that
   (forall a b. Num a =&gt; a -&gt; b -&gt; a)
      is more polymorphic than
   forall b. Int -&gt; b -&gt; Int
(for which we could use tcSubType, but see below), generating a HsWrapper
to connect the two, something like
      wrap = /\b. &lt;hole&gt; Int b dNumInt
This wrapper is put in the TcSpecPrag, in the ABExport record of
the AbsBinds.


        f :: (Eq a, Ix b) =&gt; a -&gt; b -&gt; Bool
        {-# SPECIALISE f :: (Ix p, Ix q) =&gt; Int -&gt; (p,q) -&gt; Bool #-}
        f = &lt;poly_rhs&gt;

From this the typechecker generates

    AbsBinds [ab] [d1,d2] [([ab], f, f_mono, prags)] binds

    SpecPrag (wrap_fn :: forall a b. (Eq a, Ix b) =&gt; XXX
                      -&gt; forall p q. (Ix p, Ix q) =&gt; XXX[ Int/a, (p,q)/b ])

From these we generate:

    Rule:       forall p, q, (dp:Ix p), (dq:Ix q).
                    f Int (p,q) dInt ($dfInPair dp dq) = f_spec p q dp dq

    Spec bind:  f_spec = wrap_fn &lt;poly_rhs&gt;

Note that

  * The LHS of the rule may mention dictionary *expressions* (eg
    $dfIxPair dp dq), and that is essential because the dp, dq are
    needed on the RHS.

  * The RHS of f_spec, &lt;poly_rhs&gt; has a *copy* of 'binds', so that it
    can fully specialise it.



From the TcSpecPrag, in DsBinds we generate a binding for f_spec and a RULE:

   f_spec :: Int -&gt; b -&gt; Int
   f_spec = wrap&lt;f rhs&gt;

   RULE: forall b (d:Num b). f b d = f_spec b

The RULE is generated by taking apart the HsWrapper, which is a little
delicate, but works.

Some wrinkles

1. We don't use full-on tcSubType, because that does co and contra
   variance and that in turn will generate too complex a LHS for the
   RULE.  So we use a single invocation of skolemise /
   topInstantiate in tcSpecWrapper.  (Actually I think that even
   the &quot;deeply&quot; stuff may be too much, because it introduces lambdas,
   though I think it can be made to work without too much trouble.)

2. We need to take care with type families (Trac #5821).  Consider
      type instance F Int = Bool
      f :: Num a =&gt; a -&gt; F a
      {-# SPECIALISE foo :: Int -&gt; Bool #-}

  We *could* try to generate an f_spec with precisely the declared type:
      f_spec :: Int -&gt; Bool
      f_spec = &lt;f rhs&gt; Int dNumInt |&gt; co

      RULE: forall d. f Int d = f_spec |&gt; sym co

  but the 'co' and 'sym co' are (a) playing no useful role, and (b) are
  hard to generate.  At all costs we must avoid this:
      RULE: forall d. f Int d |&gt; co = f_spec
  because the LHS will never match (indeed it's rejected in
  decomposeRuleLhs).

  So we simply do this:
    - Generate a constraint to check that the specialised type (after
      skolemiseation) is equal to the instantiated function type.
    - But *discard* the evidence (coercion) for that constraint,
      so that we ultimately generate the simpler code
          f_spec :: Int -&gt; F Int
          f_spec = &lt;f rhs&gt; Int dNumInt

          RULE: forall d. f Int d = f_spec
      You can see this discarding happening in

3. Note that the HsWrapper can transform *any* function with the right
   type prefix
       forall ab. (Eq a, Ix b) =&gt; XXX
   regardless of XXX.  It's sort of polymorphic in XXX.  This is
   useful: we use the same wrapper to transform each of the class ops, as
   well as the dict.  That's what goes on in TcInstDcls.mk_meth_spec_prags
-}</span><span>
</span><a name="line-1077"></a><span>
</span><a name="line-1078"></a><span class="hs-identifier">mkPragEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span>
</span><a name="line-1079"></a><a name="mkPragEnv"><a href="TcBinds.html#mkPragEnv"><span class="hs-identifier">mkPragEnv</span></a></a><span> </span><a name="local-1628251984"><a href="#local-1628251984"><span class="hs-identifier">sigs</span></a></a><span> </span><a name="local-1628251985"><a href="#local-1628251985"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-1080"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a><span> </span><a href="TcBinds.html#extendPragEnv"><span class="hs-identifier hs-var">extendPragEnv</span></a><span> </span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span> </span><a href="#local-1628251986"><span class="hs-identifier hs-var">prs</span></a><span>
</span><a name="line-1081"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1082"></a><span>    </span><a name="local-1628251986"><a href="#local-1628251986"><span class="hs-identifier">prs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a><span> </span><a href="#local-1628251987"><span class="hs-identifier hs-var">get_sig</span></a><span> </span><a href="#local-1628251984"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-1083"></a><span>
</span><a name="line-1084"></a><span>    </span><span class="hs-identifier">get_sig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1085"></a><span>    </span><a name="local-1628251987"><a href="#local-1628251987"><span class="hs-identifier">get_sig</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628251990"><a href="#local-1628251990"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#SpecSig"><span class="hs-identifier hs-var">SpecSig</span></a><span> </span><a name="local-1628251991"><a href="#local-1628251991"><span class="hs-identifier">lnm</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628251992"><a href="#local-1628251992"><span class="hs-identifier">nm</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628251993"><a href="#local-1628251993"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1628251994"><a href="#local-1628251994"><span class="hs-identifier">inl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251992"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628251990"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsBinds.html#SpecSig"><span class="hs-identifier hs-var">SpecSig</span></a><span>   </span><a href="#local-1628251991"><span class="hs-identifier hs-var">lnm</span></a><span> </span><a href="#local-1628251993"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251988"><span class="hs-identifier hs-var">add_arity</span></a><span> </span><a href="#local-1628251992"><span class="hs-identifier hs-var">nm</span></a><span> </span><a href="#local-1628251994"><span class="hs-identifier hs-var">inl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1086"></a><span>    </span><span class="hs-identifier">get_sig</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628251995"><a href="#local-1628251995"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#InlineSig"><span class="hs-identifier hs-var">InlineSig</span></a><span> </span><a name="local-1628251996"><a href="#local-1628251996"><span class="hs-identifier">lnm</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628251997"><a href="#local-1628251997"><span class="hs-identifier">nm</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628251998"><a href="#local-1628251998"><span class="hs-identifier">inl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628251997"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628251995"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsBinds.html#InlineSig"><span class="hs-identifier hs-var">InlineSig</span></a><span> </span><a href="#local-1628251996"><span class="hs-identifier hs-var">lnm</span></a><span>    </span><span class="hs-special">(</span><a href="#local-1628251988"><span class="hs-identifier hs-var">add_arity</span></a><span> </span><a href="#local-1628251997"><span class="hs-identifier hs-var">nm</span></a><span> </span><a href="#local-1628251998"><span class="hs-identifier hs-var">inl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1087"></a><span>    </span><span class="hs-identifier">get_sig</span><span> </span><span class="hs-identifier">_</span><span>                                   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1088"></a><span>
</span><a name="line-1089"></a><span>    </span><a name="local-1628251988"><a href="#local-1628251988"><span class="hs-identifier">add_arity</span></a></a><span> </span><a name="local-1628251999"><a href="#local-1628251999"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1628252000"><a href="#local-1628252000"><span class="hs-identifier">inl_prag</span></a></a><span>   </span><span class="hs-comment">-- Adjust inl_sat field to match visible arity of function</span><span>
</span><a name="line-1090"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="BasicTypes.html#Inline"><span class="hs-identifier hs-var">Inline</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">inl_inline</span><span> </span><a href="#local-1628252000"><span class="hs-identifier hs-var">inl_prag</span></a><span>
</span><a name="line-1091"></a><span>        </span><span class="hs-comment">-- add arity only for real INLINE pragmas, not INLINABLE</span><span>
</span><a name="line-1092"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-1628251989"><span class="hs-identifier hs-var">ar_env</span></a><span> </span><a href="#local-1628251999"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1093"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628252001"><a href="#local-1628252001"><span class="hs-identifier">ar</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628252000"><span class="hs-identifier hs-var">inl_prag</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inl_sat</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628252001"><span class="hs-identifier hs-var">ar</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1094"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span> </span><a href="Outputable.html#warnPprTrace"><span class="hs-identifier hs-var">True</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;mkPragEnv no arity&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1095"></a><span>                     </span><span class="hs-comment">-- There really should be a binding for every INLINE pragma</span><span>
</span><a name="line-1096"></a><span>                     </span><a href="#local-1628252000"><span class="hs-identifier hs-var">inl_prag</span></a><span>
</span><a name="line-1097"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1098"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252000"><span class="hs-identifier hs-var">inl_prag</span></a><span>
</span><a name="line-1099"></a><span>
</span><a name="line-1100"></a><span>    </span><span class="hs-comment">-- ar_env maps a local to the arity of its definition</span><span>
</span><a name="line-1101"></a><span>    </span><span class="hs-identifier">ar_env</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span>
</span><a name="line-1102"></a><span>    </span><a name="local-1628251989"><a href="#local-1628251989"><span class="hs-identifier">ar_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#foldrBag"><span class="hs-identifier hs-var">foldrBag</span></a><span> </span><a href="TcBinds.html#lhsBindArity"><span class="hs-identifier hs-var">lhsBindArity</span></a><span> </span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span> </span><a href="#local-1628251985"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-1103"></a><span>
</span><a name="line-1104"></a><span class="hs-identifier">extendPragEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a><span>
</span><a name="line-1105"></a><a name="extendPragEnv"><a href="TcBinds.html#extendPragEnv"><span class="hs-identifier">extendPragEnv</span></a></a><span> </span><a name="local-1628252002"><a href="#local-1628252002"><span class="hs-identifier">prag_fn</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628252003"><a href="#local-1628252003"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252004"><a href="#local-1628252004"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#extendNameEnv_Acc"><span class="hs-identifier hs-var">extendNameEnv_Acc</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><a href="Util.html#singleton"><span class="hs-identifier hs-var">singleton</span></a><span> </span><a href="#local-1628252002"><span class="hs-identifier hs-var">prag_fn</span></a><span> </span><a href="#local-1628252003"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-1628252004"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-1106"></a><span>
</span><a name="line-1107"></a><span class="hs-identifier">lhsBindArity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span>
</span><a name="line-1108"></a><a name="lhsBindArity"><a href="TcBinds.html#lhsBindArity"><span class="hs-identifier">lhsBindArity</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252005"><a href="#local-1628252005"><span class="hs-identifier">id</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252006"><a href="#local-1628252006"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-1628252007"><a href="#local-1628252007"><span class="hs-identifier">env</span></a></a><span>
</span><a name="line-1109"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#extendNameEnv"><span class="hs-identifier hs-var">extendNameEnv</span></a><span> </span><a href="#local-1628252007"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628252005"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#matchGroupArity"><span class="hs-identifier hs-var">matchGroupArity</span></a><span> </span><a href="#local-1628252006"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-1110"></a><span class="hs-identifier">lhsBindArity</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252008"><a href="#local-1628252008"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252008"><span class="hs-identifier hs-var">env</span></a><span>        </span><span class="hs-comment">-- PatBind/VarBind</span><span>
</span><a name="line-1111"></a><span>
</span><a name="line-1112"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-1113"></a><span class="hs-identifier">tcSpecPrags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1114"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LTcSpecPrag"><span class="hs-identifier hs-type">LTcSpecPrag</span></a><span class="hs-special">]</span><span>
</span><a name="line-1115"></a><span class="hs-comment">-- Add INLINE and SPECIALSE pragmas</span><span>
</span><a name="line-1116"></a><span class="hs-comment">--    INLINE prags are added to the (polymorphic) Id directly</span><span>
</span><a name="line-1117"></a><span class="hs-comment">--    SPECIALISE prags are passed to the desugarer via TcSpecPrags</span><span>
</span><a name="line-1118"></a><span class="hs-comment">-- Pre-condition: the poly_id is zonked</span><span>
</span><a name="line-1119"></a><span class="hs-comment">-- Reason: required by tcSubExp</span><span>
</span><a name="line-1120"></a><a name="tcSpecPrags"><a href="TcBinds.html#tcSpecPrags"><span class="hs-identifier">tcSpecPrags</span></a></a><span> </span><a name="local-1628252009"><a href="#local-1628252009"><span class="hs-identifier">poly_id</span></a></a><span> </span><a name="local-1628252010"><a href="#local-1628252010"><span class="hs-identifier">prag_sigs</span></a></a><span>
</span><a name="line-1121"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcSpecPrags&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252009"><span class="hs-identifier hs-var">poly_id</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252011"><span class="hs-identifier hs-var">spec_sigs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1122"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628252012"><span class="hs-identifier hs-var">bad_sigs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252014"><span class="hs-identifier hs-var">warn_discarded_sigs</span></a><span>
</span><a name="line-1123"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628252016"><a href="#local-1628252016"><span class="hs-identifier">pss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#mapAndRecoverM"><span class="hs-identifier hs-var">mapAndRecoverM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#tcSpecPrag"><span class="hs-identifier hs-var">tcSpecPrag</span></a><span> </span><a href="#local-1628252009"><span class="hs-identifier hs-var">poly_id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628252011"><span class="hs-identifier hs-var">spec_sigs</span></a><span>
</span><a name="line-1124"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628252017"><a href="#local-1628252017"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1628252018"><a href="#local-1628252018"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628252017"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252018"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252016"><span class="hs-identifier hs-var">pss</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1125"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1126"></a><span>    </span><a name="local-1628252011"><a href="#local-1628252011"><span class="hs-identifier">spec_sigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="HsBinds.html#isSpecLSig"><span class="hs-identifier hs-var">isSpecLSig</span></a><span> </span><a href="#local-1628252010"><span class="hs-identifier hs-var">prag_sigs</span></a><span>
</span><a name="line-1127"></a><span>    </span><a name="local-1628252012"><a href="#local-1628252012"><span class="hs-identifier">bad_sigs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-1628252013"><span class="hs-identifier hs-var">is_bad_sig</span></a><span> </span><a href="#local-1628252010"><span class="hs-identifier hs-var">prag_sigs</span></a><span>
</span><a name="line-1128"></a><span>    </span><a name="local-1628252013"><a href="#local-1628252013"><span class="hs-identifier">is_bad_sig</span></a></a><span> </span><a name="local-1628252015"><a href="#local-1628252015"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#isSpecLSig"><span class="hs-identifier hs-var">isSpecLSig</span></a><span> </span><a href="#local-1628252015"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="HsBinds.html#isInlineLSig"><span class="hs-identifier hs-var">isInlineLSig</span></a><span> </span><a href="#local-1628252015"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1129"></a><span>
</span><a name="line-1130"></a><span>    </span><a name="local-1628252014"><a href="#local-1628252014"><span class="hs-identifier">warn_discarded_sigs</span></a></a><span>
</span><a name="line-1131"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addWarnTc"><span class="hs-identifier hs-var">addWarnTc</span></a><span> </span><a href="DynFlags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a><span>
</span><a name="line-1132"></a><span>                  </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Discarding unexpected pragmas for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252009"><span class="hs-identifier hs-var">poly_id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1133"></a><span>                      </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252012"><span class="hs-identifier hs-var">bad_sigs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1134"></a><span>
</span><a name="line-1135"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-1136"></a><span class="hs-identifier">tcSpecPrag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#Sig"><span class="hs-identifier hs-type">Sig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="HsBinds.html#TcSpecPrag"><span class="hs-identifier hs-type">TcSpecPrag</span></a><span class="hs-special">]</span><span>
</span><a name="line-1137"></a><a name="tcSpecPrag"><a href="TcBinds.html#tcSpecPrag"><span class="hs-identifier">tcSpecPrag</span></a></a><span> </span><a name="local-1628252019"><a href="#local-1628252019"><span class="hs-identifier">poly_id</span></a></a><span> </span><a name="local-1628252020"><a href="#local-1628252020"><span class="hs-identifier">prag</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsBinds.html#SpecSig"><span class="hs-identifier hs-var">SpecSig</span></a><span> </span><a name="local-1628252021"><a href="#local-1628252021"><span class="hs-identifier">fun_name</span></a></a><span> </span><a name="local-1628252022"><a href="#local-1628252022"><span class="hs-identifier">hs_tys</span></a></a><span> </span><a name="local-1628252023"><a href="#local-1628252023"><span class="hs-identifier">inl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1138"></a><span class="hs-comment">-- See Note [Handling SPECIALISE pragmas]</span><span>
</span><a name="line-1139"></a><span class="hs-comment">--</span><span>
</span><a name="line-1140"></a><span class="hs-comment">-- The Name fun_name in the SpecSig may not be the same as that of the poly_id</span><span>
</span><a name="line-1141"></a><span class="hs-comment">-- Example: SPECIALISE for a class method: the Name in the SpecSig is</span><span>
</span><a name="line-1142"></a><span class="hs-comment">--          for the selector Id, but the poly_id is something like $cop</span><span>
</span><a name="line-1143"></a><span class="hs-comment">-- However we want to use fun_name in the error message, since that is</span><span>
</span><a name="line-1144"></a><span class="hs-comment">-- what the user wrote (Trac #8537)</span><span>
</span><a name="line-1145"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628252026"><span class="hs-identifier hs-var">spec_ctxt</span></a><span> </span><a href="#local-1628252020"><span class="hs-identifier hs-var">prag</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1146"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#warnIf"><span class="hs-identifier hs-var">warnIf</span></a><span> </span><a href="DynFlags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcType.html#isOverloadedTy"><span class="hs-identifier hs-var">isOverloadedTy</span></a><span> </span><a href="#local-1628252025"><span class="hs-identifier hs-var">poly_ty</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="BasicTypes.html#isInlinePragma"><span class="hs-identifier hs-var">isInlinePragma</span></a><span> </span><a href="#local-1628252023"><span class="hs-identifier hs-var">inl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1147"></a><span>                 </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;SPECIALISE pragma for non-overloaded function&quot;</span><span>
</span><a name="line-1148"></a><span>                  </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252021"><span class="hs-identifier hs-var">fun_name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1149"></a><span>                  </span><span class="hs-comment">-- Note [SPECIALISE pragmas]</span><span>
</span><a name="line-1150"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628252032"><a href="#local-1628252032"><span class="hs-identifier">spec_prags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628252027"><span class="hs-identifier hs-var">tc_one</span></a><span> </span><a href="#local-1628252022"><span class="hs-identifier hs-var">hs_tys</span></a><span>
</span><a name="line-1151"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcSpecPrag&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252019"><span class="hs-identifier hs-var">poly_id</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252032"><span class="hs-identifier hs-var">spec_prags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1152"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628252032"><span class="hs-identifier hs-var">spec_prags</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1153"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1154"></a><span>    </span><a name="local-1628252024"><a href="#local-1628252024"><span class="hs-identifier">name</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628252019"><span class="hs-identifier hs-var">poly_id</span></a><span>
</span><a name="line-1155"></a><span>    </span><a name="local-1628252025"><a href="#local-1628252025"><span class="hs-identifier">poly_ty</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628252019"><span class="hs-identifier hs-var">poly_id</span></a><span>
</span><a name="line-1156"></a><span>    </span><a name="local-1628252026"><a href="#local-1628252026"><span class="hs-identifier">spec_ctxt</span></a></a><span> </span><a name="local-1628252028"><a href="#local-1628252028"><span class="hs-identifier">prag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In the SPECIALISE pragma&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252028"><span class="hs-identifier hs-var">prag</span></a><span class="hs-special">)</span><span>
</span><a name="line-1157"></a><span>
</span><a name="line-1158"></a><span>    </span><a name="local-1628252027"><a href="#local-1628252027"><span class="hs-identifier">tc_one</span></a></a><span> </span><a name="local-1628252029"><a href="#local-1628252029"><span class="hs-identifier">hs_ty</span></a></a><span>
</span><a name="line-1159"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252030"><a href="#local-1628252030"><span class="hs-identifier">spec_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsSigType"><span class="hs-identifier hs-var">tcHsSigType</span></a><span>   </span><span class="hs-special">(</span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a href="#local-1628252024"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><a href="#local-1628252029"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-1160"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-1628252031"><a href="#local-1628252031"><span class="hs-identifier">wrap</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcSpecWrapper"><span class="hs-identifier hs-var">tcSpecWrapper</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a href="#local-1628252024"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>  </span><a href="#local-1628252025"><span class="hs-identifier hs-var">poly_ty</span></a><span> </span><a href="#local-1628252030"><span class="hs-identifier hs-var">spec_ty</span></a><span>
</span><a name="line-1161"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#SpecPrag"><span class="hs-identifier hs-var">SpecPrag</span></a><span> </span><a href="#local-1628252019"><span class="hs-identifier hs-var">poly_id</span></a><span> </span><a href="#local-1628252031"><span class="hs-identifier hs-var">wrap</span></a><span> </span><a href="#local-1628252023"><span class="hs-identifier hs-var">inl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1162"></a><span>
</span><a name="line-1163"></a><span class="hs-identifier">tcSpecPrag</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252033"><a href="#local-1628252033"><span class="hs-identifier">prag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcSpecPrag&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252033"><span class="hs-identifier hs-var">prag</span></a><span class="hs-special">)</span><span>
</span><a name="line-1164"></a><span>
</span><a name="line-1165"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-1166"></a><span class="hs-identifier">tcSpecWrapper</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcEvidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a><span>
</span><a name="line-1167"></a><span class="hs-comment">-- A simpler variant of tcSubType, used for SPECIALISE pragmas</span><span>
</span><a name="line-1168"></a><span class="hs-comment">-- See Note [Handling SPECIALISE pragmas], wrinkle 1</span><span>
</span><a name="line-1169"></a><a name="tcSpecWrapper"><a href="TcBinds.html#tcSpecWrapper"><span class="hs-identifier">tcSpecWrapper</span></a></a><span> </span><a name="local-1628252034"><a href="#local-1628252034"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-1628252035"><a href="#local-1628252035"><span class="hs-identifier">poly_ty</span></a></a><span> </span><a name="local-1628252036"><a href="#local-1628252036"><span class="hs-identifier">spec_ty</span></a></a><span>
</span><a name="line-1170"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628252041"><a href="#local-1628252041"><span class="hs-identifier">sk_wrap</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252042"><a href="#local-1628252042"><span class="hs-identifier">inst_wrap</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1171"></a><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcUnify.html#tcSkolemise"><span class="hs-identifier hs-var">tcSkolemise</span></a><span> </span><a href="#local-1628252034"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-1628252036"><span class="hs-identifier hs-var">spec_ty</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252038"><a href="#local-1628252038"><span class="hs-identifier">spec_tau</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1172"></a><span>                  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628252039"><a href="#local-1628252039"><span class="hs-identifier">inst_wrap</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252040"><a href="#local-1628252040"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a><span> </span><a href="#local-1628252037"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="#local-1628252035"><span class="hs-identifier hs-var">poly_ty</span></a><span>
</span><a name="line-1173"></a><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcUnify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a><span> </span><a href="TcUnify.html#noThing"><span class="hs-identifier hs-var">noThing</span></a><span> </span><a href="#local-1628252038"><span class="hs-identifier hs-var">spec_tau</span></a><span> </span><a href="#local-1628252040"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-1174"></a><span>                            </span><span class="hs-comment">-- Deliberately ignore the evidence</span><span>
</span><a name="line-1175"></a><span>                            </span><span class="hs-comment">-- See Note [Handling SPECIALISE pragmas],</span><span>
</span><a name="line-1176"></a><span>                            </span><span class="hs-comment">--   wrinkle (2)</span><span>
</span><a name="line-1177"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628252039"><span class="hs-identifier hs-var">inst_wrap</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1178"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628252041"><span class="hs-identifier hs-var">sk_wrap</span></a><span> </span><a href="TcEvidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="#local-1628252042"><span class="hs-identifier hs-var">inst_wrap</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1179"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1180"></a><span>    </span><a name="local-1628252037"><a href="#local-1628252037"><span class="hs-identifier">orig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#SpecPragOrigin"><span class="hs-identifier hs-var">SpecPragOrigin</span></a><span> </span><a href="#local-1628252034"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-1181"></a><span>
</span><a name="line-1182"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-1183"></a><span class="hs-identifier">tcImpPrags</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LTcSpecPrag"><span class="hs-identifier hs-type">LTcSpecPrag</span></a><span class="hs-special">]</span><span>
</span><a name="line-1184"></a><span class="hs-comment">-- SPECIALISE pragmas for imported things</span><span>
</span><a name="line-1185"></a><a name="tcImpPrags"><a href="TcBinds.html#tcImpPrags"><span class="hs-identifier">tcImpPrags</span></a></a><span> </span><a name="local-1628252043"><a href="#local-1628252043"><span class="hs-identifier">prags</span></a></a><span>
</span><a name="line-1186"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252047"><a href="#local-1628252047"><span class="hs-identifier">this_mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a><span>
</span><a name="line-1187"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628252048"><a href="#local-1628252048"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-1188"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-1628252044"><span class="hs-identifier hs-var">not_specialising</span></a><span> </span><a href="#local-1628252048"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-1189"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1190"></a><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1191"></a><span>            </span><span class="hs-special">{</span><span> </span><a name="local-1628252052"><a href="#local-1628252052"><span class="hs-identifier">pss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#mapAndRecoverM"><span class="hs-identifier hs-var">mapAndRecoverM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="TcBinds.html#tcImpSpec"><span class="hs-identifier hs-var">tcImpSpec</span></a><span class="hs-special">)</span><span>
</span><a name="line-1192"></a><span>                     </span><span class="hs-special">[</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628252049"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628252051"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><a href="#local-1628252050"><span class="hs-identifier hs-var">prag</span></a><span class="hs-special">)</span><span>
</span><a name="line-1193"></a><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628252049"><a href="#local-1628252049"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628252050"><a href="#local-1628252050"><span class="hs-identifier">prag</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsBinds.html#SpecSig"><span class="hs-identifier hs-var">SpecSig</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252051"><a href="#local-1628252051"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252043"><span class="hs-identifier hs-var">prags</span></a><span>
</span><a name="line-1194"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a><span> </span><a href="#local-1628252047"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><a href="#local-1628252051"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1195"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628252053"><a href="#local-1628252053"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1628252054"><a href="#local-1628252054"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628252053"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252054"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252052"><span class="hs-identifier hs-var">pss</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1196"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1197"></a><span>    </span><span class="hs-comment">-- Ignore SPECIALISE pragmas for imported things</span><span>
</span><a name="line-1198"></a><span>    </span><span class="hs-comment">-- when we aren't specialising, or when we aren't generating</span><span>
</span><a name="line-1199"></a><span>    </span><span class="hs-comment">-- code.  The latter happens when Haddocking the base library;</span><span>
</span><a name="line-1200"></a><span>    </span><span class="hs-comment">-- we don't wnat complaints about lack of INLINABLE pragmas</span><span>
</span><a name="line-1201"></a><span>    </span><a name="local-1628252044"><a href="#local-1628252044"><span class="hs-identifier">not_specialising</span></a></a><span> </span><a name="local-1628252045"><a href="#local-1628252045"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-1202"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_Specialise"><span class="hs-identifier hs-var">Opt_Specialise</span></a><span> </span><a href="#local-1628252045"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1203"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">hscTarget</span><span> </span><a href="#local-1628252045"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1204"></a><span>                      </span><a href="DynFlags.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1205"></a><span>                      </span><a href="DynFlags.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1206"></a><span>                      </span><a name="local-1628252046"><a href="#local-1628252046"><span class="hs-identifier">_other</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1207"></a><span>
</span><a name="line-1208"></a><span class="hs-identifier">tcImpSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#Sig"><span class="hs-identifier hs-type">Sig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="HsBinds.html#TcSpecPrag"><span class="hs-identifier hs-type">TcSpecPrag</span></a><span class="hs-special">]</span><span>
</span><a name="line-1209"></a><a name="tcImpSpec"><a href="TcBinds.html#tcImpSpec"><span class="hs-identifier">tcImpSpec</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628252055"><a href="#local-1628252055"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252056"><a href="#local-1628252056"><span class="hs-identifier">prag</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1210"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252057"><a href="#local-1628252057"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a><span> </span><a href="#local-1628252055"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1211"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#isAnyInlinePragma"><span class="hs-identifier hs-var">isAnyInlinePragma</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idInlinePragma"><span class="hs-identifier hs-var">idInlinePragma</span></a><span> </span><a href="#local-1628252057"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1212"></a><span>               </span><span class="hs-special">(</span><a href="TcRnMonad.html#addWarnTc"><span class="hs-identifier hs-var">addWarnTc</span></a><span> </span><a href="DynFlags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#impSpecErr"><span class="hs-identifier hs-var">impSpecErr</span></a><span> </span><a href="#local-1628252055"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1213"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcBinds.html#tcSpecPrag"><span class="hs-identifier hs-var">tcSpecPrag</span></a><span> </span><a href="#local-1628252057"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-1628252056"><span class="hs-identifier hs-var">prag</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1214"></a><span>
</span><a name="line-1215"></a><span class="hs-identifier">impSpecErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1216"></a><a name="impSpecErr"><a href="TcBinds.html#impSpecErr"><span class="hs-identifier">impSpecErr</span></a></a><span> </span><a name="local-1628252058"><a href="#local-1628252058"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1217"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;You cannot SPECIALISE&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252058"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1218"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;because its definition has no INLINE/INLINABLE pragma&quot;</span><span>
</span><a name="line-1219"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span>
</span><a name="line-1220"></a><span>                   </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;or its defining module&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252059"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-1221"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;was compiled without -O&quot;</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1222"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1223"></a><span>    </span><a name="local-1628252059"><a href="#local-1628252059"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a><span> </span><a href="#local-1628252058"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1224"></a><span>
</span><a name="line-1225"></a><span>
</span><a name="line-1226"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                         Vectorisation
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-1231"></a><span>
</span><a name="line-1232"></a><span class="hs-identifier">tcVectDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LVectDecl"><span class="hs-identifier hs-type">LVectDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#LVectDecl"><span class="hs-identifier hs-type">LVectDecl</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1233"></a><a name="tcVectDecls"><a href="TcBinds.html#tcVectDecls"><span class="hs-identifier">tcVectDecls</span></a></a><span> </span><a name="local-1628252060"><a href="#local-1628252060"><span class="hs-identifier">decls</span></a></a><span>
</span><a name="line-1234"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252065"><a href="#local-1628252065"><span class="hs-identifier">decls'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="TcBinds.html#tcVect"><span class="hs-identifier hs-var">tcVect</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252060"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-1235"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628252066"><a href="#local-1628252066"><span class="hs-identifier">ids</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#lvectDeclName"><span class="hs-identifier hs-var">lvectDeclName</span></a><span> </span><a href="#local-1628252068"><span class="hs-identifier hs-var">decl</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628252068"><a href="#local-1628252068"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252065"><span class="hs-identifier hs-var">decls'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#lvectInstDecl"><span class="hs-identifier hs-var">lvectInstDecl</span></a><span> </span><a href="#local-1628252068"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">]</span><span>
</span><a name="line-1236"></a><span>             </span><a name="local-1628252067"><a href="#local-1628252067"><span class="hs-identifier">dups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ListSetOps.html#findDupsEq"><span class="hs-identifier hs-var">findDupsEq</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><a href="#local-1628252066"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-1237"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="#local-1628252061"><span class="hs-identifier hs-var">reportVectDups</span></a><span> </span><a href="#local-1628252067"><span class="hs-identifier hs-var">dups</span></a><span>
</span><a name="line-1238"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTcConstraints"><span class="hs-identifier hs-var">traceTcConstraints</span></a><span> </span><span class="hs-string">&quot;End of tcVectDecls&quot;</span><span>
</span><a name="line-1239"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628252065"><span class="hs-identifier hs-var">decls'</span></a><span>
</span><a name="line-1240"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1241"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1242"></a><span>    </span><a name="local-1628252061"><a href="#local-1628252061"><span class="hs-identifier">reportVectDups</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628252062"><a href="#local-1628252062"><span class="hs-identifier">first</span></a></a><span class="hs-glyph">:</span><a name="local-1628252063"><a href="#local-1628252063"><span class="hs-identifier">_second</span></a></a><span class="hs-glyph">:</span><a name="local-1628252064"><a href="#local-1628252064"><span class="hs-identifier">_more</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1243"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a><span> </span><a href="#local-1628252062"><span class="hs-identifier hs-var">first</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1244"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Duplicate vectorisation declarations for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252062"><span class="hs-identifier hs-var">first</span></a><span>
</span><a name="line-1245"></a><span>    </span><span class="hs-identifier">reportVectDups</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1246"></a><span>
</span><a name="line-1247"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-1248"></a><span class="hs-identifier">tcVect</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#VectDecl"><span class="hs-identifier hs-type">VectDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#VectDecl"><span class="hs-identifier hs-type">VectDecl</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">)</span><span>
</span><a name="line-1249"></a><span class="hs-comment">-- FIXME: We can't typecheck the expression of a vectorisation declaration against the vectorised</span><span>
</span><a name="line-1250"></a><span class="hs-comment">--   type of the original definition as this requires internals of the vectoriser not available</span><span>
</span><a name="line-1251"></a><span class="hs-comment">--   during type checking.  Instead, constrain the rhs of a vectorisation declaration to be a single</span><span>
</span><a name="line-1252"></a><span class="hs-comment">--   identifier (this is checked in 'rnHsVectDecl').  Fix this by enabling the use of 'vectType'</span><span>
</span><a name="line-1253"></a><span class="hs-comment">--   from the vectoriser here.</span><span>
</span><a name="line-1254"></a><a name="tcVect"><a href="TcBinds.html#tcVect"><span class="hs-identifier">tcVect</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVect"><span class="hs-identifier hs-var">HsVect</span></a><span> </span><a name="local-1628252069"><a href="#local-1628252069"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1628252070"><a href="#local-1628252070"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-1628252071"><a href="#local-1628252071"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1255"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#vectCtxt"><span class="hs-identifier hs-var">vectCtxt</span></a><span> </span><a href="#local-1628252070"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1256"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252072"><a href="#local-1628252072"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="TcEnv.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a><span> </span><a href="#local-1628252070"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1257"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628252073"><a href="#local-1628252073"><span class="hs-identifier">rhs_loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628252074"><a href="#local-1628252074"><span class="hs-identifier">lv</span></a></a><span> </span><a name="local-1628252075"><a href="#local-1628252075"><span class="hs-identifier">rhs_var_name</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252071"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1258"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628252076"><a href="#local-1628252076"><span class="hs-identifier">rhs_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a><span> </span><a href="#local-1628252075"><span class="hs-identifier hs-var">rhs_var_name</span></a><span>
</span><a name="line-1259"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#HsVect"><span class="hs-identifier hs-var">HsVect</span></a><span> </span><a href="#local-1628252069"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1628252072"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628252073"><span class="hs-identifier hs-var">rhs_loc</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628252074"><span class="hs-identifier hs-var">lv</span></a><span> </span><a href="#local-1628252076"><span class="hs-identifier hs-var">rhs_id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1260"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1261"></a><span>
</span><a name="line-1262"></a><span class="hs-comment">{- OLD CODE:
         -- turn the vectorisation declaration into a single non-recursive binding
       ; let bind    = L loc $ mkTopFunBind name [mkSimpleMatch [] rhs]
             sigFun  = const Nothing
             pragFun = emptyPragEnv

         -- perform type inference (including generalisation)
       ; (binds, [id'], _) &lt;- tcPolyInfer False True sigFun pragFun NonRecursive [bind]

       ; traceTc &quot;tcVect inferred type&quot; $ ppr (varType id')
       ; traceTc &quot;tcVect bindings&quot;      $ ppr binds

         -- add all bindings, including the type variable and dictionary bindings produced by type
         -- generalisation to the right-hand side of the vectorisation declaration
       ; let [AbsBinds tvs evs _ evBinds actualBinds] = (map unLoc . bagToList) binds
       ; let [bind']                                  = bagToList actualBinds
             MatchGroup
               [L _ (Match _ _ (GRHSs [L _ (GRHS _ rhs')] _))]
               _                                      = (fun_matches . unLoc) bind'
             rhsWrapped                               = mkHsLams tvs evs (mkHsDictLet evBinds rhs')

        -- We return the type-checked 'Id', to propagate the inferred signature
        -- to the vectoriser - see &quot;Note [Typechecked vectorisation pragmas]&quot; in HsDecls
       ; return $ HsVect (L loc id') (Just rhsWrapped)
       }
 -}</span><span>
</span><a name="line-1288"></a><span class="hs-identifier">tcVect</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsNoVect"><span class="hs-identifier hs-var">HsNoVect</span></a><span> </span><a name="local-1628252077"><a href="#local-1628252077"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1628252078"><a href="#local-1628252078"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1289"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#vectCtxt"><span class="hs-identifier hs-var">vectCtxt</span></a><span> </span><a href="#local-1628252078"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1290"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252079"><a href="#local-1628252079"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="TcEnv.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a><span> </span><a href="#local-1628252078"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1291"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#HsNoVect"><span class="hs-identifier hs-var">HsNoVect</span></a><span> </span><a href="#local-1628252077"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1628252079"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-1292"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1293"></a><span class="hs-identifier">tcVect</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectTypeIn"><span class="hs-identifier hs-var">HsVectTypeIn</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252080"><a href="#local-1628252080"><span class="hs-identifier">isScalar</span></a></a><span> </span><a name="local-1628252081"><a href="#local-1628252081"><span class="hs-identifier">lname</span></a></a><span> </span><a name="local-1628252082"><a href="#local-1628252082"><span class="hs-identifier">rhs_name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1294"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#vectCtxt"><span class="hs-identifier hs-var">vectCtxt</span></a><span> </span><a href="#local-1628252081"><span class="hs-identifier hs-var">lname</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1295"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252083"><a href="#local-1628252083"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupLocatedTyCon"><span class="hs-identifier hs-var">tcLookupLocatedTyCon</span></a><span> </span><a href="#local-1628252081"><span class="hs-identifier hs-var">lname</span></a><span>
</span><a name="line-1296"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a><span> </span><span class="hs-special">(</span><span>   </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1628252080"><span class="hs-identifier hs-var">isScalar</span></a><span>             </span><span class="hs-comment">-- either    we have a non-SCALAR declaration</span><span>
</span><a name="line-1297"></a><span>                 </span><span class="hs-operator hs-var">||</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a><span> </span><a href="#local-1628252082"><span class="hs-identifier hs-var">rhs_name</span></a><span>           </span><span class="hs-comment">-- or        we explicitly provide a vectorised type</span><span>
</span><a name="line-1298"></a><span>                 </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-1628252083"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>     </span><span class="hs-comment">-- otherwise the type constructor must be nullary</span><span>
</span><a name="line-1299"></a><span>                 </span><span class="hs-special">)</span><span>
</span><a name="line-1300"></a><span>                 </span><a href="TcBinds.html#scalarTyConMustBeNullary"><span class="hs-identifier hs-var">scalarTyConMustBeNullary</span></a><span>
</span><a name="line-1301"></a><span>
</span><a name="line-1302"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628252084"><a href="#local-1628252084"><span class="hs-identifier">rhs_tycon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MonadUtils.html#fmapMaybeM"><span class="hs-identifier hs-var">fmapMaybeM</span></a><span> </span><span class="hs-special">(</span><a href="TcEnv.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252082"><span class="hs-identifier hs-var">rhs_name</span></a><span>
</span><a name="line-1303"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#HsVectTypeOut"><span class="hs-identifier hs-var">HsVectTypeOut</span></a><span> </span><a href="#local-1628252080"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="#local-1628252083"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-1628252084"><span class="hs-identifier hs-var">rhs_tycon</span></a><span>
</span><a name="line-1304"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1305"></a><span class="hs-identifier">tcVect</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectTypeOut"><span class="hs-identifier hs-var">HsVectTypeOut</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1306"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;TcBinds.tcVect: Unexpected 'HsVectTypeOut'&quot;</span><span>
</span><a name="line-1307"></a><span class="hs-identifier">tcVect</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectClassIn"><span class="hs-identifier hs-var">HsVectClassIn</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252085"><a href="#local-1628252085"><span class="hs-identifier">lname</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1308"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#vectCtxt"><span class="hs-identifier hs-var">vectCtxt</span></a><span> </span><a href="#local-1628252085"><span class="hs-identifier hs-var">lname</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1309"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252086"><a href="#local-1628252086"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupLocatedClass"><span class="hs-identifier hs-var">tcLookupLocatedClass</span></a><span> </span><a href="#local-1628252085"><span class="hs-identifier hs-var">lname</span></a><span>
</span><a name="line-1310"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#HsVectClassOut"><span class="hs-identifier hs-var">HsVectClassOut</span></a><span> </span><a href="#local-1628252086"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-1311"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1312"></a><span class="hs-identifier">tcVect</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectClassOut"><span class="hs-identifier hs-var">HsVectClassOut</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1313"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;TcBinds.tcVect: Unexpected 'HsVectClassOut'&quot;</span><span>
</span><a name="line-1314"></a><span class="hs-identifier">tcVect</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectInstIn"><span class="hs-identifier hs-var">HsVectInstIn</span></a><span> </span><a name="local-1628252087"><a href="#local-1628252087"><span class="hs-identifier">linstTy</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1315"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#vectCtxt"><span class="hs-identifier hs-var">vectCtxt</span></a><span> </span><a href="#local-1628252087"><span class="hs-identifier hs-var">linstTy</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1316"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628252088"><a href="#local-1628252088"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252089"><a href="#local-1628252089"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsVectInst"><span class="hs-identifier hs-var">tcHsVectInst</span></a><span> </span><a href="#local-1628252087"><span class="hs-identifier hs-var">linstTy</span></a><span>
</span><a name="line-1317"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628252090"><a href="#local-1628252090"><span class="hs-identifier">inst</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupInstance"><span class="hs-identifier hs-var">tcLookupInstance</span></a><span> </span><a href="#local-1628252088"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628252089"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1318"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#HsVectInstOut"><span class="hs-identifier hs-var">HsVectInstOut</span></a><span> </span><a href="#local-1628252090"><span class="hs-identifier hs-var">inst</span></a><span>
</span><a name="line-1319"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1320"></a><span class="hs-identifier">tcVect</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectInstOut"><span class="hs-identifier hs-var">HsVectInstOut</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1321"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;TcBinds.tcVect: Unexpected 'HsVectInstOut'&quot;</span><span>
</span><a name="line-1322"></a><span>
</span><a name="line-1323"></a><span class="hs-identifier">vectCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-1628251641"><span class="hs-identifier hs-type">thing</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1628251641"><span class="hs-identifier hs-type">thing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1324"></a><a name="vectCtxt"><a href="TcBinds.html#vectCtxt"><span class="hs-identifier">vectCtxt</span></a></a><span> </span><a name="local-1628252091"><a href="#local-1628252091"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;When checking the vectorisation declaration for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252091"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1325"></a><span>
</span><a name="line-1326"></a><span class="hs-identifier">scalarTyConMustBeNullary</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span>
</span><a name="line-1327"></a><a name="scalarTyConMustBeNullary"><a href="TcBinds.html#scalarTyConMustBeNullary"><span class="hs-identifier">scalarTyConMustBeNullary</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;VECTORISE SCALAR type constructor must be nullary&quot;</span><span>
</span><a name="line-1328"></a><span>
</span><a name="line-1329"></a><span class="hs-comment">{-
Note [SPECIALISE pragmas]
~~~~~~~~~~~~~~~~~~~~~~~~~
There is no point in a SPECIALISE pragma for a non-overloaded function:
   reverse :: [a] -&gt; [a]
   {-# SPECIALISE reverse :: [Int] -&gt; [Int] #-}

But SPECIALISE INLINE *can* make sense for GADTS:
   data Arr e where
     ArrInt :: !Int -&gt; ByteArray# -&gt; Arr Int
     ArrPair :: !Int -&gt; Arr e1 -&gt; Arr e2 -&gt; Arr (e1, e2)

   (!:) :: Arr e -&gt; Int -&gt; e
   {-# SPECIALISE INLINE (!:) :: Arr Int -&gt; Int -&gt; Int #-}
   {-# SPECIALISE INLINE (!:) :: Arr (a, b) -&gt; Int -&gt; (a, b) #-}
   (ArrInt _ ba)     !: (I# i) = I# (indexIntArray# ba i)
   (ArrPair _ a1 a2) !: i      = (a1 !: i, a2 !: i)

When (!:) is specialised it becomes non-recursive, and can usefully
be inlined.  Scary!  So we only warn for SPECIALISE *without* INLINE
for a non-overloaded function.

************************************************************************
*                                                                      *
                         tcMonoBinds
*                                                                      *
************************************************************************

@tcMonoBinds@ deals with a perhaps-recursive group of HsBinds.
The signatures have been dealt with already.

Note [Pattern bindings]
~~~~~~~~~~~~~~~~~~~~~~~
The rule for typing pattern bindings is this:

    ..sigs..
    p = e

where 'p' binds v1..vn, and 'e' may mention v1..vn,
typechecks exactly like

    ..sigs..
    x = e       -- Inferred type
    v1 = case x of p -&gt; v1
    ..
    vn = case x of p -&gt; vn

Note that
    (f :: forall a. a -&gt; a) = id
should not typecheck because
       case id of { (f :: forall a. a-&gt;a) -&gt; f }
will not typecheck.

Note [Instantiate when inferring a type]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  f = (*)
As there is no incentive to instantiate the RHS, tcMonoBinds will
produce a type of forall a. Num a =&gt; a -&gt; a -&gt; a for `f`. This will then go
through simplifyInfer and such, remaining unchanged.

There are two problems with this:
 1) If the definition were `g _ = (*)`, we get a very unusual type of
    `forall {a}. a -&gt; forall b. Num b =&gt; b -&gt; b -&gt; b` for `g`. This is
    surely confusing for users.

 2) The monomorphism restriction can't work. The MR is dealt with in
    simplifyInfer, and simplifyInfer has no way of instantiating. This
    could perhaps be worked around, but it may be hard to know even
    when instantiation should happen.

There is an easy solution to both problems: instantiate (deeply) when
inferring a type. So that's what we do. Note that this decision is
user-facing.

We do this deep instantiation in tcMonoBinds, in the FunBind case
only, and only when we do not have a type signature.  Conveniently,
the fun_co_fn field of FunBind gives a place to record the coercion.

We do not need to do this
 * for PatBinds, because we don't have a function type
 * for FunBinds where we have a signature, bucause we aren't doing inference
-}</span><span>
</span><a name="line-1412"></a><span>
</span><a name="line-1413"></a><span class="hs-identifier">tcMonoBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span>  </span><span class="hs-comment">-- Whether the binding is recursive for typechecking purposes</span><span>
</span><a name="line-1414"></a><span>                        </span><span class="hs-comment">-- i.e. the binders are mentioned in their RHSs, and</span><span>
</span><a name="line-1415"></a><span>                        </span><span class="hs-comment">--      we are not rescued by a type signature</span><span>
</span><a name="line-1416"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a><span>
</span><a name="line-1417"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1418"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcBinds.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1419"></a><a name="tcMonoBinds"><a href="TcBinds.html#tcMonoBinds"><span class="hs-identifier">tcMonoBinds</span></a></a><span> </span><a name="local-1628252092"><a href="#local-1628252092"><span class="hs-identifier">is_rec</span></a></a><span> </span><a name="local-1628252093"><a href="#local-1628252093"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-1628252094"><a href="#local-1628252094"><span class="hs-identifier">no_gen</span></a></a><span>
</span><a name="line-1420"></a><span>           </span><span class="hs-special">[</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628252095"><a href="#local-1628252095"><span class="hs-identifier">b_loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628252096"><a href="#local-1628252096"><span class="hs-identifier">nm_loc</span></a></a><span> </span><a name="local-1628252097"><a href="#local-1628252097"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1421"></a><span>                                </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252098"><a href="#local-1628252098"><span class="hs-identifier">matches</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">bind_fvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252099"><a href="#local-1628252099"><span class="hs-identifier">fvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1422"></a><span>                             </span><span class="hs-comment">-- Single function binding,</span><span>
</span><a name="line-1423"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="BasicTypes.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252092"><span class="hs-identifier hs-var">is_rec</span></a><span>   </span><span class="hs-comment">-- ...binder isn't mentioned in RHS</span><span>
</span><a name="line-1424"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252093"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628252097"><span class="hs-identifier hs-var">name</span></a><span>   </span><span class="hs-comment">-- ...with no type signature</span><span>
</span><a name="line-1425"></a><span>  </span><span class="hs-glyph">=</span><span>     </span><span class="hs-comment">-- In this very special case we infer the type of the</span><span>
</span><a name="line-1426"></a><span>        </span><span class="hs-comment">-- right hand side first (it may have a higher-rank type)</span><span>
</span><a name="line-1427"></a><span>        </span><span class="hs-comment">-- and *then* make the monomorphic Id for the LHS</span><span>
</span><a name="line-1428"></a><span>        </span><span class="hs-comment">-- e.g.         f = \(x::forall a. a-&gt;a) -&gt; &lt;body&gt;</span><span>
</span><a name="line-1429"></a><span>        </span><span class="hs-comment">--      We want to infer a higher-rank type for f</span><span>
</span><a name="line-1430"></a><span>    </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628252095"><span class="hs-identifier hs-var">b_loc</span></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1431"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628252100"><a href="#local-1628252100"><span class="hs-identifier">rhs_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newOpenInferExpType"><span class="hs-identifier hs-var">newOpenInferExpType</span></a><span>
</span><a name="line-1432"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628252101"><a href="#local-1628252101"><span class="hs-identifier">co_fn</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252102"><a href="#local-1628252102"><span class="hs-identifier">matches'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1433"></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcExtendIdBndrs"><span class="hs-identifier hs-var">tcExtendIdBndrs</span></a><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#TcIdBndr_ExpType"><span class="hs-identifier hs-var">TcIdBndr_ExpType</span></a><span> </span><a href="#local-1628252097"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628252100"><span class="hs-identifier hs-var">rhs_ty</span></a><span> </span><a href="BasicTypes.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1434"></a><span>                  </span><span class="hs-comment">-- We extend the error context even for a non-recursive</span><span>
</span><a name="line-1435"></a><span>                  </span><span class="hs-comment">-- function so that in type error messages we show the</span><span>
</span><a name="line-1436"></a><span>                  </span><span class="hs-comment">-- type of the thing whose rhs we are type checking</span><span>
</span><a name="line-1437"></a><span>               </span><a href="TcMatches.html#tcMatchesFun"><span class="hs-identifier hs-var">tcMatchesFun</span></a><span> </span><a href="#local-1628252097"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628252098"><span class="hs-identifier hs-var">matches</span></a><span> </span><a href="#local-1628252100"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-1438"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628252103"><a href="#local-1628252103"><span class="hs-identifier">rhs_ty</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a><span> </span><a href="#local-1628252100"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-1439"></a><span>
</span><a name="line-1440"></a><span>        </span><span class="hs-comment">-- Deeply instantiate the inferred type</span><span>
</span><a name="line-1441"></a><span>        </span><span class="hs-comment">-- See Note [Instantiate when inferring a type]</span><span>
</span><a name="line-1442"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628252104"><a href="#local-1628252104"><span class="hs-identifier">orig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#matchesCtOrigin"><span class="hs-identifier hs-var">matchesCtOrigin</span></a><span> </span><a href="#local-1628252098"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-1443"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628252105"><a href="#local-1628252105"><span class="hs-identifier">rhs_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-1628252103"><span class="hs-identifier hs-var">rhs_ty</span></a><span> </span><span class="hs-comment">-- NB: zonk to uncover any foralls</span><span>
</span><a name="line-1444"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628252106"><a href="#local-1628252106"><span class="hs-identifier">inst_wrap</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252107"><a href="#local-1628252107"><span class="hs-identifier">rhs_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#instErrCtxt"><span class="hs-identifier hs-var">instErrCtxt</span></a><span> </span><a href="#local-1628252097"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628252105"><span class="hs-identifier hs-var">rhs_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1445"></a><span>                                 </span><a href="Inst.html#deeplyInstantiate"><span class="hs-identifier hs-var">deeplyInstantiate</span></a><span> </span><a href="#local-1628252104"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="#local-1628252105"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-1446"></a><span>
</span><a name="line-1447"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628252108"><a href="#local-1628252108"><span class="hs-identifier">mono_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcPat.html#newNoSigLetBndr"><span class="hs-identifier hs-var">newNoSigLetBndr</span></a><span> </span><a href="#local-1628252094"><span class="hs-identifier hs-var">no_gen</span></a><span> </span><a href="#local-1628252097"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628252107"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-1448"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628252095"><span class="hs-identifier hs-var">b_loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1449"></a><span>                     </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628252096"><span class="hs-identifier hs-var">nm_loc</span></a><span> </span><a href="#local-1628252108"><span class="hs-identifier hs-var">mono_id</span></a><span class="hs-special">,</span><span>
</span><a name="line-1450"></a><span>                               </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252102"><span class="hs-identifier hs-var">matches'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">bind_fvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252099"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1451"></a><span>                               </span><span class="hs-identifier">fun_co_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252106"><span class="hs-identifier hs-var">inst_wrap</span></a><span> </span><a href="TcEvidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="#local-1628252101"><span class="hs-identifier hs-var">co_fn</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_tick</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-1452"></a><span>                  </span><span class="hs-special">[</span><a href="TcBinds.html#MBI"><span class="hs-identifier hs-var">MBI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mbi_poly_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252097"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1453"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_sig</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1454"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_mono_id</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252108"><span class="hs-identifier hs-var">mono_id</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1455"></a><span>
</span><a name="line-1456"></a><span class="hs-identifier">tcMonoBinds</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252109"><a href="#local-1628252109"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-1628252110"><a href="#local-1628252110"><span class="hs-identifier">no_gen</span></a></a><span> </span><a name="local-1628252111"><a href="#local-1628252111"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-1457"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628252112"><a href="#local-1628252112"><span class="hs-identifier">tc_binds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#tcLhs"><span class="hs-identifier hs-var">tcLhs</span></a><span> </span><a href="#local-1628252109"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628252110"><span class="hs-identifier hs-var">no_gen</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628252111"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-1458"></a><span>
</span><a name="line-1459"></a><span>        </span><span class="hs-comment">-- Bring the monomorphic Ids, into scope for the RHSs</span><span>
</span><a name="line-1460"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628252113"><a href="#local-1628252113"><span class="hs-identifier">mono_infos</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcBinds.html#getMonoBindInfo"><span class="hs-identifier hs-var">getMonoBindInfo</span></a><span> </span><a href="#local-1628252112"><span class="hs-identifier hs-var">tc_binds</span></a><span>
</span><a name="line-1461"></a><span>              </span><a name="local-1628252114"><a href="#local-1628252114"><span class="hs-identifier">rhs_id_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1628252115"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628252117"><span class="hs-identifier hs-var">mono_id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="TcBinds.html#MBI"><span class="hs-identifier hs-var">MBI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mbi_poly_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252115"><a href="#local-1628252115"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1462"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_sig</span><span>       </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252116"><a href="#local-1628252116"><span class="hs-identifier">mb_sig</span></a></a><span>
</span><a name="line-1463"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_mono_id</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252117"><a href="#local-1628252117"><span class="hs-identifier">mono_id</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1464"></a><span>                                                    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252113"><span class="hs-identifier hs-var">mono_infos</span></a><span>
</span><a name="line-1465"></a><span>                                            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628252116"><span class="hs-identifier hs-var">mb_sig</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1466"></a><span>                                                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628252118"><a href="#local-1628252118"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#isPartialSig"><span class="hs-identifier hs-var">isPartialSig</span></a><span> </span><a href="#local-1628252118"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-1467"></a><span>                                                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1468"></a><span>                    </span><span class="hs-comment">-- A monomorphic binding for each term variable that lacks</span><span>
</span><a name="line-1469"></a><span>                    </span><span class="hs-comment">-- a type sig.  (Ones with a sig are already in scope.)</span><span>
</span><a name="line-1470"></a><span>
</span><a name="line-1471"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcMonoBinds&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252119"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252120"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628252120"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1472"></a><span>                                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628252119"><a href="#local-1628252119"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><a name="local-1628252120"><a href="#local-1628252120"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252114"><span class="hs-identifier hs-var">rhs_id_env</span></a><span class="hs-special">]</span><span>
</span><a name="line-1473"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628252121"><a href="#local-1628252121"><span class="hs-identifier">binds'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcExtendLetEnvIds"><span class="hs-identifier hs-var">tcExtendLetEnvIds</span></a><span> </span><a href="BasicTypes.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a><span> </span><a href="#local-1628252114"><span class="hs-identifier hs-var">rhs_id_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1474"></a><span>                    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="TcBinds.html#tcRhs"><span class="hs-identifier hs-var">tcRhs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252112"><span class="hs-identifier hs-var">tc_binds</span></a><span>
</span><a name="line-1475"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a><span> </span><a href="#local-1628252121"><span class="hs-identifier hs-var">binds'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628252113"><span class="hs-identifier hs-var">mono_infos</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1476"></a><span>
</span><a name="line-1477"></a><span class="hs-comment">------------------------</span><span>
</span><a name="line-1478"></a><span class="hs-comment">-- tcLhs typechecks the LHS of the bindings, to construct the environment in which</span><span>
</span><a name="line-1479"></a><span class="hs-comment">-- we typecheck the RHSs.  Basically what we are doing is this: for each binder:</span><span>
</span><a name="line-1480"></a><span class="hs-comment">--      if there's a signature for it, use the instantiated signature type</span><span>
</span><a name="line-1481"></a><span class="hs-comment">--      otherwise invent a type variable</span><span>
</span><a name="line-1482"></a><span class="hs-comment">-- You see that quite directly in the FunBind case.</span><span>
</span><a name="line-1483"></a><span class="hs-comment">--</span><span>
</span><a name="line-1484"></a><span class="hs-comment">-- But there's a complication for pattern bindings:</span><span>
</span><a name="line-1485"></a><span class="hs-comment">--      data T = MkT (forall a. a-&gt;a)</span><span>
</span><a name="line-1486"></a><span class="hs-comment">--      MkT f = e</span><span>
</span><a name="line-1487"></a><span class="hs-comment">-- Here we can guess a type variable for the entire LHS (which will be refined to T)</span><span>
</span><a name="line-1488"></a><span class="hs-comment">-- but we want to get (f::forall a. a-&gt;a) as the RHS environment.</span><span>
</span><a name="line-1489"></a><span class="hs-comment">-- The simplest way to do this is to typecheck the pattern, and then look up the</span><span>
</span><a name="line-1490"></a><span class="hs-comment">-- bound mono-ids.  Then we want to retain the typechecked pattern to avoid re-doing</span><span>
</span><a name="line-1491"></a><span class="hs-comment">-- it; hence the TcMonoBind data type in which the LHS is done but the RHS isn't</span><span>
</span><a name="line-1492"></a><span>
</span><a name="line-1493"></a><span class="hs-keyword">data</span><span> </span><a name="TcMonoBind"><a href="TcBinds.html#TcMonoBind"><span class="hs-identifier">TcMonoBind</span></a></a><span>         </span><span class="hs-comment">-- Half completed; LHS done, RHS not done</span><span>
</span><a name="line-1494"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TcFunBind"><a href="TcBinds.html#TcFunBind"><span class="hs-identifier">TcFunBind</span></a></a><span>  </span><a href="TcBinds.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a><span>  </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1495"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TcPatBind"><a href="TcBinds.html#TcPatBind"><span class="hs-identifier">TcPatBind</span></a></a><span> </span><span class="hs-special">[</span><a href="TcBinds.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="HsPat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span>
</span><a name="line-1496"></a><span>
</span><a name="line-1497"></a><span class="hs-keyword">data</span><span> </span><a name="MonoBindInfo"><a href="TcBinds.html#MonoBindInfo"><span class="hs-identifier">MonoBindInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MBI"><a href="TcBinds.html#MBI"><span class="hs-identifier">MBI</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="TcBinds.html#mbi_poly_name"><span class="hs-identifier">mbi_poly_name</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-1498"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="TcBinds.html#mbi_sig"><span class="hs-identifier">mbi_sig</span></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span>
</span><a name="line-1499"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="TcBinds.html#mbi_mono_id"><span class="hs-identifier">mbi_mono_id</span></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1500"></a><span>
</span><a name="line-1501"></a><span class="hs-identifier">tcLhs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#HsBind"><span class="hs-identifier hs-type">HsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcBinds.html#TcMonoBind"><span class="hs-identifier hs-type">TcMonoBind</span></a><span>
</span><a name="line-1502"></a><a name="tcLhs"><a href="TcBinds.html#tcLhs"><span class="hs-identifier">tcLhs</span></a></a><span> </span><a name="local-1628252122"><a href="#local-1628252122"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-1628252123"><a href="#local-1628252123"><span class="hs-identifier">no_gen</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628252124"><a href="#local-1628252124"><span class="hs-identifier">nm_loc</span></a></a><span> </span><a name="local-1628252125"><a href="#local-1628252125"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252126"><a href="#local-1628252126"><span class="hs-identifier">matches</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1503"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcIdSig"><span class="hs-identifier hs-var">TcIdSig</span></a><span> </span><a name="local-1628252127"><a href="#local-1628252127"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252122"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628252125"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1504"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TISI"><span class="hs-identifier hs-var">TISI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_tau</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252128"><a href="#local-1628252128"><span class="hs-identifier">tau</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252127"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-1505"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">no_gen</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">LetLclBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#LetLclBndr"><span class="hs-identifier hs-var">True</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier">LetGblBndr</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcPat.html#LetGblBndr"><span class="hs-identifier hs-var">False</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1506"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1507"></a><span>       </span><span class="hs-comment">-- { f :: ty; f x = e } is always done via CheckGen (full signature)</span><span>
</span><a name="line-1508"></a><span>       </span><span class="hs-comment">--                                      or InferGen (partial signature)</span><span>
</span><a name="line-1509"></a><span>       </span><span class="hs-comment">--               see Note [Partial type signatures and generalisation]</span><span>
</span><a name="line-1510"></a><span>       </span><span class="hs-comment">-- Both InferGen and CheckGen gives rise to LetLclBndr</span><span>
</span><a name="line-1511"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628252129"><a href="#local-1628252129"><span class="hs-identifier">mono_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newLocalName"><span class="hs-identifier hs-var">newLocalName</span></a><span> </span><a href="#local-1628252125"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1512"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628252130"><a href="#local-1628252130"><span class="hs-identifier">mono_id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a><span> </span><a href="#local-1628252129"><span class="hs-identifier hs-var">mono_name</span></a><span> </span><a href="#local-1628252128"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-1513"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#TcFunBind"><span class="hs-identifier hs-var">TcFunBind</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#MBI"><span class="hs-identifier hs-var">MBI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mbi_poly_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252125"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1514"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_sig</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628252127"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-1515"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_mono_id</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252130"><span class="hs-identifier hs-var">mono_id</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1516"></a><span>                            </span><a href="#local-1628252124"><span class="hs-identifier hs-var">nm_loc</span></a><span> </span><a href="#local-1628252126"><span class="hs-identifier hs-var">matches</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1517"></a><span>
</span><a name="line-1518"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1519"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628252131"><a href="#local-1628252131"><span class="hs-identifier">mono_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiTyVarTy</span></a><span>
</span><a name="line-1520"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628252132"><a href="#local-1628252132"><span class="hs-identifier">mono_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcPat.html#newNoSigLetBndr"><span class="hs-identifier hs-var">newNoSigLetBndr</span></a><span> </span><a href="#local-1628252123"><span class="hs-identifier hs-var">no_gen</span></a><span> </span><a href="#local-1628252125"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628252131"><span class="hs-identifier hs-var">mono_ty</span></a><span>
</span><a name="line-1521"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#TcFunBind"><span class="hs-identifier hs-var">TcFunBind</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#MBI"><span class="hs-identifier hs-var">MBI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mbi_poly_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252125"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1522"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_sig</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1523"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_mono_id</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252132"><span class="hs-identifier hs-var">mono_id</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1524"></a><span>                            </span><a href="#local-1628252124"><span class="hs-identifier hs-var">nm_loc</span></a><span> </span><a href="#local-1628252126"><span class="hs-identifier hs-var">matches</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1525"></a><span>
</span><a name="line-1526"></a><span class="hs-identifier">tcLhs</span><span> </span><a name="local-1628252133"><a href="#local-1628252133"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-1628252134"><a href="#local-1628252134"><span class="hs-identifier">no_gen</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PatBind"><span class="hs-identifier hs-var">PatBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252135"><a href="#local-1628252135"><span class="hs-identifier">pat</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252136"><a href="#local-1628252136"><span class="hs-identifier">grhss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1527"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628252137"><a href="#local-1628252137"><span class="hs-identifier">tc_pat</span></a></a><span> </span><a name="local-1628252139"><a href="#local-1628252139"><span class="hs-identifier">exp_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcPat.html#tcLetPat"><span class="hs-identifier hs-var">tcLetPat</span></a><span> </span><a href="#local-1628252133"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628252134"><span class="hs-identifier hs-var">no_gen</span></a><span> </span><a href="#local-1628252135"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-1628252139"><span class="hs-identifier hs-var">exp_ty</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1528"></a><span>                              </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628252138"><span class="hs-identifier hs-var">lookup_info</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a><span> </span><a href="#local-1628252135"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>
</span><a name="line-1529"></a><span>
</span><a name="line-1530"></a><span>                </span><span class="hs-comment">-- After typechecking the pattern, look up the binder</span><span>
</span><a name="line-1531"></a><span>                </span><span class="hs-comment">-- names, which the pattern has brought into scope.</span><span>
</span><a name="line-1532"></a><span>              </span><span class="hs-identifier">lookup_info</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcBinds.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a><span>
</span><a name="line-1533"></a><span>              </span><a name="local-1628252138"><a href="#local-1628252138"><span class="hs-identifier">lookup_info</span></a></a><span> </span><a name="local-1628252140"><a href="#local-1628252140"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1534"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252141"><a href="#local-1628252141"><span class="hs-identifier">mono_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a><span> </span><a href="#local-1628252140"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1535"></a><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628252142"><a href="#local-1628252142"><span class="hs-identifier">mb_sig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628252133"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628252140"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1536"></a><span>                                      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcIdSig"><span class="hs-identifier hs-var">TcIdSig</span></a><span> </span><a name="local-1628252143"><a href="#local-1628252143"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628252143"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-1537"></a><span>                                      </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1538"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#MBI"><span class="hs-identifier hs-var">MBI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mbi_poly_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252140"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1539"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_sig</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252142"><span class="hs-identifier hs-var">mb_sig</span></a><span>
</span><a name="line-1540"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_mono_id</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252141"><span class="hs-identifier hs-var">mono_id</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1541"></a><span>
</span><a name="line-1542"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628252144"><a href="#local-1628252144"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252145"><a href="#local-1628252145"><span class="hs-identifier">infos</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628252146"><a href="#local-1628252146"><span class="hs-identifier">pat_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#patMonoBindsCtxt"><span class="hs-identifier hs-var">patMonoBindsCtxt</span></a><span> </span><a href="#local-1628252135"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-1628252136"><span class="hs-identifier hs-var">grhss</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1543"></a><span>                                     </span><a href="TcUnify.html#tcInfer"><span class="hs-identifier hs-var">tcInfer</span></a><span> </span><a href="#local-1628252137"><span class="hs-identifier hs-var">tc_pat</span></a><span>
</span><a name="line-1544"></a><span>
</span><a name="line-1545"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#TcPatBind"><span class="hs-identifier hs-var">TcPatBind</span></a><span> </span><a href="#local-1628252145"><span class="hs-identifier hs-var">infos</span></a><span> </span><a href="#local-1628252144"><span class="hs-identifier hs-var">pat'</span></a><span> </span><a href="#local-1628252136"><span class="hs-identifier hs-var">grhss</span></a><span> </span><a href="#local-1628252146"><span class="hs-identifier hs-var">pat_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1546"></a><span>
</span><a name="line-1547"></a><span class="hs-identifier">tcLhs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252147"><a href="#local-1628252147"><span class="hs-identifier">other_bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcLhs&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252147"><span class="hs-identifier hs-var">other_bind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1548"></a><span>        </span><span class="hs-comment">-- AbsBind, VarBind impossible</span><span>
</span><a name="line-1549"></a><span>
</span><a name="line-1550"></a><span class="hs-comment">-------------------</span><span>
</span><a name="line-1551"></a><span class="hs-identifier">tcRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcBinds.html#TcMonoBind"><span class="hs-identifier hs-type">TcMonoBind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#HsBind"><span class="hs-identifier hs-type">HsBind</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">)</span><span>
</span><a name="line-1552"></a><a name="tcRhs"><a href="TcBinds.html#tcRhs"><span class="hs-identifier">tcRhs</span></a></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#TcFunBind"><span class="hs-identifier hs-var">TcFunBind</span></a><span> </span><a name="local-1628252148"><a href="#local-1628252148"><span class="hs-identifier">info</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcBinds.html#MBI"><span class="hs-identifier hs-var">MBI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mbi_sig</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252149"><a href="#local-1628252149"><span class="hs-identifier">mb_sig</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">mbi_mono_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252150"><a href="#local-1628252150"><span class="hs-identifier">mono_id</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1553"></a><span>                 </span><a name="local-1628252151"><a href="#local-1628252151"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628252152"><a href="#local-1628252152"><span class="hs-identifier">matches</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1554"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcBinds.html#tcExtendIdBinderStackForRhs"><span class="hs-identifier hs-var">tcExtendIdBinderStackForRhs</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628252148"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">]</span><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1555"></a><span>    </span><a href="TcBinds.html#tcExtendTyVarEnvForRhs"><span class="hs-identifier hs-var">tcExtendTyVarEnvForRhs</span></a><span> </span><a href="#local-1628252149"><span class="hs-identifier hs-var">mb_sig</span></a><span>       </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1556"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcRhs: fun bind&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252150"><span class="hs-identifier hs-var">mono_id</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628252150"><span class="hs-identifier hs-var">mono_id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1557"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628252153"><a href="#local-1628252153"><span class="hs-identifier">co_fn</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252154"><a href="#local-1628252154"><span class="hs-identifier">matches'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMatches.html#tcMatchesFun"><span class="hs-identifier hs-var">tcMatchesFun</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628252150"><span class="hs-identifier hs-var">mono_id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1558"></a><span>                                 </span><a href="#local-1628252152"><span class="hs-identifier hs-var">matches</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628252150"><span class="hs-identifier hs-var">mono_id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1559"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628252151"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628252150"><span class="hs-identifier hs-var">mono_id</span></a><span>
</span><a name="line-1560"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252154"><span class="hs-identifier hs-var">matches'</span></a><span>
</span><a name="line-1561"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_co_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252153"><span class="hs-identifier hs-var">co_fn</span></a><span>
</span><a name="line-1562"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bind_fvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PlaceHolder.html#placeHolderNamesTc"><span class="hs-identifier hs-var">placeHolderNamesTc</span></a><span>
</span><a name="line-1563"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_tick</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1564"></a><span>
</span><a name="line-1565"></a><span class="hs-comment">-- TODO: emit Hole Constraints for wildcards</span><span>
</span><a name="line-1566"></a><span class="hs-identifier">tcRhs</span><span> </span><span class="hs-special">(</span><a href="TcBinds.html#TcPatBind"><span class="hs-identifier hs-var">TcPatBind</span></a><span> </span><a name="local-1628252155"><a href="#local-1628252155"><span class="hs-identifier">infos</span></a></a><span> </span><a name="local-1628252156"><a href="#local-1628252156"><span class="hs-identifier">pat'</span></a></a><span> </span><a name="local-1628252157"><a href="#local-1628252157"><span class="hs-identifier">grhss</span></a></a><span> </span><a name="local-1628252158"><a href="#local-1628252158"><span class="hs-identifier">pat_ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1567"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- When we are doing pattern bindings we *don't* bring any scoped</span><span>
</span><a name="line-1568"></a><span>    </span><span class="hs-comment">-- type variables into scope unlike function bindings</span><span>
</span><a name="line-1569"></a><span>    </span><span class="hs-comment">-- Wny not?  They are not completely rigid.</span><span>
</span><a name="line-1570"></a><span>    </span><span class="hs-comment">-- That's why we have the special case for a single FunBind in tcMonoBinds</span><span>
</span><a name="line-1571"></a><span>    </span><a href="TcBinds.html#tcExtendIdBinderStackForRhs"><span class="hs-identifier hs-var">tcExtendIdBinderStackForRhs</span></a><span> </span><a href="#local-1628252155"><span class="hs-identifier hs-var">infos</span></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1572"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcRhs: pat bind&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252156"><span class="hs-identifier hs-var">pat'</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252158"><span class="hs-identifier hs-var">pat_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1573"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628252159"><a href="#local-1628252159"><span class="hs-identifier">grhss'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#patMonoBindsCtxt"><span class="hs-identifier hs-var">patMonoBindsCtxt</span></a><span> </span><a href="#local-1628252156"><span class="hs-identifier hs-var">pat'</span></a><span> </span><a href="#local-1628252157"><span class="hs-identifier hs-var">grhss</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1574"></a><span>                    </span><a href="TcMatches.html#tcGRHSsPat"><span class="hs-identifier hs-var">tcGRHSsPat</span></a><span> </span><a href="#local-1628252157"><span class="hs-identifier hs-var">grhss</span></a><span> </span><a href="#local-1628252158"><span class="hs-identifier hs-var">pat_ty</span></a><span>
</span><a name="line-1575"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="HsBinds.html#PatBind"><span class="hs-identifier hs-var">PatBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252156"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252159"><span class="hs-identifier hs-var">grhss'</span></a><span>
</span><a name="line-1576"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_rhs_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252158"><span class="hs-identifier hs-var">pat_ty</span></a><span>
</span><a name="line-1577"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bind_fvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PlaceHolder.html#placeHolderNamesTc"><span class="hs-identifier hs-var">placeHolderNamesTc</span></a><span>
</span><a name="line-1578"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-1579"></a><span>
</span><a name="line-1580"></a><span class="hs-identifier">tcExtendTyVarEnvForRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251640"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251640"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1581"></a><a name="tcExtendTyVarEnvForRhs"><a href="TcBinds.html#tcExtendTyVarEnvForRhs"><span class="hs-identifier">tcExtendTyVarEnvForRhs</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a name="local-1628252160"><a href="#local-1628252160"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1582"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252160"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1583"></a><span class="hs-identifier">tcExtendTyVarEnvForRhs</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628252161"><a href="#local-1628252161"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628252162"><a href="#local-1628252162"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1584"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcBinds.html#tcExtendTyVarEnvFromSig"><span class="hs-identifier hs-var">tcExtendTyVarEnvFromSig</span></a><span> </span><a href="#local-1628252161"><span class="hs-identifier hs-var">sig</span></a><span> </span><a href="#local-1628252162"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1585"></a><span>
</span><a name="line-1586"></a><span class="hs-identifier">tcExtendTyVarEnvFromSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251639"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251639"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1587"></a><a name="tcExtendTyVarEnvFromSig"><a href="TcBinds.html#tcExtendTyVarEnvFromSig"><span class="hs-identifier">tcExtendTyVarEnvFromSig</span></a></a><span> </span><a name="local-1628252163"><a href="#local-1628252163"><span class="hs-identifier">sig</span></a></a><span> </span><a name="local-1628252164"><a href="#local-1628252164"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1588"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#TISI"><span class="hs-identifier hs-var">TISI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_bndr</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252165"><a href="#local-1628252165"><span class="hs-identifier">s_bndr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_skols</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252166"><a href="#local-1628252166"><span class="hs-identifier">skol_prs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252167"><a href="#local-1628252167"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252163"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-1589"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv2"><span class="hs-identifier hs-var">tcExtendTyVarEnv2</span></a><span> </span><a href="#local-1628252166"><span class="hs-identifier hs-var">skol_prs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1590"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628252165"><span class="hs-identifier hs-var">s_bndr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1591"></a><span>      </span><a href="TcRnTypes.html#CompleteSig"><span class="hs-identifier hs-var">CompleteSig</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628252164"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1592"></a><span>      </span><a href="TcRnTypes.html#PartialSig"><span class="hs-identifier hs-var">PartialSig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_wcs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252168"><a href="#local-1628252168"><span class="hs-identifier">wc_prs</span></a></a><span> </span><span class="hs-special">}</span><span>  </span><span class="hs-comment">-- Extend the env ad emit the holes</span><span>
</span><a name="line-1593"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv2"><span class="hs-identifier hs-var">tcExtendTyVarEnv2</span></a><span> </span><a href="#local-1628252168"><span class="hs-identifier hs-var">wc_prs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1594"></a><span>                         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#typeSigCtxt"><span class="hs-identifier hs-var">typeSigCtxt</span></a><span> </span><a href="#local-1628252167"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-1628252165"><span class="hs-identifier hs-var">s_bndr</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1595"></a><span>                              </span><a href="TcRnMonad.html#emitWildCardHoleConstraints"><span class="hs-identifier hs-var">emitWildCardHoleConstraints</span></a><span> </span><a href="#local-1628252168"><span class="hs-identifier hs-var">wc_prs</span></a><span>
</span><a name="line-1596"></a><span>                            </span><span class="hs-special">;</span><span> </span><a href="#local-1628252164"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1597"></a><span>
</span><a name="line-1598"></a><span class="hs-identifier">tcExtendIdBinderStackForRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcBinds.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251638"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628251638"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1599"></a><span class="hs-comment">-- Extend the TcIdBinderStack for the RHS of the binding, with</span><span>
</span><a name="line-1600"></a><span class="hs-comment">-- the monomorphic Id.  That way, if we have, say</span><span>
</span><a name="line-1601"></a><span class="hs-comment">--     f = \x -&gt; blah</span><span>
</span><a name="line-1602"></a><span class="hs-comment">-- and something goes wrong in 'blah', we get a &quot;relevant binding&quot;</span><span>
</span><a name="line-1603"></a><span class="hs-comment">-- looking like  f :: alpha -&gt; beta</span><span>
</span><a name="line-1604"></a><span class="hs-comment">-- This applies if 'f' has a type signature too:</span><span>
</span><a name="line-1605"></a><span class="hs-comment">--    f :: forall a. [a] -&gt; [a]</span><span>
</span><a name="line-1606"></a><span class="hs-comment">--    f x = True</span><span>
</span><a name="line-1607"></a><span class="hs-comment">-- We can't unify True with [a], and a relevant binding is f :: [a] -&gt; [a]</span><span>
</span><a name="line-1608"></a><span class="hs-comment">-- If we had the *polymorphic* version of f in the TcIdBinderStack, it</span><span>
</span><a name="line-1609"></a><span class="hs-comment">-- would not be reported as relevant, because its type is closed</span><span>
</span><a name="line-1610"></a><a name="tcExtendIdBinderStackForRhs"><a href="TcBinds.html#tcExtendIdBinderStackForRhs"><span class="hs-identifier">tcExtendIdBinderStackForRhs</span></a></a><span> </span><a name="local-1628252169"><a href="#local-1628252169"><span class="hs-identifier">infos</span></a></a><span> </span><a name="local-1628252170"><a href="#local-1628252170"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1611"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcEnv.html#tcExtendIdBndrs"><span class="hs-identifier hs-var">tcExtendIdBndrs</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="TcRnTypes.html#TcIdBndr"><span class="hs-identifier hs-var">TcIdBndr</span></a><span> </span><a href="#local-1628252171"><span class="hs-identifier hs-var">mono_id</span></a><span> </span><a href="BasicTypes.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a><span>
</span><a name="line-1612"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="TcBinds.html#MBI"><span class="hs-identifier hs-var">MBI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mbi_mono_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252171"><a href="#local-1628252171"><span class="hs-identifier">mono_id</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252169"><span class="hs-identifier hs-var">infos</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1613"></a><span>                    </span><a href="#local-1628252170"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1614"></a><span>    </span><span class="hs-comment">-- NotTopLevel: it's a monomorphic binding</span><span>
</span><a name="line-1615"></a><span>
</span><a name="line-1616"></a><span class="hs-comment">---------------------</span><span>
</span><a name="line-1617"></a><span class="hs-identifier">getMonoBindInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="TcBinds.html#TcMonoBind"><span class="hs-identifier hs-type">TcMonoBind</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcBinds.html#MonoBindInfo"><span class="hs-identifier hs-type">MonoBindInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-1618"></a><a name="getMonoBindInfo"><a href="TcBinds.html#getMonoBindInfo"><span class="hs-identifier">getMonoBindInfo</span></a></a><span> </span><a name="local-1628252172"><a href="#local-1628252172"><span class="hs-identifier">tc_binds</span></a></a><span>
</span><a name="line-1619"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628252173"><span class="hs-identifier hs-var">get_info</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1628252172"><span class="hs-identifier hs-var">tc_binds</span></a><span>
</span><a name="line-1620"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1621"></a><span>    </span><a name="local-1628252173"><a href="#local-1628252173"><span class="hs-identifier">get_info</span></a></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#TcFunBind"><span class="hs-identifier hs-var">TcFunBind</span></a><span> </span><a name="local-1628252174"><a href="#local-1628252174"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><a name="local-1628252175"><a href="#local-1628252175"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252174"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628252175"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-1622"></a><span>    </span><span class="hs-identifier">get_info</span><span> </span><span class="hs-special">(</span><a href="TcBinds.html#TcPatBind"><span class="hs-identifier hs-var">TcPatBind</span></a><span> </span><a name="local-1628252176"><a href="#local-1628252176"><span class="hs-identifier">infos</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1628252177"><a href="#local-1628252177"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252176"><span class="hs-identifier hs-var">infos</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628252177"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-1623"></a><span>
</span><a name="line-1624"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Signatures
*                                                                      *
************************************************************************

Type signatures are tricky.  See Note [Signature skolems] in TcType

@tcSigs@ checks the signatures for validity, and returns a list of
{\em freshly-instantiated} signatures.  That is, the types are already
split up, and have fresh type variables installed.  All non-type-signature
&quot;RenamedSigs&quot; are ignored.

The @TcSigInfo@ contains @TcTypes@ because they are unified with
the variable's type, and after that checked to see whether they've
been instantiated.

Note [Scoped tyvars]
~~~~~~~~~~~~~~~~~~~~
The -XScopedTypeVariables flag brings lexically-scoped type variables
into scope for any explicitly forall-quantified type variables:
        f :: forall a. a -&gt; a
        f x = e
Then 'a' is in scope inside 'e'.

However, we do *not* support this
  - For pattern bindings e.g
        f :: forall a. a-&gt;a
        (f,g) = e

Note [Signature skolems]
~~~~~~~~~~~~~~~~~~~~~~~~
When instantiating a type signature, we do so with either skolems or
SigTv meta-type variables depending on the use_skols boolean.  This
variable is set True when we are typechecking a single function
binding; and False for pattern bindings and a group of several
function bindings.

Reason: in the latter cases, the &quot;skolems&quot; can be unified together,
        so they aren't properly rigid in the type-refinement sense.
NB: unless we are doing H98, each function with a sig will be done
    separately, even if it's mutually recursive, so use_skols will be True


Note [Only scoped tyvars are in the TyVarEnv]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We are careful to keep only the *lexically scoped* type variables in
the type environment.  Why?  After all, the renamer has ensured
that only legal occurrences occur, so we could put all type variables
into the type env.

But we want to check that two distinct lexically scoped type variables
do not map to the same internal type variable.  So we need to know which
the lexically-scoped ones are... and at the moment we do that by putting
only the lexically scoped ones into the environment.

Note [Instantiate sig with fresh variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's vital to instantiate a type signature with fresh variables.
For example:
      type T = forall a. [a] -&gt; [a]
      f :: T;
      f = g where { g :: T; g = &lt;rhs&gt; }

 We must not use the same 'a' from the defn of T at both places!!
(Instantiation is only necessary because of type synonyms.  Otherwise,
it's all cool; each signature has distinct type variables from the renamer.)

Note [Fail eagerly on bad signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If a type signaure is wrong, fail immediately:

 * the type sigs may bind type variables, so proceeding without them
   can lead to a cascade of errors

 * the type signature might be ambiguous, in which case checking
   the code against the signature will give a very similar error
   to the ambiguity error.

ToDo: this means we fall over if any type sig
is wrong (eg at the top level of the module),
which is over-conservative
-}</span><span>
</span><a name="line-1708"></a><span>
</span><a name="line-1709"></a><span class="hs-identifier">tcTySigs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span class="hs-special">)</span><span>
</span><a name="line-1710"></a><a name="tcTySigs"><a href="TcBinds.html#tcTySigs"><span class="hs-identifier">tcTySigs</span></a></a><span> </span><a name="local-1628252178"><a href="#local-1628252178"><span class="hs-identifier">hs_sigs</span></a></a><span>
</span><a name="line-1711"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>   </span><span class="hs-comment">-- See Note [Fail eagerly on bad signatures]</span><span>
</span><a name="line-1712"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252179"><a href="#local-1628252179"><span class="hs-identifier">ty_sigs_s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#mapAndRecoverM"><span class="hs-identifier hs-var">mapAndRecoverM</span></a><span> </span><a href="TcBinds.html#tcTySig"><span class="hs-identifier hs-var">tcTySig</span></a><span> </span><a href="#local-1628252178"><span class="hs-identifier hs-var">hs_sigs</span></a><span>
</span><a name="line-1713"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628252180"><a href="#local-1628252180"><span class="hs-identifier">ty_sigs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="#local-1628252179"><span class="hs-identifier hs-var">ty_sigs_s</span></a><span>
</span><a name="line-1714"></a><span>             </span><a name="local-1628252181"><a href="#local-1628252181"><span class="hs-identifier">poly_ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a><span> </span><a href="TcRnTypes.html#completeSigPolyId_maybe"><span class="hs-identifier hs-var">completeSigPolyId_maybe</span></a><span> </span><a href="#local-1628252180"><span class="hs-identifier hs-var">ty_sigs</span></a><span>
</span><a name="line-1715"></a><span>                        </span><span class="hs-comment">-- The returned [TcId] are the ones for which we have</span><span>
</span><a name="line-1716"></a><span>                        </span><span class="hs-comment">-- a complete type signature.</span><span>
</span><a name="line-1717"></a><span>                        </span><span class="hs-comment">-- See Note [Complete and partial type signatures]</span><span>
</span><a name="line-1718"></a><span>             </span><a name="local-1628252182"><a href="#local-1628252182"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcRnTypes.html#tcSigInfoName"><span class="hs-identifier hs-var">tcSigInfoName</span></a><span> </span><a href="#local-1628252183"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628252183"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628252183"><a href="#local-1628252183"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252180"><span class="hs-identifier hs-var">ty_sigs</span></a><span class="hs-special">]</span><span>
</span><a name="line-1719"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628252181"><span class="hs-identifier hs-var">poly_ids</span></a><span class="hs-special">,</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-1628252182"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1720"></a><span>
</span><a name="line-1721"></a><span class="hs-identifier">tcTySig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#TcSigInfo"><span class="hs-identifier hs-type">TcSigInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-1722"></a><a name="tcTySig"><a href="TcBinds.html#tcTySig"><span class="hs-identifier">tcTySig</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#IdSig"><span class="hs-identifier hs-var">IdSig</span></a><span> </span><a name="local-1628252184"><a href="#local-1628252184"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1723"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252185"><a href="#local-1628252185"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#instTcTySigFromId"><span class="hs-identifier hs-var">instTcTySigFromId</span></a><span> </span><a href="#local-1628252184"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-1724"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#TcIdSig"><span class="hs-identifier hs-var">TcIdSig</span></a><span> </span><a href="#local-1628252185"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1725"></a><span>
</span><a name="line-1726"></a><span class="hs-identifier">tcTySig</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628252186"><a href="#local-1628252186"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#TypeSig"><span class="hs-identifier hs-var">TypeSig</span></a><span> </span><a name="local-1628252187"><a href="#local-1628252187"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-1628252188"><a href="#local-1628252188"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1727"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628252186"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1728"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252190"><a href="#local-1628252190"><span class="hs-identifier">sigs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#sequence"><span class="hs-identifier hs-var">sequence</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="TcBinds.html#tcUserTypeSig"><span class="hs-identifier hs-var">tcUserTypeSig</span></a><span> </span><a href="#local-1628252188"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628252189"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1729"></a><span>                          </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252189"><a href="#local-1628252189"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252187"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1730"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TcRnTypes.html#TcIdSig"><span class="hs-identifier hs-var">TcIdSig</span></a><span> </span><a href="#local-1628252190"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1731"></a><span>
</span><a name="line-1732"></a><span class="hs-identifier">tcTySig</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628252191"><a href="#local-1628252191"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PatSynSig"><span class="hs-identifier hs-var">PatSynSig</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252192"><a href="#local-1628252192"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628252193"><a href="#local-1628252193"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1733"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628252191"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1734"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252194"><a href="#local-1628252194"><span class="hs-identifier">tpsi</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcPatSyn.html#tcPatSynSig"><span class="hs-identifier hs-var">tcPatSynSig</span></a><span> </span><a href="#local-1628252192"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628252193"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-1735"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#TcPatSynSig"><span class="hs-identifier hs-var">TcPatSynSig</span></a><span> </span><a href="#local-1628252194"><span class="hs-identifier hs-var">tpsi</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1736"></a><span>
</span><a name="line-1737"></a><span class="hs-identifier">tcTySig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1738"></a><span>
</span><a name="line-1739"></a><span class="hs-identifier">isCompleteHsSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1740"></a><span class="hs-comment">-- ^ If there are no wildcards, return a LHsSigType</span><span>
</span><a name="line-1741"></a><a name="isCompleteHsSig"><a href="TcBinds.html#isCompleteHsSig"><span class="hs-identifier">isCompleteHsSig</span></a></a><span> </span><a name="local-1628252195"><a href="#local-1628252195"><span class="hs-identifier">sig_ty</span></a></a><span>
</span><a name="line-1742"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="HsTypes.html#HsWC"><span class="hs-identifier hs-var">HsWC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_wcs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252196"><a href="#local-1628252196"><span class="hs-identifier">wcs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hswc_ctx</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252197"><a href="#local-1628252197"><span class="hs-identifier">extra</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><a href="#local-1628252195"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-1743"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628252196"><span class="hs-identifier hs-var">wcs</span></a><span>
</span><a name="line-1744"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252197"><span class="hs-identifier hs-var">extra</span></a><span>
</span><a name="line-1745"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1746"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1747"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1748"></a><span>
</span><a name="line-1749"></a><span class="hs-identifier">tcUserTypeSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span>
</span><a name="line-1750"></a><span class="hs-comment">-- Just n  =&gt; Function type signatre        name :: type</span><span>
</span><a name="line-1751"></a><span class="hs-comment">-- Nothing =&gt; Expression type signature   &lt;expr&gt; :: type</span><span>
</span><a name="line-1752"></a><a name="tcUserTypeSig"><a href="TcBinds.html#tcUserTypeSig"><span class="hs-identifier">tcUserTypeSig</span></a></a><span> </span><a name="local-1628252198"><a href="#local-1628252198"><span class="hs-identifier">hs_sig_ty</span></a></a><span> </span><a name="local-1628252199"><a href="#local-1628252199"><span class="hs-identifier">mb_name</span></a></a><span>
</span><a name="line-1753"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcBinds.html#isCompleteHsSig"><span class="hs-identifier hs-var">isCompleteHsSig</span></a><span> </span><a href="#local-1628252198"><span class="hs-identifier hs-var">hs_sig_ty</span></a><span>
</span><a name="line-1754"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#pushTcLevelM_"><span class="hs-identifier hs-var">pushTcLevelM_</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>  </span><span class="hs-comment">-- When instantiating the signature, do so &quot;one level in&quot;</span><span>
</span><a name="line-1755"></a><span>                      </span><span class="hs-comment">-- so that they can be unified under the forall</span><span>
</span><a name="line-1756"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252206"><a href="#local-1628252206"><span class="hs-identifier">sigma_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsSigWcType"><span class="hs-identifier hs-var">tcHsSigWcType</span></a><span> </span><a href="#local-1628252201"><span class="hs-identifier hs-var">ctxt_F</span></a><span> </span><a href="#local-1628252198"><span class="hs-identifier hs-var">hs_sig_ty</span></a><span>
</span><a name="line-1757"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628252207"><a href="#local-1628252207"><span class="hs-identifier">inst_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252208"><a href="#local-1628252208"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252209"><a href="#local-1628252209"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#tcInstType"><span class="hs-identifier hs-var">tcInstType</span></a><span> </span><a href="TcMType.html#tcInstSigTyVars"><span class="hs-identifier hs-var">tcInstSigTyVars</span></a><span> </span><a href="#local-1628252206"><span class="hs-identifier hs-var">sigma_ty</span></a><span>
</span><a name="line-1758"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628252210"><a href="#local-1628252210"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-1759"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1760"></a><span>         </span><a href="TcRnTypes.html#TISI"><span class="hs-identifier hs-var">TISI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_bndr</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CompleteSig"><span class="hs-identifier hs-var">CompleteSig</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a><span> </span><a href="#local-1628252200"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628252206"><span class="hs-identifier hs-var">sigma_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1761"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_skols</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#findScopedTyVars"><span class="hs-identifier hs-var">findScopedTyVars</span></a><span> </span><a href="#local-1628252206"><span class="hs-identifier hs-var">sigma_ty</span></a><span> </span><a href="#local-1628252207"><span class="hs-identifier hs-var">inst_tvs</span></a><span>
</span><a name="line-1762"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_theta</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252208"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-1763"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_tau</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252209"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-1764"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_ctxt</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252202"><span class="hs-identifier hs-var">ctxt_T</span></a><span>
</span><a name="line-1765"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_loc</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252210"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1766"></a><span>
</span><a name="line-1767"></a><span>  </span><span class="hs-comment">-- Partial sig with wildcards</span><span>
</span><a name="line-1768"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252211"><a href="#local-1628252211"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252212"><a href="#local-1628252212"><span class="hs-identifier">wc_ty</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252198"><span class="hs-identifier hs-var">hs_sig_ty</span></a><span>
</span><a name="line-1769"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="HsTypes.html#HsWC"><span class="hs-identifier hs-var">HsWC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_wcs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252213"><a href="#local-1628252213"><span class="hs-identifier">wcs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hswc_ctx</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252214"><a href="#local-1628252214"><span class="hs-identifier">extra</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hswc_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252215"><a href="#local-1628252215"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252212"><span class="hs-identifier hs-var">wc_ty</span></a><span>
</span><a name="line-1770"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1628252216"><a href="#local-1628252216"><span class="hs-identifier">hs_tvs</span></a></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252217"><a href="#local-1628252217"><span class="hs-identifier">hs_ctxt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252218"><a href="#local-1628252218"><span class="hs-identifier">hs_tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HsTypes.html#splitLHsSigmaTy"><span class="hs-identifier hs-var">splitLHsSigmaTy</span></a><span> </span><a href="#local-1628252215"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-1771"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628252226"><a href="#local-1628252226"><span class="hs-identifier">vars1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1628252227"><a href="#local-1628252227"><span class="hs-identifier">wcs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252228"><a href="#local-1628252228"><span class="hs-identifier">tvs2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252229"><a href="#local-1628252229"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252230"><a href="#local-1628252230"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1772"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#pushTcLevelM_"><span class="hs-identifier hs-var">pushTcLevelM_</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1773"></a><span>                  </span><span class="hs-comment">-- When instantiating the signature, do so &quot;one level in&quot;</span><span>
</span><a name="line-1774"></a><span>                  </span><span class="hs-comment">-- so that they can be unified under the forall</span><span>
</span><a name="line-1775"></a><span>              </span><a href="TcHsType.html#tcImplicitTKBndrs"><span class="hs-identifier hs-var">tcImplicitTKBndrs</span></a><span> </span><a href="#local-1628252211"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1776"></a><span>              </span><a href="TcHsType.html#tcWildCardBinders"><span class="hs-identifier hs-var">tcWildCardBinders</span></a><span> </span><a href="#local-1628252213"><span class="hs-identifier hs-var">wcs</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628252219"><a href="#local-1628252219"><span class="hs-identifier">wcs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1777"></a><span>              </span><a href="TcHsType.html#tcExplicitTKBndrs"><span class="hs-identifier hs-var">tcExplicitTKBndrs</span></a><span> </span><a href="#local-1628252216"><span class="hs-identifier hs-var">hs_tvs</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628252220"><a href="#local-1628252220"><span class="hs-identifier">tvs2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1778"></a><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Instantiate the type-class context; but if there</span><span>
</span><a name="line-1779"></a><span>              </span><span class="hs-comment">-- is an extra-constraints wildcard, just discard it here</span><span>
</span><a name="line-1780"></a><span>              </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcPartial&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252200"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252211"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252219"><span class="hs-identifier hs-var">wcs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1781"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628252221"><a href="#local-1628252221"><span class="hs-identifier">theta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcHsType.html#tcLHsPredType"><span class="hs-identifier hs-var">tcLHsPredType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1782"></a><span>                       </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628252214"><span class="hs-identifier hs-var">extra</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1783"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628252217"><span class="hs-identifier hs-var">hs_ctxt</span></a><span>
</span><a name="line-1784"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Util.html#dropTail"><span class="hs-identifier hs-var">dropTail</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-1628252217"><span class="hs-identifier hs-var">hs_ctxt</span></a><span>
</span><a name="line-1785"></a><span>
</span><a name="line-1786"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628252222"><a href="#local-1628252222"><span class="hs-identifier">tau</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsOpenType"><span class="hs-identifier hs-var">tcHsOpenType</span></a><span> </span><a href="#local-1628252218"><span class="hs-identifier hs-var">hs_tau</span></a><span>
</span><a name="line-1787"></a><span>
</span><a name="line-1788"></a><span>                </span><span class="hs-comment">-- zonking is necessary to establish type representation</span><span>
</span><a name="line-1789"></a><span>                </span><span class="hs-comment">-- invariants</span><span>
</span><a name="line-1790"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628252223"><a href="#local-1628252223"><span class="hs-identifier">theta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcTypes"><span class="hs-identifier hs-var">zonkTcTypes</span></a><span> </span><a href="#local-1628252221"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-1791"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628252224"><a href="#local-1628252224"><span class="hs-identifier">tau</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-1628252222"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-1792"></a><span>
</span><a name="line-1793"></a><span>              </span><span class="hs-comment">-- Check for validity (eg rankN etc)</span><span>
</span><a name="line-1794"></a><span>              </span><span class="hs-comment">-- The ambiguity check will happen (from checkValidType),</span><span>
</span><a name="line-1795"></a><span>              </span><span class="hs-comment">-- but unnecessarily; it will always succeed because there</span><span>
</span><a name="line-1796"></a><span>              </span><span class="hs-comment">-- is no quantification</span><span>
</span><a name="line-1797"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a><span> </span><a href="#local-1628252201"><span class="hs-identifier hs-var">ctxt_F</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a><span> </span><a href="#local-1628252223"><span class="hs-identifier hs-var">theta</span></a><span> </span><a href="#local-1628252224"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span>
</span><a name="line-1798"></a><span>                </span><span class="hs-comment">-- NB: Do this in the context of the pushTcLevel so that</span><span>
</span><a name="line-1799"></a><span>                </span><span class="hs-comment">-- the TcLevel invariant is respected</span><span>
</span><a name="line-1800"></a><span>
</span><a name="line-1801"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628252225"><a href="#local-1628252225"><span class="hs-identifier">bound_tvs</span></a></a><span>
</span><a name="line-1802"></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#unionVarSets"><span class="hs-identifier hs-var">unionVarSets</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="TcType.html#allBoundVariabless"><span class="hs-identifier hs-var">allBoundVariabless</span></a><span> </span><a href="#local-1628252223"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-1803"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="TcType.html#allBoundVariables"><span class="hs-identifier hs-var">allBoundVariables</span></a><span> </span><a href="#local-1628252224"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-1804"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="VarSet.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-1628252219"><span class="hs-identifier hs-var">wcs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1805"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1628252219"><span class="hs-identifier hs-var">wcs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628252220"><span class="hs-identifier hs-var">tvs2</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628252223"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628252224"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628252225"><span class="hs-identifier hs-var">bound_tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1806"></a><span>
</span><a name="line-1807"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628252231"><a href="#local-1628252231"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-1808"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1809"></a><span>         </span><a href="TcRnTypes.html#TISI"><span class="hs-identifier hs-var">TISI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_bndr</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#PartialSig"><span class="hs-identifier hs-var">PartialSig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252200"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_hs_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252215"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-1810"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_cts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252214"><span class="hs-identifier hs-var">extra</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_wcs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252227"><span class="hs-identifier hs-var">wcs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1811"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_skols</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-1628252232"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628252232"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628252232"><a href="#local-1628252232"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252226"><span class="hs-identifier hs-var">vars1</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628252228"><span class="hs-identifier hs-var">tvs2</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1812"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_theta</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252229"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-1813"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_tau</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252230"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-1814"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_ctxt</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252201"><span class="hs-identifier hs-var">ctxt_F</span></a><span>
</span><a name="line-1815"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_loc</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252231"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1816"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1817"></a><span>    </span><a name="local-1628252200"><a href="#local-1628252200"><span class="hs-identifier">name</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628252199"><span class="hs-identifier hs-var">mb_name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1818"></a><span>               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628252203"><a href="#local-1628252203"><span class="hs-identifier">n</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628252203"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1819"></a><span>               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelNames.html#mkUnboundName"><span class="hs-identifier hs-var">mkUnboundName</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkVarOcc"><span class="hs-identifier hs-var">mkVarOcc</span></a><span> </span><span class="hs-string">&quot;&lt;expression&gt;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1820"></a><span>    </span><a name="local-1628252201"><a href="#local-1628252201"><span class="hs-identifier">ctxt_F</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628252199"><span class="hs-identifier hs-var">mb_name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1821"></a><span>               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628252204"><a href="#local-1628252204"><span class="hs-identifier">n</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a href="#local-1628252204"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1822"></a><span>               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#ExprSigCtxt"><span class="hs-identifier hs-var">ExprSigCtxt</span></a><span>
</span><a name="line-1823"></a><span>    </span><a name="local-1628252202"><a href="#local-1628252202"><span class="hs-identifier">ctxt_T</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628252199"><span class="hs-identifier hs-var">mb_name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1824"></a><span>               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628252205"><a href="#local-1628252205"><span class="hs-identifier">n</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a href="#local-1628252205"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1825"></a><span>               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#ExprSigCtxt"><span class="hs-identifier hs-var">ExprSigCtxt</span></a><span>
</span><a name="line-1826"></a><span>
</span><a name="line-1827"></a><span class="hs-identifier">instTcTySigFromId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span>
</span><a name="line-1828"></a><span class="hs-comment">-- Used for instance methods and record selectors</span><span>
</span><a name="line-1829"></a><a name="instTcTySigFromId"><a href="TcBinds.html#instTcTySigFromId"><span class="hs-identifier">instTcTySigFromId</span></a></a><span> </span><a name="local-1628252233"><a href="#local-1628252233"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-1830"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628252234"><a href="#local-1628252234"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628252233"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-1831"></a><span>             </span><a name="local-1628252235"><a href="#local-1628252235"><span class="hs-identifier">loc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a><span> </span><a href="#local-1628252234"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1832"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628252236"><a href="#local-1628252236"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252237"><a href="#local-1628252237"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252238"><a href="#local-1628252238"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#tcInstType"><span class="hs-identifier hs-var">tcInstType</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#tcInstSigTyVarsLoc"><span class="hs-identifier hs-var">tcInstSigTyVarsLoc</span></a><span> </span><a href="#local-1628252235"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1833"></a><span>                                         </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628252233"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1834"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnTypes.html#TISI"><span class="hs-identifier hs-var">TISI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_bndr</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CompleteSig"><span class="hs-identifier hs-var">CompleteSig</span></a><span> </span><a href="#local-1628252233"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-1835"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_skols</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-1628252239"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628252239"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628252239"><a href="#local-1628252239"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252236"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">]</span><span>
</span><a name="line-1836"></a><span>                          </span><span class="hs-comment">-- These are freshly instantiated, so although</span><span>
</span><a name="line-1837"></a><span>                          </span><span class="hs-comment">-- we put them in the type envt, doing so has</span><span>
</span><a name="line-1838"></a><span>                          </span><span class="hs-comment">-- no effect</span><span>
</span><a name="line-1839"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_theta</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252237"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-1840"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_tau</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252238"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-1841"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_ctxt</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a href="#local-1628252234"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1842"></a><span>                          </span><span class="hs-comment">-- False: do not report redundant constraints</span><span>
</span><a name="line-1843"></a><span>                          </span><span class="hs-comment">-- The user has no control over the signature!</span><span>
</span><a name="line-1844"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_loc</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252235"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1845"></a><span>
</span><a name="line-1846"></a><span class="hs-identifier">instTcTySig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>
</span><a name="line-1847"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>         </span><span class="hs-comment">-- Used to get the scoped type variables</span><span>
</span><a name="line-1848"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-1849"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>                      </span><span class="hs-comment">-- Name of the function</span><span>
</span><a name="line-1850"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span>
</span><a name="line-1851"></a><a name="instTcTySig"><a href="TcBinds.html#instTcTySig"><span class="hs-identifier">instTcTySig</span></a></a><span> </span><a name="local-1628252240"><a href="#local-1628252240"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-1628252241"><a href="#local-1628252241"><span class="hs-identifier">hs_ty</span></a></a><span> </span><a name="local-1628252242"><a href="#local-1628252242"><span class="hs-identifier">sigma_ty</span></a></a><span> </span><a name="local-1628252243"><a href="#local-1628252243"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1852"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628252244"><a href="#local-1628252244"><span class="hs-identifier">inst_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252245"><a href="#local-1628252245"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252246"><a href="#local-1628252246"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#tcInstType"><span class="hs-identifier hs-var">tcInstType</span></a><span> </span><a href="TcMType.html#tcInstSigTyVars"><span class="hs-identifier hs-var">tcInstSigTyVars</span></a><span> </span><a href="#local-1628252242"><span class="hs-identifier hs-var">sigma_ty</span></a><span>
</span><a name="line-1853"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TISI"><span class="hs-identifier hs-var">TISI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_bndr</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CompleteSig"><span class="hs-identifier hs-var">CompleteSig</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a><span> </span><a href="#local-1628252243"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628252242"><span class="hs-identifier hs-var">sigma_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1854"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_skols</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#findScopedTyVars"><span class="hs-identifier hs-var">findScopedTyVars</span></a><span> </span><a href="#local-1628252242"><span class="hs-identifier hs-var">sigma_ty</span></a><span> </span><a href="#local-1628252244"><span class="hs-identifier hs-var">inst_tvs</span></a><span>
</span><a name="line-1855"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_theta</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252245"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-1856"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_tau</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252246"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-1857"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_ctxt</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252240"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-1858"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_loc</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsSigType"><span class="hs-identifier hs-var">hsSigType</span></a><span> </span><a href="#local-1628252241"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1859"></a><span>                                    </span><span class="hs-comment">-- SrcSpan from the signature</span><span>
</span><a name="line-1860"></a><span>               </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1861"></a><span>
</span><a name="line-1862"></a><span class="hs-comment">-------------------------------</span><span>
</span><a name="line-1863"></a><span class="hs-keyword">data</span><span> </span><a name="GeneralisationPlan"><a href="TcBinds.html#GeneralisationPlan"><span class="hs-identifier">GeneralisationPlan</span></a></a><span>
</span><a name="line-1864"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NoGen"><a href="TcBinds.html#NoGen"><span class="hs-identifier">NoGen</span></a></a><span>               </span><span class="hs-comment">-- No generalisation, no AbsBinds</span><span>
</span><a name="line-1865"></a><span>
</span><a name="line-1866"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InferGen"><a href="TcBinds.html#InferGen"><span class="hs-identifier">InferGen</span></a></a><span>            </span><span class="hs-comment">-- Implicit generalisation; there is an AbsBinds</span><span>
</span><a name="line-1867"></a><span>       </span><span class="hs-identifier hs-type">Bool</span><span>             </span><span class="hs-comment">--   True &lt;=&gt; apply the MR; generalise only unconstrained type vars</span><span>
</span><a name="line-1868"></a><span>
</span><a name="line-1869"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CheckGen"><a href="TcBinds.html#CheckGen"><span class="hs-identifier">CheckGen</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span>
</span><a name="line-1870"></a><span>                        </span><span class="hs-comment">-- One FunBind with a signature</span><span>
</span><a name="line-1871"></a><span>                        </span><span class="hs-comment">-- Explicit generalisation; there is an AbsBindsSig</span><span>
</span><a name="line-1872"></a><span>
</span><a name="line-1873"></a><span class="hs-comment">-- A consequence of the no-AbsBinds choice (NoGen) is that there is</span><span>
</span><a name="line-1874"></a><span class="hs-comment">-- no &quot;polymorphic Id&quot; and &quot;monmomorphic Id&quot;; there is just the one</span><span>
</span><a name="line-1875"></a><span>
</span><a name="line-1876"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcBinds.html#GeneralisationPlan"><span class="hs-identifier hs-type">GeneralisationPlan</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1877"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="TcBinds.html#NoGen"><span class="hs-identifier hs-var">NoGen</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;NoGen&quot;</span><span>
</span><a name="line-1878"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcBinds.html#InferGen"><span class="hs-identifier hs-var">InferGen</span></a><span> </span><a name="local-1628252322"><a href="#local-1628252322"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;InferGen&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252322"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1879"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcBinds.html#CheckGen"><span class="hs-identifier hs-var">CheckGen</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628252323"><a href="#local-1628252323"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CheckGen&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252323"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1880"></a><span>
</span><a name="line-1881"></a><span class="hs-identifier">decideGeneralisationPlan</span><span>
</span><a name="line-1882"></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1883"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcBinds.html#GeneralisationPlan"><span class="hs-identifier hs-type">GeneralisationPlan</span></a><span>
</span><a name="line-1884"></a><a name="decideGeneralisationPlan"><a href="TcBinds.html#decideGeneralisationPlan"><span class="hs-identifier">decideGeneralisationPlan</span></a></a><span> </span><a name="local-1628252247"><a href="#local-1628252247"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1628252248"><a href="#local-1628252248"><span class="hs-identifier">type_env</span></a></a><span> </span><a name="local-1628252249"><a href="#local-1628252249"><span class="hs-identifier">bndr_names</span></a></a><span> </span><a name="local-1628252250"><a href="#local-1628252250"><span class="hs-identifier">lbinds</span></a></a><span> </span><a name="local-1628252251"><a href="#local-1628252251"><span class="hs-identifier">sig_fn</span></a></a><span>
</span><a name="line-1885"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628252255"><span class="hs-identifier hs-var">unlifted_pat_binds</span></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="TcBinds.html#NoGen"><span class="hs-identifier hs-var">NoGen</span></a><span>
</span><a name="line-1886"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628252282"><a href="#local-1628252282"><span class="hs-identifier">bind_sig</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252262"><span class="hs-identifier hs-var">one_funbind_with_sig</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252254"><span class="hs-identifier hs-var">sig_plan</span></a><span> </span><a href="#local-1628252282"><span class="hs-identifier hs-var">bind_sig</span></a><span>
</span><a name="line-1887"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628252259"><span class="hs-identifier hs-var">mono_local_binds</span></a><span>                      </span><span class="hs-glyph">=</span><span> </span><a href="TcBinds.html#NoGen"><span class="hs-identifier hs-var">NoGen</span></a><span>
</span><a name="line-1888"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                             </span><span class="hs-glyph">=</span><span> </span><a href="TcBinds.html#InferGen"><span class="hs-identifier hs-var">InferGen</span></a><span> </span><a href="#local-1628252256"><span class="hs-identifier hs-var">mono_restriction</span></a><span>
</span><a name="line-1889"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1890"></a><span>    </span><a name="local-1628252252"><a href="#local-1628252252"><span class="hs-identifier">bndr_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-1628252249"><span class="hs-identifier hs-var">bndr_names</span></a><span>
</span><a name="line-1891"></a><span>    </span><a name="local-1628252253"><a href="#local-1628252253"><span class="hs-identifier">binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628252250"><span class="hs-identifier hs-var">lbinds</span></a><span>
</span><a name="line-1892"></a><span>
</span><a name="line-1893"></a><span>    </span><span class="hs-identifier">sig_plan</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcBinds.html#GeneralisationPlan"><span class="hs-identifier hs-type">GeneralisationPlan</span></a><span>
</span><a name="line-1894"></a><span>    </span><span class="hs-comment">-- See Note [Partial type signatures and generalisation]</span><span>
</span><a name="line-1895"></a><span>    </span><span class="hs-comment">-- We use InferGen False to say &quot;do inference, but do not apply</span><span>
</span><a name="line-1896"></a><span>    </span><span class="hs-comment">-- the MR&quot;.  It's stupid to apply the MR when we are given a</span><span>
</span><a name="line-1897"></a><span>    </span><span class="hs-comment">-- signature!  C.f Trac #11016, function f2</span><span>
</span><a name="line-1898"></a><span>    </span><a name="local-1628252254"><a href="#local-1628252254"><span class="hs-identifier">sig_plan</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628252265"><a href="#local-1628252265"><span class="hs-identifier">lbind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252266"><a href="#local-1628252266"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#TISI"><span class="hs-identifier hs-var">TISI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_bndr</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252267"><a href="#local-1628252267"><span class="hs-identifier">s_bndr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_theta</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252268"><a href="#local-1628252268"><span class="hs-identifier">theta</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1899"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628252267"><span class="hs-identifier hs-var">s_bndr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1900"></a><span>          </span><a href="TcRnTypes.html#CompleteSig"><span class="hs-identifier hs-var">CompleteSig</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcBinds.html#CheckGen"><span class="hs-identifier hs-var">CheckGen</span></a><span> </span><a href="#local-1628252265"><span class="hs-identifier hs-var">lbind</span></a><span> </span><a href="#local-1628252266"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-1901"></a><span>          </span><a href="TcRnTypes.html#PartialSig"><span class="hs-identifier hs-var">PartialSig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_cts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252269"><a href="#local-1628252269"><span class="hs-identifier">extra_constraints</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1902"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252269"><span class="hs-identifier hs-var">extra_constraints</span></a><span>
</span><a name="line-1903"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252268"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-1904"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcBinds.html#InferGen"><span class="hs-identifier hs-var">InferGen</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>   </span><span class="hs-comment">-- No signature constraints: apply the MR</span><span>
</span><a name="line-1905"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1906"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcBinds.html#InferGen"><span class="hs-identifier hs-var">InferGen</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- Don't apply the MR</span><span>
</span><a name="line-1907"></a><span>
</span><a name="line-1908"></a><span>    </span><a name="local-1628252255"><a href="#local-1628252255"><span class="hs-identifier">unlifted_pat_binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><a href="HsPat.html#isUnliftedHsBind"><span class="hs-identifier hs-var">isUnliftedHsBind</span></a><span> </span><a href="#local-1628252253"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-1909"></a><span>       </span><span class="hs-comment">-- Unlifted patterns (unboxed tuple) must not</span><span>
</span><a name="line-1910"></a><span>       </span><span class="hs-comment">-- be polymorphic, because we are going to force them</span><span>
</span><a name="line-1911"></a><span>       </span><span class="hs-comment">-- See Trac #4498, #8762</span><span>
</span><a name="line-1912"></a><span>
</span><a name="line-1913"></a><span>    </span><a name="local-1628252256"><a href="#local-1628252256"><span class="hs-identifier">mono_restriction</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#MonomorphismRestriction"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">MonomorphismRestriction</span></a><span> </span><a href="#local-1628252247"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1914"></a><span>                     </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><a href="#local-1628252263"><span class="hs-identifier hs-var">restricted</span></a><span> </span><a href="#local-1628252253"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-1915"></a><span>
</span><a name="line-1916"></a><span>    </span><span class="hs-identifier">is_closed_ns</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1917"></a><span>    </span><a name="local-1628252257"><a href="#local-1628252257"><span class="hs-identifier">is_closed_ns</span></a></a><span> </span><a name="local-1628252270"><a href="#local-1628252270"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-1628252271"><a href="#local-1628252271"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#foldNameSet"><span class="hs-identifier hs-var">foldNameSet</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;&amp;</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1628252258"><span class="hs-identifier hs-var">is_closed_id</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252271"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-1628252270"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-1918"></a><span>        </span><span class="hs-comment">-- ns are the Names referred to from the RHS of this bind</span><span>
</span><a name="line-1919"></a><span>
</span><a name="line-1920"></a><span>    </span><span class="hs-identifier">is_closed_id</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1921"></a><span>    </span><span class="hs-comment">-- See Note [Bindings with closed types] in TcRnTypes</span><span>
</span><a name="line-1922"></a><span>    </span><a name="local-1628252258"><a href="#local-1628252258"><span class="hs-identifier">is_closed_id</span></a></a><span> </span><a name="local-1628252272"><a href="#local-1628252272"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1923"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628252272"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628252252"><span class="hs-identifier hs-var">bndr_set</span></a><span>
</span><a name="line-1924"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>              </span><span class="hs-comment">-- Ignore binders in this groups, of course</span><span>
</span><a name="line-1925"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628252273"><a href="#local-1628252273"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-1628252248"><span class="hs-identifier hs-var">type_env</span></a><span> </span><a href="#local-1628252272"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1926"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628252273"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1927"></a><span>          </span><a href="TcRnTypes.html#ATcId"><span class="hs-identifier hs-var">ATcId</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tct_closed</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252274"><a href="#local-1628252274"><span class="hs-identifier">cl</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#isTopLevel"><span class="hs-identifier hs-var">isTopLevel</span></a><span> </span><a href="#local-1628252274"><span class="hs-identifier hs-var">cl</span></a><span>  </span><span class="hs-comment">-- This is the key line</span><span>
</span><a name="line-1928"></a><span>          </span><a href="TcRnTypes.html#ATyVar"><span class="hs-identifier hs-var">ATyVar</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>          </span><span class="hs-comment">-- In-scope type variables</span><span>
</span><a name="line-1929"></a><span>          </span><a href="TcRnTypes.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>           </span><span class="hs-comment">--    are not closed!</span><span>
</span><a name="line-1930"></a><span>          </span><span class="hs-identifier">_</span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;is_closed_id&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252272"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1931"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1932"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isInternalName</span><span> </span><a href="Name.html#isInternalName"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#isInternalName"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252272"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-1933"></a><span>        </span><span class="hs-comment">-- The free-var set for a top level binding mentions</span><span>
</span><a name="line-1934"></a><span>        </span><span class="hs-comment">-- imported things too, so that we can report unused imports</span><span>
</span><a name="line-1935"></a><span>        </span><span class="hs-comment">-- These won't be in the local type env.</span><span>
</span><a name="line-1936"></a><span>        </span><span class="hs-comment">-- Ditto class method etc from the current module</span><span>
</span><a name="line-1937"></a><span>
</span><a name="line-1938"></a><span>    </span><a name="local-1628252259"><a href="#local-1628252259"><span class="hs-identifier">mono_local_binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#MonoLocalBinds"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">MonoLocalBinds</span></a><span> </span><a href="#local-1628252247"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1939"></a><span>                    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1628252260"><span class="hs-identifier hs-var">closed_flag</span></a><span>
</span><a name="line-1940"></a><span>
</span><a name="line-1941"></a><span>    </span><a name="local-1628252260"><a href="#local-1628252260"><span class="hs-identifier">closed_flag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628252257"><span class="hs-identifier hs-var">is_closed_ns</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">bind_fvs</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-1628252253"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-1942"></a><span>
</span><a name="line-1943"></a><span>    </span><a name="local-1628252261"><a href="#local-1628252261"><span class="hs-identifier">no_sig</span></a></a><span> </span><a name="local-1628252275"><a href="#local-1628252275"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#noCompleteSig"><span class="hs-identifier hs-var">noCompleteSig</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628252251"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-1628252275"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1944"></a><span>
</span><a name="line-1945"></a><span>    </span><span class="hs-comment">-- With OutsideIn, all nested bindings are monomorphic</span><span>
</span><a name="line-1946"></a><span>    </span><span class="hs-comment">-- except a single function binding with a signature</span><span>
</span><a name="line-1947"></a><span>    </span><a name="local-1628252262"><a href="#local-1628252262"><span class="hs-identifier">one_funbind_with_sig</span></a></a><span>
</span><a name="line-1948"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><a name="local-1628252276"><a href="#local-1628252276"><span class="hs-identifier">lbind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252277"><a href="#local-1628252277"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252250"><span class="hs-identifier hs-var">lbinds</span></a><span>
</span><a name="line-1949"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcIdSig"><span class="hs-identifier hs-var">TcIdSig</span></a><span> </span><a name="local-1628252278"><a href="#local-1628252278"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252251"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628252277"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1950"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628252276"><span class="hs-identifier hs-var">lbind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628252278"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span>
</span><a name="line-1951"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1952"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1953"></a><span>
</span><a name="line-1954"></a><span>    </span><span class="hs-comment">-- The Haskell 98 monomorphism restriction</span><span>
</span><a name="line-1955"></a><span>    </span><a name="local-1628252263"><a href="#local-1628252263"><span class="hs-identifier">restricted</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PatBind"><span class="hs-identifier hs-var">PatBind</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1956"></a><span>    </span><span class="hs-identifier">restricted</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#VarBind"><span class="hs-identifier hs-var">VarBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">var_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252279"><a href="#local-1628252279"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252261"><span class="hs-identifier hs-var">no_sig</span></a><span> </span><a href="#local-1628252279"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1957"></a><span>    </span><span class="hs-identifier">restricted</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252280"><a href="#local-1628252280"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252281"><a href="#local-1628252281"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628252264"><span class="hs-identifier hs-var">restricted_match</span></a><span> </span><a href="#local-1628252281"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-1958"></a><span>                                                           </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1628252261"><span class="hs-identifier hs-var">no_sig</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628252280"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1959"></a><span>    </span><span class="hs-identifier">restricted</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PatSynBind"><span class="hs-identifier hs-var">PatSynBind</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;isRestrictedGroup/unrestricted PatSynBind&quot;</span><span>
</span><a name="line-1960"></a><span>    </span><span class="hs-identifier">restricted</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#AbsBinds"><span class="hs-identifier hs-var">AbsBinds</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;isRestrictedGroup/unrestricted AbsBinds&quot;</span><span>
</span><a name="line-1961"></a><span>    </span><span class="hs-identifier">restricted</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#AbsBindsSig"><span class="hs-identifier hs-var">AbsBindsSig</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;isRestrictedGroup/unrestricted AbsBindsSig&quot;</span><span>
</span><a name="line-1962"></a><span>
</span><a name="line-1963"></a><span>    </span><a name="local-1628252264"><a href="#local-1628252264"><span class="hs-identifier">restricted_match</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#MG"><span class="hs-identifier hs-var">MG</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mg_alts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#Match"><span class="hs-identifier hs-var">Match</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1964"></a><span>    </span><span class="hs-identifier">restricted_match</span><span> </span><span class="hs-identifier">_</span><span>                                                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1965"></a><span>        </span><span class="hs-comment">-- No args =&gt; like a pattern binding</span><span>
</span><a name="line-1966"></a><span>        </span><span class="hs-comment">-- Some args =&gt; a function binding</span><span>
</span><a name="line-1967"></a><span>
</span><a name="line-1968"></a><span class="hs-comment">-------------------</span><span>
</span><a name="line-1969"></a><span class="hs-identifier">checkStrictBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span>
</span><a name="line-1970"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1971"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span>
</span><a name="line-1972"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1973"></a><span class="hs-comment">-- Check that non-overloaded unlifted bindings are</span><span>
</span><a name="line-1974"></a><span class="hs-comment">--      a) non-recursive,</span><span>
</span><a name="line-1975"></a><span class="hs-comment">--      b) not top level,</span><span>
</span><a name="line-1976"></a><span class="hs-comment">--      c) not a multiple-binding group (more or less implied by (a))</span><span>
</span><a name="line-1977"></a><span>
</span><a name="line-1978"></a><a name="checkStrictBinds"><a href="TcBinds.html#checkStrictBinds"><span class="hs-identifier">checkStrictBinds</span></a></a><span> </span><a name="local-1628252283"><a href="#local-1628252283"><span class="hs-identifier">top_lvl</span></a></a><span> </span><a name="local-1628252284"><a href="#local-1628252284"><span class="hs-identifier">rec_group</span></a></a><span> </span><a name="local-1628252285"><a href="#local-1628252285"><span class="hs-identifier">orig_binds</span></a></a><span> </span><a name="local-1628252286"><a href="#local-1628252286"><span class="hs-identifier">tc_binds</span></a></a><span> </span><a name="local-1628252287"><a href="#local-1628252287"><span class="hs-identifier">poly_ids</span></a></a><span>
</span><a name="line-1979"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628252288"><span class="hs-identifier hs-var">any_unlifted_bndr</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1628252289"><span class="hs-identifier hs-var">any_strict_pat</span></a><span>   </span><span class="hs-comment">-- This binding group must be matched strictly</span><span>
</span><a name="line-1980"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="#local-1628252293"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#isNotTopLevel"><span class="hs-identifier hs-var">isNotTopLevel</span></a><span> </span><a href="#local-1628252283"><span class="hs-identifier hs-var">top_lvl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1981"></a><span>                </span><span class="hs-special">(</span><a href="TcBinds.html#strictBindErr"><span class="hs-identifier hs-var">strictBindErr</span></a><span> </span><span class="hs-string">&quot;Top-level&quot;</span><span> </span><a href="#local-1628252288"><span class="hs-identifier hs-var">any_unlifted_bndr</span></a><span> </span><a href="#local-1628252285"><span class="hs-identifier hs-var">orig_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1982"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="#local-1628252293"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#isNonRec"><span class="hs-identifier hs-var">isNonRec</span></a><span> </span><a href="#local-1628252284"><span class="hs-identifier hs-var">rec_group</span></a><span class="hs-special">)</span><span>
</span><a name="line-1983"></a><span>                </span><span class="hs-special">(</span><a href="TcBinds.html#strictBindErr"><span class="hs-identifier hs-var">strictBindErr</span></a><span> </span><span class="hs-string">&quot;Recursive&quot;</span><span> </span><a href="#local-1628252288"><span class="hs-identifier hs-var">any_unlifted_bndr</span></a><span> </span><a href="#local-1628252285"><span class="hs-identifier hs-var">orig_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1984"></a><span>
</span><a name="line-1985"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="#local-1628252293"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="#local-1628252292"><span class="hs-identifier hs-var">is_monomorphic</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628252286"><span class="hs-identifier hs-var">tc_binds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1986"></a><span>                  </span><span class="hs-special">(</span><a href="TcBinds.html#polyBindErr"><span class="hs-identifier hs-var">polyBindErr</span></a><span> </span><a href="#local-1628252285"><span class="hs-identifier hs-var">orig_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1987"></a><span>            </span><span class="hs-comment">-- data Ptr a = Ptr Addr#</span><span>
</span><a name="line-1988"></a><span>            </span><span class="hs-comment">-- f x = let p@(Ptr y) = ... in ...</span><span>
</span><a name="line-1989"></a><span>            </span><span class="hs-comment">-- Here the binding for 'p' is polymorphic, but does</span><span>
</span><a name="line-1990"></a><span>            </span><span class="hs-comment">-- not mix with an unlifted binding for 'y'.  You should</span><span>
</span><a name="line-1991"></a><span>            </span><span class="hs-comment">-- use a bang pattern.  Trac #6078.</span><span>
</span><a name="line-1992"></a><span>
</span><a name="line-1993"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="#local-1628252293"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a><span> </span><a href="#local-1628252285"><span class="hs-identifier hs-var">orig_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1994"></a><span>                </span><span class="hs-special">(</span><a href="TcBinds.html#strictBindErr"><span class="hs-identifier hs-var">strictBindErr</span></a><span> </span><span class="hs-string">&quot;Multiple&quot;</span><span> </span><a href="#local-1628252288"><span class="hs-identifier hs-var">any_unlifted_bndr</span></a><span> </span><a href="#local-1628252285"><span class="hs-identifier hs-var">orig_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1995"></a><span>
</span><a name="line-1996"></a><span>        </span><span class="hs-comment">-- Complain about a binding that looks lazy</span><span>
</span><a name="line-1997"></a><span>        </span><span class="hs-comment">--    e.g.    let I# y = x in ...</span><span>
</span><a name="line-1998"></a><span>        </span><span class="hs-comment">-- Remember, in checkStrictBinds we are going to do strict</span><span>
</span><a name="line-1999"></a><span>        </span><span class="hs-comment">-- matching, so (for software engineering reasons) we insist</span><span>
</span><a name="line-2000"></a><span>        </span><span class="hs-comment">-- that the strictness is manifest on each binding</span><span>
</span><a name="line-2001"></a><span>        </span><span class="hs-comment">-- However, lone (unboxed) variables are ok</span><span>
</span><a name="line-2002"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="#local-1628252293"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1628252290"><span class="hs-identifier hs-var">any_pat_looks_lazy</span></a><span class="hs-special">)</span><span>
</span><a name="line-2003"></a><span>                  </span><span class="hs-special">(</span><a href="TcBinds.html#unliftedMustBeBang"><span class="hs-identifier hs-var">unliftedMustBeBang</span></a><span> </span><a href="#local-1628252285"><span class="hs-identifier hs-var">orig_binds</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2004"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2005"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;csb2&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1628252302"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628252302"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628252302"><a href="#local-1628252302"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628252287"><span class="hs-identifier hs-var">poly_ids</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a><span>
</span><a name="line-2006"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2007"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2008"></a><span>    </span><a name="local-1628252288"><a href="#local-1628252288"><span class="hs-identifier">any_unlifted_bndr</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><a href="#local-1628252291"><span class="hs-identifier hs-var">is_unlifted</span></a><span> </span><a href="#local-1628252287"><span class="hs-identifier hs-var">poly_ids</span></a><span>
</span><a name="line-2009"></a><span>    </span><a name="local-1628252289"><a href="#local-1628252289"><span class="hs-identifier">any_strict_pat</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><a href="HsPat.html#isUnliftedHsBind"><span class="hs-identifier hs-var">isUnliftedHsBind</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252285"><span class="hs-identifier hs-var">orig_binds</span></a><span>
</span><a name="line-2010"></a><span>    </span><a name="local-1628252290"><a href="#local-1628252290"><span class="hs-identifier">any_pat_looks_lazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><a href="HsPat.html#looksLazyPatBind"><span class="hs-identifier hs-var">looksLazyPatBind</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252285"><span class="hs-identifier hs-var">orig_binds</span></a><span>
</span><a name="line-2011"></a><span>
</span><a name="line-2012"></a><span>    </span><a name="local-1628252291"><a href="#local-1628252291"><span class="hs-identifier">is_unlifted</span></a></a><span> </span><a name="local-1628252294"><a href="#local-1628252294"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628252294"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2013"></a><span>                       </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628252295"><a href="#local-1628252295"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a><span> </span><a href="#local-1628252295"><span class="hs-identifier hs-var">rho</span></a><span>
</span><a name="line-2014"></a><span>          </span><span class="hs-comment">-- For the is_unlifted check, we need to look inside polymorphism</span><span>
</span><a name="line-2015"></a><span>          </span><span class="hs-comment">-- and overloading.  E.g.  x = (# 1, True #)</span><span>
</span><a name="line-2016"></a><span>          </span><span class="hs-comment">-- would get type forall a. Num a =&gt; (# a, Bool #)</span><span>
</span><a name="line-2017"></a><span>          </span><span class="hs-comment">-- and we want to reject that.  See Trac #9140</span><span>
</span><a name="line-2018"></a><span>
</span><a name="line-2019"></a><span>    </span><a name="local-1628252292"><a href="#local-1628252292"><span class="hs-identifier">is_monomorphic</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#AbsBinds"><span class="hs-identifier hs-var">AbsBinds</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">abs_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252296"><a href="#local-1628252296"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_ev_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252297"><a href="#local-1628252297"><span class="hs-identifier">evs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2020"></a><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628252296"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628252297"><span class="hs-identifier hs-var">evs</span></a><span>
</span><a name="line-2021"></a><span>    </span><span class="hs-identifier">is_monomorphic</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#AbsBindsSig"><span class="hs-identifier hs-var">AbsBindsSig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">abs_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252298"><a href="#local-1628252298"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_ev_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252299"><a href="#local-1628252299"><span class="hs-identifier">evs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2022"></a><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628252298"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628252299"><span class="hs-identifier hs-var">evs</span></a><span>
</span><a name="line-2023"></a><span>    </span><span class="hs-identifier">is_monomorphic</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2024"></a><span>
</span><a name="line-2025"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2026"></a><span>    </span><span class="hs-comment">-- Just like checkTc, but with a special case for module GHC.Prim:</span><span>
</span><a name="line-2027"></a><span>    </span><span class="hs-comment">--      see Note [Compiling GHC.Prim]</span><span>
</span><a name="line-2028"></a><span>    </span><a name="local-1628252293"><a href="#local-1628252293"><span class="hs-identifier">check</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2029"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-1628252300"><a href="#local-1628252300"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628252301"><a href="#local-1628252301"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a><span>
</span><a name="line-2030"></a><span>                         </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628252301"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#gHC_PRIM"><span class="hs-identifier hs-var">gHC_PRIM</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628252300"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2031"></a><span>
</span><a name="line-2032"></a><span class="hs-identifier">unliftedMustBeBang</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2033"></a><a name="unliftedMustBeBang"><a href="TcBinds.html#unliftedMustBeBang"><span class="hs-identifier">unliftedMustBeBang</span></a></a><span> </span><a name="local-1628252303"><a href="#local-1628252303"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-2034"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Pattern bindings containing unlifted types should use an outermost bang pattern:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2035"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252303"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2036"></a><span>
</span><a name="line-2037"></a><span class="hs-identifier">polyBindErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2038"></a><a name="polyBindErr"><a href="TcBinds.html#polyBindErr"><span class="hs-identifier">polyBindErr</span></a></a><span> </span><a name="local-1628252304"><a href="#local-1628252304"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-2039"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;You can't mix polymorphic and unlifted bindings&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2040"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252304"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2041"></a><span>                </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Probable fix: add a type signature&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2042"></a><span>
</span><a name="line-2043"></a><span class="hs-identifier">strictBindErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2044"></a><a name="strictBindErr"><a href="TcBinds.html#strictBindErr"><span class="hs-identifier">strictBindErr</span></a></a><span> </span><a name="local-1628252305"><a href="#local-1628252305"><span class="hs-identifier">flavour</span></a></a><span> </span><a name="local-1628252306"><a href="#local-1628252306"><span class="hs-identifier">any_unlifted_bndr</span></a></a><span> </span><a name="local-1628252307"><a href="#local-1628252307"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-2045"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628252305"><span class="hs-identifier hs-var">flavour</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628252308"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;aren't allowed:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2046"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252307"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2047"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2048"></a><span>    </span><a name="local-1628252308"><a href="#local-1628252308"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628252306"><span class="hs-identifier hs-var">any_unlifted_bndr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;bindings for unlifted types&quot;</span><span>
</span><a name="line-2049"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;bang-pattern or unboxed-tuple bindings&quot;</span><span>
</span><a name="line-2050"></a><span>
</span><a name="line-2051"></a><span>
</span><a name="line-2052"></a><span class="hs-comment">{- Note [Compiling GHC.Prim]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Module GHC.Prim has no source code: it is the host module for
primitive, built-in functions and types.  However, for Haddock-ing
purposes we generate (via utils/genprimopcode) a fake source file
GHC/Prim.hs, and give it to Haddock, so that it can generate
documentation.  It contains definitions like
    nullAddr# :: NullAddr#
which would normally be rejected as a top-level unlifted binding. But
we don't want to complain, because we are only &quot;compiling&quot; this fake
mdule for documentation purposes.  Hence this hacky test for gHC_PRIM
in checkStrictBinds.

(We only make the test if things look wrong, so there is no cost in
the common case.) -}</span><span>
</span><a name="line-2067"></a><span>
</span><a name="line-2068"></a><span>
</span><a name="line-2069"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
               Error contexts and messages
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-2074"></a><span>
</span><a name="line-2075"></a><span class="hs-comment">-- This one is called on LHS, when pat and grhss are both Name</span><span>
</span><a name="line-2076"></a><span class="hs-comment">-- and on RHS, when pat is TcId and grhss is still Name</span><span>
</span><a name="line-2077"></a><span class="hs-identifier">patMonoBindsCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#OutputableBndr"><span class="hs-identifier hs-type">OutputableBndr</span></a><span> </span><a href="#local-1628251636"><span class="hs-identifier hs-type">id</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-1628251637"><span class="hs-identifier hs-type">body</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HsPat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a><span> </span><a href="#local-1628251636"><span class="hs-identifier hs-type">id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><a href="#local-1628251637"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2078"></a><a name="patMonoBindsCtxt"><a href="TcBinds.html#patMonoBindsCtxt"><span class="hs-identifier">patMonoBindsCtxt</span></a></a><span> </span><a name="local-1628252309"><a href="#local-1628252309"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-1628252310"><a href="#local-1628252310"><span class="hs-identifier">grhss</span></a></a><span>
</span><a name="line-2079"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In a pattern binding:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#pprPatBind"><span class="hs-identifier hs-var">pprPatBind</span></a><span> </span><a href="#local-1628252309"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-1628252310"><span class="hs-identifier hs-var">grhss</span></a><span class="hs-special">)</span><span>
</span><a name="line-2080"></a><span>
</span><a name="line-2081"></a><span class="hs-identifier">typeSigCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcIdSigBndr"><span class="hs-identifier hs-type">TcIdSigBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2082"></a><a name="typeSigCtxt"><a href="TcBinds.html#typeSigCtxt"><span class="hs-identifier">typeSigCtxt</span></a></a><span> </span><a name="local-1628252311"><a href="#local-1628252311"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#PartialSig"><span class="hs-identifier hs-var">PartialSig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_hs_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628252312"><a href="#local-1628252312"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2083"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#pprSigCtxt"><span class="hs-identifier hs-var">pprSigCtxt</span></a><span> </span><a href="#local-1628252311"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252312"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2084"></a><span class="hs-identifier">typeSigCtxt</span><span> </span><a name="local-1628252313"><a href="#local-1628252313"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CompleteSig"><span class="hs-identifier hs-var">CompleteSig</span></a><span> </span><a name="local-1628252314"><a href="#local-1628252314"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2085"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#pprSigCtxt"><span class="hs-identifier hs-var">pprSigCtxt</span></a><span> </span><a href="#local-1628252313"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628252314"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2086"></a><span>
</span><a name="line-2087"></a><span class="hs-identifier">instErrCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2088"></a><a name="instErrCtxt"><a href="TcBinds.html#instErrCtxt"><span class="hs-identifier">instErrCtxt</span></a></a><span> </span><a name="local-1628252315"><a href="#local-1628252315"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-1628252316"><a href="#local-1628252316"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1628252317"><a href="#local-1628252317"><span class="hs-identifier">env</span></a></a><span>
</span><a name="line-2089"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628252320"><a href="#local-1628252320"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628252321"><a href="#local-1628252321"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyOpenType"><span class="hs-identifier hs-var">tidyOpenType</span></a><span> </span><a href="#local-1628252317"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628252316"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2090"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628252320"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;When instantiating&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252315"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-2091"></a><span>                             </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;, initially inferred to have&quot;</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-2092"></a><span>                             </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;this overly-general type:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2093"></a><span>                          </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628252321"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-2094"></a><span>                       </span><a href="#local-1628252318"><span class="hs-identifier hs-var">extra</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2095"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2096"></a><span>    </span><a name="local-1628252318"><a href="#local-1628252318"><span class="hs-identifier">extra</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628252319"><a href="#local-1628252319"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2097"></a><span>            </span><a href="Outputable.html#ppWhen"><span class="hs-identifier hs-var">ppWhen</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#MonomorphismRestriction"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">MonomorphismRestriction</span></a><span> </span><a href="#local-1628252319"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2098"></a><span>            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;NB: This instantiation can be caused by the&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-2099"></a><span>            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;monomorphism restriction.&quot;</span><span>
</span><a name="line-2100"></a></pre></body></html>