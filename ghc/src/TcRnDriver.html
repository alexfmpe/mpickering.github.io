<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[TcMovectle]{Typechecking a whole module}

https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/TypeChecker
-}</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcRnDriver</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-15"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-16"></a><span>        </span><a href="TcRnDriver.html#tcRnStmt"><span class="hs-identifier hs-var">tcRnStmt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnDriver.html#tcRnExpr"><span class="hs-identifier hs-var">tcRnExpr</span></a><span class="hs-special">,</span><span> </span><a href="TcRnDriver.html#tcRnType"><span class="hs-identifier hs-var">tcRnType</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="TcRnDriver.html#tcRnImportDecls"><span class="hs-identifier hs-var">tcRnImportDecls</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>        </span><a href="TcRnDriver.html#tcRnLookupRdrName"><span class="hs-identifier hs-var">tcRnLookupRdrName</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="TcRnDriver.html#getModuleInterface"><span class="hs-identifier hs-var">getModuleInterface</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>        </span><a href="TcRnDriver.html#tcRnDeclsi"><span class="hs-identifier hs-var">tcRnDeclsi</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="TcRnDriver.html#isGHCiMonad"><span class="hs-identifier hs-var">isGHCiMonad</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Used by GHC API clients (Trac #8878)</span><span>
</span><a name="line-23"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-24"></a><span>        </span><a href="TcRnDriver.html#tcRnLookupName"><span class="hs-identifier hs-var">tcRnLookupName</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><a href="TcRnDriver.html#tcRnGetInfo"><span class="hs-identifier hs-var">tcRnGetInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="TcRnDriver.html#tcRnModule"><span class="hs-identifier hs-var">tcRnModule</span></a><span class="hs-special">,</span><span> </span><a href="TcRnDriver.html#tcRnModuleTcRnM"><span class="hs-identifier hs-var">tcRnModuleTcRnM</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>        </span><a href="TcRnDriver.html#tcTopSrcDecls"><span class="hs-identifier hs-var">tcTopSrcDecls</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="TcSplice.html"><span class="hs-identifier">TcSplice</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcSplice.html#finishTH"><span class="hs-identifier hs-var">finishTH</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="RnSplice.html"><span class="hs-identifier">RnSplice</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="RnSplice.html#rnTopSpliceDecls"><span class="hs-identifier hs-var">rnTopSpliceDecls</span></a><span class="hs-special">,</span><span> </span><a href="RnSplice.html#traceSplice"><span class="hs-identifier hs-var">traceSplice</span></a><span class="hs-special">,</span><span> </span><a href="RnSplice.html#SpliceInfo"><span class="hs-identifier hs-type">SpliceInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="IfaceEnv.html"><span class="hs-identifier">IfaceEnv</span></a><span class="hs-special">(</span><span> </span><a href="IfaceEnv.html#externaliseName"><span class="hs-identifier hs-var">externaliseName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="TcHsType.html"><span class="hs-identifier">TcHsType</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="TcMatches.html"><span class="hs-identifier">TcMatches</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="RnTypes.html"><span class="hs-identifier">RnTypes</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="RnExpr.html"><span class="hs-identifier">RnExpr</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="MkId.html"><span class="hs-identifier">MkId</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="TidyPgm.html"><span class="hs-identifier">TidyPgm</span></a><span>    </span><span class="hs-special">(</span><span> </span><a href="TidyPgm.html#globaliseAndTidyId"><span class="hs-identifier hs-var">globaliseAndTidyId</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TysWiredIn.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#mkListTy"><span class="hs-identifier hs-var">mkListTy</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="DynamicLoading.html"><span class="hs-identifier">DynamicLoading</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="DynamicLoading.html#loadPlugins"><span class="hs-identifier hs-var">loadPlugins</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="Plugins.html"><span class="hs-identifier">Plugins</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Plugins.html#tcPlugin"><span class="hs-identifier hs-var">tcPlugin</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="StaticFlags.html"><span class="hs-identifier">StaticFlags</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="TcHsSyn.html"><span class="hs-identifier">TcHsSyn</span></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="TcExpr.html"><span class="hs-identifier">TcExpr</span></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="TcEvidence.html"><span class="hs-identifier">TcEvidence</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="PprTyThing.html"><span class="hs-identifier">PprTyThing</span></a><span class="hs-special">(</span><span> </span><a href="PprTyThing.html#pprTyThing"><span class="hs-identifier hs-var">pprTyThing</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span class="hs-special">(</span><span> </span><a href="Coercion.html#pprCoAxiom"><span class="hs-identifier hs-var">pprCoAxiom</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="CoreFVs.html"><span class="hs-identifier">CoreFVs</span></a><span class="hs-special">(</span><span> </span><a href="CoreFVs.html#orphNamesOfFamInst"><span class="hs-identifier hs-var">orphNamesOfFamInst</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="FamInst.html"><span class="hs-identifier">FamInst</span></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="InstEnv.html"><span class="hs-identifier">InstEnv</span></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="TcAnnotations.html"><span class="hs-identifier">TcAnnotations</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="TcBinds.html"><span class="hs-identifier">TcBinds</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="HeaderInfo.html"><span class="hs-identifier">HeaderInfo</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="HeaderInfo.html#mkPrelImports"><span class="hs-identifier hs-var">mkPrelImports</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="TcDefaults.html"><span class="hs-identifier">TcDefaults</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="TcEnv.html"><span class="hs-identifier">TcEnv</span></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="TcRules.html"><span class="hs-identifier">TcRules</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="TcForeign.html"><span class="hs-identifier">TcForeign</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="TcInstDcls.html"><span class="hs-identifier">TcInstDcls</span></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="TcIface.html"><span class="hs-identifier">TcIface</span></a><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="TcMType.html"><span class="hs-identifier">TcMType</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="MkIface.html"><span class="hs-identifier">MkIface</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="TcSimplify.html"><span class="hs-identifier">TcSimplify</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="TcTyClsDecls.html"><span class="hs-identifier">TcTyClsDecls</span></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><a href="TcTypeable.html"><span class="hs-identifier">TcTypeable</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcTypeable.html#mkTypeableBinds"><span class="hs-identifier hs-var">mkTypeableBinds</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="LoadIface.html"><span class="hs-identifier">LoadIface</span></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="TidyPgm.html"><span class="hs-identifier">TidyPgm</span></a><span>    </span><span class="hs-special">(</span><span> </span><a href="TidyPgm.html#mkBootModDetailsTc"><span class="hs-identifier hs-var">mkBootModDetailsTc</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="RnNames.html"><span class="hs-identifier">RnNames</span></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="RnEnv.html"><span class="hs-identifier">RnEnv</span></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><a href="RnSource.html"><span class="hs-identifier">RnSource</span></a><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><a href="IdInfo.html"><span class="hs-identifier">IdInfo</span></a><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><a href="Avail.html"><span class="hs-identifier">Avail</span></a><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><a href="ConLike.html"><span class="hs-identifier">ConLike</span></a><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><a href="PatSyn.html"><span class="hs-identifier">PatSyn</span></a><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span> </span><span class="hs-keyword">hiding</span><span class="hs-special">(</span><span> </span><a href="BasicTypes.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><a href="CoAxiom.html"><span class="hs-identifier">CoAxiom</span></a><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><a href="Annotations.html"><span class="hs-identifier">Annotations</span></a><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Ord.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Ord</span></a><span>
</span><a name="line-105"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-106"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-107"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-108"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-109"></a><span class="hs-keyword">import</span><span> </span><a href="Inst.html"><span class="hs-identifier">Inst</span></a><span> </span><span class="hs-special">(</span><a href="Inst.html#tcGetInsts"><span class="hs-identifier hs-var">tcGetInsts</span></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Typecheck and rename a module
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-comment">-- | Top level entry point for typechecker and renamer</span><span>
</span><a name="line-125"></a><span class="hs-identifier">tcRnModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-126"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span>
</span><a name="line-127"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>              </span><span class="hs-comment">-- True &lt;=&gt; save renamed syntax</span><span>
</span><a name="line-128"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a><span>
</span><a name="line-129"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><a name="tcRnModule"><a href="TcRnDriver.html#tcRnModule"><span class="hs-identifier">tcRnModule</span></a></a><span> </span><a name="local-1628289108"><a href="#local-1628289108"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628289109"><a href="#local-1628289109"><span class="hs-identifier">hsc_src</span></a></a><span> </span><a name="local-1628289110"><a href="#local-1628289110"><span class="hs-identifier">save_rn_syntax</span></a></a><span>
</span><a name="line-132"></a><span>   </span><a name="local-1628289111"><a href="#local-1628289111"><span class="hs-identifier">parsedModule</span></a></a><span class="hs-glyph">@</span><a href="HscTypes.html#HsParsedModule"><span class="hs-identifier hs-var">HsParsedModule</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hpm_module</span><span class="hs-glyph">=</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628289112"><a href="#local-1628289112"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628289113"><a href="#local-1628289113"><span class="hs-identifier">this_module</span></a></a><span class="hs-special">}</span><span>
</span><a name="line-133"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-var">RealSrcSpan</span></a><span> </span><a name="local-1628289120"><a href="#local-1628289120"><span class="hs-identifier">real_loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289112"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-134"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="ErrUtils.html#showPass"><span class="hs-identifier hs-var">showPass</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628289108"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;Renamer/typechecker&quot;</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#initTc"><span class="hs-identifier hs-var">initTc</span></a><span> </span><a href="#local-1628289108"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628289109"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><a href="#local-1628289110"><span class="hs-identifier hs-var">save_rn_syntax</span></a><span> </span><a href="#local-1628289117"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><a href="#local-1628289120"><span class="hs-identifier hs-var">real_loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-137"></a><span>               </span><a href="TcRnDriver.html#withTcPlugins"><span class="hs-identifier hs-var">withTcPlugins</span></a><span> </span><a href="#local-1628289108"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-138"></a><span>               </span><a href="TcRnDriver.html#tcRnModuleTcRnM"><span class="hs-identifier hs-var">tcRnModuleTcRnM</span></a><span> </span><a href="#local-1628289108"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628289109"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><a href="#local-1628289111"><span class="hs-identifier hs-var">parsedModule</span></a><span> </span><a href="#local-1628289116"><span class="hs-identifier hs-var">pair</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-141"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span class="hs-special">,</span><span> </span><a href="Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a><span> </span><a href="#local-1628289114"><span class="hs-identifier hs-var">err_msg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-144"></a><span>    </span><a name="local-1628289114"><a href="#local-1628289114"><span class="hs-identifier">err_msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628289108"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289112"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-145"></a><span>              </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Module does not have a RealSrcSpan:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289117"><span class="hs-identifier hs-var">this_mod</span></a><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span>    </span><a name="local-1628289115"><a href="#local-1628289115"><span class="hs-identifier">this_pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">thisPackage</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628289108"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span>    </span><span class="hs-identifier">pair</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>    </span><a name="local-1628289116"><a href="#local-1628289116"><span class="hs-identifier">pair</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1628289117"><a href="#local-1628289117"><span class="hs-identifier">this_mod</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628289118"><a href="#local-1628289118"><span class="hs-identifier">mod_loc</span></a></a><span> </span><a name="local-1628289119"><a href="#local-1628289119"><span class="hs-identifier">mod</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">hsmodName</span><span> </span><a href="#local-1628289113"><span class="hs-identifier hs-var">this_module</span></a><span>
</span><a name="line-152"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span> </span><a href="#local-1628289115"><span class="hs-identifier hs-var">this_pkg</span></a><span> </span><a href="#local-1628289119"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289118"><span class="hs-identifier hs-var">mod_loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>   </span><span class="hs-comment">-- 'module M where' is omitted</span><span>
</span><a name="line-155"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#mAIN"><span class="hs-identifier hs-var">mAIN</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#srcLocSpan"><span class="hs-identifier hs-var">srcLocSpan</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#srcSpanStart"><span class="hs-identifier hs-var">srcSpanStart</span></a><span> </span><a href="#local-1628289112"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-comment">-- To be called at the beginning of renaming hsig files.</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- If we're processing a signature, load up the RdrEnv</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- specified by sig-of so that</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- when we process top-level bindings, we pull in the right</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- original names.  We also need to add in dependencies from</span><span>
</span><a name="line-163"></a><span class="hs-comment">-- the implementation (orphans, family instances, packages),</span><span>
</span><a name="line-164"></a><span class="hs-comment">-- similar to how rnImportDecl handles things.</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- ToDo: Handle SafeHaskell</span><span>
</span><a name="line-166"></a><span class="hs-identifier">tcRnSignature</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-167"></a><a name="tcRnSignature"><a href="TcRnDriver.html#tcRnSignature"><span class="hs-identifier">tcRnSignature</span></a></a><span> </span><a name="local-1628289121"><a href="#local-1628289121"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1628289122"><a href="#local-1628289122"><span class="hs-identifier">hsc_src</span></a></a><span>
</span><a name="line-168"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289123"><a href="#local-1628289123"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-169"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">tcg_sig_of</span><span> </span><a href="#local-1628289123"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-170"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289124"><a href="#local-1628289124"><span class="hs-identifier">sof</span></a></a><span>
</span><a name="line-171"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628289122"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="DriverPhases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-172"></a><span>                </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Illegal -sig-of specified for non hsig&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>                </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289123"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-174"></a><span>                </span><span class="hs-special">}</span><span>
</span><a name="line-175"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-176"></a><span>            </span><span class="hs-special">{</span><span> </span><a name="local-1628289125"><a href="#local-1628289125"><span class="hs-identifier">sig_iface</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#initIfaceTcRn"><span class="hs-identifier hs-var">initIfaceTcRn</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="LoadIface.html#loadSysInterface"><span class="hs-identifier hs-var">loadSysInterface</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;sig-of&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628289124"><span class="hs-identifier hs-var">sof</span></a><span>
</span><a name="line-177"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289126"><a href="#local-1628289126"><span class="hs-identifier">gr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#mkGlobalRdrEnv"><span class="hs-identifier hs-var">mkGlobalRdrEnv</span></a><span>
</span><a name="line-178"></a><span>                              </span><span class="hs-special">(</span><a href="RdrName.html#gresFromAvails"><span class="hs-identifier hs-var">gresFromAvails</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_exports</span><span> </span><a href="#local-1628289125"><span class="hs-identifier hs-var">sig_iface</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>                  </span><span class="hs-special">;</span><span> </span><a name="local-1628289127"><a href="#local-1628289127"><span class="hs-identifier">avails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnNames.html#calculateAvails"><span class="hs-identifier hs-var">calculateAvails</span></a><span> </span><a href="#local-1628289121"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-180"></a><span>                                    </span><a href="#local-1628289125"><span class="hs-identifier hs-var">sig_iface</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-comment">{- safe -}</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-comment">{- boot -}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-181"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289123"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-182"></a><span>                </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_impl_rdr_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628289126"><span class="hs-identifier hs-var">gr</span></a><span>
</span><a name="line-183"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_imports</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_imports</span><span> </span><a href="#local-1628289123"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">`</span><a href="TcRnTypes.html#plusImportAvails"><span class="hs-identifier hs-var">plusImportAvails</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289127"><span class="hs-identifier hs-var">avails</span></a><span>
</span><a name="line-184"></a><span>                </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>            </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-186"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-187"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="DriverPhases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289122"><span class="hs-identifier hs-var">hsc_src</span></a><span>
</span><a name="line-188"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">hscTarget</span><span> </span><a href="#local-1628289121"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-189"></a><span>                </span><span class="hs-special">{</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289123"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-190"></a><span>                </span><span class="hs-special">}</span><span>
</span><a name="line-191"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="DriverPhases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289122"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-192"></a><span>                </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Missing -sig-of for hsig&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>                </span><span class="hs-special">;</span><span> </span><a href="IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-194"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289123"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-195"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-196"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-identifier">checkHsigIface</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><a name="checkHsigIface"><a href="TcRnDriver.html#checkHsigIface"><span class="hs-identifier">checkHsigIface</span></a></a><span> </span><a name="local-1628289128"><a href="#local-1628289128"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628289129"><a href="#local-1628289129"><span class="hs-identifier">tcg_env</span></a></a><span>
</span><a name="line-200"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">tcg_impl_rdr_env</span><span> </span><a href="#local-1628289129"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-201"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289130"><a href="#local-1628289130"><span class="hs-identifier">gr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289131"><a href="#local-1628289131"><span class="hs-identifier">sig_details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TidyPgm.html#mkBootModDetailsTc"><span class="hs-identifier hs-var">mkBootModDetailsTc</span></a><span> </span><a href="#local-1628289128"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628289129"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-202"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="TcRnDriver.html#checkHsigIface%27"><span class="hs-identifier hs-var">checkHsigIface'</span></a><span> </span><a href="#local-1628289130"><span class="hs-identifier hs-var">gr</span></a><span> </span><a href="#local-1628289131"><span class="hs-identifier hs-var">sig_details</span></a><span>
</span><a name="line-203"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-204"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span class="hs-identifier">checkHsigIface'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-207"></a><a name="checkHsigIface%27"><a href="TcRnDriver.html#checkHsigIface%27"><span class="hs-identifier">checkHsigIface'</span></a></a><span> </span><a name="local-1628289132"><a href="#local-1628289132"><span class="hs-identifier">gr</span></a></a><span>
</span><a name="line-208"></a><span>  </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-var">ModDetails</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">md_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289133"><a href="#local-1628289133"><span class="hs-identifier">sig_insts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_fam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289134"><a href="#local-1628289134"><span class="hs-identifier">sig_fam_insts</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-209"></a><span>               </span><span class="hs-identifier">md_types</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289135"><a href="#local-1628289135"><span class="hs-identifier">sig_type_env</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_exports</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289136"><a href="#local-1628289136"><span class="hs-identifier">sig_exports</span></a></a><span class="hs-special">}</span><span>
</span><a name="line-210"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;checkHsigIface&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-211"></a><span>           </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289135"><span class="hs-identifier hs-var">sig_type_env</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289133"><span class="hs-identifier hs-var">sig_insts</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289136"><span class="hs-identifier hs-var">sig_exports</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-212"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="#local-1628289137"><span class="hs-identifier hs-var">check_export</span></a><span> </span><a href="#local-1628289136"><span class="hs-identifier hs-var">sig_exports</span></a><span>
</span><a name="line-213"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628289134"><span class="hs-identifier hs-var">sig_fam_insts</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-214"></a><span>           </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;TcRnDriver.checkHsigIface: Cannot handle family &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-215"></a><span>                  </span><span class="hs-string">&quot;instances in hsig files yet...&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="#local-1628289139"><span class="hs-identifier hs-var">check_inst</span></a><span> </span><a href="#local-1628289133"><span class="hs-identifier hs-var">sig_insts</span></a><span>
</span><a name="line-217"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a><span>
</span><a name="line-218"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-219"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-220"></a><span>    </span><a name="local-1628289137"><a href="#local-1628289137"><span class="hs-identifier">check_export</span></a></a><span> </span><a name="local-1628289140"><a href="#local-1628289140"><span class="hs-identifier">sig_avail</span></a></a><span>
</span><a name="line-221"></a><span>      </span><span class="hs-comment">-- Skip instances, we'll check them later</span><span>
</span><a name="line-222"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628289141"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289138"><span class="hs-identifier hs-var">dfun_names</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-224"></a><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Lookup local environment only (don't want to accidentally pick</span><span>
</span><a name="line-225"></a><span>          </span><span class="hs-comment">-- up the backing copy.)  We consult tcg_type_env because we want</span><span>
</span><a name="line-226"></a><span>          </span><span class="hs-comment">-- to pick up wired in names too (which get dropped by the iface</span><span>
</span><a name="line-227"></a><span>          </span><span class="hs-comment">-- creation process); it's OK for a signature file to mention</span><span>
</span><a name="line-228"></a><span>          </span><span class="hs-comment">-- a wired in name.</span><span>
</span><a name="line-229"></a><span>          </span><a name="local-1628289142"><a href="#local-1628289142"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-230"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_type_env</span><span> </span><a href="#local-1628289142"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289141"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-231"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-232"></a><span>                </span><span class="hs-comment">-- All this means is no local definition is available: but we</span><span>
</span><a name="line-233"></a><span>                </span><span class="hs-comment">-- could have created the export this way:</span><span>
</span><a name="line-234"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-235"></a><span>                </span><span class="hs-comment">-- module ASig(f) where</span><span>
</span><a name="line-236"></a><span>                </span><span class="hs-comment">--      import B(f)</span><span>
</span><a name="line-237"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-238"></a><span>                </span><span class="hs-comment">-- In this case, we have to just lookup the identifier in</span><span>
</span><a name="line-239"></a><span>                </span><span class="hs-comment">-- the backing implementation and make sure it matches.</span><span>
</span><a name="line-240"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289143"><a href="#local-1628289143"><span class="hs-identifier">name'</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-241"></a><span>                    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RdrName.html#lookupGlobalRdrEnv"><span class="hs-identifier hs-var">lookupGlobalRdrEnv</span></a><span> </span><a href="#local-1628289132"><span class="hs-identifier hs-var">gr</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1628289141"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-242"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-1628289141"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628289143"><span class="hs-identifier hs-var">name'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>                </span><span class="hs-comment">-- TODO: Possibly give a different error if the identifier</span><span>
</span><a name="line-244"></a><span>                </span><span class="hs-comment">-- is exported, but it's a different original name</span><span>
</span><a name="line-245"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a><span> </span><a href="#local-1628289141"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-246"></a><span>                                </span><span class="hs-special">(</span><a href="TcRnDriver.html#missingBootThing"><span class="hs-identifier hs-var">missingBootThing</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1628289141"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-string">&quot;exported by&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289144"><a href="#local-1628289144"><span class="hs-identifier">sig_thing</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-248"></a><span>          </span><span class="hs-comment">-- We use tcLookupImported_maybe because we want to EXCLUDE</span><span>
</span><a name="line-249"></a><span>          </span><span class="hs-comment">-- tcg_env.</span><span>
</span><a name="line-250"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289145"><a href="#local-1628289145"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LoadIface.html#tcLookupImported_maybe"><span class="hs-identifier hs-var">tcLookupImported_maybe</span></a><span> </span><a href="#local-1628289141"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-251"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628289145"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-252"></a><span>            </span><a href="Maybes.html#Failed"><span class="hs-identifier hs-var">Failed</span></a><span> </span><a name="local-1628289146"><a href="#local-1628289146"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="#local-1628289146"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-253"></a><span>            </span><a href="Maybes.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a><span> </span><a name="local-1628289147"><a href="#local-1628289147"><span class="hs-identifier">real_thing</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnDriver.html#checkBootDeclM"><span class="hs-identifier hs-var">checkBootDeclM</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1628289144"><span class="hs-identifier hs-var">sig_thing</span></a><span> </span><a href="#local-1628289147"><span class="hs-identifier hs-var">real_thing</span></a><span>
</span><a name="line-254"></a><span>        </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-255"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-256"></a><span>        </span><a name="local-1628289141"><a href="#local-1628289141"><span class="hs-identifier">name</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#availName"><span class="hs-identifier hs-var">availName</span></a><span> </span><a href="#local-1628289140"><span class="hs-identifier hs-var">sig_avail</span></a><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span>    </span><a name="local-1628289138"><a href="#local-1628289138"><span class="hs-identifier">dfun_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-1628289133"><span class="hs-identifier hs-var">sig_insts</span></a><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span>    </span><span class="hs-comment">-- In general, for hsig files we can't assume that the implementing</span><span>
</span><a name="line-261"></a><span>    </span><span class="hs-comment">-- file actually implemented the instances (they may be reexported</span><span>
</span><a name="line-262"></a><span>    </span><span class="hs-comment">-- from elsewhere).  Where should we look for the instances?  We do</span><span>
</span><a name="line-263"></a><span>    </span><span class="hs-comment">-- the same as we would otherwise: consult the EPS.  This isn't</span><span>
</span><a name="line-264"></a><span>    </span><span class="hs-comment">-- perfect (we might conclude the module exports an instance</span><span>
</span><a name="line-265"></a><span>    </span><span class="hs-comment">-- when it doesn't, see #9422), but we will never refuse to compile</span><span>
</span><a name="line-266"></a><span>    </span><span class="hs-comment">-- something</span><span>
</span><a name="line-267"></a><span>    </span><span class="hs-identifier">check_inst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span>    </span><a name="local-1628289139"><a href="#local-1628289139"><span class="hs-identifier">check_inst</span></a></a><span> </span><a name="local-1628289148"><a href="#local-1628289148"><span class="hs-identifier">sig_inst</span></a></a><span>
</span><a name="line-269"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628289149"><a href="#local-1628289149"><span class="hs-identifier">eps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getEps"><span class="hs-identifier hs-var">getEps</span></a><span>
</span><a name="line-270"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="InstEnv.html#memberInstEnv"><span class="hs-identifier hs-var">memberInstEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">eps_inst_env</span><span> </span><a href="#local-1628289149"><span class="hs-identifier hs-var">eps</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289148"><span class="hs-identifier hs-var">sig_inst</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-271"></a><span>               </span><a href="TcRnMonad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#instMisMatch"><span class="hs-identifier hs-var">instMisMatch</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1628289148"><span class="hs-identifier hs-var">sig_inst</span></a><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span class="hs-identifier">tcRnModuleTcRnM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-274"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span>
</span><a name="line-275"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a><span>
</span><a name="line-276"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">)</span><span>
</span><a name="line-277"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-278"></a><span class="hs-comment">-- Factored out separately from tcRnModule so that a Core plugin can</span><span>
</span><a name="line-279"></a><span class="hs-comment">-- call the type checker directly</span><span>
</span><a name="line-280"></a><a name="tcRnModuleTcRnM"><a href="TcRnDriver.html#tcRnModuleTcRnM"><span class="hs-identifier">tcRnModuleTcRnM</span></a></a><span> </span><a name="local-1628289150"><a href="#local-1628289150"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628289151"><a href="#local-1628289151"><span class="hs-identifier">hsc_src</span></a></a><span>
</span><a name="line-281"></a><span>                </span><span class="hs-special">(</span><a href="HscTypes.html#HsParsedModule"><span class="hs-identifier hs-var">HsParsedModule</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-282"></a><span>                   </span><span class="hs-identifier">hpm_module</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-283"></a><span>                      </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628289152"><a href="#local-1628289152"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsSyn.html#HsModule"><span class="hs-identifier hs-var">HsModule</span></a><span> </span><a name="local-1628289153"><a href="#local-1628289153"><span class="hs-identifier">maybe_mod</span></a></a><span> </span><a name="local-1628289154"><a href="#local-1628289154"><span class="hs-identifier">export_ies</span></a></a><span>
</span><a name="line-284"></a><span>                                       </span><a name="local-1628289155"><a href="#local-1628289155"><span class="hs-identifier">import_decls</span></a></a><span> </span><a name="local-1628289156"><a href="#local-1628289156"><span class="hs-identifier">local_decls</span></a></a><span> </span><a name="local-1628289157"><a href="#local-1628289157"><span class="hs-identifier">mod_deprec</span></a></a><span>
</span><a name="line-285"></a><span>                                       </span><a name="local-1628289158"><a href="#local-1628289158"><span class="hs-identifier">maybe_doc_hdr</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-286"></a><span>                   </span><span class="hs-identifier">hpm_src_files</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289159"><a href="#local-1628289159"><span class="hs-identifier">src_files</span></a></a><span>
</span><a name="line-287"></a><span>                </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-288"></a><span>                </span><span class="hs-special">(</span><a name="local-1628289160"><a href="#local-1628289160"><span class="hs-identifier">this_mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289161"><a href="#local-1628289161"><span class="hs-identifier">prel_imp_loc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-289"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628289152"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-290"></a><span>   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289162"><a href="#local-1628289162"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628289150"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-291"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628289163"><a href="#local-1628289163"><span class="hs-identifier">explicit_mod_hdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a><span> </span><a href="#local-1628289153"><span class="hs-identifier hs-var">maybe_mod</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span>        </span><a name="local-1628289164"><a href="#local-1628289164"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#tcRnSignature"><span class="hs-identifier hs-var">tcRnSignature</span></a><span> </span><a href="#local-1628289162"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628289151"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-294"></a><span>        </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628289164"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span>                </span><span class="hs-comment">-- Load the hi-boot interface for this module, if any</span><span>
</span><a name="line-297"></a><span>                </span><span class="hs-comment">-- We do this now so that the boot_names can be passed</span><span>
</span><a name="line-298"></a><span>                </span><span class="hs-comment">-- to tcTyAndClassDecls, because the boot_names are</span><span>
</span><a name="line-299"></a><span>                </span><span class="hs-comment">-- automatically considered to be loop breakers</span><span>
</span><a name="line-300"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-301"></a><span>                </span><span class="hs-comment">-- Do this *after* tcRnImports, so that we know whether</span><span>
</span><a name="line-302"></a><span>                </span><span class="hs-comment">-- a module that we import imports us; and hence whether to</span><span>
</span><a name="line-303"></a><span>                </span><span class="hs-comment">-- look for a hi-boot file</span><span>
</span><a name="line-304"></a><span>        </span><a name="local-1628289165"><a href="#local-1628289165"><span class="hs-identifier">boot_info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcHiBootIface"><span class="hs-identifier hs-var">tcHiBootIface</span></a><span> </span><a href="#local-1628289151"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><a href="#local-1628289160"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-305"></a><span>        </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289164"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_self_boot</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289165"><span class="hs-identifier hs-var">boot_info</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span>        </span><span class="hs-comment">-- Deal with imports; first add implicit prelude</span><span>
</span><a name="line-308"></a><span>        </span><a name="local-1628289166"><a href="#local-1628289166"><span class="hs-identifier">implicit_prelude</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#ImplicitPrelude"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">ImplicitPrelude</span></a><span class="hs-special">;</span><span>
</span><a name="line-309"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289167"><a href="#local-1628289167"><span class="hs-identifier">prel_imports</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HeaderInfo.html#mkPrelImports"><span class="hs-identifier hs-var">mkPrelImports</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-1628289160"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289161"><span class="hs-identifier hs-var">prel_imp_loc</span></a><span>
</span><a name="line-310"></a><span>                                         </span><a href="#local-1628289166"><span class="hs-identifier hs-var">implicit_prelude</span></a><span> </span><a href="#local-1628289155"><span class="hs-identifier hs-var">import_decls</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span>        </span><a href="TcRnMonad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a><span> </span><a href="DynFlags.html#Opt_WarnImplicitPrelude"><span class="hs-identifier hs-var">Opt_WarnImplicitPrelude</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-313"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><a href="#local-1628289167"><span class="hs-identifier hs-var">prel_imports</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-314"></a><span>                  </span><a href="TcRnMonad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="DynFlags.html#Opt_WarnImplicitPrelude"><span class="hs-identifier hs-var">Opt_WarnImplicitPrelude</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#implicitPreludeWarn"><span class="hs-identifier hs-var">implicitPreludeWarn</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span>        </span><a name="local-1628289168"><a href="#local-1628289168"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC &quot;tcRnImports&quot; #-}</span><span>
</span><a name="line-317"></a><span>                   </span><a href="TcRnDriver.html#tcRnImports"><span class="hs-identifier hs-var">tcRnImports</span></a><span> </span><a href="#local-1628289150"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289167"><span class="hs-identifier hs-var">prel_imports</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628289155"><span class="hs-identifier hs-var">import_decls</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span>          </span><span class="hs-comment">-- If the whole module is warned about or deprecated</span><span>
</span><a name="line-320"></a><span>          </span><span class="hs-comment">-- (via mod_deprec) record that in tcg_warns. If we do thereby add</span><span>
</span><a name="line-321"></a><span>          </span><span class="hs-comment">-- a WarnAll, it will override any subseqent depracations added to tcg_warns</span><span>
</span><a name="line-322"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289169"><a href="#local-1628289169"><span class="hs-identifier">tcg_env1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628289157"><span class="hs-identifier hs-var">mod_deprec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-323"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628289170"><a href="#local-1628289170"><span class="hs-identifier">txt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628289168"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_warns</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#WarnAll"><span class="hs-identifier hs-var">WarnAll</span></a><span> </span><a href="#local-1628289170"><span class="hs-identifier hs-var">txt</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-324"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628289168"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-325"></a><span>            </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-326"></a><span>
</span><a name="line-327"></a><span>        </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628289169"><span class="hs-identifier hs-var">tcg_env1</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span>                </span><span class="hs-comment">-- Rename and type check the declarations</span><span>
</span><a name="line-330"></a><span>        </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rn1a&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-331"></a><span>        </span><a name="local-1628289171"><a href="#local-1628289171"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="DriverPhases.html#isHsBootOrSig"><span class="hs-identifier hs-var">isHsBootOrSig</span></a><span> </span><a href="#local-1628289151"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-332"></a><span>                        </span><a href="TcRnDriver.html#tcRnHsBootDecls"><span class="hs-identifier hs-var">tcRnHsBootDecls</span></a><span> </span><a href="#local-1628289151"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><a href="#local-1628289156"><span class="hs-identifier hs-var">local_decls</span></a><span>
</span><a name="line-333"></a><span>                   </span><span class="hs-keyword">else</span><span>
</span><a name="line-334"></a><span>                        </span><span class="hs-pragma">{-# SCC &quot;tcRnSrcDecls&quot; #-}</span><span>
</span><a name="line-335"></a><span>                        </span><a href="TcRnDriver.html#tcRnSrcDecls"><span class="hs-identifier hs-var">tcRnSrcDecls</span></a><span> </span><a href="#local-1628289163"><span class="hs-identifier hs-var">explicit_mod_hdr</span></a><span> </span><a href="#local-1628289156"><span class="hs-identifier hs-var">local_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-336"></a><span>        </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628289171"><span class="hs-identifier hs-var">tcg_env</span></a><span>               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span>                </span><span class="hs-comment">-- Process the export list</span><span>
</span><a name="line-339"></a><span>        </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rn4a: before exports&quot;</span><span class="hs-special">)</span><span class="hs-special">;</span><span>
</span><a name="line-340"></a><span>        </span><span class="hs-special">(</span><a name="local-1628289172"><a href="#local-1628289172"><span class="hs-identifier">rn_exports</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289173"><a href="#local-1628289173"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnNames.html#rnExports"><span class="hs-identifier hs-var">rnExports</span></a><span> </span><a href="#local-1628289163"><span class="hs-identifier hs-var">explicit_mod_hdr</span></a><span> </span><a href="#local-1628289154"><span class="hs-identifier hs-var">export_ies</span></a><span> </span><a href="#local-1628289171"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-341"></a><span>        </span><a href="TcRnDriver.html#tcExports"><span class="hs-identifier hs-var">tcExports</span></a><span> </span><a href="#local-1628289172"><span class="hs-identifier hs-var">rn_exports</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-342"></a><span>        </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rn4b: after exports&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span>                </span><span class="hs-comment">-- Check that main is exported (must be after rnExports)</span><span>
</span><a name="line-345"></a><span>        </span><a href="TcRnDriver.html#checkMainExported"><span class="hs-identifier hs-var">checkMainExported</span></a><span> </span><a href="#local-1628289173"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-346"></a><span>
</span><a name="line-347"></a><span>        </span><span class="hs-comment">-- Compare the hi-boot iface (if any) with the real thing</span><span>
</span><a name="line-348"></a><span>        </span><span class="hs-comment">-- Must be done after processing the exports</span><span>
</span><a name="line-349"></a><span>        </span><a name="local-1628289174"><a href="#local-1628289174"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#checkHiBootIface"><span class="hs-identifier hs-var">checkHiBootIface</span></a><span> </span><a href="#local-1628289173"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="#local-1628289165"><span class="hs-identifier hs-var">boot_info</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-350"></a><span>
</span><a name="line-351"></a><span>        </span><span class="hs-comment">-- Compare the hsig tcg_env with the real thing</span><span>
</span><a name="line-352"></a><span>        </span><a href="TcRnDriver.html#checkHsigIface"><span class="hs-identifier hs-var">checkHsigIface</span></a><span> </span><a href="#local-1628289150"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628289174"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span>        </span><span class="hs-comment">-- Nub out type class instances now that we've checked them,</span><span>
</span><a name="line-355"></a><span>        </span><span class="hs-comment">-- if we're compiling an hsig with sig-of.</span><span>
</span><a name="line-356"></a><span>        </span><span class="hs-comment">-- See Note [Signature files and type class instances]</span><span>
</span><a name="line-357"></a><span>        </span><a name="local-1628289175"><a href="#local-1628289175"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">tcg_sig_of</span><span> </span><a href="#local-1628289174"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-358"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289174"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-359"></a><span>                        </span><span class="hs-identifier">tcg_inst_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#emptyInstEnv"><span class="hs-identifier hs-var">emptyInstEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-360"></a><span>                        </span><span class="hs-identifier">tcg_fam_inst_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FamInstEnv.html#emptyFamInstEnv"><span class="hs-identifier hs-var">emptyFamInstEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-361"></a><span>                        </span><span class="hs-identifier">tcg_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-362"></a><span>                        </span><span class="hs-identifier">tcg_fam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-363"></a><span>                        </span><span class="hs-special">}</span><span>
</span><a name="line-364"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289174"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span>        </span><span class="hs-comment">-- The new type env is already available to stuff slurped from</span><span>
</span><a name="line-367"></a><span>        </span><span class="hs-comment">-- interface files, via TcEnv.updateGlobalTypeEnv</span><span>
</span><a name="line-368"></a><span>        </span><span class="hs-comment">-- It's important that this includes the stuff in checkHiBootIface,</span><span>
</span><a name="line-369"></a><span>        </span><span class="hs-comment">-- because the latter might add new bindings for boot_dfuns,</span><span>
</span><a name="line-370"></a><span>        </span><span class="hs-comment">-- which may be mentioned in imported unfoldings</span><span>
</span><a name="line-371"></a><span>
</span><a name="line-372"></a><span>                </span><span class="hs-comment">-- Don't need to rename the Haddock documentation,</span><span>
</span><a name="line-373"></a><span>                </span><span class="hs-comment">-- it's not parsed by GHC anymore.</span><span>
</span><a name="line-374"></a><span>        </span><a name="local-1628289176"><a href="#local-1628289176"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289175"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_doc_hdr</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289158"><span class="hs-identifier hs-var">maybe_doc_hdr</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span>                </span><span class="hs-comment">-- Report unused names</span><span>
</span><a name="line-377"></a><span>        </span><a href="RnNames.html#reportUnusedNames"><span class="hs-identifier hs-var">reportUnusedNames</span></a><span> </span><a href="#local-1628289154"><span class="hs-identifier hs-var">export_ies</span></a><span> </span><a href="#local-1628289176"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span>                </span><span class="hs-comment">-- add extra source files to tcg_dependent_files</span><span>
</span><a name="line-380"></a><span>        </span><a href="TcRnMonad.html#addDependentFiles"><span class="hs-identifier hs-var">addDependentFiles</span></a><span> </span><a href="#local-1628289159"><span class="hs-identifier hs-var">src_files</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-381"></a><span>
</span><a name="line-382"></a><span>                </span><span class="hs-comment">-- Dump output and return</span><span>
</span><a name="line-383"></a><span>        </span><a href="TcRnDriver.html#tcDump"><span class="hs-identifier hs-var">tcDump</span></a><span> </span><a href="#local-1628289176"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-384"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289176"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-385"></a><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span class="hs-identifier">implicitPreludeWarn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-388"></a><a name="implicitPreludeWarn"><a href="TcRnDriver.html#implicitPreludeWarn"><span class="hs-identifier">implicitPreludeWarn</span></a></a><span>
</span><a name="line-389"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Module `Prelude' implicitly imported&quot;</span><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Import declarations
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-identifier">tcRnImports</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-400"></a><a name="tcRnImports"><a href="TcRnDriver.html#tcRnImports"><span class="hs-identifier">tcRnImports</span></a></a><span> </span><a name="local-1628289177"><a href="#local-1628289177"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628289178"><a href="#local-1628289178"><span class="hs-identifier">import_decls</span></a></a><span>
</span><a name="line-401"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628289179"><a href="#local-1628289179"><span class="hs-identifier">rn_imports</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289180"><a href="#local-1628289180"><span class="hs-identifier">rdr_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289181"><a href="#local-1628289181"><span class="hs-identifier">imports</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289182"><a href="#local-1628289182"><span class="hs-identifier">hpc_info</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnNames.html#rnImports"><span class="hs-identifier hs-var">rnImports</span></a><span> </span><a href="#local-1628289178"><span class="hs-identifier hs-var">import_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289183"><a href="#local-1628289183"><span class="hs-identifier">this_mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a><span>
</span><a name="line-404"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dep_mods</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleNameEnv"><span class="hs-identifier hs-type">ModuleNameEnv</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span>
</span><a name="line-405"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-1628289184"><a href="#local-1628289184"><span class="hs-identifier">dep_mods</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">imp_dep_mods</span><span> </span><a href="#local-1628289181"><span class="hs-identifier hs-var">imports</span></a><span>
</span><a name="line-406"></a><span>
</span><a name="line-407"></a><span>                </span><span class="hs-comment">-- We want instance declarations from all home-package</span><span>
</span><a name="line-408"></a><span>                </span><span class="hs-comment">-- modules below this one, including boot modules, except</span><span>
</span><a name="line-409"></a><span>                </span><span class="hs-comment">-- ourselves.  The 'except ourselves' is so that we don't</span><span>
</span><a name="line-410"></a><span>                </span><span class="hs-comment">-- get the instances from this module's hs-boot file.  This</span><span>
</span><a name="line-411"></a><span>                </span><span class="hs-comment">-- filtering also ensures that we don't see instances from</span><span>
</span><a name="line-412"></a><span>                </span><span class="hs-comment">-- modules batch (@--make@) compiled before this one, but</span><span>
</span><a name="line-413"></a><span>                </span><span class="hs-comment">-- which are not below this one.</span><span>
</span><a name="line-414"></a><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">want_instances</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-415"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-1628289185"><a href="#local-1628289185"><span class="hs-identifier">want_instances</span></a></a><span> </span><a name="local-1628289188"><a href="#local-1628289188"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289188"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-special">`</span><a href="UniqFM.html#elemUFM"><span class="hs-identifier hs-var">elemUFM</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289184"><span class="hs-identifier hs-var">dep_mods</span></a><span>
</span><a name="line-416"></a><span>                                   </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1628289188"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-1628289183"><span class="hs-identifier hs-var">this_mod</span></a><span>
</span><a name="line-417"></a><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628289186"><a href="#local-1628289186"><span class="hs-identifier">home_insts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289187"><a href="#local-1628289187"><span class="hs-identifier">home_fam_insts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#hptInstances"><span class="hs-identifier hs-var">hptInstances</span></a><span> </span><a href="#local-1628289177"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-418"></a><span>                                                            </span><a href="#local-1628289185"><span class="hs-identifier hs-var">want_instances</span></a><span>
</span><a name="line-419"></a><span>              </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span>                </span><span class="hs-comment">-- Record boot-file info in the EPS, so that it's</span><span>
</span><a name="line-422"></a><span>                </span><span class="hs-comment">-- visible to loadHiBootInterface in tcRnSrcDecls,</span><span>
</span><a name="line-423"></a><span>                </span><span class="hs-comment">-- and any other incrementally-performed imports</span><span>
</span><a name="line-424"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#updateEps_"><span class="hs-identifier hs-var">updateEps_</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628289189"><a href="#local-1628289189"><span class="hs-identifier">eps</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628289189"><span class="hs-identifier hs-var">eps</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eps_is_boot</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289184"><span class="hs-identifier hs-var">dep_mods</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span>                </span><span class="hs-comment">-- Update the gbl env</span><span>
</span><a name="line-427"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628289190"><a href="#local-1628289190"><span class="hs-identifier">gbl</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-428"></a><span>            </span><a href="#local-1628289190"><span class="hs-identifier hs-var">gbl</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-429"></a><span>              </span><span class="hs-identifier">tcg_rdr_env</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_rdr_env</span><span> </span><a href="#local-1628289190"><span class="hs-identifier hs-var">gbl</span></a><span> </span><span class="hs-special">`</span><a href="RdrName.html#plusGlobalRdrEnv"><span class="hs-identifier hs-var">plusGlobalRdrEnv</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289180"><span class="hs-identifier hs-var">rdr_env</span></a><span class="hs-special">,</span><span>
</span><a name="line-430"></a><span>              </span><span class="hs-identifier">tcg_imports</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_imports</span><span> </span><a href="#local-1628289190"><span class="hs-identifier hs-var">gbl</span></a><span> </span><span class="hs-special">`</span><a href="TcRnTypes.html#plusImportAvails"><span class="hs-identifier hs-var">plusImportAvails</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289181"><span class="hs-identifier hs-var">imports</span></a><span class="hs-special">,</span><span>
</span><a name="line-431"></a><span>              </span><span class="hs-identifier">tcg_rn_imports</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289179"><span class="hs-identifier hs-var">rn_imports</span></a><span class="hs-special">,</span><span>
</span><a name="line-432"></a><span>              </span><span class="hs-identifier">tcg_inst_env</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#extendInstEnvList"><span class="hs-identifier hs-var">extendInstEnvList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_inst_env</span><span> </span><a href="#local-1628289190"><span class="hs-identifier hs-var">gbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289186"><span class="hs-identifier hs-var">home_insts</span></a><span class="hs-special">,</span><span>
</span><a name="line-433"></a><span>              </span><span class="hs-identifier">tcg_fam_inst_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FamInstEnv.html#extendFamInstEnvList"><span class="hs-identifier hs-var">extendFamInstEnvList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_fam_inst_env</span><span> </span><a href="#local-1628289190"><span class="hs-identifier hs-var">gbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-434"></a><span>                                                      </span><a href="#local-1628289187"><span class="hs-identifier hs-var">home_fam_insts</span></a><span class="hs-special">,</span><span>
</span><a name="line-435"></a><span>              </span><span class="hs-identifier">tcg_hpc</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289182"><span class="hs-identifier hs-var">hpc_info</span></a><span>
</span><a name="line-436"></a><span>            </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rn1&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">imp_dep_mods</span><span> </span><a href="#local-1628289181"><span class="hs-identifier hs-var">imports</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-439"></a><span>                </span><span class="hs-comment">-- Fail if there are any errors so far</span><span>
</span><a name="line-440"></a><span>                </span><span class="hs-comment">-- The error printing (if needed) takes advantage</span><span>
</span><a name="line-441"></a><span>                </span><span class="hs-comment">-- of the tcg_env we have now set</span><span>
</span><a name="line-442"></a><span class="hs-comment">--      ; traceIf (text &quot;rdr_env: &quot; &lt;+&gt; ppr rdr_env)</span><span>
</span><a name="line-443"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span>                </span><span class="hs-comment">-- Load any orphan-module and family instance-module</span><span>
</span><a name="line-446"></a><span>                </span><span class="hs-comment">-- interfaces, so that their rules and instance decls will be</span><span>
</span><a name="line-447"></a><span>                </span><span class="hs-comment">-- found.  But filter out a self hs-boot: these instances</span><span>
</span><a name="line-448"></a><span>                </span><span class="hs-comment">-- will be checked when we define them locally.</span><span>
</span><a name="line-449"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="LoadIface.html#loadModuleInterfaces"><span class="hs-identifier hs-var">loadModuleInterfaces</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Loading orphan modules&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-450"></a><span>                               </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1628289183"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">imp_orphs</span><span> </span><a href="#local-1628289181"><span class="hs-identifier hs-var">imports</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-451"></a><span>
</span><a name="line-452"></a><span>                </span><span class="hs-comment">-- Check type-family consistency</span><span>
</span><a name="line-453"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rn1: checking family instance consistency&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289191"><a href="#local-1628289191"><span class="hs-identifier">dir_imp_mods</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#moduleEnvKeys"><span class="hs-identifier hs-var">moduleEnvKeys</span></a><span>
</span><a name="line-455"></a><span>                             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">imp_mods</span><span>
</span><a name="line-456"></a><span>                             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1628289181"><span class="hs-identifier hs-var">imports</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-457"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="FamInst.html#checkFamInstConsistency"><span class="hs-identifier hs-var">checkFamInstConsistency</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">imp_finsts</span><span> </span><a href="#local-1628289181"><span class="hs-identifier hs-var">imports</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289191"><span class="hs-identifier hs-var">dir_imp_mods</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-460"></a><span>
</span><a name="line-461"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Type-checking the top level of a module
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span class="hs-identifier">tcRnSrcDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>  </span><span class="hs-comment">-- False =&gt; no 'module M(..) where' header at all</span><span>
</span><a name="line-470"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Declarations</span><span>
</span><a name="line-471"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-472"></a><span>        </span><span class="hs-comment">-- Returns the variables free in the decls</span><span>
</span><a name="line-473"></a><span>        </span><span class="hs-comment">-- Reason: solely to report unused imports and bindings</span><span>
</span><a name="line-474"></a><a name="tcRnSrcDecls"><a href="TcRnDriver.html#tcRnSrcDecls"><span class="hs-identifier">tcRnSrcDecls</span></a></a><span> </span><a name="local-1628289192"><a href="#local-1628289192"><span class="hs-identifier">explicit_mod_hdr</span></a></a><span> </span><a name="local-1628289193"><a href="#local-1628289193"><span class="hs-identifier">decls</span></a></a><span>
</span><a name="line-475"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Do all the declarations</span><span>
</span><a name="line-476"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628289197"><a href="#local-1628289197"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289198"><a href="#local-1628289198"><span class="hs-identifier">tcl_env</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628289199"><a href="#local-1628289199"><span class="hs-identifier">lie</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-477"></a><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628289194"><a href="#local-1628289194"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289195"><a href="#local-1628289195"><span class="hs-identifier">tcl_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#tc_rn_src_decls"><span class="hs-identifier hs-var">tc_rn_src_decls</span></a><span> </span><a href="#local-1628289193"><span class="hs-identifier hs-var">decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-478"></a><span>                 </span><span class="hs-special">;</span><span> </span><a name="local-1628289196"><a href="#local-1628289196"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289194"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289195"><span class="hs-identifier hs-var">tcl_env</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-479"></a><span>                              </span><a href="TcRnDriver.html#checkMain"><span class="hs-identifier hs-var">checkMain</span></a><span> </span><a href="#local-1628289192"><span class="hs-identifier hs-var">explicit_mod_hdr</span></a><span>
</span><a name="line-480"></a><span>                 </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289196"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289195"><span class="hs-identifier hs-var">tcl_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-481"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289197"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289198"><span class="hs-identifier hs-var">tcl_env</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-482"></a><span>
</span><a name="line-483"></a><span>        </span><span class="hs-comment">-- Emit Typeable bindings</span><span>
</span><a name="line-484"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-1628289200"><a href="#local-1628289200"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628289197"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="TcTypeable.html#mkTypeableBinds"><span class="hs-identifier hs-var">mkTypeableBinds</span></a><span>
</span><a name="line-485"></a><span>
</span><a name="line-486"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628289200"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-489"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcSplice.html#finishTH"><span class="hs-identifier hs-var">finishTH</span></a><span>
</span><a name="line-490"></a><span class="hs-cpp">#endif /* GHCI */</span><span>
</span><a name="line-491"></a><span>
</span><a name="line-492"></a><span>        </span><span class="hs-comment">-- wanted constraints from static forms</span><span>
</span><a name="line-493"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-1628289201"><a href="#local-1628289201"><span class="hs-identifier">stWC</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcg_static_wc</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span>
</span><a name="line-494"></a><span>
</span><a name="line-495"></a><span>             </span><span class="hs-comment">--         Finish simplifying class constraints</span><span>
</span><a name="line-496"></a><span>             </span><span class="hs-comment">--</span><span>
</span><a name="line-497"></a><span>             </span><span class="hs-comment">-- simplifyTop deals with constant or ambiguous InstIds.</span><span>
</span><a name="line-498"></a><span>             </span><span class="hs-comment">-- How could there be ambiguous ones?  They can only arise if a</span><span>
</span><a name="line-499"></a><span>             </span><span class="hs-comment">-- top-level decl falls under the monomorphism restriction</span><span>
</span><a name="line-500"></a><span>             </span><span class="hs-comment">-- and no subsequent decl instantiates its type.</span><span>
</span><a name="line-501"></a><span>             </span><span class="hs-comment">--</span><span>
</span><a name="line-502"></a><span>             </span><span class="hs-comment">-- We do this after checkMain, so that we use the type info</span><span>
</span><a name="line-503"></a><span>             </span><span class="hs-comment">-- that checkMain adds</span><span>
</span><a name="line-504"></a><span>             </span><span class="hs-comment">--</span><span>
</span><a name="line-505"></a><span>             </span><span class="hs-comment">-- We do it with both global and local env in scope:</span><span>
</span><a name="line-506"></a><span>             </span><span class="hs-comment">--  * the global env exposes the instances to simplifyTop</span><span>
</span><a name="line-507"></a><span>             </span><span class="hs-comment">--  * the local env exposes the local Ids to simplifyTop,</span><span>
</span><a name="line-508"></a><span>             </span><span class="hs-comment">--    so that we get better error messages (monomorphism restriction)</span><span>
</span><a name="line-509"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-1628289202"><a href="#local-1628289202"><span class="hs-identifier">new_ev_binds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC &quot;simplifyTop&quot; #-}</span><span>
</span><a name="line-510"></a><span>                        </span><a href="TcSimplify.html#simplifyTop"><span class="hs-identifier hs-var">simplifyTop</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#andWC"><span class="hs-identifier hs-var">andWC</span></a><span> </span><a href="#local-1628289201"><span class="hs-identifier hs-var">stWC</span></a><span> </span><a href="#local-1628289199"><span class="hs-identifier hs-var">lie</span></a><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc9&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-512"></a><span>
</span><a name="line-513"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a><span>     </span><span class="hs-comment">-- Don't zonk if there have been errors</span><span>
</span><a name="line-514"></a><span>                        </span><span class="hs-comment">-- It's a waste of time; and we may get debug warnings</span><span>
</span><a name="line-515"></a><span>                        </span><span class="hs-comment">-- about strangely-typed TyCons!</span><span>
</span><a name="line-516"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc10&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-517"></a><span>
</span><a name="line-518"></a><span>        </span><span class="hs-comment">-- Zonk the final code.  This must be done last.</span><span>
</span><a name="line-519"></a><span>        </span><span class="hs-comment">-- Even simplifyTop may do some unification.</span><span>
</span><a name="line-520"></a><span>        </span><span class="hs-comment">-- This pass also warns about missing type signatures</span><span>
</span><a name="line-521"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-var">TcGblEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_type_env</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289203"><a href="#local-1628289203"><span class="hs-identifier">type_env</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-522"></a><span>                         </span><span class="hs-identifier">tcg_binds</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289204"><a href="#local-1628289204"><span class="hs-identifier">binds</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-523"></a><span>                         </span><span class="hs-identifier">tcg_ev_binds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289205"><a href="#local-1628289205"><span class="hs-identifier">cur_ev_binds</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-524"></a><span>                         </span><span class="hs-identifier">tcg_imp_specs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289206"><a href="#local-1628289206"><span class="hs-identifier">imp_specs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-525"></a><span>                         </span><span class="hs-identifier">tcg_rules</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289207"><a href="#local-1628289207"><span class="hs-identifier">rules</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-526"></a><span>                         </span><span class="hs-identifier">tcg_vects</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289208"><a href="#local-1628289208"><span class="hs-identifier">vects</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-527"></a><span>                         </span><span class="hs-identifier">tcg_fords</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289209"><a href="#local-1628289209"><span class="hs-identifier">fords</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289200"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-528"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628289210"><a href="#local-1628289210"><span class="hs-identifier">all_ev_binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289205"><span class="hs-identifier hs-var">cur_ev_binds</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289202"><span class="hs-identifier hs-var">new_ev_binds</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628289211"><a href="#local-1628289211"><span class="hs-identifier">bind_ids</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289212"><a href="#local-1628289212"><span class="hs-identifier">ev_binds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289213"><a href="#local-1628289213"><span class="hs-identifier">binds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289214"><a href="#local-1628289214"><span class="hs-identifier">fords'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289215"><a href="#local-1628289215"><span class="hs-identifier">imp_specs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289216"><a href="#local-1628289216"><span class="hs-identifier">rules'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289217"><a href="#local-1628289217"><span class="hs-identifier">vects'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-531"></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC &quot;zonkTopDecls&quot; #-}</span><span>
</span><a name="line-532"></a><span>               </span><a href="TcHsSyn.html#zonkTopDecls"><span class="hs-identifier hs-var">zonkTopDecls</span></a><span> </span><a href="#local-1628289210"><span class="hs-identifier hs-var">all_ev_binds</span></a><span> </span><a href="#local-1628289204"><span class="hs-identifier hs-var">binds</span></a><span> </span><a href="#local-1628289207"><span class="hs-identifier hs-var">rules</span></a><span> </span><a href="#local-1628289208"><span class="hs-identifier hs-var">vects</span></a><span>
</span><a name="line-533"></a><span>                            </span><a href="#local-1628289206"><span class="hs-identifier hs-var">imp_specs</span></a><span> </span><a href="#local-1628289209"><span class="hs-identifier hs-var">fords</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-534"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc11&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289218"><a href="#local-1628289218"><span class="hs-identifier">final_type_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#extendTypeEnvWithIds"><span class="hs-identifier hs-var">extendTypeEnvWithIds</span></a><span> </span><a href="#local-1628289203"><span class="hs-identifier hs-var">type_env</span></a><span> </span><a href="#local-1628289211"><span class="hs-identifier hs-var">bind_ids</span></a><span>
</span><a name="line-537"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628289219"><a href="#local-1628289219"><span class="hs-identifier">tcg_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289200"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_binds</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289213"><span class="hs-identifier hs-var">binds'</span></a><span class="hs-special">,</span><span>
</span><a name="line-538"></a><span>                                   </span><span class="hs-identifier">tcg_ev_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289212"><span class="hs-identifier hs-var">ev_binds'</span></a><span class="hs-special">,</span><span>
</span><a name="line-539"></a><span>                                   </span><span class="hs-identifier">tcg_imp_specs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289215"><span class="hs-identifier hs-var">imp_specs'</span></a><span class="hs-special">,</span><span>
</span><a name="line-540"></a><span>                                   </span><span class="hs-identifier">tcg_rules</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289216"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">,</span><span>
</span><a name="line-541"></a><span>                                   </span><span class="hs-identifier">tcg_vects</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289217"><span class="hs-identifier hs-var">vects'</span></a><span class="hs-special">,</span><span>
</span><a name="line-542"></a><span>                                   </span><span class="hs-identifier">tcg_fords</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289214"><span class="hs-identifier hs-var">fords'</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-543"></a><span>
</span><a name="line-544"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#setGlobalTypeEnv"><span class="hs-identifier hs-var">setGlobalTypeEnv</span></a><span> </span><a href="#local-1628289219"><span class="hs-identifier hs-var">tcg_env'</span></a><span> </span><a href="#local-1628289218"><span class="hs-identifier hs-var">final_type_env</span></a><span>
</span><a name="line-545"></a><span>
</span><a name="line-546"></a><span>   </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span class="hs-identifier">tc_rn_src_decls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-549"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-550"></a><span class="hs-comment">-- Loops around dealing with each top level inter-splice group</span><span>
</span><a name="line-551"></a><span class="hs-comment">-- in turn, until it's dealt with the entire module</span><span>
</span><a name="line-552"></a><a name="tc_rn_src_decls"><a href="TcRnDriver.html#tc_rn_src_decls"><span class="hs-identifier">tc_rn_src_decls</span></a></a><span> </span><a name="local-1628289220"><a href="#local-1628289220"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-553"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC &quot;tc_rn_src_decls&quot; #-}</span><span>
</span><a name="line-554"></a><span>   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628289221"><a href="#local-1628289221"><span class="hs-identifier">first_group</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289222"><a href="#local-1628289222"><span class="hs-identifier">group_tail</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#findSplice"><span class="hs-identifier hs-var">findSplice</span></a><span> </span><a href="#local-1628289220"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-555"></a><span>                </span><span class="hs-comment">-- If ds is [] we get ([], Nothing)</span><span>
</span><a name="line-556"></a><span>
</span><a name="line-557"></a><span>        </span><span class="hs-comment">-- Deal with decls up to, but not including, the first splice</span><span>
</span><a name="line-558"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628289223"><a href="#local-1628289223"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289224"><a href="#local-1628289224"><span class="hs-identifier">rn_decls</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#rnTopSrcDecls"><span class="hs-identifier hs-var">rnTopSrcDecls</span></a><span> </span><a href="#local-1628289221"><span class="hs-identifier hs-var">first_group</span></a><span>
</span><a name="line-559"></a><span>                </span><span class="hs-comment">-- rnTopSrcDecls fails if there are any errors</span><span>
</span><a name="line-560"></a><span>
</span><a name="line-561"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-562"></a><span>        </span><span class="hs-comment">-- Get TH-generated top-level declarations and make sure they don't</span><span>
</span><a name="line-563"></a><span>        </span><span class="hs-comment">-- contain any splices since we don't handle that at the moment</span><span>
</span><a name="line-564"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-1628289225"><a href="#local-1628289225"><span class="hs-identifier">th_topdecls_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><span class="hs-identifier">tcg_th_topdecls</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-565"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-1628289226"><a href="#local-1628289226"><span class="hs-identifier">th_ds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628289225"><span class="hs-identifier hs-var">th_topdecls_var</span></a><span>
</span><a name="line-566"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><a href="#local-1628289225"><span class="hs-identifier hs-var">th_topdecls_var</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-567"></a><span>
</span><a name="line-568"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628289233"><a href="#local-1628289233"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289234"><a href="#local-1628289234"><span class="hs-identifier">rn_decls</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-569"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628289226"><span class="hs-identifier hs-var">th_ds</span></a><span>
</span><a name="line-570"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289223"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289224"><span class="hs-identifier hs-var">rn_decls</span></a><span class="hs-special">)</span><span>
</span><a name="line-571"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628289227"><a href="#local-1628289227"><span class="hs-identifier">th_group</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289228"><a href="#local-1628289228"><span class="hs-identifier">th_group_tail</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#findSplice"><span class="hs-identifier hs-var">findSplice</span></a><span> </span><a href="#local-1628289226"><span class="hs-identifier hs-var">th_ds</span></a><span>
</span><a name="line-572"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628289228"><span class="hs-identifier hs-var">th_group_tail</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-573"></a><span>                        </span><span class="hs-special">{</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-574"></a><span>                        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-var">SpliceDecl</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628289229"><a href="#local-1628289229"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-575"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-1628289229"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-576"></a><span>                               </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Declaration splices are not permitted inside top-level declarations added with addTopDecls&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-577"></a><span>                        </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span>                    </span><span class="hs-comment">-- Rename TH-generated top-level declarations</span><span>
</span><a name="line-580"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628289230"><a href="#local-1628289230"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289231"><a href="#local-1628289231"><span class="hs-identifier">th_rn_decls</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628289223"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-581"></a><span>                      </span><a href="TcRnDriver.html#rnTopSrcDecls"><span class="hs-identifier hs-var">rnTopSrcDecls</span></a><span> </span><a href="#local-1628289227"><span class="hs-identifier hs-var">th_group</span></a><span>
</span><a name="line-582"></a><span>
</span><a name="line-583"></a><span>                    </span><span class="hs-comment">-- Dump generated top-level declarations</span><span>
</span><a name="line-584"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289232"><a href="#local-1628289232"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;top-level declarations added with addTopDecls&quot;</span><span>
</span><a name="line-585"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="RnSplice.html#traceSplice"><span class="hs-identifier hs-var">traceSplice</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="RnSplice.html#SpliceInfo"><span class="hs-identifier hs-var">SpliceInfo</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">spliceDescription</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289232"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-586"></a><span>                                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">spliceIsDecl</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-587"></a><span>                                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">spliceSource</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-588"></a><span>                                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">spliceGenerated</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289231"><span class="hs-identifier hs-var">th_rn_decls</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-589"></a><span>
</span><a name="line-590"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289230"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">,</span><span> </span><a href="HsDecls.html#appendGroups"><span class="hs-identifier hs-var">appendGroups</span></a><span> </span><a href="#local-1628289224"><span class="hs-identifier hs-var">rn_decls</span></a><span> </span><a href="#local-1628289231"><span class="hs-identifier hs-var">th_rn_decls</span></a><span class="hs-special">)</span><span>
</span><a name="line-591"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-592"></a><span class="hs-cpp">#endif /* GHCI */</span><span>
</span><a name="line-593"></a><span>
</span><a name="line-594"></a><span>      </span><span class="hs-comment">-- Type check all declarations</span><span>
</span><a name="line-595"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628289235"><a href="#local-1628289235"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289236"><a href="#local-1628289236"><span class="hs-identifier">tcl_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628289233"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-596"></a><span>                              </span><a href="TcRnDriver.html#tcTopSrcDecls"><span class="hs-identifier hs-var">tcTopSrcDecls</span></a><span> </span><a href="#local-1628289234"><span class="hs-identifier hs-var">rn_decls</span></a><span>
</span><a name="line-597"></a><span>
</span><a name="line-598"></a><span>        </span><span class="hs-comment">-- If there is no splice, we're nearly done</span><span>
</span><a name="line-599"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289235"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289236"><span class="hs-identifier hs-var">tcl_env</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-600"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628289222"><span class="hs-identifier hs-var">group_tail</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-601"></a><span>          </span><span class="hs-special">{</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289235"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289236"><span class="hs-identifier hs-var">tcl_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-602"></a><span>
</span><a name="line-603"></a><span class="hs-cpp">#ifndef GHCI</span><span>
</span><a name="line-604"></a><span>            </span><span class="hs-comment">-- There shouldn't be a splice</span><span>
</span><a name="line-605"></a><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SpliceDecl</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-606"></a><span>            </span><span class="hs-identifier">failWithTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Can't do a top-level splice; need a bootstrapped compiler&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-607"></a><span>          </span><span class="hs-special">}</span><span>
</span><a name="line-608"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-609"></a><span>            </span><span class="hs-comment">-- If there's a splice, we must carry on</span><span>
</span><a name="line-610"></a><span>          </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-var">SpliceDecl</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628289237"><a href="#local-1628289237"><span class="hs-identifier">splice</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628289238"><a href="#local-1628289238"><span class="hs-identifier">rest_ds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-611"></a><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Rename the splice expression, and get its supporting decls</span><span>
</span><a name="line-612"></a><span>                 </span><span class="hs-special">(</span><a name="local-1628289239"><a href="#local-1628289239"><span class="hs-identifier">spliced_decls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289240"><a href="#local-1628289240"><span class="hs-identifier">splice_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><span class="hs-special">(</span><a href="RnSplice.html#rnTopSpliceDecls"><span class="hs-identifier hs-var">rnTopSpliceDecls</span></a><span> </span><a href="#local-1628289237"><span class="hs-identifier hs-var">splice</span></a><span class="hs-special">)</span><span>
</span><a name="line-613"></a><span>
</span><a name="line-614"></a><span>                 </span><span class="hs-comment">-- Glue them on the front of the remaining decls and loop</span><span>
</span><a name="line-615"></a><span>               </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289235"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">`</span><a href="RnSource.html#addTcgDUs"><span class="hs-identifier hs-var">addTcgDUs</span></a><span class="hs-special">`</span><span> </span><a href="NameSet.html#usesOnly"><span class="hs-identifier hs-var">usesOnly</span></a><span> </span><a href="#local-1628289240"><span class="hs-identifier hs-var">splice_fvs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-616"></a><span>                 </span><a href="TcRnDriver.html#tc_rn_src_decls"><span class="hs-identifier hs-var">tc_rn_src_decls</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289239"><span class="hs-identifier hs-var">spliced_decls</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628289238"><span class="hs-identifier hs-var">rest_ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-617"></a><span>               </span><span class="hs-special">}</span><span>
</span><a name="line-618"></a><span>          </span><span class="hs-special">}</span><span>
</span><a name="line-619"></a><span class="hs-cpp">#endif /* GHCI */</span><span>
</span><a name="line-620"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-621"></a><span>
</span><a name="line-622"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Compiling hs-boot source files, and
        comparing the hi-boot interface with the real thing
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-630"></a><span>
</span><a name="line-631"></a><span class="hs-identifier">tcRnHsBootDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-632"></a><a name="tcRnHsBootDecls"><a href="TcRnDriver.html#tcRnHsBootDecls"><span class="hs-identifier">tcRnHsBootDecls</span></a></a><span> </span><a name="local-1628289241"><a href="#local-1628289241"><span class="hs-identifier">hsc_src</span></a></a><span> </span><a name="local-1628289242"><a href="#local-1628289242"><span class="hs-identifier">decls</span></a></a><span>
</span><a name="line-633"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628289243"><a href="#local-1628289243"><span class="hs-identifier">first_group</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289244"><a href="#local-1628289244"><span class="hs-identifier">group_tail</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#findSplice"><span class="hs-identifier hs-var">findSplice</span></a><span> </span><a href="#local-1628289242"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-634"></a><span>
</span><a name="line-635"></a><span>                </span><span class="hs-comment">-- Rename the declarations</span><span>
</span><a name="line-636"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628289245"><a href="#local-1628289245"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289246"><a href="#local-1628289246"><span class="hs-identifier">tycl_decls</span></a></a><span>
</span><a name="line-637"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_instds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289247"><a href="#local-1628289247"><span class="hs-identifier">inst_decls</span></a></a><span>
</span><a name="line-638"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_derivds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289248"><a href="#local-1628289248"><span class="hs-identifier">deriv_decls</span></a></a><span>
</span><a name="line-639"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_fords</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289249"><a href="#local-1628289249"><span class="hs-identifier">for_decls</span></a></a><span>
</span><a name="line-640"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_defds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289250"><a href="#local-1628289250"><span class="hs-identifier">def_decls</span></a></a><span>
</span><a name="line-641"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_ruleds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289251"><a href="#local-1628289251"><span class="hs-identifier">rule_decls</span></a></a><span>
</span><a name="line-642"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_vects</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289252"><a href="#local-1628289252"><span class="hs-identifier">vect_decls</span></a></a><span>
</span><a name="line-643"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_annds</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-644"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_valds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HsBinds.html#ValBindsOut"><span class="hs-identifier hs-var">ValBindsOut</span></a><span> </span><a name="local-1628289253"><a href="#local-1628289253"><span class="hs-identifier">val_binds</span></a></a><span> </span><a name="local-1628289254"><a href="#local-1628289254"><span class="hs-identifier">val_sigs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-645"></a><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#rnTopSrcDecls"><span class="hs-identifier hs-var">rnTopSrcDecls</span></a><span> </span><a href="#local-1628289243"><span class="hs-identifier hs-var">first_group</span></a><span>
</span><a name="line-646"></a><span>        </span><span class="hs-comment">-- The empty list is for extra dependencies coming from .hs-boot files</span><span>
</span><a name="line-647"></a><span>        </span><span class="hs-comment">-- See Note [Extra dependencies from .hs-boot files] in RnSource</span><span>
</span><a name="line-648"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628289265"><a href="#local-1628289265"><span class="hs-identifier">gbl_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289266"><a href="#local-1628289266"><span class="hs-identifier">lie</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628289245"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span>
</span><a name="line-651"></a><span>                </span><span class="hs-comment">-- Check for illegal declarations</span><span>
</span><a name="line-652"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628289244"><span class="hs-identifier hs-var">group_tail</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-653"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-var">SpliceDecl</span></a><span> </span><a name="local-1628289255"><a href="#local-1628289255"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnDriver.html#badBootDecl"><span class="hs-identifier hs-var">badBootDecl</span></a><span> </span><a href="#local-1628289241"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><span class="hs-string">&quot;splice&quot;</span><span> </span><a href="#local-1628289255"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-654"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-655"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#badBootDecl"><span class="hs-identifier hs-var">badBootDecl</span></a><span> </span><a href="#local-1628289241"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><span class="hs-string">&quot;foreign&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628289249"><span class="hs-identifier hs-var">for_decls</span></a><span>
</span><a name="line-656"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#badBootDecl"><span class="hs-identifier hs-var">badBootDecl</span></a><span> </span><a href="#local-1628289241"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><span class="hs-string">&quot;default&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628289250"><span class="hs-identifier hs-var">def_decls</span></a><span>
</span><a name="line-657"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#badBootDecl"><span class="hs-identifier hs-var">badBootDecl</span></a><span> </span><a href="#local-1628289241"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><span class="hs-string">&quot;rule&quot;</span><span class="hs-special">)</span><span>    </span><a href="#local-1628289251"><span class="hs-identifier hs-var">rule_decls</span></a><span>
</span><a name="line-658"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#badBootDecl"><span class="hs-identifier hs-var">badBootDecl</span></a><span> </span><a href="#local-1628289241"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><span class="hs-string">&quot;vect&quot;</span><span class="hs-special">)</span><span>    </span><a href="#local-1628289252"><span class="hs-identifier hs-var">vect_decls</span></a><span>
</span><a name="line-659"></a><span>
</span><a name="line-660"></a><span>                </span><span class="hs-comment">-- Typecheck type/class/instance decls</span><span>
</span><a name="line-661"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc2 (boot)&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-662"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628289256"><a href="#local-1628289256"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289257"><a href="#local-1628289257"><span class="hs-identifier">inst_infos</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289258"><a href="#local-1628289258"><span class="hs-identifier">_deriv_binds</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-663"></a><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#tcTyClsInstDecls"><span class="hs-identifier hs-var">tcTyClsInstDecls</span></a><span> </span><a href="#local-1628289246"><span class="hs-identifier hs-var">tycl_decls</span></a><span> </span><a href="#local-1628289247"><span class="hs-identifier hs-var">inst_decls</span></a><span> </span><a href="#local-1628289248"><span class="hs-identifier hs-var">deriv_decls</span></a><span> </span><a href="#local-1628289253"><span class="hs-identifier hs-var">val_binds</span></a><span>
</span><a name="line-664"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628289256"><span class="hs-identifier hs-var">tcg_env</span></a><span>     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-665"></a><span>
</span><a name="line-666"></a><span>                </span><span class="hs-comment">-- Typecheck value declarations</span><span>
</span><a name="line-667"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc5&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-668"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289259"><a href="#local-1628289259"><span class="hs-identifier">val_ids</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcHsBootSigs"><span class="hs-identifier hs-var">tcHsBootSigs</span></a><span> </span><a href="#local-1628289253"><span class="hs-identifier hs-var">val_binds</span></a><span> </span><a href="#local-1628289254"><span class="hs-identifier hs-var">val_sigs</span></a><span>
</span><a name="line-669"></a><span>
</span><a name="line-670"></a><span>                </span><span class="hs-comment">-- Wrap up</span><span>
</span><a name="line-671"></a><span>                </span><span class="hs-comment">-- No simplification or zonking to do</span><span>
</span><a name="line-672"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc7a&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-673"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289260"><a href="#local-1628289260"><span class="hs-identifier">gbl_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-674"></a><span>
</span><a name="line-675"></a><span>                </span><span class="hs-comment">-- Make the final type-env</span><span>
</span><a name="line-676"></a><span>                </span><span class="hs-comment">-- Include the dfun_ids so that their type sigs</span><span>
</span><a name="line-677"></a><span>                </span><span class="hs-comment">-- are written into the interface file.</span><span>
</span><a name="line-678"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289261"><a href="#local-1628289261"><span class="hs-identifier">type_env0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_type_env</span><span> </span><a href="#local-1628289260"><span class="hs-identifier hs-var">gbl_env</span></a><span>
</span><a name="line-679"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-1628289262"><a href="#local-1628289262"><span class="hs-identifier">type_env1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#extendTypeEnvWithIds"><span class="hs-identifier hs-var">extendTypeEnvWithIds</span></a><span> </span><a href="#local-1628289261"><span class="hs-identifier hs-var">type_env0</span></a><span> </span><a href="#local-1628289259"><span class="hs-identifier hs-var">val_ids</span></a><span>
</span><a name="line-680"></a><span>              </span><span class="hs-comment">-- Don't add the dictionaries for hsig, we don't actually want</span><span>
</span><a name="line-681"></a><span>              </span><span class="hs-comment">-- to /define/ the instance</span><span>
</span><a name="line-682"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-1628289263"><a href="#local-1628289263"><span class="hs-identifier">type_env2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="DriverPhases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289241"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289262"><span class="hs-identifier hs-var">type_env1</span></a><span>
</span><a name="line-683"></a><span>                          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#extendTypeEnvWithIds"><span class="hs-identifier hs-var">extendTypeEnvWithIds</span></a><span> </span><a href="#local-1628289262"><span class="hs-identifier hs-var">type_env1</span></a><span> </span><a href="#local-1628289264"><span class="hs-identifier hs-var">dfun_ids</span></a><span>
</span><a name="line-684"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-1628289264"><a href="#local-1628289264"><span class="hs-identifier">dfun_ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TcEnv.html#iDFunId"><span class="hs-identifier hs-var">iDFunId</span></a><span> </span><a href="#local-1628289257"><span class="hs-identifier hs-var">inst_infos</span></a><span>
</span><a name="line-685"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-686"></a><span>
</span><a name="line-687"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#setGlobalTypeEnv"><span class="hs-identifier hs-var">setGlobalTypeEnv</span></a><span> </span><a href="#local-1628289260"><span class="hs-identifier hs-var">gbl_env</span></a><span> </span><a href="#local-1628289263"><span class="hs-identifier hs-var">type_env2</span></a><span>
</span><a name="line-688"></a><span>   </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-689"></a><span>   </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;boot&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289266"><span class="hs-identifier hs-var">lie</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289265"><span class="hs-identifier hs-var">gbl_env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-690"></a><span>
</span><a name="line-691"></a><span class="hs-identifier">badBootDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="#local-1628289107"><span class="hs-identifier hs-type">decl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-692"></a><a name="badBootDecl"><a href="TcRnDriver.html#badBootDecl"><span class="hs-identifier">badBootDecl</span></a></a><span> </span><a name="local-1628289267"><a href="#local-1628289267"><span class="hs-identifier">hsc_src</span></a></a><span> </span><a name="local-1628289268"><a href="#local-1628289268"><span class="hs-identifier">what</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628289269"><a href="#local-1628289269"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-693"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-1628289269"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'A'</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628289268"><span class="hs-identifier hs-var">what</span></a><span>
</span><a name="line-694"></a><span>      </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;declaration is not (currently) allowed in a&quot;</span><span>
</span><a name="line-695"></a><span>      </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-1628289267"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-696"></a><span>            </span><a href="DriverPhases.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hs-boot&quot;</span><span>
</span><a name="line-697"></a><span>            </span><a href="DriverPhases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hsig&quot;</span><span>
</span><a name="line-698"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;badBootDecl: should be an hsig or hs-boot file&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-699"></a><span>      </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;file&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-700"></a><span>
</span><a name="line-701"></a><span class="hs-comment">{-
Once we've typechecked the body of the module, we want to compare what
we've found (gathered in a TypeEnv) with the hi-boot details (if any).
-}</span><span>
</span><a name="line-705"></a><span>
</span><a name="line-706"></a><span class="hs-identifier">checkHiBootIface</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SelfBootInfo"><span class="hs-identifier hs-type">SelfBootInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-707"></a><span class="hs-comment">-- Compare the hi-boot file for this module (if there is one)</span><span>
</span><a name="line-708"></a><span class="hs-comment">-- with the type environment we've just come up with</span><span>
</span><a name="line-709"></a><span class="hs-comment">-- In the common case where there is no hi-boot file, the list</span><span>
</span><a name="line-710"></a><span class="hs-comment">-- of boot_names is empty.</span><span>
</span><a name="line-711"></a><span>
</span><a name="line-712"></a><a name="checkHiBootIface"><a href="TcRnDriver.html#checkHiBootIface"><span class="hs-identifier">checkHiBootIface</span></a></a><span> </span><a name="local-1628289270"><a href="#local-1628289270"><span class="hs-identifier">tcg_env</span></a></a><span> </span><a name="local-1628289271"><a href="#local-1628289271"><span class="hs-identifier">boot_info</span></a></a><span>
</span><a name="line-713"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#NoSelfBoot"><span class="hs-identifier hs-var">NoSelfBoot</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289271"><span class="hs-identifier hs-var">boot_info</span></a><span>  </span><span class="hs-comment">-- Common case</span><span>
</span><a name="line-714"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289270"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-715"></a><span>
</span><a name="line-716"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DriverPhases.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcg_src</span><span> </span><a href="#local-1628289270"><span class="hs-identifier hs-var">tcg_env</span></a><span>   </span><span class="hs-comment">-- Current module is already a hs-boot file!</span><span>
</span><a name="line-717"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289270"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-718"></a><span>
</span><a name="line-719"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#SelfBoot"><span class="hs-identifier hs-var">SelfBoot</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sb_mds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289272"><a href="#local-1628289272"><span class="hs-identifier">boot_details</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289271"><span class="hs-identifier hs-var">boot_info</span></a><span>
</span><a name="line-720"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-var">TcGblEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_binds</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289273"><a href="#local-1628289273"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-721"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_insts</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289274"><a href="#local-1628289274"><span class="hs-identifier">local_insts</span></a></a><span>
</span><a name="line-722"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_type_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289275"><a href="#local-1628289275"><span class="hs-identifier">local_type_env</span></a></a><span>
</span><a name="line-723"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_exports</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289276"><a href="#local-1628289276"><span class="hs-identifier">local_exports</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289270"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-724"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1628289277"><a href="#local-1628289277"><span class="hs-identifier">dfun_prs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#checkHiBootIface%27"><span class="hs-identifier hs-var">checkHiBootIface'</span></a><span> </span><a href="#local-1628289274"><span class="hs-identifier hs-var">local_insts</span></a><span> </span><a href="#local-1628289275"><span class="hs-identifier hs-var">local_type_env</span></a><span>
</span><a name="line-725"></a><span>                                        </span><a href="#local-1628289276"><span class="hs-identifier hs-var">local_exports</span></a><span> </span><a href="#local-1628289272"><span class="hs-identifier hs-var">boot_details</span></a><span>
</span><a name="line-726"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289278"><a href="#local-1628289278"><span class="hs-identifier">boot_dfuns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1628289277"><span class="hs-identifier hs-var">dfun_prs</span></a><span>
</span><a name="line-727"></a><span>              </span><a name="local-1628289279"><a href="#local-1628289279"><span class="hs-identifier">dfun_binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="HsUtils.html#mkVarBind"><span class="hs-identifier hs-var">mkVarBind</span></a><span> </span><a href="#local-1628289282"><span class="hs-identifier hs-var">boot_dfun</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a><span> </span><a href="#local-1628289283"><span class="hs-identifier hs-var">dfun</span></a><span class="hs-special">)</span><span>
</span><a name="line-728"></a><span>                                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628289282"><a href="#local-1628289282"><span class="hs-identifier">boot_dfun</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289283"><a href="#local-1628289283"><span class="hs-identifier">dfun</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289277"><span class="hs-identifier hs-var">dfun_prs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-729"></a><span>              </span><a name="local-1628289280"><a href="#local-1628289280"><span class="hs-identifier">type_env'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#extendTypeEnvWithIds"><span class="hs-identifier hs-var">extendTypeEnvWithIds</span></a><span> </span><a href="#local-1628289275"><span class="hs-identifier hs-var">local_type_env</span></a><span> </span><a href="#local-1628289278"><span class="hs-identifier hs-var">boot_dfuns</span></a><span>
</span><a name="line-730"></a><span>              </span><a name="local-1628289281"><a href="#local-1628289281"><span class="hs-identifier">tcg_env'</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289270"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289273"><span class="hs-identifier hs-var">binds</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289279"><span class="hs-identifier hs-var">dfun_binds</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-731"></a><span>
</span><a name="line-732"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#setGlobalTypeEnv"><span class="hs-identifier hs-var">setGlobalTypeEnv</span></a><span> </span><a href="#local-1628289281"><span class="hs-identifier hs-var">tcg_env'</span></a><span> </span><a href="#local-1628289280"><span class="hs-identifier hs-var">type_env'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-733"></a><span>             </span><span class="hs-comment">-- Update the global type env *including* the knot-tied one</span><span>
</span><a name="line-734"></a><span>             </span><span class="hs-comment">-- so that if the source module reads in an interface unfolding</span><span>
</span><a name="line-735"></a><span>             </span><span class="hs-comment">-- mentioning one of the dfuns from the boot module, then it</span><span>
</span><a name="line-736"></a><span>             </span><span class="hs-comment">-- can &quot;see&quot; that boot dfun.   See Trac #4003</span><span>
</span><a name="line-737"></a><span>
</span><a name="line-738"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;checkHiBootIface: unreachable code&quot;</span><span>
</span><a name="line-739"></a><span>
</span><a name="line-740"></a><span class="hs-identifier">checkHiBootIface'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-741"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-742"></a><span class="hs-comment">-- Variant which doesn't require a full TcGblEnv; you could get the</span><span>
</span><a name="line-743"></a><span class="hs-comment">-- local components from another ModDetails.</span><span>
</span><a name="line-744"></a><span class="hs-comment">--</span><span>
</span><a name="line-745"></a><span class="hs-comment">-- We return a list of &quot;impedance-matching&quot; bindings for the dfuns</span><span>
</span><a name="line-746"></a><span class="hs-comment">-- defined in the hs-boot file, such as</span><span>
</span><a name="line-747"></a><span class="hs-comment">--           $fxEqT = $fEqT</span><span>
</span><a name="line-748"></a><span class="hs-comment">-- We need these because the module and hi-boot file might differ in</span><span>
</span><a name="line-749"></a><span class="hs-comment">-- the name it chose for the dfun.</span><span>
</span><a name="line-750"></a><span>
</span><a name="line-751"></a><a name="checkHiBootIface%27"><a href="TcRnDriver.html#checkHiBootIface%27"><span class="hs-identifier">checkHiBootIface'</span></a></a><span>
</span><a name="line-752"></a><span>        </span><a name="local-1628289284"><a href="#local-1628289284"><span class="hs-identifier">local_insts</span></a></a><span> </span><a name="local-1628289285"><a href="#local-1628289285"><span class="hs-identifier">local_type_env</span></a></a><span> </span><a name="local-1628289286"><a href="#local-1628289286"><span class="hs-identifier">local_exports</span></a></a><span>
</span><a name="line-753"></a><span>        </span><span class="hs-special">(</span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-var">ModDetails</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">md_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289287"><a href="#local-1628289287"><span class="hs-identifier">boot_insts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_fam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289288"><a href="#local-1628289288"><span class="hs-identifier">boot_fam_insts</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-754"></a><span>                      </span><span class="hs-identifier">md_types</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289289"><a href="#local-1628289289"><span class="hs-identifier">boot_type_env</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_exports</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289290"><a href="#local-1628289290"><span class="hs-identifier">boot_exports</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-755"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;checkHiBootIface&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-756"></a><span>             </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289289"><span class="hs-identifier hs-var">boot_type_env</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289287"><span class="hs-identifier hs-var">boot_insts</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289290"><span class="hs-identifier hs-var">boot_exports</span></a><span class="hs-special">]</span><span>
</span><a name="line-757"></a><span>
</span><a name="line-758"></a><span>                </span><span class="hs-comment">-- Check the exports of the boot module, one by one</span><span>
</span><a name="line-759"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="#local-1628289291"><span class="hs-identifier hs-var">check_export</span></a><span> </span><a href="#local-1628289290"><span class="hs-identifier hs-var">boot_exports</span></a><span>
</span><a name="line-760"></a><span>
</span><a name="line-761"></a><span>                </span><span class="hs-comment">-- Check for no family instances</span><span>
</span><a name="line-762"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628289288"><span class="hs-identifier hs-var">boot_fam_insts</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-763"></a><span>            </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;TcRnDriver.checkHiBootIface: Cannot handle family &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-764"></a><span>                   </span><span class="hs-string">&quot;instances in boot files yet...&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-765"></a><span>            </span><span class="hs-comment">-- FIXME: Why?  The actual comparison is not hard, but what would</span><span>
</span><a name="line-766"></a><span>            </span><span class="hs-comment">--        be the equivalent to the dfun bindings returned for class</span><span>
</span><a name="line-767"></a><span>            </span><span class="hs-comment">--        instances?  We can't easily equate tycons...</span><span>
</span><a name="line-768"></a><span>
</span><a name="line-769"></a><span>                </span><span class="hs-comment">-- Check instance declarations</span><span>
</span><a name="line-770"></a><span>                </span><span class="hs-comment">-- and generate an impedance-matching binding</span><span>
</span><a name="line-771"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289310"><a href="#local-1628289310"><span class="hs-identifier">mb_dfun_prs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628289294"><span class="hs-identifier hs-var">check_inst</span></a><span> </span><a href="#local-1628289287"><span class="hs-identifier hs-var">boot_insts</span></a><span>
</span><a name="line-772"></a><span>
</span><a name="line-773"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a><span>
</span><a name="line-774"></a><span>
</span><a name="line-775"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a><span> </span><a href="#local-1628289310"><span class="hs-identifier hs-var">mb_dfun_prs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-776"></a><span>
</span><a name="line-777"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-778"></a><span>    </span><a name="local-1628289291"><a href="#local-1628289291"><span class="hs-identifier">check_export</span></a></a><span> </span><a name="local-1628289295"><a href="#local-1628289295"><span class="hs-identifier">boot_avail</span></a></a><span>     </span><span class="hs-comment">-- boot_avail is exported by the boot iface</span><span>
</span><a name="line-779"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628289296"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289292"><span class="hs-identifier hs-var">dfun_names</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-780"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="Name.html#isWiredInName"><span class="hs-identifier hs-var">isWiredInName</span></a><span> </span><a href="#local-1628289296"><span class="hs-identifier hs-var">name</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- No checking for wired-in names.  In particular,</span><span>
</span><a name="line-781"></a><span>                                                </span><span class="hs-comment">-- 'error' is handled by a rather gross hack</span><span>
</span><a name="line-782"></a><span>                                                </span><span class="hs-comment">-- (see comments in GHC.Err.hs-boot)</span><span>
</span><a name="line-783"></a><span>
</span><a name="line-784"></a><span>        </span><span class="hs-comment">-- Check that the actual module exports the same thing</span><span>
</span><a name="line-785"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628289298"><span class="hs-identifier hs-var">missing_names</span></a><span class="hs-special">)</span><span>
</span><a name="line-786"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a><span> </span><a href="#local-1628289298"><span class="hs-identifier hs-var">missing_names</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-787"></a><span>                 </span><span class="hs-special">(</span><a href="TcRnDriver.html#missingBootThing"><span class="hs-identifier hs-var">missingBootThing</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a><span> </span><a href="#local-1628289298"><span class="hs-identifier hs-var">missing_names</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;exported by&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-788"></a><span>
</span><a name="line-789"></a><span>        </span><span class="hs-comment">-- If the boot module does not *define* the thing, we are done</span><span>
</span><a name="line-790"></a><span>        </span><span class="hs-comment">-- (it simply re-exports it, and names match, so nothing further to do)</span><span>
</span><a name="line-791"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a><span> </span><a href="#local-1628289297"><span class="hs-identifier hs-var">mb_boot_thing</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-792"></a><span>
</span><a name="line-793"></a><span>        </span><span class="hs-comment">-- Check that the actual module also defines the thing, and</span><span>
</span><a name="line-794"></a><span>        </span><span class="hs-comment">-- then compare the definitions</span><span>
</span><a name="line-795"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289300"><a href="#local-1628289300"><span class="hs-identifier">real_thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#lookupTypeEnv"><span class="hs-identifier hs-var">lookupTypeEnv</span></a><span> </span><a href="#local-1628289285"><span class="hs-identifier hs-var">local_type_env</span></a><span> </span><a href="#local-1628289296"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span>
</span><a name="line-796"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289301"><a href="#local-1628289301"><span class="hs-identifier">boot_thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289297"><span class="hs-identifier hs-var">mb_boot_thing</span></a><span>
</span><a name="line-797"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#checkBootDeclM"><span class="hs-identifier hs-var">checkBootDeclM</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-1628289301"><span class="hs-identifier hs-var">boot_thing</span></a><span> </span><a href="#local-1628289300"><span class="hs-identifier hs-var">real_thing</span></a><span>
</span><a name="line-798"></a><span>
</span><a name="line-799"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-800"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#missingBootThing"><span class="hs-identifier hs-var">missingBootThing</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-1628289296"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-string">&quot;defined in&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-801"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-802"></a><span>        </span><a name="local-1628289296"><a href="#local-1628289296"><span class="hs-identifier">name</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#availName"><span class="hs-identifier hs-var">availName</span></a><span> </span><a href="#local-1628289295"><span class="hs-identifier hs-var">boot_avail</span></a><span>
</span><a name="line-803"></a><span>        </span><a name="local-1628289297"><a href="#local-1628289297"><span class="hs-identifier">mb_boot_thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#lookupTypeEnv"><span class="hs-identifier hs-var">lookupTypeEnv</span></a><span> </span><a href="#local-1628289289"><span class="hs-identifier hs-var">boot_type_env</span></a><span> </span><a href="#local-1628289296"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-804"></a><span>        </span><a name="local-1628289298"><a href="#local-1628289298"><span class="hs-identifier">missing_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-1628289293"><span class="hs-identifier hs-var">local_export_env</span></a><span> </span><a href="#local-1628289296"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-805"></a><span>                          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1628289296"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-806"></a><span>                          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289299"><a href="#local-1628289299"><span class="hs-identifier">avail</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a><span> </span><a href="#local-1628289295"><span class="hs-identifier hs-var">boot_avail</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#minusList"><span class="hs-identifier hs-var">minusList</span></a><span class="hs-special">`</span><span> </span><a href="Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a><span> </span><a href="#local-1628289299"><span class="hs-identifier hs-var">avail</span></a><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span>    </span><a name="local-1628289292"><a href="#local-1628289292"><span class="hs-identifier">dfun_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-1628289287"><span class="hs-identifier hs-var">boot_insts</span></a><span>
</span><a name="line-809"></a><span>
</span><a name="line-810"></a><span>    </span><span class="hs-identifier">local_export_env</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span>
</span><a name="line-811"></a><span>    </span><a name="local-1628289293"><a href="#local-1628289293"><span class="hs-identifier">local_export_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#availsToNameEnv"><span class="hs-identifier hs-var">availsToNameEnv</span></a><span> </span><a href="#local-1628289286"><span class="hs-identifier hs-var">local_exports</span></a><span>
</span><a name="line-812"></a><span>
</span><a name="line-813"></a><span>    </span><span class="hs-identifier">check_inst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-814"></a><span>        </span><span class="hs-comment">-- Returns a pair of the boot dfun in terms of the equivalent</span><span>
</span><a name="line-815"></a><span>        </span><span class="hs-comment">-- real dfun. Delicate (like checkBootDecl) because it depends</span><span>
</span><a name="line-816"></a><span>        </span><span class="hs-comment">-- on the types lining up precisely even to the ordering of</span><span>
</span><a name="line-817"></a><span>        </span><span class="hs-comment">-- the type variables in the foralls.</span><span>
</span><a name="line-818"></a><span>    </span><a name="local-1628289294"><a href="#local-1628289294"><span class="hs-identifier">check_inst</span></a></a><span> </span><a name="local-1628289302"><a href="#local-1628289302"><span class="hs-identifier">boot_inst</span></a></a><span>
</span><a name="line-819"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><a href="#local-1628289307"><span class="hs-identifier hs-var">dfun</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628289306"><a href="#local-1628289306"><span class="hs-identifier">inst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289284"><span class="hs-identifier hs-var">local_insts</span></a><span class="hs-special">,</span><span>
</span><a name="line-820"></a><span>                       </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289307"><a href="#local-1628289307"><span class="hs-identifier">dfun</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a><span> </span><a href="#local-1628289306"><span class="hs-identifier hs-var">inst</span></a><span class="hs-special">,</span><span>
</span><a name="line-821"></a><span>                       </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628289307"><span class="hs-identifier hs-var">dfun</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289304"><span class="hs-identifier hs-var">boot_dfun_ty</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-822"></a><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;check_inst&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-823"></a><span>                          </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;local_insts&quot;</span><span>  </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289284"><span class="hs-identifier hs-var">local_insts</span></a><span class="hs-special">)</span><span>
</span><a name="line-824"></a><span>                          </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;boot_inst&quot;</span><span>    </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289302"><span class="hs-identifier hs-var">boot_inst</span></a><span>
</span><a name="line-825"></a><span>                          </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;boot_dfun_ty&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289304"><span class="hs-identifier hs-var">boot_dfun_ty</span></a><span>
</span><a name="line-826"></a><span>                          </span><span class="hs-special">]</span><span>
</span><a name="line-827"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#instMisMatch"><span class="hs-identifier hs-var">instMisMatch</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-1628289302"><span class="hs-identifier hs-var">boot_inst</span></a><span class="hs-special">)</span><span>
</span><a name="line-828"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-829"></a><span>            </span><span class="hs-special">(</span><a name="local-1628289308"><a href="#local-1628289308"><span class="hs-identifier">dfun</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289309"><span class="hs-identifier hs-var">local_boot_dfun</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289308"><span class="hs-identifier hs-var">dfun</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-830"></a><span>                     </span><span class="hs-keyword">where</span><span>
</span><a name="line-831"></a><span>                        </span><a name="local-1628289309"><a href="#local-1628289309"><span class="hs-identifier">local_boot_dfun</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkExportedVanillaId"><span class="hs-identifier hs-var">Id</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mkExportedVanillaId</span></a><span> </span><a href="#local-1628289305"><span class="hs-identifier hs-var">boot_dfun_name</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628289308"><span class="hs-identifier hs-var">dfun</span></a><span class="hs-special">)</span><span>
</span><a name="line-832"></a><span>                           </span><span class="hs-comment">-- Name from the /boot-file/ ClsInst, but type from the dfun</span><span>
</span><a name="line-833"></a><span>                           </span><span class="hs-comment">-- defined in /this module/.  That ensures that the TyCon etc</span><span>
</span><a name="line-834"></a><span>                           </span><span class="hs-comment">-- inside the type are the ones defined in this module, not</span><span>
</span><a name="line-835"></a><span>                           </span><span class="hs-comment">-- the ones gotten from the hi-boot file, which may have</span><span>
</span><a name="line-836"></a><span>                           </span><span class="hs-comment">-- a lot less info (Trac #T8743, comment:10).</span><span>
</span><a name="line-837"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-838"></a><span>          </span><a name="local-1628289303"><a href="#local-1628289303"><span class="hs-identifier">boot_dfun</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a><span> </span><a href="#local-1628289302"><span class="hs-identifier hs-var">boot_inst</span></a><span>
</span><a name="line-839"></a><span>          </span><a name="local-1628289304"><a href="#local-1628289304"><span class="hs-identifier">boot_dfun_ty</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628289303"><span class="hs-identifier hs-var">boot_dfun</span></a><span>
</span><a name="line-840"></a><span>          </span><a name="local-1628289305"><a href="#local-1628289305"><span class="hs-identifier">boot_dfun_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628289303"><span class="hs-identifier hs-var">boot_dfun</span></a><span>
</span><a name="line-841"></a><span>
</span><a name="line-842"></a><span class="hs-comment">-- This has to compare the TyThing from the .hi-boot file to the TyThing</span><span>
</span><a name="line-843"></a><span class="hs-comment">-- in the current source file.  We must be careful to allow alpha-renaming</span><span>
</span><a name="line-844"></a><span class="hs-comment">-- where appropriate, and also the boot declaration is allowed to omit</span><span>
</span><a name="line-845"></a><span class="hs-comment">-- constructors and class methods.</span><span>
</span><a name="line-846"></a><span class="hs-comment">--</span><span>
</span><a name="line-847"></a><span class="hs-comment">-- See rnfail055 for a good test of this stuff.</span><span>
</span><a name="line-848"></a><span>
</span><a name="line-849"></a><span class="hs-comment">-- | Compares two things for equivalence between boot-file and normal code,</span><span>
</span><a name="line-850"></a><span class="hs-comment">-- reporting an error if they don't match up.</span><span>
</span><a name="line-851"></a><span class="hs-identifier">checkBootDeclM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>  </span><span class="hs-comment">-- ^ True &lt;=&gt; an hs-boot file (could also be a sig)</span><span>
</span><a name="line-852"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-853"></a><a name="checkBootDeclM"><a href="TcRnDriver.html#checkBootDeclM"><span class="hs-identifier">checkBootDeclM</span></a></a><span> </span><a name="local-1628289311"><a href="#local-1628289311"><span class="hs-identifier">is_boot</span></a></a><span> </span><a name="local-1628289312"><a href="#local-1628289312"><span class="hs-identifier">boot_thing</span></a></a><span> </span><a name="local-1628289313"><a href="#local-1628289313"><span class="hs-identifier">real_thing</span></a></a><span>
</span><a name="line-854"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Maybes.html#whenIsJust"><span class="hs-identifier hs-var">whenIsJust</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#checkBootDecl"><span class="hs-identifier hs-var">checkBootDecl</span></a><span> </span><a href="#local-1628289312"><span class="hs-identifier hs-var">boot_thing</span></a><span> </span><a href="#local-1628289313"><span class="hs-identifier hs-var">real_thing</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628289314"><a href="#local-1628289314"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-855"></a><span>       </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-1628289312"><span class="hs-identifier hs-var">boot_thing</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-856"></a><span>                </span><span class="hs-special">(</span><a href="TcRnDriver.html#bootMisMatch"><span class="hs-identifier hs-var">bootMisMatch</span></a><span> </span><a href="#local-1628289311"><span class="hs-identifier hs-var">is_boot</span></a><span> </span><a href="#local-1628289314"><span class="hs-identifier hs-var">err</span></a><span> </span><a href="#local-1628289313"><span class="hs-identifier hs-var">real_thing</span></a><span> </span><a href="#local-1628289312"><span class="hs-identifier hs-var">boot_thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-857"></a><span>
</span><a name="line-858"></a><span class="hs-comment">-- | Compares the two things for equivalence between boot-file and normal</span><span>
</span><a name="line-859"></a><span class="hs-comment">-- code. Returns @Nothing@ on success or @Just &quot;some helpful info for user&quot;@</span><span>
</span><a name="line-860"></a><span class="hs-comment">-- failure. If the difference will be apparent to the user, @Just empty@ is</span><span>
</span><a name="line-861"></a><span class="hs-comment">-- perfectly suitable.</span><span>
</span><a name="line-862"></a><span class="hs-identifier">checkBootDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-863"></a><span>
</span><a name="line-864"></a><a name="checkBootDecl"><a href="TcRnDriver.html#checkBootDecl"><span class="hs-identifier">checkBootDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-1628289315"><a href="#local-1628289315"><span class="hs-identifier">id1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-1628289316"><a href="#local-1628289316"><span class="hs-identifier">id2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-865"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">id1</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">id2</span><span class="hs-special">)</span><span>
</span><a name="line-866"></a><span>    </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628289315"><span class="hs-identifier hs-var">id1</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628289316"><span class="hs-identifier hs-var">id2</span></a><span class="hs-special">)</span><span>
</span><a name="line-867"></a><span>          </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The two types are different&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-868"></a><span>
</span><a name="line-869"></a><span class="hs-identifier">checkBootDecl</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-1628289317"><a href="#local-1628289317"><span class="hs-identifier">tc1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-1628289318"><a href="#local-1628289318"><span class="hs-identifier">tc2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-870"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#checkBootTyCon"><span class="hs-identifier hs-var">checkBootTyCon</span></a><span> </span><a href="#local-1628289317"><span class="hs-identifier hs-var">tc1</span></a><span> </span><a href="#local-1628289318"><span class="hs-identifier hs-var">tc2</span></a><span>
</span><a name="line-871"></a><span>
</span><a name="line-872"></a><span class="hs-identifier">checkBootDecl</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a name="local-1628289319"><a href="#local-1628289319"><span class="hs-identifier">dc1</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-873"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;checkBootDecl&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289319"><span class="hs-identifier hs-var">dc1</span></a><span class="hs-special">)</span><span>
</span><a name="line-874"></a><span>
</span><a name="line-875"></a><span class="hs-identifier">checkBootDecl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-comment">-- probably shouldn't happen</span><span>
</span><a name="line-876"></a><span>
</span><a name="line-877"></a><span class="hs-comment">-- | Combines two potential error messages</span><span>
</span><a name="line-878"></a><span class="hs-identifier">andThenCheck</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-879"></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">`</span><a name="andThenCheck"><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier">andThenCheck</span></a></a><span class="hs-special">`</span><span> </span><a name="local-1628289320"><a href="#local-1628289320"><span class="hs-identifier">msg</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289320"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-880"></a><a name="local-1628289321"><a href="#local-1628289321"><span class="hs-identifier">msg</span></a></a><span>     </span><span class="hs-special">`</span><span class="hs-identifier">andThenCheck</span><span class="hs-special">`</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289321"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-881"></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289322"><a href="#local-1628289322"><span class="hs-identifier">d1</span></a></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">andThenCheck</span><span class="hs-special">`</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289323"><a href="#local-1628289323"><span class="hs-identifier">d2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289322"><span class="hs-identifier hs-var">d1</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-1628289323"><span class="hs-identifier hs-var">d2</span></a><span class="hs-special">)</span><span>
</span><a name="line-882"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">andThenCheck</span><span class="hs-special">`</span><span>
</span><a name="line-883"></a><span>
</span><a name="line-884"></a><span class="hs-comment">-- | If the test in the first parameter is True, succeed with @Nothing@;</span><span>
</span><a name="line-885"></a><span class="hs-comment">-- otherwise, return the provided check</span><span>
</span><a name="line-886"></a><span class="hs-identifier">checkUnless</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-887"></a><a name="checkUnless"><a href="TcRnDriver.html#checkUnless"><span class="hs-identifier">checkUnless</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-888"></a><span class="hs-identifier">checkUnless</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-1628289324"><a href="#local-1628289324"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289324"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-889"></a><span>
</span><a name="line-890"></a><span class="hs-comment">-- | Run the check provided for every pair of elements in the lists.</span><span>
</span><a name="line-891"></a><span class="hs-comment">-- The provided SDoc should name the element type, in the plural.</span><span>
</span><a name="line-892"></a><span class="hs-identifier">checkListBy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1628289106"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628289106"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1628289106"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1628289106"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-893"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-894"></a><a name="checkListBy"><a href="TcRnDriver.html#checkListBy"><span class="hs-identifier">checkListBy</span></a></a><span> </span><a name="local-1628289325"><a href="#local-1628289325"><span class="hs-identifier">check_fun</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-1628289327"><a href="#local-1628289327"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-1628289328"><a href="#local-1628289328"><span class="hs-identifier">whats</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289330"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-1628289327"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-895"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-896"></a><span>    </span><a name="local-1628289329"><a href="#local-1628289329"><span class="hs-identifier">herald</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289328"><span class="hs-identifier hs-var">whats</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;do not match&quot;</span><span>
</span><a name="line-897"></a><span>
</span><a name="line-898"></a><span>    </span><a name="local-1628289330"><a href="#local-1628289330"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-899"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-1628289331"><a href="#local-1628289331"><span class="hs-identifier">docs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289329"><span class="hs-identifier hs-var">herald</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1628289331"><span class="hs-identifier hs-var">docs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-900"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-1628289332"><a href="#local-1628289332"><span class="hs-identifier">docs</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628289333"><a href="#local-1628289333"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-1628289334"><a href="#local-1628289334"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1628289335"><a href="#local-1628289335"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-1628289336"><a href="#local-1628289336"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628289325"><span class="hs-identifier hs-var">check_fun</span></a><span> </span><a href="#local-1628289333"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1628289335"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-901"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289337"><a href="#local-1628289337"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628289330"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289337"><span class="hs-identifier hs-var">doc</span></a><span class="hs-glyph">:</span><a href="#local-1628289332"><span class="hs-identifier hs-var">docs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289334"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-1628289336"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-902"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628289330"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1628289332"><span class="hs-identifier hs-var">docs</span></a><span>       </span><a href="#local-1628289334"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-1628289336"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-903"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289329"><span class="hs-identifier hs-var">herald</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">)</span><span>
</span><a name="line-904"></a><span>                            </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;There are different numbers of&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289328"><span class="hs-identifier hs-var">whats</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-905"></a><span>
</span><a name="line-906"></a><span class="hs-comment">-- | If the test in the first parameter is True, succeed with @Nothing@;</span><span>
</span><a name="line-907"></a><span class="hs-comment">-- otherwise, fail with the given SDoc.</span><span>
</span><a name="line-908"></a><span class="hs-identifier">check</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-909"></a><a name="check"><a href="TcRnDriver.html#check"><span class="hs-identifier">check</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-910"></a><span class="hs-identifier">check</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-1628289338"><a href="#local-1628289338"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628289338"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-911"></a><span>
</span><a name="line-912"></a><span class="hs-comment">-- | A more perspicuous name for @Nothing@, for @checkBootDecl@ and friends.</span><span>
</span><a name="line-913"></a><span class="hs-identifier">checkSuccess</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-914"></a><a name="checkSuccess"><a href="TcRnDriver.html#checkSuccess"><span class="hs-identifier">checkSuccess</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-915"></a><span>
</span><a name="line-916"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-917"></a><span class="hs-identifier">checkBootTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-918"></a><a name="checkBootTyCon"><a href="TcRnDriver.html#checkBootTyCon"><span class="hs-identifier">checkBootTyCon</span></a></a><span> </span><a name="local-1628289339"><a href="#local-1628289339"><span class="hs-identifier">tc1</span></a></a><span> </span><a name="local-1628289340"><a href="#local-1628289340"><span class="hs-identifier">tc2</span></a></a><span>
</span><a name="line-919"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-920"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The types have different kinds&quot;</span><span>    </span><span class="hs-comment">-- First off, check the kind</span><span>
</span><a name="line-921"></a><span>
</span><a name="line-922"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289375"><a href="#local-1628289375"><span class="hs-identifier">c1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span>
</span><a name="line-923"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289376"><a href="#local-1628289376"><span class="hs-identifier">c2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span>
</span><a name="line-924"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628289377"><a href="#local-1628289377"><span class="hs-identifier">clas_tvs1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289378"><a href="#local-1628289378"><span class="hs-identifier">clas_fds1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289379"><a href="#local-1628289379"><span class="hs-identifier">sc_theta1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628289380"><a href="#local-1628289380"><span class="hs-identifier">ats1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289381"><a href="#local-1628289381"><span class="hs-identifier">op_stuff1</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-925"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Class.html#classExtraBigSig"><span class="hs-identifier hs-var">classExtraBigSig</span></a><span> </span><a href="#local-1628289375"><span class="hs-identifier hs-var">c1</span></a><span>
</span><a name="line-926"></a><span>        </span><span class="hs-special">(</span><a name="local-1628289382"><a href="#local-1628289382"><span class="hs-identifier">clas_tvs2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289383"><a href="#local-1628289383"><span class="hs-identifier">clas_fds2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289384"><a href="#local-1628289384"><span class="hs-identifier">sc_theta2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628289385"><a href="#local-1628289385"><span class="hs-identifier">ats2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289386"><a href="#local-1628289386"><span class="hs-identifier">op_stuff2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-927"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Class.html#classExtraBigSig"><span class="hs-identifier hs-var">classExtraBigSig</span></a><span> </span><a href="#local-1628289376"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-928"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289387"><a href="#local-1628289387"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a><span> </span><a href="TcRnDriver.html#emptyRnEnv2"><span class="hs-identifier hs-var">emptyRnEnv2</span></a><span> </span><a href="#local-1628289377"><span class="hs-identifier hs-var">clas_tvs1</span></a><span> </span><a href="#local-1628289382"><span class="hs-identifier hs-var">clas_tvs2</span></a><span>
</span><a name="line-929"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><a name="line-930"></a><span>       </span><a name="local-1628289388"><a href="#local-1628289388"><span class="hs-identifier">eqSig</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628289393"><a href="#local-1628289393"><span class="hs-identifier">id1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289394"><a href="#local-1628289394"><span class="hs-identifier">def_meth1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1628289395"><a href="#local-1628289395"><span class="hs-identifier">id2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289396"><a href="#local-1628289396"><span class="hs-identifier">def_meth2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-931"></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289397"><span class="hs-identifier hs-var">name1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628289398"><span class="hs-identifier hs-var">name2</span></a><span class="hs-special">)</span><span>
</span><a name="line-932"></a><span>                 </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The names&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289399"><span class="hs-identifier hs-var">pname1</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;and&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289400"><span class="hs-identifier hs-var">pname2</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-933"></a><span>                  </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;are different&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-934"></a><span>           </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-1628289387"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628289402"><span class="hs-identifier hs-var">op_ty1</span></a><span> </span><a href="#local-1628289404"><span class="hs-identifier hs-var">op_ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-935"></a><span>                 </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The types of&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289399"><span class="hs-identifier hs-var">pname1</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-936"></a><span>                  </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;are different&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-937"></a><span>           </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#eqMaybeBy"><span class="hs-identifier hs-var">eqMaybeBy</span></a><span> </span><a href="#local-1628289390"><span class="hs-identifier hs-var">eqDM</span></a><span> </span><a href="#local-1628289394"><span class="hs-identifier hs-var">def_meth1</span></a><span> </span><a href="#local-1628289396"><span class="hs-identifier hs-var">def_meth2</span></a><span class="hs-special">)</span><span>
</span><a name="line-938"></a><span>                 </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The default methods associated with&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289399"><span class="hs-identifier hs-var">pname1</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-939"></a><span>                  </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;are different&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-940"></a><span>         </span><span class="hs-keyword">where</span><span>
</span><a name="line-941"></a><span>          </span><a name="local-1628289397"><a href="#local-1628289397"><span class="hs-identifier">name1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628289393"><span class="hs-identifier hs-var">id1</span></a><span>
</span><a name="line-942"></a><span>          </span><a name="local-1628289398"><a href="#local-1628289398"><span class="hs-identifier">name2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628289395"><span class="hs-identifier hs-var">id2</span></a><span>
</span><a name="line-943"></a><span>          </span><a name="local-1628289399"><a href="#local-1628289399"><span class="hs-identifier">pname1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289397"><span class="hs-identifier hs-var">name1</span></a><span class="hs-special">)</span><span>
</span><a name="line-944"></a><span>          </span><a name="local-1628289400"><a href="#local-1628289400"><span class="hs-identifier">pname2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289398"><span class="hs-identifier hs-var">name2</span></a><span class="hs-special">)</span><span>
</span><a name="line-945"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628289401"><a href="#local-1628289401"><span class="hs-identifier">rho_ty1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitForAllTys"><span class="hs-identifier hs-var">splitForAllTys</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628289393"><span class="hs-identifier hs-var">id1</span></a><span class="hs-special">)</span><span>
</span><a name="line-946"></a><span>          </span><a name="local-1628289402"><a href="#local-1628289402"><span class="hs-identifier">op_ty1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#funResultTy"><span class="hs-identifier hs-var">funResultTy</span></a><span> </span><a href="#local-1628289401"><span class="hs-identifier hs-var">rho_ty1</span></a><span>
</span><a name="line-947"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628289403"><a href="#local-1628289403"><span class="hs-identifier">rho_ty2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitForAllTys"><span class="hs-identifier hs-var">splitForAllTys</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628289395"><span class="hs-identifier hs-var">id2</span></a><span class="hs-special">)</span><span>
</span><a name="line-948"></a><span>          </span><a name="local-1628289404"><a href="#local-1628289404"><span class="hs-identifier">op_ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#funResultTy"><span class="hs-identifier hs-var">funResultTy</span></a><span> </span><a href="#local-1628289403"><span class="hs-identifier hs-var">rho_ty2</span></a><span>
</span><a name="line-949"></a><span>
</span><a name="line-950"></a><span>       </span><a name="local-1628289389"><a href="#local-1628289389"><span class="hs-identifier">eqAT</span></a></a><span> </span><span class="hs-special">(</span><a href="Class.html#ATI"><span class="hs-identifier hs-var">ATI</span></a><span> </span><a name="local-1628289405"><a href="#local-1628289405"><span class="hs-identifier">tc1</span></a></a><span> </span><a name="local-1628289406"><a href="#local-1628289406"><span class="hs-identifier">def_ats1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Class.html#ATI"><span class="hs-identifier hs-var">ATI</span></a><span> </span><a name="local-1628289407"><a href="#local-1628289407"><span class="hs-identifier">tc2</span></a></a><span> </span><a name="local-1628289408"><a href="#local-1628289408"><span class="hs-identifier">def_ats2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-951"></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#checkBootTyCon"><span class="hs-identifier hs-var">checkBootTyCon</span></a><span> </span><a href="#local-1628289405"><span class="hs-identifier hs-var">tc1</span></a><span> </span><a href="#local-1628289407"><span class="hs-identifier hs-var">tc2</span></a><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-952"></a><span>           </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289391"><span class="hs-identifier hs-var">eqATDef</span></a><span> </span><a href="#local-1628289406"><span class="hs-identifier hs-var">def_ats1</span></a><span> </span><a href="#local-1628289408"><span class="hs-identifier hs-var">def_ats2</span></a><span class="hs-special">)</span><span>
</span><a name="line-953"></a><span>                 </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The associated type defaults differ&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-954"></a><span>
</span><a name="line-955"></a><span>       </span><a name="local-1628289390"><a href="#local-1628289390"><span class="hs-identifier">eqDM</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-956"></a><span>       </span><span class="hs-identifier">eqDM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#GenericDM"><span class="hs-identifier hs-var">GenericDM</span></a><span> </span><a name="local-1628289409"><a href="#local-1628289409"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#GenericDM"><span class="hs-identifier hs-var">GenericDM</span></a><span> </span><a name="local-1628289410"><a href="#local-1628289410"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-1628289387"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628289409"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-1628289410"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-957"></a><span>       </span><span class="hs-identifier">eqDM</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-958"></a><span>
</span><a name="line-959"></a><span>       </span><span class="hs-comment">-- Ignore the location of the defaults</span><span>
</span><a name="line-960"></a><span>       </span><a name="local-1628289391"><a href="#local-1628289391"><span class="hs-identifier">eqATDef</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-961"></a><span>       </span><span class="hs-identifier">eqATDef</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628289411"><a href="#local-1628289411"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289412"><a href="#local-1628289412"><span class="hs-identifier">_loc1</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628289413"><a href="#local-1628289413"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289414"><a href="#local-1628289414"><span class="hs-identifier">_loc2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-1628289387"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628289411"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1628289413"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-962"></a><span>       </span><span class="hs-identifier">eqATDef</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-963"></a><span>
</span><a name="line-964"></a><span>       </span><a name="local-1628289392"><a href="#local-1628289392"><span class="hs-identifier">eqFD</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628289415"><a href="#local-1628289415"><span class="hs-identifier">as1</span></a></a><span class="hs-special">,</span><a name="local-1628289416"><a href="#local-1628289416"><span class="hs-identifier">bs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1628289417"><a href="#local-1628289417"><span class="hs-identifier">as2</span></a></a><span class="hs-special">,</span><a name="local-1628289418"><a href="#local-1628289418"><span class="hs-identifier">bs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-965"></a><span>         </span><a href="Util.html#eqListBy"><span class="hs-identifier hs-var">eqListBy</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-1628289387"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1628289415"><span class="hs-identifier hs-var">as1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1628289417"><span class="hs-identifier hs-var">as2</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-966"></a><span>         </span><a href="Util.html#eqListBy"><span class="hs-identifier hs-var">eqListBy</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-1628289387"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1628289416"><span class="hs-identifier hs-var">bs1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1628289418"><span class="hs-identifier hs-var">bs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-967"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-968"></a><span>    </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289341"><span class="hs-identifier hs-var">roles1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628289342"><span class="hs-identifier hs-var">roles2</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289343"><span class="hs-identifier hs-var">roles_msg</span></a><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-969"></a><span>          </span><span class="hs-comment">-- Checks kind of class</span><span>
</span><a name="line-970"></a><span>    </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#eqListBy"><span class="hs-identifier hs-var">eqListBy</span></a><span> </span><a href="#local-1628289392"><span class="hs-identifier hs-var">eqFD</span></a><span> </span><a href="#local-1628289378"><span class="hs-identifier hs-var">clas_fds1</span></a><span> </span><a href="#local-1628289383"><span class="hs-identifier hs-var">clas_fds2</span></a><span class="hs-special">)</span><span>
</span><a name="line-971"></a><span>          </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The functional dependencies do not match&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-972"></a><span>    </span><a href="TcRnDriver.html#checkUnless"><span class="hs-identifier hs-var">checkUnless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628289379"><span class="hs-identifier hs-var">sc_theta1</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628289381"><span class="hs-identifier hs-var">op_stuff1</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628289380"><span class="hs-identifier hs-var">ats1</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-973"></a><span>                     </span><span class="hs-comment">-- Above tests for an &quot;abstract&quot; class</span><span>
</span><a name="line-974"></a><span>    </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#eqListBy"><span class="hs-identifier hs-var">eqListBy</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-1628289387"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289379"><span class="hs-identifier hs-var">sc_theta1</span></a><span> </span><a href="#local-1628289384"><span class="hs-identifier hs-var">sc_theta2</span></a><span class="hs-special">)</span><span>
</span><a name="line-975"></a><span>          </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The class constraints do not match&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-976"></a><span>    </span><a href="TcRnDriver.html#checkListBy"><span class="hs-identifier hs-var">checkListBy</span></a><span> </span><a href="#local-1628289388"><span class="hs-identifier hs-var">eqSig</span></a><span> </span><a href="#local-1628289381"><span class="hs-identifier hs-var">op_stuff1</span></a><span> </span><a href="#local-1628289386"><span class="hs-identifier hs-var">op_stuff2</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;methods&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-977"></a><span>    </span><a href="TcRnDriver.html#checkListBy"><span class="hs-identifier hs-var">checkListBy</span></a><span> </span><a href="#local-1628289389"><span class="hs-identifier hs-var">eqAT</span></a><span> </span><a href="#local-1628289380"><span class="hs-identifier hs-var">ats1</span></a><span> </span><a href="#local-1628289385"><span class="hs-identifier hs-var">ats2</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;associated types&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-978"></a><span>
</span><a name="line-979"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289419"><a href="#local-1628289419"><span class="hs-identifier">syn_rhs1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#synTyConRhs_maybe"><span class="hs-identifier hs-var">synTyConRhs_maybe</span></a><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span>
</span><a name="line-980"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289420"><a href="#local-1628289420"><span class="hs-identifier">syn_rhs2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#synTyConRhs_maybe"><span class="hs-identifier hs-var">synTyConRhs_maybe</span></a><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span>
</span><a name="line-981"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289421"><a href="#local-1628289421"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a><span> </span><a href="TcRnDriver.html#emptyRnEnv2"><span class="hs-identifier hs-var">emptyRnEnv2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span class="hs-special">)</span><span>
</span><a name="line-982"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">tc2</span><span class="hs-special">)</span><span>
</span><a name="line-983"></a><span>    </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289341"><span class="hs-identifier hs-var">roles1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628289342"><span class="hs-identifier hs-var">roles2</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289343"><span class="hs-identifier hs-var">roles_msg</span></a><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-984"></a><span>    </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-1628289421"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628289419"><span class="hs-identifier hs-var">syn_rhs1</span></a><span> </span><a href="#local-1628289420"><span class="hs-identifier hs-var">syn_rhs2</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>   </span><span class="hs-comment">-- nothing interesting to say</span><span>
</span><a name="line-985"></a><span>
</span><a name="line-986"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289422"><a href="#local-1628289422"><span class="hs-identifier">fam_flav1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#famTyConFlav_maybe"><span class="hs-identifier hs-var">famTyConFlav_maybe</span></a><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span>
</span><a name="line-987"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289423"><a href="#local-1628289423"><span class="hs-identifier">fam_flav2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#famTyConFlav_maybe"><span class="hs-identifier hs-var">famTyConFlav_maybe</span></a><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span>
</span><a name="line-988"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">tc2</span><span class="hs-special">)</span><span>
</span><a name="line-989"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289424"><a href="#local-1628289424"><span class="hs-identifier">eqFamFlav</span></a></a><span> </span><a href="TyCon.html#OpenSynFamilyTyCon"><span class="hs-identifier hs-var">OpenSynFamilyTyCon</span></a><span>   </span><a href="TyCon.html#OpenSynFamilyTyCon"><span class="hs-identifier hs-var">OpenSynFamilyTyCon</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-990"></a><span>        </span><span class="hs-identifier">eqFamFlav</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#DataFamilyTyCon"><span class="hs-identifier hs-var">DataFamilyTyCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#DataFamilyTyCon"><span class="hs-identifier hs-var">DataFamilyTyCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-991"></a><span>        </span><span class="hs-identifier">eqFamFlav</span><span> </span><a href="TyCon.html#AbstractClosedSynFamilyTyCon"><span class="hs-identifier hs-var">AbstractClosedSynFamilyTyCon</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-var">ClosedSynFamilyTyCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-992"></a><span>        </span><span class="hs-identifier">eqFamFlav</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-var">ClosedSynFamilyTyCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="TyCon.html#AbstractClosedSynFamilyTyCon"><span class="hs-identifier hs-var">AbstractClosedSynFamilyTyCon</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-993"></a><span>        </span><span class="hs-identifier">eqFamFlav</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-var">ClosedSynFamilyTyCon</span></a><span> </span><a name="local-1628289427"><a href="#local-1628289427"><span class="hs-identifier">ax1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-var">ClosedSynFamilyTyCon</span></a><span> </span><a name="local-1628289428"><a href="#local-1628289428"><span class="hs-identifier">ax2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-994"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289346"><span class="hs-identifier hs-var">eqClosedFamilyAx</span></a><span> </span><a href="#local-1628289427"><span class="hs-identifier hs-var">ax1</span></a><span> </span><a href="#local-1628289428"><span class="hs-identifier hs-var">ax2</span></a><span>
</span><a name="line-995"></a><span>        </span><span class="hs-identifier">eqFamFlav</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#BuiltInSynFamTyCon"><span class="hs-identifier hs-var">BuiltInSynFamTyCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#BuiltInSynFamTyCon"><span class="hs-identifier hs-var">BuiltInSynFamTyCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span>
</span><a name="line-996"></a><span>        </span><span class="hs-identifier">eqFamFlav</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-997"></a><span>        </span><a name="local-1628289425"><a href="#local-1628289425"><span class="hs-identifier">injInfo1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#familyTyConInjectivityInfo"><span class="hs-identifier hs-var">familyTyConInjectivityInfo</span></a><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span>
</span><a name="line-998"></a><span>        </span><a name="local-1628289426"><a href="#local-1628289426"><span class="hs-identifier">injInfo2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#familyTyConInjectivityInfo"><span class="hs-identifier hs-var">familyTyConInjectivityInfo</span></a><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span>
</span><a name="line-999"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-1000"></a><span>    </span><span class="hs-comment">-- check equality of roles, family flavours and injectivity annotations</span><span>
</span><a name="line-1001"></a><span>    </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289341"><span class="hs-identifier hs-var">roles1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628289342"><span class="hs-identifier hs-var">roles2</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289343"><span class="hs-identifier hs-var">roles_msg</span></a><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-1002"></a><span>    </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289424"><span class="hs-identifier hs-var">eqFamFlav</span></a><span> </span><a href="#local-1628289422"><span class="hs-identifier hs-var">fam_flav1</span></a><span> </span><a href="#local-1628289423"><span class="hs-identifier hs-var">fam_flav2</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-1003"></a><span>    </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289425"><span class="hs-identifier hs-var">injInfo1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628289426"><span class="hs-identifier hs-var">injInfo2</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1004"></a><span>
</span><a name="line-1005"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span>
</span><a name="line-1006"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289429"><a href="#local-1628289429"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a><span> </span><a href="TcRnDriver.html#emptyRnEnv2"><span class="hs-identifier hs-var">emptyRnEnv2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1007"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">tc2</span><span class="hs-special">)</span><span>
</span><a name="line-1008"></a><span>    </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289341"><span class="hs-identifier hs-var">roles1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628289342"><span class="hs-identifier hs-var">roles2</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289343"><span class="hs-identifier hs-var">roles_msg</span></a><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-1009"></a><span>    </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#eqListBy"><span class="hs-identifier hs-var">eqListBy</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-1628289429"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1010"></a><span>                     </span><span class="hs-special">(</span><a href="TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1011"></a><span>          </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The datatype contexts do not match&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-1012"></a><span>    </span><a href="#local-1628289344"><span class="hs-identifier hs-var">eqAlgRhs</span></a><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#algTyConRhs"><span class="hs-identifier hs-var">algTyConRhs</span></a><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#algTyConRhs"><span class="hs-identifier hs-var">algTyConRhs</span></a><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1013"></a><span>
</span><a name="line-1014"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>   </span><span class="hs-comment">-- two very different types -- should be obvious</span><span>
</span><a name="line-1015"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1016"></a><span>    </span><a name="local-1628289341"><a href="#local-1628289341"><span class="hs-identifier">roles1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a><span> </span><a href="#local-1628289339"><span class="hs-identifier hs-var">tc1</span></a><span>
</span><a name="line-1017"></a><span>    </span><a name="local-1628289342"><a href="#local-1628289342"><span class="hs-identifier">roles2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a><span> </span><a href="#local-1628289340"><span class="hs-identifier hs-var">tc2</span></a><span>
</span><a name="line-1018"></a><span>    </span><a name="local-1628289343"><a href="#local-1628289343"><span class="hs-identifier">roles_msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The roles do not match.&quot;</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-1019"></a><span>                </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Roles on abstract types default to&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1020"></a><span>                 </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;representational&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in boot files.&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1021"></a><span>
</span><a name="line-1022"></a><span>    </span><a name="local-1628289344"><a href="#local-1628289344"><span class="hs-identifier">eqAlgRhs</span></a></a><span> </span><a name="local-1628289348"><a href="#local-1628289348"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#AbstractTyCon"><span class="hs-identifier hs-var">AbstractTyCon</span></a><span> </span><a name="local-1628289349"><a href="#local-1628289349"><span class="hs-identifier">dis1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628289350"><a href="#local-1628289350"><span class="hs-identifier">rhs2</span></a></a><span>
</span><a name="line-1023"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628289349"><span class="hs-identifier hs-var">dis1</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#isGenInjAlgRhs"><span class="hs-identifier hs-var">isGenInjAlgRhs</span></a><span> </span><a href="#local-1628289350"><span class="hs-identifier hs-var">rhs2</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">--Check compatibility</span><span>
</span><a name="line-1024"></a><span>                          </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The natures of the declarations for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1025"></a><span>                           </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289348"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;are different&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1026"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#checkSuccess"><span class="hs-identifier hs-var">checkSuccess</span></a><span>
</span><a name="line-1027"></a><span>    </span><span class="hs-identifier">eqAlgRhs</span><span> </span><span class="hs-identifier">_</span><span>  </span><a name="local-1628289351"><a href="#local-1628289351"><span class="hs-identifier">tc1</span></a></a><span class="hs-glyph">@</span><a href="TyCon.html#DataTyCon"><span class="hs-identifier hs-var">DataTyCon</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><a name="local-1628289352"><a href="#local-1628289352"><span class="hs-identifier">tc2</span></a></a><span class="hs-glyph">@</span><a href="TyCon.html#DataTyCon"><span class="hs-identifier hs-var">DataTyCon</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1028"></a><span>        </span><a href="TcRnDriver.html#checkListBy"><span class="hs-identifier hs-var">checkListBy</span></a><span> </span><a href="#local-1628289345"><span class="hs-identifier hs-var">eqCon</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">data_cons</span><span> </span><a href="#local-1628289351"><span class="hs-identifier hs-var">tc1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">data_cons</span><span> </span><a href="#local-1628289352"><span class="hs-identifier hs-var">tc2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;constructors&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1029"></a><span>    </span><span class="hs-identifier">eqAlgRhs</span><span> </span><span class="hs-identifier">_</span><span>  </span><a name="local-1628289353"><a href="#local-1628289353"><span class="hs-identifier">tc1</span></a></a><span class="hs-glyph">@</span><a href="TyCon.html#NewTyCon"><span class="hs-identifier hs-var">NewTyCon</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><a name="local-1628289354"><a href="#local-1628289354"><span class="hs-identifier">tc2</span></a></a><span class="hs-glyph">@</span><a href="TyCon.html#NewTyCon"><span class="hs-identifier hs-var">NewTyCon</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1030"></a><span>        </span><a href="#local-1628289345"><span class="hs-identifier hs-var">eqCon</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">data_con</span><span> </span><a href="#local-1628289353"><span class="hs-identifier hs-var">tc1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">data_con</span><span> </span><a href="#local-1628289354"><span class="hs-identifier hs-var">tc2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1031"></a><span>    </span><span class="hs-identifier">eqAlgRhs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Cannot match a&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;data&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1032"></a><span>                           </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;definition with a&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;newtype&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1033"></a><span>                           </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;definition&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1034"></a><span>
</span><a name="line-1035"></a><span>    </span><a name="local-1628289345"><a href="#local-1628289345"><span class="hs-identifier">eqCon</span></a></a><span> </span><a name="local-1628289355"><a href="#local-1628289355"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-1628289356"><a href="#local-1628289356"><span class="hs-identifier">c2</span></a></a><span>
</span><a name="line-1036"></a><span>      </span><span class="hs-glyph">=</span><span>  </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289357"><span class="hs-identifier hs-var">name1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628289358"><span class="hs-identifier hs-var">name2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1037"></a><span>               </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The names&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289359"><span class="hs-identifier hs-var">pname1</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;and&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289360"><span class="hs-identifier hs-var">pname2</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1038"></a><span>                </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;differ&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-1039"></a><span>         </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConIsInfix"><span class="hs-identifier hs-var">dataConIsInfix</span></a><span> </span><a href="#local-1628289355"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="DataCon.html#dataConIsInfix"><span class="hs-identifier hs-var">dataConIsInfix</span></a><span> </span><a href="#local-1628289356"><span class="hs-identifier hs-var">c2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1040"></a><span>               </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The fixities of&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289359"><span class="hs-identifier hs-var">pname1</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1041"></a><span>                </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;differ&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-1042"></a><span>         </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#eqListBy"><span class="hs-identifier hs-var">eqListBy</span></a><span> </span><a href="DataCon.html#eqHsBang"><span class="hs-identifier hs-var">eqHsBang</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConImplBangs"><span class="hs-identifier hs-var">dataConImplBangs</span></a><span> </span><a href="#local-1628289355"><span class="hs-identifier hs-var">c1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConImplBangs"><span class="hs-identifier hs-var">dataConImplBangs</span></a><span> </span><a href="#local-1628289356"><span class="hs-identifier hs-var">c2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1043"></a><span>               </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The strictness annotations for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289359"><span class="hs-identifier hs-var">pname1</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1044"></a><span>                </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;differ&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-1045"></a><span>         </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">flSelector</span><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a><span> </span><a href="#local-1628289355"><span class="hs-identifier hs-var">c1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">flSelector</span><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a><span> </span><a href="#local-1628289356"><span class="hs-identifier hs-var">c2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1046"></a><span>               </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The record label lists for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289359"><span class="hs-identifier hs-var">pname1</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1047"></a><span>                </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;differ&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="TcRnDriver.html#andThenCheck"><span class="hs-identifier hs-var">andThenCheck</span></a><span class="hs-special">`</span><span>
</span><a name="line-1048"></a><span>         </span><a href="TcRnDriver.html#check"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConUserType"><span class="hs-identifier hs-var">dataConUserType</span></a><span> </span><a href="#local-1628289355"><span class="hs-identifier hs-var">c1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConUserType"><span class="hs-identifier hs-var">dataConUserType</span></a><span> </span><a href="#local-1628289356"><span class="hs-identifier hs-var">c2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1049"></a><span>               </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The types for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289359"><span class="hs-identifier hs-var">pname1</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;differ&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1050"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1051"></a><span>        </span><a name="local-1628289357"><a href="#local-1628289357"><span class="hs-identifier">name1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a><span> </span><a href="#local-1628289355"><span class="hs-identifier hs-var">c1</span></a><span>
</span><a name="line-1052"></a><span>        </span><a name="local-1628289358"><a href="#local-1628289358"><span class="hs-identifier">name2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a><span> </span><a href="#local-1628289356"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-1053"></a><span>        </span><a name="local-1628289359"><a href="#local-1628289359"><span class="hs-identifier">pname1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289357"><span class="hs-identifier hs-var">name1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1054"></a><span>        </span><a name="local-1628289360"><a href="#local-1628289360"><span class="hs-identifier">pname2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289358"><span class="hs-identifier hs-var">name2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1055"></a><span>
</span><a name="line-1056"></a><span>    </span><a name="local-1628289346"><a href="#local-1628289346"><span class="hs-identifier">eqClosedFamilyAx</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1057"></a><span>    </span><span class="hs-identifier">eqClosedFamilyAx</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1058"></a><span>    </span><span class="hs-identifier">eqClosedFamilyAx</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1059"></a><span>    </span><span class="hs-identifier">eqClosedFamilyAx</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-var">CoAxiom</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">co_ax_branches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289361"><a href="#local-1628289361"><span class="hs-identifier">branches1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1060"></a><span>                     </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-var">CoAxiom</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">co_ax_branches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289362"><a href="#local-1628289362"><span class="hs-identifier">branches2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1061"></a><span>      </span><span class="hs-glyph">=</span><span>  </span><a href="CoAxiom.html#numBranches"><span class="hs-identifier hs-var">numBranches</span></a><span> </span><a href="#local-1628289361"><span class="hs-identifier hs-var">branches1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="CoAxiom.html#numBranches"><span class="hs-identifier hs-var">numBranches</span></a><span> </span><a href="#local-1628289362"><span class="hs-identifier hs-var">branches2</span></a><span>
</span><a name="line-1062"></a><span>      </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#and"><span class="hs-identifier hs-var">and</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="#local-1628289347"><span class="hs-identifier hs-var">eqClosedFamilyBranch</span></a><span> </span><a href="#local-1628289363"><span class="hs-identifier hs-var">branch_list1</span></a><span> </span><a href="#local-1628289364"><span class="hs-identifier hs-var">branch_list2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1063"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1064"></a><span>        </span><a name="local-1628289363"><a href="#local-1628289363"><span class="hs-identifier">branch_list1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#fromBranches"><span class="hs-identifier hs-var">fromBranches</span></a><span> </span><a href="#local-1628289361"><span class="hs-identifier hs-var">branches1</span></a><span>
</span><a name="line-1065"></a><span>        </span><a name="local-1628289364"><a href="#local-1628289364"><span class="hs-identifier">branch_list2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#fromBranches"><span class="hs-identifier hs-var">fromBranches</span></a><span> </span><a href="#local-1628289362"><span class="hs-identifier hs-var">branches2</span></a><span>
</span><a name="line-1066"></a><span>
</span><a name="line-1067"></a><span>    </span><a name="local-1628289347"><a href="#local-1628289347"><span class="hs-identifier">eqClosedFamilyBranch</span></a></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#CoAxBranch"><span class="hs-identifier hs-var">CoAxBranch</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cab_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289365"><a href="#local-1628289365"><span class="hs-identifier">tvs1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_cvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289366"><a href="#local-1628289366"><span class="hs-identifier">cvs1</span></a></a><span>
</span><a name="line-1068"></a><span>                                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289367"><a href="#local-1628289367"><span class="hs-identifier">lhs1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289368"><a href="#local-1628289368"><span class="hs-identifier">rhs1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1069"></a><span>                         </span><span class="hs-special">(</span><a href="CoAxiom.html#CoAxBranch"><span class="hs-identifier hs-var">CoAxBranch</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cab_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289369"><a href="#local-1628289369"><span class="hs-identifier">tvs2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_cvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289370"><a href="#local-1628289370"><span class="hs-identifier">cvs2</span></a></a><span>
</span><a name="line-1070"></a><span>                                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289371"><a href="#local-1628289371"><span class="hs-identifier">lhs2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289372"><a href="#local-1628289372"><span class="hs-identifier">rhs2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1071"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289373"><a href="#local-1628289373"><span class="hs-identifier">env1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a><span> </span><a href="TcRnDriver.html#emptyRnEnv2"><span class="hs-identifier hs-var">emptyRnEnv2</span></a><span> </span><a href="#local-1628289365"><span class="hs-identifier hs-var">tvs1</span></a><span> </span><a href="#local-1628289369"><span class="hs-identifier hs-var">tvs2</span></a><span>
</span><a name="line-1072"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289374"><a href="#local-1628289374"><span class="hs-identifier">env</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a><span> </span><a href="#local-1628289373"><span class="hs-identifier hs-var">env1</span></a><span>        </span><a href="#local-1628289366"><span class="hs-identifier hs-var">cvs1</span></a><span> </span><a href="#local-1628289370"><span class="hs-identifier hs-var">cvs2</span></a><span>
</span><a name="line-1073"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#eqListBy"><span class="hs-identifier hs-var">eqListBy</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-1628289374"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289367"><span class="hs-identifier hs-var">lhs1</span></a><span> </span><a href="#local-1628289371"><span class="hs-identifier hs-var">lhs2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-1074"></a><span>        </span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-1628289374"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628289368"><span class="hs-identifier hs-var">rhs1</span></a><span> </span><a href="#local-1628289372"><span class="hs-identifier hs-var">rhs2</span></a><span>
</span><a name="line-1075"></a><span>
</span><a name="line-1076"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1077"></a><span>
</span><a name="line-1078"></a><span class="hs-identifier">emptyRnEnv2</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span>
</span><a name="line-1079"></a><a name="emptyRnEnv2"><a href="TcRnDriver.html#emptyRnEnv2"><span class="hs-identifier">emptyRnEnv2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkRnEnv2"><span class="hs-identifier hs-var">mkRnEnv2</span></a><span> </span><a href="VarEnv.html#emptyInScopeSet"><span class="hs-identifier hs-var">emptyInScopeSet</span></a><span>
</span><a name="line-1080"></a><span>
</span><a name="line-1081"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-1082"></a><span class="hs-identifier">missingBootThing</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1083"></a><a name="missingBootThing"><a href="TcRnDriver.html#missingBootThing"><span class="hs-identifier">missingBootThing</span></a></a><span> </span><a name="local-1628289430"><a href="#local-1628289430"><span class="hs-identifier">is_boot</span></a></a><span> </span><a name="local-1628289431"><a href="#local-1628289431"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-1628289432"><a href="#local-1628289432"><span class="hs-identifier">what</span></a></a><span>
</span><a name="line-1084"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289431"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is exported by the&quot;</span><span>
</span><a name="line-1085"></a><span>    </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-1628289430"><span class="hs-identifier hs-var">is_boot</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hs-boot&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hsig&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1086"></a><span>    </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;file, but not&quot;</span><span>
</span><a name="line-1087"></a><span>    </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628289432"><span class="hs-identifier hs-var">what</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the module&quot;</span><span>
</span><a name="line-1088"></a><span>
</span><a name="line-1089"></a><span class="hs-identifier">bootMisMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1090"></a><a name="bootMisMatch"><a href="TcRnDriver.html#bootMisMatch"><span class="hs-identifier">bootMisMatch</span></a></a><span> </span><a name="local-1628289433"><a href="#local-1628289433"><span class="hs-identifier">is_boot</span></a></a><span> </span><a name="local-1628289434"><a href="#local-1628289434"><span class="hs-identifier">extra_info</span></a></a><span> </span><a name="local-1628289435"><a href="#local-1628289435"><span class="hs-identifier">real_thing</span></a></a><span> </span><a name="local-1628289436"><a href="#local-1628289436"><span class="hs-identifier">boot_thing</span></a></a><span>
</span><a name="line-1091"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289435"><span class="hs-identifier hs-var">real_thing</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1092"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;has conflicting definitions in the module&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1093"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;and its&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1094"></a><span>            </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-1628289433"><span class="hs-identifier hs-var">is_boot</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hs-boot file&quot;</span><span>
</span><a name="line-1095"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hsig file&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1096"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Main module:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="PprTyThing.html#pprTyThing"><span class="hs-identifier hs-var">PprTyThing</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">pprTyThing</span></a><span> </span><a href="#local-1628289435"><span class="hs-identifier hs-var">real_thing</span></a><span class="hs-special">,</span><span>
</span><a name="line-1097"></a><span>          </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-1628289433"><span class="hs-identifier hs-var">is_boot</span></a><span>
</span><a name="line-1098"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Boot file:  &quot;</span><span>
</span><a name="line-1099"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Hsig file: &quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1100"></a><span>            </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="PprTyThing.html#pprTyThing"><span class="hs-identifier hs-var">PprTyThing</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">pprTyThing</span></a><span> </span><a href="#local-1628289436"><span class="hs-identifier hs-var">boot_thing</span></a><span class="hs-special">,</span><span>
</span><a name="line-1101"></a><span>          </span><a href="#local-1628289434"><span class="hs-identifier hs-var">extra_info</span></a><span class="hs-special">]</span><span>
</span><a name="line-1102"></a><span>
</span><a name="line-1103"></a><span class="hs-identifier">instMisMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1104"></a><a name="instMisMatch"><a href="TcRnDriver.html#instMisMatch"><span class="hs-identifier">instMisMatch</span></a></a><span> </span><a name="local-1628289437"><a href="#local-1628289437"><span class="hs-identifier">is_boot</span></a></a><span> </span><a name="local-1628289438"><a href="#local-1628289438"><span class="hs-identifier">inst</span></a></a><span>
</span><a name="line-1105"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289438"><span class="hs-identifier hs-var">inst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1106"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is defined in the&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1107"></a><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-1628289437"><span class="hs-identifier hs-var">is_boot</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hs-boot&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hsig&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1108"></a><span>       </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;file, but not in the module itself&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1109"></a><span>
</span><a name="line-1110"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Type-checking the top level of a module (continued)
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1117"></a><span>
</span><a name="line-1118"></a><span class="hs-identifier">rnTopSrcDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1119"></a><span class="hs-comment">-- Fails if there are any errors</span><span>
</span><a name="line-1120"></a><a name="rnTopSrcDecls"><a href="TcRnDriver.html#rnTopSrcDecls"><span class="hs-identifier">rnTopSrcDecls</span></a></a><span> </span><a name="local-1628289439"><a href="#local-1628289439"><span class="hs-identifier">group</span></a></a><span>
</span><a name="line-1121"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Rename the source decls</span><span>
</span><a name="line-1122"></a><span>        </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rn12&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1123"></a><span>        </span><span class="hs-special">(</span><a name="local-1628289440"><a href="#local-1628289440"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289441"><a href="#local-1628289441"><span class="hs-identifier">rn_decls</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="RnSource.html#rnSrcDecls"><span class="hs-identifier hs-var">rnSrcDecls</span></a><span> </span><a href="#local-1628289439"><span class="hs-identifier hs-var">group</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1124"></a><span>        </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rn13&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1125"></a><span>
</span><a name="line-1126"></a><span>        </span><span class="hs-comment">-- save the renamed syntax, if we want it</span><span>
</span><a name="line-1127"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289442"><a href="#local-1628289442"><span class="hs-identifier">tcg_env'</span></a></a><span>
</span><a name="line-1128"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289443"><a href="#local-1628289443"><span class="hs-identifier">grp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcg_rn_decls</span><span> </span><a href="#local-1628289440"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-1129"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289440"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_rn_decls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#appendGroups"><span class="hs-identifier hs-var">appendGroups</span></a><span> </span><a href="#local-1628289443"><span class="hs-identifier hs-var">grp</span></a><span> </span><a href="#local-1628289441"><span class="hs-identifier hs-var">rn_decls</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1130"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1131"></a><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289440"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">;</span><span>
</span><a name="line-1132"></a><span>
</span><a name="line-1133"></a><span>                </span><span class="hs-comment">-- Dump trace of renaming part</span><span>
</span><a name="line-1134"></a><span>        </span><a href="TcRnDriver.html#rnDump"><span class="hs-identifier hs-var">rnDump</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289441"><span class="hs-identifier hs-var">rn_decls</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1135"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289442"><span class="hs-identifier hs-var">tcg_env'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289441"><span class="hs-identifier hs-var">rn_decls</span></a><span class="hs-special">)</span><span>
</span><a name="line-1136"></a><span>   </span><span class="hs-special">}</span><span>
</span><a name="line-1137"></a><span>
</span><a name="line-1138"></a><span class="hs-identifier">tcTopSrcDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1139"></a><a name="tcTopSrcDecls"><a href="TcRnDriver.html#tcTopSrcDecls"><span class="hs-identifier">tcTopSrcDecls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289444"><a href="#local-1628289444"><span class="hs-identifier">tycl_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1140"></a><span>                         </span><span class="hs-identifier">hs_instds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289445"><a href="#local-1628289445"><span class="hs-identifier">inst_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1141"></a><span>                         </span><span class="hs-identifier">hs_derivds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289446"><a href="#local-1628289446"><span class="hs-identifier">deriv_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1142"></a><span>                         </span><span class="hs-identifier">hs_fords</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289447"><a href="#local-1628289447"><span class="hs-identifier">foreign_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1143"></a><span>                         </span><span class="hs-identifier">hs_defds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289448"><a href="#local-1628289448"><span class="hs-identifier">default_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1144"></a><span>                         </span><span class="hs-identifier">hs_annds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289449"><a href="#local-1628289449"><span class="hs-identifier">annotation_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1145"></a><span>                         </span><span class="hs-identifier">hs_ruleds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289450"><a href="#local-1628289450"><span class="hs-identifier">rule_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1146"></a><span>                         </span><span class="hs-identifier">hs_vects</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289451"><a href="#local-1628289451"><span class="hs-identifier">vect_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1147"></a><span>                         </span><span class="hs-identifier">hs_valds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289452"><a href="#local-1628289452"><span class="hs-identifier">hs_val_binds</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsOut"><span class="hs-identifier hs-var">ValBindsOut</span></a><span> </span><a name="local-1628289453"><a href="#local-1628289453"><span class="hs-identifier">val_binds</span></a></a><span> </span><a name="local-1628289454"><a href="#local-1628289454"><span class="hs-identifier">val_sigs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1148"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>         </span><span class="hs-comment">-- Type-check the type and class decls, and all imported decls</span><span>
</span><a name="line-1149"></a><span>                </span><span class="hs-comment">-- The latter come in via tycl_decls</span><span>
</span><a name="line-1150"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc2 (src)&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1151"></a><span>
</span><a name="line-1152"></a><span>                </span><span class="hs-comment">-- Source-language instances, including derivings,</span><span>
</span><a name="line-1153"></a><span>                </span><span class="hs-comment">-- and import the supporting declarations</span><span>
</span><a name="line-1154"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc3&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1155"></a><span>        </span><span class="hs-special">(</span><a name="local-1628289455"><a href="#local-1628289455"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289456"><a href="#local-1628289456"><span class="hs-identifier">inst_infos</span></a></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#ValBindsOut"><span class="hs-identifier hs-var">ValBindsOut</span></a><span> </span><a name="local-1628289457"><a href="#local-1628289457"><span class="hs-identifier">deriv_binds</span></a></a><span> </span><a name="local-1628289458"><a href="#local-1628289458"><span class="hs-identifier">deriv_sigs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1156"></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#tcTyClsInstDecls"><span class="hs-identifier hs-var">tcTyClsInstDecls</span></a><span> </span><a href="#local-1628289444"><span class="hs-identifier hs-var">tycl_decls</span></a><span> </span><a href="#local-1628289445"><span class="hs-identifier hs-var">inst_decls</span></a><span> </span><a href="#local-1628289446"><span class="hs-identifier hs-var">deriv_decls</span></a><span> </span><a href="#local-1628289453"><span class="hs-identifier hs-var">val_binds</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1157"></a><span>        </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628289455"><span class="hs-identifier hs-var">tcg_env</span></a><span>       </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1158"></a><span>
</span><a name="line-1159"></a><span>                </span><span class="hs-comment">-- Generate Applicative/Monad proposal (AMP) warnings</span><span>
</span><a name="line-1160"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc3b&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1161"></a><span>
</span><a name="line-1162"></a><span>                </span><span class="hs-comment">-- Generate Semigroup/Monoid warnings</span><span>
</span><a name="line-1163"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc3c&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1164"></a><span>        </span><a href="TcRnDriver.html#tcSemigroupWarnings"><span class="hs-identifier hs-var">tcSemigroupWarnings</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1165"></a><span>
</span><a name="line-1166"></a><span>                </span><span class="hs-comment">-- Foreign import declarations next.</span><span>
</span><a name="line-1167"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc4&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1168"></a><span>        </span><span class="hs-special">(</span><a name="local-1628289459"><a href="#local-1628289459"><span class="hs-identifier">fi_ids</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289460"><a href="#local-1628289460"><span class="hs-identifier">fi_decls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289461"><a href="#local-1628289461"><span class="hs-identifier">fi_gres</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcForeign.html#tcForeignImports"><span class="hs-identifier hs-var">tcForeignImports</span></a><span> </span><a href="#local-1628289447"><span class="hs-identifier hs-var">foreign_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1169"></a><span>        </span><a href="TcEnv.html#tcExtendGlobalValEnv"><span class="hs-identifier hs-var">tcExtendGlobalValEnv</span></a><span> </span><a href="#local-1628289459"><span class="hs-identifier hs-var">fi_ids</span></a><span>     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1170"></a><span>
</span><a name="line-1171"></a><span>                </span><span class="hs-comment">-- Default declarations</span><span>
</span><a name="line-1172"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc4a&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1173"></a><span>        </span><a name="local-1628289462"><a href="#local-1628289462"><span class="hs-identifier">default_tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcDefaults.html#tcDefaults"><span class="hs-identifier hs-var">tcDefaults</span></a><span> </span><a href="#local-1628289448"><span class="hs-identifier hs-var">default_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1174"></a><span>        </span><a href="TcRnMonad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628289463"><a href="#local-1628289463"><span class="hs-identifier">gbl</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628289463"><span class="hs-identifier hs-var">gbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_default</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289462"><span class="hs-identifier hs-var">default_tys</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1175"></a><span>
</span><a name="line-1176"></a><span>                </span><span class="hs-comment">-- Now GHC-generated derived bindings, generics, and selectors</span><span>
</span><a name="line-1177"></a><span>                </span><span class="hs-comment">-- Do not generate warnings from compiler-generated code;</span><span>
</span><a name="line-1178"></a><span>                </span><span class="hs-comment">-- hence the use of discardWarnings</span><span>
</span><a name="line-1179"></a><span>        </span><a name="local-1628289464"><a href="#local-1628289464"><span class="hs-identifier">tc_envs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#discardWarnings"><span class="hs-identifier hs-var">discardWarnings</span></a><span> </span><span class="hs-special">(</span><a href="TcBinds.html#tcTopBinds"><span class="hs-identifier hs-var">tcTopBinds</span></a><span> </span><a href="#local-1628289457"><span class="hs-identifier hs-var">deriv_binds</span></a><span> </span><a href="#local-1628289458"><span class="hs-identifier hs-var">deriv_sigs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1180"></a><span>        </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><a href="#local-1628289464"><span class="hs-identifier hs-var">tc_envs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1181"></a><span>
</span><a name="line-1182"></a><span>                </span><span class="hs-comment">-- Value declarations next</span><span>
</span><a name="line-1183"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc5&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1184"></a><span>        </span><a name="local-1628289465"><a href="#local-1628289465"><span class="hs-identifier">tc_envs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1628289466"><a href="#local-1628289466"><span class="hs-identifier">tcg_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289467"><a href="#local-1628289467"><span class="hs-identifier">tcl_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcTopBinds"><span class="hs-identifier hs-var">tcTopBinds</span></a><span> </span><a href="#local-1628289453"><span class="hs-identifier hs-var">val_binds</span></a><span> </span><a href="#local-1628289454"><span class="hs-identifier hs-var">val_sigs</span></a><span class="hs-special">;</span><span>
</span><a name="line-1185"></a><span>        </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><a href="#local-1628289465"><span class="hs-identifier hs-var">tc_envs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- Environment doesn't change now</span><span>
</span><a name="line-1186"></a><span>
</span><a name="line-1187"></a><span>                </span><span class="hs-comment">-- Second pass over class and instance declarations,</span><span>
</span><a name="line-1188"></a><span>                </span><span class="hs-comment">-- now using the kind-checked decls</span><span>
</span><a name="line-1189"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc6&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1190"></a><span>        </span><a name="local-1628289468"><a href="#local-1628289468"><span class="hs-identifier">inst_binds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcInstDcls.html#tcInstDecls2"><span class="hs-identifier hs-var">tcInstDecls2</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#tyClGroupConcat"><span class="hs-identifier hs-var">tyClGroupConcat</span></a><span> </span><a href="#local-1628289444"><span class="hs-identifier hs-var">tycl_decls</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289456"><span class="hs-identifier hs-var">inst_infos</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1191"></a><span>
</span><a name="line-1192"></a><span>                </span><span class="hs-comment">-- Foreign exports</span><span>
</span><a name="line-1193"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc7&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1194"></a><span>        </span><span class="hs-special">(</span><a name="local-1628289469"><a href="#local-1628289469"><span class="hs-identifier">foe_binds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289470"><a href="#local-1628289470"><span class="hs-identifier">foe_decls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289471"><a href="#local-1628289471"><span class="hs-identifier">foe_gres</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcForeign.html#tcForeignExports"><span class="hs-identifier hs-var">tcForeignExports</span></a><span> </span><a href="#local-1628289447"><span class="hs-identifier hs-var">foreign_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1195"></a><span>
</span><a name="line-1196"></a><span>                </span><span class="hs-comment">-- Annotations</span><span>
</span><a name="line-1197"></a><span>        </span><a name="local-1628289472"><a href="#local-1628289472"><span class="hs-identifier">annotations</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcAnnotations.html#tcAnnotations"><span class="hs-identifier hs-var">tcAnnotations</span></a><span> </span><a href="#local-1628289449"><span class="hs-identifier hs-var">annotation_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1198"></a><span>
</span><a name="line-1199"></a><span>                </span><span class="hs-comment">-- Rules</span><span>
</span><a name="line-1200"></a><span>        </span><a name="local-1628289473"><a href="#local-1628289473"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRules.html#tcRules"><span class="hs-identifier hs-var">tcRules</span></a><span> </span><a href="#local-1628289450"><span class="hs-identifier hs-var">rule_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1201"></a><span>
</span><a name="line-1202"></a><span>                </span><span class="hs-comment">-- Vectorisation declarations</span><span>
</span><a name="line-1203"></a><span>        </span><a name="local-1628289474"><a href="#local-1628289474"><span class="hs-identifier">vects</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcBinds.html#tcVectDecls"><span class="hs-identifier hs-var">tcVectDecls</span></a><span> </span><a href="#local-1628289451"><span class="hs-identifier hs-var">vect_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1204"></a><span>
</span><a name="line-1205"></a><span>                </span><span class="hs-comment">-- Wrap up</span><span>
</span><a name="line-1206"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Tc7a&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1207"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289475"><a href="#local-1628289475"><span class="hs-identifier">all_binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289468"><span class="hs-identifier hs-var">inst_binds</span></a><span>     </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span>
</span><a name="line-1208"></a><span>                          </span><a href="#local-1628289469"><span class="hs-identifier hs-var">foe_binds</span></a><span>
</span><a name="line-1209"></a><span>
</span><a name="line-1210"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628289476"><a href="#local-1628289476"><span class="hs-identifier">fo_gres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289461"><span class="hs-identifier hs-var">fi_gres</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289471"><span class="hs-identifier hs-var">foe_gres</span></a><span>
</span><a name="line-1211"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628289477"><a href="#local-1628289477"><span class="hs-identifier">fo_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#foldrBag"><span class="hs-identifier hs-var">foldrBag</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628289480"><a href="#local-1628289480"><span class="hs-identifier">gre</span></a></a><span> </span><a name="local-1628289481"><a href="#local-1628289481"><span class="hs-identifier">fvs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628289481"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#addOneFV"><span class="hs-identifier hs-var">addOneFV</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-1628289480"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span>
</span><a name="line-1212"></a><span>                                </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span> </span><a href="#local-1628289476"><span class="hs-identifier hs-var">fo_gres</span></a><span>
</span><a name="line-1213"></a><span>
</span><a name="line-1214"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628289478"><a href="#local-1628289478"><span class="hs-identifier">sig_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#collectHsValBinders"><span class="hs-identifier hs-var">collectHsValBinders</span></a><span> </span><a href="#local-1628289452"><span class="hs-identifier hs-var">hs_val_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1215"></a><span>                          </span><span class="hs-special">`</span><a href="NameSet.html#minusNameSet"><span class="hs-identifier hs-var">minusNameSet</span></a><span class="hs-special">`</span><span> </span><a href="TcEnv.html#getTypeSigNames"><span class="hs-identifier hs-var">getTypeSigNames</span></a><span> </span><a href="#local-1628289454"><span class="hs-identifier hs-var">val_sigs</span></a><span>
</span><a name="line-1216"></a><span>
</span><a name="line-1217"></a><span>                </span><span class="hs-comment">-- Extend the GblEnv with the (as yet un-zonked)</span><span>
</span><a name="line-1218"></a><span>                </span><span class="hs-comment">-- bindings, rules, foreign decls</span><span>
</span><a name="line-1219"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-1628289479"><a href="#local-1628289479"><span class="hs-identifier">tcg_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289466"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_binds</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_binds</span><span> </span><a href="#local-1628289466"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289475"><span class="hs-identifier hs-var">all_binds</span></a><span>
</span><a name="line-1220"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_sigs</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_sigs</span><span> </span><a href="#local-1628289466"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289478"><span class="hs-identifier hs-var">sig_names</span></a><span>
</span><a name="line-1221"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_rules</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_rules</span><span> </span><a href="#local-1628289466"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-1222"></a><span>                                                      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="HsDecls.html#flattenRuleDecls"><span class="hs-identifier hs-var">flattenRuleDecls</span></a><span> </span><a href="#local-1628289473"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-1223"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_vects</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_vects</span><span> </span><a href="#local-1628289466"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628289474"><span class="hs-identifier hs-var">vects</span></a><span>
</span><a name="line-1224"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_anns</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_anns</span><span> </span><a href="#local-1628289466"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628289472"><span class="hs-identifier hs-var">annotations</span></a><span>
</span><a name="line-1225"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_ann_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Annotations.html#extendAnnEnvList"><span class="hs-identifier hs-var">extendAnnEnvList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_ann_env</span><span> </span><a href="#local-1628289466"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289472"><span class="hs-identifier hs-var">annotations</span></a><span>
</span><a name="line-1226"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_fords</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_fords</span><span> </span><a href="#local-1628289466"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628289470"><span class="hs-identifier hs-var">foe_decls</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628289460"><span class="hs-identifier hs-var">fi_decls</span></a><span>
</span><a name="line-1227"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_dus</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_dus</span><span> </span><a href="#local-1628289466"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusDU"><span class="hs-identifier hs-var">plusDU</span></a><span class="hs-special">`</span><span> </span><a href="NameSet.html#usesOnly"><span class="hs-identifier hs-var">usesOnly</span></a><span> </span><a href="#local-1628289477"><span class="hs-identifier hs-var">fo_fvs</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1228"></a><span>                                 </span><span class="hs-comment">-- tcg_dus: see Note [Newtype constructor usage in foreign declarations]</span><span>
</span><a name="line-1229"></a><span>
</span><a name="line-1230"></a><span>        </span><span class="hs-comment">-- See Note [Newtype constructor usage in foreign declarations]</span><span>
</span><a name="line-1231"></a><span>        </span><a href="RnEnv.html#addUsedGREs"><span class="hs-identifier hs-var">addUsedGREs</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628289476"><span class="hs-identifier hs-var">fo_gres</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1232"></a><span>
</span><a name="line-1233"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289479"><span class="hs-identifier hs-var">tcg_env'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289467"><span class="hs-identifier hs-var">tcl_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1234"></a><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1235"></a><span>
</span><a name="line-1236"></a><span class="hs-identifier">tcTopSrcDecls</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tcTopSrcDecls: ValBindsIn&quot;</span><span>
</span><a name="line-1237"></a><span>
</span><a name="line-1238"></a><span>
</span><a name="line-1239"></a><span class="hs-identifier">tcSemigroupWarnings</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1240"></a><a name="tcSemigroupWarnings"><a href="TcRnDriver.html#tcSemigroupWarnings"><span class="hs-identifier">tcSemigroupWarnings</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1241"></a><span>    </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcSemigroupWarnings&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1242"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289482"><a href="#local-1628289482"><span class="hs-identifier">warnFlag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#Opt_WarnSemigroup"><span class="hs-identifier hs-var">Opt_WarnSemigroup</span></a><span>
</span><a name="line-1243"></a><span>    </span><a href="TcRnDriver.html#tcPreludeClashWarn"><span class="hs-identifier hs-var">tcPreludeClashWarn</span></a><span> </span><a href="#local-1628289482"><span class="hs-identifier hs-var">warnFlag</span></a><span> </span><a href="PrelNames.html#sappendName"><span class="hs-identifier hs-var">sappendName</span></a><span>
</span><a name="line-1244"></a><span>    </span><a href="TcRnDriver.html#tcMissingParentClassWarn"><span class="hs-identifier hs-var">tcMissingParentClassWarn</span></a><span> </span><a href="#local-1628289482"><span class="hs-identifier hs-var">warnFlag</span></a><span> </span><a href="PrelNames.html#monoidClassName"><span class="hs-identifier hs-var">monoidClassName</span></a><span> </span><a href="PrelNames.html#semigroupClassName"><span class="hs-identifier hs-var">semigroupClassName</span></a><span>
</span><a name="line-1245"></a><span>
</span><a name="line-1246"></a><span>
</span><a name="line-1247"></a><span class="hs-comment">-- | Warn on local definitions of names that would clash with future Prelude</span><span>
</span><a name="line-1248"></a><span class="hs-comment">-- elements.</span><span>
</span><a name="line-1249"></a><span class="hs-comment">--</span><span>
</span><a name="line-1250"></a><span class="hs-comment">--   A name clashes if the following criteria are met:</span><span>
</span><a name="line-1251"></a><span class="hs-comment">--       1. It would is imported (unqualified) from Prelude</span><span>
</span><a name="line-1252"></a><span class="hs-comment">--       2. It is locally defined in the current module</span><span>
</span><a name="line-1253"></a><span class="hs-comment">--       3. It has the same literal name as the reference function</span><span>
</span><a name="line-1254"></a><span class="hs-comment">--       4. It is not identical to the reference function</span><span>
</span><a name="line-1255"></a><span class="hs-identifier">tcPreludeClashWarn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a><span>
</span><a name="line-1256"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-1257"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1258"></a><a name="tcPreludeClashWarn"><a href="TcRnDriver.html#tcPreludeClashWarn"><span class="hs-identifier">tcPreludeClashWarn</span></a></a><span> </span><a name="local-1628289483"><a href="#local-1628289483"><span class="hs-identifier">warnFlag</span></a></a><span> </span><a name="local-1628289484"><a href="#local-1628289484"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1259"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="local-1628289501"><a href="#local-1628289501"><span class="hs-identifier">warn</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a><span> </span><a href="#local-1628289483"><span class="hs-identifier hs-var">warnFlag</span></a><span>
</span><a name="line-1260"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="#local-1628289501"><span class="hs-identifier hs-var">warn</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1261"></a><span>    </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcPreludeClashWarn/wouldBeImported&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1262"></a><span>    </span><span class="hs-comment">-- Is the name imported (unqualified) from Prelude? (Point 4 above)</span><span>
</span><a name="line-1263"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-1628289502"><a href="#local-1628289502"><span class="hs-identifier">rnImports</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">tcg_rn_imports</span><span class="hs-special">)</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-1264"></a><span>    </span><span class="hs-comment">-- (Note that this automatically handles -XNoImplicitPrelude, as Prelude</span><span>
</span><a name="line-1265"></a><span>    </span><span class="hs-comment">-- will not appear in rnImports automatically if it is set.)</span><span>
</span><a name="line-1266"></a><span>
</span><a name="line-1267"></a><span>    </span><span class="hs-comment">-- Continue only the name is imported from Prelude</span><span>
</span><a name="line-1268"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289485"><span class="hs-identifier hs-var">importedViaPrelude</span></a><span> </span><a href="#local-1628289484"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628289502"><span class="hs-identifier hs-var">rnImports</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1269"></a><span>      </span><span class="hs-comment">-- Handle 2.-4.</span><span>
</span><a name="line-1270"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="local-1628289503"><a href="#local-1628289503"><span class="hs-identifier">rdrElts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="OccName.html#occEnvElts"><span class="hs-identifier hs-var">occEnvElts</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">tcg_rdr_env</span><span class="hs-special">)</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-1271"></a><span>
</span><a name="line-1272"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">clashes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1273"></a><span>          </span><a name="local-1628289504"><a href="#local-1628289504"><span class="hs-identifier">clashes</span></a></a><span> </span><a name="local-1628289506"><a href="#local-1628289506"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289507"><span class="hs-identifier hs-var">isLocalDef</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1628289508"><span class="hs-identifier hs-var">nameClashes</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1628289509"><span class="hs-identifier hs-var">isNotInProperModule</span></a><span>
</span><a name="line-1274"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-1275"></a><span>              </span><a name="local-1628289507"><a href="#local-1628289507"><span class="hs-identifier">isLocalDef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><a href="#local-1628289506"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1276"></a><span>              </span><span class="hs-comment">-- Names are identical ...</span><span>
</span><a name="line-1277"></a><span>              </span><a name="local-1628289508"><a href="#local-1628289508"><span class="hs-identifier">nameClashes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-1628289506"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1628289484"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1278"></a><span>              </span><span class="hs-comment">-- ... but not the actual definitions, because we don't want to</span><span>
</span><a name="line-1279"></a><span>              </span><span class="hs-comment">-- warn about a bad definition of e.g. &lt;&gt; in Data.Semigroup, which</span><span>
</span><a name="line-1280"></a><span>              </span><span class="hs-comment">-- is the (only) proper place where this should be defined</span><span>
</span><a name="line-1281"></a><span>              </span><a name="local-1628289509"><a href="#local-1628289509"><span class="hs-identifier">isNotInProperModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-1628289506"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1628289484"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1282"></a><span>
</span><a name="line-1283"></a><span>          </span><span class="hs-comment">-- List of all offending definitions</span><span>
</span><a name="line-1284"></a><span>          </span><span class="hs-identifier">clashingElts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span>
</span><a name="line-1285"></a><span>          </span><a name="local-1628289505"><a href="#local-1628289505"><span class="hs-identifier">clashingElts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-1628289504"><span class="hs-identifier hs-var">clashes</span></a><span> </span><a href="#local-1628289503"><span class="hs-identifier hs-var">rdrElts</span></a><span>
</span><a name="line-1286"></a><span>
</span><a name="line-1287"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcPreludeClashWarn/prelude_functions&quot;</span><span>
</span><a name="line-1288"></a><span>                </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289484"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289505"><span class="hs-identifier hs-var">clashingElts</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1289"></a><span>
</span><a name="line-1290"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289510"><a href="#local-1628289510"><span class="hs-identifier">warn_msg</span></a></a><span> </span><a name="local-1628289511"><a href="#local-1628289511"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addWarnAt"><span class="hs-identifier hs-var">addWarnAt</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="#local-1628289483"><span class="hs-identifier hs-var">warnFlag</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-1628289511"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span>
</span><a name="line-1291"></a><span>              </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Local definition of&quot;</span><span>
</span><a name="line-1292"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">gre_name</span><span class="hs-special">)</span><span> </span><a href="#local-1628289511"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1293"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;clashes with a future Prelude name.&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1294"></a><span>              </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-1295"></a><span>              </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;This will become an error in a future release.&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1296"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="#local-1628289510"><span class="hs-identifier hs-var">warn_msg</span></a><span> </span><a href="#local-1628289505"><span class="hs-identifier hs-var">clashingElts</span></a><span>
</span><a name="line-1297"></a><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1298"></a><span>
</span><a name="line-1299"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1300"></a><span>
</span><a name="line-1301"></a><span>    </span><span class="hs-comment">-- Is the given name imported via Prelude?</span><span>
</span><a name="line-1302"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-1303"></a><span>    </span><span class="hs-comment">-- Possible scenarios:</span><span>
</span><a name="line-1304"></a><span>    </span><span class="hs-comment">--   a) Prelude is imported implicitly, issue warnings.</span><span>
</span><a name="line-1305"></a><span>    </span><span class="hs-comment">--   b) Prelude is imported explicitly, but without mentioning the name in</span><span>
</span><a name="line-1306"></a><span>    </span><span class="hs-comment">--      question. Issue no warnings.</span><span>
</span><a name="line-1307"></a><span>    </span><span class="hs-comment">--   c) Prelude is imported hiding the name in question. Issue no warnings.</span><span>
</span><a name="line-1308"></a><span>    </span><span class="hs-comment">--   d) Qualified import of Prelude, no warnings.</span><span>
</span><a name="line-1309"></a><span>    </span><span class="hs-identifier">importedViaPrelude</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-1310"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1311"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1312"></a><span>    </span><a name="local-1628289485"><a href="#local-1628289485"><span class="hs-identifier">importedViaPrelude</span></a></a><span> </span><a name="local-1628289486"><a href="#local-1628289486"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><a href="#local-1628289492"><span class="hs-identifier hs-var">importViaPrelude</span></a><span>
</span><a name="line-1313"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1314"></a><span>        </span><span class="hs-identifier">isPrelude</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1315"></a><span>        </span><a name="local-1628289487"><a href="#local-1628289487"><span class="hs-identifier">isPrelude</span></a></a><span> </span><a name="local-1628289493"><a href="#local-1628289493"><span class="hs-identifier">imp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ideclName</span><span> </span><a href="#local-1628289493"><span class="hs-identifier hs-var">imp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#pRELUDE_NAME"><span class="hs-identifier hs-var">pRELUDE_NAME</span></a><span>
</span><a name="line-1316"></a><span>
</span><a name="line-1317"></a><span>        </span><span class="hs-comment">-- Implicit (Prelude) import?</span><span>
</span><a name="line-1318"></a><span>        </span><span class="hs-identifier">isImplicit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1319"></a><span>        </span><a name="local-1628289488"><a href="#local-1628289488"><span class="hs-identifier">isImplicit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ideclImplicit</span><span>
</span><a name="line-1320"></a><span>
</span><a name="line-1321"></a><span>        </span><span class="hs-comment">-- Unqualified import?</span><span>
</span><a name="line-1322"></a><span>        </span><span class="hs-identifier">isUnqualified</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1323"></a><span>        </span><a name="local-1628289489"><a href="#local-1628289489"><span class="hs-identifier">isUnqualified</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">ideclQualified</span><span>
</span><a name="line-1324"></a><span>
</span><a name="line-1325"></a><span>        </span><span class="hs-comment">-- List of explicitly imported (or hidden) Names from a single import.</span><span>
</span><a name="line-1326"></a><span>        </span><span class="hs-comment">--   Nothing -&gt; No explicit imports</span><span>
</span><a name="line-1327"></a><span>        </span><span class="hs-comment">--   Just (False, &lt;names&gt;) -&gt; Explicit import list of &lt;names&gt;</span><span>
</span><a name="line-1328"></a><span>        </span><span class="hs-comment">--   Just (True , &lt;names&gt;) -&gt; Explicit hiding of &lt;names&gt;</span><span>
</span><a name="line-1329"></a><span>        </span><span class="hs-identifier">importListOf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1330"></a><span>        </span><a name="local-1628289490"><a href="#local-1628289490"><span class="hs-identifier">importListOf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="#local-1628289494"><span class="hs-identifier hs-var">toImportList</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">ideclHiding</span><span>
</span><a name="line-1331"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-1332"></a><span>            </span><a name="local-1628289494"><a href="#local-1628289494"><span class="hs-identifier">toImportList</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628289495"><a href="#local-1628289495"><span class="hs-identifier">h</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289496"><a href="#local-1628289496"><span class="hs-identifier">loc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628289495"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="HsImpExp.html#ieName"><span class="hs-identifier hs-var">ieName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-1628289496"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1333"></a><span>
</span><a name="line-1334"></a><span>        </span><span class="hs-identifier">isExplicit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1335"></a><span>        </span><a name="local-1628289491"><a href="#local-1628289491"><span class="hs-identifier">isExplicit</span></a></a><span> </span><a name="local-1628289497"><a href="#local-1628289497"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628289490"><span class="hs-identifier hs-var">importListOf</span></a><span> </span><a href="#local-1628289497"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1336"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1337"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><a name="local-1628289498"><a href="#local-1628289498"><span class="hs-identifier">explicit</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1338"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1628289486"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1628289498"><span class="hs-identifier hs-var">explicit</span></a><span>
</span><a name="line-1339"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a name="local-1628289499"><a href="#local-1628289499"><span class="hs-identifier">hidden</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1340"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1628289486"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#notElem"><span class="hs-identifier hs-var">notElem</span></a><span class="hs-special">`</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1628289499"><span class="hs-identifier hs-var">hidden</span></a><span>
</span><a name="line-1341"></a><span>
</span><a name="line-1342"></a><span>        </span><span class="hs-comment">-- Check whether the given name would be imported (unqualified) from</span><span>
</span><a name="line-1343"></a><span>        </span><span class="hs-comment">-- an import declaration.</span><span>
</span><a name="line-1344"></a><span>        </span><span class="hs-identifier">importViaPrelude</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1345"></a><span>        </span><a name="local-1628289492"><a href="#local-1628289492"><span class="hs-identifier">importViaPrelude</span></a></a><span> </span><a name="local-1628289500"><a href="#local-1628289500"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289487"><span class="hs-identifier hs-var">isPrelude</span></a><span> </span><a href="#local-1628289500"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1346"></a><span>                          </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1628289489"><span class="hs-identifier hs-var">isUnqualified</span></a><span> </span><a href="#local-1628289500"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1347"></a><span>                          </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-1628289488"><span class="hs-identifier hs-var">isImplicit</span></a><span> </span><a href="#local-1628289500"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1628289491"><span class="hs-identifier hs-var">isExplicit</span></a><span> </span><a href="#local-1628289500"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1348"></a><span>
</span><a name="line-1349"></a><span>
</span><a name="line-1350"></a><span class="hs-comment">-- Notation: is* is for classes the type is an instance of, should* for those</span><span>
</span><a name="line-1351"></a><span class="hs-comment">--           that it should also be an instance of based on the corresponding</span><span>
</span><a name="line-1352"></a><span class="hs-comment">--           is*.</span><span>
</span><a name="line-1353"></a><span class="hs-identifier">tcMissingParentClassWarn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a><span>
</span><a name="line-1354"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-comment">-- ^ Instances of this ...</span><span>
</span><a name="line-1355"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-comment">-- ^ should also be instances of this</span><span>
</span><a name="line-1356"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1357"></a><a name="tcMissingParentClassWarn"><a href="TcRnDriver.html#tcMissingParentClassWarn"><span class="hs-identifier">tcMissingParentClassWarn</span></a></a><span> </span><a name="local-1628289512"><a href="#local-1628289512"><span class="hs-identifier">warnFlag</span></a></a><span> </span><a name="local-1628289513"><a href="#local-1628289513"><span class="hs-identifier">isName</span></a></a><span> </span><a name="local-1628289514"><a href="#local-1628289514"><span class="hs-identifier">shouldName</span></a></a><span>
</span><a name="line-1358"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289530"><a href="#local-1628289530"><span class="hs-identifier">warn</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a><span> </span><a href="#local-1628289512"><span class="hs-identifier hs-var">warnFlag</span></a><span>
</span><a name="line-1359"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="#local-1628289530"><span class="hs-identifier hs-var">warn</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1360"></a><span>       </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcMissingParentClassWarn&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1361"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628289531"><a href="#local-1628289531"><span class="hs-identifier">isClass'</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289516"><span class="hs-identifier hs-var">tcLookupClass_maybe</span></a><span> </span><a href="#local-1628289513"><span class="hs-identifier hs-var">isName</span></a><span>
</span><a name="line-1362"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628289532"><a href="#local-1628289532"><span class="hs-identifier">shouldClass'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289516"><span class="hs-identifier hs-var">tcLookupClass_maybe</span></a><span> </span><a href="#local-1628289514"><span class="hs-identifier hs-var">shouldName</span></a><span>
</span><a name="line-1363"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-1628289531"><span class="hs-identifier hs-var">isClass'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289532"><span class="hs-identifier hs-var">shouldClass'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1364"></a><span>              </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289533"><a href="#local-1628289533"><span class="hs-identifier">isClass</span></a></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289534"><a href="#local-1628289534"><span class="hs-identifier">shouldClass</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1365"></a><span>                  </span><span class="hs-special">{</span><span> </span><a name="local-1628289535"><a href="#local-1628289535"><span class="hs-identifier">localInstances</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#tcGetInsts"><span class="hs-identifier hs-var">tcGetInsts</span></a><span>
</span><a name="line-1366"></a><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289536"><a href="#local-1628289536"><span class="hs-identifier">isInstance</span></a></a><span> </span><a name="local-1628289538"><a href="#local-1628289538"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">is_cls</span><span> </span><a href="#local-1628289538"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628289533"><span class="hs-identifier hs-var">isClass</span></a><span>
</span><a name="line-1367"></a><span>                        </span><a name="local-1628289537"><a href="#local-1628289537"><span class="hs-identifier">isInsts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-1628289536"><span class="hs-identifier hs-var">isInstance</span></a><span> </span><a href="#local-1628289535"><span class="hs-identifier hs-var">localInstances</span></a><span>
</span><a name="line-1368"></a><span>                  </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcMissingParentClassWarn/isInsts&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289537"><span class="hs-identifier hs-var">isInsts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1369"></a><span>                  </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><a href="#local-1628289537"><span class="hs-identifier hs-var">isInsts</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289515"><span class="hs-identifier hs-var">checkShouldInst</span></a><span> </span><a href="#local-1628289533"><span class="hs-identifier hs-var">isClass</span></a><span> </span><a href="#local-1628289534"><span class="hs-identifier hs-var">shouldClass</span></a><span class="hs-special">)</span><span>
</span><a name="line-1370"></a><span>                  </span><span class="hs-special">}</span><span>
</span><a name="line-1371"></a><span>              </span><span class="hs-special">(</span><a name="local-1628289539"><a href="#local-1628289539"><span class="hs-identifier">is'</span></a></a><span class="hs-special">,</span><a name="local-1628289540"><a href="#local-1628289540"><span class="hs-identifier">should'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1372"></a><span>                  </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcMissingParentClassWarn/notIsShould&quot;</span><span>
</span><a name="line-1373"></a><span>                          </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289513"><span class="hs-identifier hs-var">isName</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;/&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289514"><span class="hs-identifier hs-var">shouldName</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1374"></a><span>                            </span><span class="hs-special">(</span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Is&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;lookup for&quot;</span><span>
</span><a name="line-1375"></a><span>                                  </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289513"><span class="hs-identifier hs-var">isName</span></a><span>
</span><a name="line-1376"></a><span>                                  </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;resulted in&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289539"><span class="hs-identifier hs-var">is'</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1377"></a><span>                            </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-1378"></a><span>                            </span><span class="hs-special">(</span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Should&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;lookup for&quot;</span><span>
</span><a name="line-1379"></a><span>                                  </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289514"><span class="hs-identifier hs-var">shouldName</span></a><span>
</span><a name="line-1380"></a><span>                                  </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;resulted in&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289540"><span class="hs-identifier hs-var">should'</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1381"></a><span>       </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1382"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1383"></a><span>    </span><span class="hs-comment">-- Check whether the desired superclass exists in a given environment.</span><span>
</span><a name="line-1384"></a><span>    </span><span class="hs-identifier">checkShouldInst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span>   </span><span class="hs-comment">-- ^ Class of existing instance</span><span>
</span><a name="line-1385"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span>   </span><span class="hs-comment">-- ^ Class there should be an instance of</span><span>
</span><a name="line-1386"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span> </span><span class="hs-comment">-- ^ Existing instance</span><span>
</span><a name="line-1387"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1388"></a><span>    </span><a name="local-1628289515"><a href="#local-1628289515"><span class="hs-identifier">checkShouldInst</span></a></a><span> </span><a name="local-1628289517"><a href="#local-1628289517"><span class="hs-identifier">isClass</span></a></a><span> </span><a name="local-1628289518"><a href="#local-1628289518"><span class="hs-identifier">shouldClass</span></a></a><span> </span><a name="local-1628289519"><a href="#local-1628289519"><span class="hs-identifier">isInst</span></a></a><span>
</span><a name="line-1389"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289520"><a href="#local-1628289520"><span class="hs-identifier">instEnv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcGetInstEnvs"><span class="hs-identifier hs-var">tcGetInstEnvs</span></a><span>
</span><a name="line-1390"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628289521"><a href="#local-1628289521"><span class="hs-identifier">instanceMatches</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289522"><a href="#local-1628289522"><span class="hs-identifier">shouldInsts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1391"></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#lookupInstEnv"><span class="hs-identifier hs-var">lookupInstEnv</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1628289520"><span class="hs-identifier hs-var">instEnv</span></a><span> </span><a href="#local-1628289518"><span class="hs-identifier hs-var">shouldClass</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_tys</span><span> </span><a href="#local-1628289519"><span class="hs-identifier hs-var">isInst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1392"></a><span>
</span><a name="line-1393"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcMissingParentClassWarn/checkShouldInst&quot;</span><span>
</span><a name="line-1394"></a><span>                     </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289519"><span class="hs-identifier hs-var">isInst</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-1395"></a><span>                         </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289521"><span class="hs-identifier hs-var">instanceMatches</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289522"><span class="hs-identifier hs-var">shouldInsts</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1396"></a><span>
</span><a name="line-1397"></a><span>           </span><span class="hs-comment">-- &quot;&lt;location&gt;: Warning: &lt;type&gt; is an instance of &lt;is&gt; but not</span><span>
</span><a name="line-1398"></a><span>           </span><span class="hs-comment">-- &lt;should&gt;&quot; e.g. &quot;Foo is an instance of Monad but not Applicative&quot;</span><span>
</span><a name="line-1399"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289523"><a href="#local-1628289523"><span class="hs-identifier">instLoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#srcLocSpan"><span class="hs-identifier hs-var">srcLocSpan</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Name.html#nameSrcLoc"><span class="hs-identifier hs-var">nameSrcLoc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-1628289519"><span class="hs-identifier hs-var">isInst</span></a><span>
</span><a name="line-1400"></a><span>                 </span><a name="local-1628289524"><a href="#local-1628289524"><span class="hs-identifier">warnMsg</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289525"><a href="#local-1628289525"><span class="hs-identifier">name</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1401"></a><span>                      </span><a href="TcRnMonad.html#addWarnAt"><span class="hs-identifier hs-var">addWarnAt</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="#local-1628289512"><span class="hs-identifier hs-var">warnFlag</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289523"><span class="hs-identifier hs-var">instLoc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1402"></a><span>                           </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289525"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1403"></a><span>                                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is an instance of&quot;</span><span>
</span><a name="line-1404"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">className</span><span class="hs-special">)</span><span> </span><a href="#local-1628289517"><span class="hs-identifier hs-var">isClass</span></a><span>
</span><a name="line-1405"></a><span>                                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;but not&quot;</span><span>
</span><a name="line-1406"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">className</span><span class="hs-special">)</span><span> </span><a href="#local-1628289518"><span class="hs-identifier hs-var">shouldClass</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1407"></a><span>                                </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;.&quot;</span><span>
</span><a name="line-1408"></a><span>                           </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-1409"></a><span>                           </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;This will become an error in&quot;</span><span>
</span><a name="line-1410"></a><span>                                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a future release.&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1411"></a><span>                 </span><span class="hs-identifier">warnMsg</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1412"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628289522"><span class="hs-identifier hs-var">shouldInsts</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628289521"><span class="hs-identifier hs-var">instanceMatches</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1413"></a><span>                  </span><a href="#local-1628289524"><span class="hs-identifier hs-var">warnMsg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_tcs</span><span> </span><a href="#local-1628289519"><span class="hs-identifier hs-var">isInst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1414"></a><span>           </span><span class="hs-special">}</span><span>
</span><a name="line-1415"></a><span>
</span><a name="line-1416"></a><span>    </span><span class="hs-identifier">tcLookupClass_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">)</span><span>
</span><a name="line-1417"></a><span>    </span><a name="local-1628289516"><a href="#local-1628289516"><span class="hs-identifier">tcLookupClass_maybe</span></a></a><span> </span><a name="local-1628289526"><a href="#local-1628289526"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LoadIface.html#tcLookupImported_maybe"><span class="hs-identifier hs-var">tcLookupImported_maybe</span></a><span> </span><a href="#local-1628289526"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-1418"></a><span>        </span><a href="Maybes.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-1628289527"><a href="#local-1628289527"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628289528"><a href="#local-1628289528"><span class="hs-identifier">cls</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="#local-1628289527"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a><span> </span><a href="#local-1628289528"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-1419"></a><span>        </span><a name="local-1628289529"><a href="#local-1628289529"><span class="hs-identifier">_else</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1420"></a><span>
</span><a name="line-1421"></a><span>
</span><a name="line-1422"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1423"></a><span class="hs-identifier">tcTyClsInstDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1424"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LInstDecl"><span class="hs-identifier hs-type">LInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1425"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LDerivDecl"><span class="hs-identifier hs-type">LDerivDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1426"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span class="hs-special">,</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1427"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- The full inst env</span><span>
</span><a name="line-1428"></a><span>                         </span><span class="hs-special">[</span><a href="TcEnv.html#InstInfo"><span class="hs-identifier hs-type">InstInfo</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Source-code instance decls to process;</span><span>
</span><a name="line-1429"></a><span>                                              </span><span class="hs-comment">-- contains all dfuns for this module</span><span>
</span><a name="line-1430"></a><span>                          </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Supporting bindings for derived instances</span><span>
</span><a name="line-1431"></a><span>
</span><a name="line-1432"></a><a name="tcTyClsInstDecls"><a href="TcRnDriver.html#tcTyClsInstDecls"><span class="hs-identifier">tcTyClsInstDecls</span></a></a><span> </span><a name="local-1628289541"><a href="#local-1628289541"><span class="hs-identifier">tycl_decls</span></a></a><span> </span><a name="local-1628289542"><a href="#local-1628289542"><span class="hs-identifier">inst_decls</span></a></a><span> </span><a name="local-1628289543"><a href="#local-1628289543"><span class="hs-identifier">deriv_decls</span></a></a><span> </span><a name="local-1628289544"><a href="#local-1628289544"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-1433"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcEnv.html#tcAddDataFamConPlaceholders"><span class="hs-identifier hs-var">tcAddDataFamConPlaceholders</span></a><span> </span><a href="#local-1628289542"><span class="hs-identifier hs-var">inst_decls</span></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1434"></a><span>   </span><a href="TcEnv.html#tcAddPatSynPlaceholders"><span class="hs-identifier hs-var">tcAddPatSynPlaceholders</span></a><span> </span><span class="hs-special">(</span><a href="TcEnv.html#getPatSynBinds"><span class="hs-identifier hs-var">getPatSynBinds</span></a><span> </span><a href="#local-1628289544"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1435"></a><span>   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289545"><a href="#local-1628289545"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcTyClsDecls.html#tcTyAndClassDecls"><span class="hs-identifier hs-var">tcTyAndClassDecls</span></a><span> </span><a href="#local-1628289541"><span class="hs-identifier hs-var">tycl_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1436"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a><span> </span><a href="#local-1628289545"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1437"></a><span>        </span><a href="TcInstDcls.html#tcInstDecls1"><span class="hs-identifier hs-var">tcInstDecls1</span></a><span> </span><a href="#local-1628289541"><span class="hs-identifier hs-var">tycl_decls</span></a><span> </span><a href="#local-1628289542"><span class="hs-identifier hs-var">inst_decls</span></a><span> </span><a href="#local-1628289543"><span class="hs-identifier hs-var">deriv_decls</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1438"></a><span>
</span><a name="line-1439"></a><span>
</span><a name="line-1440"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
        Checking for 'main'
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1446"></a><span>
</span><a name="line-1447"></a><span class="hs-identifier">checkMain</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>  </span><span class="hs-comment">-- False =&gt; no 'module M(..) where' header at all</span><span>
</span><a name="line-1448"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-1449"></a><span class="hs-comment">-- If we are in module Main, check that 'main' is defined.</span><span>
</span><a name="line-1450"></a><a name="checkMain"><a href="TcRnDriver.html#checkMain"><span class="hs-identifier">checkMain</span></a></a><span> </span><a name="local-1628289546"><a href="#local-1628289546"><span class="hs-identifier">explicit_mod_hdr</span></a></a><span>
</span><a name="line-1451"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-special">{</span><span> </span><a name="local-1628289547"><a href="#local-1628289547"><span class="hs-identifier">dflags</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-1452"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289548"><a href="#local-1628289548"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-1453"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnDriver.html#check_main"><span class="hs-identifier hs-var">check_main</span></a><span> </span><a href="#local-1628289547"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628289548"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><a href="#local-1628289546"><span class="hs-identifier hs-var">explicit_mod_hdr</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1454"></a><span>
</span><a name="line-1455"></a><span class="hs-identifier">check_main</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-1456"></a><a name="check_main"><a href="TcRnDriver.html#check_main"><span class="hs-identifier">check_main</span></a></a><span> </span><a name="local-1628289549"><a href="#local-1628289549"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1628289550"><a href="#local-1628289550"><span class="hs-identifier">tcg_env</span></a></a><span> </span><a name="local-1628289551"><a href="#local-1628289551"><span class="hs-identifier">explicit_mod_hdr</span></a></a><span>
</span><a name="line-1457"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628289552"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1628289553"><span class="hs-identifier hs-var">main_mod</span></a><span>
</span><a name="line-1458"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;checkMain not&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289553"><span class="hs-identifier hs-var">main_mod</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289552"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a><span>
</span><a name="line-1459"></a><span>   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289550"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-1460"></a><span>
</span><a name="line-1461"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1462"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-special">{</span><span> </span><a name="local-1628289560"><a href="#local-1628289560"><span class="hs-identifier">mb_main</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupGlobalOccRn_maybe"><span class="hs-identifier hs-var">lookupGlobalOccRn_maybe</span></a><span> </span><a href="#local-1628289554"><span class="hs-identifier hs-var">main_fn</span></a><span>
</span><a name="line-1463"></a><span>                </span><span class="hs-comment">-- Check that 'main' is in scope</span><span>
</span><a name="line-1464"></a><span>                </span><span class="hs-comment">-- It might be imported from another module!</span><span>
</span><a name="line-1465"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628289560"><span class="hs-identifier hs-var">mb_main</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1466"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;checkMain fail&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289553"><span class="hs-identifier hs-var">main_mod</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289554"><span class="hs-identifier hs-var">main_fn</span></a><span class="hs-special">)</span><span>
</span><a name="line-1467"></a><span>                           </span><span class="hs-special">;</span><span> </span><a href="#local-1628289556"><span class="hs-identifier hs-var">complain_no_main</span></a><span>
</span><a name="line-1468"></a><span>                           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289550"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1469"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289561"><a href="#local-1628289561"><span class="hs-identifier">main_name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1470"></a><span>
</span><a name="line-1471"></a><span>        </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;checkMain found&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289553"><span class="hs-identifier hs-var">main_mod</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289554"><span class="hs-identifier hs-var">main_fn</span></a><span class="hs-special">)</span><span>
</span><a name="line-1472"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289562"><a href="#local-1628289562"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#srcLocSpan"><span class="hs-identifier hs-var">srcLocSpan</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getSrcLoc"><span class="hs-identifier hs-var">getSrcLoc</span></a><span> </span><a href="#local-1628289561"><span class="hs-identifier hs-var">main_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1473"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289563"><a href="#local-1628289563"><span class="hs-identifier">ioTyCon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a><span> </span><a href="PrelNames.html#ioTyConName"><span class="hs-identifier hs-var">ioTyConName</span></a><span>
</span><a name="line-1474"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289564"><a href="#local-1628289564"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-1475"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289565"><a href="#local-1628289565"><span class="hs-identifier">main_expr</span></a></a><span>
</span><a name="line-1476"></a><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><a href="#local-1628289557"><span class="hs-identifier hs-var">mainCtxt</span></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1477"></a><span>                   </span><a href="TcExpr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628289562"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628289562"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628289561"><span class="hs-identifier hs-var">main_name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1478"></a><span>                                            </span><span class="hs-special">(</span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1479"></a><span>                                             </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628289563"><span class="hs-identifier hs-var">ioTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289564"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1480"></a><span>
</span><a name="line-1481"></a><span>                </span><span class="hs-comment">-- See Note [Root-main Id]</span><span>
</span><a name="line-1482"></a><span>                </span><span class="hs-comment">-- Construct the binding</span><span>
</span><a name="line-1483"></a><span>                </span><span class="hs-comment">--      :Main.main :: IO res_ty = runMainIO res_ty main</span><span>
</span><a name="line-1484"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289566"><a href="#local-1628289566"><span class="hs-identifier">run_main_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a><span> </span><a href="PrelNames.html#runMainIOName"><span class="hs-identifier hs-var">runMainIOName</span></a><span>
</span><a name="line-1485"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289567"><a href="#local-1628289567"><span class="hs-identifier">root_main_name</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="Name.html#mkExternalName"><span class="hs-identifier hs-var">mkExternalName</span></a><span> </span><a href="PrelNames.html#rootMainKey"><span class="hs-identifier hs-var">rootMainKey</span></a><span> </span><a href="PrelNames.html#rOOT_MAIN"><span class="hs-identifier hs-var">rOOT_MAIN</span></a><span>
</span><a name="line-1486"></a><span>                                   </span><span class="hs-special">(</span><a href="OccName.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;main&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1487"></a><span>                                   </span><span class="hs-special">(</span><a href="Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a><span> </span><a href="#local-1628289561"><span class="hs-identifier hs-var">main_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1488"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-1628289568"><a href="#local-1628289568"><span class="hs-identifier">root_main_id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkExportedVanillaId"><span class="hs-identifier hs-var">Id</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mkExportedVanillaId</span></a><span> </span><a href="#local-1628289567"><span class="hs-identifier hs-var">root_main_name</span></a><span>
</span><a name="line-1489"></a><span>                                                      </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628289563"><span class="hs-identifier hs-var">ioTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289564"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1490"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-1628289569"><a href="#local-1628289569"><span class="hs-identifier">co</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcEvidence.html#mkWpTyApps"><span class="hs-identifier hs-var">mkWpTyApps</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289564"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-1491"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-1628289570"><a href="#local-1628289570"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a><span> </span><a href="#local-1628289569"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a><span> </span><a href="#local-1628289566"><span class="hs-identifier hs-var">run_main_id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628289565"><span class="hs-identifier hs-var">main_expr</span></a><span>
</span><a name="line-1492"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-1628289571"><a href="#local-1628289571"><span class="hs-identifier">main_bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#mkVarBind"><span class="hs-identifier hs-var">mkVarBind</span></a><span> </span><a href="#local-1628289568"><span class="hs-identifier hs-var">root_main_id</span></a><span> </span><a href="#local-1628289570"><span class="hs-identifier hs-var">rhs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1493"></a><span>
</span><a name="line-1494"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289550"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_main</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628289561"><span class="hs-identifier hs-var">main_name</span></a><span class="hs-special">,</span><span>
</span><a name="line-1495"></a><span>                            </span><span class="hs-identifier">tcg_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_binds</span><span> </span><a href="#local-1628289550"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-1496"></a><span>                                        </span><span class="hs-special">`</span><a href="Bag.html#snocBag"><span class="hs-identifier hs-var">snocBag</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628289571"><span class="hs-identifier hs-var">main_bind</span></a><span class="hs-special">,</span><span>
</span><a name="line-1497"></a><span>                            </span><span class="hs-identifier">tcg_dus</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_dus</span><span> </span><a href="#local-1628289550"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-1498"></a><span>                                        </span><span class="hs-special">`</span><a href="NameSet.html#plusDU"><span class="hs-identifier hs-var">plusDU</span></a><span class="hs-special">`</span><span> </span><a href="NameSet.html#usesOnly"><span class="hs-identifier hs-var">usesOnly</span></a><span> </span><span class="hs-special">(</span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span> </span><a href="#local-1628289561"><span class="hs-identifier hs-var">main_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1499"></a><span>                        </span><span class="hs-comment">-- Record the use of 'main', so that we don't</span><span>
</span><a name="line-1500"></a><span>                        </span><span class="hs-comment">-- complain about it being defined but not used</span><span>
</span><a name="line-1501"></a><span>                 </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1502"></a><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1503"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1504"></a><span>    </span><a name="local-1628289552"><a href="#local-1628289552"><span class="hs-identifier">mod</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_mod</span><span> </span><a href="#local-1628289550"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-1505"></a><span>    </span><a name="local-1628289553"><a href="#local-1628289553"><span class="hs-identifier">main_mod</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mainModIs</span><span> </span><a href="#local-1628289549"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1506"></a><span>    </span><a name="local-1628289554"><a href="#local-1628289554"><span class="hs-identifier">main_fn</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#getMainFun"><span class="hs-identifier hs-var">getMainFun</span></a><span> </span><a href="#local-1628289549"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1507"></a><span>    </span><a name="local-1628289555"><a href="#local-1628289555"><span class="hs-identifier">interactive</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ghcLink</span><span> </span><a href="#local-1628289549"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="DynFlags.html#LinkInMemory"><span class="hs-identifier hs-var">LinkInMemory</span></a><span>
</span><a name="line-1508"></a><span>
</span><a name="line-1509"></a><span>    </span><a name="local-1628289556"><a href="#local-1628289556"><span class="hs-identifier">complain_no_main</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289555"><span class="hs-identifier hs-var">interactive</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1628289551"><span class="hs-identifier hs-var">explicit_mod_hdr</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289558"><span class="hs-identifier hs-var">noMainMsg</span></a><span>
</span><a name="line-1510"></a><span>        </span><span class="hs-comment">-- In interactive mode, without an explicit module header, don't</span><span>
</span><a name="line-1511"></a><span>        </span><span class="hs-comment">-- worry about the absence of 'main'.</span><span>
</span><a name="line-1512"></a><span>        </span><span class="hs-comment">-- In other modes, fail altogether, so that we don't go on</span><span>
</span><a name="line-1513"></a><span>        </span><span class="hs-comment">-- and complain a second time when processing the export list.</span><span>
</span><a name="line-1514"></a><span>
</span><a name="line-1515"></a><span>    </span><a name="local-1628289557"><a href="#local-1628289557"><span class="hs-identifier">mainCtxt</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;When checking the type of the&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289559"><span class="hs-identifier hs-var">pp_main_fn</span></a><span>
</span><a name="line-1516"></a><span>    </span><a name="local-1628289558"><a href="#local-1628289558"><span class="hs-identifier">noMainMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628289559"><span class="hs-identifier hs-var">pp_main_fn</span></a><span>
</span><a name="line-1517"></a><span>                </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is not defined in module&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289553"><span class="hs-identifier hs-var">main_mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-1518"></a><span>    </span><a name="local-1628289559"><a href="#local-1628289559"><span class="hs-identifier">pp_main_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#ppMainFn"><span class="hs-identifier hs-var">ppMainFn</span></a><span> </span><a href="#local-1628289554"><span class="hs-identifier hs-var">main_fn</span></a><span>
</span><a name="line-1519"></a><span>
</span><a name="line-1520"></a><span class="hs-comment">-- | Get the unqualified name of the function to use as the \&quot;main\&quot; for the main module.</span><span>
</span><a name="line-1521"></a><span class="hs-comment">-- Either returns the default name or the one configured on the command line with -main-is</span><span>
</span><a name="line-1522"></a><span class="hs-identifier">getMainFun</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1523"></a><a name="getMainFun"><a href="TcRnDriver.html#getMainFun"><span class="hs-identifier">getMainFun</span></a></a><span> </span><a name="local-1628289572"><a href="#local-1628289572"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">mainFunIs</span><span> </span><a href="#local-1628289572"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1524"></a><span>                      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289573"><a href="#local-1628289573"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#mkRdrUnqual"><span class="hs-identifier hs-var">mkRdrUnqual</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a><span> </span><a href="#local-1628289573"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1525"></a><span>                      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelNames.html#main_RDR_Unqual"><span class="hs-identifier hs-var">main_RDR_Unqual</span></a><span>
</span><a name="line-1526"></a><span>
</span><a name="line-1527"></a><span class="hs-comment">-- If we are in module Main, check that 'main' is exported.</span><span>
</span><a name="line-1528"></a><span class="hs-identifier">checkMainExported</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1529"></a><a name="checkMainExported"><a href="TcRnDriver.html#checkMainExported"><span class="hs-identifier">checkMainExported</span></a></a><span> </span><a name="local-1628289574"><a href="#local-1628289574"><span class="hs-identifier">tcg_env</span></a></a><span>
</span><a name="line-1530"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">tcg_main</span><span> </span><a href="#local-1628289574"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1531"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- not the main module</span><span>
</span><a name="line-1532"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628289575"><a href="#local-1628289575"><span class="hs-identifier">main_name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1533"></a><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289576"><a href="#local-1628289576"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-1534"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289577"><a href="#local-1628289577"><span class="hs-identifier">main_mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mainModIs</span><span> </span><a href="#local-1628289576"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1535"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289575"><span class="hs-identifier hs-var">main_name</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><a href="Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_exports</span><span> </span><a href="#local-1628289574"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1536"></a><span>                </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcRnDriver.html#ppMainFn"><span class="hs-identifier hs-var">ppMainFn</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#nameRdrName"><span class="hs-identifier hs-var">nameRdrName</span></a><span> </span><a href="#local-1628289575"><span class="hs-identifier hs-var">main_name</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1537"></a><span>                </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is not exported by module&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289577"><span class="hs-identifier hs-var">main_mod</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1538"></a><span>
</span><a name="line-1539"></a><span class="hs-identifier">ppMainFn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1540"></a><a name="ppMainFn"><a href="TcRnDriver.html#ppMainFn"><span class="hs-identifier">ppMainFn</span></a></a><span> </span><a name="local-1628289578"><a href="#local-1628289578"><span class="hs-identifier">main_fn</span></a></a><span>
</span><a name="line-1541"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><a href="#local-1628289578"><span class="hs-identifier hs-var">main_fn</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="TcRnDriver.html#mainOcc"><span class="hs-identifier hs-var">mainOcc</span></a><span>
</span><a name="line-1542"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;IO action&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289578"><span class="hs-identifier hs-var">main_fn</span></a><span class="hs-special">)</span><span>
</span><a name="line-1543"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1544"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;main IO action&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289578"><span class="hs-identifier hs-var">main_fn</span></a><span class="hs-special">)</span><span>
</span><a name="line-1545"></a><span>
</span><a name="line-1546"></a><span class="hs-identifier">mainOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-1547"></a><a name="mainOcc"><a href="TcRnDriver.html#mainOcc"><span class="hs-identifier">mainOcc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;main&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1548"></a><span>
</span><a name="line-1549"></a><span class="hs-comment">{-
Note [Root-main Id]
~~~~~~~~~~~~~~~~~~~
The function that the RTS invokes is always :Main.main, which we call
root_main_id.  (Because GHC allows the user to have a module not
called Main as the main module, we can't rely on the main function
being called &quot;Main.main&quot;.  That's why root_main_id has a fixed module
&quot;:Main&quot;.)

This is unusual: it's a LocalId whose Name has a Module from another
module.  Tiresomely, we must filter it out again in MkIface, les we
get two defns for 'main' in the interface file!


*********************************************************
*                                                       *
                GHCi stuff
*                                                       *
*********************************************************
-}</span><span>
</span><a name="line-1569"></a><span>
</span><a name="line-1570"></a><span class="hs-identifier">runTcInteractive</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span> </span><a href="#local-1628289105"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="#local-1628289105"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1571"></a><span class="hs-comment">-- Initialise the tcg_inst_env with instances from all home modules.</span><span>
</span><a name="line-1572"></a><span class="hs-comment">-- This mimics the more selective call to hptInstances in tcRnImports</span><span>
</span><a name="line-1573"></a><a name="runTcInteractive"><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier">runTcInteractive</span></a></a><span> </span><a name="local-1628289579"><a href="#local-1628289579"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628289580"><a href="#local-1628289580"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1574"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#initTcInteractive"><span class="hs-identifier hs-var">initTcInteractive</span></a><span> </span><a href="#local-1628289579"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnDriver.html#withTcPlugins"><span class="hs-identifier hs-var">withTcPlugins</span></a><span> </span><a href="#local-1628289579"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1575"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;setInteractiveContext&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1576"></a><span>            </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ic_tythings:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_tythings</span><span> </span><a href="#local-1628289583"><span class="hs-identifier hs-var">icxt</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1577"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ic_insts:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#pprBndr"><span class="hs-identifier hs-var">pprBndr</span></a><span> </span><a href="Outputable.html#LetBind"><span class="hs-identifier hs-var">LetBind</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289584"><span class="hs-identifier hs-var">ic_insts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1578"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ic_rn_gbl_env (LocalDef)&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1579"></a><span>                      </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628289597"><span class="hs-identifier hs-var">local_gres</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628289596"><a href="#local-1628289596"><span class="hs-identifier">gres</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="OccName.html#occEnvElts"><span class="hs-identifier hs-var">occEnvElts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_rn_gbl_env</span><span> </span><a href="#local-1628289583"><span class="hs-identifier hs-var">icxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1580"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289597"><a href="#local-1628289597"><span class="hs-identifier">local_gres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="RdrName.html#isLocalGRE"><span class="hs-identifier hs-var">isLocalGRE</span></a><span> </span><a href="#local-1628289596"><span class="hs-identifier hs-var">gres</span></a><span>
</span><a name="line-1581"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628289597"><span class="hs-identifier hs-var">local_gres</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1582"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289598"><a href="#local-1628289598"><span class="hs-identifier">getOrphans</span></a></a><span> </span><a name="local-1628289599"><a href="#local-1628289599"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628289600"><a href="#local-1628289600"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">mi_module</span><span> </span><a href="#local-1628289600"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-1583"></a><span>                                          </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">dep_orphs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_deps</span><span> </span><a href="#local-1628289600"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1584"></a><span>                                 </span><span class="hs-special">(</span><a href="LoadIface.html#loadSrcInterface"><span class="hs-identifier hs-var">loadSrcInterface</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;runTcInteractive&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628289599"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-1585"></a><span>                                                   </span><span class="hs-identifier hs-var">False</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1586"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628289604"><a href="#local-1628289604"><span class="hs-identifier">orphs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_imports</span><span> </span><a href="#local-1628289583"><span class="hs-identifier hs-var">icxt</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628289601"><a href="#local-1628289601"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1587"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628289601"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1588"></a><span>                </span><a href="HscTypes.html#IIModule"><span class="hs-identifier hs-var">IIModule</span></a><span> </span><a name="local-1628289602"><a href="#local-1628289602"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628289598"><span class="hs-identifier hs-var">getOrphans</span></a><span> </span><a href="#local-1628289602"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1589"></a><span>                </span><a href="HscTypes.html#IIDecl"><span class="hs-identifier hs-var">IIDecl</span></a><span> </span><a name="local-1628289603"><a href="#local-1628289603"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628289598"><span class="hs-identifier hs-var">getOrphans</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ideclName</span><span> </span><a href="#local-1628289603"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1590"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289605"><a href="#local-1628289605"><span class="hs-identifier">imports</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1591"></a><span>                            </span><span class="hs-identifier">imp_orphs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289604"><span class="hs-identifier hs-var">orphs</span></a><span>
</span><a name="line-1592"></a><span>                        </span><span class="hs-special">}</span><span>
</span><a name="line-1593"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628289606"><a href="#local-1628289606"><span class="hs-identifier">gbl_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289607"><a href="#local-1628289607"><span class="hs-identifier">lcl_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getEnvs"><span class="hs-identifier hs-var">getEnvs</span></a><span>
</span><a name="line-1594"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289608"><a href="#local-1628289608"><span class="hs-identifier">gbl_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289606"><span class="hs-identifier hs-var">gbl_env</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1595"></a><span>                           </span><span class="hs-identifier">tcg_rdr_env</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_rn_gbl_env</span><span> </span><a href="#local-1628289583"><span class="hs-identifier hs-var">icxt</span></a><span>
</span><a name="line-1596"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_type_env</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289590"><span class="hs-identifier hs-var">type_env</span></a><span>
</span><a name="line-1597"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_inst_env</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#extendInstEnvList"><span class="hs-identifier hs-var">extendInstEnvList</span></a><span>
</span><a name="line-1598"></a><span>                                               </span><span class="hs-special">(</span><a href="InstEnv.html#extendInstEnvList"><span class="hs-identifier hs-var">extendInstEnvList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_inst_env</span><span> </span><a href="#local-1628289606"><span class="hs-identifier hs-var">gbl_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289584"><span class="hs-identifier hs-var">ic_insts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1599"></a><span>                                               </span><a href="#local-1628289581"><span class="hs-identifier hs-var">home_insts</span></a><span>
</span><a name="line-1600"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_fam_inst_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FamInstEnv.html#extendFamInstEnvList"><span class="hs-identifier hs-var">extendFamInstEnvList</span></a><span>
</span><a name="line-1601"></a><span>                                               </span><span class="hs-special">(</span><a href="FamInstEnv.html#extendFamInstEnvList"><span class="hs-identifier hs-var">extendFamInstEnvList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_fam_inst_env</span><span> </span><a href="#local-1628289606"><span class="hs-identifier hs-var">gbl_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1602"></a><span>                                                                     </span><a href="#local-1628289585"><span class="hs-identifier hs-var">ic_finsts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1603"></a><span>                                               </span><a href="#local-1628289582"><span class="hs-identifier hs-var">home_fam_insts</span></a><span>
</span><a name="line-1604"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_field_env</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a><span> </span><a href="#local-1628289591"><span class="hs-identifier hs-var">con_fields</span></a><span>
</span><a name="line-1605"></a><span>                              </span><span class="hs-comment">-- setting tcg_field_env is necessary</span><span>
</span><a name="line-1606"></a><span>                              </span><span class="hs-comment">-- to make RecordWildCards work (test: ghci049)</span><span>
</span><a name="line-1607"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_fix_env</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_fix_env</span><span> </span><a href="#local-1628289583"><span class="hs-identifier hs-var">icxt</span></a><span>
</span><a name="line-1608"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_default</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_default</span><span> </span><a href="#local-1628289583"><span class="hs-identifier hs-var">icxt</span></a><span>
</span><a name="line-1609"></a><span>                              </span><span class="hs-comment">-- must calculate imp_orphs of the ImportAvails</span><span>
</span><a name="line-1610"></a><span>                              </span><span class="hs-comment">-- so that instance visibility is done correctly</span><span>
</span><a name="line-1611"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcg_imports</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289605"><span class="hs-identifier hs-var">imports</span></a><span>
</span><a name="line-1612"></a><span>                         </span><span class="hs-special">}</span><span>
</span><a name="line-1613"></a><span>
</span><a name="line-1614"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628289609"><a href="#local-1628289609"><span class="hs-identifier">lcl_env'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcExtendLocalTypeEnv"><span class="hs-identifier hs-var">tcExtendLocalTypeEnv</span></a><span> </span><a href="#local-1628289607"><span class="hs-identifier hs-var">lcl_env</span></a><span> </span><a href="#local-1628289586"><span class="hs-identifier hs-var">lcl_ids</span></a><span>
</span><a name="line-1615"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289608"><span class="hs-identifier hs-var">gbl_env'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289609"><span class="hs-identifier hs-var">lcl_env'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289580"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1616"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1617"></a><span>    </span><span class="hs-special">(</span><a name="local-1628289581"><a href="#local-1628289581"><span class="hs-identifier">home_insts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289582"><a href="#local-1628289582"><span class="hs-identifier">home_fam_insts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#hptInstances"><span class="hs-identifier hs-var">hptInstances</span></a><span> </span><a href="#local-1628289579"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1618"></a><span>
</span><a name="line-1619"></a><span>    </span><a name="local-1628289583"><a href="#local-1628289583"><span class="hs-identifier">icxt</span></a></a><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_IC</span><span> </span><a href="#local-1628289579"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-1620"></a><span>    </span><span class="hs-special">(</span><a name="local-1628289584"><a href="#local-1628289584"><span class="hs-identifier">ic_insts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289585"><a href="#local-1628289585"><span class="hs-identifier">ic_finsts</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_instances</span><span> </span><a href="#local-1628289583"><span class="hs-identifier hs-var">icxt</span></a><span>
</span><a name="line-1621"></a><span>    </span><span class="hs-special">(</span><a name="local-1628289586"><a href="#local-1628289586"><span class="hs-identifier">lcl_ids</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289587"><a href="#local-1628289587"><span class="hs-identifier">top_ty_things</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a><span> </span><a href="#local-1628289588"><span class="hs-identifier hs-var">is_closed</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_tythings</span><span> </span><a href="#local-1628289583"><span class="hs-identifier hs-var">icxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1622"></a><span>
</span><a name="line-1623"></a><span>    </span><span class="hs-identifier">is_closed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a><span class="hs-special">)</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span>
</span><a name="line-1624"></a><span>    </span><span class="hs-comment">-- Put Ids with free type variables (always RuntimeUnks)</span><span>
</span><a name="line-1625"></a><span>    </span><span class="hs-comment">-- in the *local* type environment</span><span>
</span><a name="line-1626"></a><span>    </span><span class="hs-comment">-- See Note [Initialising the type environment for GHCi]</span><span>
</span><a name="line-1627"></a><span>    </span><a name="local-1628289588"><a href="#local-1628289588"><span class="hs-identifier">is_closed</span></a></a><span> </span><a name="local-1628289592"><a href="#local-1628289592"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-1628"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-1628289593"><a href="#local-1628289593"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289592"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1629"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#isClosedLetBndr"><span class="hs-identifier hs-var">isClosedLetBndr</span></a><span> </span><a href="#local-1628289593"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-1630"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628289593"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ATcId"><span class="hs-identifier hs-var">ATcId</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tct_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289593"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tct_closed</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1631"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1632"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><a href="#local-1628289592"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1633"></a><span>
</span><a name="line-1634"></a><span>    </span><a name="local-1628289589"><a href="#local-1628289589"><span class="hs-identifier">type_env1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#mkTypeEnvWithImplicits"><span class="hs-identifier hs-var">mkTypeEnvWithImplicits</span></a><span> </span><a href="#local-1628289587"><span class="hs-identifier hs-var">top_ty_things</span></a><span>
</span><a name="line-1635"></a><span>    </span><a name="local-1628289590"><a href="#local-1628289590"><span class="hs-identifier">type_env</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#extendTypeEnvWithIds"><span class="hs-identifier hs-var">extendTypeEnvWithIds</span></a><span> </span><a href="#local-1628289589"><span class="hs-identifier hs-var">type_env1</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a><span> </span><a href="#local-1628289584"><span class="hs-identifier hs-var">ic_insts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1636"></a><span>                </span><span class="hs-comment">-- Putting the dfuns in the type_env</span><span>
</span><a name="line-1637"></a><span>                </span><span class="hs-comment">-- is just to keep Core Lint happy</span><span>
</span><a name="line-1638"></a><span>
</span><a name="line-1639"></a><span>    </span><a name="local-1628289591"><a href="#local-1628289591"><span class="hs-identifier">con_fields</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a><span> </span><a href="#local-1628289595"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a><span> </span><a href="#local-1628289595"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-1640"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-1628289594"><a href="#local-1628289594"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289587"><span class="hs-identifier hs-var">top_ty_things</span></a><span>
</span><a name="line-1641"></a><span>                 </span><span class="hs-special">,</span><span> </span><a name="local-1628289595"><a href="#local-1628289595"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628289594"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1642"></a><span>
</span><a name="line-1643"></a><span>
</span><a name="line-1644"></a><span class="hs-comment">{- Note [Initialising the type environment for GHCi]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Most of the the Ids in ic_things, defined by the user in 'let' stmts,
have closed types. E.g.
   ghci&gt; let foo x y = x &amp;&amp; not y

However the GHCi debugger creates top-level bindings for Ids whose
types have free RuntimeUnk skolem variables, standing for unknown
types.  If we don't register these free TyVars as global TyVars then
the typechecker will try to quantify over them and fall over in
zonkQuantifiedTyVar. so we must add any free TyVars to the
typechecker's global TyVar set.  That is most conveniently by using
tcExtendLocalTypeEnv, which automatically extends the global TyVar
set.

We do this by splitting out the Ids with open types, using 'is_closed'
to do the partition.  The top-level things go in the global TypeEnv;
the open, NotTopLevel, Ids, with free RuntimeUnk tyvars, go in the
local TypeEnv.

Note that we don't extend the local RdrEnv (tcl_rdr); all the in-scope
things are already in the interactive context's GlobalRdrEnv.
Extending the local RdrEnv isn't terrible, but it means there is an
entry for the same Name in both global and local RdrEnvs, and that
lead to duplicate &quot;perhaps you meant...&quot; suggestions (e.g. T5564).

We don't bother with the tcl_th_bndrs environment either.
-}</span><span>
</span><a name="line-1672"></a><span>
</span><a name="line-1673"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-1674"></a><span class="hs-comment">-- | The returned [Id] is the list of new Ids bound by this statement. It can</span><span>
</span><a name="line-1675"></a><span class="hs-comment">-- be used to extend the InteractiveContext via extendInteractiveContext.</span><span>
</span><a name="line-1676"></a><span class="hs-comment">--</span><span>
</span><a name="line-1677"></a><span class="hs-comment">-- The returned TypecheckedHsExpr is of type IO [ () ], a list of the bound</span><span>
</span><a name="line-1678"></a><span class="hs-comment">-- values, coerced to ().</span><span>
</span><a name="line-1679"></a><span class="hs-identifier">tcRnStmt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1680"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1681"></a><a name="tcRnStmt"><a href="TcRnDriver.html#tcRnStmt"><span class="hs-identifier">tcRnStmt</span></a></a><span> </span><a name="local-1628289610"><a href="#local-1628289610"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628289611"><a href="#local-1628289611"><span class="hs-identifier">rdr_stmt</span></a></a><span>
</span><a name="line-1682"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a><span> </span><a href="#local-1628289610"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1683"></a><span>
</span><a name="line-1684"></a><span>    </span><span class="hs-comment">-- The real work is done here</span><span>
</span><a name="line-1685"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628289614"><a href="#local-1628289614"><span class="hs-identifier">bound_ids</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289615"><a href="#local-1628289615"><span class="hs-identifier">tc_expr</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628289616"><a href="#local-1628289616"><span class="hs-identifier">fix_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#tcUserStmt"><span class="hs-identifier hs-var">tcUserStmt</span></a><span> </span><a href="#local-1628289611"><span class="hs-identifier hs-var">rdr_stmt</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1686"></a><span>    </span><a name="local-1628289617"><a href="#local-1628289617"><span class="hs-identifier">zonked_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTopLExpr"><span class="hs-identifier hs-var">zonkTopLExpr</span></a><span> </span><a href="#local-1628289615"><span class="hs-identifier hs-var">tc_expr</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1687"></a><span>    </span><a name="local-1628289618"><a href="#local-1628289618"><span class="hs-identifier">zonked_ids</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTopBndrs"><span class="hs-identifier hs-var">zonkTopBndrs</span></a><span> </span><a href="#local-1628289614"><span class="hs-identifier hs-var">bound_ids</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1688"></a><span>
</span><a name="line-1689"></a><span>        </span><span class="hs-comment">-- None of the Ids should be of unboxed type, because we</span><span>
</span><a name="line-1690"></a><span>        </span><span class="hs-comment">-- cast them all to HValues in the end!</span><span>
</span><a name="line-1691"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="#local-1628289612"><span class="hs-identifier hs-var">bad_unboxed</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289618"><span class="hs-identifier hs-var">zonked_ids</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1692"></a><span>
</span><a name="line-1693"></a><span>    </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcs 1&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1694"></a><span>    </span><a name="local-1628289619"><a href="#local-1628289619"><span class="hs-identifier">this_mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1695"></a><span>    </span><a name="local-1628289620"><a href="#local-1628289620"><span class="hs-identifier">global_ids</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#externaliseAndTidyId"><span class="hs-identifier hs-var">externaliseAndTidyId</span></a><span> </span><a href="#local-1628289619"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289618"><span class="hs-identifier hs-var">zonked_ids</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1696"></a><span>        </span><span class="hs-comment">-- Note [Interactively-bound Ids in GHCi] in HscTypes</span><span>
</span><a name="line-1697"></a><span>
</span><a name="line-1698"></a><span class="hs-comment">{- ---------------------------------------------
   At one stage I removed any shadowed bindings from the type_env;
   they are inaccessible but might, I suppose, cause a space leak if we leave them there.
   However, with Template Haskell they aren't necessarily inaccessible.  Consider this
   GHCi session
         Prelude&gt; let f n = n * 2 :: Int
         Prelude&gt; fName &lt;- runQ [| f |]
         Prelude&gt; $(return $ AppE fName (LitE (IntegerL 7)))
         14
         Prelude&gt; let f n = n * 3 :: Int
         Prelude&gt; $(return $ AppE fName (LitE (IntegerL 7)))
   In the last line we use 'fName', which resolves to the *first* 'f'
   in scope. If we delete it from the type env, GHCi crashes because
   it doesn't expect that.

   Hence this code is commented out

-------------------------------------------------- -}</span><span>
</span><a name="line-1716"></a><span>
</span><a name="line-1717"></a><span>    </span><a href="TcRnMonad.html#traceOptTcRn"><span class="hs-identifier hs-var">traceOptTcRn</span></a><span> </span><a href="DynFlags.html#Opt_D_dump_tc"><span class="hs-identifier hs-var">Opt_D_dump_tc</span></a><span>
</span><a name="line-1718"></a><span>        </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Bound Ids&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289620"><span class="hs-identifier hs-var">global_ids</span></a><span class="hs-special">,</span><span>
</span><a name="line-1719"></a><span>               </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Typechecked expr&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289617"><span class="hs-identifier hs-var">zonked_expr</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1720"></a><span>
</span><a name="line-1721"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289620"><span class="hs-identifier hs-var">global_ids</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289617"><span class="hs-identifier hs-var">zonked_expr</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289616"><span class="hs-identifier hs-var">fix_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1722"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1723"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1724"></a><span>    </span><a name="local-1628289612"><a href="#local-1628289612"><span class="hs-identifier">bad_unboxed</span></a></a><span> </span><a name="local-1628289613"><a href="#local-1628289613"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;GHCi can't bind a variable of unlifted type:&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1725"></a><span>                                  </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289613"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628289613"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1726"></a><span>
</span><a name="line-1727"></a><span class="hs-comment">{-
--------------------------------------------------------------------------
                Typechecking Stmts in GHCi

Here is the grand plan, implemented in tcUserStmt

        What you type                   The IO [HValue] that hscStmt returns
        -------------                   ------------------------------------
        let pat = expr          ==&gt;     let pat = expr in return [coerce HVal x, coerce HVal y, ...]
                                        bindings: [x,y,...]

        pat &lt;- expr             ==&gt;     expr &gt;&gt;= \ pat -&gt; return [coerce HVal x, coerce HVal y, ...]
                                        bindings: [x,y,...]

        expr (of IO type)       ==&gt;     expr &gt;&gt;= \ it -&gt; return [coerce HVal it]
          [NB: result not printed]      bindings: [it]

        expr (of non-IO type,   ==&gt;     let it = expr in print it &gt;&gt; return [coerce HVal it]
          result showable)              bindings: [it]

        expr (of non-IO type,
          result not showable)  ==&gt;     error
-}</span><span>
</span><a name="line-1750"></a><span>
</span><a name="line-1751"></a><span class="hs-comment">-- | A plan is an attempt to lift some code into the IO monad.</span><span>
</span><a name="line-1752"></a><span class="hs-keyword">type</span><span> </span><a name="PlanResult"><a href="TcRnDriver.html#PlanResult"><span class="hs-identifier">PlanResult</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1753"></a><span class="hs-keyword">type</span><span> </span><a name="Plan"><a href="TcRnDriver.html#Plan"><span class="hs-identifier">Plan</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnDriver.html#PlanResult"><span class="hs-identifier hs-type">PlanResult</span></a><span>
</span><a name="line-1754"></a><span>
</span><a name="line-1755"></a><span class="hs-comment">-- | Try the plans in order. If one fails (by raising an exn), try the next.</span><span>
</span><a name="line-1756"></a><span class="hs-comment">-- If one succeeds, take it.</span><span>
</span><a name="line-1757"></a><span class="hs-identifier">runPlans</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnDriver.html#Plan"><span class="hs-identifier hs-type">Plan</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnDriver.html#PlanResult"><span class="hs-identifier hs-type">PlanResult</span></a><span>
</span><a name="line-1758"></a><a name="runPlans"><a href="TcRnDriver.html#runPlans"><span class="hs-identifier">runPlans</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;runPlans&quot;</span><span>
</span><a name="line-1759"></a><span class="hs-identifier">runPlans</span><span> </span><span class="hs-special">[</span><a name="local-1628289621"><a href="#local-1628289621"><span class="hs-identifier">p</span></a></a><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289621"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1760"></a><span class="hs-identifier">runPlans</span><span> </span><span class="hs-special">(</span><a name="local-1628289622"><a href="#local-1628289622"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">:</span><a name="local-1628289623"><a href="#local-1628289623"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#tryTcLIE_"><span class="hs-identifier hs-var">tryTcLIE_</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#runPlans"><span class="hs-identifier hs-var">runPlans</span></a><span> </span><a href="#local-1628289623"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289622"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1761"></a><span>
</span><a name="line-1762"></a><span class="hs-comment">-- | Typecheck (and 'lift') a stmt entered by the user in GHCi into the</span><span>
</span><a name="line-1763"></a><span class="hs-comment">-- GHCi 'environment'.</span><span>
</span><a name="line-1764"></a><span class="hs-comment">--</span><span>
</span><a name="line-1765"></a><span class="hs-comment">-- By 'lift' and 'environment we mean that the code is changed to</span><span>
</span><a name="line-1766"></a><span class="hs-comment">-- execute properly in an IO monad. See Note [Interactively-bound Ids</span><span>
</span><a name="line-1767"></a><span class="hs-comment">-- in GHCi] in HscTypes for more details. We do this lifting by trying</span><span>
</span><a name="line-1768"></a><span class="hs-comment">-- different ways ('plans') of lifting the code into the IO monad and</span><span>
</span><a name="line-1769"></a><span class="hs-comment">-- type checking each plan until one succeeds.</span><span>
</span><a name="line-1770"></a><span class="hs-identifier">tcUserStmt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsExpr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#PlanResult"><span class="hs-identifier hs-type">PlanResult</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1771"></a><span>
</span><a name="line-1772"></a><span class="hs-comment">-- An expression typed at the prompt is treated very specially</span><span>
</span><a name="line-1773"></a><a name="tcUserStmt"><a href="TcRnDriver.html#tcUserStmt"><span class="hs-identifier">tcUserStmt</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628289624"><a href="#local-1628289624"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#BodyStmt"><span class="hs-identifier hs-var">BodyStmt</span></a><span> </span><a name="local-1628289625"><a href="#local-1628289625"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1774"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628289626"><a href="#local-1628289626"><span class="hs-identifier">rn_expr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289627"><a href="#local-1628289627"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><span class="hs-special">(</span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-1628289625"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1775"></a><span>               </span><span class="hs-comment">-- Don't try to typecheck if the renamer fails!</span><span>
</span><a name="line-1776"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289628"><a href="#local-1628289628"><span class="hs-identifier">ghciStep</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#getGhciStepIO"><span class="hs-identifier hs-var">getGhciStepIO</span></a><span>
</span><a name="line-1777"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289629"><a href="#local-1628289629"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-1778"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289630"><a href="#local-1628289630"><span class="hs-identifier">interPrintName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getInteractivePrintName"><span class="hs-identifier hs-var">getInteractivePrintName</span></a><span>
</span><a name="line-1779"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289631"><a href="#local-1628289631"><span class="hs-identifier">fresh_it</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelNames.html#itName"><span class="hs-identifier hs-var">itName</span></a><span> </span><a href="#local-1628289629"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-1628289624"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-1780"></a><span>              </span><a name="local-1628289632"><a href="#local-1628289632"><span class="hs-identifier">matches</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="HsUtils.html#mkMatch"><span class="hs-identifier hs-var">mkMatch</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1628289626"><span class="hs-identifier hs-var">rn_expr</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="HsBinds.html#emptyLocalBinds"><span class="hs-identifier hs-var">emptyLocalBinds</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1781"></a><span>              </span><span class="hs-comment">-- [it = expr]</span><span>
</span><a name="line-1782"></a><span>              </span><a name="local-1628289633"><a href="#local-1628289633"><span class="hs-identifier">the_bind</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628289624"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#mkTopFunBind"><span class="hs-identifier hs-var">mkTopFunBind</span></a><span> </span><a href="BasicTypes.html#FromSource"><span class="hs-identifier hs-var">FromSource</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628289624"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628289631"><span class="hs-identifier hs-var">fresh_it</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289632"><span class="hs-identifier hs-var">matches</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">bind_fvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289627"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1783"></a><span>                          </span><span class="hs-comment">-- Care here!  In GHCi the expression might have</span><span>
</span><a name="line-1784"></a><span>                          </span><span class="hs-comment">-- free variables, and they in turn may have free type variables</span><span>
</span><a name="line-1785"></a><span>                          </span><span class="hs-comment">-- (if we are at a breakpoint, say).  We must put those free vars</span><span>
</span><a name="line-1786"></a><span>
</span><a name="line-1787"></a><span>              </span><span class="hs-comment">-- [let it = expr]</span><span>
</span><a name="line-1788"></a><span>              </span><a name="local-1628289634"><a href="#local-1628289634"><span class="hs-identifier">let_stmt</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628289624"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsExpr.html#LetStmt"><span class="hs-identifier hs-var">LetStmt</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-var">HsValBinds</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1789"></a><span>                          </span><a href="HsBinds.html#ValBindsOut"><span class="hs-identifier hs-var">ValBindsOut</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="BasicTypes.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a><span class="hs-special">,</span><a href="Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a><span> </span><a href="#local-1628289633"><span class="hs-identifier hs-var">the_bind</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1790"></a><span>
</span><a name="line-1791"></a><span>              </span><span class="hs-comment">-- [it &lt;- e]</span><span>
</span><a name="line-1792"></a><span>              </span><a name="local-1628289635"><a href="#local-1628289635"><span class="hs-identifier">bind_stmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628289624"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsExpr.html#BindStmt"><span class="hs-identifier hs-var">BindStmt</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628289624"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="HsPat.html#VarPat"><span class="hs-identifier hs-var">VarPat</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628289624"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628289631"><span class="hs-identifier hs-var">fresh_it</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1793"></a><span>                                           </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a><span> </span><a href="#local-1628289628"><span class="hs-identifier hs-var">ghciStep</span></a><span> </span><a href="#local-1628289626"><span class="hs-identifier hs-var">rn_expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1794"></a><span>                                           </span><span class="hs-special">(</span><a href="HsExpr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a><span> </span><a href="PrelNames.html#bindIOName"><span class="hs-identifier hs-var">bindIOName</span></a><span class="hs-special">)</span><span>
</span><a name="line-1795"></a><span>                                           </span><a href="HsExpr.html#noSyntaxExpr"><span class="hs-identifier hs-var">noSyntaxExpr</span></a><span>
</span><a name="line-1796"></a><span>                                           </span><a href="PlaceHolder.html#PlaceHolder"><span class="hs-identifier hs-var">PlaceHolder</span></a><span>
</span><a name="line-1797"></a><span>
</span><a name="line-1798"></a><span>              </span><span class="hs-comment">-- [; print it]</span><span>
</span><a name="line-1799"></a><span>              </span><a name="local-1628289636"><a href="#local-1628289636"><span class="hs-identifier">print_it</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628289624"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsExpr.html#BodyStmt"><span class="hs-identifier hs-var">BodyStmt</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a><span> </span><a href="#local-1628289630"><span class="hs-identifier hs-var">interPrintName</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a><span> </span><a href="#local-1628289631"><span class="hs-identifier hs-var">fresh_it</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1800"></a><span>                                           </span><span class="hs-special">(</span><a href="HsExpr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a><span> </span><a href="PrelNames.html#thenIOName"><span class="hs-identifier hs-var">thenIOName</span></a><span class="hs-special">)</span><span>
</span><a name="line-1801"></a><span>                                                  </span><a href="HsExpr.html#noSyntaxExpr"><span class="hs-identifier hs-var">noSyntaxExpr</span></a><span> </span><a href="PlaceHolder.html#placeHolderType"><span class="hs-identifier hs-var">placeHolderType</span></a><span>
</span><a name="line-1802"></a><span>
</span><a name="line-1803"></a><span>        </span><span class="hs-comment">-- The plans are:</span><span>
</span><a name="line-1804"></a><span>        </span><span class="hs-comment">--   A. [it &lt;- e; print it]     but not if it::()</span><span>
</span><a name="line-1805"></a><span>        </span><span class="hs-comment">--   B. [it &lt;- e]</span><span>
</span><a name="line-1806"></a><span>        </span><span class="hs-comment">--   C. [let it = e; print it]</span><span>
</span><a name="line-1807"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-1808"></a><span>        </span><span class="hs-comment">-- Ensure that type errors don't get deferred when type checking the</span><span>
</span><a name="line-1809"></a><span>        </span><span class="hs-comment">-- naked expression. Deferring type errors here is unhelpful because the</span><span>
</span><a name="line-1810"></a><span>        </span><span class="hs-comment">-- expression gets evaluated right away anyway. It also would potentially</span><span>
</span><a name="line-1811"></a><span>        </span><span class="hs-comment">-- emit two redundant type-error warnings, one from each plan.</span><span>
</span><a name="line-1812"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289640"><a href="#local-1628289640"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#unsetGOptM"><span class="hs-identifier hs-var">unsetGOptM</span></a><span> </span><a href="DynFlags.html#Opt_DeferTypeErrors"><span class="hs-identifier hs-var">Opt_DeferTypeErrors</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1813"></a><span>                  </span><a href="TcRnMonad.html#unsetGOptM"><span class="hs-identifier hs-var">unsetGOptM</span></a><span> </span><a href="DynFlags.html#Opt_DeferTypedHoles"><span class="hs-identifier hs-var">Opt_DeferTypedHoles</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnDriver.html#runPlans"><span class="hs-identifier hs-var">runPlans</span></a><span> </span><span class="hs-special">[</span><span>
</span><a name="line-1814"></a><span>                    </span><span class="hs-comment">-- Plan A</span><span>
</span><a name="line-1815"></a><span>                    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289637"><a href="#local-1628289637"><span class="hs-identifier">stuff</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">[</span><a name="local-1628289638"><a href="#local-1628289638"><span class="hs-identifier">it_id</span></a></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289635"><span class="hs-identifier hs-var">bind_stmt</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289636"><span class="hs-identifier hs-var">print_it</span></a><span class="hs-special">]</span><span>
</span><a name="line-1816"></a><span>                       </span><span class="hs-special">;</span><span> </span><a name="local-1628289639"><a href="#local-1628289639"><span class="hs-identifier">it_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628289638"><span class="hs-identifier hs-var">it_id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1817"></a><span>                       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#isUnitTy"><span class="hs-identifier hs-var">isUnitTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1628289639"><span class="hs-identifier hs-var">it_ty</span></a><span class="hs-special">)</span><span> </span><a href="IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a><span>
</span><a name="line-1818"></a><span>                       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289637"><span class="hs-identifier hs-var">stuff</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-1819"></a><span>
</span><a name="line-1820"></a><span>                        </span><span class="hs-comment">-- Plan B; a naked bind statment</span><span>
</span><a name="line-1821"></a><span>                    </span><a href="TcRnDriver.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289635"><span class="hs-identifier hs-var">bind_stmt</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1822"></a><span>
</span><a name="line-1823"></a><span>                        </span><span class="hs-comment">-- Plan C; check that the let-binding is typeable all by itself.</span><span>
</span><a name="line-1824"></a><span>                        </span><span class="hs-comment">-- If not, fail; if so, try to print it.</span><span>
</span><a name="line-1825"></a><span>                        </span><span class="hs-comment">-- The two-step process avoids getting two errors: one from</span><span>
</span><a name="line-1826"></a><span>                        </span><span class="hs-comment">-- the expression itself, and one from the 'print it' part</span><span>
</span><a name="line-1827"></a><span>                        </span><span class="hs-comment">-- This two-step story is very clunky, alas</span><span>
</span><a name="line-1828"></a><span>                    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289634"><span class="hs-identifier hs-var">let_stmt</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1829"></a><span>                                </span><span class="hs-comment">--- checkNoErrs defeats the error recovery of let-bindings</span><span>
</span><a name="line-1830"></a><span>                       </span><span class="hs-special">;</span><span> </span><a href="TcRnDriver.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289634"><span class="hs-identifier hs-var">let_stmt</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289636"><span class="hs-identifier hs-var">print_it</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1831"></a><span>
</span><a name="line-1832"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1628289641"><a href="#local-1628289641"><span class="hs-identifier">fix_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getFixityEnv"><span class="hs-identifier hs-var">getFixityEnv</span></a><span>
</span><a name="line-1833"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289640"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289641"><span class="hs-identifier hs-var">fix_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1834"></a><span>
</span><a name="line-1835"></a><span class="hs-identifier">tcUserStmt</span><span> </span><a name="local-1628289642"><a href="#local-1628289642"><span class="hs-identifier">rdr_stmt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628289643"><a href="#local-1628289643"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1836"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><a name="local-1628289652"><a href="#local-1628289652"><span class="hs-identifier">rn_stmt</span></a></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a name="local-1628289653"><a href="#local-1628289653"><span class="hs-identifier">fix_env</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628289654"><a href="#local-1628289654"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1837"></a><span>           </span><a href="RnExpr.html#rnStmts"><span class="hs-identifier hs-var">rnStmts</span></a><span> </span><a href="HsExpr.html#GhciStmtCtxt"><span class="hs-identifier hs-var">GhciStmtCtxt</span></a><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289642"><span class="hs-identifier hs-var">rdr_stmt</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1838"></a><span>             </span><a name="local-1628289651"><a href="#local-1628289651"><span class="hs-identifier">fix_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getFixityEnv"><span class="hs-identifier hs-var">getFixityEnv</span></a><span>
</span><a name="line-1839"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289651"><span class="hs-identifier hs-var">fix_env</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1840"></a><span>            </span><span class="hs-comment">-- Don't try to typecheck if the renamer fails!</span><span>
</span><a name="line-1841"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;tcRnStmt&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289642"><span class="hs-identifier hs-var">rdr_stmt</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289652"><span class="hs-identifier hs-var">rn_stmt</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289654"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1842"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnDriver.html#rnDump"><span class="hs-identifier hs-var">rnDump</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289652"><span class="hs-identifier hs-var">rn_stmt</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1843"></a><span>
</span><a name="line-1844"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628289655"><a href="#local-1628289655"><span class="hs-identifier">ghciStep</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#getGhciStepIO"><span class="hs-identifier hs-var">getGhciStepIO</span></a><span>
</span><a name="line-1845"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289656"><a href="#local-1628289656"><span class="hs-identifier">gi_stmt</span></a></a><span>
</span><a name="line-1846"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-1628289657"><a href="#local-1628289657"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#BindStmt"><span class="hs-identifier hs-var">BindStmt</span></a><span> </span><a name="local-1628289658"><a href="#local-1628289658"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-1628289659"><a href="#local-1628289659"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-1628289660"><a href="#local-1628289660"><span class="hs-identifier">op1</span></a></a><span> </span><a name="local-1628289661"><a href="#local-1628289661"><span class="hs-identifier">op2</span></a></a><span> </span><a name="local-1628289662"><a href="#local-1628289662"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628289652"><span class="hs-identifier hs-var">rn_stmt</span></a><span>
</span><a name="line-1847"></a><span>                           </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628289657"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsExpr.html#BindStmt"><span class="hs-identifier hs-var">BindStmt</span></a><span> </span><a href="#local-1628289658"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a><span> </span><a href="#local-1628289655"><span class="hs-identifier hs-var">ghciStep</span></a><span> </span><a href="#local-1628289659"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289660"><span class="hs-identifier hs-var">op1</span></a><span> </span><a href="#local-1628289661"><span class="hs-identifier hs-var">op2</span></a><span> </span><a href="#local-1628289662"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1848"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289652"><span class="hs-identifier hs-var">rn_stmt</span></a><span>
</span><a name="line-1849"></a><span>
</span><a name="line-1850"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628289663"><a href="#local-1628289663"><span class="hs-identifier">opt_pr_flag</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a><span> </span><a href="DynFlags.html#Opt_PrintBindResult"><span class="hs-identifier hs-var">Opt_PrintBindResult</span></a><span>
</span><a name="line-1851"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289664"><a href="#local-1628289664"><span class="hs-identifier">print_result_plan</span></a></a><span>
</span><a name="line-1852"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628289663"><span class="hs-identifier hs-var">opt_pr_flag</span></a><span>                         </span><span class="hs-comment">-- The flag says &quot;print result&quot;</span><span>
</span><a name="line-1853"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-1628289665"><a href="#local-1628289665"><span class="hs-identifier">v</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HsUtils.html#collectLStmtBinders"><span class="hs-identifier hs-var">collectLStmtBinders</span></a><span> </span><a href="#local-1628289656"><span class="hs-identifier hs-var">gi_stmt</span></a><span>  </span><span class="hs-comment">-- One binder</span><span>
</span><a name="line-1854"></a><span>                           </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><a href="#local-1628289644"><span class="hs-identifier hs-var">mk_print_result_plan</span></a><span> </span><a href="#local-1628289656"><span class="hs-identifier hs-var">gi_stmt</span></a><span> </span><a href="#local-1628289665"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">]</span><span>
</span><a name="line-1855"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1856"></a><span>
</span><a name="line-1857"></a><span>        </span><span class="hs-comment">-- The plans are:</span><span>
</span><a name="line-1858"></a><span>        </span><span class="hs-comment">--      [stmt; print v]         if one binder and not v::()</span><span>
</span><a name="line-1859"></a><span>        </span><span class="hs-comment">--      [stmt]                  otherwise</span><span>
</span><a name="line-1860"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628289666"><a href="#local-1628289666"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#runPlans"><span class="hs-identifier hs-var">runPlans</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289664"><span class="hs-identifier hs-var">print_result_plan</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><a href="TcRnDriver.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289656"><span class="hs-identifier hs-var">gi_stmt</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1861"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289666"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289653"><span class="hs-identifier hs-var">fix_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1862"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1863"></a><span>    </span><a name="local-1628289644"><a href="#local-1628289644"><span class="hs-identifier">mk_print_result_plan</span></a></a><span> </span><a name="local-1628289645"><a href="#local-1628289645"><span class="hs-identifier">stmt</span></a></a><span> </span><a name="local-1628289646"><a href="#local-1628289646"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-1864"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289648"><a href="#local-1628289648"><span class="hs-identifier">stuff</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">[</span><a name="local-1628289649"><a href="#local-1628289649"><span class="hs-identifier">v_id</span></a></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#tcGhciStmts"><span class="hs-identifier hs-var">tcGhciStmts</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289645"><span class="hs-identifier hs-var">stmt</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289647"><span class="hs-identifier hs-var">print_v</span></a><span class="hs-special">]</span><span>
</span><a name="line-1865"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-1628289650"><a href="#local-1628289650"><span class="hs-identifier">v_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628289649"><span class="hs-identifier hs-var">v_id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1866"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#isUnitTy"><span class="hs-identifier hs-var">isUnitTy</span></a><span> </span><a href="#local-1628289650"><span class="hs-identifier hs-var">v_ty</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcType.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a><span> </span><a href="#local-1628289650"><span class="hs-identifier hs-var">v_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a><span>
</span><a name="line-1867"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289648"><span class="hs-identifier hs-var">stuff</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1868"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1869"></a><span>        </span><a name="local-1628289647"><a href="#local-1628289647"><span class="hs-identifier">print_v</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-1628289643"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsExpr.html#BodyStmt"><span class="hs-identifier hs-var">BodyStmt</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a><span> </span><a href="PrelNames.html#printName"><span class="hs-identifier hs-var">printName</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a><span> </span><a href="#local-1628289646"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1870"></a><span>                                    </span><span class="hs-special">(</span><a href="HsExpr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-var">mkRnSyntaxExpr</span></a><span> </span><a href="PrelNames.html#thenIOName"><span class="hs-identifier hs-var">thenIOName</span></a><span class="hs-special">)</span><span> </span><a href="HsExpr.html#noSyntaxExpr"><span class="hs-identifier hs-var">noSyntaxExpr</span></a><span>
</span><a name="line-1871"></a><span>                                    </span><a href="PlaceHolder.html#placeHolderType"><span class="hs-identifier hs-var">placeHolderType</span></a><span>
</span><a name="line-1872"></a><span>
</span><a name="line-1873"></a><span class="hs-comment">-- | Typecheck the statements given and then return the results of the</span><span>
</span><a name="line-1874"></a><span class="hs-comment">-- statement in the form 'IO [()]'.</span><span>
</span><a name="line-1875"></a><span class="hs-identifier">tcGhciStmts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsExpr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnDriver.html#PlanResult"><span class="hs-identifier hs-type">PlanResult</span></a><span>
</span><a name="line-1876"></a><a name="tcGhciStmts"><a href="TcRnDriver.html#tcGhciStmts"><span class="hs-identifier">tcGhciStmts</span></a></a><span> </span><a name="local-1628289667"><a href="#local-1628289667"><span class="hs-identifier">stmts</span></a></a><span>
</span><a name="line-1877"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289668"><a href="#local-1628289668"><span class="hs-identifier">ioTyCon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a><span> </span><a href="PrelNames.html#ioTyConName"><span class="hs-identifier hs-var">ioTyConName</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1878"></a><span>        </span><a name="local-1628289669"><a href="#local-1628289669"><span class="hs-identifier">ret_id</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a><span> </span><a href="PrelNames.html#returnIOName"><span class="hs-identifier hs-var">returnIOName</span></a><span> </span><span class="hs-special">;</span><span>            </span><span class="hs-comment">-- return @ IO</span><span>
</span><a name="line-1879"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1880"></a><span>            </span><a name="local-1628289670"><a href="#local-1628289670"><span class="hs-identifier">ret_ty</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#mkListTy"><span class="hs-identifier hs-var">mkListTy</span></a><span> </span><a href="TysWiredIn.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1881"></a><span>            </span><a name="local-1628289671"><a href="#local-1628289671"><span class="hs-identifier">io_ret_ty</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628289668"><span class="hs-identifier hs-var">ioTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289670"><span class="hs-identifier hs-var">ret_ty</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1882"></a><span>            </span><a name="local-1628289672"><a href="#local-1628289672"><span class="hs-identifier">tc_io_stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMatches.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a><span> </span><a href="HsExpr.html#GhciStmtCtxt"><span class="hs-identifier hs-var">GhciStmtCtxt</span></a><span> </span><a href="TcMatches.html#tcDoStmt"><span class="hs-identifier hs-var">tcDoStmt</span></a><span> </span><a href="#local-1628289667"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-1883"></a><span>                                         </span><span class="hs-special">(</span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span> </span><a href="#local-1628289671"><span class="hs-identifier hs-var">io_ret_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1884"></a><span>            </span><a name="local-1628289673"><a href="#local-1628289673"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#collectLStmtsBinders"><span class="hs-identifier hs-var">collectLStmtsBinders</span></a><span> </span><a href="#local-1628289667"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1885"></a><span>         </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1886"></a><span>
</span><a name="line-1887"></a><span>        </span><span class="hs-comment">-- OK, we're ready to typecheck the stmts</span><span>
</span><a name="line-1888"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;TcRnDriver.tcGhciStmts: tc stmts&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1889"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628289674"><a href="#local-1628289674"><span class="hs-identifier">tc_stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289675"><a href="#local-1628289675"><span class="hs-identifier">ids</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628289676"><a href="#local-1628289676"><span class="hs-identifier">lie</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1890"></a><span>                                  </span><a href="#local-1628289672"><span class="hs-identifier hs-var">tc_io_stmts</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1891"></a><span>                                  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcEnv.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a><span> </span><a href="#local-1628289673"><span class="hs-identifier hs-var">names</span></a><span>  </span><span class="hs-special">;</span><span>
</span><a name="line-1892"></a><span>                        </span><span class="hs-comment">-- Look up the names right in the middle,</span><span>
</span><a name="line-1893"></a><span>                        </span><span class="hs-comment">-- where they will all be in scope</span><span>
</span><a name="line-1894"></a><span>
</span><a name="line-1895"></a><span>        </span><span class="hs-comment">-- wanted constraints from static forms</span><span>
</span><a name="line-1896"></a><span>        </span><a name="local-1628289677"><a href="#local-1628289677"><span class="hs-identifier">stWC</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcg_static_wc</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1897"></a><span>
</span><a name="line-1898"></a><span>        </span><span class="hs-comment">-- Simplify the context</span><span>
</span><a name="line-1899"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;TcRnDriver.tcGhciStmts: simplify ctxt&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1900"></a><span>        </span><a name="local-1628289678"><a href="#local-1628289678"><span class="hs-identifier">const_binds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><span class="hs-special">(</span><a href="TcSimplify.html#simplifyInteractive"><span class="hs-identifier hs-var">simplifyInteractive</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#andWC"><span class="hs-identifier hs-var">andWC</span></a><span> </span><a href="#local-1628289677"><span class="hs-identifier hs-var">stWC</span></a><span> </span><a href="#local-1628289676"><span class="hs-identifier hs-var">lie</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1901"></a><span>                </span><span class="hs-comment">-- checkNoErrs ensures that the plan fails if context redn fails</span><span>
</span><a name="line-1902"></a><span>
</span><a name="line-1903"></a><span>        </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;TcRnDriver.tcGhciStmts: done&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1904"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">-- mk_return builds the expression</span><span>
</span><a name="line-1905"></a><span>                </span><span class="hs-comment">--      returnIO @ [()] [coerce () x, ..,  coerce () z]</span><span>
</span><a name="line-1906"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-1907"></a><span>                </span><span class="hs-comment">-- Despite the inconvenience of building the type applications etc,</span><span>
</span><a name="line-1908"></a><span>                </span><span class="hs-comment">-- this *has* to be done in type-annotated post-typecheck form</span><span>
</span><a name="line-1909"></a><span>                </span><span class="hs-comment">-- because we are going to return a list of *polymorphic* values</span><span>
</span><a name="line-1910"></a><span>                </span><span class="hs-comment">-- coerced to type (). If we built a *source* stmt</span><span>
</span><a name="line-1911"></a><span>                </span><span class="hs-comment">--      return [coerce x, ..., coerce z]</span><span>
</span><a name="line-1912"></a><span>                </span><span class="hs-comment">-- then the type checker would instantiate x..z, and we wouldn't</span><span>
</span><a name="line-1913"></a><span>                </span><span class="hs-comment">-- get their *polymorphic* values.  (And we'd get ambiguity errs</span><span>
</span><a name="line-1914"></a><span>                </span><span class="hs-comment">-- if they were overloaded, since they aren't applied to anything.)</span><span>
</span><a name="line-1915"></a><span>            </span><a name="local-1628289679"><a href="#local-1628289679"><span class="hs-identifier">ret_expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsTyApp"><span class="hs-identifier hs-var">nlHsTyApp</span></a><span> </span><a href="#local-1628289669"><span class="hs-identifier hs-var">ret_id</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289670"><span class="hs-identifier hs-var">ret_ty</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1916"></a><span>                       </span><span class="hs-special">(</span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsExpr.html#ExplicitList"><span class="hs-identifier hs-var">ExplicitList</span></a><span> </span><a href="TysWiredIn.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628289680"><span class="hs-identifier hs-var">mk_item</span></a><span> </span><a href="#local-1628289675"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1917"></a><span>            </span><a name="local-1628289680"><a href="#local-1628289680"><span class="hs-identifier">mk_item</span></a></a><span> </span><a name="local-1628289682"><a href="#local-1628289682"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289683"><a href="#local-1628289683"><span class="hs-identifier">ty_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628289682"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1918"></a><span>                         </span><a href="HsUtils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsTyApp"><span class="hs-identifier hs-var">nlHsTyApp</span></a><span> </span><a href="MkId.html#unsafeCoerceId"><span class="hs-identifier hs-var">unsafeCoerceId</span></a><span>
</span><a name="line-1919"></a><span>                                   </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><span class="hs-string">&quot;tcGhciStmts&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628289683"><span class="hs-identifier hs-var">ty_args</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628289683"><span class="hs-identifier hs-var">ty_args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1920"></a><span>                                 </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a><span> </span><a href="#local-1628289682"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1921"></a><span>            </span><a name="local-1628289681"><a href="#local-1628289681"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289674"><span class="hs-identifier hs-var">tc_stmts</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#mkLastStmt"><span class="hs-identifier hs-var">mkLastStmt</span></a><span> </span><a href="#local-1628289679"><span class="hs-identifier hs-var">ret_expr</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1922"></a><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1923"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289675"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">,</span><span> </span><a href="HsUtils.html#mkHsDictLet"><span class="hs-identifier hs-var">mkHsDictLet</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#EvBinds"><span class="hs-identifier hs-var">EvBinds</span></a><span> </span><a href="#local-1628289678"><span class="hs-identifier hs-var">const_binds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1924"></a><span>                     </span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsDo"><span class="hs-identifier hs-var">HsDo</span></a><span> </span><a href="HsExpr.html#GhciStmtCtxt"><span class="hs-identifier hs-var">GhciStmtCtxt</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="#local-1628289681"><span class="hs-identifier hs-var">stmts</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289671"><span class="hs-identifier hs-var">io_ret_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1925"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1926"></a><span>
</span><a name="line-1927"></a><span class="hs-comment">-- | Generate a typed ghciStepIO expression (ghciStep :: Ty a -&gt; IO a)</span><span>
</span><a name="line-1928"></a><span class="hs-identifier">getGhciStepIO</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1929"></a><a name="getGhciStepIO"><a href="TcRnDriver.html#getGhciStepIO"><span class="hs-identifier">getGhciStepIO</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1930"></a><span>    </span><a name="local-1628289684"><a href="#local-1628289684"><span class="hs-identifier">ghciTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGHCiMonad"><span class="hs-identifier hs-var">getGHCiMonad</span></a><span>
</span><a name="line-1931"></a><span>    </span><a name="local-1628289685"><a href="#local-1628289685"><span class="hs-identifier">fresh_a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-1932"></a><span>    </span><a name="local-1628289686"><a href="#local-1628289686"><span class="hs-identifier">loc</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-1933"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289687"><a href="#local-1628289687"><span class="hs-identifier">a_tv</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a><span> </span><a href="#local-1628289685"><span class="hs-identifier hs-var">fresh_a</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkTyVarOccFS"><span class="hs-identifier hs-var">mkTyVarOccFS</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;a&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628289686"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-1934"></a><span>        </span><a name="local-1628289688"><a href="#local-1628289688"><span class="hs-identifier">ghciM</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#nlHsAppTy"><span class="hs-identifier hs-var">nlHsAppTy</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsTyVar"><span class="hs-identifier hs-var">nlHsTyVar</span></a><span> </span><a href="#local-1628289684"><span class="hs-identifier hs-var">ghciTy</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsTyVar"><span class="hs-identifier hs-var">nlHsTyVar</span></a><span> </span><a href="#local-1628289687"><span class="hs-identifier hs-var">a_tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1935"></a><span>        </span><a name="local-1628289689"><a href="#local-1628289689"><span class="hs-identifier">ioM</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#nlHsAppTy"><span class="hs-identifier hs-var">nlHsAppTy</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsTyVar"><span class="hs-identifier hs-var">nlHsTyVar</span></a><span> </span><a href="PrelNames.html#ioTyConName"><span class="hs-identifier hs-var">ioTyConName</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsTyVar"><span class="hs-identifier hs-var">nlHsTyVar</span></a><span> </span><a href="#local-1628289687"><span class="hs-identifier hs-var">a_tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1936"></a><span>
</span><a name="line-1937"></a><span>        </span><a name="local-1628289690"><a href="#local-1628289690"><span class="hs-identifier">step_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsTypes.html#HsForAllTy"><span class="hs-identifier hs-var">HsForAllTy</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsTypes.html#UserTyVar"><span class="hs-identifier hs-var">UserTyVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="#local-1628289687"><span class="hs-identifier hs-var">a_tv</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1938"></a><span>                                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#nlHsFunTy"><span class="hs-identifier hs-var">nlHsFunTy</span></a><span> </span><a href="#local-1628289688"><span class="hs-identifier hs-var">ghciM</span></a><span> </span><a href="#local-1628289689"><span class="hs-identifier hs-var">ioM</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1939"></a><span>
</span><a name="line-1940"></a><span>        </span><span class="hs-identifier">stepTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-1941"></a><span>        </span><a name="local-1628289691"><a href="#local-1628289691"><span class="hs-identifier">stepTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#mkEmptyImplicitBndrs"><span class="hs-identifier hs-var">mkEmptyImplicitBndrs</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#mkEmptyWildCardBndrs"><span class="hs-identifier hs-var">mkEmptyWildCardBndrs</span></a><span> </span><a href="#local-1628289690"><span class="hs-identifier hs-var">step_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1942"></a><span>
</span><a name="line-1943"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsExpr.html#ExprWithTySig"><span class="hs-identifier hs-var">ExprWithTySig</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a><span> </span><a href="PrelNames.html#ghciStepIoMName"><span class="hs-identifier hs-var">ghciStepIoMName</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628289691"><span class="hs-identifier hs-var">stepTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-1944"></a><span>
</span><a name="line-1945"></a><span class="hs-identifier">isGHCiMonad</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1946"></a><a name="isGHCiMonad"><a href="TcRnDriver.html#isGHCiMonad"><span class="hs-identifier">isGHCiMonad</span></a></a><span> </span><a name="local-1628289692"><a href="#local-1628289692"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628289693"><a href="#local-1628289693"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1947"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a><span> </span><a href="#local-1628289692"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1948"></a><span>        </span><a name="local-1628289694"><a href="#local-1628289694"><span class="hs-identifier">rdrEnv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a><span>
</span><a name="line-1949"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289695"><a href="#local-1628289695"><span class="hs-identifier">occIO</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-1628289694"><span class="hs-identifier hs-var">rdrEnv</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkOccName"><span class="hs-identifier hs-var">mkOccName</span></a><span> </span><a href="OccName.html#tcName"><span class="hs-identifier hs-var">tcName</span></a><span> </span><a href="#local-1628289693"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1950"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628289695"><span class="hs-identifier hs-var">occIO</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1951"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">[</span><a name="local-1628289696"><a href="#local-1628289696"><span class="hs-identifier">n</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1952"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289697"><a href="#local-1628289697"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-1628289696"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1953"></a><span>                </span><a name="local-1628289698"><a href="#local-1628289698"><span class="hs-identifier">ghciClass</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a><span> </span><a href="PrelNames.html#ghciIoClassName"><span class="hs-identifier hs-var">ghciIoClassName</span></a><span>
</span><a name="line-1954"></a><span>                </span><a name="local-1628289699"><a href="#local-1628289699"><span class="hs-identifier">userTyCon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a><span> </span><a href="#local-1628289697"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1955"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1628289700"><a href="#local-1628289700"><span class="hs-identifier">userTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628289699"><span class="hs-identifier hs-var">userTyCon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1956"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupInstance"><span class="hs-identifier hs-var">tcLookupInstance</span></a><span> </span><a href="#local-1628289698"><span class="hs-identifier hs-var">ghciClass</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628289700"><span class="hs-identifier hs-var">userTy</span></a><span class="hs-special">]</span><span>
</span><a name="line-1957"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289697"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1958"></a><span>
</span><a name="line-1959"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Ambiguous type!&quot;</span><span>
</span><a name="line-1960"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Can't find type:&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628289693"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1961"></a><span>
</span><a name="line-1962"></a><span class="hs-comment">-- tcRnExpr just finds the type of an expression</span><span>
</span><a name="line-1963"></a><span>
</span><a name="line-1964"></a><span class="hs-identifier">tcRnExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-1965"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1966"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1967"></a><span class="hs-comment">-- Type checks the expression and returns its most general type</span><span>
</span><a name="line-1968"></a><a name="tcRnExpr"><a href="TcRnDriver.html#tcRnExpr"><span class="hs-identifier">tcRnExpr</span></a></a><span> </span><a name="local-1628289701"><a href="#local-1628289701"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628289702"><a href="#local-1628289702"><span class="hs-identifier">rdr_expr</span></a></a><span>
</span><a name="line-1969"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a><span> </span><a href="#local-1628289701"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1970"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1971"></a><span>
</span><a name="line-1972"></a><span>    </span><span class="hs-special">(</span><a name="local-1628289703"><a href="#local-1628289703"><span class="hs-identifier">rn_expr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289704"><a href="#local-1628289704"><span class="hs-identifier">_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-1628289702"><span class="hs-identifier hs-var">rdr_expr</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1973"></a><span>    </span><a href="TcRnMonad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1974"></a><span>
</span><a name="line-1975"></a><span>        </span><span class="hs-comment">-- Now typecheck the expression, and generalise its type</span><span>
</span><a name="line-1976"></a><span>        </span><span class="hs-comment">-- it might have a rank-2 type (e.g. :t runST)</span><span>
</span><a name="line-1977"></a><span>    </span><a name="local-1628289705"><a href="#local-1628289705"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1978"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289706"><a href="#local-1628289706"><span class="hs-identifier">fresh_it</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelNames.html#itName"><span class="hs-identifier hs-var">itName</span></a><span> </span><a href="#local-1628289705"><span class="hs-identifier hs-var">uniq</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><a href="#local-1628289702"><span class="hs-identifier hs-var">rdr_expr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1979"></a><span>    </span><span class="hs-special">(</span><a name="local-1628289707"><a href="#local-1628289707"><span class="hs-identifier">tclvl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289708"><a href="#local-1628289708"><span class="hs-identifier">lie</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1628289709"><a href="#local-1628289709"><span class="hs-identifier">_tc_expr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289710"><a href="#local-1628289710"><span class="hs-identifier">res_ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier hs-var">pushLevelAndCaptureConstraints</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1980"></a><span>                                        </span><a href="TcExpr.html#tcInferSigma"><span class="hs-identifier hs-var">tcInferSigma</span></a><span> </span><a href="#local-1628289703"><span class="hs-identifier hs-var">rn_expr</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1981"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628289711"><a href="#local-1628289711"><span class="hs-identifier">qtvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289712"><a href="#local-1628289712"><span class="hs-identifier">dicts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628289713"><a href="#local-1628289713"><span class="hs-identifier">lie_top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1982"></a><span>                                   </span><span class="hs-pragma">{-# SCC &quot;simplifyInfer&quot; #-}</span><span>
</span><a name="line-1983"></a><span>                                   </span><a href="TcSimplify.html#simplifyInfer"><span class="hs-identifier hs-var">simplifyInfer</span></a><span> </span><a href="#local-1628289707"><span class="hs-identifier hs-var">tclvl</span></a><span>
</span><a name="line-1984"></a><span>                                                 </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">{- No MR for now -}</span><span>
</span><a name="line-1985"></a><span>                                                 </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">{- No sig vars -}</span><span>
</span><a name="line-1986"></a><span>                                                 </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1628289706"><span class="hs-identifier hs-var">fresh_it</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289710"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1987"></a><span>                                                 </span><a href="#local-1628289708"><span class="hs-identifier hs-var">lie</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1988"></a><span>    </span><span class="hs-comment">-- Wanted constraints from static forms</span><span>
</span><a name="line-1989"></a><span>    </span><a name="local-1628289714"><a href="#local-1628289714"><span class="hs-identifier">stWC</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcg_static_wc</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1990"></a><span>
</span><a name="line-1991"></a><span>    </span><span class="hs-comment">-- Ignore the dictionary bindings</span><span>
</span><a name="line-1992"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSimplify.html#simplifyInteractive"><span class="hs-identifier hs-var">simplifyInteractive</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#andWC"><span class="hs-identifier hs-var">andWC</span></a><span> </span><a href="#local-1628289714"><span class="hs-identifier hs-var">stWC</span></a><span> </span><a href="#local-1628289713"><span class="hs-identifier hs-var">lie_top</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1993"></a><span>
</span><a name="line-1994"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289715"><a href="#local-1628289715"><span class="hs-identifier">all_expr_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkInvForAllTys"><span class="hs-identifier hs-var">mkInvForAllTys</span></a><span> </span><a href="#local-1628289711"><span class="hs-identifier hs-var">qtvs</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkPiTypes"><span class="hs-identifier hs-var">mkPiTypes</span></a><span> </span><a href="#local-1628289712"><span class="hs-identifier hs-var">dicts</span></a><span> </span><a href="#local-1628289710"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1995"></a><span>    </span><a name="local-1628289716"><a href="#local-1628289716"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-1628289715"><span class="hs-identifier hs-var">all_expr_ty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1996"></a><span>
</span><a name="line-1997"></a><span>    </span><span class="hs-comment">-- We normalise type families, so that the type of an expression is the</span><span>
</span><a name="line-1998"></a><span>    </span><span class="hs-comment">-- same as of a bound expression (TcBinds.mkInferredPolyId). See Trac</span><span>
</span><a name="line-1999"></a><span>    </span><span class="hs-comment">-- #10321 for further discussion.</span><span>
</span><a name="line-2000"></a><span>    </span><a name="local-1628289717"><a href="#local-1628289717"><span class="hs-identifier">fam_envs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="FamInst.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-2001"></a><span>    </span><span class="hs-comment">-- normaliseType returns a coercion which we discard, so the Role is</span><span>
</span><a name="line-2002"></a><span>    </span><span class="hs-comment">-- irrelevant</span><span>
</span><a name="line-2003"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><span class="hs-special">(</span><a href="FamInstEnv.html#normaliseType"><span class="hs-identifier hs-var">normaliseType</span></a><span> </span><a href="#local-1628289717"><span class="hs-identifier hs-var">fam_envs</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-1628289716"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2004"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-2005"></a><span>
</span><a name="line-2006"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-2007"></a><span class="hs-identifier">tcRnImportDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-2008"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-2009"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2010"></a><span class="hs-comment">-- Find the new chunk of GlobalRdrEnv created by this list of import</span><span>
</span><a name="line-2011"></a><span class="hs-comment">-- decls.  In contract tcRnImports *extends* the TcGblEnv.</span><span>
</span><a name="line-2012"></a><a name="tcRnImportDecls"><a href="TcRnDriver.html#tcRnImportDecls"><span class="hs-identifier">tcRnImportDecls</span></a></a><span> </span><a name="local-1628289718"><a href="#local-1628289718"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628289719"><a href="#local-1628289719"><span class="hs-identifier">import_decls</span></a></a><span>
</span><a name="line-2013"></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a><span> </span><a href="#local-1628289718"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2014"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289722"><a href="#local-1628289722"><span class="hs-identifier">gbl_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a><span> </span><a href="#local-1628289720"><span class="hs-identifier hs-var">zap_rdr_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2015"></a><span>                    </span><a href="TcRnDriver.html#tcRnImports"><span class="hs-identifier hs-var">tcRnImports</span></a><span> </span><a href="#local-1628289718"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628289719"><span class="hs-identifier hs-var">import_decls</span></a><span>
</span><a name="line-2016"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_rdr_env</span><span> </span><a href="#local-1628289722"><span class="hs-identifier hs-var">gbl_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2017"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2018"></a><span>    </span><a name="local-1628289720"><a href="#local-1628289720"><span class="hs-identifier">zap_rdr_env</span></a></a><span> </span><a name="local-1628289721"><a href="#local-1628289721"><span class="hs-identifier">gbl_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628289721"><span class="hs-identifier hs-var">gbl_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_rdr_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-var">emptyGlobalRdrEnv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2019"></a><span>
</span><a name="line-2020"></a><span class="hs-comment">-- tcRnType just finds the kind of a type</span><span>
</span><a name="line-2021"></a><span>
</span><a name="line-2022"></a><span class="hs-identifier">tcRnType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-2023"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>        </span><span class="hs-comment">-- Normalise the returned type</span><span>
</span><a name="line-2024"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-2025"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2026"></a><a name="tcRnType"><a href="TcRnDriver.html#tcRnType"><span class="hs-identifier">tcRnType</span></a></a><span> </span><a name="local-1628289723"><a href="#local-1628289723"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628289724"><a href="#local-1628289724"><span class="hs-identifier">normalise</span></a></a><span> </span><a name="local-1628289725"><a href="#local-1628289725"><span class="hs-identifier">rdr_type</span></a></a><span>
</span><a name="line-2027"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a><span> </span><a href="#local-1628289723"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2028"></a><span>    </span><a href="TcRnMonad.html#setXOptM"><span class="hs-identifier hs-var">setXOptM</span></a><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html#PolyKinds"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">PolyKinds</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>   </span><span class="hs-comment">-- See Note [Kind-generalise in tcRnType]</span><span>
</span><a name="line-2029"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsWC"><span class="hs-identifier hs-var">HsWC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_wcs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289726"><a href="#local-1628289726"><span class="hs-identifier">wcs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hswc_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289727"><a href="#local-1628289727"><span class="hs-identifier">rn_type</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a name="local-1628289728"><a href="#local-1628289728"><span class="hs-identifier">_fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2030"></a><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsWcType"><span class="hs-identifier hs-var">rnHsWcType</span></a><span> </span><a href="RnEnv.html#GHCiCtx"><span class="hs-identifier hs-var">GHCiCtx</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#mkHsWildCardBndrs"><span class="hs-identifier hs-var">mkHsWildCardBndrs</span></a><span> </span><a href="#local-1628289725"><span class="hs-identifier hs-var">rdr_type</span></a><span class="hs-special">)</span><span>
</span><a name="line-2031"></a><span>                  </span><span class="hs-comment">-- The type can have wild cards, but no implicit</span><span>
</span><a name="line-2032"></a><span>                  </span><span class="hs-comment">-- generalisation; e.g.   :kind (T _)</span><span>
</span><a name="line-2033"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a><span>
</span><a name="line-2034"></a><span>
</span><a name="line-2035"></a><span>        </span><span class="hs-comment">-- Now kind-check the type</span><span>
</span><a name="line-2036"></a><span>        </span><span class="hs-comment">-- It can have any rank or kind</span><span>
</span><a name="line-2037"></a><span>        </span><span class="hs-comment">-- First bring into scope any wildcards</span><span>
</span><a name="line-2038"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcRnType&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289726"><span class="hs-identifier hs-var">wcs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289727"><span class="hs-identifier hs-var">rn_type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2039"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628289729"><a href="#local-1628289729"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628289730"><a href="#local-1628289730"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSimplify.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2040"></a><span>                       </span><a href="TcHsType.html#tcWildCardBinders"><span class="hs-identifier hs-var">tcWildCardBinders</span></a><span> </span><a href="#local-1628289726"><span class="hs-identifier hs-var">wcs</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2041"></a><span>                       </span><a href="TcHsType.html#tcLHsType"><span class="hs-identifier hs-var">tcLHsType</span></a><span> </span><a href="#local-1628289727"><span class="hs-identifier hs-var">rn_type</span></a><span>
</span><a name="line-2042"></a><span>
</span><a name="line-2043"></a><span>       </span><span class="hs-comment">-- Do kind generalisation; see Note [Kind-generalise in tcRnType]</span><span>
</span><a name="line-2044"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628289731"><a href="#local-1628289731"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#kindGeneralize"><span class="hs-identifier hs-var">kindGeneralize</span></a><span> </span><a href="#local-1628289730"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-2045"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628289732"><a href="#local-1628289732"><span class="hs-identifier">ty</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToType"><span class="hs-identifier hs-var">zonkTcTypeToType</span></a><span> </span><a href="TcHsSyn.html#emptyZonkEnv"><span class="hs-identifier hs-var">emptyZonkEnv</span></a><span> </span><a href="#local-1628289729"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2046"></a><span>
</span><a name="line-2047"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628289735"><a href="#local-1628289735"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628289724"><span class="hs-identifier hs-var">normalise</span></a><span>
</span><a name="line-2048"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628289733"><a href="#local-1628289733"><span class="hs-identifier">fam_envs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="FamInst.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a><span>
</span><a name="line-2049"></a><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628289734"><a href="#local-1628289734"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2050"></a><span>                                </span><span class="hs-glyph">=</span><span> </span><a href="FamInstEnv.html#normaliseType"><span class="hs-identifier hs-var">normaliseType</span></a><span> </span><a href="#local-1628289733"><span class="hs-identifier hs-var">fam_envs</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-1628289732"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2051"></a><span>                        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289734"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2052"></a><span>                </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628289732"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-2053"></a><span>
</span><a name="line-2054"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289735"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkInvForAllTys"><span class="hs-identifier hs-var">mkInvForAllTys</span></a><span> </span><a href="#local-1628289731"><span class="hs-identifier hs-var">kvs</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1628289735"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2055"></a><span>
</span><a name="line-2056"></a><span class="hs-comment">{- Note [Kind-generalise in tcRnType]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We switch on PolyKinds when kind-checking a user type, so that we will
kind-generalise the type, even when PolyKinds is not otherwise on.
This gives the right default behaviour at the GHCi prompt, where if
you say &quot;:k T&quot;, and T has a polymorphic kind, you'd like to see that
polymorphism. Of course.  If T isn't kind-polymorphic you won't get
anything unexpected, but the apparent *loss* of polymorphism, for
types that you know are polymorphic, is quite surprising.  See Trac
#7688 for a discussion.

Note that the goal is to generalise the *kind of the type*, not
the type itself! Example:
  ghci&gt; data T m a = MkT (m a)  -- T :: forall . (k -&gt; *) -&gt; k -&gt; *
  ghci&gt; :k T
We instantiate T to get (T kappa).  We do not want to kind-generalise
that to forall k. T k!  Rather we want to take its kind
   T kappa :: (kappa -&gt; *) -&gt; kappa -&gt; *
and now kind-generalise that kind, to forall k. (k-&gt;*) -&gt; k -&gt; *
(It was Trac #10122 that made me realise how wrong the previous
approach was.) -}</span><span>
</span><a name="line-2077"></a><span>
</span><a name="line-2078"></a><span>
</span><a name="line-2079"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                 tcRnDeclsi
*                                                                      *
************************************************************************

tcRnDeclsi exists to allow class, data, and other declarations in GHCi.
-}</span><span>
</span><a name="line-2088"></a><span>
</span><a name="line-2089"></a><span class="hs-identifier">tcRnDeclsi</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HscEnv</span><span>
</span><a name="line-2090"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">LHsDecl</span><span> </span><span class="hs-identifier">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-2091"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Messages</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">TcGblEnv</span><span class="hs-special">)</span><span>
</span><a name="line-2092"></a><span class="hs-identifier">tcRnDeclsi</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><span class="hs-identifier">local_decls</span><span>
</span><a name="line-2093"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runTcInteractive</span><span> </span><a name="local-1628289737"><a href="#local-1628289737"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628289737"><a href="#local-1628289737"><span class="hs-operator">$</span></a></a><span>
</span><a name="line-2094"></a><span>    </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">tcRnSrcDecls</span></a><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-identifier">local_decls</span><span>
</span><a name="line-2095"></a><span>
</span><a name="line-2096"></a><span class="hs-identifier">externaliseAndTidyId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Module</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-identifier">Id</span><span>
</span><a name="line-2097"></a><span class="hs-identifier">externaliseAndTidyId</span><span> </span><span class="hs-identifier">this_mod</span><span> </span><span class="hs-identifier">id</span><span>
</span><a name="line-2098"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="externaliseAndTidyId"><a href="TcRnDriver.html#externaliseAndTidyId"><span class="hs-identifier">name'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">externaliseName</span><span> </span><span class="hs-identifier">this_mod</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">idName</span><span> </span><span class="hs-identifier">id</span><span class="hs-special">)</span><span>
</span><a name="line-2099"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">globaliseAndTidyId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">setIdName</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-identifier">name'</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2100"></a><span>
</span><a name="line-2101"></a><span class="hs-cpp">#endif /* GHCi */</span><span>
</span><a name="line-2102"></a><span>
</span><a name="line-2103"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        More GHCi stuff, to do with browsing and getting info
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2110"></a><span>
</span><a name="line-2111"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-2112"></a><span class="hs-comment">-- | ASSUMES that the module is either in the 'HomePackageTable' or is</span><span>
</span><a name="line-2113"></a><span class="hs-comment">-- a package module with an interface on disk.  If neither of these is</span><span>
</span><a name="line-2114"></a><span class="hs-comment">-- true, then the result will be an error indicating the interface</span><span>
</span><a name="line-2115"></a><span class="hs-comment">-- could not be found.</span><span>
</span><a name="line-2116"></a><span class="hs-identifier">getModuleInterface</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HscEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Module</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Messages</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">ModIface</span><span class="hs-special">)</span><span>
</span><a name="line-2117"></a><span class="hs-identifier">getModuleInterface</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><span class="hs-identifier">mod</span><span>
</span><a name="line-2118"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runTcInteractive</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><a name="local-1628289742"><a href="#local-1628289742"><span class="hs-operator">$</span></a></a><span>
</span><a name="line-2119"></a><span>    </span><span class="hs-identifier">loadModuleInterface</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;getModuleInterface&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">mod</span><span>
</span><a name="line-2120"></a><span>
</span><a name="line-2121"></a><span class="hs-identifier">tcRnLookupRdrName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HscEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Located</span><span> </span><span class="hs-identifier">RdrName</span><span>
</span><a name="line-2122"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Messages</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2123"></a><span class="hs-comment">-- ^ Find all the Names that this RdrName could mean, in GHCi</span><span>
</span><a name="line-2124"></a><span class="hs-identifier">tcRnLookupRdrName</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">L</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-identifier">rdr_name</span><span class="hs-special">)</span><span>
</span><a name="line-2125"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runTcInteractive</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><a name="local-1628289744"><a href="#local-1628289744"><span class="hs-operator">$</span></a></a><span>
</span><a name="line-2126"></a><span>    </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">loc</span></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2127"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">-- If the identifier is a constructor (begins with an</span><span>
</span><a name="line-2128"></a><span>           </span><span class="hs-comment">-- upper-case letter), then we need to consider both</span><span>
</span><a name="line-2129"></a><span>           </span><span class="hs-comment">-- constructor and type class identifiers.</span><span>
</span><a name="line-2130"></a><span>         </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">rdr_names</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dataTcOccs</span><span> </span><span class="hs-identifier">rdr_name</span><span>
</span><a name="line-2131"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">names_s</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">lookupInfoOccRn</span><span> </span><span class="hs-identifier">rdr_names</span><span>
</span><a name="line-2132"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">names</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">concat</span><span> </span><a href="RnEnv.html#lookupInfoOccRn"><span class="hs-identifier hs-var">names_s</span></a><span>
</span><a name="line-2133"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">names</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">addErrTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Not in scope:&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">rdr_name</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2134"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">names</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2135"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-2136"></a><span>
</span><a name="line-2137"></a><span class="hs-identifier">tcRnLookupName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HscEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Messages</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">TyThing</span><span class="hs-special">)</span><span>
</span><a name="line-2138"></a><span class="hs-identifier">tcRnLookupName</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-2139"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runTcInteractive</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><span class="hs-operator">$</span><span>
</span><a name="line-2140"></a><span>    </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">tcRnLookupName'</span></a><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-2141"></a><span>
</span><a name="line-2142"></a><span class="hs-comment">-- To look up a name we have to look in the local environment (tcl_lcl)</span><span>
</span><a name="line-2143"></a><span class="hs-comment">-- as well as the global environment, which is what tcLookup does.</span><span>
</span><a name="line-2144"></a><span class="hs-comment">-- But we also want a TyThing, so we have to convert:</span><span>
</span><a name="line-2145"></a><span>
</span><a name="line-2146"></a><span class="hs-identifier">tcRnLookupName'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcRn</span><span> </span><span class="hs-identifier">TyThing</span><span>
</span><a name="line-2147"></a><span class="hs-identifier">tcRnLookupName'</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2148"></a><span>   </span><a name="tcRnLookupName%27"><a href="TcRnDriver.html#tcRnLookupName%27"><span class="hs-identifier">tcthing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcLookup</span><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-2149"></a><span>   </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">tcthing</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2150"></a><span>     </span><span class="hs-identifier">AGlobal</span><span> </span><span class="hs-identifier">thing</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">thing</span><span>
</span><a name="line-2151"></a><span>     </span><a href="TcRnTypes.html#AGlobal"><span class="hs-identifier hs-var">ATcId</span></a><span class="hs-special">{</span><span class="hs-identifier">tct_id</span><span class="hs-glyph">=</span><span class="hs-identifier">id</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628289753"><span class="hs-identifier hs-var">AnId</span></a><span> </span><span class="hs-identifier">id</span><span class="hs-special">)</span><span>
</span><a name="line-2152"></a><span>     </span><a href="TcRnTypes.html#ATcId"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">panic</span><span> </span><span class="hs-string">&quot;tcRnLookupName'&quot;</span><span>
</span><a name="line-2153"></a><span>
</span><a name="line-2154"></a><span class="hs-identifier">tcRnGetInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HscEnv</span><span>
</span><a name="line-2155"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-2156"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Messages</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyThing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Fixity</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">ClsInst</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">FamInst</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2157"></a><span>
</span><a name="line-2158"></a><span class="hs-comment">-- Used to implement :info in GHCi</span><span>
</span><a name="line-2159"></a><span class="hs-comment">--</span><span>
</span><a name="line-2160"></a><span class="hs-comment">-- Look up a RdrName and return all the TyThings it might be</span><span>
</span><a name="line-2161"></a><span class="hs-comment">-- A capitalised RdrName is given to us in the DataName namespace,</span><span>
</span><a name="line-2162"></a><span class="hs-comment">-- but we want to treat it as *both* a data constructor</span><span>
</span><a name="line-2163"></a><span class="hs-comment">--  *and* as a type or class constructor;</span><span>
</span><a name="line-2164"></a><span class="hs-comment">-- hence the call to dataTcOccs, and we return up to two results</span><span>
</span><a name="line-2165"></a><span class="hs-identifier">tcRnGetInfo</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-2166"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runTcInteractive</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><span class="hs-operator">$</span><span>
</span><a name="line-2167"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">loadUnqualIfaces</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_IC</span><span> </span><span class="hs-identifier">hsc_env</span><span class="hs-special">)</span><span>
</span><a name="line-2168"></a><span>           </span><span class="hs-comment">-- Load the interface for all unqualified types and classes</span><span>
</span><a name="line-2169"></a><span>           </span><span class="hs-comment">-- That way we will find all the instance declarations</span><span>
</span><a name="line-2170"></a><span>           </span><span class="hs-comment">-- (Packages have not orphan modules, and we assume that</span><span>
</span><a name="line-2171"></a><span>           </span><span class="hs-comment">--  in the home package all relevant modules are loaded.)</span><span>
</span><a name="line-2172"></a><span>
</span><a name="line-2173"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">thing</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcRnLookupName'</span><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-2174"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">fixity</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnDriver.html#tcRnLookupName%27"><span class="hs-identifier hs-var">lookupFixityRn</span></a><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-2175"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cls_insts</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#lookupFixityRn"><span class="hs-identifier hs-var">fam_insts</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">lookupInsts</span><span> </span><span class="hs-identifier">thing</span><span>
</span><a name="line-2176"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">thing</span><span class="hs-special">,</span><span> </span><a name="local-1628289760"><a href="#local-1628289760"><span class="hs-identifier">fixity</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cls_insts</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fam_insts</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2177"></a><span>
</span><a name="line-2178"></a><span class="hs-identifier">lookupInsts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyThing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier">ClsInst</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier">FamInst</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2179"></a><span class="hs-identifier">lookupInsts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ATyCon</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2180"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">InstEnvs</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ie_global</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pkg_ie</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ie_local</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">home_ie</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ie_visible</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">vis_mods</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcGetInstEnvs</span><span>
</span><a name="line-2181"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a href="InstEnv.html#InstEnvs"><span class="hs-identifier hs-var">pkg_fie</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">home_fie</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcGetFamInstEnvs</span><span>
</span><a name="line-2182"></a><span>                </span><span class="hs-comment">-- Load all instances for all classes that are</span><span>
</span><a name="line-2183"></a><span>                </span><span class="hs-comment">-- in the type environment (which are all the ones</span><span>
</span><a name="line-2184"></a><span>                </span><span class="hs-comment">-- we've seen in any interface file so far)</span><span>
</span><a name="line-2185"></a><span>
</span><a name="line-2186"></a><span>          </span><span class="hs-comment">-- Return only the instances relevant to the given thing, i.e.</span><span>
</span><a name="line-2187"></a><span>          </span><span class="hs-comment">-- the instances whose head contains the thing's name.</span><span>
</span><a name="line-2188"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">cls_insts</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2189"></a><span>                 </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">ispec</span><span>        </span><span class="hs-comment">-- Search all</span><span>
</span><a name="line-2190"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628289769"><span class="hs-identifier hs-var">ispec</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">instEnvElts</span><span> </span><span class="hs-identifier">home_ie</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">instEnvElts</span><span> </span><span class="hs-identifier">pkg_ie</span><span>
</span><a name="line-2191"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">instIsVisible</span><span> </span><span class="hs-identifier">vis_mods</span><span> </span><a href="#local-1628289764"><span class="hs-identifier hs-var">ispec</span></a><span>
</span><a name="line-2192"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="InstEnv.html#instIsVisible"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">elemNameSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">orphNamesOfClsInst</span><span> </span><span class="hs-identifier">ispec</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2193"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">fam_insts</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2194"></a><span>                 </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">fispec</span><span>
</span><a name="line-2195"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628289771"><span class="hs-identifier hs-var">fispec</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">famInstEnvElts</span><span> </span><span class="hs-identifier">home_fie</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">famInstEnvElts</span><span> </span><span class="hs-identifier">pkg_fie</span><span>
</span><a name="line-2196"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tc_name</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">elemNameSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">orphNamesOfFamInst</span><span> </span><a href="FamInstEnv.html#famInstEnvElts"><span class="hs-identifier hs-var">fispec</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2197"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cls_insts</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">fam_insts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2198"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2199"></a><span>    </span><span class="hs-identifier">tc_name</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><span class="hs-identifier">tc</span><span>
</span><a name="line-2200"></a><span>
</span><a name="line-2201"></a><span class="hs-identifier">lookupInsts</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2202"></a><span>
</span><a name="line-2203"></a><span class="hs-identifier">loadUnqualIfaces</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HscEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">InteractiveContext</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2204"></a><span class="hs-comment">-- Load the interface for everything that is in scope unqualified</span><span>
</span><a name="line-2205"></a><span class="hs-comment">-- This is so that we can accurately report the instances for</span><span>
</span><a name="line-2206"></a><span class="hs-comment">-- something</span><span>
</span><a name="line-2207"></a><span class="hs-identifier">loadUnqualIfaces</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><span class="hs-identifier">ictxt</span><span>
</span><a name="line-2208"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">initIfaceTcRn</span><span> </span><a name="local-1628289772"><a href="#local-1628289772"><span class="hs-operator">$</span></a></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2209"></a><span>    </span><a href="TcRnMonad.html#initIfaceTcRn"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">loadSysInterface</span><span> </span><span class="hs-identifier">doc</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleSetElts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkModuleSet</span><span> </span><span class="hs-identifier">unqual_mods</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2210"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2211"></a><span>    </span><span class="hs-identifier">this_pkg</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">thisPackage</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-identifier">hsc_env</span><span class="hs-special">)</span><span>
</span><a name="line-2212"></a><span>
</span><a name="line-2213"></a><span>    </span><span class="hs-identifier">unqual_mods</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">nameModule</span><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-2214"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a href="Name.html#nameModule"><span class="hs-identifier hs-var">gre</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">globalRdrEnvElts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_rn_gbl_env</span><span> </span><span class="hs-identifier">ictxt</span><span class="hs-special">)</span><span>
</span><a name="line-2215"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#globalRdrEnvElts"><span class="hs-identifier hs-var">gre_name</span></a><span> </span><a href="RdrName.html#globalRdrEnvElts"><span class="hs-identifier hs-var">gre</span></a><span>
</span><a name="line-2216"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nameIsFromExternalPackage</span><span> </span><span class="hs-identifier">this_pkg</span><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-2217"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="Name.html#nameIsFromExternalPackage"><span class="hs-identifier hs-var">isTcOcc</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameIsFromExternalPackage"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="Name.html#nameIsFromExternalPackage"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Types and classes only</span><span>
</span><a name="line-2218"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">unQualOK</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">gre</span></a><span> </span><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- In scope unqualified</span><span>
</span><a name="line-2219"></a><span>    </span><span class="hs-identifier">doc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Need interface for module whose export(s) are in scope unqualified&quot;</span><span>
</span><a name="line-2220"></a><span>
</span><a name="line-2221"></a><span class="hs-comment">{-
******************************************************************************
** Typechecking module exports
The renamer makes sure that only the correct pieces of a type or class can be
bundled with the type or class in the export list.

When it comes to pattern synonyms, in the renamer we have no way to check that
whether a pattern synonym should be allowed to be bundled or not so we allow
them to be bundled with any type or class. Here we then check that

1) Pattern synonyms are only bundled with types which are able to
   have data constructors. Datatypes, newtypes and data families.
2) Are the correct type, for example if P is a synonym
   then if we export Foo(P) then P should be an instance of Foo.

******************************************************************************
-}</span><span>
</span><a name="line-2238"></a><span>
</span><a name="line-2239"></a><span class="hs-identifier">tcExports</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">LIE</span><span> </span><span class="hs-identifier">Name</span><span class="hs-special">]</span><span>
</span><a name="line-2240"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2241"></a><span class="hs-identifier">tcExports</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2242"></a><a name="tcExports"><a href="TcRnDriver.html#tcExports"><span class="hs-identifier">tcExports</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">checkNoErrs</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">mapM_</span><span> </span><span class="hs-identifier">tc_export</span><span> </span><span class="hs-identifier">ies</span><span>
</span><a name="line-2243"></a><span>
</span><a name="line-2244"></a><span class="hs-identifier">tc_export</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">LIE</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2245"></a><span class="hs-identifier">tc_export</span><span> </span><span class="hs-identifier">ie</span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsImpExp.html#LIE"><span class="hs-identifier hs-type">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IEThingWith</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">names</span><span> </span><span class="hs-identifier">sels</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2246"></a><span>  </span><span class="hs-identifier">addExportErrCtxt</span><span> </span><a href="HsImpExp.html#IEThingWith"><span class="hs-identifier hs-var">ie</span></a><span>
</span><a name="line-2247"></a><span>    </span><a href="TcRnDriver.html#addExportErrCtxt"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">tc_export_with</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unLoc</span><span> </span><span class="hs-identifier">name</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">unLoc</span><span> </span><span class="hs-identifier">names</span><span>
</span><a name="line-2248"></a><span>                                    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-operator hs-var">++</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">flSelector</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">unLoc</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">sels</span><span class="hs-special">)</span><span>
</span><a name="line-2249"></a><span class="hs-identifier">tc_export</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2250"></a><span>
</span><a name="line-2251"></a><span class="hs-identifier">addExportErrCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">LIE</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-2252"></a><span class="hs-identifier">addExportErrCtxt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">L</span><span> </span><a href="HsImpExp.html#LIE"><span class="hs-identifier hs-type">l</span></a><span> </span><span class="hs-identifier">ie</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">setSrcSpan</span><span> </span><span class="hs-identifier">l</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-operator hs-type">.</span></a><span> </span><span class="hs-identifier">addErrCtxt</span><span> </span><span class="hs-identifier">exportCtxt</span><span>
</span><a name="line-2253"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2254"></a><span>    </span><span class="hs-identifier">exportCtxt</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;In the export:&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ie</span><span>
</span><a name="line-2255"></a><span>
</span><a name="line-2256"></a><span>
</span><a name="line-2257"></a><span class="hs-comment">-- Note: [Types of TyCon]</span><span>
</span><a name="line-2258"></a><span class="hs-comment">--</span><span>
</span><a name="line-2259"></a><span class="hs-comment">-- This check appears to be overlly complicated, Richard asked why it</span><span>
</span><a name="line-2260"></a><span class="hs-comment">-- is not simply just `isAlgTyCon`. The answer for this is that</span><span>
</span><a name="line-2261"></a><span class="hs-comment">-- a classTyCon is also an `AlgTyCon` which we explicitly want to disallow.</span><span>
</span><a name="line-2262"></a><span class="hs-comment">-- (It is either a newtype or data depending on the number of methods)</span><span>
</span><a name="line-2263"></a><span class="hs-comment">--</span><span>
</span><a name="line-2264"></a><span class="hs-comment">--</span><span>
</span><a name="line-2265"></a><span class="hs-comment">-- Note: [Typing Pattern Synonym Exports]</span><span>
</span><a name="line-2266"></a><span class="hs-comment">-- It proved quite a challenge to precisely specify which pattern synonyms</span><span>
</span><a name="line-2267"></a><span class="hs-comment">-- should be allowed to be bundled with which type constructors.</span><span>
</span><a name="line-2268"></a><span class="hs-comment">-- In the end it was decided to be quite liberal in what we allow. Below is</span><span>
</span><a name="line-2269"></a><span class="hs-comment">-- how Simon described the implementation.</span><span>
</span><a name="line-2270"></a><span class="hs-comment">--</span><span>
</span><a name="line-2271"></a><span class="hs-comment">-- &quot;Personally I think we should Keep It Simple.  All this talk of</span><span>
</span><a name="line-2272"></a><span class="hs-comment">--  satisfiability makes me shiver.  I suggest this: allow T( P ) in all</span><span>
</span><a name="line-2273"></a><span class="hs-comment">--   situations except where `P`'s type is ''visibly incompatible'' with</span><span>
</span><a name="line-2274"></a><span class="hs-comment">--   `T`.</span><span>
</span><a name="line-2275"></a><span class="hs-comment">--</span><span>
</span><a name="line-2276"></a><span class="hs-comment">--    What does &quot;visibly incompatible&quot; mean?  `P` is visibly incompatible</span><span>
</span><a name="line-2277"></a><span class="hs-comment">--    with</span><span>
</span><a name="line-2278"></a><span class="hs-comment">--     `T` if</span><span>
</span><a name="line-2279"></a><span class="hs-comment">--       * `P`'s type is of form `... -&gt; S t1 t2`</span><span>
</span><a name="line-2280"></a><span class="hs-comment">--       * `S` is a data/newtype constructor distinct from `T`</span><span>
</span><a name="line-2281"></a><span class="hs-comment">--</span><span>
</span><a name="line-2282"></a><span class="hs-comment">--  Nothing harmful happens if we allow `P` to be exported with</span><span>
</span><a name="line-2283"></a><span class="hs-comment">--  a type it can't possibly be useful for, but specifying a tighter</span><span>
</span><a name="line-2284"></a><span class="hs-comment">--  relationship is very awkward as you have discovered.&quot;</span><span>
</span><a name="line-2285"></a><span class="hs-comment">--</span><span>
</span><a name="line-2286"></a><span class="hs-comment">-- Note that this allows *any* pattern synonym to be bundled with any</span><span>
</span><a name="line-2287"></a><span class="hs-comment">-- datatype type constructor. For example, the following pattern `P` can be</span><span>
</span><a name="line-2288"></a><span class="hs-comment">-- bundled with any type.</span><span>
</span><a name="line-2289"></a><span class="hs-comment">--</span><span>
</span><a name="line-2290"></a><span class="hs-comment">-- ```</span><span>
</span><a name="line-2291"></a><span class="hs-comment">-- pattern P :: (A ~ f) =&gt; f</span><span>
</span><a name="line-2292"></a><span class="hs-comment">-- ```</span><span>
</span><a name="line-2293"></a><span class="hs-comment">--</span><span>
</span><a name="line-2294"></a><span class="hs-comment">-- So we provide basic type checking in order to help the user out, most</span><span>
</span><a name="line-2295"></a><span class="hs-comment">-- pattern synonyms are defined with definite type constructors, but don't</span><span>
</span><a name="line-2296"></a><span class="hs-comment">-- actually prevent a library author completely confusing their users if</span><span>
</span><a name="line-2297"></a><span class="hs-comment">-- they want to.</span><span>
</span><a name="line-2298"></a><span>
</span><a name="line-2299"></a><span class="hs-identifier">exportErrCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Outputable</span><span> </span><span class="hs-identifier">o</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">o</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-2300"></a><span class="hs-identifier">exportErrCtxt</span><span> </span><span class="hs-identifier">herald</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">exp</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2301"></a><span>  </span><a name="exportErrCtxt"><a href="TcRnDriver.html#exportErrCtxt"><span class="hs-identifier">text</span></a></a><span> </span><span class="hs-string">&quot;In the&quot;</span><span> </span><a name="local-1628289787"><a href="#local-1628289787"><span class="hs-operator">&lt;+&gt;</span></a></a><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">herald</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">exp</span><span>
</span><a name="line-2302"></a><span>
</span><a name="line-2303"></a><span class="hs-identifier">tc_export_with</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Name</span><span>  </span><span class="hs-comment">-- ^ Type constructor</span><span>
</span><a name="line-2304"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Name</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ A mixture of data constructors, pattern syonyms</span><span>
</span><a name="line-2305"></a><span>                         </span><span class="hs-comment">-- , class methods and record selectors.</span><span>
</span><a name="line-2306"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2307"></a><span class="hs-identifier">tc_export_with</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">ns</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2308"></a><span>  </span><a name="tc_export_with"><a href="TcRnDriver.html#tc_export_with"><span class="hs-identifier">ty_con</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcLookupTyCon</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-2309"></a><span>  </span><a name="local-1628289801"><a href="#local-1628289801"><span class="hs-identifier">things</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupTyCon"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-identifier">tcLookupGlobal</span><span> </span><span class="hs-identifier">ns</span><span>
</span><a name="line-2310"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">psErr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">exportErrCtxt</span><span> </span><span class="hs-string">&quot;pattern synonym&quot;</span><span>
</span><a name="line-2311"></a><span>      </span><span class="hs-identifier">selErr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">exportErrCtxt</span><span> </span><span class="hs-string">&quot;pattern synonym record selector&quot;</span><span>
</span><a name="line-2312"></a><span>      </span><a name="local-1628289804"><a href="#local-1628289804"><span class="hs-identifier">ps</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcRnDriver.html#exportErrCtxt"><span class="hs-identifier hs-var">psErr</span></a><span> </span><a href="TcRnDriver.html#exportErrCtxt"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><a href="TcRnDriver.html#exportErrCtxt"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">AConLike</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PatSynCon</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">things</span><span class="hs-special">]</span><span>
</span><a name="line-2313"></a><span>      </span><span class="hs-identifier">sels</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">selErr</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ConLike.html#PatSynCon"><span class="hs-identifier hs-var">things</span></a><span>
</span><a name="line-2314"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isId</span><span> </span><span class="hs-identifier">i</span><span>
</span><a name="line-2315"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">RecSelId</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">sel_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">RecSelPatSyn</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">idDetails</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-2316"></a><span>      </span><span class="hs-identifier">pat_syns</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ps</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">sels</span><span>
</span><a name="line-2317"></a><span>
</span><a name="line-2318"></a><span>
</span><a name="line-2319"></a><span>  </span><span class="hs-comment">-- See note [Types of TyCon]</span><span>
</span><a name="line-2320"></a><span>  </span><span class="hs-identifier">checkTc</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">pat_syns</span><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">isTyConWithSrcDataCons</span><span> </span><span class="hs-identifier">ty_con</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">assocClassErr</span><span>
</span><a name="line-2321"></a><span>
</span><a name="line-2322"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">actual_res_ty</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2323"></a><span>          </span><span class="hs-identifier">mkTyConApp</span><span> </span><span class="hs-identifier">ty_con</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkTyVarTys</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><span class="hs-identifier">ty_con</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2324"></a><span>  </span><span class="hs-identifier">mapM_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tc_one_export_with</span><span> </span><span class="hs-identifier">actual_res_ty</span><span> </span><span class="hs-identifier">ty_con</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">pat_syns</span><span>
</span><a name="line-2325"></a><span>
</span><a name="line-2326"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2327"></a><span>    </span><span class="hs-identifier">assocClassErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-2328"></a><span>    </span><span class="hs-identifier">assocClassErr</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2329"></a><span>      </span><a name="local-1628289791"><a href="#local-1628289791"><span class="hs-identifier">text</span></a></a><span> </span><span class="hs-string">&quot;Pattern synonyms can be bundled only with datatypes.&quot;</span><span>
</span><a name="line-2330"></a><span>
</span><a name="line-2331"></a><span>
</span><a name="line-2332"></a><span>    </span><span class="hs-identifier">tc_one_export_with</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TcTauType</span><span> </span><span class="hs-comment">-- ^ TyCon type</span><span>
</span><a name="line-2333"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTauType"><span class="hs-identifier hs-type">TyCon</span></a><span>       </span><span class="hs-comment">-- ^ Parent TyCon</span><span>
</span><a name="line-2334"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">PatSyn</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ Corresponding bundled PatSyn</span><span>
</span><a name="line-2335"></a><span>                                           </span><span class="hs-comment">-- and pretty printed origin</span><span>
</span><a name="line-2336"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2337"></a><span>    </span><span class="hs-identifier">tc_one_export_with</span><span> </span><span class="hs-identifier">actual_res_ty</span><span> </span><span class="hs-identifier">ty_con</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">errCtxt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_syn</span><span class="hs-special">)</span><span>
</span><a name="line-2338"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289792"><a href="#local-1628289792"><span class="hs-identifier">addErrCtxt</span></a></a><span> </span><span class="hs-identifier">errCtxt</span><span> </span><a name="local-1628289793"><a href="#local-1628289793"><span class="hs-operator">$</span></a></a><span>
</span><a name="line-2339"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">,</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">,</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289795"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628289795"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">res_ty</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">patSynSig</span><span> </span><span class="hs-identifier">pat_syn</span><span>
</span><a name="line-2340"></a><span>          </span><span class="hs-identifier">mtycon</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcSplitTyConApp_maybe</span><span> </span><span class="hs-identifier">res_ty</span><span>
</span><a name="line-2341"></a><span>          </span><span class="hs-identifier">typeMismatchError</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">SDoc</span></a><span>
</span><a name="line-2342"></a><span>          </span><span class="hs-identifier">typeMismatchError</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2343"></a><span>            </span><a name="local-1628289799"><a href="#local-1628289799"><span class="hs-identifier">text</span></a></a><span> </span><span class="hs-string">&quot;Pattern synonyms can only be bundled with matching type constructors&quot;</span><span>
</span><a name="line-2344"></a><span>                </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Couldn't match expected type of&quot;</span><span>
</span><a name="line-2345"></a><span>                </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">actual_res_ty</span><span class="hs-special">)</span><span>
</span><a name="line-2346"></a><span>                </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;with actual type of&quot;</span><span>
</span><a name="line-2347"></a><span>                </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-identifier">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">res_ty</span><span class="hs-special">)</span><span>
</span><a name="line-2348"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">mtycon</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2349"></a><span>            </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2350"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">p_ty_con</span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2351"></a><span>              </span><span class="hs-comment">-- See note [Typing Pattern Synonym Exports]</span><span>
</span><a name="line-2352"></a><span>              </span><span class="hs-identifier">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">p_ty_con</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">ty_con</span><span class="hs-special">)</span><span>
</span><a name="line-2353"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier">addErrTc</span><span> </span><span class="hs-identifier">typeMismatchError</span><span class="hs-special">)</span><span>
</span><a name="line-2354"></a><span>
</span><a name="line-2355"></a><span>
</span><a name="line-2356"></a><span>
</span><a name="line-2357"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Degugging output
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2364"></a><span>
</span><a name="line-2365"></a><span class="hs-identifier">rnDump</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcRn</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2366"></a><span class="hs-comment">-- Dump, with a banner, if -ddump-rn</span><span>
</span><a name="line-2367"></a><span class="hs-identifier">rnDump</span><span> </span><span class="hs-identifier">doc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">traceOptTcRn</span><span> </span><span class="hs-identifier">Opt_D_dump_rn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkDumpDoc</span><span> </span><span class="hs-string">&quot;Renamer&quot;</span><span> </span><span class="hs-identifier">doc</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2368"></a><span>
</span><a name="line-2369"></a><span class="hs-identifier">tcDump</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TcGblEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcRn</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2370"></a><span class="hs-identifier">tcDump</span><span> </span><span class="hs-identifier">env</span><span>
</span><a name="line-2371"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dflags</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getDynFlags</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-2372"></a><span>
</span><a name="line-2373"></a><span>        </span><span class="hs-comment">-- Dump short output if -ddump-types or -ddump-tc</span><span>
</span><a name="line-2374"></a><span>        </span><span class="hs-identifier">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dopt</span><span> </span><span class="hs-identifier">Opt_D_dump_types</span><span> </span><span class="hs-identifier">dflags</span><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">dopt</span><span> </span><span class="hs-identifier">Opt_D_dump_tc</span><span> </span><span class="hs-identifier">dflags</span><span class="hs-special">)</span><span>
</span><a name="line-2375"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier">printForUserTcRn</span><span> </span><span class="hs-identifier">short_dump</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-2376"></a><span>
</span><a name="line-2377"></a><span>        </span><span class="hs-comment">-- Dump bindings if -ddump-tc</span><span>
</span><a name="line-2378"></a><span>        </span><span class="hs-identifier">traceOptTcRn</span><span> </span><span class="hs-identifier">Opt_D_dump_tc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkDumpDoc</span><span> </span><span class="hs-string">&quot;Typechecker&quot;</span><span> </span><span class="hs-identifier">full_dump</span><span class="hs-special">)</span><span>
</span><a name="line-2379"></a><span>   </span><span class="hs-special">}</span><span>
</span><a name="line-2380"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2381"></a><span>    </span><span class="hs-identifier">short_dump</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pprTcGblEnv</span><span> </span><span class="hs-identifier">env</span><span>
</span><a name="line-2382"></a><span>    </span><a name="local-1628289814"><a href="#local-1628289814"><span class="hs-identifier">full_dump</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnDriver.html#pprTcGblEnv"><span class="hs-identifier hs-var">pprLHsBinds</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_binds</span><span> </span><span class="hs-identifier">env</span><span class="hs-special">)</span><span>
</span><a name="line-2383"></a><span>        </span><span class="hs-comment">-- NB: foreign x-d's have undefined's in their types;</span><span>
</span><a name="line-2384"></a><span>        </span><span class="hs-comment">--     hence can't show the tc_fords</span><span>
</span><a name="line-2385"></a><span>
</span><a name="line-2386"></a><span class="hs-comment">-- It's unpleasant having both pprModGuts and pprModDetails here</span><span>
</span><a name="line-2387"></a><span class="hs-identifier">pprTcGblEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TcGblEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-2388"></a><span class="hs-identifier">pprTcGblEnv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TcGblEnv</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_type_env</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">type_env</span><span class="hs-special">,</span><span>
</span><a name="line-2389"></a><span>                        </span><span class="hs-identifier">tcg_insts</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289817"><a href="#local-1628289817"><span class="hs-identifier">insts</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-2390"></a><span>                        </span><span class="hs-identifier">tcg_fam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fam_insts</span><span class="hs-special">,</span><span>
</span><a name="line-2391"></a><span>                        </span><span class="hs-identifier">tcg_rules</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289819"><a href="#local-1628289819"><span class="hs-identifier">rules</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-2392"></a><span>                        </span><span class="hs-identifier">tcg_vects</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628289820"><a href="#local-1628289820"><span class="hs-identifier">vects</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-2393"></a><span>                        </span><span class="hs-identifier">tcg_imports</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">imports</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2394"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">ppr_types</span><span> </span><span class="hs-identifier">type_env</span><span>
</span><a name="line-2395"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr_tycons</span><span> </span><span class="hs-identifier">fam_insts</span><span> </span><span class="hs-identifier">type_env</span><span>
</span><a name="line-2396"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="TcRnDriver.html#ppr_tycons"><span class="hs-identifier hs-var">ppr_insts</span></a><span> </span><span class="hs-identifier">insts</span><span>
</span><a name="line-2397"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr_fam_insts</span><span> </span><span class="hs-identifier">fam_insts</span><span>
</span><a name="line-2398"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="TcRnDriver.html#ppr_fam_insts"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="TcRnDriver.html#ppr_fam_insts"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TcRnDriver.html#ppr_fam_insts"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289819"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">)</span><span>
</span><a name="line-2399"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628289820"><span class="hs-identifier hs-var">vects</span></a><span class="hs-special">)</span><span>
</span><a name="line-2400"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Dependent modules:&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span>
</span><a name="line-2401"></a><span>                </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sortBy</span><span> </span><span class="hs-identifier">cmp_mp</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">eltsUFM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">imp_dep_mods</span><span> </span><span class="hs-identifier">imports</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2402"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Dependent packages:&quot;</span><span> </span><a href="UniqFM.html#eltsUFM"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-2403"></a><span>                </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sortBy</span><span> </span><span class="hs-identifier">stableUnitIdCmp</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">imp_dep_pkgs</span><span> </span><span class="hs-identifier">imports</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2404"></a><span>  </span><span class="hs-keyword">where</span><span>         </span><span class="hs-comment">-- The two uses of sortBy are just to reduce unnecessary</span><span>
</span><a name="line-2405"></a><span>                </span><span class="hs-comment">-- wobbling in testsuite output</span><span>
</span><a name="line-2406"></a><span>    </span><span class="hs-identifier">cmp_mp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mod_name1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_boot1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mod_name2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_boot2</span><span class="hs-special">)</span><span>
</span><a name="line-2407"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mod_name1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">stableModuleNameCmp</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">mod_name2</span><span class="hs-special">)</span><span>
</span><a name="line-2408"></a><span>                  </span><span class="hs-special">`</span><span class="hs-identifier">thenCmp</span><span class="hs-special">`</span><span>
</span><a name="line-2409"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier">is_boot1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">compare</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is_boot2</span><span class="hs-special">)</span><span>
</span><a name="line-2410"></a><span>
</span><a name="line-2411"></a><span class="hs-identifier">ppr_types</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TypeEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-2412"></a><span class="hs-identifier">ppr_types</span><span> </span><span class="hs-identifier">type_env</span><span>
</span><a name="line-2413"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ppr_types"><a href="TcRnDriver.html#ppr_types"><span class="hs-identifier">text</span></a></a><span> </span><span class="hs-string">&quot;TYPE SIGNATURES&quot;</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr_sigs</span><span> </span><span class="hs-identifier">ids</span><span class="hs-special">)</span><span>
</span><a name="line-2414"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2415"></a><span>    </span><span class="hs-identifier">ids</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">id</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">id</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">typeEnvIds</span><span> </span><span class="hs-identifier">type_env</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">want_sig</span><span> </span><span class="hs-identifier">id</span><span class="hs-special">]</span><span>
</span><a name="line-2416"></a><span>    </span><span class="hs-identifier">want_sig</span><span> </span><span class="hs-identifier">id</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">opt_PprStyle_Debug</span><span>
</span><a name="line-2417"></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="StaticFlags.html#opt_PprStyle_Debug"><span class="hs-identifier hs-var">True</span></a><span>
</span><a name="line-2418"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>
</span><a name="line-2419"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">idName</span><span> </span><span class="hs-identifier">id</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&amp;&amp;</span><span>
</span><a name="line-2420"></a><span>                  </span><span class="hs-special">(</span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">isDerivedOccName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getOccName</span><span> </span><span class="hs-identifier">id</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2421"></a><span>        </span><span class="hs-comment">-- Top-level user-defined things have External names.</span><span>
</span><a name="line-2422"></a><span>        </span><span class="hs-comment">-- Suppress internally-generated things unless -dppr-debug</span><span>
</span><a name="line-2423"></a><span>
</span><a name="line-2424"></a><span class="hs-identifier">ppr_tycons</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">FamInst</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TypeEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-2425"></a><span class="hs-identifier">ppr_tycons</span><span> </span><span class="hs-identifier">fam_insts</span><span> </span><span class="hs-identifier">type_env</span><span>
</span><a name="line-2426"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ppr_tycons"><a href="TcRnDriver.html#ppr_tycons"><span class="hs-identifier">vcat</span></a></a><span> </span><span class="hs-special">[</span><span> </span><a name="local-1628289833"><a href="#local-1628289833"><span class="hs-identifier">text</span></a></a><span> </span><span class="hs-string">&quot;TYPE CONSTRUCTORS&quot;</span><span>
</span><a name="line-2427"></a><span>         </span><span class="hs-special">,</span><span>   </span><span class="hs-identifier">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr_tydecls</span><span> </span><span class="hs-identifier">tycons</span><span class="hs-special">)</span><span>
</span><a name="line-2428"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;COERCION AXIOMS&quot;</span><span>
</span><a name="line-2429"></a><span>         </span><span class="hs-special">,</span><span>   </span><span class="hs-identifier">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">pprCoAxiom</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">typeEnvCoAxioms</span><span> </span><span class="hs-identifier">type_env</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2430"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2431"></a><span>    </span><span class="hs-identifier">fi_tycons</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">famInstsRepTyCons</span><span> </span><span class="hs-identifier">fam_insts</span><span>
</span><a name="line-2432"></a><span>    </span><a name="local-1628289835"><a href="#local-1628289835"><span class="hs-identifier">tycons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">tycon</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="FamInstEnv.html#famInstsRepTyCons"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">typeEnvTyCons</span><span> </span><span class="hs-identifier">type_env</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">want_tycon</span><span> </span><span class="hs-identifier">tycon</span><span class="hs-special">]</span><span>
</span><a name="line-2433"></a><span>    </span><span class="hs-identifier">want_tycon</span><span> </span><span class="hs-identifier">tycon</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">opt_PprStyle_Debug</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-2434"></a><span>                     </span><span class="hs-glyph">|</span><span> </span><a href="StaticFlags.html#opt_PprStyle_Debug"><span class="hs-identifier hs-var">otherwise</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isImplicitTyCon</span><span> </span><span class="hs-identifier">tycon</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&amp;&amp;</span><span>
</span><a name="line-2435"></a><span>                                            </span><span class="hs-identifier">isExternalName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConName</span><span> </span><span class="hs-identifier">tycon</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&amp;&amp;</span><span>
</span><a name="line-2436"></a><span>                                            </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">fi_tycons</span><span class="hs-special">)</span><span>
</span><a name="line-2437"></a><span>
</span><a name="line-2438"></a><span class="hs-identifier">ppr_insts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">ClsInst</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-2439"></a><span class="hs-identifier">ppr_insts</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">empty</span><span>
</span><a name="line-2440"></a><a name="ppr_insts"><a href="TcRnDriver.html#ppr_insts"><span class="hs-identifier">ppr_insts</span></a></a><span> </span><span class="hs-identifier">ispecs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;INSTANCES&quot;</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pprInstances</span><span> </span><span class="hs-identifier">ispecs</span><span class="hs-special">)</span><span>
</span><a name="line-2441"></a><span>
</span><a name="line-2442"></a><span class="hs-identifier">ppr_fam_insts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">FamInst</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-2443"></a><span class="hs-identifier">ppr_fam_insts</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">empty</span><span>
</span><a name="line-2444"></a><a name="ppr_fam_insts"><a href="TcRnDriver.html#ppr_fam_insts"><span class="hs-identifier">ppr_fam_insts</span></a></a><span> </span><span class="hs-identifier">fam_insts</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2445"></a><span>  </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;FAMILY INSTANCES&quot;</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pprFamInsts</span><span> </span><span class="hs-identifier">fam_insts</span><span class="hs-special">)</span><span>
</span><a name="line-2446"></a><span>
</span><a name="line-2447"></a><span class="hs-identifier">ppr_sigs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-2448"></a><span class="hs-identifier">ppr_sigs</span><span> </span><span class="hs-identifier">ids</span><span>
</span><a name="line-2449"></a><span>        </span><span class="hs-comment">-- Print type signatures; sort by OccName</span><span>
</span><a name="line-2450"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">ppr_sig</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">comparing</span><span> </span><span class="hs-identifier">getOccName</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ids</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2451"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2452"></a><span>    </span><span class="hs-identifier">ppr_sig</span><span> </span><span class="hs-identifier">id</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">id</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">dcolon</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tidyTopType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">idType</span><span> </span><span class="hs-identifier">id</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2453"></a><span>
</span><a name="line-2454"></a><span class="hs-identifier">ppr_tydecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">TyCon</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-2455"></a><span class="hs-identifier">ppr_tydecls</span><span> </span><span class="hs-identifier">tycons</span><span>
</span><a name="line-2456"></a><span>        </span><span class="hs-comment">-- Print type constructor info; sort by OccName</span><span>
</span><a name="line-2457"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">ppr_tycon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">comparing</span><span> </span><span class="hs-identifier">getOccName</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tycons</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2458"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2459"></a><span>    </span><span class="hs-identifier">ppr_tycon</span><span> </span><span class="hs-identifier">tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyThingToIfaceDecl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ATyCon</span><span> </span><span class="hs-identifier">tycon</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2460"></a><span>
</span><a name="line-2461"></a><span class="hs-comment">{-
********************************************************************************

Type Checker Plugins

********************************************************************************
-}</span><span>
</span><a name="line-2468"></a><span>
</span><a name="line-2469"></a><span class="hs-identifier">withTcPlugins</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HscEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-2470"></a><span class="hs-identifier">withTcPlugins</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2471"></a><span>  </span><span class="hs-keyword">do</span><span> </span><a name="withTcPlugins"><a href="TcRnDriver.html#withTcPlugins"><span class="hs-identifier">plugins</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">liftIO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">loadTcPlugins</span><span> </span><span class="hs-identifier">hsc_env</span><span class="hs-special">)</span><span>
</span><a name="line-2472"></a><span>     </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">plugins</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2473"></a><span>       </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628289855"><span class="hs-identifier hs-var">m</span></a><span>  </span><span class="hs-comment">-- Common fast case</span><span>
</span><a name="line-2474"></a><span>       </span><span class="hs-identifier hs-var">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">solvers</span><span class="hs-special">,</span><span class="hs-identifier">stops</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unzip</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">startPlugin</span><span> </span><span class="hs-identifier">plugins</span><span>
</span><a name="line-2475"></a><span>                </span><span class="hs-comment">-- This ensures that tcPluginStop is called even if a type</span><span>
</span><a name="line-2476"></a><span>                </span><span class="hs-comment">-- error occurs during compilation (Fix of #10078)</span><span>
</span><a name="line-2477"></a><span>                </span><span class="hs-identifier">eitherRes</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tryM</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2478"></a><span>                  </span><span class="hs-identifier">updGblEnv</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a href="IOEnv.html#tryM"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_tc_plugins</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">solvers</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">m</span><span>
</span><a name="line-2479"></a><span>                </span><span class="hs-identifier">mapM_</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#updGblEnv"><span class="hs-identifier hs-var">flip</span></a><span> </span><span class="hs-identifier">runTcPluginM</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">stops</span><span>
</span><a name="line-2480"></a><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">eitherRes</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2481"></a><span>                  </span><span class="hs-identifier">Left</span><span> </span><a href="#local-1628289859"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">failM</span><span>
</span><a name="line-2482"></a><span>                  </span><span class="hs-identifier">Right</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">res</span><span>
</span><a name="line-2483"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2484"></a><span>  </span><span class="hs-identifier">startPlugin</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TcPlugin</span><span> </span><span class="hs-identifier">start</span><span> </span><span class="hs-identifier">solve</span><span> </span><span class="hs-identifier">stop</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2485"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-1628289850"><a href="#local-1628289850"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">runTcPluginM</span><span> </span><span class="hs-identifier">start</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-2486"></a><span>       </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#runTcPluginM"><span class="hs-identifier hs-var">solve</span></a><span> </span><a href="TcRnTypes.html#runTcPluginM"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">stop</span><span> </span><a href="#local-1628289851"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-2487"></a><span>
</span><a name="line-2488"></a><span class="hs-identifier">loadTcPlugins</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HscEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">TcPlugin</span><span class="hs-special">]</span><span>
</span><a name="line-2489"></a><span class="hs-cpp">#ifndef GHCI</span><span>
</span><a name="line-2490"></a><span class="hs-identifier">loadTcPlugins</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2491"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-2492"></a><span class="hs-identifier">loadTcPlugins</span><span> </span><span class="hs-identifier">hsc_env</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2493"></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">named_plugins</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">loadPlugins</span><span> </span><span class="hs-identifier">hsc_env</span><span>
</span><a name="line-2494"></a><span>    </span><a name="local-1628289865"><a href="#local-1628289865"><span class="hs-identifier">return</span></a></a><span> </span><a name="local-1628289865"><a href="#local-1628289865"><span class="hs-operator">$</span></a></a><span> </span><span class="hs-identifier">catMaybes</span><span> </span><a href="DynamicLoading.html#loadPlugins"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DynamicLoading.html#loadPlugins"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">load_plugin</span><span> </span><span class="hs-identifier">named_plugins</span><span>
</span><a name="line-2495"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2496"></a><span>    </span><span class="hs-identifier">load_plugin</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">plug</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">opts</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcPlugin</span><span> </span><span class="hs-identifier">plug</span><span> </span><span class="hs-identifier">opts</span><span>
</span><a name="line-2497"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-2498"></a></pre></body></html>