<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><a name="line-2"></a><span class="hs-comment">-- | Generate methods for the PA class.</span><span>
</span><a name="line-3"></a><span class="hs-comment">--</span><span>
</span><a name="line-4"></a><span class="hs-comment">--   TODO: there is a large amount of redundancy here between the</span><span>
</span><a name="line-5"></a><span class="hs-comment">--   a, PData a, and PDatas a forms. See if we can factor some of this out.</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Vectorise</span><span class="hs-operator">.</span><span class="hs-identifier">Generic</span><span class="hs-operator">.</span><span class="hs-identifier">PAMethods</span><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Vectorise.Generic.PAMethods.html#buildPReprTyCon"><span class="hs-identifier hs-var">buildPReprTyCon</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Vectorise.Generic.PAMethods.html#buildPAScAndMethods"><span class="hs-identifier hs-var">buildPAScAndMethods</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><a href="Vectorise.Utils.html"><span class="hs-identifier">Vectorise</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><a href="Vectorise.Monad.html"><span class="hs-identifier">Vectorise</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Vectorise.Builtins.html"><span class="hs-identifier">Vectorise</span><span class="hs-operator">.</span><span class="hs-identifier">Builtins</span></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><a href="Vectorise.Generic.Description.html"><span class="hs-identifier">Vectorise</span><span class="hs-operator">.</span><span class="hs-identifier">Generic</span><span class="hs-operator">.</span><span class="hs-identifier">Description</span></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="CoreUtils.html"><span class="hs-identifier">CoreUtils</span></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="MkCore.html"><span class="hs-identifier">MkCore</span></a><span>            </span><span class="hs-special">(</span><span> </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkCoreLet"><span class="hs-identifier hs-var">mkCoreLet</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="CoAxiom.html"><span class="hs-identifier">CoAxiom</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="OccName.html"><span class="hs-identifier">OccName</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="MkId.html"><span class="hs-identifier">MkId</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="FamInst.html"><span class="hs-identifier">FamInst</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="TysPrim.html"><span class="hs-identifier">TysPrim</span></a><span class="hs-special">(</span><span> </span><a href="TysPrim.html#intPrimTy"><span class="hs-identifier hs-var">intPrimTy</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="MonadUtils.html"><span class="hs-identifier">MonadUtils</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-identifier">buildPReprTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Generic.Description.html#SumRepr"><span class="hs-identifier hs-type">SumRepr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Monad.Base.html#VM"><span class="hs-identifier hs-type">VM</span></a><span> </span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span>
</span><a name="line-37"></a><a name="buildPReprTyCon"><a href="Vectorise.Generic.PAMethods.html#buildPReprTyCon"><span class="hs-identifier">buildPReprTyCon</span></a></a><span> </span><a name="local-1628117225"><a href="#local-1628117225"><span class="hs-identifier">orig_tc</span></a></a><span> </span><a name="local-1628117226"><a href="#local-1628117226"><span class="hs-identifier">vect_tc</span></a></a><span> </span><a name="local-1628117227"><a href="#local-1628117227"><span class="hs-identifier">repr</span></a></a><span>
</span><a name="line-38"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117230"><a href="#local-1628117230"><span class="hs-identifier">name</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#mkLocalisedName"><span class="hs-identifier hs-var">mkLocalisedName</span></a><span> </span><a href="OccName.html#mkPReprTyConOcc"><span class="hs-identifier hs-var">mkPReprTyConOcc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-1628117225"><span class="hs-identifier hs-var">orig_tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span>      </span><a name="local-1628117231"><a href="#local-1628117231"><span class="hs-identifier">rhs_ty</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Generic.Description.html#sumReprType"><span class="hs-identifier hs-var">sumReprType</span></a><span> </span><a href="#local-1628117227"><span class="hs-identifier hs-var">repr</span></a><span>
</span><a name="line-40"></a><span>      </span><a name="local-1628117232"><a href="#local-1628117232"><span class="hs-identifier">prepr_tc</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.html#builtin"><span class="hs-identifier hs-var">builtin</span></a><span> </span><span class="hs-identifier">preprTyCon</span><span>
</span><a name="line-41"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117233"><a href="#local-1628117233"><span class="hs-identifier">axiom</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FamInstEnv.html#mkSingleCoAxiom"><span class="hs-identifier hs-var">mkSingleCoAxiom</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-1628117230"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628117228"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1628117232"><span class="hs-identifier hs-var">prepr_tc</span></a><span> </span><a href="#local-1628117229"><span class="hs-identifier hs-var">instTys</span></a><span> </span><a href="#local-1628117231"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-42"></a><span>      </span><a href="Vectorise.Monad.Base.html#liftDs"><span class="hs-identifier hs-var">liftDs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="FamInst.html#newFamInst"><span class="hs-identifier hs-var">newFamInst</span></a><span> </span><a href="FamInstEnv.html#SynFamilyInst"><span class="hs-identifier hs-var">SynFamilyInst</span></a><span> </span><a href="#local-1628117233"><span class="hs-identifier hs-var">axiom</span></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-44"></a><span>    </span><a name="local-1628117228"><a href="#local-1628117228"><span class="hs-identifier">tyvars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628117226"><span class="hs-identifier hs-var">vect_tc</span></a><span>
</span><a name="line-45"></a><span>    </span><a name="local-1628117229"><a href="#local-1628117229"><span class="hs-identifier">instTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628117226"><span class="hs-identifier hs-var">vect_tc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628117226"><span class="hs-identifier hs-var">vect_tc</span></a><span class="hs-special">]</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-comment">-- buildPAScAndMethods --------------------------------------------------------</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- | This says how to build the PR superclass and methods of PA</span><span>
</span><a name="line-50"></a><span class="hs-comment">--   Recall the definition of the PA class:</span><span>
</span><a name="line-51"></a><span class="hs-comment">--</span><span>
</span><a name="line-52"></a><span class="hs-comment">--   @</span><span>
</span><a name="line-53"></a><span class="hs-comment">--    class class PR (PRepr a) =&gt; PA a where</span><span>
</span><a name="line-54"></a><span class="hs-comment">--      toPRepr       :: a                -&gt; PRepr a</span><span>
</span><a name="line-55"></a><span class="hs-comment">--      fromPRepr     :: PRepr a          -&gt; a</span><span>
</span><a name="line-56"></a><span class="hs-comment">--</span><span>
</span><a name="line-57"></a><span class="hs-comment">--      toArrPRepr    :: PData a          -&gt; PData (PRepr a)</span><span>
</span><a name="line-58"></a><span class="hs-comment">--      fromArrPRepr  :: PData (PRepr a)  -&gt; PData a</span><span>
</span><a name="line-59"></a><span class="hs-comment">--</span><span>
</span><a name="line-60"></a><span class="hs-comment">--      toArrPReprs   :: PDatas a         -&gt; PDatas (PRepr a)</span><span>
</span><a name="line-61"></a><span class="hs-comment">--      fromArrPReprs :: PDatas (PRepr a) -&gt; PDatas a</span><span>
</span><a name="line-62"></a><span class="hs-comment">--   @</span><span>
</span><a name="line-63"></a><span class="hs-comment">--</span><span>
</span><a name="line-64"></a><span class="hs-keyword">type</span><span> </span><a name="PAInstanceBuilder"><a href="Vectorise.Generic.PAMethods.html#PAInstanceBuilder"><span class="hs-identifier">PAInstanceBuilder</span></a></a><span>
</span><a name="line-65"></a><span>        </span><span class="hs-glyph">=</span><span>  </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>        </span><span class="hs-comment">-- ^ Vectorised TyCon</span><span>
</span><a name="line-66"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="CoAxiom.html#Unbranched"><span class="hs-identifier hs-type">Unbranched</span></a><span>
</span><a name="line-67"></a><span>                        </span><span class="hs-comment">-- ^ Coercion to the representation TyCon</span><span>
</span><a name="line-68"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>        </span><span class="hs-comment">-- ^ 'PData'  TyCon</span><span>
</span><a name="line-69"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>        </span><span class="hs-comment">-- ^ 'PDatas' TyCon</span><span>
</span><a name="line-70"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Generic.Description.html#SumRepr"><span class="hs-identifier hs-type">SumRepr</span></a><span>      </span><span class="hs-comment">-- ^ Description of generic representation.</span><span>
</span><a name="line-71"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Monad.Base.html#VM"><span class="hs-identifier hs-type">VM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>  </span><span class="hs-comment">-- ^ Instance function.</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-identifier">buildPAScAndMethods</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Vectorise.Monad.Base.html#VM"><span class="hs-identifier hs-type">VM</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a href="Vectorise.Generic.PAMethods.html#PAInstanceBuilder"><span class="hs-identifier hs-type">PAInstanceBuilder</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-75"></a><a name="buildPAScAndMethods"><a href="Vectorise.Generic.PAMethods.html#buildPAScAndMethods"><span class="hs-identifier">buildPAScAndMethods</span></a></a><span>
</span><a name="line-76"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;toPRepr&quot;</span><span class="hs-special">,</span><span>       </span><a href="Vectorise.Generic.PAMethods.html#buildToPRepr"><span class="hs-identifier hs-var">buildToPRepr</span></a><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;fromPRepr&quot;</span><span class="hs-special">,</span><span>     </span><a href="Vectorise.Generic.PAMethods.html#buildFromPRepr"><span class="hs-identifier hs-var">buildFromPRepr</span></a><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;toArrPRepr&quot;</span><span class="hs-special">,</span><span>    </span><a href="Vectorise.Generic.PAMethods.html#buildToArrPRepr"><span class="hs-identifier hs-var">buildToArrPRepr</span></a><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;fromArrPRepr&quot;</span><span class="hs-special">,</span><span>  </span><a href="Vectorise.Generic.PAMethods.html#buildFromArrPRepr"><span class="hs-identifier hs-var">buildFromArrPRepr</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;toArrPReprs&quot;</span><span class="hs-special">,</span><span>   </span><a href="Vectorise.Generic.PAMethods.html#buildToArrPReprs"><span class="hs-identifier hs-var">buildToArrPReprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;fromArrPReprs&quot;</span><span class="hs-special">,</span><span> </span><a href="Vectorise.Generic.PAMethods.html#buildFromArrPReprs"><span class="hs-identifier hs-var">buildFromArrPReprs</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-comment">-- buildToPRepr ---------------------------------------------------------------</span><span>
</span><a name="line-85"></a><span class="hs-comment">-- | Build the 'toRepr' method of the PA class.</span><span>
</span><a name="line-86"></a><span class="hs-identifier">buildToPRepr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Vectorise.Generic.PAMethods.html#PAInstanceBuilder"><span class="hs-identifier hs-type">PAInstanceBuilder</span></a><span>
</span><a name="line-87"></a><a name="buildToPRepr"><a href="Vectorise.Generic.PAMethods.html#buildToPRepr"><span class="hs-identifier">buildToPRepr</span></a></a><span> </span><a name="local-1628117234"><a href="#local-1628117234"><span class="hs-identifier">vect_tc</span></a></a><span> </span><a name="local-1628117235"><a href="#local-1628117235"><span class="hs-identifier">repr_ax</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117236"><a href="#local-1628117236"><span class="hs-identifier">repr</span></a></a><span>
</span><a name="line-88"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117280"><a href="#local-1628117280"><span class="hs-identifier">arg_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628117234"><span class="hs-identifier hs-var">vect_tc</span></a><span> </span><a href="#local-1628117237"><span class="hs-identifier hs-var">ty_args</span></a><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span>      </span><span class="hs-comment">-- Get the representation type of the argument.</span><span>
</span><a name="line-91"></a><span>      </span><a name="local-1628117281"><a href="#local-1628117281"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPReprType"><span class="hs-identifier hs-var">mkPReprType</span></a><span> </span><a href="#local-1628117280"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span>      </span><span class="hs-comment">-- Var to bind the argument</span><span>
</span><a name="line-94"></a><span>      </span><a name="local-1628117282"><a href="#local-1628117282"><span class="hs-identifier">arg</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117280"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>      </span><span class="hs-comment">-- Build the expression to convert the argument to the generic representation.</span><span>
</span><a name="line-97"></a><span>      </span><a name="local-1628117283"><a href="#local-1628117283"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117239"><span class="hs-identifier hs-var">to_sum</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117282"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117280"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="#local-1628117281"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117236"><span class="hs-identifier hs-var">repr</span></a><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#Lam"><span class="hs-identifier hs-var">Lam</span></a><span> </span><a href="#local-1628117282"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-1628117283"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-100"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-101"></a><span>    </span><a name="local-1628117237"><a href="#local-1628117237"><span class="hs-identifier">ty_args</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628117234"><span class="hs-identifier hs-var">vect_tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span>    </span><a name="local-1628117238"><a href="#local-1628117238"><span class="hs-identifier">wrap_repr_inst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkId.html#wrapTypeUnbranchedFamInstBody"><span class="hs-identifier hs-var">wrapTypeUnbranchedFamInstBody</span></a><span> </span><a href="#local-1628117235"><span class="hs-identifier hs-var">repr_ax</span></a><span> </span><a href="#local-1628117237"><span class="hs-identifier hs-var">ty_args</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span>    </span><span class="hs-comment">-- CoreExp to convert the given argument to the generic representation.</span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-comment">-- We start by doing a case branch on the possible data constructors.</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-identifier">to_sum</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Generic.Description.html#SumRepr"><span class="hs-identifier hs-type">SumRepr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Monad.Base.html#VM"><span class="hs-identifier hs-type">VM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-108"></a><span>    </span><a name="local-1628117239"><a href="#local-1628117239"><span class="hs-identifier">to_sum</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Vectorise.Generic.Description.html#EmptySum"><span class="hs-identifier hs-var">EmptySum</span></a><span>
</span><a name="line-109"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117243"><a href="#local-1628117243"><span class="hs-identifier">void</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.html#builtin"><span class="hs-identifier hs-var">builtin</span></a><span> </span><span class="hs-identifier">voidVar</span><span>
</span><a name="line-110"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1628117238"><span class="hs-identifier hs-var">wrap_repr_inst</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117243"><span class="hs-identifier hs-var">void</span></a><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span>    </span><span class="hs-identifier">to_sum</span><span> </span><a name="local-1628117244"><a href="#local-1628117244"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-1628117245"><a href="#local-1628117245"><span class="hs-identifier">arg_ty</span></a></a><span> </span><a name="local-1628117246"><a href="#local-1628117246"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#UnarySum"><span class="hs-identifier hs-var">UnarySum</span></a><span> </span><a name="local-1628117247"><a href="#local-1628117247"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-1628117248"><a href="#local-1628117248"><span class="hs-identifier">pat</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117249"><a href="#local-1628117249"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117250"><a href="#local-1628117250"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117240"><span class="hs-identifier hs-var">con_alt</span></a><span> </span><a href="#local-1628117247"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-114"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-1628117244"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-1628117245"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="#local-1628117246"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-115"></a><span>                   </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1628117248"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117249"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117238"><span class="hs-identifier hs-var">wrap_repr_inst</span></a><span> </span><a href="#local-1628117250"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span>    </span><span class="hs-identifier">to_sum</span><span> </span><a name="local-1628117251"><a href="#local-1628117251"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-1628117252"><a href="#local-1628117252"><span class="hs-identifier">arg_ty</span></a></a><span> </span><a name="local-1628117253"><a href="#local-1628117253"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">repr_sum_tc</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628117254"><a href="#local-1628117254"><span class="hs-identifier">sum_tc</span></a></a><span>
</span><a name="line-118"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">repr_con_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628117255"><a href="#local-1628117255"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-119"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">repr_cons</span><span>    </span><span class="hs-glyph">=</span><span>  </span><a name="local-1628117256"><a href="#local-1628117256"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117257"><a href="#local-1628117257"><span class="hs-identifier">alts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-1628117240"><span class="hs-identifier hs-var">con_alt</span></a><span> </span><a href="#local-1628117256"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-121"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117258"><a href="#local-1628117258"><span class="hs-identifier">alts'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1628117259"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117260"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117238"><span class="hs-identifier hs-var">wrap_repr_inst</span></a><span>
</span><a name="line-122"></a><span>                                   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a><span> </span><a href="#local-1628117262"><span class="hs-identifier hs-var">sum_con</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-1628117255"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628117261"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1628117259"><a href="#local-1628117259"><span class="hs-identifier">pat</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117260"><a href="#local-1628117260"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117261"><a href="#local-1628117261"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1628117262"><a href="#local-1628117262"><span class="hs-identifier">sum_con</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>                            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><a href="#local-1628117257"><span class="hs-identifier hs-var">alts</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117254"><span class="hs-identifier hs-var">sum_tc</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-125"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-1628117251"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-1628117252"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="#local-1628117253"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117258"><span class="hs-identifier hs-var">alts'</span></a><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span>    </span><a name="local-1628117240"><a href="#local-1628117240"><span class="hs-identifier">con_alt</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#ConRepr"><span class="hs-identifier hs-var">ConRepr</span></a><span> </span><a name="local-1628117263"><a href="#local-1628117263"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-1628117264"><a href="#local-1628117264"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-1628117265"><a href="#local-1628117265"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117266"><a href="#local-1628117266"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117241"><span class="hs-identifier hs-var">to_prod</span></a><span> </span><a href="#local-1628117264"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-129"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a href="#local-1628117263"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117265"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117266"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span>    </span><span class="hs-comment">-- CoreExp to convert data constructor fields to the generic representation.</span><span>
</span><a name="line-132"></a><span>    </span><span class="hs-identifier">to_prod</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Vectorise.Generic.Description.html#ProdRepr"><span class="hs-identifier hs-type">ProdRepr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Monad.Base.html#VM"><span class="hs-identifier hs-type">VM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>    </span><a name="local-1628117241"><a href="#local-1628117241"><span class="hs-identifier">to_prod</span></a></a><span> </span><a href="Vectorise.Generic.Description.html#EmptyProd"><span class="hs-identifier hs-var">EmptyProd</span></a><span>
</span><a name="line-134"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117267"><a href="#local-1628117267"><span class="hs-identifier">void</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.html#builtin"><span class="hs-identifier hs-var">builtin</span></a><span> </span><span class="hs-identifier">voidVar</span><span>
</span><a name="line-135"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117267"><span class="hs-identifier hs-var">void</span></a><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span>    </span><span class="hs-identifier">to_prod</span><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#UnaryProd"><span class="hs-identifier hs-var">UnaryProd</span></a><span> </span><a name="local-1628117268"><a href="#local-1628117268"><span class="hs-identifier">comp</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117269"><a href="#local-1628117269"><span class="hs-identifier">var</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#compOrigType"><span class="hs-identifier hs-var">compOrigType</span></a><span> </span><a href="#local-1628117268"><span class="hs-identifier hs-var">comp</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>          </span><a name="local-1628117270"><a href="#local-1628117270"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117242"><span class="hs-identifier hs-var">to_comp</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117269"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117268"><span class="hs-identifier hs-var">comp</span></a><span>
</span><a name="line-140"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-1628117269"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628117270"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>    </span><span class="hs-identifier">to_prod</span><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Prod"><span class="hs-identifier hs-var">Prod</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">repr_tup_tc</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628117271"><a href="#local-1628117271"><span class="hs-identifier">tup_tc</span></a></a><span>
</span><a name="line-143"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">repr_comp_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628117272"><a href="#local-1628117272"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-144"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">repr_comps</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628117273"><a href="#local-1628117273"><span class="hs-identifier">comps</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117274"><a href="#local-1628117274"><span class="hs-identifier">vars</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVars"><span class="hs-identifier hs-var">newLocalVars</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Vectorise.Generic.Description.html#compOrigType"><span class="hs-identifier hs-var">compOrigType</span></a><span> </span><a href="#local-1628117273"><span class="hs-identifier hs-var">comps</span></a><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span>          </span><a name="local-1628117275"><a href="#local-1628117275"><span class="hs-identifier">exprs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><a href="#local-1628117242"><span class="hs-identifier hs-var">to_comp</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117274"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117273"><span class="hs-identifier hs-var">comps</span></a><span>
</span><a name="line-147"></a><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-1628117276"><a href="#local-1628117276"><span class="hs-identifier">tup_con</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117271"><span class="hs-identifier hs-var">tup_tc</span></a><span>
</span><a name="line-148"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117274"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a><span> </span><a href="#local-1628117276"><span class="hs-identifier hs-var">tup_con</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-1628117272"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628117275"><span class="hs-identifier hs-var">exprs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span>    </span><span class="hs-comment">-- CoreExp to convert a data constructor component to the generic representation.</span><span>
</span><a name="line-151"></a><span>    </span><span class="hs-identifier">to_comp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Generic.Description.html#CompRepr"><span class="hs-identifier hs-type">CompRepr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Monad.Base.html#VM"><span class="hs-identifier hs-type">VM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-152"></a><span>    </span><a name="local-1628117242"><a href="#local-1628117242"><span class="hs-identifier">to_comp</span></a></a><span> </span><a name="local-1628117277"><a href="#local-1628117277"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Keep"><span class="hs-identifier hs-var">Keep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628117277"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-153"></a><span>    </span><span class="hs-identifier">to_comp</span><span> </span><a name="local-1628117278"><a href="#local-1628117278"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Wrap"><span class="hs-identifier hs-var">Wrap</span></a><span> </span><a name="local-1628117279"><a href="#local-1628117279"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Vectorise.Utils.Base.html#wrapNewTypeBodyOfWrap"><span class="hs-identifier hs-var">wrapNewTypeBodyOfWrap</span></a><span> </span><a href="#local-1628117278"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117279"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-comment">-- buildFromPRepr -------------------------------------------------------------</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-comment">-- |Build the 'fromPRepr' method of the PA class.</span><span>
</span><a name="line-159"></a><span class="hs-comment">--</span><span>
</span><a name="line-160"></a><span class="hs-identifier">buildFromPRepr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Vectorise.Generic.PAMethods.html#PAInstanceBuilder"><span class="hs-identifier hs-type">PAInstanceBuilder</span></a><span>
</span><a name="line-161"></a><a name="buildFromPRepr"><a href="Vectorise.Generic.PAMethods.html#buildFromPRepr"><span class="hs-identifier">buildFromPRepr</span></a></a><span> </span><a name="local-1628117284"><a href="#local-1628117284"><span class="hs-identifier">vect_tc</span></a></a><span> </span><a name="local-1628117285"><a href="#local-1628117285"><span class="hs-identifier">repr_ax</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117286"><a href="#local-1628117286"><span class="hs-identifier">repr</span></a></a><span>
</span><a name="line-162"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-163"></a><span>      </span><a name="local-1628117324"><a href="#local-1628117324"><span class="hs-identifier">arg_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPReprType"><span class="hs-identifier hs-var">mkPReprType</span></a><span> </span><a href="#local-1628117288"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-164"></a><span>      </span><a name="local-1628117325"><a href="#local-1628117325"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117324"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span>      </span><a name="local-1628117326"><a href="#local-1628117326"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117289"><span class="hs-identifier hs-var">from_sum</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#unwrapTypeUnbranchedFamInstScrut"><span class="hs-identifier hs-var">unwrapTypeUnbranchedFamInstScrut</span></a><span> </span><a href="#local-1628117285"><span class="hs-identifier hs-var">repr_ax</span></a><span> </span><a href="#local-1628117287"><span class="hs-identifier hs-var">ty_args</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117325"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>                         </span><a href="#local-1628117286"><span class="hs-identifier hs-var">repr</span></a><span>
</span><a name="line-168"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#Lam"><span class="hs-identifier hs-var">Lam</span></a><span> </span><a href="#local-1628117325"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-1628117326"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-169"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-170"></a><span>    </span><a name="local-1628117287"><a href="#local-1628117287"><span class="hs-identifier">ty_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628117284"><span class="hs-identifier hs-var">vect_tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>    </span><a name="local-1628117288"><a href="#local-1628117288"><span class="hs-identifier">res_ty</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628117284"><span class="hs-identifier hs-var">vect_tc</span></a><span> </span><a href="#local-1628117287"><span class="hs-identifier hs-var">ty_args</span></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span>    </span><a name="local-1628117289"><a href="#local-1628117289"><span class="hs-identifier">from_sum</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="Vectorise.Generic.Description.html#EmptySum"><span class="hs-identifier hs-var">EmptySum</span></a><span>
</span><a name="line-174"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117293"><a href="#local-1628117293"><span class="hs-identifier">dummy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.html#builtin"><span class="hs-identifier hs-var">builtin</span></a><span> </span><span class="hs-identifier">fromVoidVar</span><span>
</span><a name="line-175"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117293"><span class="hs-identifier hs-var">dummy</span></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-1628117288"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>    </span><span class="hs-identifier">from_sum</span><span> </span><a name="local-1628117294"><a href="#local-1628117294"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#UnarySum"><span class="hs-identifier hs-var">UnarySum</span></a><span> </span><a name="local-1628117295"><a href="#local-1628117295"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628117290"><span class="hs-identifier hs-var">from_con</span></a><span> </span><a href="#local-1628117294"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117295"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-178"></a><span>    </span><span class="hs-identifier">from_sum</span><span> </span><a name="local-1628117296"><a href="#local-1628117296"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">repr_sum_tc</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628117297"><a href="#local-1628117297"><span class="hs-identifier">sum_tc</span></a></a><span>
</span><a name="line-179"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">repr_con_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628117298"><a href="#local-1628117298"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-180"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">repr_cons</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628117299"><a href="#local-1628117299"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117300"><a href="#local-1628117300"><span class="hs-identifier">vars</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVars"><span class="hs-identifier hs-var">newLocalVars</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117298"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-182"></a><span>          </span><a name="local-1628117301"><a href="#local-1628117301"><span class="hs-identifier">es</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><a href="#local-1628117290"><span class="hs-identifier hs-var">from_con</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117300"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117299"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-183"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-1628117296"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-1628117296"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117288"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-184"></a><span>                   </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a href="#local-1628117302"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-1628117303"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628117304"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628117302"><a href="#local-1628117302"><span class="hs-identifier">con</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117303"><a href="#local-1628117303"><span class="hs-identifier">var</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117304"><a href="#local-1628117304"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117297"><span class="hs-identifier hs-var">sum_tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117300"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-1628117301"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">]</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span>    </span><a name="local-1628117290"><a href="#local-1628117290"><span class="hs-identifier">from_con</span></a></a><span> </span><a name="local-1628117305"><a href="#local-1628117305"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#ConRepr"><span class="hs-identifier hs-var">ConRepr</span></a><span> </span><a name="local-1628117306"><a href="#local-1628117306"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-1628117307"><a href="#local-1628117307"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628117291"><span class="hs-identifier hs-var">from_prod</span></a><span> </span><a href="#local-1628117305"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a><span> </span><a href="#local-1628117306"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-1628117287"><span class="hs-identifier hs-var">ty_args</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117307"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span>    </span><a name="local-1628117291"><a href="#local-1628117291"><span class="hs-identifier">from_prod</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117308"><a href="#local-1628117308"><span class="hs-identifier">con</span></a></a><span> </span><a href="Vectorise.Generic.Description.html#EmptyProd"><span class="hs-identifier hs-var">EmptyProd</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628117308"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-191"></a><span>    </span><span class="hs-identifier">from_prod</span><span> </span><a name="local-1628117309"><a href="#local-1628117309"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-1628117310"><a href="#local-1628117310"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#UnaryProd"><span class="hs-identifier hs-var">UnaryProd</span></a><span> </span><a name="local-1628117311"><a href="#local-1628117311"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-192"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117312"><a href="#local-1628117312"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117292"><span class="hs-identifier hs-var">from_comp</span></a><span> </span><a href="#local-1628117309"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117311"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-193"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1628117310"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628117312"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span>    </span><span class="hs-identifier">from_prod</span><span> </span><a name="local-1628117313"><a href="#local-1628117313"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-1628117314"><a href="#local-1628117314"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Prod"><span class="hs-identifier hs-var">Prod</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">repr_tup_tc</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628117315"><a href="#local-1628117315"><span class="hs-identifier">tup_tc</span></a></a><span>
</span><a name="line-196"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">repr_comp_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628117316"><a href="#local-1628117316"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-197"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">repr_comps</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628117317"><a href="#local-1628117317"><span class="hs-identifier">comps</span></a></a><span>
</span><a name="line-198"></a><span>                             </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117318"><a href="#local-1628117318"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVars"><span class="hs-identifier hs-var">newLocalVars</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;y&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117316"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-200"></a><span>          </span><a name="local-1628117319"><a href="#local-1628117319"><span class="hs-identifier">es</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><a href="#local-1628117292"><span class="hs-identifier hs-var">from_comp</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117318"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117317"><span class="hs-identifier hs-var">comps</span></a><span>
</span><a name="line-201"></a><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-1628117320"><a href="#local-1628117320"><span class="hs-identifier">tup_con</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117315"><span class="hs-identifier hs-var">tup_tc</span></a><span>
</span><a name="line-202"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-1628117313"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-1628117313"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117288"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-203"></a><span>                   </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a href="#local-1628117320"><span class="hs-identifier hs-var">tup_con</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117318"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117314"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628117319"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span>    </span><a name="local-1628117292"><a href="#local-1628117292"><span class="hs-identifier">from_comp</span></a></a><span> </span><a name="local-1628117321"><a href="#local-1628117321"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Keep"><span class="hs-identifier hs-var">Keep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628117321"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-206"></a><span>    </span><span class="hs-identifier">from_comp</span><span> </span><a name="local-1628117322"><a href="#local-1628117322"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Wrap"><span class="hs-identifier hs-var">Wrap</span></a><span> </span><a name="local-1628117323"><a href="#local-1628117323"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Vectorise.Utils.Base.html#unwrapNewTypeBodyOfWrap"><span class="hs-identifier hs-var">unwrapNewTypeBodyOfWrap</span></a><span> </span><a href="#local-1628117322"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117323"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-comment">-- buildToArrRepr -------------------------------------------------------------</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-comment">-- |Build the 'toArrRepr' method of the PA class.</span><span>
</span><a name="line-212"></a><span class="hs-comment">--</span><span>
</span><a name="line-213"></a><span class="hs-identifier">buildToArrPRepr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Vectorise.Generic.PAMethods.html#PAInstanceBuilder"><span class="hs-identifier hs-type">PAInstanceBuilder</span></a><span>
</span><a name="line-214"></a><a name="buildToArrPRepr"><a href="Vectorise.Generic.PAMethods.html#buildToArrPRepr"><span class="hs-identifier">buildToArrPRepr</span></a></a><span> </span><a name="local-1628117327"><a href="#local-1628117327"><span class="hs-identifier">vect_tc</span></a></a><span> </span><a name="local-1628117328"><a href="#local-1628117328"><span class="hs-identifier">repr_co</span></a></a><span> </span><a name="local-1628117329"><a href="#local-1628117329"><span class="hs-identifier">pdata_tc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117330"><a href="#local-1628117330"><span class="hs-identifier">r</span></a></a><span>
</span><a name="line-215"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117360"><a href="#local-1628117360"><span class="hs-identifier">arg_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPDataType"><span class="hs-identifier hs-var">mkPDataType</span></a><span> </span><a href="#local-1628117332"><span class="hs-identifier hs-var">el_ty</span></a><span>
</span><a name="line-216"></a><span>      </span><a name="local-1628117361"><a href="#local-1628117361"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPDataType"><span class="hs-identifier hs-var">mkPDataType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a><span> </span><a href="Vectorise.Utils.Base.html#mkPReprType"><span class="hs-identifier hs-var">mkPReprType</span></a><span> </span><a href="#local-1628117332"><span class="hs-identifier hs-var">el_ty</span></a><span>
</span><a name="line-217"></a><span>      </span><a name="local-1628117362"><a href="#local-1628117362"><span class="hs-identifier">arg</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;xs&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117360"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span>      </span><a name="local-1628117363"><a href="#local-1628117363"><span class="hs-identifier">pdata_co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkBuiltinCo"><span class="hs-identifier hs-var">mkBuiltinCo</span></a><span> </span><span class="hs-identifier">pdataTyCon</span><span>
</span><a name="line-220"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117364"><a href="#local-1628117364"><span class="hs-identifier">co</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="#local-1628117363"><span class="hs-identifier hs-var">pdata_co</span></a><span>
</span><a name="line-221"></a><span>                       </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span>
</span><a name="line-222"></a><span>                       </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkUnbranchedAxInstCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-1628117328"><span class="hs-identifier hs-var">repr_co</span></a><span> </span><a href="#local-1628117331"><span class="hs-identifier hs-var">ty_args</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span>          </span><a name="local-1628117365"><a href="#local-1628117365"><span class="hs-identifier">scrut</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="MkId.html#unwrapFamInstScrut"><span class="hs-identifier hs-var">unwrapFamInstScrut</span></a><span> </span><a href="#local-1628117329"><span class="hs-identifier hs-var">pdata_tc</span></a><span> </span><a href="#local-1628117331"><span class="hs-identifier hs-var">ty_args</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117362"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span>      </span><span class="hs-special">(</span><a name="local-1628117366"><a href="#local-1628117366"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117367"><a href="#local-1628117367"><span class="hs-identifier">result</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117334"><span class="hs-identifier hs-var">to_sum</span></a><span> </span><a href="#local-1628117330"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="CoreSyn.html#Lam"><span class="hs-identifier hs-var">Lam</span></a><span> </span><a href="#local-1628117362"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-229"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-1628117365"><span class="hs-identifier hs-var">scrut</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628117329"><span class="hs-identifier hs-var">pdata_tc</span></a><span> </span><a href="#local-1628117331"><span class="hs-identifier hs-var">ty_args</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117361"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-230"></a><span>               </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a href="#local-1628117333"><span class="hs-identifier hs-var">pdata_dc</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117366"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="CoreUtils.html#mkCast"><span class="hs-identifier hs-var">mkCast</span></a><span> </span><a href="#local-1628117367"><span class="hs-identifier hs-var">result</span></a><span> </span><a href="#local-1628117364"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-231"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-232"></a><span>    </span><a name="local-1628117331"><a href="#local-1628117331"><span class="hs-identifier">ty_args</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628117327"><span class="hs-identifier hs-var">vect_tc</span></a><span>
</span><a name="line-233"></a><span>    </span><a name="local-1628117332"><a href="#local-1628117332"><span class="hs-identifier">el_ty</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628117327"><span class="hs-identifier hs-var">vect_tc</span></a><span> </span><a href="#local-1628117331"><span class="hs-identifier hs-var">ty_args</span></a><span>
</span><a name="line-234"></a><span>    </span><span class="hs-special">[</span><a name="local-1628117333"><a href="#local-1628117333"><span class="hs-identifier">pdata_dc</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117329"><span class="hs-identifier hs-var">pdata_tc</span></a><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span>    </span><a name="local-1628117334"><a href="#local-1628117334"><span class="hs-identifier">to_sum</span></a></a><span> </span><a name="local-1628117338"><a href="#local-1628117338"><span class="hs-identifier">ss</span></a></a><span>
</span><a name="line-237"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628117338"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-238"></a><span>        </span><a href="Vectorise.Generic.Description.html#EmptySum"><span class="hs-identifier hs-var">EmptySum</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Monad.html#builtin"><span class="hs-identifier hs-var">builtin</span></a><span> </span><span class="hs-identifier">pvoidVar</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628117339"><a href="#local-1628117339"><span class="hs-identifier">pvoid</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117339"><span class="hs-identifier hs-var">pvoid</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>        </span><a href="Vectorise.Generic.Description.html#UnarySum"><span class="hs-identifier hs-var">UnarySum</span></a><span> </span><a name="local-1628117340"><a href="#local-1628117340"><span class="hs-identifier">r</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628117336"><span class="hs-identifier hs-var">to_con</span></a><span> </span><a href="#local-1628117340"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-240"></a><span>        </span><a href="Vectorise.Generic.Description.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-241"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117341"><a href="#local-1628117341"><span class="hs-identifier">psum_tc</span></a></a><span>     </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">repr_psum_tc</span><span> </span><a href="#local-1628117338"><span class="hs-identifier hs-var">ss</span></a><span>
</span><a name="line-242"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-1628117342"><a href="#local-1628117342"><span class="hs-identifier">psum_con</span></a></a><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span>  </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117341"><span class="hs-identifier hs-var">psum_tc</span></a><span>
</span><a name="line-243"></a><span>                </span><span class="hs-special">(</span><a name="local-1628117343"><a href="#local-1628117343"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117344"><a href="#local-1628117344"><span class="hs-identifier">exprs</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a><span> </span><a href="#local-1628117336"><span class="hs-identifier hs-var">to_con</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_cons</span><span> </span><a href="#local-1628117338"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-244"></a><span>                </span><a name="local-1628117345"><a href="#local-1628117345"><span class="hs-identifier">sel</span></a></a><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;sel&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_sel_ty</span><span> </span><a href="#local-1628117338"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-245"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628117345"><span class="hs-identifier hs-var">sel</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="#local-1628117343"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-246"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="MkId.html#wrapFamInstBody"><span class="hs-identifier hs-var">wrapFamInstBody</span></a><span> </span><a href="#local-1628117341"><span class="hs-identifier hs-var">psum_tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_con_tys</span><span> </span><a href="#local-1628117338"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a><span> </span><a href="#local-1628117342"><span class="hs-identifier hs-var">psum_con</span></a><span>
</span><a name="line-248"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_con_tys</span><span> </span><a href="#local-1628117338"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117345"><span class="hs-identifier hs-var">sel</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628117344"><span class="hs-identifier hs-var">exprs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span>    </span><a name="local-1628117335"><a href="#local-1628117335"><span class="hs-identifier">to_prod</span></a></a><span> </span><a name="local-1628117346"><a href="#local-1628117346"><span class="hs-identifier">ss</span></a></a><span>
</span><a name="line-251"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628117346"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-252"></a><span>        </span><a href="Vectorise.Generic.Description.html#EmptyProd"><span class="hs-identifier hs-var">EmptyProd</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Vectorise.Monad.html#builtin"><span class="hs-identifier hs-var">builtin</span></a><span> </span><span class="hs-identifier">pvoidVar</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628117347"><a href="#local-1628117347"><span class="hs-identifier">pvoid</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117347"><span class="hs-identifier hs-var">pvoid</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>        </span><a href="Vectorise.Generic.Description.html#UnaryProd"><span class="hs-identifier hs-var">UnaryProd</span></a><span> </span><a name="local-1628117348"><a href="#local-1628117348"><span class="hs-identifier">r</span></a></a><span>
</span><a name="line-254"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><a name="local-1628117349"><a href="#local-1628117349"><span class="hs-identifier">pty</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPDataType"><span class="hs-identifier hs-var">mkPDataType</span></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#compOrigType"><span class="hs-identifier hs-var">compOrigType</span></a><span> </span><a href="#local-1628117348"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>                </span><a name="local-1628117350"><a href="#local-1628117350"><span class="hs-identifier">var</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117349"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-256"></a><span>                </span><a name="local-1628117351"><a href="#local-1628117351"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117337"><span class="hs-identifier hs-var">to_comp</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117350"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117348"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-257"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-1628117350"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628117351"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>        </span><a href="Vectorise.Generic.Description.html#Prod"><span class="hs-identifier hs-var">Prod</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-259"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-1628117352"><a href="#local-1628117352"><span class="hs-identifier">ptup_con</span></a></a><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_ptup_tc</span><span> </span><a href="#local-1628117346"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>                </span><a name="local-1628117353"><a href="#local-1628117353"><span class="hs-identifier">ptys</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Utils.Base.html#mkPDataType"><span class="hs-identifier hs-var">mkPDataType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Vectorise.Generic.Description.html#compOrigType"><span class="hs-identifier hs-var">compOrigType</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comps</span><span> </span><a href="#local-1628117346"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>                </span><a name="local-1628117354"><a href="#local-1628117354"><span class="hs-identifier">vars</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVars"><span class="hs-identifier hs-var">newLocalVars</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117353"><span class="hs-identifier hs-var">ptys</span></a><span>
</span><a name="line-262"></a><span>                </span><a name="local-1628117355"><a href="#local-1628117355"><span class="hs-identifier">exprs</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><a href="#local-1628117337"><span class="hs-identifier hs-var">to_comp</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117354"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comps</span><span> </span><a href="#local-1628117346"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628117354"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-264"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="MkId.html#wrapFamInstBody"><span class="hs-identifier hs-var">wrapFamInstBody</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_ptup_tc</span><span> </span><a href="#local-1628117346"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comp_tys</span><span> </span><a href="#local-1628117346"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a><span> </span><a href="#local-1628117352"><span class="hs-identifier hs-var">ptup_con</span></a><span>
</span><a name="line-266"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comp_tys</span><span> </span><a href="#local-1628117346"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628117355"><span class="hs-identifier hs-var">exprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span>    </span><a name="local-1628117336"><a href="#local-1628117336"><span class="hs-identifier">to_con</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#ConRepr"><span class="hs-identifier hs-var">ConRepr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117356"><a href="#local-1628117356"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628117335"><span class="hs-identifier hs-var">to_prod</span></a><span> </span><a href="#local-1628117356"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span>    </span><a name="local-1628117337"><a href="#local-1628117337"><span class="hs-identifier">to_comp</span></a></a><span> </span><a name="local-1628117357"><a href="#local-1628117357"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Keep"><span class="hs-identifier hs-var">Keep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628117357"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-271"></a><span>    </span><span class="hs-identifier">to_comp</span><span> </span><a name="local-1628117358"><a href="#local-1628117358"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Wrap"><span class="hs-identifier hs-var">Wrap</span></a><span> </span><a name="local-1628117359"><a href="#local-1628117359"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Vectorise.Utils.Base.html#wrapNewTypeBodyOfPDataWrap"><span class="hs-identifier hs-var">wrapNewTypeBodyOfPDataWrap</span></a><span> </span><a href="#local-1628117358"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117359"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span class="hs-comment">-- buildFromArrPRepr ----------------------------------------------------------</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-comment">-- |Build the 'fromArrPRepr' method for the PA class.</span><span>
</span><a name="line-277"></a><span class="hs-comment">--</span><span>
</span><a name="line-278"></a><span class="hs-identifier">buildFromArrPRepr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Vectorise.Generic.PAMethods.html#PAInstanceBuilder"><span class="hs-identifier hs-type">PAInstanceBuilder</span></a><span>
</span><a name="line-279"></a><a name="buildFromArrPRepr"><a href="Vectorise.Generic.PAMethods.html#buildFromArrPRepr"><span class="hs-identifier">buildFromArrPRepr</span></a></a><span> </span><a name="local-1628117368"><a href="#local-1628117368"><span class="hs-identifier">vect_tc</span></a></a><span> </span><a name="local-1628117369"><a href="#local-1628117369"><span class="hs-identifier">repr_co</span></a></a><span> </span><a name="local-1628117370"><a href="#local-1628117370"><span class="hs-identifier">pdata_tc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117371"><a href="#local-1628117371"><span class="hs-identifier">r</span></a></a><span>
</span><a name="line-280"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117429"><a href="#local-1628117429"><span class="hs-identifier">arg_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPDataType"><span class="hs-identifier hs-var">mkPDataType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a><span> </span><a href="Vectorise.Utils.Base.html#mkPReprType"><span class="hs-identifier hs-var">mkPReprType</span></a><span> </span><a href="#local-1628117373"><span class="hs-identifier hs-var">el_ty</span></a><span>
</span><a name="line-281"></a><span>      </span><a name="local-1628117430"><a href="#local-1628117430"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPDataType"><span class="hs-identifier hs-var">mkPDataType</span></a><span> </span><a href="#local-1628117373"><span class="hs-identifier hs-var">el_ty</span></a><span>
</span><a name="line-282"></a><span>      </span><a name="local-1628117431"><a href="#local-1628117431"><span class="hs-identifier">arg</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;xs&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117429"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span>      </span><a name="local-1628117432"><a href="#local-1628117432"><span class="hs-identifier">pdata_co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkBuiltinCo"><span class="hs-identifier hs-var">mkBuiltinCo</span></a><span> </span><span class="hs-identifier">pdataTyCon</span><span>
</span><a name="line-285"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117433"><a href="#local-1628117433"><span class="hs-identifier">co</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="#local-1628117432"><span class="hs-identifier hs-var">pdata_co</span></a><span>
</span><a name="line-286"></a><span>                       </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkUnbranchedAxInstCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-1628117369"><span class="hs-identifier hs-var">repr_co</span></a><span> </span><a href="#local-1628117372"><span class="hs-identifier hs-var">var_tys</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117434"><a href="#local-1628117434"><span class="hs-identifier">scrut</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="CoreUtils.html#mkCast"><span class="hs-identifier hs-var">mkCast</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117431"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117433"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117435"><a href="#local-1628117435"><span class="hs-identifier">mk_result</span></a></a><span> </span><a name="local-1628117436"><a href="#local-1628117436"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-291"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="MkId.html#wrapFamInstBody"><span class="hs-identifier hs-var">wrapFamInstBody</span></a><span> </span><a href="#local-1628117370"><span class="hs-identifier hs-var">pdata_tc</span></a><span> </span><a href="#local-1628117372"><span class="hs-identifier hs-var">var_tys</span></a><span>
</span><a name="line-292"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a><span> </span><a href="#local-1628117374"><span class="hs-identifier hs-var">pdata_con</span></a><span>
</span><a name="line-293"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-1628117372"><span class="hs-identifier hs-var">var_tys</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628117436"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span>      </span><span class="hs-special">(</span><a name="local-1628117438"><a href="#local-1628117438"><span class="hs-identifier">expr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Base.html#fixV"><span class="hs-identifier hs-var">fixV</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628117437"><a href="#local-1628117437"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-296"></a><span>                     </span><a href="#local-1628117375"><span class="hs-identifier hs-var">from_sum</span></a><span> </span><a href="#local-1628117430"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117435"><span class="hs-identifier hs-var">mk_result</span></a><span> </span><a href="#local-1628117437"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117434"><span class="hs-identifier hs-var">scrut</span></a><span> </span><a href="#local-1628117371"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#Lam"><span class="hs-identifier hs-var">Lam</span></a><span> </span><a href="#local-1628117431"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-1628117438"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-299"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-300"></a><span>    </span><a name="local-1628117372"><a href="#local-1628117372"><span class="hs-identifier">var_tys</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628117368"><span class="hs-identifier hs-var">vect_tc</span></a><span>
</span><a name="line-301"></a><span>    </span><a name="local-1628117373"><a href="#local-1628117373"><span class="hs-identifier">el_ty</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628117368"><span class="hs-identifier hs-var">vect_tc</span></a><span> </span><a href="#local-1628117372"><span class="hs-identifier hs-var">var_tys</span></a><span>
</span><a name="line-302"></a><span>    </span><span class="hs-special">[</span><a name="local-1628117374"><a href="#local-1628117374"><span class="hs-identifier">pdata_con</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117370"><span class="hs-identifier hs-var">pdata_tc</span></a><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span>    </span><a name="local-1628117375"><a href="#local-1628117375"><span class="hs-identifier">from_sum</span></a></a><span> </span><a name="local-1628117380"><a href="#local-1628117380"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-1628117381"><a href="#local-1628117381"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117382"><a href="#local-1628117382"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-1628117383"><a href="#local-1628117383"><span class="hs-identifier">ss</span></a></a><span>
</span><a name="line-305"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628117383"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-306"></a><span>        </span><a href="Vectorise.Generic.Description.html#EmptySum"><span class="hs-identifier hs-var">EmptySum</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117381"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-307"></a><span>        </span><a href="Vectorise.Generic.Description.html#UnarySum"><span class="hs-identifier hs-var">UnarySum</span></a><span> </span><a name="local-1628117384"><a href="#local-1628117384"><span class="hs-identifier">r</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628117377"><span class="hs-identifier hs-var">from_con</span></a><span> </span><a href="#local-1628117380"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117381"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-1628117382"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117384"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-308"></a><span>        </span><a href="Vectorise.Generic.Description.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-309"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117385"><a href="#local-1628117385"><span class="hs-identifier">psum_tc</span></a></a><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">repr_psum_tc</span><span> </span><a href="#local-1628117383"><span class="hs-identifier hs-var">ss</span></a><span>
</span><a name="line-310"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-1628117386"><a href="#local-1628117386"><span class="hs-identifier">psum_con</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117385"><span class="hs-identifier hs-var">psum_tc</span></a><span>
</span><a name="line-311"></a><span>                </span><a name="local-1628117387"><a href="#local-1628117387"><span class="hs-identifier">sel</span></a></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;sel&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_sel_ty</span><span> </span><a href="#local-1628117383"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span>                </span><a name="local-1628117388"><a href="#local-1628117388"><span class="hs-identifier">ptys</span></a></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="Vectorise.Utils.Base.html#mkPDataType"><span class="hs-identifier hs-var">mkPDataType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_con_tys</span><span> </span><a href="#local-1628117383"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-313"></a><span>                </span><a name="local-1628117389"><a href="#local-1628117389"><span class="hs-identifier">vars</span></a></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVars"><span class="hs-identifier hs-var">newLocalVars</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;xs&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117388"><span class="hs-identifier hs-var">ptys</span></a><span>
</span><a name="line-314"></a><span>                </span><span class="hs-special">(</span><a name="local-1628117390"><a href="#local-1628117390"><span class="hs-identifier">res'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117391"><a href="#local-1628117391"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117379"><span class="hs-identifier hs-var">fold</span></a><span> </span><a href="#local-1628117377"><span class="hs-identifier hs-var">from_con</span></a><span> </span><a href="#local-1628117380"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117381"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117389"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_cons</span><span> </span><a href="#local-1628117383"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117392"><a href="#local-1628117392"><span class="hs-identifier">scrut</span></a></a><span>      </span><span class="hs-glyph">=</span><span>  </span><a href="MkId.html#unwrapFamInstScrut"><span class="hs-identifier hs-var">unwrapFamInstScrut</span></a><span> </span><a href="#local-1628117385"><span class="hs-identifier hs-var">psum_tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_con_tys</span><span> </span><a href="#local-1628117383"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117382"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-316"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117393"><a href="#local-1628117393"><span class="hs-identifier">body</span></a></a><span>       </span><span class="hs-glyph">=</span><span>  </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-1628117392"><span class="hs-identifier hs-var">scrut</span></a><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-1628117392"><span class="hs-identifier hs-var">scrut</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117380"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-317"></a><span>                                    </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a href="#local-1628117386"><span class="hs-identifier hs-var">psum_con</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117387"><span class="hs-identifier hs-var">sel</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628117389"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117390"><span class="hs-identifier hs-var">res'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-318"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117393"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117387"><span class="hs-identifier hs-var">sel</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628117391"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span>    </span><a name="local-1628117376"><a href="#local-1628117376"><span class="hs-identifier">from_prod</span></a></a><span> </span><a name="local-1628117394"><a href="#local-1628117394"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-1628117395"><a href="#local-1628117395"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117396"><a href="#local-1628117396"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-1628117397"><a href="#local-1628117397"><span class="hs-identifier">ss</span></a></a><span>
</span><a name="line-321"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628117397"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-322"></a><span>        </span><a href="Vectorise.Generic.Description.html#EmptyProd"><span class="hs-identifier hs-var">EmptyProd</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117395"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-323"></a><span>        </span><a href="Vectorise.Generic.Description.html#UnaryProd"><span class="hs-identifier hs-var">UnaryProd</span></a><span> </span><a name="local-1628117398"><a href="#local-1628117398"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628117378"><span class="hs-identifier hs-var">from_comp</span></a><span> </span><a href="#local-1628117394"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117395"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-1628117396"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117398"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-324"></a><span>        </span><a href="Vectorise.Generic.Description.html#Prod"><span class="hs-identifier hs-var">Prod</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-325"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117399"><a href="#local-1628117399"><span class="hs-identifier">ptup_tc</span></a></a><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">repr_ptup_tc</span><span> </span><a href="#local-1628117397"><span class="hs-identifier hs-var">ss</span></a><span>
</span><a name="line-326"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-1628117400"><a href="#local-1628117400"><span class="hs-identifier">ptup_con</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117399"><span class="hs-identifier hs-var">ptup_tc</span></a><span>
</span><a name="line-327"></a><span>                </span><a name="local-1628117401"><a href="#local-1628117401"><span class="hs-identifier">ptys</span></a></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="Vectorise.Utils.Base.html#mkPDataType"><span class="hs-identifier hs-var">mkPDataType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comp_tys</span><span> </span><a href="#local-1628117397"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-328"></a><span>                </span><a name="local-1628117402"><a href="#local-1628117402"><span class="hs-identifier">vars</span></a></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVars"><span class="hs-identifier hs-var">newLocalVars</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;ys&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117401"><span class="hs-identifier hs-var">ptys</span></a><span>
</span><a name="line-329"></a><span>                </span><span class="hs-special">(</span><a name="local-1628117403"><a href="#local-1628117403"><span class="hs-identifier">res'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117404"><a href="#local-1628117404"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117379"><span class="hs-identifier hs-var">fold</span></a><span> </span><a href="#local-1628117378"><span class="hs-identifier hs-var">from_comp</span></a><span> </span><a href="#local-1628117394"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117395"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117402"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comps</span><span> </span><a href="#local-1628117397"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117405"><a href="#local-1628117405"><span class="hs-identifier">scrut</span></a></a><span>      </span><span class="hs-glyph">=</span><span>  </span><a href="MkId.html#unwrapFamInstScrut"><span class="hs-identifier hs-var">unwrapFamInstScrut</span></a><span> </span><a href="#local-1628117399"><span class="hs-identifier hs-var">ptup_tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comp_tys</span><span> </span><a href="#local-1628117397"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117396"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-331"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117406"><a href="#local-1628117406"><span class="hs-identifier">body</span></a></a><span>       </span><span class="hs-glyph">=</span><span>  </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-1628117405"><span class="hs-identifier hs-var">scrut</span></a><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-1628117405"><span class="hs-identifier hs-var">scrut</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117394"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-332"></a><span>                                    </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a href="#local-1628117400"><span class="hs-identifier hs-var">ptup_con</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117402"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117403"><span class="hs-identifier hs-var">res'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-333"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117406"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117404"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span>    </span><a name="local-1628117377"><a href="#local-1628117377"><span class="hs-identifier">from_con</span></a></a><span> </span><a name="local-1628117407"><a href="#local-1628117407"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-1628117408"><a href="#local-1628117408"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117409"><a href="#local-1628117409"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#ConRepr"><span class="hs-identifier hs-var">ConRepr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117410"><a href="#local-1628117410"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628117376"><span class="hs-identifier hs-var">from_prod</span></a><span> </span><a href="#local-1628117407"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117408"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-1628117409"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117410"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span>    </span><a name="local-1628117378"><a href="#local-1628117378"><span class="hs-identifier">from_comp</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117411"><a href="#local-1628117411"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117412"><a href="#local-1628117412"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Keep"><span class="hs-identifier hs-var">Keep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117411"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-1628117412"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>    </span><span class="hs-identifier">from_comp</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117413"><a href="#local-1628117413"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117414"><a href="#local-1628117414"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Wrap"><span class="hs-identifier hs-var">Wrap</span></a><span> </span><a name="local-1628117415"><a href="#local-1628117415"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628117416"><a href="#local-1628117416"><span class="hs-identifier">expr'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#unwrapNewTypeBodyOfPDataWrap"><span class="hs-identifier hs-var">unwrapNewTypeBodyOfPDataWrap</span></a><span> </span><a href="#local-1628117414"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117415"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-339"></a><span>                                         </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117413"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-1628117416"><span class="hs-identifier hs-var">expr'</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-340"></a><span>                                         </span><span class="hs-special">}</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span>    </span><a name="local-1628117379"><a href="#local-1628117379"><span class="hs-identifier">fold</span></a></a><span> </span><a name="local-1628117417"><a href="#local-1628117417"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628117418"><a href="#local-1628117418"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-1628117419"><a href="#local-1628117419"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117420"><a href="#local-1628117420"><span class="hs-identifier">exprs</span></a></a><span> </span><a name="local-1628117421"><a href="#local-1628117421"><span class="hs-identifier">rs</span></a></a><span>
</span><a name="line-343"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="MonadUtils.html#foldrM"><span class="hs-identifier hs-var">foldrM</span></a><span> </span><a href="#local-1628117422"><span class="hs-identifier hs-var">f'</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117419"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><a href="#local-1628117420"><span class="hs-identifier hs-var">exprs</span></a><span> </span><a href="#local-1628117421"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-344"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-345"></a><span>        </span><a name="local-1628117422"><a href="#local-1628117422"><span class="hs-identifier">f'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628117423"><a href="#local-1628117423"><span class="hs-identifier">expr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117424"><a href="#local-1628117424"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1628117425"><a href="#local-1628117425"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117426"><a href="#local-1628117426"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-346"></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-1628117427"><a href="#local-1628117427"><span class="hs-identifier">res'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117428"><a href="#local-1628117428"><span class="hs-identifier">args'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117417"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628117418"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117425"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-1628117423"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117424"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-347"></a><span>              </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117427"><span class="hs-identifier hs-var">res'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117428"><span class="hs-identifier hs-var">args'</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628117426"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span class="hs-comment">-- buildToArrPReprs -----------------------------------------------------------</span><span>
</span><a name="line-351"></a><span class="hs-comment">-- | Build the 'toArrPReprs' instance for the PA class.</span><span>
</span><a name="line-352"></a><span class="hs-comment">--   This converts a PData of elements into the generic representation.</span><span>
</span><a name="line-353"></a><span class="hs-identifier">buildToArrPReprs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Vectorise.Generic.PAMethods.html#PAInstanceBuilder"><span class="hs-identifier hs-type">PAInstanceBuilder</span></a><span>
</span><a name="line-354"></a><a name="buildToArrPReprs"><a href="Vectorise.Generic.PAMethods.html#buildToArrPReprs"><span class="hs-identifier">buildToArrPReprs</span></a></a><span> </span><a name="local-1628117439"><a href="#local-1628117439"><span class="hs-identifier">vect_tc</span></a></a><span> </span><a name="local-1628117440"><a href="#local-1628117440"><span class="hs-identifier">repr_co</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117441"><a href="#local-1628117441"><span class="hs-identifier">pdatas_tc</span></a></a><span> </span><a name="local-1628117442"><a href="#local-1628117442"><span class="hs-identifier">r</span></a></a><span>
</span><a name="line-355"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-356"></a><span>    </span><span class="hs-comment">-- The argument type of the instance.</span><span>
</span><a name="line-357"></a><span>    </span><span class="hs-comment">--  eg: 'PDatas (Tree a b)'</span><span>
</span><a name="line-358"></a><span>    </span><a name="local-1628117477"><a href="#local-1628117477"><span class="hs-identifier">arg_ty</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPDatasType"><span class="hs-identifier hs-var">mkPDatasType</span></a><span> </span><a href="#local-1628117444"><span class="hs-identifier hs-var">el_ty</span></a><span>
</span><a name="line-359"></a><span>
</span><a name="line-360"></a><span>    </span><span class="hs-comment">-- The result type.</span><span>
</span><a name="line-361"></a><span>    </span><span class="hs-comment">--  eg: 'PDatas (PRepr (Tree a b))'</span><span>
</span><a name="line-362"></a><span>    </span><a name="local-1628117478"><a href="#local-1628117478"><span class="hs-identifier">res_ty</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPDatasType"><span class="hs-identifier hs-var">mkPDatasType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a><span> </span><a href="Vectorise.Utils.Base.html#mkPReprType"><span class="hs-identifier hs-var">mkPReprType</span></a><span> </span><a href="#local-1628117444"><span class="hs-identifier hs-var">el_ty</span></a><span>
</span><a name="line-363"></a><span>
</span><a name="line-364"></a><span>    </span><span class="hs-comment">-- Variable to bind the argument to the instance</span><span>
</span><a name="line-365"></a><span>    </span><span class="hs-comment">-- eg: (xss :: PDatas (Tree a b))</span><span>
</span><a name="line-366"></a><span>    </span><a name="local-1628117479"><a href="#local-1628117479"><span class="hs-identifier">varg</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;xss&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117477"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-367"></a><span>
</span><a name="line-368"></a><span>    </span><span class="hs-comment">-- Coercion to case between the (PRepr a) type and its instance.</span><span>
</span><a name="line-369"></a><span>    </span><a name="local-1628117480"><a href="#local-1628117480"><span class="hs-identifier">pdatas_co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkBuiltinCo"><span class="hs-identifier hs-var">mkBuiltinCo</span></a><span> </span><span class="hs-identifier">pdatasTyCon</span><span>
</span><a name="line-370"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117481"><a href="#local-1628117481"><span class="hs-identifier">co</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="#local-1628117480"><span class="hs-identifier hs-var">pdatas_co</span></a><span>
</span><a name="line-371"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span>
</span><a name="line-372"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkUnbranchedAxInstCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-1628117440"><span class="hs-identifier hs-var">repr_co</span></a><span> </span><a href="#local-1628117443"><span class="hs-identifier hs-var">ty_args</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117482"><a href="#local-1628117482"><span class="hs-identifier">scrut</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="MkId.html#unwrapFamInstScrut"><span class="hs-identifier hs-var">unwrapFamInstScrut</span></a><span> </span><a href="#local-1628117441"><span class="hs-identifier hs-var">pdatas_tc</span></a><span> </span><a href="#local-1628117443"><span class="hs-identifier hs-var">ty_args</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117479"><span class="hs-identifier hs-var">varg</span></a><span class="hs-special">)</span><span>
</span><a name="line-375"></a><span>    </span><span class="hs-special">(</span><a name="local-1628117483"><a href="#local-1628117483"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117484"><a href="#local-1628117484"><span class="hs-identifier">result</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117446"><span class="hs-identifier hs-var">to_sum</span></a><span> </span><a href="#local-1628117442"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-376"></a><span>
</span><a name="line-377"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#Lam"><span class="hs-identifier hs-var">Lam</span></a><span> </span><a href="#local-1628117479"><span class="hs-identifier hs-var">varg</span></a><span>
</span><a name="line-378"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-1628117482"><span class="hs-identifier hs-var">scrut</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628117441"><span class="hs-identifier hs-var">pdatas_tc</span></a><span> </span><a href="#local-1628117443"><span class="hs-identifier hs-var">ty_args</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117478"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-379"></a><span>                    </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a href="#local-1628117445"><span class="hs-identifier hs-var">pdatas_dc</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117483"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="CoreUtils.html#mkCast"><span class="hs-identifier hs-var">mkCast</span></a><span> </span><a href="#local-1628117484"><span class="hs-identifier hs-var">result</span></a><span> </span><a href="#local-1628117481"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-382"></a><span>    </span><span class="hs-comment">-- The element type of the argument.</span><span>
</span><a name="line-383"></a><span>    </span><span class="hs-comment">--  eg: 'Tree a b'.</span><span>
</span><a name="line-384"></a><span>    </span><a name="local-1628117443"><a href="#local-1628117443"><span class="hs-identifier">ty_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628117439"><span class="hs-identifier hs-var">vect_tc</span></a><span>
</span><a name="line-385"></a><span>    </span><a name="local-1628117444"><a href="#local-1628117444"><span class="hs-identifier">el_ty</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628117439"><span class="hs-identifier hs-var">vect_tc</span></a><span> </span><a href="#local-1628117443"><span class="hs-identifier hs-var">ty_args</span></a><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span>    </span><span class="hs-comment">-- PDatas data constructor</span><span>
</span><a name="line-388"></a><span>    </span><span class="hs-special">[</span><a name="local-1628117445"><a href="#local-1628117445"><span class="hs-identifier">pdatas_dc</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117441"><span class="hs-identifier hs-var">pdatas_tc</span></a><span>
</span><a name="line-389"></a><span>
</span><a name="line-390"></a><span>    </span><a name="local-1628117446"><a href="#local-1628117446"><span class="hs-identifier">to_sum</span></a></a><span> </span><a name="local-1628117450"><a href="#local-1628117450"><span class="hs-identifier">ss</span></a></a><span>
</span><a name="line-391"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628117450"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-392"></a><span>        </span><span class="hs-comment">-- We can't convert data types with no data.</span><span>
</span><a name="line-393"></a><span>        </span><span class="hs-comment">-- See Note: [Empty PDatas].</span><span>
</span><a name="line-394"></a><span>        </span><a href="Vectorise.Generic.Description.html#EmptySum"><span class="hs-identifier hs-var">EmptySum</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117451"><a href="#local-1628117451"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-395"></a><span>                              </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Vectorise.Generic.PAMethods.html#errorEmptyPDatas"><span class="hs-identifier hs-var">errorEmptyPDatas</span></a><span> </span><a href="#local-1628117451"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628117444"><span class="hs-identifier hs-var">el_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-396"></a><span>        </span><a href="Vectorise.Generic.Description.html#UnarySum"><span class="hs-identifier hs-var">UnarySum</span></a><span> </span><a name="local-1628117452"><a href="#local-1628117452"><span class="hs-identifier">r</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117453"><a href="#local-1628117453"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-397"></a><span>                              </span><a href="#local-1628117448"><span class="hs-identifier hs-var">to_con</span></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.PAMethods.html#errorEmptyPDatas"><span class="hs-identifier hs-var">errorEmptyPDatas</span></a><span> </span><a href="#local-1628117453"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628117444"><span class="hs-identifier hs-var">el_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117452"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span>        </span><a href="Vectorise.Generic.Description.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-400"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117454"><a href="#local-1628117454"><span class="hs-identifier">psums_tc</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">repr_psums_tc</span><span> </span><a href="#local-1628117450"><span class="hs-identifier hs-var">ss</span></a><span>
</span><a name="line-401"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-1628117455"><a href="#local-1628117455"><span class="hs-identifier">psums_con</span></a></a><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117454"><span class="hs-identifier hs-var">psums_tc</span></a><span>
</span><a name="line-402"></a><span>                </span><a name="local-1628117456"><a href="#local-1628117456"><span class="hs-identifier">sels</span></a></a><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;sels&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_sels_ty</span><span> </span><a href="#local-1628117450"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span>                </span><span class="hs-comment">-- Take the number of selectors to serve as the length of</span><span>
</span><a name="line-405"></a><span>                </span><span class="hs-comment">-- and PDatas Void arrays in the product. See Note [Empty PDatas].</span><span>
</span><a name="line-406"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117457"><a href="#local-1628117457"><span class="hs-identifier">xSums</span></a></a><span>        </span><span class="hs-glyph">=</span><span>  </span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_selsLength_v</span><span> </span><a href="#local-1628117450"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117456"><span class="hs-identifier hs-var">sels</span></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><span>                </span><a name="local-1628117458"><a href="#local-1628117458"><span class="hs-identifier">xSums_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;xsum&quot;</span><span class="hs-special">)</span><span> </span><a href="TysPrim.html#intPrimTy"><span class="hs-identifier hs-var">intPrimTy</span></a><span>
</span><a name="line-409"></a><span>
</span><a name="line-410"></a><span>                </span><span class="hs-special">(</span><a name="local-1628117459"><a href="#local-1628117459"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117460"><a href="#local-1628117460"><span class="hs-identifier">exprs</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117448"><span class="hs-identifier hs-var">to_con</span></a><span> </span><a href="#local-1628117458"><span class="hs-identifier hs-var">xSums_var</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_cons</span><span> </span><a href="#local-1628117450"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-411"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628117456"><span class="hs-identifier hs-var">sels</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="#local-1628117459"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-412"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="MkId.html#wrapFamInstBody"><span class="hs-identifier hs-var">wrapFamInstBody</span></a><span> </span><a href="#local-1628117454"><span class="hs-identifier hs-var">psums_tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_con_tys</span><span> </span><a href="#local-1628117450"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-413"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="MkCore.html#mkCoreLet"><span class="hs-identifier hs-var">mkCoreLet</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a><span> </span><a href="#local-1628117458"><span class="hs-identifier hs-var">xSums_var</span></a><span> </span><a href="#local-1628117457"><span class="hs-identifier hs-var">xSums</span></a><span class="hs-special">)</span><span>
</span><a name="line-414"></a><span>                                 </span><span class="hs-comment">-- mkCoreLet ensures that the let/app invariant holds</span><span>
</span><a name="line-415"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a><span> </span><a href="#local-1628117455"><span class="hs-identifier hs-var">psums_con</span></a><span>
</span><a name="line-416"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_con_tys</span><span> </span><a href="#local-1628117450"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117456"><span class="hs-identifier hs-var">sels</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628117460"><span class="hs-identifier hs-var">exprs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>
</span><a name="line-418"></a><span>    </span><a name="local-1628117447"><a href="#local-1628117447"><span class="hs-identifier">to_prod</span></a></a><span> </span><a name="local-1628117461"><a href="#local-1628117461"><span class="hs-identifier">xSums</span></a></a><span> </span><a name="local-1628117462"><a href="#local-1628117462"><span class="hs-identifier">ss</span></a></a><span>
</span><a name="line-419"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628117462"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-420"></a><span>        </span><a href="Vectorise.Generic.Description.html#EmptyProd"><span class="hs-identifier hs-var">EmptyProd</span></a><span>
</span><a name="line-421"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><a name="local-1628117463"><a href="#local-1628117463"><span class="hs-identifier">pvoids</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.html#builtin"><span class="hs-identifier hs-var">builtin</span></a><span> </span><span class="hs-identifier">pvoidsVar</span><span>
</span><a name="line-422"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117463"><span class="hs-identifier hs-var">pvoids</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117461"><span class="hs-identifier hs-var">xSums</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span>        </span><a href="Vectorise.Generic.Description.html#UnaryProd"><span class="hs-identifier hs-var">UnaryProd</span></a><span> </span><a name="local-1628117464"><a href="#local-1628117464"><span class="hs-identifier">r</span></a></a><span>
</span><a name="line-425"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><a name="local-1628117465"><a href="#local-1628117465"><span class="hs-identifier">pty</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPDatasType"><span class="hs-identifier hs-var">mkPDatasType</span></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#compOrigType"><span class="hs-identifier hs-var">compOrigType</span></a><span> </span><a href="#local-1628117464"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>                </span><a name="local-1628117466"><a href="#local-1628117466"><span class="hs-identifier">var</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117465"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-427"></a><span>                </span><a name="local-1628117467"><a href="#local-1628117467"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117449"><span class="hs-identifier hs-var">to_comp</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117466"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117464"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-428"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-1628117466"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1628117467"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-429"></a><span>
</span><a name="line-430"></a><span>        </span><a href="Vectorise.Generic.Description.html#Prod"><span class="hs-identifier hs-var">Prod</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-431"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-1628117468"><a href="#local-1628117468"><span class="hs-identifier">ptups_con</span></a></a><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_ptups_tc</span><span> </span><a href="#local-1628117462"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-432"></a><span>                </span><a name="local-1628117469"><a href="#local-1628117469"><span class="hs-identifier">ptys</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Utils.Base.html#mkPDatasType"><span class="hs-identifier hs-var">mkPDatasType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Vectorise.Generic.Description.html#compOrigType"><span class="hs-identifier hs-var">compOrigType</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comps</span><span> </span><a href="#local-1628117462"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-433"></a><span>                </span><a name="local-1628117470"><a href="#local-1628117470"><span class="hs-identifier">vars</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVars"><span class="hs-identifier hs-var">newLocalVars</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117469"><span class="hs-identifier hs-var">ptys</span></a><span>
</span><a name="line-434"></a><span>                </span><a name="local-1628117471"><a href="#local-1628117471"><span class="hs-identifier">exprs</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><a href="#local-1628117449"><span class="hs-identifier hs-var">to_comp</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117470"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comps</span><span> </span><a href="#local-1628117462"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-435"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628117470"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-436"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="MkId.html#wrapFamInstBody"><span class="hs-identifier hs-var">wrapFamInstBody</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_ptups_tc</span><span> </span><a href="#local-1628117462"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comp_tys</span><span> </span><a href="#local-1628117462"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-437"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a><span> </span><a href="#local-1628117468"><span class="hs-identifier hs-var">ptups_con</span></a><span>
</span><a name="line-438"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comp_tys</span><span> </span><a href="#local-1628117462"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628117471"><span class="hs-identifier hs-var">exprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span>    </span><a name="local-1628117448"><a href="#local-1628117448"><span class="hs-identifier">to_con</span></a></a><span> </span><a name="local-1628117472"><a href="#local-1628117472"><span class="hs-identifier">xSums</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#ConRepr"><span class="hs-identifier hs-var">ConRepr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117473"><a href="#local-1628117473"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-441"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628117447"><span class="hs-identifier hs-var">to_prod</span></a><span> </span><a href="#local-1628117472"><span class="hs-identifier hs-var">xSums</span></a><span> </span><a href="#local-1628117473"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-442"></a><span>
</span><a name="line-443"></a><span>    </span><a name="local-1628117449"><a href="#local-1628117449"><span class="hs-identifier">to_comp</span></a></a><span> </span><a name="local-1628117474"><a href="#local-1628117474"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Keep"><span class="hs-identifier hs-var">Keep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628117474"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-444"></a><span>    </span><span class="hs-identifier">to_comp</span><span> </span><a name="local-1628117475"><a href="#local-1628117475"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Wrap"><span class="hs-identifier hs-var">Wrap</span></a><span> </span><a name="local-1628117476"><a href="#local-1628117476"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Vectorise.Utils.Base.html#wrapNewTypeBodyOfPDatasWrap"><span class="hs-identifier hs-var">wrapNewTypeBodyOfPDatasWrap</span></a><span> </span><a href="#local-1628117475"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117476"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-445"></a><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span class="hs-comment">-- buildFromArrPReprs ---------------------------------------------------------</span><span>
</span><a name="line-448"></a><span class="hs-identifier">buildFromArrPReprs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Vectorise.Generic.PAMethods.html#PAInstanceBuilder"><span class="hs-identifier hs-type">PAInstanceBuilder</span></a><span>
</span><a name="line-449"></a><a name="buildFromArrPReprs"><a href="Vectorise.Generic.PAMethods.html#buildFromArrPReprs"><span class="hs-identifier">buildFromArrPReprs</span></a></a><span> </span><a name="local-1628117485"><a href="#local-1628117485"><span class="hs-identifier">vect_tc</span></a></a><span> </span><a name="local-1628117486"><a href="#local-1628117486"><span class="hs-identifier">repr_co</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117487"><a href="#local-1628117487"><span class="hs-identifier">pdatas_tc</span></a></a><span> </span><a name="local-1628117488"><a href="#local-1628117488"><span class="hs-identifier">r</span></a></a><span>
</span><a name="line-450"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-451"></a><span>    </span><span class="hs-comment">-- The argument type of the instance.</span><span>
</span><a name="line-452"></a><span>    </span><span class="hs-comment">--  eg: 'PDatas (PRepr (Tree a b))'</span><span>
</span><a name="line-453"></a><span>    </span><a name="local-1628117548"><a href="#local-1628117548"><span class="hs-identifier">arg_ty</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPDatasType"><span class="hs-identifier hs-var">mkPDatasType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a><span> </span><a href="Vectorise.Utils.Base.html#mkPReprType"><span class="hs-identifier hs-var">mkPReprType</span></a><span> </span><a href="#local-1628117490"><span class="hs-identifier hs-var">el_ty</span></a><span>
</span><a name="line-454"></a><span>
</span><a name="line-455"></a><span>    </span><span class="hs-comment">-- The result type.</span><span>
</span><a name="line-456"></a><span>    </span><span class="hs-comment">--  eg: 'PDatas (Tree a b)'</span><span>
</span><a name="line-457"></a><span>    </span><a name="local-1628117549"><a href="#local-1628117549"><span class="hs-identifier">res_ty</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkPDatasType"><span class="hs-identifier hs-var">mkPDatasType</span></a><span> </span><a href="#local-1628117490"><span class="hs-identifier hs-var">el_ty</span></a><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span>    </span><span class="hs-comment">-- Variable to bind the argument to the instance</span><span>
</span><a name="line-460"></a><span>    </span><span class="hs-comment">-- eg: (xss :: PDatas (PRepr (Tree a b)))</span><span>
</span><a name="line-461"></a><span>    </span><a name="local-1628117550"><a href="#local-1628117550"><span class="hs-identifier">varg</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;xss&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117548"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-462"></a><span>
</span><a name="line-463"></a><span>    </span><span class="hs-comment">-- Build the coercion between PRepr and the instance type</span><span>
</span><a name="line-464"></a><span>    </span><a name="local-1628117551"><a href="#local-1628117551"><span class="hs-identifier">pdatas_co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#mkBuiltinCo"><span class="hs-identifier hs-var">mkBuiltinCo</span></a><span> </span><span class="hs-identifier">pdatasTyCon</span><span>
</span><a name="line-465"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117552"><a href="#local-1628117552"><span class="hs-identifier">co</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="#local-1628117551"><span class="hs-identifier hs-var">pdatas_co</span></a><span>
</span><a name="line-466"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkUnbranchedAxInstCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-1628117486"><span class="hs-identifier hs-var">repr_co</span></a><span> </span><a href="#local-1628117491"><span class="hs-identifier hs-var">var_tys</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-467"></a><span>
</span><a name="line-468"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117553"><a href="#local-1628117553"><span class="hs-identifier">scrut</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="CoreUtils.html#mkCast"><span class="hs-identifier hs-var">mkCast</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117550"><span class="hs-identifier hs-var">varg</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117552"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117554"><a href="#local-1628117554"><span class="hs-identifier">mk_result</span></a></a><span> </span><a name="local-1628117555"><a href="#local-1628117555"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-471"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="MkId.html#wrapFamInstBody"><span class="hs-identifier hs-var">wrapFamInstBody</span></a><span> </span><a href="#local-1628117487"><span class="hs-identifier hs-var">pdatas_tc</span></a><span> </span><a href="#local-1628117491"><span class="hs-identifier hs-var">var_tys</span></a><span>
</span><a name="line-472"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a><span> </span><a href="#local-1628117492"><span class="hs-identifier hs-var">pdatas_con</span></a><span>
</span><a name="line-473"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-1628117491"><span class="hs-identifier hs-var">var_tys</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628117555"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-474"></a><span>
</span><a name="line-475"></a><span>    </span><span class="hs-special">(</span><a name="local-1628117557"><a href="#local-1628117557"><span class="hs-identifier">expr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Base.html#fixV"><span class="hs-identifier hs-var">fixV</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628117556"><a href="#local-1628117556"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-476"></a><span>                     </span><a href="#local-1628117493"><span class="hs-identifier hs-var">from_sum</span></a><span> </span><a href="#local-1628117549"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117554"><span class="hs-identifier hs-var">mk_result</span></a><span> </span><a href="#local-1628117556"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117553"><span class="hs-identifier hs-var">scrut</span></a><span> </span><a href="#local-1628117488"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoreSyn.html#Lam"><span class="hs-identifier hs-var">Lam</span></a><span> </span><a href="#local-1628117550"><span class="hs-identifier hs-var">varg</span></a><span> </span><a href="#local-1628117557"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-479"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-480"></a><span>    </span><span class="hs-comment">-- The element type of the argument.</span><span>
</span><a name="line-481"></a><span>    </span><span class="hs-comment">--  eg: 'Tree a b'.</span><span>
</span><a name="line-482"></a><span>    </span><a name="local-1628117489"><a href="#local-1628117489"><span class="hs-identifier">ty_args</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628117485"><span class="hs-identifier hs-var">vect_tc</span></a><span>
</span><a name="line-483"></a><span>    </span><a name="local-1628117490"><a href="#local-1628117490"><span class="hs-identifier">el_ty</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1628117485"><span class="hs-identifier hs-var">vect_tc</span></a><span> </span><a href="#local-1628117489"><span class="hs-identifier hs-var">ty_args</span></a><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span>    </span><a name="local-1628117491"><a href="#local-1628117491"><span class="hs-identifier">var_tys</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628117485"><span class="hs-identifier hs-var">vect_tc</span></a><span>
</span><a name="line-486"></a><span>    </span><span class="hs-special">[</span><a name="local-1628117492"><a href="#local-1628117492"><span class="hs-identifier">pdatas_con</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117487"><span class="hs-identifier hs-var">pdatas_tc</span></a><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span>    </span><a name="local-1628117493"><a href="#local-1628117493"><span class="hs-identifier">from_sum</span></a></a><span> </span><a name="local-1628117498"><a href="#local-1628117498"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-1628117499"><a href="#local-1628117499"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117500"><a href="#local-1628117500"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-1628117501"><a href="#local-1628117501"><span class="hs-identifier">ss</span></a></a><span>
</span><a name="line-489"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628117501"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-490"></a><span>        </span><span class="hs-comment">-- We can't convert data types with no data.</span><span>
</span><a name="line-491"></a><span>        </span><span class="hs-comment">-- See Note: [Empty PDatas].</span><span>
</span><a name="line-492"></a><span>        </span><a href="Vectorise.Generic.Description.html#EmptySum"><span class="hs-identifier hs-var">EmptySum</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628117502"><a href="#local-1628117502"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-493"></a><span>                              </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117499"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="Vectorise.Generic.PAMethods.html#errorEmptyPDatas"><span class="hs-identifier hs-var">errorEmptyPDatas</span></a><span> </span><a href="#local-1628117502"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628117490"><span class="hs-identifier hs-var">el_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-494"></a><span>        </span><a href="Vectorise.Generic.Description.html#UnarySum"><span class="hs-identifier hs-var">UnarySum</span></a><span> </span><a name="local-1628117503"><a href="#local-1628117503"><span class="hs-identifier">r</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628117495"><span class="hs-identifier hs-var">from_con</span></a><span> </span><a href="#local-1628117498"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117499"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-1628117500"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117503"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span>        </span><a href="Vectorise.Generic.Description.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-497"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117504"><a href="#local-1628117504"><span class="hs-identifier">psums_tc</span></a></a><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">repr_psums_tc</span><span> </span><a href="#local-1628117501"><span class="hs-identifier hs-var">ss</span></a><span>
</span><a name="line-498"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-1628117505"><a href="#local-1628117505"><span class="hs-identifier">psums_con</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117504"><span class="hs-identifier hs-var">psums_tc</span></a><span>
</span><a name="line-499"></a><span>                </span><a name="local-1628117506"><a href="#local-1628117506"><span class="hs-identifier">sel</span></a></a><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVar"><span class="hs-identifier hs-var">newLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;sels&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_sels_ty</span><span> </span><a href="#local-1628117501"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-500"></a><span>                </span><a name="local-1628117507"><a href="#local-1628117507"><span class="hs-identifier">ptys</span></a></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="Vectorise.Utils.Base.html#mkPDatasType"><span class="hs-identifier hs-var">mkPDatasType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_con_tys</span><span> </span><a href="#local-1628117501"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-501"></a><span>                </span><a name="local-1628117508"><a href="#local-1628117508"><span class="hs-identifier">vars</span></a></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVars"><span class="hs-identifier hs-var">newLocalVars</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;xs&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117507"><span class="hs-identifier hs-var">ptys</span></a><span>
</span><a name="line-502"></a><span>                </span><span class="hs-special">(</span><a name="local-1628117509"><a href="#local-1628117509"><span class="hs-identifier">res'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117510"><a href="#local-1628117510"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117497"><span class="hs-identifier hs-var">fold</span></a><span> </span><a href="#local-1628117495"><span class="hs-identifier hs-var">from_con</span></a><span> </span><a href="#local-1628117498"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117499"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117508"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_cons</span><span> </span><a href="#local-1628117501"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-503"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117511"><a href="#local-1628117511"><span class="hs-identifier">scrut</span></a></a><span>       </span><span class="hs-glyph">=</span><span>  </span><a href="MkId.html#unwrapFamInstScrut"><span class="hs-identifier hs-var">unwrapFamInstScrut</span></a><span> </span><a href="#local-1628117504"><span class="hs-identifier hs-var">psums_tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_con_tys</span><span> </span><a href="#local-1628117501"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117500"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-504"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117512"><a href="#local-1628117512"><span class="hs-identifier">body</span></a></a><span>        </span><span class="hs-glyph">=</span><span>  </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-1628117511"><span class="hs-identifier hs-var">scrut</span></a><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-1628117511"><span class="hs-identifier hs-var">scrut</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117498"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-505"></a><span>                                    </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a href="#local-1628117505"><span class="hs-identifier hs-var">psums_con</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117506"><span class="hs-identifier hs-var">sel</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628117508"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117509"><span class="hs-identifier hs-var">res'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-506"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117512"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117506"><span class="hs-identifier hs-var">sel</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628117510"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-507"></a><span>
</span><a name="line-508"></a><span>    </span><a name="local-1628117494"><a href="#local-1628117494"><span class="hs-identifier">from_prod</span></a></a><span> </span><a name="local-1628117513"><a href="#local-1628117513"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-1628117514"><a href="#local-1628117514"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117515"><a href="#local-1628117515"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-1628117516"><a href="#local-1628117516"><span class="hs-identifier">ss</span></a></a><span>
</span><a name="line-509"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628117516"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-510"></a><span>        </span><a href="Vectorise.Generic.Description.html#EmptyProd"><span class="hs-identifier hs-var">EmptyProd</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117514"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>        </span><a href="Vectorise.Generic.Description.html#UnaryProd"><span class="hs-identifier hs-var">UnaryProd</span></a><span> </span><a name="local-1628117517"><a href="#local-1628117517"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628117496"><span class="hs-identifier hs-var">from_comp</span></a><span> </span><a href="#local-1628117513"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117514"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-1628117515"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117517"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-512"></a><span>        </span><a href="Vectorise.Generic.Description.html#Prod"><span class="hs-identifier hs-var">Prod</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-513"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117518"><a href="#local-1628117518"><span class="hs-identifier">ptups_tc</span></a></a><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">repr_ptups_tc</span><span> </span><a href="#local-1628117516"><span class="hs-identifier hs-var">ss</span></a><span>
</span><a name="line-514"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-1628117519"><a href="#local-1628117519"><span class="hs-identifier">ptups_con</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-1628117518"><span class="hs-identifier hs-var">ptups_tc</span></a><span>
</span><a name="line-515"></a><span>                </span><a name="local-1628117520"><a href="#local-1628117520"><span class="hs-identifier">ptys</span></a></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="Vectorise.Utils.Base.html#mkPDatasType"><span class="hs-identifier hs-var">mkPDatasType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comp_tys</span><span> </span><a href="#local-1628117516"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-516"></a><span>                </span><a name="local-1628117521"><a href="#local-1628117521"><span class="hs-identifier">vars</span></a></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Monad.Naming.html#newLocalVars"><span class="hs-identifier hs-var">newLocalVars</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;ys&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628117520"><span class="hs-identifier hs-var">ptys</span></a><span>
</span><a name="line-517"></a><span>                </span><span class="hs-special">(</span><a name="local-1628117522"><a href="#local-1628117522"><span class="hs-identifier">res'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117523"><a href="#local-1628117523"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117497"><span class="hs-identifier hs-var">fold</span></a><span> </span><a href="#local-1628117496"><span class="hs-identifier hs-var">from_comp</span></a><span> </span><a href="#local-1628117513"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117514"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-1628117521"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comps</span><span> </span><a href="#local-1628117516"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-518"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117524"><a href="#local-1628117524"><span class="hs-identifier">scrut</span></a></a><span>       </span><span class="hs-glyph">=</span><span>  </span><a href="MkId.html#unwrapFamInstScrut"><span class="hs-identifier hs-var">unwrapFamInstScrut</span></a><span> </span><a href="#local-1628117518"><span class="hs-identifier hs-var">ptups_tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">repr_comp_tys</span><span> </span><a href="#local-1628117516"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117515"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-519"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1628117525"><a href="#local-1628117525"><span class="hs-identifier">body</span></a></a><span>        </span><span class="hs-glyph">=</span><span>  </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-1628117524"><span class="hs-identifier hs-var">scrut</span></a><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-1628117524"><span class="hs-identifier hs-var">scrut</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628117513"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-520"></a><span>                                    </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a href="#local-1628117519"><span class="hs-identifier hs-var">ptups_con</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117521"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117522"><span class="hs-identifier hs-var">res'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-521"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117525"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117523"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-522"></a><span>
</span><a name="line-523"></a><span>    </span><a name="local-1628117495"><a href="#local-1628117495"><span class="hs-identifier">from_con</span></a></a><span> </span><a name="local-1628117526"><a href="#local-1628117526"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-1628117527"><a href="#local-1628117527"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117528"><a href="#local-1628117528"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#ConRepr"><span class="hs-identifier hs-var">ConRepr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117529"><a href="#local-1628117529"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-524"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628117494"><span class="hs-identifier hs-var">from_prod</span></a><span> </span><a href="#local-1628117526"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117527"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-1628117528"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117529"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-525"></a><span>
</span><a name="line-526"></a><span>    </span><a name="local-1628117496"><a href="#local-1628117496"><span class="hs-identifier">from_comp</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117530"><a href="#local-1628117530"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117531"><a href="#local-1628117531"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Keep"><span class="hs-identifier hs-var">Keep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117530"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-1628117531"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-527"></a><span>    </span><span class="hs-identifier">from_comp</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628117532"><a href="#local-1628117532"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117533"><a href="#local-1628117533"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><a href="Vectorise.Generic.Description.html#Wrap"><span class="hs-identifier hs-var">Wrap</span></a><span> </span><a name="local-1628117534"><a href="#local-1628117534"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628117535"><a href="#local-1628117535"><span class="hs-identifier">expr'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Vectorise.Utils.Base.html#unwrapNewTypeBodyOfPDatasWrap"><span class="hs-identifier hs-var">unwrapNewTypeBodyOfPDatasWrap</span></a><span> </span><a href="#local-1628117533"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117534"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-528"></a><span>                                         </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117532"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-1628117535"><span class="hs-identifier hs-var">expr'</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-529"></a><span>                                         </span><span class="hs-special">}</span><span>
</span><a name="line-530"></a><span>
</span><a name="line-531"></a><span>    </span><a name="local-1628117497"><a href="#local-1628117497"><span class="hs-identifier">fold</span></a></a><span> </span><a name="local-1628117536"><a href="#local-1628117536"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628117537"><a href="#local-1628117537"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-1628117538"><a href="#local-1628117538"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1628117539"><a href="#local-1628117539"><span class="hs-identifier">exprs</span></a></a><span> </span><a name="local-1628117540"><a href="#local-1628117540"><span class="hs-identifier">rs</span></a></a><span>
</span><a name="line-532"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="MonadUtils.html#foldrM"><span class="hs-identifier hs-var">foldrM</span></a><span> </span><a href="#local-1628117541"><span class="hs-identifier hs-var">f'</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117538"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><a href="#local-1628117539"><span class="hs-identifier hs-var">exprs</span></a><span> </span><a href="#local-1628117540"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-533"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-534"></a><span>        </span><a name="local-1628117541"><a href="#local-1628117541"><span class="hs-identifier">f'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628117542"><a href="#local-1628117542"><span class="hs-identifier">expr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117543"><a href="#local-1628117543"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1628117544"><a href="#local-1628117544"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117545"><a href="#local-1628117545"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-535"></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-1628117546"><a href="#local-1628117546"><span class="hs-identifier">res'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628117547"><a href="#local-1628117547"><span class="hs-identifier">args'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628117536"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628117537"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-1628117544"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-1628117542"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-1628117543"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-536"></a><span>              </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628117546"><span class="hs-identifier hs-var">res'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628117547"><span class="hs-identifier hs-var">args'</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628117545"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-537"></a><span>
</span><a name="line-538"></a><span>
</span><a name="line-539"></a><span class="hs-comment">-- Notes ----------------------------------------------------------------------</span><span>
</span><a name="line-540"></a><span class="hs-comment">{-
Note [Empty PDatas]
~~~~~~~~~~~~~~~~~~~
We don't support &quot;empty&quot; data types like the following:

  data Empty0
  data Empty1 = MkEmpty1
  data Empty2 = MkEmpty2 Empty0
  ...

There is no parallel data associcated with these types, so there is no where
to store the length of the PDatas array with our standard representation.

Enumerations like the following are ok:
  data Bool = True | False

The native and generic representations are:
  type instance (PDatas Bool)        = VPDs:Bool Sels2
  type instance (PDatas (Repr Bool)) = PSum2s Sels2 (PDatas Void) (PDatas Void)

To take the length of a (PDatas Bool) we take the length of the contained Sels2.
When converting a (PDatas Bool) to a (PDatas (Repr Bool)) we use this length to
initialise the two (PDatas Void) arrays.

However, with this:
  data Empty1 = MkEmpty1

The native and generic representations would be:
  type instance (PDatas Empty1)        = VPDs:Empty1
  type instance (PDatas (Repr Empty1)) = PVoids Int

The 'Int' argument of PVoids is supposed to store the length of the PDatas
array. When converting the (PDatas Empty1) to a (PDatas (Repr Empty1)) we
need to come up with a value for it, but there isn't one.

To fix this we'd need to add an Int field to VPDs:Empty1 as well, but that's
too much hassle and there's no point running a parallel computation on no
data anyway.
-}</span><span>
</span><a name="line-579"></a><span class="hs-identifier">errorEmptyPDatas</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628117224"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-580"></a><a name="errorEmptyPDatas"><a href="Vectorise.Generic.PAMethods.html#errorEmptyPDatas"><span class="hs-identifier">errorEmptyPDatas</span></a></a><span> </span><a name="local-1628117558"><a href="#local-1628117558"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1628117559"><a href="#local-1628117559"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-581"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Vectorise.Monad.Base.html#cantVectorise"><span class="hs-identifier hs-var">cantVectorise</span></a><span> </span><a href="#local-1628117558"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;Vectorise.PAMethods&quot;</span><span>
</span><a name="line-582"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>  </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Cannot vectorise data type with no parallel data &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628117559"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-583"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Data types to be vectorised must contain at least one constructor&quot;</span><span>
</span><a name="line-584"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;with at least one field.&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-585"></a></pre></body></html>