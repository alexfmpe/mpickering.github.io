<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, TypeFamilies #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-- Type definitions for the constraint solver</span><span>
</span><a name="line-4"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcSMonad</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span>    </span><span class="hs-comment">-- The work list</span><span>
</span><a name="line-7"></a><span>    </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#isEmptyWorkList"><span class="hs-identifier hs-var">isEmptyWorkList</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a><span class="hs-special">,</span><span>
</span><a name="line-8"></a><span>    </span><a href="TcSMonad.html#extendWorkListNonEq"><span class="hs-identifier hs-var">extendWorkListNonEq</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#extendWorkListCt"><span class="hs-identifier hs-var">extendWorkListCt</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#extendWorkListDerived"><span class="hs-identifier hs-var">extendWorkListDerived</span></a><span class="hs-special">,</span><span>
</span><a name="line-9"></a><span>    </span><a href="TcSMonad.html#extendWorkListCts"><span class="hs-identifier hs-var">extendWorkListCts</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#extendWorkListEq"><span class="hs-identifier hs-var">extendWorkListEq</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#extendWorkListFunEq"><span class="hs-identifier hs-var">extendWorkListFunEq</span></a><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>    </span><a href="TcSMonad.html#appendWorkList"><span class="hs-identifier hs-var">appendWorkList</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>    </span><a href="TcSMonad.html#selectNextWorkItem"><span class="hs-identifier hs-var">selectNextWorkItem</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>    </span><a href="TcSMonad.html#workListSize"><span class="hs-identifier hs-var">workListSize</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#workListWantedCount"><span class="hs-identifier hs-var">workListWantedCount</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>    </span><a href="TcSMonad.html#getWorkList"><span class="hs-identifier hs-var">getWorkList</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span>    </span><span class="hs-comment">-- The TcS monad</span><span>
</span><a name="line-16"></a><span>    </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#runTcS"><span class="hs-identifier hs-var">runTcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#runTcSDeriveds"><span class="hs-identifier hs-var">runTcSDeriveds</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#runTcSWithEvBinds"><span class="hs-identifier hs-var">runTcSWithEvBinds</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>    </span><a href="TcSMonad.html#failTcS"><span class="hs-identifier hs-var">failTcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#warnTcS"><span class="hs-identifier hs-var">warnTcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#addErrTcS"><span class="hs-identifier hs-var">addErrTcS</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>    </span><a href="TcSMonad.html#runTcSEqualities"><span class="hs-identifier hs-var">runTcSEqualities</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>    </span><a href="TcSMonad.html#nestTcS"><span class="hs-identifier hs-var">nestTcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#nestImplicTcS"><span class="hs-identifier hs-var">nestImplicTcS</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>    </span><a href="TcSMonad.html#runTcPluginTcS"><span class="hs-identifier hs-var">runTcPluginTcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#addUsedDataCons"><span class="hs-identifier hs-var">addUsedDataCons</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#deferTcSForAllEq"><span class="hs-identifier hs-var">deferTcSForAllEq</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span>    </span><span class="hs-comment">-- Tracing etc</span><span>
</span><a name="line-24"></a><span>    </span><a href="TcSMonad.html#panicTcS"><span class="hs-identifier hs-var">panicTcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>    </span><a href="TcSMonad.html#traceFireTcS"><span class="hs-identifier hs-var">traceFireTcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#bumpStepCountTcS"><span class="hs-identifier hs-var">bumpStepCountTcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#csTraceTcS"><span class="hs-identifier hs-var">csTraceTcS</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>    </span><a href="TcSMonad.html#wrapErrTcS"><span class="hs-identifier hs-var">wrapErrTcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#wrapWarnTcS"><span class="hs-identifier hs-var">wrapWarnTcS</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>    </span><span class="hs-comment">-- Evidence creation and transformation</span><span>
</span><a name="line-29"></a><span>    </span><a href="TcSMonad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#freshGoals"><span class="hs-identifier hs-var">freshGoals</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#isFresh"><span class="hs-identifier hs-var">isFresh</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getEvTerm"><span class="hs-identifier hs-var">getEvTerm</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>    </span><a href="TcSMonad.html#newTcEvBinds"><span class="hs-identifier hs-var">newTcEvBinds</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>    </span><a href="TcSMonad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>    </span><a href="TcSMonad.html#newWanted"><span class="hs-identifier hs-var">newWanted</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#newWantedEvVar"><span class="hs-identifier hs-var">newWantedEvVar</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#newWantedEvVarNC"><span class="hs-identifier hs-var">newWantedEvVarNC</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#newDerivedNC"><span class="hs-identifier hs-var">newDerivedNC</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>    </span><a href="TcSMonad.html#newBoundEvVarId"><span class="hs-identifier hs-var">newBoundEvVarId</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>    </span><a href="TcSMonad.html#unifyTyVar"><span class="hs-identifier hs-var">unifyTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#unflattenFmv"><span class="hs-identifier hs-var">unflattenFmv</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#reportUnifications"><span class="hs-identifier hs-var">reportUnifications</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>    </span><a href="TcSMonad.html#setEvBind"><span class="hs-identifier hs-var">setEvBind</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#setWantedEq"><span class="hs-identifier hs-var">setWantedEq</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#setEqIfWanted"><span class="hs-identifier hs-var">setEqIfWanted</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>    </span><a href="TcSMonad.html#setWantedEvTerm"><span class="hs-identifier hs-var">setWantedEvTerm</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#setWantedEvBind"><span class="hs-identifier hs-var">setWantedEvBind</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#setEvBindIfWanted"><span class="hs-identifier hs-var">setEvBindIfWanted</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>    </span><a href="TcSMonad.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#newGivenEvVars"><span class="hs-identifier hs-var">newGivenEvVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>    </span><a href="TcSMonad.html#emitNewDerived"><span class="hs-identifier hs-var">emitNewDerived</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#emitNewDeriveds"><span class="hs-identifier hs-var">emitNewDeriveds</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#emitNewDerivedEq"><span class="hs-identifier hs-var">emitNewDerivedEq</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>    </span><a href="TcSMonad.html#checkReductionDepth"><span class="hs-identifier hs-var">checkReductionDepth</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>    </span><a href="TcSMonad.html#getInstEnvs"><span class="hs-identifier hs-var">getInstEnvs</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getFamInstEnvs"><span class="hs-identifier hs-var">getFamInstEnvs</span></a><span class="hs-special">,</span><span>                </span><span class="hs-comment">-- Getting the environments</span><span>
</span><a name="line-43"></a><span>    </span><a href="TcSMonad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>    </span><a href="TcSMonad.html#getTcEvBinds"><span class="hs-identifier hs-var">getTcEvBinds</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getTcEvBindsFromVar"><span class="hs-identifier hs-var">getTcEvBindsFromVar</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>    </span><a href="TcSMonad.html#getTcEvBindsMap"><span class="hs-identifier hs-var">getTcEvBindsMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>    </span><a href="TcSMonad.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span>    </span><span class="hs-comment">-- Inerts</span><span>
</span><a name="line-49"></a><span>    </span><a href="TcSMonad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>    </span><a href="TcSMonad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#updInertDicts"><span class="hs-identifier hs-var">updInertDicts</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#updInertIrreds"><span class="hs-identifier hs-var">updInertIrreds</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>    </span><a href="TcSMonad.html#getNoGivenEqs"><span class="hs-identifier hs-var">getNoGivenEqs</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#setInertCans"><span class="hs-identifier hs-var">setInertCans</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>    </span><a href="TcSMonad.html#getInertEqs"><span class="hs-identifier hs-var">getInertEqs</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getInertModel"><span class="hs-identifier hs-var">getInertModel</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getInertGivens"><span class="hs-identifier hs-var">getInertGivens</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>    </span><a href="TcSMonad.html#emptyInert"><span class="hs-identifier hs-var">emptyInert</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#setTcSInerts"><span class="hs-identifier hs-var">setTcSInerts</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#takeGivenInsolubles"><span class="hs-identifier hs-var">takeGivenInsolubles</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>    </span><a href="TcSMonad.html#matchableGivens"><span class="hs-identifier hs-var">matchableGivens</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#prohibitedSuperClassSolve"><span class="hs-identifier hs-var">prohibitedSuperClassSolve</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>    </span><a href="TcSMonad.html#getUnsolvedInerts"><span class="hs-identifier hs-var">getUnsolvedInerts</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>    </span><a href="TcSMonad.html#removeInertCts"><span class="hs-identifier hs-var">removeInertCts</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getPendingScDicts"><span class="hs-identifier hs-var">getPendingScDicts</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>    </span><a href="TcSMonad.html#addInertCan"><span class="hs-identifier hs-var">addInertCan</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#addInertEq"><span class="hs-identifier hs-var">addInertEq</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#insertFunEq"><span class="hs-identifier hs-var">insertFunEq</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>    </span><a href="TcSMonad.html#emitInsoluble"><span class="hs-identifier hs-var">emitInsoluble</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#emitWorkNC"><span class="hs-identifier hs-var">emitWorkNC</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span>    </span><span class="hs-comment">-- The Model</span><span>
</span><a name="line-61"></a><span>    </span><a href="TcSMonad.html#InertModel"><span class="hs-identifier hs-type">InertModel</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#kickOutAfterUnification"><span class="hs-identifier hs-var">kickOutAfterUnification</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span>    </span><span class="hs-comment">-- Inert Safe Haskell safe-overlap failures</span><span>
</span><a name="line-64"></a><span>    </span><a href="TcSMonad.html#addInertSafehask"><span class="hs-identifier hs-var">addInertSafehask</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#insertSafeOverlapFailureTcS"><span class="hs-identifier hs-var">insertSafeOverlapFailureTcS</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#updInertSafehask"><span class="hs-identifier hs-var">updInertSafehask</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>    </span><a href="TcSMonad.html#getSafeOverlapFailures"><span class="hs-identifier hs-var">getSafeOverlapFailures</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span>    </span><span class="hs-comment">-- Inert CDictCans</span><span>
</span><a name="line-68"></a><span>    </span><a href="TcSMonad.html#lookupInertDict"><span class="hs-identifier hs-var">lookupInertDict</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#findDictsByClass"><span class="hs-identifier hs-var">findDictsByClass</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#addDict"><span class="hs-identifier hs-var">addDict</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#addDictsByClass"><span class="hs-identifier hs-var">addDictsByClass</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>    </span><a href="TcSMonad.html#delDict"><span class="hs-identifier hs-var">delDict</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#partitionDicts"><span class="hs-identifier hs-var">partitionDicts</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#filterDicts"><span class="hs-identifier hs-var">filterDicts</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span>    </span><span class="hs-comment">-- Inert CTyEqCans</span><span>
</span><a name="line-72"></a><span>    </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#findTyEqs"><span class="hs-identifier hs-var">findTyEqs</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#foldTyEqs"><span class="hs-identifier hs-var">foldTyEqs</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#isInInertEqs"><span class="hs-identifier hs-var">isInInertEqs</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>    </span><span class="hs-comment">-- Inert solved dictionaries</span><span>
</span><a name="line-75"></a><span>    </span><a href="TcSMonad.html#addSolvedDict"><span class="hs-identifier hs-var">addSolvedDict</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#lookupSolvedDict"><span class="hs-identifier hs-var">lookupSolvedDict</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span>    </span><span class="hs-comment">-- Irreds</span><span>
</span><a name="line-78"></a><span>    </span><a href="TcSMonad.html#foldIrreds"><span class="hs-identifier hs-var">foldIrreds</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span>    </span><span class="hs-comment">-- The flattening cache</span><span>
</span><a name="line-81"></a><span>    </span><a href="TcSMonad.html#lookupFlatCache"><span class="hs-identifier hs-var">lookupFlatCache</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#extendFlatCache"><span class="hs-identifier hs-var">extendFlatCache</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#newFlattenSkolem"><span class="hs-identifier hs-var">newFlattenSkolem</span></a><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- Flatten skolems</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span>    </span><span class="hs-comment">-- Inert CFunEqCans</span><span>
</span><a name="line-84"></a><span>    </span><a href="TcSMonad.html#updInertFunEqs"><span class="hs-identifier hs-var">updInertFunEqs</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#findFunEq"><span class="hs-identifier hs-var">findFunEq</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#sizeFunEqMap"><span class="hs-identifier hs-var">sizeFunEqMap</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#filterFunEqs"><span class="hs-identifier hs-var">filterFunEqs</span></a><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>    </span><a href="TcSMonad.html#findFunEqsByTyCon"><span class="hs-identifier hs-var">findFunEqsByTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#partitionFunEqs"><span class="hs-identifier hs-var">partitionFunEqs</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span>    </span><a href="TcSMonad.html#instDFunType"><span class="hs-identifier hs-var">instDFunType</span></a><span class="hs-special">,</span><span>                              </span><span class="hs-comment">-- Instantiation</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span>    </span><span class="hs-comment">-- MetaTyVars</span><span>
</span><a name="line-90"></a><span>    </span><a href="TcSMonad.html#newFlexiTcSTy"><span class="hs-identifier hs-var">newFlexiTcSTy</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#instFlexiTcS"><span class="hs-identifier hs-var">instFlexiTcS</span></a><span class="hs-special">,</span><span>
</span><a name="line-91"></a><span>    </span><a href="TcSMonad.html#cloneMetaTyVar"><span class="hs-identifier hs-var">cloneMetaTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#demoteUnfilledFmv"><span class="hs-identifier hs-var">demoteUnfilledFmv</span></a><span class="hs-special">,</span><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span>    </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#isTouchableMetaTyVarTcS"><span class="hs-identifier hs-var">isTouchableMetaTyVarTcS</span></a><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>    </span><a href="TcSMonad.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-var">isFilledMetaTyVar_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#isFilledMetaTyVar"><span class="hs-identifier hs-var">isFilledMetaTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>    </span><a href="TcSMonad.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-var">zonkTyCoVarsAndFV</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#zonkTcTypes"><span class="hs-identifier hs-var">zonkTcTypes</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#zonkCo"><span class="hs-identifier hs-var">zonkCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-96"></a><span>    </span><a href="TcSMonad.html#zonkSimples"><span class="hs-identifier hs-var">zonkSimples</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#zonkWC"><span class="hs-identifier hs-var">zonkWC</span></a><span class="hs-special">,</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span>    </span><span class="hs-comment">-- References</span><span>
</span><a name="line-99"></a><span>    </span><a href="TcSMonad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span>    </span><span class="hs-comment">-- Misc</span><span>
</span><a name="line-102"></a><span>    </span><a href="TcSMonad.html#getDefaultInfo"><span class="hs-identifier hs-var">getDefaultInfo</span></a><span class="hs-special">,</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#getGlobalRdrEnvTcS"><span class="hs-identifier hs-var">getGlobalRdrEnvTcS</span></a><span class="hs-special">,</span><span>
</span><a name="line-103"></a><span>    </span><a href="TcSMonad.html#matchFam"><span class="hs-identifier hs-var">matchFam</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#matchFamTcM"><span class="hs-identifier hs-var">matchFamTcM</span></a><span class="hs-special">,</span><span>
</span><a name="line-104"></a><span>    </span><a href="TcSMonad.html#checkWellStagedDFun"><span class="hs-identifier hs-var">checkWellStagedDFun</span></a><span class="hs-special">,</span><span>
</span><a name="line-105"></a><span>    </span><a href="TcSMonad.html#pprEq"><span class="hs-identifier hs-var">pprEq</span></a><span>                                    </span><span class="hs-comment">-- Smaller utils, re-exported from TcM</span><span>
</span><a name="line-106"></a><span>                                             </span><span class="hs-comment">-- TODO (DV): these are only really used in the</span><span>
</span><a name="line-107"></a><span>                                             </span><span class="hs-comment">-- instance matcher in TcSimplify. I am wondering</span><span>
</span><a name="line-108"></a><span>                                             </span><span class="hs-comment">-- if the whole instance matcher simply belongs</span><span>
</span><a name="line-109"></a><span>                                             </span><span class="hs-comment">-- here</span><span>
</span><a name="line-110"></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Inst.html"><span class="hs-identifier">Inst</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TcM</span><span>
</span><a name="line-117"></a><span class="hs-keyword">import</span><span> </span><a href="InstEnv.html"><span class="hs-identifier">InstEnv</span></a><span>
</span><a name="line-118"></a><span class="hs-keyword">import</span><span> </span><a href="FamInst.html"><span class="hs-identifier">FamInst</span></a><span>
</span><a name="line-119"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TcM</span><span>
</span><a name="line-122"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="TcMType.html"><span class="hs-identifier">TcMType</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TcM</span><span>
</span><a name="line-123"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="TcEnv.html"><span class="hs-identifier">TcEnv</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TcM</span><span>
</span><a name="line-124"></a><span>       </span><span class="hs-special">(</span><span> </span><a href="TcEnv.html#checkWellStaged"><span class="hs-identifier hs-var">checkWellStaged</span></a><span class="hs-special">,</span><span> </span><a href="TcEnv.html#topIdLvl"><span class="hs-identifier hs-var">topIdLvl</span></a><span class="hs-special">,</span><span> </span><a href="TcEnv.html#tcGetDefaultTys"><span class="hs-identifier hs-var">tcGetDefaultTys</span></a><span class="hs-special">,</span><span> </span><a href="TcEnv.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span class="hs-keyword">import</span><span> </span><a href="Kind.html"><span class="hs-identifier">Kind</span></a><span>
</span><a name="line-126"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-127"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-128"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-129"></a><span class="hs-keyword">import</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span>
</span><a name="line-130"></a><span class="hs-keyword">import</span><span> </span><a href="Unify.html"><span class="hs-identifier">Unify</span></a><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-keyword">import</span><span> </span><a href="TcEvidence.html"><span class="hs-identifier">TcEvidence</span></a><span>
</span><a name="line-133"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-134"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-135"></a><span class="hs-keyword">import</span><span> </span><a href="TcErrors.html"><span class="hs-identifier">TcErrors</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="TcErrors.html#solverDepthErrorTcS"><span class="hs-identifier hs-var">solverDepthErrorTcS</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-138"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="RnEnv.html"><span class="hs-identifier">RnEnv</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TcM</span><span>
</span><a name="line-140"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-141"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-142"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-143"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-144"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-145"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-146"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-147"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnTypes.html"><span class="hs-identifier">TcRnTypes</span></a><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span>
</span><a name="line-150"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>
</span><a name="line-151"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-keyword">import</span><span> </span><a href="StaticFlags.html"><span class="hs-identifier">StaticFlags</span></a><span class="hs-special">(</span><span> </span><a href="StaticFlags.html#opt_PprStyle_Debug"><span class="hs-identifier hs-var">opt_PprStyle_Debug</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span class="hs-keyword">import</span><span> </span><a href="TrieMap.html"><span class="hs-identifier">TrieMap</span></a><span>
</span><a name="line-155"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-156"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710</span><span>
</span><a name="line-157"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.Fail.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Fail</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MonadFail</span><span>
</span><a name="line-158"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-159"></a><span class="hs-keyword">import</span><span> </span><a href="MonadUtils.html"><span class="hs-identifier">MonadUtils</span></a><span>
</span><a name="line-160"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span></a><span>
</span><a name="line-161"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-cpp">#ifdef DEBUG</span><span>
</span><a name="line-164"></a><span class="hs-keyword">import</span><span> </span><a href="Digraph.html"><span class="hs-identifier">Digraph</span></a><span>
</span><a name="line-165"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
*                            Worklists                                *
*  Canonical and non-canonical constraints that the simplifier has to  *
*  work on. Including their simplification depths.                     *
*                                                                      *
*                                                                      *
************************************************************************

Note [WorkList priorities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
A WorkList contains canonical and non-canonical items (of all flavors).
Notice that each Ct now has a simplification depth. We may
consider using this depth for prioritization as well in the future.

As a simple form of priority queue, our worklist separates out
equalities (wl_eqs) from the rest of the canonical constraints,
so that it's easier to deal with them first, but the separation
is not strictly necessary. Notice that non-canonical constraints
are also parts of the worklist.

Note [Process derived items last]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We can often solve all goals without processing *any* derived constraints.
The derived constraints are just there to help us if we get stuck.  So
we keep them in a separate list.

-}</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-comment">-- See Note [WorkList priorities]</span><span>
</span><a name="line-198"></a><span class="hs-keyword">data</span><span> </span><a name="WorkList"><a href="TcSMonad.html#WorkList"><span class="hs-identifier">WorkList</span></a></a><span>
</span><a name="line-199"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="WL"><a href="TcSMonad.html#WL"><span class="hs-identifier">WL</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#wl_eqs"><span class="hs-identifier">wl_eqs</span></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>
</span><a name="line-200"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#wl_funeqs"><span class="hs-identifier">wl_funeqs</span></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- LIFO stack of goals</span><span>
</span><a name="line-201"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#wl_rest"><span class="hs-identifier">wl_rest</span></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>
</span><a name="line-202"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#wl_deriv"><span class="hs-identifier">wl_deriv</span></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Implicitly non-canonical</span><span>
</span><a name="line-203"></a><span>                                     </span><span class="hs-comment">-- See Note [Process derived items last]</span><span>
</span><a name="line-204"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#wl_implics"><span class="hs-identifier">wl_implics</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span>  </span><span class="hs-comment">-- See Note [Residual implications]</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-identifier">appendWorkList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-208"></a><a name="appendWorkList"><a href="TcSMonad.html#appendWorkList"><span class="hs-identifier">appendWorkList</span></a></a><span>
</span><a name="line-209"></a><span>    </span><span class="hs-special">(</span><a href="TcSMonad.html#WL"><span class="hs-identifier hs-var">WL</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203581"><a href="#local-1628203581"><span class="hs-identifier">eqs1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203582"><a href="#local-1628203582"><span class="hs-identifier">funeqs1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_rest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203583"><a href="#local-1628203583"><span class="hs-identifier">rest1</span></a></a><span>
</span><a name="line-210"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_deriv</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203584"><a href="#local-1628203584"><span class="hs-identifier">ders1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_implics</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203585"><a href="#local-1628203585"><span class="hs-identifier">implics1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-special">(</span><a href="TcSMonad.html#WL"><span class="hs-identifier hs-var">WL</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203586"><a href="#local-1628203586"><span class="hs-identifier">eqs2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203587"><a href="#local-1628203587"><span class="hs-identifier">funeqs2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_rest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203588"><a href="#local-1628203588"><span class="hs-identifier">rest2</span></a></a><span>
</span><a name="line-212"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_deriv</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203589"><a href="#local-1628203589"><span class="hs-identifier">ders2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_implics</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203590"><a href="#local-1628203590"><span class="hs-identifier">implics2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#WL"><span class="hs-identifier hs-var">WL</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203581"><span class="hs-identifier hs-var">eqs1</span></a><span>     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628203586"><span class="hs-identifier hs-var">eqs2</span></a><span>
</span><a name="line-214"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_funeqs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203582"><span class="hs-identifier hs-var">funeqs1</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628203587"><span class="hs-identifier hs-var">funeqs2</span></a><span>
</span><a name="line-215"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_rest</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203583"><span class="hs-identifier hs-var">rest1</span></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628203588"><span class="hs-identifier hs-var">rest2</span></a><span>
</span><a name="line-216"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_deriv</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203584"><span class="hs-identifier hs-var">ders1</span></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628203589"><span class="hs-identifier hs-var">ders2</span></a><span>
</span><a name="line-217"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_implics</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203585"><span class="hs-identifier hs-var">implics1</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span>   </span><a href="#local-1628203590"><span class="hs-identifier hs-var">implics2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-identifier">workListSize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-220"></a><a name="workListSize"><a href="TcSMonad.html#workListSize"><span class="hs-identifier">workListSize</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#WL"><span class="hs-identifier hs-var">WL</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203591"><a href="#local-1628203591"><span class="hs-identifier">eqs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203592"><a href="#local-1628203592"><span class="hs-identifier">funeqs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_deriv</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203593"><a href="#local-1628203593"><span class="hs-identifier">ders</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_rest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203594"><a href="#local-1628203594"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1628203591"><span class="hs-identifier hs-var">eqs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1628203592"><span class="hs-identifier hs-var">funeqs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1628203594"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1628203593"><span class="hs-identifier hs-var">ders</span></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-identifier">workListWantedCount</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-224"></a><a name="workListWantedCount"><a href="TcSMonad.html#workListWantedCount"><span class="hs-identifier">workListWantedCount</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#WL"><span class="hs-identifier hs-var">WL</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203595"><a href="#local-1628203595"><span class="hs-identifier">eqs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_rest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203596"><a href="#local-1628203596"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#count"><span class="hs-identifier hs-var">count</span></a><span> </span><a href="TcRnTypes.html#isWantedCt"><span class="hs-identifier hs-var">isWantedCt</span></a><span> </span><a href="#local-1628203595"><span class="hs-identifier hs-var">eqs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="Util.html#count"><span class="hs-identifier hs-var">count</span></a><span> </span><a href="TcRnTypes.html#isWantedCt"><span class="hs-identifier hs-var">isWantedCt</span></a><span> </span><a href="#local-1628203596"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-identifier">extendWorkListEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-228"></a><a name="extendWorkListEq"><a href="TcSMonad.html#extendWorkListEq"><span class="hs-identifier">extendWorkListEq</span></a></a><span> </span><a name="local-1628203597"><a href="#local-1628203597"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1628203598"><a href="#local-1628203598"><span class="hs-identifier">wl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203598"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203597"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">wl_eqs</span><span> </span><a href="#local-1628203598"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span class="hs-identifier">extendWorkListEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-231"></a><a name="extendWorkListEqs"><a href="TcSMonad.html#extendWorkListEqs"><span class="hs-identifier">extendWorkListEqs</span></a></a><span> </span><a name="local-1628203599"><a href="#local-1628203599"><span class="hs-identifier">cts</span></a></a><span> </span><a name="local-1628203600"><a href="#local-1628203600"><span class="hs-identifier">wl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203600"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203599"><span class="hs-identifier hs-var">cts</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-identifier">wl_eqs</span><span> </span><a href="#local-1628203600"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-identifier">extendWorkListFunEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-234"></a><a name="extendWorkListFunEq"><a href="TcSMonad.html#extendWorkListFunEq"><span class="hs-identifier">extendWorkListFunEq</span></a></a><span> </span><a name="local-1628203601"><a href="#local-1628203601"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1628203602"><a href="#local-1628203602"><span class="hs-identifier">wl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203602"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203601"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">wl_funeqs</span><span> </span><a href="#local-1628203602"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-identifier">extendWorkListNonEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-237"></a><span class="hs-comment">-- Extension by non equality</span><span>
</span><a name="line-238"></a><a name="extendWorkListNonEq"><a href="TcSMonad.html#extendWorkListNonEq"><span class="hs-identifier">extendWorkListNonEq</span></a></a><span> </span><a name="local-1628203603"><a href="#local-1628203603"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1628203604"><a href="#local-1628203604"><span class="hs-identifier">wl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203604"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_rest</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203603"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">wl_rest</span><span> </span><a href="#local-1628203604"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span class="hs-identifier">extendWorkListDerived</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-241"></a><a name="extendWorkListDerived"><a href="TcSMonad.html#extendWorkListDerived"><span class="hs-identifier">extendWorkListDerived</span></a></a><span> </span><a name="local-1628203605"><a href="#local-1628203605"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628203606"><a href="#local-1628203606"><span class="hs-identifier">ev</span></a></a><span> </span><a name="local-1628203607"><a href="#local-1628203607"><span class="hs-identifier">wl</span></a></a><span>
</span><a name="line-242"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#isDroppableDerivedLoc"><span class="hs-identifier hs-var">isDroppableDerivedLoc</span></a><span> </span><a href="#local-1628203605"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203607"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_deriv</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203606"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">wl_deriv</span><span> </span><a href="#local-1628203607"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-243"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#extendWorkListEq"><span class="hs-identifier hs-var">extendWorkListEq</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="#local-1628203606"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203607"><span class="hs-identifier hs-var">wl</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-identifier">extendWorkListDeriveds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-246"></a><a name="extendWorkListDeriveds"><a href="TcSMonad.html#extendWorkListDeriveds"><span class="hs-identifier">extendWorkListDeriveds</span></a></a><span> </span><a name="local-1628203608"><a href="#local-1628203608"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628203609"><a href="#local-1628203609"><span class="hs-identifier">evs</span></a></a><span> </span><a name="local-1628203610"><a href="#local-1628203610"><span class="hs-identifier">wl</span></a></a><span>
</span><a name="line-247"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#isDroppableDerivedLoc"><span class="hs-identifier hs-var">isDroppableDerivedLoc</span></a><span> </span><a href="#local-1628203608"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203610"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_deriv</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203609"><span class="hs-identifier hs-var">evs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-identifier">wl_deriv</span><span> </span><a href="#local-1628203610"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-248"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#extendWorkListEqs"><span class="hs-identifier hs-var">extendWorkListEqs</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="#local-1628203609"><span class="hs-identifier hs-var">evs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203610"><span class="hs-identifier hs-var">wl</span></a><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-identifier">extendWorkListImplic</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-251"></a><a name="extendWorkListImplic"><a href="TcSMonad.html#extendWorkListImplic"><span class="hs-identifier">extendWorkListImplic</span></a></a><span> </span><a name="local-1628203611"><a href="#local-1628203611"><span class="hs-identifier">implic</span></a></a><span> </span><a name="local-1628203612"><a href="#local-1628203612"><span class="hs-identifier">wl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203612"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_implics</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203611"><span class="hs-identifier hs-var">implic</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">wl_implics</span><span> </span><a href="#local-1628203612"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span class="hs-identifier">extendWorkListCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-254"></a><span class="hs-comment">-- Agnostic</span><span>
</span><a name="line-255"></a><a name="extendWorkListCt"><a href="TcSMonad.html#extendWorkListCt"><span class="hs-identifier">extendWorkListCt</span></a></a><span> </span><a name="local-1628203613"><a href="#local-1628203613"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1628203614"><a href="#local-1628203614"><span class="hs-identifier">wl</span></a></a><span>
</span><a name="line-256"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a><span> </span><a href="#local-1628203613"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-257"></a><span>     </span><a href="Type.html#EqPred"><span class="hs-identifier hs-var">EqPred</span></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span> </span><a name="local-1628203615"><a href="#local-1628203615"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-258"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628203616"><a href="#local-1628203616"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-1628203615"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-259"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a><span> </span><a href="#local-1628203616"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-260"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#extendWorkListFunEq"><span class="hs-identifier hs-var">extendWorkListFunEq</span></a><span> </span><a href="#local-1628203613"><span class="hs-identifier hs-var">ct</span></a><span> </span><a href="#local-1628203614"><span class="hs-identifier hs-var">wl</span></a><span>
</span><a name="line-261"></a><span>     </span><a href="Type.html#EqPred"><span class="hs-identifier hs-var">EqPred</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-262"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#extendWorkListEq"><span class="hs-identifier hs-var">extendWorkListEq</span></a><span> </span><a href="#local-1628203613"><span class="hs-identifier hs-var">ct</span></a><span> </span><a href="#local-1628203614"><span class="hs-identifier hs-var">wl</span></a><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span>     </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#extendWorkListNonEq"><span class="hs-identifier hs-var">extendWorkListNonEq</span></a><span> </span><a href="#local-1628203613"><span class="hs-identifier hs-var">ct</span></a><span> </span><a href="#local-1628203614"><span class="hs-identifier hs-var">wl</span></a><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-identifier">extendWorkListCts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-267"></a><span class="hs-comment">-- Agnostic</span><span>
</span><a name="line-268"></a><a name="extendWorkListCts"><a href="TcSMonad.html#extendWorkListCts"><span class="hs-identifier">extendWorkListCts</span></a></a><span> </span><a name="local-1628203617"><a href="#local-1628203617"><span class="hs-identifier">cts</span></a></a><span> </span><a name="local-1628203618"><a href="#local-1628203618"><span class="hs-identifier">wl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><a href="TcSMonad.html#extendWorkListCt"><span class="hs-identifier hs-var">extendWorkListCt</span></a><span> </span><a href="#local-1628203618"><span class="hs-identifier hs-var">wl</span></a><span> </span><a href="#local-1628203617"><span class="hs-identifier hs-var">cts</span></a><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span class="hs-identifier">isEmptyWorkList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-271"></a><a name="isEmptyWorkList"><a href="TcSMonad.html#isEmptyWorkList"><span class="hs-identifier">isEmptyWorkList</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#WL"><span class="hs-identifier hs-var">WL</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203619"><a href="#local-1628203619"><span class="hs-identifier">eqs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203620"><a href="#local-1628203620"><span class="hs-identifier">funeqs</span></a></a><span>
</span><a name="line-272"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_rest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203621"><a href="#local-1628203621"><span class="hs-identifier">rest</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_deriv</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203622"><a href="#local-1628203622"><span class="hs-identifier">ders</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_implics</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203623"><a href="#local-1628203623"><span class="hs-identifier">implics</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-273"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628203619"><span class="hs-identifier hs-var">eqs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628203621"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628203620"><span class="hs-identifier hs-var">funeqs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a><span> </span><a href="#local-1628203623"><span class="hs-identifier hs-var">implics</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628203622"><span class="hs-identifier hs-var">ders</span></a><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-identifier">emptyWorkList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-276"></a><a name="emptyWorkList"><a href="TcSMonad.html#emptyWorkList"><span class="hs-identifier">emptyWorkList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#WL"><span class="hs-identifier hs-var">WL</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_rest</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-277"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_deriv</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_implics</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-identifier">selectWorkItem</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span class="hs-special">)</span><span>
</span><a name="line-280"></a><a name="selectWorkItem"><a href="TcSMonad.html#selectWorkItem"><span class="hs-identifier">selectWorkItem</span></a></a><span> </span><a name="local-1628203624"><a href="#local-1628203624"><span class="hs-identifier">wl</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcSMonad.html#WL"><span class="hs-identifier hs-var">WL</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203625"><a href="#local-1628203625"><span class="hs-identifier">eqs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203626"><a href="#local-1628203626"><span class="hs-identifier">feqs</span></a></a><span>
</span><a name="line-281"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_rest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203627"><a href="#local-1628203627"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-282"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="local-1628203628"><a href="#local-1628203628"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">:</span><a name="local-1628203629"><a href="#local-1628203629"><span class="hs-identifier">cts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203625"><span class="hs-identifier hs-var">eqs</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203628"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203624"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203629"><span class="hs-identifier hs-var">cts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="local-1628203630"><a href="#local-1628203630"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">:</span><a name="local-1628203631"><a href="#local-1628203631"><span class="hs-identifier">fes</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203626"><span class="hs-identifier hs-var">feqs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203630"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203624"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203631"><span class="hs-identifier hs-var">fes</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="local-1628203632"><a href="#local-1628203632"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">:</span><a name="local-1628203633"><a href="#local-1628203633"><span class="hs-identifier">cts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203627"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203632"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203624"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_rest</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203633"><span class="hs-identifier hs-var">cts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-285"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-identifier">getWorkList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-288"></a><a name="getWorkList"><a href="TcSMonad.html#getWorkList"><span class="hs-identifier">getWorkList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203634"><a href="#local-1628203634"><span class="hs-identifier">wl_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a><span>
</span><a name="line-289"></a><span>                 </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628203634"><span class="hs-identifier hs-var">wl_var</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span class="hs-identifier">selectDerivedWorkItem</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span class="hs-special">)</span><span>
</span><a name="line-292"></a><a name="selectDerivedWorkItem"><a href="TcSMonad.html#selectDerivedWorkItem"><span class="hs-identifier">selectDerivedWorkItem</span></a></a><span> </span><a name="local-1628203635"><a href="#local-1628203635"><span class="hs-identifier">wl</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcSMonad.html#WL"><span class="hs-identifier hs-var">WL</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_deriv</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203636"><a href="#local-1628203636"><span class="hs-identifier">ders</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-293"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="local-1628203637"><a href="#local-1628203637"><span class="hs-identifier">ev</span></a></a><span class="hs-glyph">:</span><a name="local-1628203638"><a href="#local-1628203638"><span class="hs-identifier">evs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203636"><span class="hs-identifier hs-var">ders</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="#local-1628203637"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203635"><span class="hs-identifier hs-var">wl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_deriv</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203638"><span class="hs-identifier hs-var">evs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span class="hs-identifier">selectNextWorkItem</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-297"></a><a name="selectNextWorkItem"><a href="TcSMonad.html#selectNextWorkItem"><span class="hs-identifier">selectNextWorkItem</span></a></a><span>
</span><a name="line-298"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203639"><a href="#local-1628203639"><span class="hs-identifier">wl_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a><span>
</span><a name="line-299"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628203640"><a href="#local-1628203640"><span class="hs-identifier">wl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628203639"><span class="hs-identifier hs-var">wl_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">try</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">,</span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-302"></a><span>             </span><a name="local-1628203641"><a href="#local-1628203641"><span class="hs-identifier">try</span></a></a><span> </span><a name="local-1628203642"><a href="#local-1628203642"><span class="hs-identifier">mb_work</span></a></a><span> </span><a name="local-1628203643"><a href="#local-1628203643"><span class="hs-identifier">do_this_if_fail</span></a></a><span>
</span><a name="line-303"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628203644"><a href="#local-1628203644"><span class="hs-identifier">ct</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628203645"><a href="#local-1628203645"><span class="hs-identifier">new_wl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203642"><span class="hs-identifier hs-var">mb_work</span></a><span>
</span><a name="line-304"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#checkReductionDepth"><span class="hs-identifier hs-var">checkReductionDepth</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctLoc"><span class="hs-identifier hs-var">ctLoc</span></a><span> </span><a href="#local-1628203644"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a><span> </span><a href="#local-1628203644"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><a href="#local-1628203639"><span class="hs-identifier hs-var">wl_var</span></a><span> </span><a href="#local-1628203645"><span class="hs-identifier hs-var">new_wl</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628203644"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-307"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-308"></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203643"><span class="hs-identifier hs-var">do_this_if_fail</span></a><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="#local-1628203641"><span class="hs-identifier hs-var">try</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#selectWorkItem"><span class="hs-identifier hs-var">selectWorkItem</span></a><span> </span><a href="#local-1628203640"><span class="hs-identifier hs-var">wl</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203646"><a href="#local-1628203646"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a><span>
</span><a name="line-313"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628203647"><a href="#local-1628203647"><span class="hs-identifier">solve_deriveds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#keepSolvingDeriveds"><span class="hs-identifier hs-var">keepSolvingDeriveds</span></a><span>
</span><a name="line-314"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">inert_count</span><span> </span><a href="#local-1628203646"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1628203647"><span class="hs-identifier hs-var">solve_deriveds</span></a><span>
</span><a name="line-315"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-316"></a><span>         </span><span class="hs-keyword">else</span><span> </span><a href="#local-1628203641"><span class="hs-identifier hs-var">try</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#selectDerivedWorkItem"><span class="hs-identifier hs-var">selectDerivedWorkItem</span></a><span> </span><a href="#local-1628203640"><span class="hs-identifier hs-var">wl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-comment">-- Pretty printing</span><span>
</span><a name="line-319"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-320"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#WL"><span class="hs-identifier hs-var">WL</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204357"><a href="#local-1628204357"><span class="hs-identifier">eqs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204358"><a href="#local-1628204358"><span class="hs-identifier">feqs</span></a></a><span>
</span><a name="line-321"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_rest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204359"><a href="#local-1628204359"><span class="hs-identifier">rest</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_implics</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204360"><a href="#local-1628204360"><span class="hs-identifier">implics</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_deriv</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204361"><a href="#local-1628204361"><span class="hs-identifier">ders</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;WL&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-323"></a><span>     </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628204357"><span class="hs-identifier hs-var">eqs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-324"></a><span>            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Eqs =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204357"><span class="hs-identifier hs-var">eqs</span></a><span class="hs-special">)</span><span>
</span><a name="line-325"></a><span>          </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628204358"><span class="hs-identifier hs-var">feqs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-326"></a><span>            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Funeqs =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204358"><span class="hs-identifier hs-var">feqs</span></a><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>          </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628204359"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-328"></a><span>            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Non-eqs =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204359"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>          </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628204361"><span class="hs-identifier hs-var">ders</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-330"></a><span>            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Derived =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204361"><span class="hs-identifier hs-var">ders</span></a><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>          </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a><span> </span><a href="#local-1628204360"><span class="hs-identifier hs-var">implics</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-332"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="StaticFlags.html#opt_PprStyle_Debug"><span class="hs-identifier hs-var">opt_PprStyle_Debug</span></a><span>  </span><span class="hs-comment">-- Typically we only want the work list for this level</span><span>
</span><a name="line-333"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Implics =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628204360"><span class="hs-identifier hs-var">implics</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(Implics omitted)&quot;</span><span>
</span><a name="line-335"></a><span>          </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                InertSet: the inert set
*                                                                      *
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-keyword">data</span><span> </span><a name="InertSet"><a href="TcSMonad.html#InertSet"><span class="hs-identifier">InertSet</span></a></a><span>
</span><a name="line-346"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IS"><a href="TcSMonad.html#IS"><span class="hs-identifier">IS</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#inert_cans"><span class="hs-identifier">inert_cans</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span>
</span><a name="line-347"></a><span>              </span><span class="hs-comment">-- Canonical Given, Wanted, Derived (no Solved)</span><span>
</span><a name="line-348"></a><span>              </span><span class="hs-comment">-- Sometimes called &quot;the inert set&quot;</span><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#inert_flat_cache"><span class="hs-identifier">inert_flat_cache</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#ExactFunEqMap"><span class="hs-identifier hs-type">ExactFunEqMap</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>              </span><span class="hs-comment">-- See Note [Type family equations]</span><span>
</span><a name="line-352"></a><span>              </span><span class="hs-comment">-- If    F tys :-&gt; (co, ty, ev),</span><span>
</span><a name="line-353"></a><span>              </span><span class="hs-comment">-- then  co :: F tys ~ ty</span><span>
</span><a name="line-354"></a><span>              </span><span class="hs-comment">--</span><span>
</span><a name="line-355"></a><span>              </span><span class="hs-comment">-- Just a hash-cons cache for use when flattening only</span><span>
</span><a name="line-356"></a><span>              </span><span class="hs-comment">-- These include entirely un-processed goals, so don't use</span><span>
</span><a name="line-357"></a><span>              </span><span class="hs-comment">-- them to solve a top-level goal, else you may end up solving</span><span>
</span><a name="line-358"></a><span>              </span><span class="hs-comment">-- (w:F ty ~ a) by setting w:=w!  We just use the flat-cache</span><span>
</span><a name="line-359"></a><span>              </span><span class="hs-comment">-- when allocating a new flatten-skolem.</span><span>
</span><a name="line-360"></a><span>              </span><span class="hs-comment">-- Not necessarily inert wrt top-level equations (or inert_cans)</span><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span>              </span><span class="hs-comment">-- NB: An ExactFunEqMap -- this doesn't match via loose types!</span><span>
</span><a name="line-363"></a><span>
</span><a name="line-364"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#inert_solved_dicts"><span class="hs-identifier">inert_solved_dicts</span></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-365"></a><span>              </span><span class="hs-comment">-- Of form ev :: C t1 .. tn</span><span>
</span><a name="line-366"></a><span>              </span><span class="hs-comment">-- See Note [Solved dictionaries]</span><span>
</span><a name="line-367"></a><span>              </span><span class="hs-comment">-- and Note [Do not add superclasses of solved dictionaries]</span><span>
</span><a name="line-368"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcSMonad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-371"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-1628204356"><a href="#local-1628204356"><span class="hs-identifier">is</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">inert_cans</span><span> </span><a href="#local-1628204356"><span class="hs-identifier hs-var">is</span></a><span>
</span><a name="line-372"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Solved dicts&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#dictsToBag"><span class="hs-identifier hs-var">dictsToBag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_solved_dicts</span><span> </span><a href="#local-1628204356"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><span class="hs-identifier">emptyInert</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a><span>
</span><a name="line-375"></a><a name="emptyInert"><a href="TcSMonad.html#emptyInert"><span class="hs-identifier">emptyInert</span></a></a><span>
</span><a name="line-376"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#IS"><span class="hs-identifier hs-var">IS</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_cans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_count</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-377"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_eqs</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a><span>
</span><a name="line-378"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_dicts</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#emptyDicts"><span class="hs-identifier hs-var">emptyDicts</span></a><span>
</span><a name="line-379"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_safehask</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#emptyDicts"><span class="hs-identifier hs-var">emptyDicts</span></a><span>
</span><a name="line-380"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_funeqs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#emptyFunEqs"><span class="hs-identifier hs-var">emptyFunEqs</span></a><span>
</span><a name="line-381"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_irreds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a><span>
</span><a name="line-382"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_insols</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a><span>
</span><a name="line-383"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_model</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-384"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_flat_cache</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#emptyExactFunEqs"><span class="hs-identifier hs-var">emptyExactFunEqs</span></a><span>
</span><a name="line-385"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_solved_dicts</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#emptyDictMap"><span class="hs-identifier hs-var">emptyDictMap</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span class="hs-comment">{- Note [Solved dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we apply a top-level instance declararation, we add the &quot;solved&quot;
dictionary to the inert_solved_dicts.  In general, we use it to avoid
creating a new EvVar when we have a new goal that we have solved in
the past.

But in particular, we can use it to create *recursive* dicationaries.
The simplest, degnerate case is
    instance C [a] =&gt; C [a] where ...
If we have
    [W] d1 :: C [x]
then we can apply the instance to get
    d1 = $dfCList d
    [W] d2 :: C [x]
Now 'd1' goes in inert_solved_dicts, and we can solve d2 directly from d1.
    d1 = $dfCList d
    d2 = d1

See Note [Example of recursive dictionaries]
Other notes about solved dictionaries

* See also Note [Do not add superclasses of solved dictionaries]

* The inert_solved_dicts field is not rewritten by equalities, so it may
  get out of date.

Note [Do not add superclasses of solved dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Every member of inert_solved_dicts is the result of applying a dictionary
function, NOT of applying superclass selection to anything.
Consider

        class Ord a =&gt; C a where
        instance Ord [a] =&gt; C [a] where ...

Suppose we are trying to solve
  [G] d1 : Ord a
  [W] d2 : C [a]

Then we'll use the instance decl to give

  [G] d1 : Ord a     Solved: d2 : C [a] = $dfCList d3
  [W] d3 : Ord [a]

We must not add d4 : Ord [a] to the 'solved' set (by taking the
superclass of d2), otherwise we'll use it to solve d3, without ever
using d1, which would be a catastrophe.

Solution: when extending the solved dictionaries, do not add superclasses.
That's why each element of the inert_solved_dicts is the result of applying
a dictionary function.

Note [Example of recursive dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
--- Example 1

    data D r = ZeroD | SuccD (r (D r));

    instance (Eq (r (D r))) =&gt; Eq (D r) where
        ZeroD     == ZeroD     = True
        (SuccD a) == (SuccD b) = a == b
        _         == _         = False;

    equalDC :: D [] -&gt; D [] -&gt; Bool;
    equalDC = (==);

We need to prove (Eq (D [])). Here's how we go:

   [W] d1 : Eq (D [])
By instance decl of Eq (D r):
   [W] d2 : Eq [D []]      where   d1 = dfEqD d2
By instance decl of Eq [a]:
   [W] d3 : Eq (D [])      where   d2 = dfEqList d3
                                   d1 = dfEqD d2
Now this wanted can interact with our &quot;solved&quot; d1 to get:
    d3 = d1

-- Example 2:
This code arises in the context of &quot;Scrap Your Boilerplate with Class&quot;

    class Sat a
    class Data ctx a
    instance  Sat (ctx Char)             =&gt; Data ctx Char       -- dfunData1
    instance (Sat (ctx [a]), Data ctx a) =&gt; Data ctx [a]        -- dfunData2

    class Data Maybe a =&gt; Foo a

    instance Foo t =&gt; Sat (Maybe t)                             -- dfunSat

    instance Data Maybe a =&gt; Foo a                              -- dfunFoo1
    instance Foo a        =&gt; Foo [a]                            -- dfunFoo2
    instance                 Foo [Char]                         -- dfunFoo3

Consider generating the superclasses of the instance declaration
         instance Foo a =&gt; Foo [a]

So our problem is this
    [G] d0 : Foo t
    [W] d1 : Data Maybe [t]   -- Desired superclass

We may add the given in the inert set, along with its superclasses
  Inert:
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  WorkList
    [W] d1 : Data Maybe [t]

Solve d1 using instance dfunData2; d1 := dfunData2 d2 d3
  Inert:
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
  WorkList:
    [W] d2 : Sat (Maybe [t])
    [W] d3 : Data Maybe t

Now, we may simplify d2 using dfunSat; d2 := dfunSat d4
  Inert:
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
        d2 : Sat (Maybe [t])
  WorkList:
    [W] d3 : Data Maybe t
    [W] d4 : Foo [t]

Now, we can just solve d3 from d01; d3 := d01
  Inert
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
        d2 : Sat (Maybe [t])
  WorkList
    [W] d4 : Foo [t]

Now, solve d4 using dfunFoo2;  d4 := dfunFoo2 d5
  Inert
    [G] d0  : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
        d2 : Sat (Maybe [t])
        d4 : Foo [t]
  WorkList:
    [W] d5 : Foo t

Now, d5 can be solved! d5 := d0

Result
   d1 := dfunData2 d2 d3
   d2 := dfunSat d4
   d3 := d01
   d4 := dfunFoo2 d5
   d5 := d0
-}</span><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                InertCans: the canonical inerts
*                                                                      *
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-554"></a><span>
</span><a name="line-555"></a><span class="hs-keyword">data</span><span> </span><a name="InertCans"><a href="TcSMonad.html#InertCans"><span class="hs-identifier">InertCans</span></a></a><span>   </span><span class="hs-comment">-- See Note [Detailed InertCans Invariants] for more</span><span>
</span><a name="line-556"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IC"><a href="TcSMonad.html#IC"><span class="hs-identifier">IC</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#inert_model"><span class="hs-identifier">inert_model</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertModel"><span class="hs-identifier hs-type">InertModel</span></a><span>
</span><a name="line-557"></a><span>              </span><span class="hs-comment">-- See Note [inert_model: the inert model]</span><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#inert_eqs"><span class="hs-identifier">inert_eqs</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span>
</span><a name="line-560"></a><span>              </span><span class="hs-comment">-- See Note [inert_eqs: the inert equalities]</span><span>
</span><a name="line-561"></a><span>              </span><span class="hs-comment">-- All Given/Wanted CTyEqCans; index is the LHS tyvar</span><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#inert_funeqs"><span class="hs-identifier">inert_funeqs</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-564"></a><span>              </span><span class="hs-comment">-- All CFunEqCans; index is the whole family head type.</span><span>
</span><a name="line-565"></a><span>              </span><span class="hs-comment">-- All Nominal (that's an invarint of all CFunEqCans)</span><span>
</span><a name="line-566"></a><span>              </span><span class="hs-comment">-- LHS is fully rewritten (modulo eqCanRewrite constraints)</span><span>
</span><a name="line-567"></a><span>              </span><span class="hs-comment">--     wrt inert_eqs/inert_model</span><span>
</span><a name="line-568"></a><span>              </span><span class="hs-comment">-- We can get Derived ones from e.g.</span><span>
</span><a name="line-569"></a><span>              </span><span class="hs-comment">--   (a) flattening derived equalities</span><span>
</span><a name="line-570"></a><span>              </span><span class="hs-comment">--   (b) emitDerivedShadows</span><span>
</span><a name="line-571"></a><span>
</span><a name="line-572"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#inert_dicts"><span class="hs-identifier">inert_dicts</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-573"></a><span>              </span><span class="hs-comment">-- Dictionaries only</span><span>
</span><a name="line-574"></a><span>              </span><span class="hs-comment">-- All fully rewritten (modulo flavour constraints)</span><span>
</span><a name="line-575"></a><span>              </span><span class="hs-comment">--     wrt inert_eqs/inert_model</span><span>
</span><a name="line-576"></a><span>
</span><a name="line-577"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#inert_safehask"><span class="hs-identifier">inert_safehask</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-578"></a><span>              </span><span class="hs-comment">-- Failed dictionary resolution due to Safe Haskell overlapping</span><span>
</span><a name="line-579"></a><span>              </span><span class="hs-comment">-- instances restriction. We keep this seperate from inert_dicts</span><span>
</span><a name="line-580"></a><span>              </span><span class="hs-comment">-- as it doesn't cause compilation failure, just safe inference</span><span>
</span><a name="line-581"></a><span>              </span><span class="hs-comment">-- failure.</span><span>
</span><a name="line-582"></a><span>              </span><span class="hs-comment">--</span><span>
</span><a name="line-583"></a><span>              </span><span class="hs-comment">-- ^ See Note [Safe Haskell Overlapping Instances Implementation]</span><span>
</span><a name="line-584"></a><span>              </span><span class="hs-comment">-- in TcSimplify</span><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#inert_irreds"><span class="hs-identifier">inert_irreds</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-587"></a><span>              </span><span class="hs-comment">-- Irreducible predicates</span><span>
</span><a name="line-588"></a><span>
</span><a name="line-589"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#inert_insols"><span class="hs-identifier">inert_insols</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-590"></a><span>              </span><span class="hs-comment">-- Frozen errors (as non-canonicals)</span><span>
</span><a name="line-591"></a><span>
</span><a name="line-592"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#inert_count"><span class="hs-identifier">inert_count</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-593"></a><span>              </span><span class="hs-comment">-- Number of Wanted goals in</span><span>
</span><a name="line-594"></a><span>              </span><span class="hs-comment">--     inert_eqs, inert_dicts, inert_safehask, inert_irreds</span><span>
</span><a name="line-595"></a><span>              </span><span class="hs-comment">-- Does not include insolubles</span><span>
</span><a name="line-596"></a><span>              </span><span class="hs-comment">-- When non-zero, keep trying to solved</span><span>
</span><a name="line-597"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-598"></a><span>
</span><a name="line-599"></a><span class="hs-keyword">type</span><span> </span><a name="InertModel"><a href="TcSMonad.html#InertModel"><span class="hs-identifier">InertModel</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-600"></a><span>     </span><span class="hs-comment">-- If a -&gt; ct, then ct is a</span><span>
</span><a name="line-601"></a><span>     </span><span class="hs-comment">--    nominal, Derived, canonical CTyEqCan for [D] (a ~N rhs)</span><span>
</span><a name="line-602"></a><span>     </span><span class="hs-comment">-- The index of the TyVarEnv is the 'a'</span><span>
</span><a name="line-603"></a><span>     </span><span class="hs-comment">-- All saturated info for Given, Wanted, Derived is here</span><span>
</span><a name="line-604"></a><span>
</span><a name="line-605"></a><span>
</span><a name="line-606"></a><span class="hs-comment">{- Note [Detailed InertCans Invariants]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The InertCans represents a collection of constraints with the following properties:

  * All canonical

  * No two dictionaries with the same head
  * No two CIrreds with the same type

  * Family equations inert wrt top-level family axioms

  * Dictionaries have no matching top-level instance

  * Given family or dictionary constraints don't mention touchable
    unification variables

  * Non-CTyEqCan constraints are fully rewritten with respect
    to the CTyEqCan equalities (modulo canRewrite of course;
    eg a wanted cannot rewrite a given)

  * CTyEqCan equalities: see Note [Applying the inert substitution]
                         in TcFlatten

Note [Type family equations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Type-family equations, of form (ev : F tys ~ ty), live in three places

  * The work-list, of course

  * The inert_flat_cache.  This is used when flattening, to get maximal
    sharing.  It contains lots of things that are still in the work-list.
    E.g Suppose we have (w1: F (G a) ~ Int), and (w2: H (G a) ~ Int) in the
        work list.  Then we flatten w1, dumping (w3: G a ~ f1) in the work
        list.  Now if we flatten w2 before we get to w3, we still want to
        share that (G a).

    Because it contains work-list things, DO NOT use the flat cache to solve
    a top-level goal.  Eg in the above example we don't want to solve w3
    using w3 itself!

  * The inert_funeqs are un-solved but fully processed and in the InertCans.

Note [inert_model: the inert model]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Part of the inert set is the &#8220;model&#8221;

   * The &#8220;Model&#8221; is an non-idempotent but no-occurs-check
     substitution, reflecting *all* *Nominal* equalities (a ~N ty)
     that are not immediately soluble by unification.

   * All the constraints in the model are Derived CTyEqCans
     That is if (a -&gt; ty) is in the model, then
     we have an inert constraint [D] a ~N ty.

   * There are two sources of constraints in the model:

     - Derived constraints arising from functional dependencies, or
       decomposing injective arguments of type functions, and
       suchlike.

     - A Derived &quot;shadow copy&quot; for every Given or Wanted (a ~N ty) in
       inert_eqs.

   * The model is not subject to &quot;kicking-out&quot;. Reason: we make a Derived
     shadow copy of any Given/Wanted (a ~ ty), and that Derived copy will
     be fully rewritten by the model before it is added

   * The principal reason for maintaining the model is to generate
     equalities that tell us how to unify a variable: that is, what
     Mark Jones calls &quot;improvement&quot;. The same idea is sometimes also
     called &quot;saturation&quot;; find all the equalities that must hold in
     any solution.

   * Domain of the model = skolems + untouchables.
     A touchable unification variable wouuld have been unified first.

   * The inert_eqs are all Given/Wanted.  The Derived ones are in the
     inert_model only.

   * However inert_dicts, inert_funeqs, inert_irreds
     may well contain derived costraints.

Note [inert_eqs: the inert equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Definition [Can-rewrite relation]
A &quot;can-rewrite&quot; relation between flavours, written f1 &gt;= f2, is a
binary relation with the following properties

  (R1) &gt;= is transitive
  (R2) If f1 &gt;= f, and f2 &gt;= f,
       then either f1 &gt;= f2 or f2 &gt;= f1

Lemma.  If f1 &gt;= f then f1 &gt;= f1
Proof.  By property (R2), with f1=f2

Definition [Generalised substitution]
A &quot;generalised substitution&quot; S is a set of triples (a -f-&gt; t), where
  a is a type variable
  t is a type
  f is a flavour
such that
  (WF1) if (a -f1-&gt; t1) in S
           (a -f2-&gt; t2) in S
        then neither (f1 &gt;= f2) nor (f2 &gt;= f1) hold
  (WF2) if (a -f-&gt; t) is in S, then t /= a

Definition [Applying a generalised substitution]
If S is a generalised substitution
   S(f,a) = t,  if (a -fs-&gt; t) in S, and fs &gt;= f
          = a,  otherwise
Application extends naturally to types S(f,t), modulo roles.
See Note [Flavours with roles].

Theorem: S(f,a) is well defined as a function.
Proof: Suppose (a -f1-&gt; t1) and (a -f2-&gt; t2) are both in S,
               and  f1 &gt;= f and f2 &gt;= f
       Then by (R2) f1 &gt;= f2 or f2 &gt;= f1, which contradicts (WF1)

Notation: repeated application.
  S^0(f,t)     = t
  S^(n+1)(f,t) = S(f, S^n(t))

Definition: inert generalised substitution
A generalised substitution S is &quot;inert&quot; iff

  (IG1) there is an n such that
        for every f,t, S^n(f,t) = S^(n+1)(f,t)

By (IG1) we define S*(f,t) to be the result of exahaustively
applying S(f,_) to t.

----------------------------------------------------------------
Our main invariant:
   the inert CTyEqCans should be an inert generalised substitution
----------------------------------------------------------------

Note that inertness is not the same as idempotence.  To apply S to a
type, you may have to apply it recursive.  But inertness does
guarantee that this recursive use will terminate.

Note [Extending the inert equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Theorem [Stability under extension]
   This is the main theorem!
   Suppose we have a &quot;work item&quot;
       a -fw-&gt; t
   and an inert generalised substitution S,
   such that
      (T1) S(fw,a) = a     -- LHS of work-item is a fixpoint of S(fw,_)
      (T2) S(fw,t) = t     -- RHS of work-item is a fixpoint of S(fw,_)
      (T3) a not in t      -- No occurs check in the work item

      (K1) for every (a -fs-&gt; s) in S, then not (fw &gt;= fs)
           Reason: the work item is fully rewritten by S, hence not (fs &gt;= fw)
                   but if (fw &gt;= fs) then the work item could rewrite
                   the inert item

      (K2) for every (b -fs-&gt; s) in S, where b /= a, then
              (K2a) not (fs &gt;= fs)
           or (K2b) fs &gt;= fw
           or (K2c) not (fw &gt;= fs)
           or (K2d) a not in s

      (K3) See Note [K3: completeness of solving]
           If (b -fs-&gt; s) is in S with (fw &gt;= fs), then
        (K3a) If the role of fs is nominal: s /= a
        (K3b) If the role of fs is representational: EITHER
                a not in s, OR
                the path from the top of s to a includes at least one non-newtype

   then the extended substition T = S+(a -fw-&gt; t)
   is an inert generalised substitution.

Conditions (T1-T3) are established by the canonicaliser
Conditions (K1-K3) are established by TcSMonad.kickOutRewriteable

The idea is that
* (T1-2) are guaranteed by exhaustively rewriting the work-item
  with S(fw,_).

* T3 is guaranteed by a simple occurs-check on the work item.
  This is done during canonicalisation, in canEqTyVar;
  (invariant: a CTyEqCan never has an occurs check).

* (K1-3) are the &quot;kick-out&quot; criteria.  (As stated, they are really the
  &quot;keep&quot; criteria.) If the current inert S contains a triple that does
  not satisfy (K1-3), then we remove it from S by &quot;kicking it out&quot;,
  and re-processing it.

* Note that kicking out is a Bad Thing, because it means we have to
  re-process a constraint.  The less we kick out, the better.
  TODO: Make sure that kicking out really *is* a Bad Thing. We've assumed
  this but haven't done the empirical study to check.

* Assume we have  G&gt;=G, G&gt;=W and that's all.  Then, when performing
  a unification we add a new given  a -G-&gt; ty.  But doing so does NOT require
  us to kick out an inert wanted that mentions a, because of (K2a).  This
  is a common case, hence good not to kick out.

* Lemma (L2): if not (fw &gt;= fw), then K1-K3 all hold.
  Proof: using Definition [Can-rewrite relation], fw can't rewrite anything
         and so K1-K3 hold.  Intuitively, since fw can't rewrite anything,
         adding it cannot cause any loops
  This is a common case, because Wanteds cannot rewrite Wanteds.

* Lemma (L1): The conditions of the Main Theorem imply that there is no
              (a -fs-&gt; t) in S, s.t.  (fs &gt;= fw).
  Proof. Suppose the contrary (fs &gt;= fw).  Then because of (T1),
  S(fw,a)=a.  But since fs&gt;=fw, S(fw,a) = s, hence s=a.  But now we
  have (a -fs-&gt; a) in S, which contradicts (WF2).

* The extended substitution satisfies (WF1) and (WF2)
  - (K1) plus (L1) guarantee that the extended substitution satisfies (WF1).
  - (T3) guarantees (WF2).

* (K2) is about inertness.  Intuitively, any infinite chain T^0(f,t),
  T^1(f,t), T^2(f,T).... must pass through the new work item infnitely
  often, since the substution without the work item is inert; and must
  pass through at least one of the triples in S infnitely often.

  - (K2a): if not(fs&gt;=fs) then there is no f that fs can rewrite (fs&gt;=f),
    and hence this triple never plays a role in application S(f,a).
    It is always safe to extend S with such a triple.

    (NB: we could strengten K1) in this way too, but see K3.

  - (K2b): If this holds then, by (T2), b is not in t.  So applying the
    work item does not genenerate any new opportunities for applying S

  - (K2c): If this holds, we can't pass through this triple infinitely
    often, because if we did then fs&gt;=f, fw&gt;=f, hence by (R2)
      * either fw&gt;=fs, contradicting K2c
      * or fs&gt;=fw; so by the agument in K2b we can't have a loop

  - (K2d): if a not in s, we hae no further opportunity to apply the
    work item, similar to (K2b)

  NB: Dimitrios has a PDF that does this in more detail

Key lemma to make it watertight.
  Under the conditions of the Main Theorem,
  forall f st fw &gt;= f, a is not in S^k(f,t), for any k

Also, consider roles more carefully. See Note [Flavours with roles]

Note [K3: completeness of solving]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
(K3) is not necessary for the extended substitution
to be inert.  In fact K1 could be made stronger by saying
   ... then (not (fw &gt;= fs) or not (fs &gt;= fs))
But it's not enough for S to be inert; we also want completeness.
That is, we want to be able to solve all soluble wanted equalities.
Suppose we have

   work-item   b -G-&gt; a
   inert-item  a -W-&gt; b

Assuming (G &gt;= W) but not (W &gt;= W), this fulfills all the conditions,
so we could extend the inerts, thus:

   inert-items   b -G-&gt; a
                 a -W-&gt; b

But if we kicked-out the inert item, we'd get

   work-item     a -W-&gt; b
   inert-item    b -G-&gt; a

Then rewrite the work-item gives us (a -W-&gt; a), which is soluble via Refl.
So we add one more clause to the kick-out criteria

Another way to understand (K3) is that we treat an inert item
        a -f-&gt; b
in the same way as
        b -f-&gt; a
So if we kick out one, we should kick out the other.  The orientation
is somewhat accidental.

When considering roles, we also need the second clause (K3b). Consider

  inert-item   a -W/R-&gt; b c
  work-item    c -G/N-&gt; a

The work-item doesn't get rewritten by the inert, because (&gt;=) doesn't hold.
We've satisfied conditions (T1)-(T3) and (K1) and (K2). If all we had were
condition (K3a), then we would keep the inert around and add the work item.
But then, consider if we hit the following:

  work-item2   b -G/N-&gt; Id

where

  newtype Id x = Id x

For similar reasons, if we only had (K3a), we wouldn't kick the
representational inert out. And then, we'd miss solving the inert, which
now reduced to reflexivity. The solution here is to kick out representational
inerts whenever the tyvar of a work item is &quot;exposed&quot;, where exposed means
not under some proper data-type constructor, like [] or Maybe. See
isTyVarExposed in TcType. This is encoded in (K3b).

Note [Stability of flattening]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The inert_eqs and inert_model, *considered separately* are each stable;
that is, substituting using them will terminate.  Considered *together*
they are not.  E.g.

  Add: [G] a~[b] to inert set with model  [D] b~[a]

  We add [G] a~[b] to inert_eqs, and emit [D] a~[b]. At this point
  the combination of inert_eqs and inert_model is not stable.

  Then we canonicalise [D] a~[b] to [D] a~[[a]], and add that to
  insolubles as an occurs check.

* When canonicalizing, the flattener respects flavours. In particular,
  when flattening a type variable 'a':
    * Derived:      look up 'a' in the inert_model
    * Given/Wanted: look up 'a' in the inert_eqs


Note [Flavours with roles]
~~~~~~~~~~~~~~~~~~~~~~~~~~
The system described in Note [inert_eqs: the inert equalities]
discusses an abstract
set of flavours. In GHC, flavours have two components: the flavour proper,
taken from {Wanted, Derived, Given} and the equality relation (often called
role), taken from {NomEq, ReprEq}.
When substituting w.r.t. the inert set,
as described in Note [inert_eqs: the inert equalities],
we must be careful to respect all components of a flavour.
For example, if we have

  inert set: a -G/R-&gt; Int
             b -G/R-&gt; Bool

  type role T nominal representational

and we wish to compute S(W/R, T a b), the correct answer is T a Bool, NOT
T Int Bool. The reason is that T's first parameter has a nominal role, and
thus rewriting a to Int in T a b is wrong. Indeed, this non-congruence of
substitution means that the proof in Note [The inert equalities] may need
to be revisited, but we don't think that the end conclusion is wrong.

Note [Examples of how the inert_model helps completeness]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

----------- Example 2 (indexed-types/should_fail/T4093a)
  Ambiguity check for f: (Foo e ~ Maybe e) =&gt; Foo e

  We get [G] Foo e ~ Maybe e
         [W] Foo e ~ Foo ee      -- ee is a unification variable
         [W] Foo ee ~ Maybe ee

  Flatten: [G] Foo e ~ fsk
           [G] fsk ~ Maybe e   -- (A)

           [W] Foo ee ~ fmv
           [W] fmv ~ fsk       -- (B) From Foo e ~ Foo ee
           [W] fmv ~ Maybe ee

  --&gt; rewrite (B) with (A)
           [W] Foo ee ~ fmv
           [W] fmv ~ Maybe e
           [W] fmv ~ Maybe ee

  But now awe appear to be stuck, since we don't rewrite Wanteds with
  Wanteds. But inert_model to the rescue.  In the model we first added
           fmv -&gt; Maybe e
  Then when adding [W] fmv -&gt; Maybe ee to the inert set, we noticed
  that the model can rewrite the constraint, and so emit [D] fmv ~ Maybe ee.
  That canonicalises to
           [D] Maybe e ~ Maybe ee
  and that soon yields ee := e, and all is well

----------- Example 3 (typecheck/should_compile/Improvement.hs)
    type instance F Int = Bool
    instance (b~Int) =&gt; C Bool b

    [W] w1 : C (F alpha) alpha, [W] w2 : F alpha ~ Bool

  If we rewrote wanteds with wanteds, we could rewrite w1 to
  C Bool alpha, use the instance to get alpha ~ Int, and solve
  the whole thing.

  And that is exactly what happens, in the *Derived* constraints.
  In effect we get

    [D] F alpha ~ fmv
    [D] C fmv alpha
    [D] fmv ~ Bool

  and now we can rewrite (C fmv alpha) with (fmv ~ Bool), ane
  we are off to the races.

----------- Example 4 (Trac #10009, a nasty example):

    f :: (UnF (F b) ~ b) =&gt; F b -&gt; ()

    g :: forall a. (UnF (F a) ~ a) =&gt; a -&gt; ()
    g _ = f (undefined :: F a)

  For g we get [G] UnF (F a) ~ a
               [W] UnF (F beta) ~ beta
               [W] F a ~ F beta
  Flatten:
      [G] g1: F a ~ fsk1         fsk1 := F a
      [G] g2: UnF fsk1 ~ fsk2    fsk2 := UnF fsk1
      [G] g3: fsk2 ~ a

      [W] w1: F beta ~ fmv1
      [W] w2: UnF fmv1 ~ fmv2
      [W] w3: beta ~ fmv2
      [W] w5: fmv1 ~ fsk1   -- From F a ~ F beta using flat-cache
                            -- and re-orient to put meta-var on left

  Unify beta := fmv2
      [W] w1: F fmv2 ~ fmv1
      [W] w2: UnF fmv1 ~ fmv2
      [W] w5: fmv1 ~ fsk1

  In the model, we have the shadow Deriveds of w1 and w2
  (I name them for convenience even though they are anonymous)
      [D] d1: F fmv2 ~ fmv1d
      [D] d2: fmv1d ~ fmv1
      [D] d3: UnF fmv1 ~ fmv2d
      [D] d4: fmv2d ~ fmv2

  Now we can rewrite d3 with w5, and match with g2, to get
      fmv2d := fsk2
      [D] d1: F fmv2 ~ fmv1d
      [D] d2: fmv1d ~ fmv1
      [D] d4: fmv2 ~ fsk2

  Use g2 to rewrite fsk2 to a.
      [D] d1: F fmv2 ~ fmv1d
      [D] d2: fmv1d ~ fmv1
      [D] d4: fmv2 ~ a

  Use d4 to rewrite d1, rewrite with g3,
  match with g1, to get
      fmv1d := fsk1
      [D] d2: fmv1 ~ fsk1
      [D] d4: fmv2 ~ a

  At this point we are stuck so we unflatten this set:
  See Note [Orientation of equalities with fmvs] in TcFlatten
      [W] w1: F fmv2 ~ fmv1
      [W] w2: UnF fmv1 ~ fmv2
      [W] w5: fmv1 ~ fsk1
      [D] d4: fmv2 ~ a

  Unflattening will discharge w1: fmv1 := F fmv2
  It can't discharge w2, so it is kept.  But we can
  unify fmv2 := fsk2, and that is &quot;progress&quot;. Result
      [W] w2: UnF (F a) ~ a
      [W] w5: F a ~ fsk1

  And now both of these are easily proved in the next iteration.  Phew!
-}</span><span>
</span><a name="line-1067"></a><span>
</span><a name="line-1068"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1069"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_model</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204346"><a href="#local-1628204346"><span class="hs-identifier">model</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204347"><a href="#local-1628204347"><span class="hs-identifier">eqs</span></a></a><span>
</span><a name="line-1070"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204348"><a href="#local-1628204348"><span class="hs-identifier">funeqs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204349"><a href="#local-1628204349"><span class="hs-identifier">dicts</span></a></a><span>
</span><a name="line-1071"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_safehask</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204350"><a href="#local-1628204350"><span class="hs-identifier">safehask</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_irreds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204351"><a href="#local-1628204351"><span class="hs-identifier">irreds</span></a></a><span>
</span><a name="line-1072"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_insols</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204352"><a href="#local-1628204352"><span class="hs-identifier">insols</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_count</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204353"><a href="#local-1628204353"><span class="hs-identifier">count</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1073"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-1074"></a><span>      </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a><span> </span><a href="#local-1628204347"><span class="hs-identifier hs-var">eqs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1075"></a><span>        </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Equalities:&quot;</span><span>
</span><a name="line-1076"></a><span>          </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcRnTypes.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#foldVarEnv"><span class="hs-identifier hs-var">foldVarEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628204354"><a href="#local-1628204354"><span class="hs-identifier">eqs</span></a></a><span> </span><a name="local-1628204355"><a href="#local-1628204355"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a><span> </span><a href="#local-1628204354"><span class="hs-identifier hs-var">eqs</span></a><span> </span><span class="hs-special">`</span><a href="TcRnTypes.html#andCts"><span class="hs-identifier hs-var">andCts</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204355"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span> </span><a href="TcRnTypes.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a><span> </span><a href="#local-1628204347"><span class="hs-identifier hs-var">eqs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1077"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#isEmptyTcAppMap"><span class="hs-identifier hs-var">isEmptyTcAppMap</span></a><span> </span><a href="#local-1628204348"><span class="hs-identifier hs-var">funeqs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1078"></a><span>        </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type-function equalities =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcRnTypes.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#funEqsToBag"><span class="hs-identifier hs-var">funEqsToBag</span></a><span> </span><a href="#local-1628204348"><span class="hs-identifier hs-var">funeqs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1079"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#isEmptyTcAppMap"><span class="hs-identifier hs-var">isEmptyTcAppMap</span></a><span> </span><a href="#local-1628204349"><span class="hs-identifier hs-var">dicts</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1080"></a><span>        </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Dictionaries =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcRnTypes.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#dictsToBag"><span class="hs-identifier hs-var">dictsToBag</span></a><span> </span><a href="#local-1628204349"><span class="hs-identifier hs-var">dicts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1081"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#isEmptyTcAppMap"><span class="hs-identifier hs-var">isEmptyTcAppMap</span></a><span> </span><a href="#local-1628204350"><span class="hs-identifier hs-var">safehask</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1082"></a><span>        </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Safe Haskell unsafe overlap =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcRnTypes.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#dictsToBag"><span class="hs-identifier hs-var">dictsToBag</span></a><span> </span><a href="#local-1628204350"><span class="hs-identifier hs-var">safehask</span></a><span class="hs-special">)</span><span>
</span><a name="line-1083"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isEmptyCts"><span class="hs-identifier hs-var">isEmptyCts</span></a><span> </span><a href="#local-1628204351"><span class="hs-identifier hs-var">irreds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1084"></a><span>        </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Irreds =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcRnTypes.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a><span> </span><a href="#local-1628204351"><span class="hs-identifier hs-var">irreds</span></a><span>
</span><a name="line-1085"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isEmptyCts"><span class="hs-identifier hs-var">isEmptyCts</span></a><span> </span><a href="#local-1628204352"><span class="hs-identifier hs-var">insols</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1086"></a><span>        </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Insolubles =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcRnTypes.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a><span> </span><a href="#local-1628204352"><span class="hs-identifier hs-var">insols</span></a><span>
</span><a name="line-1087"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a><span> </span><a href="#local-1628204346"><span class="hs-identifier hs-var">model</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1088"></a><span>        </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Model =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcRnTypes.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#foldVarEnv"><span class="hs-identifier hs-var">foldVarEnv</span></a><span> </span><a href="TcRnTypes.html#consCts"><span class="hs-identifier hs-var">consCts</span></a><span> </span><a href="TcRnTypes.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a><span> </span><a href="#local-1628204346"><span class="hs-identifier hs-var">model</span></a><span class="hs-special">)</span><span>
</span><a name="line-1089"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Unsolved goals =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-1628204353"><span class="hs-identifier hs-var">count</span></a><span>
</span><a name="line-1090"></a><span>      </span><span class="hs-special">]</span><span>
</span><a name="line-1091"></a><span>
</span><a name="line-1092"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                  Adding an inert
*                                                                      *
************************************************************************

Note [Adding an inert canonical constraint the InertCans]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Adding any constraint c *other* than a CTyEqCan (TcSMonad.addInertCan):

    * If c can be rewritten by model, emit the shadow constraint [D] c
      as NonCanonical.   See Note [Emitting shadow constraints]

    * Reason for non-canonical: a CFunEqCan has a unique fmv on the RHS,
      so we must not duplicate it.

* Adding a *nominal* CTyEqCan (a ~N ty) to the inert set (TcSMonad.addInertEq).

    (A) Always (G/W/D) kick out constraints that can be rewritten
        (respecting flavours) by the new constraint. This is done
        by kickOutRewritable.

    (B) Applies only to nominal equalities: a ~ ty.  Four cases:

        [Representational]   [G/W/D] a ~R ty:
          Just add it to inert_eqs

        [Derived Nominal]  [D] a ~N ty:
          1. Add (a~ty) to the model
             NB: 'a' cannot be in fv(ty), because the constraint is canonical.

          2. (DShadow) Do emitDerivedShadows
               For every inert G/W constraint c, st
                (a) (a~ty) can rewrite c (see Note [Emitting shadow constraints]),
                    and
                (b) the model cannot rewrite c
               kick out a Derived *copy*, leaving the original unchanged.
               Reason for (b) if the model can rewrite c, then we have already
               generated a shadow copy

       [Given/Wanted Nominal]  [G/W] a ~N ty:
          1. Add it to inert_eqs
          2. Emit [D] a~ty
          Step (2) is needed to allow the current model to fully
          rewrite [D] a~ty before adding it using the [Derived Nominal]
          steps above.

          We must do this even for Givens, because
             work-item [G] a ~ [b], model has [D] b ~ a.
          We need a shadow [D] a ~ [b] in the work-list
          When we process it, we'll rewrite to a ~ [a] and get an occurs check


* Unifying a:=ty, is like adding [G] a~ty, but we can't make a [D]
  a~ty, as in step (1) of the [G/W] case above.  So instead, do
  kickOutAfterUnification:
    - Kick out from the model any equality (b~ty2) that mentions 'a'
      (i.e. a=b or a in ty2).  Example:
            [G] a ~ [b],    model [D] b ~ [a]

Note [Emitting shadow constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * Given a new model element [D] a ~ ty, we want to emit shadow
   [D] constraints for any inert constraints 'c' that can be
   rewritten [D] a-&gt; ty

 * And similarly given a new Given/Wanted 'c', we want to emit a
   shadow 'c' if the model can rewrite [D] c

See modelCanRewrite.

NB the use of rewritableTyVars. You might wonder whether, given the new
constraint [D] fmv ~ ty and the inert [W] F alpha ~ fmv, do we want to
emit a shadow constraint [D] F alpha ~ fmv?  No, we don't, because
it'll literally be a duplicate (since we do not rewrite the RHS of a
CFunEqCan) and hence immediately eliminated again.  Insetad we simply
want to *kick-out* the [W] F alpha ~ fmv, so that it is reconsidered
from a fudep point of view.  See Note [Kicking out CFunEqCan for
fundeps]

Note [Kicking out CFunEqCan for fundeps]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider:
   New:    [D] fmv1 ~ fmv2
   Inert:  [W] F alpha ~ fmv1
           [W] F beta  ~ fmv2

The new (derived) equality certainly can't rewrite the inerts. But we
*must* kick out the first one, to get:

   New:   [W] F alpha ~ fmv1
   Inert: [W] F beta ~ fmv2
   Model: [D] fmv1 ~ fmv2

and now improvement will discover [D] alpha ~ beta. This is important;
eg in Trac #9587.
-}</span><span>
</span><a name="line-1189"></a><span>
</span><a name="line-1190"></a><span class="hs-identifier">addInertEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1191"></a><span class="hs-comment">-- This is a key function, because of the kick-out stuff</span><span>
</span><a name="line-1192"></a><span class="hs-comment">-- Precondition: item /is/ canonical</span><span>
</span><a name="line-1193"></a><a name="addInertEq"><a href="TcSMonad.html#addInertEq"><span class="hs-identifier">addInertEq</span></a></a><span> </span><a name="local-1628203648"><a href="#local-1628203648"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203649"><a href="#local-1628203649"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1194"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;addInertEq {&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1195"></a><span>         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Adding new inert equality:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203648"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1196"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628203650"><a href="#local-1628203650"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a><span>
</span><a name="line-1197"></a><span>
</span><a name="line-1198"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628203651"><a href="#local-1628203651"><span class="hs-identifier">kicked_out</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628203652"><a href="#local-1628203652"><span class="hs-identifier">ics1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#kickOutRewritable"><span class="hs-identifier hs-var">kickOutRewritable</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctFlavourRole"><span class="hs-identifier hs-var">ctFlavourRole</span></a><span> </span><a href="#local-1628203648"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203649"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1628203650"><span class="hs-identifier hs-var">ics</span></a><span>
</span><a name="line-1199"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628203653"><a href="#local-1628203653"><span class="hs-identifier">ics2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#add_inert_eq"><span class="hs-identifier hs-var">add_inert_eq</span></a><span> </span><a href="#local-1628203652"><span class="hs-identifier hs-var">ics1</span></a><span> </span><a href="#local-1628203648"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1200"></a><span>
</span><a name="line-1201"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#setInertCans"><span class="hs-identifier hs-var">setInertCans</span></a><span> </span><a href="#local-1628203653"><span class="hs-identifier hs-var">ics2</span></a><span>
</span><a name="line-1202"></a><span>
</span><a name="line-1203"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#isEmptyWorkList"><span class="hs-identifier hs-var">isEmptyWorkList</span></a><span> </span><a href="#local-1628203651"><span class="hs-identifier hs-var">kicked_out</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1204"></a><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#appendWorkList"><span class="hs-identifier hs-var">appendWorkList</span></a><span> </span><a href="#local-1628203651"><span class="hs-identifier hs-var">kicked_out</span></a><span class="hs-special">)</span><span>
</span><a name="line-1205"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#csTraceTcS"><span class="hs-identifier hs-var">csTraceTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1206"></a><span>               </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Kick out, tv =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203649"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1207"></a><span>                  </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;n-kicked =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#workListSize"><span class="hs-identifier hs-var">workListSize</span></a><span> </span><a href="#local-1628203651"><span class="hs-identifier hs-var">kicked_out</span></a><span class="hs-special">)</span><span>
</span><a name="line-1208"></a><span>                          </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203651"><span class="hs-identifier hs-var">kicked_out</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1209"></a><span>
</span><a name="line-1210"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;addInertEq }&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1211"></a><span class="hs-identifier">addInertEq</span><span> </span><a name="local-1628203654"><a href="#local-1628203654"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;addInertEq&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203654"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1212"></a><span>
</span><a name="line-1213"></a><span class="hs-identifier">add_inert_eq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span>
</span><a name="line-1214"></a><a name="add_inert_eq"><a href="TcSMonad.html#add_inert_eq"><span class="hs-identifier">add_inert_eq</span></a></a><span> </span><a name="local-1628203655"><a href="#local-1628203655"><span class="hs-identifier">ics</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_count</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203656"><a href="#local-1628203656"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-1215"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203657"><a href="#local-1628203657"><span class="hs-identifier">old_eqs</span></a></a><span>
</span><a name="line-1216"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_model</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203658"><a href="#local-1628203658"><span class="hs-identifier">old_model</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><span>             </span><a name="local-1628203659"><a href="#local-1628203659"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203660"><a href="#local-1628203660"><span class="hs-identifier">ev</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_eq_rel</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203661"><a href="#local-1628203661"><span class="hs-identifier">eq_rel</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203662"><a href="#local-1628203662"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1218"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203663"><a href="#local-1628203663"><span class="hs-identifier">_rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1219"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203661"><span class="hs-identifier hs-var">eq_rel</span></a><span>
</span><a name="line-1220"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628203666"><span class="hs-identifier hs-var">new_ics</span></a><span>
</span><a name="line-1221"></a><span>
</span><a name="line-1222"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#isDerived"><span class="hs-identifier hs-var">isDerived</span></a><span> </span><a href="#local-1628203660"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1223"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#emitDerivedShadows"><span class="hs-identifier hs-var">emitDerivedShadows</span></a><span> </span><a href="#local-1628203655"><span class="hs-identifier hs-var">ics</span></a><span> </span><a href="#local-1628203662"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1224"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203655"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_model</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-1628203658"><span class="hs-identifier hs-var">old_model</span></a><span> </span><a href="#local-1628203662"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1628203659"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1225"></a><span>
</span><a name="line-1226"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>   </span><span class="hs-comment">-- Given/Wanted Nominal equality [W] tv ~N ty</span><span>
</span><a name="line-1227"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#emitNewDerived"><span class="hs-identifier hs-var">emitNewDerived</span></a><span> </span><a href="#local-1628203664"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628203665"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-1228"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628203666"><span class="hs-identifier hs-var">new_ics</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1229"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1230"></a><span>    </span><a name="local-1628203664"><a href="#local-1628203664"><span class="hs-identifier">loc</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a><span> </span><a href="#local-1628203660"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1231"></a><span>    </span><a name="local-1628203665"><a href="#local-1628203665"><span class="hs-identifier">pred</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a><span> </span><a href="#local-1628203660"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1232"></a><span>    </span><a name="local-1628203666"><a href="#local-1628203666"><span class="hs-identifier">new_ics</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203655"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_eqs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#addTyEq"><span class="hs-identifier hs-var">addTyEq</span></a><span> </span><a href="#local-1628203657"><span class="hs-identifier hs-var">old_eqs</span></a><span> </span><a href="#local-1628203662"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1628203659"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1233"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_count</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#bumpUnsolvedCount"><span class="hs-identifier hs-var">bumpUnsolvedCount</span></a><span> </span><a href="#local-1628203660"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-1628203656"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1234"></a><span>
</span><a name="line-1235"></a><span class="hs-identifier">add_inert_eq</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628203667"><a href="#local-1628203667"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;addInertEq&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203667"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1236"></a><span>
</span><a name="line-1237"></a><span class="hs-identifier">emitDerivedShadows</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1238"></a><a name="emitDerivedShadows"><a href="TcSMonad.html#emitDerivedShadows"><span class="hs-identifier">emitDerivedShadows</span></a></a><span> </span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_eqs</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203668"><a href="#local-1628203668"><span class="hs-identifier">tv_eqs</span></a></a><span>
</span><a name="line-1239"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_dicts</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203669"><a href="#local-1628203669"><span class="hs-identifier">dicts</span></a></a><span>
</span><a name="line-1240"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_safehask</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203670"><a href="#local-1628203670"><span class="hs-identifier">safehask</span></a></a><span>
</span><a name="line-1241"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_funeqs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203671"><a href="#local-1628203671"><span class="hs-identifier">funeqs</span></a></a><span>
</span><a name="line-1242"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_irreds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203672"><a href="#local-1628203672"><span class="hs-identifier">irreds</span></a></a><span>
</span><a name="line-1243"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_model</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203673"><a href="#local-1628203673"><span class="hs-identifier">model</span></a></a><span> </span><span class="hs-special">}</span><span> </span><a name="local-1628203674"><a href="#local-1628203674"><span class="hs-identifier">new_tv</span></a></a><span>
</span><a name="line-1244"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628203675"><span class="hs-identifier hs-var">shadows</span></a><span>
</span><a name="line-1245"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1246"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1247"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;Emit derived shadows:&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1248"></a><span>         </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;tyvar =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203674"><span class="hs-identifier hs-var">new_tv</span></a><span>
</span><a name="line-1249"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;shadows =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203675"><span class="hs-identifier hs-var">shadows</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1250"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a><span> </span><a href="#local-1628203675"><span class="hs-identifier hs-var">shadows</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1251"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1252"></a><span>    </span><a name="local-1628203675"><a href="#local-1628203675"><span class="hs-identifier">shadows</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a><span>  </span><a href="#local-1628203676"><span class="hs-identifier hs-var">get_ct</span></a><span> </span><a href="#local-1628203669"><span class="hs-identifier hs-var">dicts</span></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1253"></a><span>              </span><a href="TcSMonad.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a><span>  </span><a href="#local-1628203676"><span class="hs-identifier hs-var">get_ct</span></a><span> </span><a href="#local-1628203670"><span class="hs-identifier hs-var">safehask</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1254"></a><span>              </span><a href="TcSMonad.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a><span> </span><a href="#local-1628203676"><span class="hs-identifier hs-var">get_ct</span></a><span> </span><a href="#local-1628203671"><span class="hs-identifier hs-var">funeqs</span></a><span>   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1255"></a><span>              </span><a href="TcSMonad.html#foldIrreds"><span class="hs-identifier hs-var">foldIrreds</span></a><span> </span><a href="#local-1628203676"><span class="hs-identifier hs-var">get_ct</span></a><span> </span><a href="#local-1628203672"><span class="hs-identifier hs-var">irreds</span></a><span>   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1256"></a><span>              </span><a href="TcSMonad.html#foldTyEqs"><span class="hs-identifier hs-var">foldTyEqs</span></a><span>  </span><a href="#local-1628203676"><span class="hs-identifier hs-var">get_ct</span></a><span> </span><a href="#local-1628203668"><span class="hs-identifier hs-var">tv_eqs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1257"></a><span>      </span><span class="hs-comment">-- Ignore insolubles</span><span>
</span><a name="line-1258"></a><span>
</span><a name="line-1259"></a><span>    </span><a name="local-1628203676"><a href="#local-1628203676"><span class="hs-identifier">get_ct</span></a></a><span> </span><a name="local-1628203678"><a href="#local-1628203678"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1628203679"><a href="#local-1628203679"><span class="hs-identifier">cts</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628203677"><span class="hs-identifier hs-var">want_shadow</span></a><span> </span><a href="#local-1628203678"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#mkShadowCt"><span class="hs-identifier hs-var">mkShadowCt</span></a><span> </span><a href="#local-1628203678"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628203679"><span class="hs-identifier hs-var">cts</span></a><span>
</span><a name="line-1260"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203679"><span class="hs-identifier hs-var">cts</span></a><span>
</span><a name="line-1261"></a><span>
</span><a name="line-1262"></a><span>    </span><a name="local-1628203677"><a href="#local-1628203677"><span class="hs-identifier">want_shadow</span></a></a><span> </span><a name="local-1628203680"><a href="#local-1628203680"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-1263"></a><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isDerivedCt"><span class="hs-identifier hs-var">isDerivedCt</span></a><span> </span><a href="#local-1628203680"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>              </span><span class="hs-comment">-- No need for a shadow of a Derived!</span><span>
</span><a name="line-1264"></a><span>      </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-1628203674"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203681"><span class="hs-identifier hs-var">rw_tvs</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- New tv can rewrite ct, yielding a</span><span>
</span><a name="line-1265"></a><span>                                           </span><span class="hs-comment">-- different ct</span><span>
</span><a name="line-1266"></a><span>      </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#modelCanRewrite"><span class="hs-identifier hs-var">modelCanRewrite</span></a><span> </span><a href="#local-1628203673"><span class="hs-identifier hs-var">model</span></a><span> </span><a href="#local-1628203681"><span class="hs-identifier hs-var">rw_tvs</span></a><span class="hs-special">)</span><span class="hs-comment">-- We have not already created a</span><span>
</span><a name="line-1267"></a><span>                                           </span><span class="hs-comment">-- shadow</span><span>
</span><a name="line-1268"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1269"></a><span>        </span><a name="local-1628203681"><a href="#local-1628203681"><span class="hs-identifier">rw_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#rewritableTyCoVars"><span class="hs-identifier hs-var">rewritableTyCoVars</span></a><span> </span><a href="#local-1628203680"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1270"></a><span>
</span><a name="line-1271"></a><span class="hs-identifier">mkShadowCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-1272"></a><span class="hs-comment">-- Produce a Derived shadow constraint from the input</span><span>
</span><a name="line-1273"></a><span class="hs-comment">-- If it is a CFunEqCan, make it NonCanonical, to avoid</span><span>
</span><a name="line-1274"></a><span class="hs-comment">--   duplicating the flatten-skolems</span><span>
</span><a name="line-1275"></a><span class="hs-comment">-- Otherwise keep the canonical shape.  This just saves work, but</span><span>
</span><a name="line-1276"></a><span class="hs-comment">-- is sometimes important; see Note [Keep CDictCan shadows as CDictCan]</span><span>
</span><a name="line-1277"></a><a name="mkShadowCt"><a href="TcSMonad.html#mkShadowCt"><span class="hs-identifier">mkShadowCt</span></a></a><span> </span><a name="local-1628203682"><a href="#local-1628203682"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-1278"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203682"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CNonCanonical"><span class="hs-identifier hs-var">CNonCanonical</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203684"><span class="hs-identifier hs-var">derived_ev</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1279"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203682"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203684"><span class="hs-identifier hs-var">derived_ev</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1280"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1281"></a><span>    </span><a name="local-1628203683"><a href="#local-1628203683"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-1628203682"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1282"></a><span>    </span><a name="local-1628203684"><a href="#local-1628203684"><span class="hs-identifier">derived_ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CtDerived"><span class="hs-identifier hs-var">CtDerived</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a><span> </span><a href="#local-1628203683"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1283"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_loc</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a><span> </span><a href="#local-1628203683"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1284"></a><span>
</span><a name="line-1285"></a><span class="hs-comment">{- Note [Keep CDictCan shadows as CDictCan]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
  class C a =&gt; D a b
and [G] D a b, [G] C a in the inert set.  Now we insert
[D] b ~ c.  We want to kick out a derived shadow for [D] D a b,
so we can rewrite it with the new constraint, and perhaps get
instance reduction or other consequences.

BUT we do not want to kick out a *non-canonical* (D a b). If we
did, we would do this:
  - rewrite it to [D] D a c, with pend_sc = True
  - use expandSuperClasses to add C a
  - go round again, which solves C a from the givens
This loop goes on for ever and triggers the simpl_loop limit.

Solution: kick out the CDictCan which will have pend_sc = False,
because we've already added its superclasses.  So we won't re-add
them.  If we forget the pend_sc flag, our cunning scheme for avoiding
generating superclasses repeatedly will fail.

See Trac #11379 for a case of this.
-}</span><span>
</span><a name="line-1308"></a><span>
</span><a name="line-1309"></a><span class="hs-identifier">modelCanRewrite</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertModel"><span class="hs-identifier hs-type">InertModel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyCoVarSet"><span class="hs-identifier hs-type">TcTyCoVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1310"></a><span class="hs-comment">-- See Note [Emitting shadow constraints]</span><span>
</span><a name="line-1311"></a><span class="hs-comment">-- True if there is any intersection between dom(model) and tvs</span><span>
</span><a name="line-1312"></a><a name="modelCanRewrite"><a href="TcSMonad.html#modelCanRewrite"><span class="hs-identifier">modelCanRewrite</span></a></a><span> </span><a name="local-1628203685"><a href="#local-1628203685"><span class="hs-identifier">model</span></a></a><span> </span><a name="local-1628203686"><a href="#local-1628203686"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="UniqFM.html#disjointUFM"><span class="hs-identifier hs-var">disjointUFM</span></a><span> </span><a href="#local-1628203685"><span class="hs-identifier hs-var">model</span></a><span> </span><a href="#local-1628203686"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1313"></a><span>     </span><span class="hs-comment">-- The low-level use of disjointUFM might e surprising.</span><span>
</span><a name="line-1314"></a><span>     </span><span class="hs-comment">-- InertModel = TyVarEnv Ct, and we want to see if its domain</span><span>
</span><a name="line-1315"></a><span>     </span><span class="hs-comment">-- is disjoint from that of a TcTyCoVarSet.  So we drop down</span><span>
</span><a name="line-1316"></a><span>     </span><span class="hs-comment">-- to the underlying UniqFM.  A bit yukky, but efficient.</span><span>
</span><a name="line-1317"></a><span>
</span><a name="line-1318"></a><span class="hs-identifier">rewritableTyCoVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a><span>
</span><a name="line-1319"></a><span class="hs-comment">-- The tyvars of a Ct that can be rewritten</span><span>
</span><a name="line-1320"></a><a name="rewritableTyCoVars"><a href="TcSMonad.html#rewritableTyCoVars"><span class="hs-identifier">rewritableTyCoVars</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203687"><a href="#local-1628203687"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1628203687"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1321"></a><span class="hs-identifier">rewritableTyCoVars</span><span> </span><a name="local-1628203688"><a href="#local-1628203688"><span class="hs-identifier">ct</span></a></a><span>                              </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a><span> </span><a href="#local-1628203688"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1322"></a><span>
</span><a name="line-1323"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-1324"></a><span class="hs-identifier">addInertCan</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Constraints *other than* equalities</span><span>
</span><a name="line-1325"></a><a name="addInertCan"><a href="TcSMonad.html#addInertCan"><span class="hs-identifier">addInertCan</span></a></a><span> </span><a name="local-1628203689"><a href="#local-1628203689"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-1326"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;insertInertCan {&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1327"></a><span>         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Trying to insert new inert item:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203689"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1328"></a><span>
</span><a name="line-1329"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628203690"><a href="#local-1628203690"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a><span>
</span><a name="line-1330"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#setInertCans"><span class="hs-identifier hs-var">setInertCans</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#add_item"><span class="hs-identifier hs-var">add_item</span></a><span> </span><a href="#local-1628203690"><span class="hs-identifier hs-var">ics</span></a><span> </span><a href="#local-1628203689"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1331"></a><span>
</span><a name="line-1332"></a><span>       </span><span class="hs-comment">-- Emit shadow derived if necessary</span><span>
</span><a name="line-1333"></a><span>       </span><span class="hs-comment">-- See Note [Emitting shadow constraints]</span><span>
</span><a name="line-1334"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628203691"><a href="#local-1628203691"><span class="hs-identifier">rw_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#rewritableTyCoVars"><span class="hs-identifier hs-var">rewritableTyCoVars</span></a><span> </span><a href="#local-1628203689"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1335"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isDerivedCt"><span class="hs-identifier hs-var">isDerivedCt</span></a><span> </span><a href="#local-1628203689"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="TcSMonad.html#modelCanRewrite"><span class="hs-identifier hs-var">modelCanRewrite</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_model</span><span> </span><a href="#local-1628203690"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203691"><span class="hs-identifier hs-var">rw_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1336"></a><span>              </span><span class="hs-special">(</span><a href="TcSMonad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a><span> </span><span class="hs-special">[</span><a href="TcSMonad.html#mkShadowCt"><span class="hs-identifier hs-var">mkShadowCt</span></a><span> </span><a href="#local-1628203689"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1337"></a><span>
</span><a name="line-1338"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;addInertCan }&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1339"></a><span>
</span><a name="line-1340"></a><span class="hs-identifier">add_item</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span>
</span><a name="line-1341"></a><a name="add_item"><a href="TcSMonad.html#add_item"><span class="hs-identifier">add_item</span></a></a><span> </span><a name="local-1628203692"><a href="#local-1628203692"><span class="hs-identifier">ics</span></a></a><span> </span><a name="local-1628203693"><a href="#local-1628203693"><span class="hs-identifier">item</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_fun</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203694"><a href="#local-1628203694"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203695"><a href="#local-1628203695"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1342"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203692"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#insertFunEq"><span class="hs-identifier hs-var">insertFunEq</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_funeqs</span><span> </span><a href="#local-1628203692"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203694"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1628203695"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628203693"><span class="hs-identifier hs-var">item</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1343"></a><span>
</span><a name="line-1344"></a><span class="hs-identifier">add_item</span><span> </span><a name="local-1628203696"><a href="#local-1628203696"><span class="hs-identifier">ics</span></a></a><span> </span><a name="local-1628203697"><a href="#local-1628203697"><span class="hs-identifier">item</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CIrredEvCan"><span class="hs-identifier hs-var">CIrredEvCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203698"><a href="#local-1628203698"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1345"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203696"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_irreds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">inert_irreds</span><span> </span><a href="#local-1628203696"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#snocBag"><span class="hs-identifier hs-var">Bag</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">snocBag</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203697"><span class="hs-identifier hs-var">item</span></a><span>
</span><a name="line-1346"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_count</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#bumpUnsolvedCount"><span class="hs-identifier hs-var">bumpUnsolvedCount</span></a><span> </span><a href="#local-1628203698"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_count</span><span> </span><a href="#local-1628203696"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1347"></a><span>       </span><span class="hs-comment">-- The 'False' is because the irreducible constraint might later instantiate</span><span>
</span><a name="line-1348"></a><span>       </span><span class="hs-comment">-- to an equality.</span><span>
</span><a name="line-1349"></a><span>       </span><span class="hs-comment">-- But since we try to simplify first, if there's a constraint function FC with</span><span>
</span><a name="line-1350"></a><span>       </span><span class="hs-comment">--    type instance FC Int = Show</span><span>
</span><a name="line-1351"></a><span>       </span><span class="hs-comment">-- we'll reduce a constraint (FC Int a) to Show a, and never add an inert irreducible</span><span>
</span><a name="line-1352"></a><span>
</span><a name="line-1353"></a><span class="hs-identifier">add_item</span><span> </span><a name="local-1628203699"><a href="#local-1628203699"><span class="hs-identifier">ics</span></a></a><span> </span><a name="local-1628203700"><a href="#local-1628203700"><span class="hs-identifier">item</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203701"><a href="#local-1628203701"><span class="hs-identifier">ev</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_class</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203702"><a href="#local-1628203702"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203703"><a href="#local-1628203703"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1354"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203699"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#addDict"><span class="hs-identifier hs-var">addDict</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_dicts</span><span> </span><a href="#local-1628203699"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203702"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628203703"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628203700"><span class="hs-identifier hs-var">item</span></a><span>
</span><a name="line-1355"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_count</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#bumpUnsolvedCount"><span class="hs-identifier hs-var">bumpUnsolvedCount</span></a><span> </span><a href="#local-1628203701"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_count</span><span> </span><a href="#local-1628203699"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1356"></a><span>
</span><a name="line-1357"></a><span class="hs-identifier">add_item</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628203704"><a href="#local-1628203704"><span class="hs-identifier">item</span></a></a><span>
</span><a name="line-1358"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;upd_inert set: can't happen! Inserting &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1359"></a><span>    </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203704"><span class="hs-identifier hs-var">item</span></a><span>   </span><span class="hs-comment">-- CTyEqCan is dealt with by addInertEq</span><span>
</span><a name="line-1360"></a><span>               </span><span class="hs-comment">-- Can't be CNonCanonical, CHoleCan,</span><span>
</span><a name="line-1361"></a><span>               </span><span class="hs-comment">-- because they only land in inert_insols</span><span>
</span><a name="line-1362"></a><span>
</span><a name="line-1363"></a><span class="hs-identifier">bumpUnsolvedCount</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1364"></a><a name="bumpUnsolvedCount"><a href="TcSMonad.html#bumpUnsolvedCount"><span class="hs-identifier">bumpUnsolvedCount</span></a></a><span> </span><a name="local-1628203705"><a href="#local-1628203705"><span class="hs-identifier">ev</span></a></a><span> </span><a name="local-1628203706"><a href="#local-1628203706"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#isWanted"><span class="hs-identifier hs-var">isWanted</span></a><span> </span><a href="#local-1628203705"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203706"><span class="hs-identifier hs-var">n</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span>
</span><a name="line-1365"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203706"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1366"></a><span>
</span><a name="line-1367"></a><span>
</span><a name="line-1368"></a><span class="hs-comment">-----------------------------------------</span><span>
</span><a name="line-1369"></a><span class="hs-identifier">kickOutRewritable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a><span>  </span><span class="hs-comment">-- Flavour/role of the equality that</span><span>
</span><a name="line-1370"></a><span>                                    </span><span class="hs-comment">-- is being added to the inert set</span><span>
</span><a name="line-1371"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>        </span><span class="hs-comment">-- The new equality is tv ~ ty</span><span>
</span><a name="line-1372"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span>
</span><a name="line-1373"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span class="hs-special">)</span><span>
</span><a name="line-1374"></a><span class="hs-comment">-- See Note [kickOutRewritable]</span><span>
</span><a name="line-1375"></a><a name="kickOutRewritable"><a href="TcSMonad.html#kickOutRewritable"><span class="hs-identifier">kickOutRewritable</span></a></a><span> </span><a name="local-1628203707"><a href="#local-1628203707"><span class="hs-identifier">new_fr</span></a></a><span> </span><a name="local-1628203708"><a href="#local-1628203708"><span class="hs-identifier">new_tv</span></a></a><span> </span><a name="local-1628203709"><a href="#local-1628203709"><span class="hs-identifier">ics</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_eqs</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203710"><a href="#local-1628203710"><span class="hs-identifier">tv_eqs</span></a></a><span>
</span><a name="line-1376"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_dicts</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203711"><a href="#local-1628203711"><span class="hs-identifier">dictmap</span></a></a><span>
</span><a name="line-1377"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_safehask</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203712"><a href="#local-1628203712"><span class="hs-identifier">safehask</span></a></a><span>
</span><a name="line-1378"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_funeqs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203713"><a href="#local-1628203713"><span class="hs-identifier">funeqmap</span></a></a><span>
</span><a name="line-1379"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_irreds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203714"><a href="#local-1628203714"><span class="hs-identifier">irreds</span></a></a><span>
</span><a name="line-1380"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_insols</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203715"><a href="#local-1628203715"><span class="hs-identifier">insols</span></a></a><span>
</span><a name="line-1381"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_count</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203716"><a href="#local-1628203716"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-1382"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_model</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203717"><a href="#local-1628203717"><span class="hs-identifier">model</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1383"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628203707"><span class="hs-identifier hs-var">new_fr</span></a><span> </span><span class="hs-special">`</span><a href="TcRnTypes.html#eqCanRewriteFR"><span class="hs-identifier hs-var">eqCanRewriteFR</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203707"><span class="hs-identifier hs-var">new_fr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1384"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203709"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span>
</span><a name="line-1385"></a><span>        </span><span class="hs-comment">-- If new_fr can't rewrite itself, it can't rewrite</span><span>
</span><a name="line-1386"></a><span>        </span><span class="hs-comment">-- anything else, so no need to kick out anything.</span><span>
</span><a name="line-1387"></a><span>        </span><span class="hs-comment">-- (This is a common case: wanteds can't rewrite wanteds)</span><span>
</span><a name="line-1388"></a><span>        </span><span class="hs-comment">-- Lemma (L2) in Note [Extending the inert equalities]</span><span>
</span><a name="line-1389"></a><span>
</span><a name="line-1390"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1391"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628203719"><span class="hs-identifier hs-var">kicked_out</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203718"><span class="hs-identifier hs-var">inert_cans_in</span></a><span class="hs-special">)</span><span>
</span><a name="line-1392"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1393"></a><span>    </span><a name="local-1628203718"><a href="#local-1628203718"><span class="hs-identifier">inert_cans_in</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_eqs</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203721"><span class="hs-identifier hs-var">tv_eqs_in</span></a><span>
</span><a name="line-1394"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_dicts</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203725"><span class="hs-identifier hs-var">dicts_in</span></a><span>
</span><a name="line-1395"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_safehask</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203712"><span class="hs-identifier hs-var">safehask</span></a><span>   </span><span class="hs-comment">-- ??</span><span>
</span><a name="line-1396"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_funeqs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203723"><span class="hs-identifier hs-var">feqs_in</span></a><span>
</span><a name="line-1397"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_irreds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203727"><span class="hs-identifier hs-var">irs_in</span></a><span>
</span><a name="line-1398"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_insols</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203729"><span class="hs-identifier hs-var">insols_in</span></a><span>
</span><a name="line-1399"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_count</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203716"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="TcSMonad.html#workListWantedCount"><span class="hs-identifier hs-var">workListWantedCount</span></a><span> </span><a href="#local-1628203719"><span class="hs-identifier hs-var">kicked_out</span></a><span>
</span><a name="line-1400"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_model</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203717"><span class="hs-identifier hs-var">model</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1401"></a><span>                     </span><span class="hs-comment">-- Leave the model unchanged</span><span>
</span><a name="line-1402"></a><span>
</span><a name="line-1403"></a><span>    </span><a name="local-1628203719"><a href="#local-1628203719"><span class="hs-identifier">kicked_out</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#WL"><span class="hs-identifier hs-var">WL</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wl_eqs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203720"><span class="hs-identifier hs-var">tv_eqs_out</span></a><span>
</span><a name="line-1404"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203722"><span class="hs-identifier hs-var">feqs_out</span></a><span>
</span><a name="line-1405"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_deriv</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1406"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_rest</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203724"><span class="hs-identifier hs-var">dicts_out</span></a><span> </span><span class="hs-special">`</span><a href="TcRnTypes.html#andCts"><span class="hs-identifier hs-var">andCts</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203726"><span class="hs-identifier hs-var">irs_out</span></a><span>
</span><a name="line-1407"></a><span>                                             </span><span class="hs-special">`</span><a href="TcRnTypes.html#andCts"><span class="hs-identifier hs-var">andCts</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203728"><span class="hs-identifier hs-var">insols_out</span></a><span class="hs-special">)</span><span>
</span><a name="line-1408"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wl_implics</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1409"></a><span>
</span><a name="line-1410"></a><span>    </span><span class="hs-special">(</span><a name="local-1628203720"><a href="#local-1628203720"><span class="hs-identifier">tv_eqs_out</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628203721"><a href="#local-1628203721"><span class="hs-identifier">tv_eqs_in</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#foldVarEnv"><span class="hs-identifier hs-var">foldVarEnv</span></a><span> </span><a href="#local-1628203733"><span class="hs-identifier hs-var">kick_out_eqs</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="VarEnv.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203710"><span class="hs-identifier hs-var">tv_eqs</span></a><span>
</span><a name="line-1411"></a><span>    </span><span class="hs-special">(</span><a name="local-1628203722"><a href="#local-1628203722"><span class="hs-identifier">feqs_out</span></a></a><span class="hs-special">,</span><span>   </span><a name="local-1628203723"><a href="#local-1628203723"><span class="hs-identifier">feqs_in</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#partitionFunEqs"><span class="hs-identifier hs-var">partitionFunEqs</span></a><span>  </span><a href="#local-1628203732"><span class="hs-identifier hs-var">kick_out_fe</span></a><span> </span><a href="#local-1628203713"><span class="hs-identifier hs-var">funeqmap</span></a><span>
</span><a name="line-1412"></a><span>    </span><span class="hs-special">(</span><a name="local-1628203724"><a href="#local-1628203724"><span class="hs-identifier">dicts_out</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-1628203725"><a href="#local-1628203725"><span class="hs-identifier">dicts_in</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#partitionDicts"><span class="hs-identifier hs-var">partitionDicts</span></a><span>   </span><a href="#local-1628203731"><span class="hs-identifier hs-var">kick_out_ct</span></a><span> </span><a href="#local-1628203711"><span class="hs-identifier hs-var">dictmap</span></a><span>
</span><a name="line-1413"></a><span>    </span><span class="hs-special">(</span><a name="local-1628203726"><a href="#local-1628203726"><span class="hs-identifier">irs_out</span></a></a><span class="hs-special">,</span><span>    </span><a name="local-1628203727"><a href="#local-1628203727"><span class="hs-identifier">irs_in</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#partitionBag"><span class="hs-identifier hs-var">partitionBag</span></a><span>     </span><a href="#local-1628203731"><span class="hs-identifier hs-var">kick_out_ct</span></a><span> </span><a href="#local-1628203714"><span class="hs-identifier hs-var">irreds</span></a><span>
</span><a name="line-1414"></a><span>    </span><span class="hs-special">(</span><a name="local-1628203728"><a href="#local-1628203728"><span class="hs-identifier">insols_out</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628203729"><a href="#local-1628203729"><span class="hs-identifier">insols_in</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#partitionBag"><span class="hs-identifier hs-var">partitionBag</span></a><span>     </span><a href="#local-1628203731"><span class="hs-identifier hs-var">kick_out_ct</span></a><span> </span><a href="#local-1628203715"><span class="hs-identifier hs-var">insols</span></a><span>
</span><a name="line-1415"></a><span>      </span><span class="hs-comment">-- Kick out even insolubles; see Note [Kick out insolubles]</span><span>
</span><a name="line-1416"></a><span>
</span><a name="line-1417"></a><span>    </span><span class="hs-identifier">fr_can_rewrite</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1418"></a><span>    </span><a name="local-1628203730"><a href="#local-1628203730"><span class="hs-identifier">fr_can_rewrite</span></a></a><span> </span><a name="local-1628203735"><a href="#local-1628203735"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203707"><span class="hs-identifier hs-var">new_fr</span></a><span> </span><span class="hs-special">`</span><a href="TcRnTypes.html#eqCanRewriteFR"><span class="hs-identifier hs-var">eqCanRewriteFR</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvFlavourRole"><span class="hs-identifier hs-var">ctEvFlavourRole</span></a><span> </span><a href="#local-1628203735"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-1419"></a><span>
</span><a name="line-1420"></a><span>    </span><span class="hs-identifier">kick_out_ct</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1421"></a><span>    </span><span class="hs-comment">-- Kick it out if the new CTyEqCan can rewrite the inert</span><span>
</span><a name="line-1422"></a><span>    </span><span class="hs-comment">-- one. See Note [kickOutRewritable]</span><span>
</span><a name="line-1423"></a><span>    </span><a name="local-1628203731"><a href="#local-1628203731"><span class="hs-identifier">kick_out_ct</span></a></a><span> </span><a name="local-1628203736"><a href="#local-1628203736"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-1424"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203730"><span class="hs-identifier hs-var">fr_can_rewrite</span></a><span> </span><a href="#local-1628203737"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1425"></a><span>        </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1628203708"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a><span> </span><a href="#local-1628203737"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-1426"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1427"></a><span>        </span><a name="local-1628203737"><a href="#local-1628203737"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-1628203736"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1428"></a><span>
</span><a name="line-1429"></a><span>    </span><span class="hs-identifier">kick_out_fe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1430"></a><span>    </span><a name="local-1628203732"><a href="#local-1628203732"><span class="hs-identifier">kick_out_fe</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203738"><a href="#local-1628203738"><span class="hs-identifier">ev</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203739"><a href="#local-1628203739"><span class="hs-identifier">tys</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_fsk</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203740"><a href="#local-1628203740"><span class="hs-identifier">fsk</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1431"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203708"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628203740"><span class="hs-identifier hs-var">fsk</span></a><span>  </span><span class="hs-comment">-- If RHS is new_tvs, kick out /regardless of flavour/</span><span>
</span><a name="line-1432"></a><span>                       </span><span class="hs-comment">-- See Note [Kicking out CFunEqCan for fundeps]</span><span>
</span><a name="line-1433"></a><span>        </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-special">(</span><a href="#local-1628203730"><span class="hs-identifier hs-var">fr_can_rewrite</span></a><span> </span><a href="#local-1628203738"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1434"></a><span>            </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1628203708"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1628203739"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1435"></a><span>    </span><span class="hs-identifier">kick_out_fe</span><span> </span><a name="local-1628203741"><a href="#local-1628203741"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;kick_out_fe&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203741"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1436"></a><span>
</span><a name="line-1437"></a><span>    </span><span class="hs-identifier">kick_out_eqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="VarEnv.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span class="hs-special">)</span><span>
</span><a name="line-1438"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="VarEnv.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span class="hs-special">)</span><span>
</span><a name="line-1439"></a><span>    </span><a name="local-1628203733"><a href="#local-1628203733"><span class="hs-identifier">kick_out_eqs</span></a></a><span> </span><a name="local-1628203742"><a href="#local-1628203742"><span class="hs-identifier">eqs</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628203743"><a href="#local-1628203743"><span class="hs-identifier">acc_out</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628203744"><a href="#local-1628203744"><span class="hs-identifier">acc_in</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1440"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628203746"><span class="hs-identifier hs-var">eqs_out</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628203743"><span class="hs-identifier hs-var">acc_out</span></a><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628203745"><span class="hs-identifier hs-var">eqs_in</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1441"></a><span>                               </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203744"><span class="hs-identifier hs-var">acc_in</span></a><span>
</span><a name="line-1442"></a><span>                               </span><span class="hs-special">(</span><a name="local-1628203747"><a href="#local-1628203747"><span class="hs-identifier">eq1</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-1628203744"><span class="hs-identifier hs-var">acc_in</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">cc_tyvar</span><span> </span><a href="#local-1628203747"><span class="hs-identifier hs-var">eq1</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203745"><span class="hs-identifier hs-var">eqs_in</span></a><span class="hs-special">)</span><span>
</span><a name="line-1443"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1444"></a><span>        </span><span class="hs-special">(</span><a name="local-1628203745"><a href="#local-1628203745"><span class="hs-identifier">eqs_in</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628203746"><a href="#local-1628203746"><span class="hs-identifier">eqs_out</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span> </span><a href="#local-1628203734"><span class="hs-identifier hs-var">keep_eq</span></a><span> </span><a href="#local-1628203742"><span class="hs-identifier hs-var">eqs</span></a><span>
</span><a name="line-1445"></a><span>
</span><a name="line-1446"></a><span>    </span><span class="hs-comment">-- Implements criteria K1-K3 in Note [Extending the inert equalities]</span><span>
</span><a name="line-1447"></a><span>    </span><a name="local-1628203734"><a href="#local-1628203734"><span class="hs-identifier">keep_eq</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203748"><a href="#local-1628203748"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203749"><a href="#local-1628203749"><span class="hs-identifier">rhs_ty</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203750"><a href="#local-1628203750"><span class="hs-identifier">ev</span></a></a><span>
</span><a name="line-1448"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_eq_rel</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203751"><a href="#local-1628203751"><span class="hs-identifier">eq_rel</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1449"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628203748"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628203708"><span class="hs-identifier hs-var">new_tv</span></a><span>
</span><a name="line-1450"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628203730"><span class="hs-identifier hs-var">fr_can_rewrite</span></a><span> </span><a href="#local-1628203750"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- (K1)</span><span>
</span><a name="line-1451"></a><span>
</span><a name="line-1452"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1453"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203753"><span class="hs-identifier hs-var">check_k2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1628203754"><span class="hs-identifier hs-var">check_k3</span></a><span>
</span><a name="line-1454"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1455"></a><span>        </span><a name="local-1628203752"><a href="#local-1628203752"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvFlavourRole"><span class="hs-identifier hs-var">ctEvFlavourRole</span></a><span> </span><a href="#local-1628203750"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1456"></a><span>        </span><a name="local-1628203753"><a href="#local-1628203753"><span class="hs-identifier">check_k2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628203752"><span class="hs-identifier hs-var">fs</span></a><span>  </span><span class="hs-special">`</span><a href="TcRnTypes.html#eqCanRewriteFR"><span class="hs-identifier hs-var">eqCanRewriteFR</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203752"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>                   </span><span class="hs-comment">-- (K2a)</span><span>
</span><a name="line-1457"></a><span>                </span><span class="hs-operator hs-var">||</span><span>     </span><span class="hs-special">(</span><a href="#local-1628203752"><span class="hs-identifier hs-var">fs</span></a><span>  </span><span class="hs-special">`</span><a href="TcRnTypes.html#eqCanRewriteFR"><span class="hs-identifier hs-var">eqCanRewriteFR</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203707"><span class="hs-identifier hs-var">new_fr</span></a><span class="hs-special">)</span><span>               </span><span class="hs-comment">-- (K2b)</span><span>
</span><a name="line-1458"></a><span>                </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628203707"><span class="hs-identifier hs-var">new_fr</span></a><span> </span><span class="hs-special">`</span><a href="TcRnTypes.html#eqCanRewriteFR"><span class="hs-identifier hs-var">eqCanRewriteFR</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203752"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>                </span><span class="hs-comment">-- (K2c)</span><span>
</span><a name="line-1459"></a><span>                </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628203708"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1628203749"><span class="hs-identifier hs-var">rhs_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (K2d)</span><span>
</span><a name="line-1460"></a><span>
</span><a name="line-1461"></a><span>        </span><a name="local-1628203754"><a href="#local-1628203754"><span class="hs-identifier">check_k3</span></a></a><span>
</span><a name="line-1462"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628203707"><span class="hs-identifier hs-var">new_fr</span></a><span> </span><span class="hs-special">`</span><a href="TcRnTypes.html#eqCanRewriteFR"><span class="hs-identifier hs-var">eqCanRewriteFR</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203752"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-1463"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628203751"><span class="hs-identifier hs-var">eq_rel</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1464"></a><span>              </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628203749"><span class="hs-identifier hs-var">rhs_ty</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1628203708"><span class="hs-identifier hs-var">new_tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1465"></a><span>              </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcType.html#isTyVarExposed"><span class="hs-identifier hs-var">isTyVarExposed</span></a><span> </span><a href="#local-1628203708"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><a href="#local-1628203749"><span class="hs-identifier hs-var">rhs_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1466"></a><span>
</span><a name="line-1467"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1468"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1469"></a><span>
</span><a name="line-1470"></a><span>    </span><span class="hs-identifier">keep_eq</span><span> </span><a name="local-1628203755"><a href="#local-1628203755"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;keep_eq&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203755"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1471"></a><span>
</span><a name="line-1472"></a><span class="hs-identifier">kickOutAfterUnification</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1473"></a><a name="kickOutAfterUnification"><a href="TcSMonad.html#kickOutAfterUnification"><span class="hs-identifier">kickOutAfterUnification</span></a></a><span> </span><a name="local-1628203756"><a href="#local-1628203756"><span class="hs-identifier">new_tv</span></a></a><span>
</span><a name="line-1474"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203757"><a href="#local-1628203757"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a><span>
</span><a name="line-1475"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628203758"><a href="#local-1628203758"><span class="hs-identifier">kicked_out1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628203759"><a href="#local-1628203759"><span class="hs-identifier">ics1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#kickOutModel"><span class="hs-identifier hs-var">kickOutModel</span></a><span> </span><a href="#local-1628203756"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><a href="#local-1628203757"><span class="hs-identifier hs-var">ics</span></a><span>
</span><a name="line-1476"></a><span>             </span><span class="hs-special">(</span><a name="local-1628203760"><a href="#local-1628203760"><span class="hs-identifier">kicked_out2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628203761"><a href="#local-1628203761"><span class="hs-identifier">ics2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#kickOutRewritable"><span class="hs-identifier hs-var">kickOutRewritable</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Given"><span class="hs-identifier hs-var">Given</span></a><span class="hs-special">,</span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span>
</span><a name="line-1477"></a><span>                                                     </span><a href="#local-1628203756"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><a href="#local-1628203759"><span class="hs-identifier hs-var">ics1</span></a><span>
</span><a name="line-1478"></a><span>                     </span><span class="hs-comment">-- Given because the tv := xi is given; NomEq because</span><span>
</span><a name="line-1479"></a><span>                     </span><span class="hs-comment">-- only nominal equalities are solved by unification</span><span>
</span><a name="line-1480"></a><span>             </span><a name="local-1628203762"><a href="#local-1628203762"><span class="hs-identifier">kicked_out</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#appendWorkList"><span class="hs-identifier hs-var">appendWorkList</span></a><span> </span><a href="#local-1628203758"><span class="hs-identifier hs-var">kicked_out1</span></a><span> </span><a href="#local-1628203760"><span class="hs-identifier hs-var">kicked_out2</span></a><span>
</span><a name="line-1481"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#setInertCans"><span class="hs-identifier hs-var">setInertCans</span></a><span> </span><a href="#local-1628203761"><span class="hs-identifier hs-var">ics2</span></a><span>
</span><a name="line-1482"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#appendWorkList"><span class="hs-identifier hs-var">appendWorkList</span></a><span> </span><a href="#local-1628203762"><span class="hs-identifier hs-var">kicked_out</span></a><span class="hs-special">)</span><span>
</span><a name="line-1483"></a><span>
</span><a name="line-1484"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#isEmptyWorkList"><span class="hs-identifier hs-var">isEmptyWorkList</span></a><span> </span><a href="#local-1628203762"><span class="hs-identifier hs-var">kicked_out</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1485"></a><span>         </span><a href="TcSMonad.html#csTraceTcS"><span class="hs-identifier hs-var">csTraceTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1486"></a><span>         </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Kick out (unify), tv =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203756"><span class="hs-identifier hs-var">new_tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1487"></a><span>            </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;n-kicked =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#workListSize"><span class="hs-identifier hs-var">workListSize</span></a><span> </span><a href="#local-1628203762"><span class="hs-identifier hs-var">kicked_out</span></a><span class="hs-special">)</span><span>
</span><a name="line-1488"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;kicked_out =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203762"><span class="hs-identifier hs-var">kicked_out</span></a><span>
</span><a name="line-1489"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Residual inerts =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203761"><span class="hs-identifier hs-var">ics2</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1490"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#workListSize"><span class="hs-identifier hs-var">workListSize</span></a><span> </span><a href="#local-1628203762"><span class="hs-identifier hs-var">kicked_out</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1491"></a><span>
</span><a name="line-1492"></a><span class="hs-identifier">kickOutModel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span class="hs-special">)</span><span>
</span><a name="line-1493"></a><a name="kickOutModel"><a href="TcSMonad.html#kickOutModel"><span class="hs-identifier">kickOutModel</span></a></a><span> </span><a name="local-1628203763"><a href="#local-1628203763"><span class="hs-identifier">new_tv</span></a></a><span> </span><a name="local-1628203764"><a href="#local-1628203764"><span class="hs-identifier">ics</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_model</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203765"><a href="#local-1628203765"><span class="hs-identifier">model</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203766"><a href="#local-1628203766"><span class="hs-identifier">eqs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1494"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#foldVarEnv"><span class="hs-identifier hs-var">foldVarEnv</span></a><span> </span><a href="#local-1628203770"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="TcSMonad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a><span> </span><a href="#local-1628203767"><span class="hs-identifier hs-var">der_out</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203764"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_model</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203768"><span class="hs-identifier hs-var">new_model</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1495"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1496"></a><span>    </span><span class="hs-special">(</span><a name="local-1628203767"><a href="#local-1628203767"><span class="hs-identifier">der_out</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628203768"><a href="#local-1628203768"><span class="hs-identifier">new_model</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#partitionVarEnv"><span class="hs-identifier hs-var">partitionVarEnv</span></a><span> </span><a href="#local-1628203769"><span class="hs-identifier hs-var">kick_out_der</span></a><span> </span><a href="#local-1628203765"><span class="hs-identifier hs-var">model</span></a><span>
</span><a name="line-1497"></a><span>
</span><a name="line-1498"></a><span>    </span><span class="hs-identifier">kick_out_der</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1499"></a><span>    </span><a name="local-1628203769"><a href="#local-1628203769"><span class="hs-identifier">kick_out_der</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203771"><a href="#local-1628203771"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203772"><a href="#local-1628203772"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1500"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203763"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628203771"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1628203763"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1628203772"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1501"></a><span>    </span><span class="hs-identifier">kick_out_der</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1502"></a><span>
</span><a name="line-1503"></a><span>    </span><span class="hs-identifier">add</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span>
</span><a name="line-1504"></a><span>    </span><span class="hs-comment">-- Don't kick out a Derived if there is a Given or Wanted with</span><span>
</span><a name="line-1505"></a><span>    </span><span class="hs-comment">-- the same predicate.  The model is just a shadow copy, and the</span><span>
</span><a name="line-1506"></a><span>    </span><span class="hs-comment">-- Given/Wanted will serve the purpose.</span><span>
</span><a name="line-1507"></a><span>    </span><a name="local-1628203770"><a href="#local-1628203770"><span class="hs-identifier">add</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203773"><a href="#local-1628203773"><span class="hs-identifier">ev</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203774"><a href="#local-1628203774"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203775"><a href="#local-1628203775"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628203776"><a href="#local-1628203776"><span class="hs-identifier">wl</span></a></a><span>
</span><a name="line-1508"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#isInInertEqs"><span class="hs-identifier hs-var">isInInertEqs</span></a><span> </span><a href="#local-1628203766"><span class="hs-identifier hs-var">eqs</span></a><span> </span><a href="#local-1628203774"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1628203775"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#extendWorkListDerived"><span class="hs-identifier hs-var">extendWorkListDerived</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a><span> </span><a href="#local-1628203773"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203773"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-1628203776"><span class="hs-identifier hs-var">wl</span></a><span>
</span><a name="line-1509"></a><span>    </span><span class="hs-identifier">add</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628203777"><a href="#local-1628203777"><span class="hs-identifier">wl</span></a></a><span>                          </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203777"><span class="hs-identifier hs-var">wl</span></a><span>
</span><a name="line-1510"></a><span>
</span><a name="line-1511"></a><span>
</span><a name="line-1512"></a><span class="hs-comment">{- Note [kickOutRewritable]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
See also Note [inert_eqs: the inert equalities].

When we add a new inert equality (a ~N ty) to the inert set,
we must kick out any inert items that could be rewritten by the
new equality, to maintain the inert-set invariants.

  - We want to kick out an existing inert constraint if
    a) the new constraint can rewrite the inert one
    b) 'a' is free in the inert constraint (so that it *will*)
       rewrite it if we kick it out.

    For (b) we use tyCoVarsOfCt, which returns the type variables /and
    the kind variables/ that are directly visible in the type. Hence
    we will have exposed all the rewriting we care about to make the
    most precise kinds visible for matching classes etc. No need to
    kick out constraints that mention type variables whose kinds
    contain this variable!

  - We do not need to kick anything out from the model; we only
    add [D] constraints to the model (in effect) and they are
    fully rewritten by the model, so (K2b) holds

  - A Derived equality can kick out [D] constraints in inert_dicts,
    inert_irreds etc.  Nothing in inert_eqs because there are no
    Derived constraints in inert_eqs (they are in the model)

  - We don't kick out constraints from inert_solved_dicts, and
    inert_solved_funeqs optimistically. But when we lookup we have to
    take the substitution into account


Note [Kick out insolubles]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have an insoluble alpha ~ [alpha], which is insoluble
because an occurs check.  And then we unify alpha := [Int].
Then we really want to rewrite the insoluble to [Int] ~ [[Int]].
Now it can be decomposed.  Otherwise we end up with a &quot;Can't match
[Int] ~ [[Int]]&quot; which is true, but a bit confusing because the
outer type constructors match.
-}</span><span>
</span><a name="line-1554"></a><span>
</span><a name="line-1555"></a><span>
</span><a name="line-1556"></a><span>
</span><a name="line-1557"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-1558"></a><span class="hs-identifier">addInertSafehask</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span>
</span><a name="line-1559"></a><a name="addInertSafehask"><a href="TcSMonad.html#addInertSafehask"><span class="hs-identifier">addInertSafehask</span></a></a><span> </span><a name="local-1628203778"><a href="#local-1628203778"><span class="hs-identifier">ics</span></a></a><span> </span><a name="local-1628203779"><a href="#local-1628203779"><span class="hs-identifier">item</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_class</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203780"><a href="#local-1628203780"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203781"><a href="#local-1628203781"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1560"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203778"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_safehask</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#addDict"><span class="hs-identifier hs-var">addDict</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_dicts</span><span> </span><a href="#local-1628203778"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203780"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628203781"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628203779"><span class="hs-identifier hs-var">item</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1561"></a><span>
</span><a name="line-1562"></a><span class="hs-identifier">addInertSafehask</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628203782"><a href="#local-1628203782"><span class="hs-identifier">item</span></a></a><span>
</span><a name="line-1563"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;addInertSafehask: can't happen! Inserting &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203782"><span class="hs-identifier hs-var">item</span></a><span>
</span><a name="line-1564"></a><span>
</span><a name="line-1565"></a><span class="hs-identifier">insertSafeOverlapFailureTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1566"></a><span class="hs-comment">-- See Note [Safe Haskell Overlapping Instances Implementation] in TcSimplify</span><span>
</span><a name="line-1567"></a><a name="insertSafeOverlapFailureTcS"><a href="TcSMonad.html#insertSafeOverlapFailureTcS"><span class="hs-identifier">insertSafeOverlapFailureTcS</span></a></a><span> </span><a name="local-1628203783"><a href="#local-1628203783"><span class="hs-identifier">item</span></a></a><span>
</span><a name="line-1568"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628203784"><a href="#local-1628203784"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#addInertSafehask"><span class="hs-identifier hs-var">addInertSafehask</span></a><span> </span><a href="#local-1628203784"><span class="hs-identifier hs-var">ics</span></a><span> </span><a href="#local-1628203783"><span class="hs-identifier hs-var">item</span></a><span class="hs-special">)</span><span>
</span><a name="line-1569"></a><span>
</span><a name="line-1570"></a><span class="hs-identifier">getSafeOverlapFailures</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-1571"></a><span class="hs-comment">-- See Note [Safe Haskell Overlapping Instances Implementation] in TcSimplify</span><span>
</span><a name="line-1572"></a><a name="getSafeOverlapFailures"><a href="TcSMonad.html#getSafeOverlapFailures"><span class="hs-identifier">getSafeOverlapFailures</span></a></a><span>
</span><a name="line-1573"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_safehask</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203785"><a href="#local-1628203785"><span class="hs-identifier">safehask</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a><span>
</span><a name="line-1574"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcSMonad.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a><span> </span><a href="TcRnTypes.html#consCts"><span class="hs-identifier hs-var">consCts</span></a><span> </span><a href="#local-1628203785"><span class="hs-identifier hs-var">safehask</span></a><span> </span><a href="TcRnTypes.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1575"></a><span>
</span><a name="line-1576"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-1577"></a><span class="hs-identifier">addSolvedDict</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1578"></a><span class="hs-comment">-- Add a new item in the solved set of the monad</span><span>
</span><a name="line-1579"></a><span class="hs-comment">-- See Note [Solved dictionaries]</span><span>
</span><a name="line-1580"></a><a name="addSolvedDict"><a href="TcSMonad.html#addSolvedDict"><span class="hs-identifier">addSolvedDict</span></a></a><span> </span><a name="local-1628203786"><a href="#local-1628203786"><span class="hs-identifier">item</span></a></a><span> </span><a name="local-1628203787"><a href="#local-1628203787"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628203788"><a href="#local-1628203788"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1581"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isIPPred"><span class="hs-identifier hs-var">isIPPred</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a><span> </span><a href="#local-1628203786"><span class="hs-identifier hs-var">item</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Never cache &quot;solved&quot; implicit parameters (not sure why!)</span><span>
</span><a name="line-1582"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1583"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1584"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;updSolvedSetTcs:&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203786"><span class="hs-identifier hs-var">item</span></a><span>
</span><a name="line-1585"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628203789"><a href="#local-1628203789"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1586"></a><span>             </span><a href="#local-1628203789"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_solved_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#addDict"><span class="hs-identifier hs-var">addDict</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_solved_dicts</span><span> </span><a href="#local-1628203789"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203787"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628203788"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628203786"><span class="hs-identifier hs-var">item</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1587"></a><span>
</span><a name="line-1588"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                  Other inert-set operations
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-1593"></a><span>
</span><a name="line-1594"></a><span class="hs-identifier">updInertTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1595"></a><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><a name="line-1596"></a><a name="updInertTcS"><a href="TcSMonad.html#updInertTcS"><span class="hs-identifier">updInertTcS</span></a></a><span> </span><a name="local-1628203790"><a href="#local-1628203790"><span class="hs-identifier">upd_fn</span></a></a><span>
</span><a name="line-1597"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203791"><a href="#local-1628203791"><span class="hs-identifier">is_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcSInertsRef"><span class="hs-identifier hs-var">getTcSInertsRef</span></a><span>
</span><a name="line-1598"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203792"><a href="#local-1628203792"><span class="hs-identifier">curr_inert</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628203791"><span class="hs-identifier hs-var">is_var</span></a><span>
</span><a name="line-1599"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><a href="#local-1628203791"><span class="hs-identifier hs-var">is_var</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203790"><span class="hs-identifier hs-var">upd_fn</span></a><span> </span><a href="#local-1628203792"><span class="hs-identifier hs-var">curr_inert</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1600"></a><span>
</span><a name="line-1601"></a><span class="hs-identifier">getInertCans</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span>
</span><a name="line-1602"></a><a name="getInertCans"><a href="TcSMonad.html#getInertCans"><span class="hs-identifier">getInertCans</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203793"><a href="#local-1628203793"><span class="hs-identifier">inerts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_cans</span><span> </span><a href="#local-1628203793"><span class="hs-identifier hs-var">inerts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1603"></a><span>
</span><a name="line-1604"></a><span class="hs-identifier">setInertCans</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1605"></a><a name="setInertCans"><a href="TcSMonad.html#setInertCans"><span class="hs-identifier">setInertCans</span></a></a><span> </span><a name="local-1628203794"><a href="#local-1628203794"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628203795"><a href="#local-1628203795"><span class="hs-identifier">inerts</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203795"><span class="hs-identifier hs-var">inerts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_cans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203794"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1606"></a><span>
</span><a name="line-1607"></a><span class="hs-identifier">takeGivenInsolubles</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-1608"></a><span class="hs-comment">-- See Note [The inert set after solving Givens]</span><span>
</span><a name="line-1609"></a><a name="takeGivenInsolubles"><a href="TcSMonad.html#takeGivenInsolubles"><span class="hs-identifier">takeGivenInsolubles</span></a></a><span>
</span><a name="line-1610"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#updRetInertCans"><span class="hs-identifier hs-var">updRetInertCans</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628203796"><a href="#local-1628203796"><span class="hs-identifier">cans</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1611"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">inert_insols</span><span> </span><a href="#local-1628203796"><span class="hs-identifier hs-var">cans</span></a><span>
</span><a name="line-1612"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-1628203796"><span class="hs-identifier hs-var">cans</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_insols</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span>
</span><a name="line-1613"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#filterFunEqs"><span class="hs-identifier hs-var">filterFunEqs</span></a><span> </span><a href="TcRnTypes.html#isGivenCt"><span class="hs-identifier hs-var">isGivenCt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_funeqs</span><span> </span><a href="#local-1628203796"><span class="hs-identifier hs-var">cans</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1614"></a><span>
</span><a name="line-1615"></a><span class="hs-comment">{- Note [The inert set after solving Givens]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
After solving the Givens we take two things out of the inert set

  a) The insolubles; we return these to report inaccessible code
     We return these separately.  We don't want to leave them in
     the inert set, lest we confuse them with insolubles arising from
     solving wanteds

  b) Any Derived CFunEqCans.  Derived CTyEqCans are in the
     inert_model and do no harm.  In contrast, Derived CFunEqCans
     get mixed up with the Wanteds later and confuse the
     post-solve-wanted unflattening (Trac #10507).
     E.g.  From   [G] 1 &lt;= m, [G] m &lt;= n
           We get [D] 1 &lt;= n, and we must remove it!
         Otherwise we unflatten it more then once, and assign
         to its fmv more than once...disaster.
     It's ok to remove them because they turned not not to
     yield an insoluble, and hence have now done their work.
-}</span><span>
</span><a name="line-1635"></a><span>
</span><a name="line-1636"></a><span class="hs-identifier">updRetInertCans</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1628203580"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203580"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1637"></a><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><a name="line-1638"></a><a name="updRetInertCans"><a href="TcSMonad.html#updRetInertCans"><span class="hs-identifier">updRetInertCans</span></a></a><span> </span><a name="local-1628203797"><a href="#local-1628203797"><span class="hs-identifier">upd_fn</span></a></a><span>
</span><a name="line-1639"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203798"><a href="#local-1628203798"><span class="hs-identifier">is_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcSInertsRef"><span class="hs-identifier hs-var">getTcSInertsRef</span></a><span>
</span><a name="line-1640"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203799"><a href="#local-1628203799"><span class="hs-identifier">inerts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628203798"><span class="hs-identifier hs-var">is_var</span></a><span>
</span><a name="line-1641"></a><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628203800"><a href="#local-1628203800"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628203801"><a href="#local-1628203801"><span class="hs-identifier">cans'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203797"><span class="hs-identifier hs-var">upd_fn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_cans</span><span> </span><a href="#local-1628203799"><span class="hs-identifier hs-var">inerts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1642"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><a href="#local-1628203798"><span class="hs-identifier hs-var">is_var</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203799"><span class="hs-identifier hs-var">inerts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_cans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203801"><span class="hs-identifier hs-var">cans'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1643"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628203800"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1644"></a><span>
</span><a name="line-1645"></a><span class="hs-identifier">updInertCans</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1646"></a><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><a name="line-1647"></a><a name="updInertCans"><a href="TcSMonad.html#updInertCans"><span class="hs-identifier">updInertCans</span></a></a><span> </span><a name="local-1628203802"><a href="#local-1628203802"><span class="hs-identifier">upd_fn</span></a></a><span>
</span><a name="line-1648"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628203803"><a href="#local-1628203803"><span class="hs-identifier">inerts</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203803"><span class="hs-identifier hs-var">inerts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_cans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203802"><span class="hs-identifier hs-var">upd_fn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_cans</span><span> </span><a href="#local-1628203803"><span class="hs-identifier hs-var">inerts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1649"></a><span>
</span><a name="line-1650"></a><span class="hs-identifier">updInertDicts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1651"></a><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><a name="line-1652"></a><a name="updInertDicts"><a href="TcSMonad.html#updInertDicts"><span class="hs-identifier">updInertDicts</span></a></a><span> </span><a name="local-1628203804"><a href="#local-1628203804"><span class="hs-identifier">upd_fn</span></a></a><span>
</span><a name="line-1653"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628203805"><a href="#local-1628203805"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203805"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203804"><span class="hs-identifier hs-var">upd_fn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_dicts</span><span> </span><a href="#local-1628203805"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1654"></a><span>
</span><a name="line-1655"></a><span class="hs-identifier">updInertSafehask</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1656"></a><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><a name="line-1657"></a><a name="updInertSafehask"><a href="TcSMonad.html#updInertSafehask"><span class="hs-identifier">updInertSafehask</span></a></a><span> </span><a name="local-1628203806"><a href="#local-1628203806"><span class="hs-identifier">upd_fn</span></a></a><span>
</span><a name="line-1658"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628203807"><a href="#local-1628203807"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203807"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_safehask</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203806"><span class="hs-identifier hs-var">upd_fn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_safehask</span><span> </span><a href="#local-1628203807"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1659"></a><span>
</span><a name="line-1660"></a><span class="hs-identifier">updInertFunEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1661"></a><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><a name="line-1662"></a><a name="updInertFunEqs"><a href="TcSMonad.html#updInertFunEqs"><span class="hs-identifier">updInertFunEqs</span></a></a><span> </span><a name="local-1628203808"><a href="#local-1628203808"><span class="hs-identifier">upd_fn</span></a></a><span>
</span><a name="line-1663"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628203809"><a href="#local-1628203809"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203809"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203808"><span class="hs-identifier hs-var">upd_fn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_funeqs</span><span> </span><a href="#local-1628203809"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1664"></a><span>
</span><a name="line-1665"></a><span class="hs-identifier">updInertIrreds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1666"></a><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><a name="line-1667"></a><a name="updInertIrreds"><a href="TcSMonad.html#updInertIrreds"><span class="hs-identifier">updInertIrreds</span></a></a><span> </span><a name="local-1628203810"><a href="#local-1628203810"><span class="hs-identifier">upd_fn</span></a></a><span>
</span><a name="line-1668"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628203811"><a href="#local-1628203811"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203811"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_irreds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203810"><span class="hs-identifier hs-var">upd_fn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_irreds</span><span> </span><a href="#local-1628203811"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1669"></a><span>
</span><a name="line-1670"></a><span class="hs-identifier">getInertEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span class="hs-special">)</span><span>
</span><a name="line-1671"></a><a name="getInertEqs"><a href="TcSMonad.html#getInertEqs"><span class="hs-identifier">getInertEqs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203812"><a href="#local-1628203812"><span class="hs-identifier">inert</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_eqs</span><span> </span><a href="#local-1628203812"><span class="hs-identifier hs-var">inert</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1672"></a><span>
</span><a name="line-1673"></a><span class="hs-identifier">getInertModel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcSMonad.html#InertModel"><span class="hs-identifier hs-type">InertModel</span></a><span>
</span><a name="line-1674"></a><a name="getInertModel"><a href="TcSMonad.html#getInertModel"><span class="hs-identifier">getInertModel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203813"><a href="#local-1628203813"><span class="hs-identifier">inert</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_model</span><span> </span><a href="#local-1628203813"><span class="hs-identifier hs-var">inert</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1675"></a><span>
</span><a name="line-1676"></a><span class="hs-identifier">getInertGivens</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>
</span><a name="line-1677"></a><span class="hs-comment">-- Returns the Given constraints in the inert set,</span><span>
</span><a name="line-1678"></a><span class="hs-comment">-- with type functions *not* unflattened</span><span>
</span><a name="line-1679"></a><a name="getInertGivens"><a href="TcSMonad.html#getInertGivens"><span class="hs-identifier">getInertGivens</span></a></a><span>
</span><a name="line-1680"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203814"><a href="#local-1628203814"><span class="hs-identifier">inerts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a><span>
</span><a name="line-1681"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628203815"><a href="#local-1628203815"><span class="hs-identifier">all_cts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_dicts</span><span> </span><a href="#local-1628203814"><span class="hs-identifier hs-var">inerts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1682"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcSMonad.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_funeqs</span><span> </span><a href="#local-1628203814"><span class="hs-identifier hs-var">inerts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1683"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#varEnvElts"><span class="hs-identifier hs-var">varEnvElts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_eqs</span><span> </span><a href="#local-1628203814"><span class="hs-identifier hs-var">inerts</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1684"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="TcRnTypes.html#isGivenCt"><span class="hs-identifier hs-var">isGivenCt</span></a><span> </span><a href="#local-1628203815"><span class="hs-identifier hs-var">all_cts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1685"></a><span>
</span><a name="line-1686"></a><span class="hs-identifier">getPendingScDicts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>
</span><a name="line-1687"></a><span class="hs-comment">-- Find all inert Given dictionaries whose cc_pend_sc flag is True</span><span>
</span><a name="line-1688"></a><span class="hs-comment">-- Set the flag to False in the inert set, and return that Ct</span><span>
</span><a name="line-1689"></a><a name="getPendingScDicts"><a href="TcSMonad.html#getPendingScDicts"><span class="hs-identifier">getPendingScDicts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#updRetInertCans"><span class="hs-identifier hs-var">updRetInertCans</span></a><span> </span><a href="#local-1628203816"><span class="hs-identifier hs-var">get_sc_dicts</span></a><span>
</span><a name="line-1690"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1691"></a><span>    </span><a name="local-1628203816"><a href="#local-1628203816"><span class="hs-identifier">get_sc_dicts</span></a></a><span> </span><a name="local-1628203819"><a href="#local-1628203819"><span class="hs-identifier">ic</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203820"><a href="#local-1628203820"><span class="hs-identifier">dicts</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1692"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628203822"><span class="hs-identifier hs-var">sc_pend_dicts</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203821"><span class="hs-identifier hs-var">ic'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1693"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1694"></a><span>        </span><a name="local-1628203821"><a href="#local-1628203821"><span class="hs-identifier">ic'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203819"><span class="hs-identifier hs-var">ic</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><a href="#local-1628203818"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="#local-1628203820"><span class="hs-identifier hs-var">dicts</span></a><span> </span><a href="#local-1628203822"><span class="hs-identifier hs-var">sc_pend_dicts</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1695"></a><span>
</span><a name="line-1696"></a><span>        </span><span class="hs-identifier">sc_pend_dicts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>
</span><a name="line-1697"></a><span>        </span><a name="local-1628203822"><a href="#local-1628203822"><span class="hs-identifier">sc_pend_dicts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a><span> </span><a href="#local-1628203817"><span class="hs-identifier hs-var">get_pending</span></a><span> </span><a href="#local-1628203820"><span class="hs-identifier hs-var">dicts</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1698"></a><span>
</span><a name="line-1699"></a><span>    </span><span class="hs-identifier">get_pending</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Get dicts with cc_pend_sc = True</span><span>
</span><a name="line-1700"></a><span>                                       </span><span class="hs-comment">-- but flipping the flag</span><span>
</span><a name="line-1701"></a><span>    </span><a name="local-1628203817"><a href="#local-1628203817"><span class="hs-identifier">get_pending</span></a></a><span> </span><a name="local-1628203823"><a href="#local-1628203823"><span class="hs-identifier">dict</span></a></a><span> </span><a name="local-1628203824"><a href="#local-1628203824"><span class="hs-identifier">dicts</span></a></a><span>
</span><a name="line-1702"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628203825"><a href="#local-1628203825"><span class="hs-identifier">dict'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnTypes.html#isPendingScDict"><span class="hs-identifier hs-var">isPendingScDict</span></a><span> </span><a href="#local-1628203823"><span class="hs-identifier hs-var">dict</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203825"><span class="hs-identifier hs-var">dict'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628203824"><span class="hs-identifier hs-var">dicts</span></a><span>
</span><a name="line-1703"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                          </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203824"><span class="hs-identifier hs-var">dicts</span></a><span>
</span><a name="line-1704"></a><span>
</span><a name="line-1705"></a><span>    </span><span class="hs-identifier">add</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-1706"></a><span>    </span><a name="local-1628203818"><a href="#local-1628203818"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-1628203826"><a href="#local-1628203826"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_class</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203827"><a href="#local-1628203827"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203828"><a href="#local-1628203828"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628203829"><a href="#local-1628203829"><span class="hs-identifier">dicts</span></a></a><span>
</span><a name="line-1707"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#addDict"><span class="hs-identifier hs-var">addDict</span></a><span> </span><a href="#local-1628203829"><span class="hs-identifier hs-var">dicts</span></a><span> </span><a href="#local-1628203827"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628203828"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628203826"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1708"></a><span>    </span><span class="hs-identifier">add</span><span> </span><a name="local-1628203830"><a href="#local-1628203830"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;getPendingScDicts&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203830"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1709"></a><span>
</span><a name="line-1710"></a><span class="hs-identifier">getUnsolvedInerts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span>
</span><a name="line-1711"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>     </span><span class="hs-comment">-- Tyvar eqs: a ~ ty</span><span>
</span><a name="line-1712"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>     </span><span class="hs-comment">-- Fun eqs:   F a ~ ty</span><span>
</span><a name="line-1713"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>     </span><span class="hs-comment">-- Insoluble</span><span>
</span><a name="line-1714"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- All others</span><span>
</span><a name="line-1715"></a><span class="hs-comment">-- Return all the unsolved [Wanted] or [Derived] constraints</span><span>
</span><a name="line-1716"></a><span class="hs-comment">--</span><span>
</span><a name="line-1717"></a><span class="hs-comment">-- Post-condition: the returned simple constraints are all fully zonked</span><span>
</span><a name="line-1718"></a><span class="hs-comment">--                     (because they come from the inert set)</span><span>
</span><a name="line-1719"></a><span class="hs-comment">--                 the unsolved implics may not be</span><span>
</span><a name="line-1720"></a><a name="getUnsolvedInerts"><a href="TcSMonad.html#getUnsolvedInerts"><span class="hs-identifier">getUnsolvedInerts</span></a></a><span>
</span><a name="line-1721"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_eqs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203843"><a href="#local-1628203843"><span class="hs-identifier">tv_eqs</span></a></a><span>
</span><a name="line-1722"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203844"><a href="#local-1628203844"><span class="hs-identifier">fun_eqs</span></a></a><span>
</span><a name="line-1723"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_irreds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203845"><a href="#local-1628203845"><span class="hs-identifier">irreds</span></a></a><span>
</span><a name="line-1724"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_dicts</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203846"><a href="#local-1628203846"><span class="hs-identifier">idicts</span></a></a><span>
</span><a name="line-1725"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_insols</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203847"><a href="#local-1628203847"><span class="hs-identifier">insols</span></a></a><span>
</span><a name="line-1726"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_model</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203848"><a href="#local-1628203848"><span class="hs-identifier">model</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a><span>
</span><a name="line-1727"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-1628203849"><a href="#local-1628203849"><span class="hs-identifier">keep_derived</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#keepSolvingDeriveds"><span class="hs-identifier hs-var">keepSolvingDeriveds</span></a><span>
</span><a name="line-1728"></a><span>
</span><a name="line-1729"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628203850"><a href="#local-1628203850"><span class="hs-identifier">der_tv_eqs</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#foldVarEnv"><span class="hs-identifier hs-var">foldVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203831"><span class="hs-identifier hs-var">add_der_eq</span></a><span> </span><a href="#local-1628203849"><span class="hs-identifier hs-var">keep_derived</span></a><span> </span><a href="#local-1628203843"><span class="hs-identifier hs-var">tv_eqs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1730"></a><span>                                          </span><a href="TcRnTypes.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a><span> </span><a href="#local-1628203848"><span class="hs-identifier hs-var">model</span></a><span>
</span><a name="line-1731"></a><span>            </span><a name="local-1628203851"><a href="#local-1628203851"><span class="hs-identifier">unsolved_tv_eqs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldTyEqs"><span class="hs-identifier hs-var">foldTyEqs</span></a><span> </span><a href="#local-1628203832"><span class="hs-identifier hs-var">add_if_unsolved</span></a><span> </span><a href="#local-1628203843"><span class="hs-identifier hs-var">tv_eqs</span></a><span> </span><a href="#local-1628203850"><span class="hs-identifier hs-var">der_tv_eqs</span></a><span>
</span><a name="line-1732"></a><span>            </span><a name="local-1628203852"><a href="#local-1628203852"><span class="hs-identifier">unsolved_fun_eqs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a><span> </span><a href="#local-1628203832"><span class="hs-identifier hs-var">add_if_unsolved</span></a><span> </span><a href="#local-1628203844"><span class="hs-identifier hs-var">fun_eqs</span></a><span> </span><a href="TcRnTypes.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a><span>
</span><a name="line-1733"></a><span>            </span><a name="local-1628203853"><a href="#local-1628203853"><span class="hs-identifier">unsolved_irreds</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#filterBag"><span class="hs-identifier hs-var">Bag</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">filterBag</span></a><span> </span><a href="#local-1628203833"><span class="hs-identifier hs-var">is_unsolved</span></a><span> </span><a href="#local-1628203845"><span class="hs-identifier hs-var">irreds</span></a><span>
</span><a name="line-1734"></a><span>            </span><a name="local-1628203854"><a href="#local-1628203854"><span class="hs-identifier">unsolved_dicts</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a><span> </span><a href="#local-1628203832"><span class="hs-identifier hs-var">add_if_unsolved</span></a><span> </span><a href="#local-1628203846"><span class="hs-identifier hs-var">idicts</span></a><span> </span><a href="TcRnTypes.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a><span>
</span><a name="line-1735"></a><span>            </span><a name="local-1628203855"><a href="#local-1628203855"><span class="hs-identifier">others</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203853"><span class="hs-identifier hs-var">unsolved_irreds</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203854"><span class="hs-identifier hs-var">unsolved_dicts</span></a><span>
</span><a name="line-1736"></a><span>
</span><a name="line-1737"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-1628203856"><a href="#local-1628203856"><span class="hs-identifier">implics</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getWorkListImplics"><span class="hs-identifier hs-var">getWorkListImplics</span></a><span>
</span><a name="line-1738"></a><span>
</span><a name="line-1739"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;getUnsolvedInerts&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1740"></a><span>        </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot; tv eqs =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203851"><span class="hs-identifier hs-var">unsolved_tv_eqs</span></a><span>
</span><a name="line-1741"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;fun eqs =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203852"><span class="hs-identifier hs-var">unsolved_fun_eqs</span></a><span>
</span><a name="line-1742"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;insols =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203847"><span class="hs-identifier hs-var">insols</span></a><span>
</span><a name="line-1743"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;others =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203855"><span class="hs-identifier hs-var">others</span></a><span>
</span><a name="line-1744"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;implics =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203856"><span class="hs-identifier hs-var">implics</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1745"></a><span>
</span><a name="line-1746"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628203856"><span class="hs-identifier hs-var">implics</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203851"><span class="hs-identifier hs-var">unsolved_tv_eqs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203852"><span class="hs-identifier hs-var">unsolved_fun_eqs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203847"><span class="hs-identifier hs-var">insols</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628203855"><span class="hs-identifier hs-var">others</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1747"></a><span>              </span><span class="hs-comment">-- Keep even the given insolubles</span><span>
</span><a name="line-1748"></a><span>              </span><span class="hs-comment">-- so that we can report dead GADT pattern match branches</span><span>
</span><a name="line-1749"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1750"></a><span>    </span><a name="local-1628203831"><a href="#local-1628203831"><span class="hs-identifier">add_der_eq</span></a></a><span> </span><a name="local-1628203834"><a href="#local-1628203834"><span class="hs-identifier">keep_derived</span></a></a><span> </span><a name="local-1628203835"><a href="#local-1628203835"><span class="hs-identifier">tv_eqs</span></a></a><span> </span><a name="local-1628203836"><a href="#local-1628203836"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1628203837"><a href="#local-1628203837"><span class="hs-identifier">cts</span></a></a><span>
</span><a name="line-1751"></a><span>       </span><span class="hs-comment">-- See Note [Unsolved Derived equalities]</span><span>
</span><a name="line-1752"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203838"><a href="#local-1628203838"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203839"><a href="#local-1628203839"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203836"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1753"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a><span> </span><a href="#local-1628203838"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1628203834"><span class="hs-identifier hs-var">keep_derived</span></a><span>
</span><a name="line-1754"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#isInInertEqs"><span class="hs-identifier hs-var">isInInertEqs</span></a><span> </span><a href="#local-1628203835"><span class="hs-identifier hs-var">tv_eqs</span></a><span> </span><a href="#local-1628203838"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1628203839"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203836"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203837"><span class="hs-identifier hs-var">cts</span></a><span>
</span><a name="line-1755"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203837"><span class="hs-identifier hs-var">cts</span></a><span>
</span><a name="line-1756"></a><span>    </span><span class="hs-identifier">add_if_unsolved</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-1757"></a><span>    </span><a name="local-1628203832"><a href="#local-1628203832"><span class="hs-identifier">add_if_unsolved</span></a></a><span> </span><a name="local-1628203840"><a href="#local-1628203840"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1628203841"><a href="#local-1628203841"><span class="hs-identifier">cts</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628203833"><span class="hs-identifier hs-var">is_unsolved</span></a><span> </span><a href="#local-1628203840"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203840"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">`</span><a href="TcRnTypes.html#consCts"><span class="hs-identifier hs-var">consCts</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203841"><span class="hs-identifier hs-var">cts</span></a><span>
</span><a name="line-1758"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203841"><span class="hs-identifier hs-var">cts</span></a><span>
</span><a name="line-1759"></a><span>
</span><a name="line-1760"></a><span>    </span><a name="local-1628203833"><a href="#local-1628203833"><span class="hs-identifier">is_unsolved</span></a></a><span> </span><a name="local-1628203842"><a href="#local-1628203842"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isGivenCt"><span class="hs-identifier hs-var">isGivenCt</span></a><span> </span><a href="#local-1628203842"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Wanted or Derived</span><span>
</span><a name="line-1761"></a><span>
</span><a name="line-1762"></a><span class="hs-identifier">isInInertEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1763"></a><span class="hs-comment">-- True if (a ~N ty) is in the inert set, in either Given or Wanted</span><span>
</span><a name="line-1764"></a><a name="isInInertEqs"><a href="TcSMonad.html#isInInertEqs"><span class="hs-identifier">isInInertEqs</span></a></a><span> </span><a name="local-1628203857"><a href="#local-1628203857"><span class="hs-identifier">eqs</span></a></a><span> </span><a name="local-1628203858"><a href="#local-1628203858"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1628203859"><a href="#local-1628203859"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-1765"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1628203857"><span class="hs-identifier hs-var">eqs</span></a><span> </span><a href="#local-1628203858"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1766"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1767"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628203865"><a href="#local-1628203865"><span class="hs-identifier">cts</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203860"><span class="hs-identifier hs-var">same_pred</span></a><span> </span><a href="#local-1628203859"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203865"><span class="hs-identifier hs-var">cts</span></a><span>
</span><a name="line-1768"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1769"></a><span>    </span><a name="local-1628203860"><a href="#local-1628203860"><span class="hs-identifier">same_pred</span></a></a><span> </span><a name="local-1628203861"><a href="#local-1628203861"><span class="hs-identifier">rhs</span></a></a><span> </span><a name="local-1628203862"><a href="#local-1628203862"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-1770"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203863"><a href="#local-1628203863"><span class="hs-identifier">rhs2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_eq_rel</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203864"><a href="#local-1628203864"><span class="hs-identifier">eq_rel</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203862"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1771"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203864"><span class="hs-identifier hs-var">eq_rel</span></a><span>
</span><a name="line-1772"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-1628203861"><span class="hs-identifier hs-var">rhs</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203863"><span class="hs-identifier hs-var">rhs2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1773"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1774"></a><span>
</span><a name="line-1775"></a><span class="hs-identifier">getNoGivenEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>     </span><span class="hs-comment">-- TcLevel of this implication</span><span>
</span><a name="line-1776"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Skolems of this implication</span><span>
</span><a name="line-1777"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>        </span><span class="hs-comment">-- True &lt;=&gt; definitely no residual given equalities</span><span>
</span><a name="line-1778"></a><span class="hs-comment">-- See Note [When does an implication have given equalities?]</span><span>
</span><a name="line-1779"></a><a name="getNoGivenEqs"><a href="TcSMonad.html#getNoGivenEqs"><span class="hs-identifier">getNoGivenEqs</span></a></a><span> </span><a name="local-1628203866"><a href="#local-1628203866"><span class="hs-identifier">tclvl</span></a></a><span> </span><a name="local-1628203867"><a href="#local-1628203867"><span class="hs-identifier">skol_tvs</span></a></a><span>
</span><a name="line-1780"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203883"><a href="#local-1628203883"><span class="hs-identifier">inerts</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203884"><a href="#local-1628203884"><span class="hs-identifier">ieqs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_irreds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203885"><a href="#local-1628203885"><span class="hs-identifier">iirreds</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203886"><a href="#local-1628203886"><span class="hs-identifier">funeqs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1781"></a><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a><span>
</span><a name="line-1782"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628203887"><a href="#local-1628203887"><span class="hs-identifier">local_fsks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a><span> </span><a href="#local-1628203870"><span class="hs-identifier hs-var">add_fsk</span></a><span> </span><a href="#local-1628203886"><span class="hs-identifier hs-var">funeqs</span></a><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-1783"></a><span>
</span><a name="line-1784"></a><span>             </span><a name="local-1628203888"><a href="#local-1628203888"><span class="hs-identifier">has_given_eqs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#foldrBag"><span class="hs-identifier hs-var">foldrBag</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">||</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1628203869"><span class="hs-identifier hs-var">ev_given_here</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span class="hs-special">)</span><span>  </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1628203885"><span class="hs-identifier hs-var">iirreds</span></a><span>
</span><a name="line-1785"></a><span>                          </span><span class="hs-operator hs-var">||</span><span> </span><a href="VarEnv.html#foldVarEnv"><span class="hs-identifier hs-var">foldVarEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">||</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1628203868"><span class="hs-identifier hs-var">eqs_given_here</span></a><span> </span><a href="#local-1628203887"><span class="hs-identifier hs-var">local_fsks</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1628203884"><span class="hs-identifier hs-var">ieqs</span></a><span>
</span><a name="line-1786"></a><span>
</span><a name="line-1787"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;getNoGivenEqs&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203888"><span class="hs-identifier hs-var">has_given_eqs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203883"><span class="hs-identifier hs-var">inerts</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1788"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1628203888"><span class="hs-identifier hs-var">has_given_eqs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1789"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1790"></a><span>    </span><span class="hs-identifier">eqs_given_here</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1791"></a><span>    </span><a name="local-1628203868"><a href="#local-1628203868"><span class="hs-identifier">eqs_given_here</span></a></a><span> </span><a name="local-1628203873"><a href="#local-1628203873"><span class="hs-identifier">local_fsks</span></a></a><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203874"><a href="#local-1628203874"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203875"><a href="#local-1628203875"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-1792"></a><span>                              </span><span class="hs-comment">-- Givens are always a sigleton</span><span>
</span><a name="line-1793"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628203872"><span class="hs-identifier hs-var">skolem_bound_here</span></a><span> </span><a href="#local-1628203873"><span class="hs-identifier hs-var">local_fsks</span></a><span> </span><a href="#local-1628203874"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1628203869"><span class="hs-identifier hs-var">ev_given_here</span></a><span> </span><a href="#local-1628203875"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1794"></a><span>    </span><span class="hs-identifier">eqs_given_here</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1795"></a><span>
</span><a name="line-1796"></a><span>    </span><span class="hs-identifier">ev_given_here</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1797"></a><span>    </span><span class="hs-comment">-- True for a Given bound by the curent implication,</span><span>
</span><a name="line-1798"></a><span>    </span><span class="hs-comment">-- i.e. the current level</span><span>
</span><a name="line-1799"></a><span>    </span><a name="local-1628203869"><a href="#local-1628203869"><span class="hs-identifier">ev_given_here</span></a></a><span> </span><a name="local-1628203876"><a href="#local-1628203876"><span class="hs-identifier">ev</span></a></a><span>
</span><a name="line-1800"></a><span>      </span><span class="hs-glyph">=</span><span>  </span><a href="TcRnTypes.html#isGiven"><span class="hs-identifier hs-var">isGiven</span></a><span> </span><a href="#local-1628203876"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1801"></a><span>      </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1628203866"><span class="hs-identifier hs-var">tclvl</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="TcRnTypes.html#ctLocLevel"><span class="hs-identifier hs-var">ctLocLevel</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a><span> </span><a href="#local-1628203876"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-1802"></a><span>
</span><a name="line-1803"></a><span>    </span><span class="hs-identifier">add_fsk</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span>
</span><a name="line-1804"></a><span>    </span><a name="local-1628203870"><a href="#local-1628203870"><span class="hs-identifier">add_fsk</span></a></a><span> </span><a name="local-1628203877"><a href="#local-1628203877"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1628203878"><a href="#local-1628203878"><span class="hs-identifier">fsks</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_fsk</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203879"><a href="#local-1628203879"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203880"><a href="#local-1628203880"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203877"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1805"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isGiven"><span class="hs-identifier hs-var">isGiven</span></a><span> </span><a href="#local-1628203880"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#extendVarSet"><span class="hs-identifier hs-var">extendVarSet</span></a><span> </span><a href="#local-1628203878"><span class="hs-identifier hs-var">fsks</span></a><span> </span><a href="#local-1628203879"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1806"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203878"><span class="hs-identifier hs-var">fsks</span></a><span>
</span><a name="line-1807"></a><span>
</span><a name="line-1808"></a><span>    </span><a name="local-1628203871"><a href="#local-1628203871"><span class="hs-identifier">skol_tv_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a><span> </span><a href="#local-1628203867"><span class="hs-identifier hs-var">skol_tvs</span></a><span>
</span><a name="line-1809"></a><span>    </span><a name="local-1628203872"><a href="#local-1628203872"><span class="hs-identifier">skolem_bound_here</span></a></a><span> </span><a name="local-1628203881"><a href="#local-1628203881"><span class="hs-identifier">local_fsks</span></a></a><span> </span><a name="local-1628203882"><a href="#local-1628203882"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-comment">-- See Note [Let-bound skolems]</span><span>
</span><a name="line-1810"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-1628203882"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1811"></a><span>          </span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203882"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203871"><span class="hs-identifier hs-var">skol_tv_set</span></a><span>
</span><a name="line-1812"></a><span>          </span><a href="TcType.html#FlatSkol"><span class="hs-identifier hs-var">FlatSkol</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1628203882"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203881"><span class="hs-identifier hs-var">local_fsks</span></a><span class="hs-special">)</span><span>
</span><a name="line-1813"></a><span>          </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1814"></a><span>
</span><a name="line-1815"></a><span class="hs-comment">-- | Returns Given constraints that might,</span><span>
</span><a name="line-1816"></a><span class="hs-comment">-- potentially, match the given pred. This is used when checking to see if a</span><span>
</span><a name="line-1817"></a><span class="hs-comment">-- Given might overlap with an instance. See Note [Instance and Given overlap]</span><span>
</span><a name="line-1818"></a><span class="hs-comment">-- in TcInteract.</span><span>
</span><a name="line-1819"></a><span class="hs-identifier">matchableGivens</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-1820"></a><a name="matchableGivens"><a href="TcSMonad.html#matchableGivens"><span class="hs-identifier">matchableGivens</span></a></a><span> </span><a name="local-1628203889"><a href="#local-1628203889"><span class="hs-identifier">loc_w</span></a></a><span> </span><a name="local-1628203890"><a href="#local-1628203890"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#IS"><span class="hs-identifier hs-var">IS</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_cans</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203891"><a href="#local-1628203891"><span class="hs-identifier">inert_cans</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1821"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#filterBag"><span class="hs-identifier hs-var">filterBag</span></a><span> </span><a href="#local-1628203893"><span class="hs-identifier hs-var">matchable_given</span></a><span> </span><a href="#local-1628203892"><span class="hs-identifier hs-var">all_relevant_givens</span></a><span>
</span><a name="line-1822"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1823"></a><span>    </span><span class="hs-comment">-- just look in class constraints and irreds. matchableGivens does get called</span><span>
</span><a name="line-1824"></a><span>    </span><span class="hs-comment">-- for ~R constraints, but we don't need to look through equalities, because</span><span>
</span><a name="line-1825"></a><span>    </span><span class="hs-comment">-- canonical equalities are used for rewriting. We'll only get caught by</span><span>
</span><a name="line-1826"></a><span>    </span><span class="hs-comment">-- non-canonical -- that is, irreducible -- equalities.</span><span>
</span><a name="line-1827"></a><span>    </span><span class="hs-identifier">all_relevant_givens</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-1828"></a><span>    </span><a name="local-1628203892"><a href="#local-1628203892"><span class="hs-identifier">all_relevant_givens</span></a></a><span>
</span><a name="line-1829"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628203895"><a href="#local-1628203895"><span class="hs-identifier">clas</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getClassPredTys_maybe"><span class="hs-identifier hs-var">getClassPredTys_maybe</span></a><span> </span><a href="#local-1628203890"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-1830"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#findDictsByClass"><span class="hs-identifier hs-var">findDictsByClass</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_dicts</span><span> </span><a href="#local-1628203891"><span class="hs-identifier hs-var">inert_cans</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203895"><span class="hs-identifier hs-var">clas</span></a><span>
</span><a name="line-1831"></a><span>        </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">inert_irreds</span><span> </span><a href="#local-1628203891"><span class="hs-identifier hs-var">inert_cans</span></a><span>
</span><a name="line-1832"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1833"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">inert_irreds</span><span> </span><a href="#local-1628203891"><span class="hs-identifier hs-var">inert_cans</span></a><span>
</span><a name="line-1834"></a><span>
</span><a name="line-1835"></a><span>    </span><span class="hs-identifier">matchable_given</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1836"></a><span>    </span><a name="local-1628203893"><a href="#local-1628203893"><span class="hs-identifier">matchable_given</span></a></a><span> </span><a name="local-1628203896"><a href="#local-1628203896"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-1837"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier hs-var">CtGiven</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203898"><a href="#local-1628203898"><span class="hs-identifier">loc_g</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628203897"><span class="hs-identifier hs-var">ctev</span></a><span>
</span><a name="line-1838"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#tcUnifyTys"><span class="hs-identifier hs-var">tcUnifyTys</span></a><span> </span><a href="#local-1628203894"><span class="hs-identifier hs-var">bind_meta_tv</span></a><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a><span> </span><a href="#local-1628203897"><span class="hs-identifier hs-var">ctev</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1628203890"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">]</span><span>
</span><a name="line-1839"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#prohibitedSuperClassSolve"><span class="hs-identifier hs-var">prohibitedSuperClassSolve</span></a><span> </span><a href="#local-1628203898"><span class="hs-identifier hs-var">loc_g</span></a><span> </span><a href="#local-1628203889"><span class="hs-identifier hs-var">loc_w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1840"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1841"></a><span>
</span><a name="line-1842"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1843"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1844"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1845"></a><span>        </span><a name="local-1628203897"><a href="#local-1628203897"><span class="hs-identifier">ctev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><a href="#local-1628203896"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1846"></a><span>
</span><a name="line-1847"></a><span>    </span><span class="hs-identifier">bind_meta_tv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#BindFlag"><span class="hs-identifier hs-type">BindFlag</span></a><span>
</span><a name="line-1848"></a><span>    </span><span class="hs-comment">-- Any meta tyvar may be unified later, so we treat it as</span><span>
</span><a name="line-1849"></a><span>    </span><span class="hs-comment">-- bindable when unifying with givens. That ensures that we</span><span>
</span><a name="line-1850"></a><span>    </span><span class="hs-comment">-- conservatively assume that a meta tyvar might get unified with</span><span>
</span><a name="line-1851"></a><span>    </span><span class="hs-comment">-- something that matches the 'given', until demonstrated</span><span>
</span><a name="line-1852"></a><span>    </span><span class="hs-comment">-- otherwise.</span><span>
</span><a name="line-1853"></a><span>    </span><a name="local-1628203894"><a href="#local-1628203894"><span class="hs-identifier">bind_meta_tv</span></a></a><span> </span><a name="local-1628203899"><a href="#local-1628203899"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a><span> </span><a href="#local-1628203899"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a><span>
</span><a name="line-1854"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#Skolem"><span class="hs-identifier hs-var">Skolem</span></a><span>
</span><a name="line-1855"></a><span>
</span><a name="line-1856"></a><span class="hs-identifier">prohibitedSuperClassSolve</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1857"></a><span class="hs-comment">-- See Note [Solving superclass constraints] in TcInstDcls</span><span>
</span><a name="line-1858"></a><a name="prohibitedSuperClassSolve"><a href="TcSMonad.html#prohibitedSuperClassSolve"><span class="hs-identifier">prohibitedSuperClassSolve</span></a></a><span> </span><a name="local-1628203900"><a href="#local-1628203900"><span class="hs-identifier">from_loc</span></a></a><span> </span><a name="local-1628203901"><a href="#local-1628203901"><span class="hs-identifier">solve_loc</span></a></a><span>
</span><a name="line-1859"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#GivenOrigin"><span class="hs-identifier hs-var">GivenOrigin</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#InstSC"><span class="hs-identifier hs-var">InstSC</span></a><span> </span><a name="local-1628203902"><a href="#local-1628203902"><span class="hs-identifier">given_size</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnTypes.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a><span> </span><a href="#local-1628203900"><span class="hs-identifier hs-var">from_loc</span></a><span>
</span><a name="line-1860"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ScOrigin"><span class="hs-identifier hs-var">ScOrigin</span></a><span> </span><a name="local-1628203903"><a href="#local-1628203903"><span class="hs-identifier">wanted_size</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnTypes.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a><span> </span><a href="#local-1628203901"><span class="hs-identifier hs-var">solve_loc</span></a><span>
</span><a name="line-1861"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203902"><span class="hs-identifier hs-var">given_size</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-1628203903"><span class="hs-identifier hs-var">wanted_size</span></a><span>
</span><a name="line-1862"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1863"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1864"></a><span>
</span><a name="line-1865"></a><span class="hs-comment">{- Note [Unsolved Derived equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In getUnsolvedInerts, we return a derived equality from the model
for two possible reasons:

  * Because it is a candidate for floating out of this implication.
    We only float equalities with a meta-tyvar on the left, so we only
    pull those out here.

  * If we are only solving derived constraints (i.e. tcs_need_derived
    is true; see Note [Solving for Derived constraints]), then we
    those Derived constraints are effectively unsolved, and we need
    them!

Note [When does an implication have given equalities?]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider an implication
   beta =&gt; alpha ~ Int
where beta is a unification variable that has already been unified
to () in an outer scope.  Then we can float the (alpha ~ Int) out
just fine. So when deciding whether the givens contain an equality,
we should canonicalise first, rather than just looking at the original
givens (Trac #8644).

So we simply look at the inert, canonical Givens and see if there are
any equalities among them, the calculation of has_given_eqs.  There
are some wrinkles:

 * We must know which ones are bound in *this* implication and which
   are bound further out.  We can find that out from the TcLevel
   of the Given, which is itself recorded in the tcl_tclvl field
   of the TcLclEnv stored in the Given (ev_given_here).

   What about interactions between inner and outer givens?
      - Outer given is rewritten by an inner given, then there must
        have been an inner given equality, hence the &#8220;given-eq&#8221; flag
        will be true anyway.

      - Inner given rewritten by outer, retains its level (ie. The inner one)

 * We must take account of *potential* equalities, like the one above:
      beta =&gt; ...blah...
   If we still don't know what beta is, we conservatively treat it as potentially
   becoming an equality. Hence including 'irreds' in the calculation or has_given_eqs.

 * When flattening givens, we generate Given equalities like
     &lt;F [a]&gt; : F [a] ~ f,
   with Refl evidence, and we *don't* want those to count as an equality
   in the givens!  After all, the entire flattening business is just an
   internal matter, and the evidence does not mention any of the 'givens'
   of this implication.  So we do not treat inert_funeqs as a 'given equality'.

 * See Note [Let-bound skolems] for another wrinkle

 * We do *not* need to worry about representational equalities, because
   these do not affect the ability to float constraints.

Note [Let-bound skolems]
~~~~~~~~~~~~~~~~~~~~~~~~
If   * the inert set contains a canonical Given CTyEqCan (a ~ ty)
and  * 'a' is a skolem bound in this very implication, b

then:
a) The Given is pretty much a let-binding, like
      f :: (a ~ b-&gt;c) =&gt; a -&gt; a
   Here the equality constraint is like saying
      let a = b-&gt;c in ...
   It is not adding any new, local equality  information,
   and hence can be ignored by has_given_eqs

b) 'a' will have been completely substituted out in the inert set,
   so we can safely discard it.  Notably, it doesn't need to be
   returned as part of 'fsks'

For an example, see Trac #9211.
-}</span><span>
</span><a name="line-1941"></a><span>
</span><a name="line-1942"></a><span class="hs-identifier">removeInertCts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span>
</span><a name="line-1943"></a><span class="hs-comment">-- ^ Remove inert constraints from the 'InertCans', for use when a</span><span>
</span><a name="line-1944"></a><span class="hs-comment">-- typechecker plugin wishes to discard a given.</span><span>
</span><a name="line-1945"></a><a name="removeInertCts"><a href="TcSMonad.html#removeInertCts"><span class="hs-identifier">removeInertCts</span></a></a><span> </span><a name="local-1628203904"><a href="#local-1628203904"><span class="hs-identifier">cts</span></a></a><span> </span><a name="local-1628203905"><a href="#local-1628203905"><span class="hs-identifier">icans</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a><span> </span><a href="TcSMonad.html#removeInertCt"><span class="hs-identifier hs-var">removeInertCt</span></a><span> </span><a href="#local-1628203905"><span class="hs-identifier hs-var">icans</span></a><span> </span><a href="#local-1628203904"><span class="hs-identifier hs-var">cts</span></a><span>
</span><a name="line-1946"></a><span>
</span><a name="line-1947"></a><span class="hs-identifier">removeInertCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span>
</span><a name="line-1948"></a><a name="removeInertCt"><a href="TcSMonad.html#removeInertCt"><span class="hs-identifier">removeInertCt</span></a></a><span> </span><a name="local-1628203906"><a href="#local-1628203906"><span class="hs-identifier">is</span></a></a><span> </span><a name="local-1628203907"><a href="#local-1628203907"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1949"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628203907"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1950"></a><span>
</span><a name="line-1951"></a><span>    </span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_class</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203908"><a href="#local-1628203908"><span class="hs-identifier">cl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203909"><a href="#local-1628203909"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1952"></a><span>      </span><a href="#local-1628203906"><span class="hs-identifier hs-var">is</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#delDict"><span class="hs-identifier hs-var">delDict</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_dicts</span><span> </span><a href="#local-1628203906"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203908"><span class="hs-identifier hs-var">cl</span></a><span> </span><a href="#local-1628203909"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1953"></a><span>
</span><a name="line-1954"></a><span>    </span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_fun</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203910"><a href="#local-1628203910"><span class="hs-identifier">tf</span></a></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203911"><a href="#local-1628203911"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1955"></a><span>      </span><a href="#local-1628203906"><span class="hs-identifier hs-var">is</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#delFunEq"><span class="hs-identifier hs-var">delFunEq</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_funeqs</span><span> </span><a href="#local-1628203906"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203910"><span class="hs-identifier hs-var">tf</span></a><span> </span><a href="#local-1628203911"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1956"></a><span>
</span><a name="line-1957"></a><span>    </span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203912"><a href="#local-1628203912"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier">cc_rhs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203913"><a href="#local-1628203913"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1958"></a><span>      </span><a href="#local-1628203906"><span class="hs-identifier hs-var">is</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_eqs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#delTyEq"><span class="hs-identifier hs-var">delTyEq</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_eqs</span><span> </span><a href="#local-1628203906"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203912"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1628203913"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1959"></a><span>
</span><a name="line-1960"></a><span>    </span><a href="TcRnTypes.html#CIrredEvCan"><span class="hs-identifier hs-var">CIrredEvCan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;removeInertCt: CIrredEvCan&quot;</span><span>
</span><a name="line-1961"></a><span>    </span><a href="TcRnTypes.html#CNonCanonical"><span class="hs-identifier hs-var">CNonCanonical</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;removeInertCt: CNonCanonical&quot;</span><span>
</span><a name="line-1962"></a><span>    </span><a href="TcRnTypes.html#CHoleCan"><span class="hs-identifier hs-var">CHoleCan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;removeInertCt: CHoleCan&quot;</span><span>
</span><a name="line-1963"></a><span>
</span><a name="line-1964"></a><span>
</span><a name="line-1965"></a><span class="hs-identifier">lookupFlatCache</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1966"></a><a name="lookupFlatCache"><a href="TcSMonad.html#lookupFlatCache"><span class="hs-identifier">lookupFlatCache</span></a></a><span> </span><a name="local-1628203914"><a href="#local-1628203914"><span class="hs-identifier">fam_tc</span></a></a><span> </span><a name="local-1628203915"><a href="#local-1628203915"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1967"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#IS"><span class="hs-identifier hs-var">IS</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_flat_cache</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203923"><a href="#local-1628203923"><span class="hs-identifier">flat_cache</span></a></a><span>
</span><a name="line-1968"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_cans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_funeqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203924"><a href="#local-1628203924"><span class="hs-identifier">inert_funeqs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a><span>
</span><a name="line-1969"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Maybes.html#firstJusts"><span class="hs-identifier hs-var">firstJusts</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628203916"><span class="hs-identifier hs-var">lookup_inerts</span></a><span> </span><a href="#local-1628203924"><span class="hs-identifier hs-var">inert_funeqs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1970"></a><span>                             </span><a href="#local-1628203917"><span class="hs-identifier hs-var">lookup_flats</span></a><span> </span><a href="#local-1628203923"><span class="hs-identifier hs-var">flat_cache</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1971"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1972"></a><span>    </span><a name="local-1628203916"><a href="#local-1628203916"><span class="hs-identifier">lookup_inerts</span></a></a><span> </span><a name="local-1628203918"><a href="#local-1628203918"><span class="hs-identifier">inert_funeqs</span></a></a><span>
</span><a name="line-1973"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203919"><a href="#local-1628203919"><span class="hs-identifier">ctev</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_fsk</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203920"><a href="#local-1628203920"><span class="hs-identifier">fsk</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203921"><a href="#local-1628203921"><span class="hs-identifier">xis</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1974"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#findFunEq"><span class="hs-identifier hs-var">findFunEq</span></a><span> </span><a href="#local-1628203918"><span class="hs-identifier hs-var">inert_funeqs</span></a><span> </span><a href="#local-1628203914"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><a href="#local-1628203915"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1975"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-1628203915"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqTypes"><span class="hs-identifier hs-var">eqTypes</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628203921"><span class="hs-identifier hs-var">xis</span></a><span>   </span><span class="hs-comment">-- the lookup might find a near-match; see</span><span>
</span><a name="line-1976"></a><span>                            </span><span class="hs-comment">-- Note [Use loose types in inert set]</span><span>
</span><a name="line-1977"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvCoercion"><span class="hs-identifier hs-var">ctEvCoercion</span></a><span> </span><a href="#local-1628203919"><span class="hs-identifier hs-var">ctev</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1628203920"><span class="hs-identifier hs-var">fsk</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span> </span><a href="#local-1628203919"><span class="hs-identifier hs-var">ctev</span></a><span class="hs-special">)</span><span>
</span><a name="line-1978"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1979"></a><span>
</span><a name="line-1980"></a><span>    </span><a name="local-1628203917"><a href="#local-1628203917"><span class="hs-identifier">lookup_flats</span></a></a><span> </span><a name="local-1628203922"><a href="#local-1628203922"><span class="hs-identifier">flat_cache</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#findExactFunEq"><span class="hs-identifier hs-var">findExactFunEq</span></a><span> </span><a href="#local-1628203922"><span class="hs-identifier hs-var">flat_cache</span></a><span> </span><a href="#local-1628203914"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><a href="#local-1628203915"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1981"></a><span>
</span><a name="line-1982"></a><span>
</span><a name="line-1983"></a><span class="hs-identifier">lookupInInerts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">)</span><span>
</span><a name="line-1984"></a><span class="hs-comment">-- Is this exact predicate type cached in the solved or canonicals of the InertSet?</span><span>
</span><a name="line-1985"></a><a name="lookupInInerts"><a href="TcSMonad.html#lookupInInerts"><span class="hs-identifier">lookupInInerts</span></a></a><span> </span><a name="local-1628203925"><a href="#local-1628203925"><span class="hs-identifier">pty</span></a></a><span>
</span><a name="line-1986"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#ClassPred"><span class="hs-identifier hs-var">ClassPred</span></a><span> </span><a name="local-1628203926"><a href="#local-1628203926"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628203927"><a href="#local-1628203927"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a><span> </span><a href="#local-1628203925"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-1987"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203928"><a href="#local-1628203928"><span class="hs-identifier">inerts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a><span>
</span><a name="line-1988"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#lookupSolvedDict"><span class="hs-identifier hs-var">lookupSolvedDict</span></a><span> </span><a href="#local-1628203928"><span class="hs-identifier hs-var">inerts</span></a><span> </span><a href="#local-1628203926"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628203927"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mplus"><span class="hs-identifier hs-var">mplus</span></a><span class="hs-special">`</span><span>
</span><a name="line-1989"></a><span>                 </span><a href="TcSMonad.html#lookupInertDict"><span class="hs-identifier hs-var">lookupInertDict</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_cans</span><span> </span><a href="#local-1628203928"><span class="hs-identifier hs-var">inerts</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203926"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628203927"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1990"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-comment">-- NB: No caching for equalities, IPs, holes, or errors</span><span>
</span><a name="line-1991"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1992"></a><span>
</span><a name="line-1993"></a><span class="hs-comment">-- | Look up a dictionary inert. NB: the returned 'CtEvidence' might not</span><span>
</span><a name="line-1994"></a><span class="hs-comment">-- match the input exactly. Note [Use loose types in inert set].</span><span>
</span><a name="line-1995"></a><span class="hs-identifier">lookupInertDict</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-1996"></a><a name="lookupInertDict"><a href="TcSMonad.html#lookupInertDict"><span class="hs-identifier">lookupInertDict</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203929"><a href="#local-1628203929"><span class="hs-identifier">dicts</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628203930"><a href="#local-1628203930"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628203931"><a href="#local-1628203931"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1997"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcSMonad.html#findDict"><span class="hs-identifier hs-var">findDict</span></a><span> </span><a href="#local-1628203929"><span class="hs-identifier hs-var">dicts</span></a><span> </span><a href="#local-1628203930"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628203931"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1998"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628203932"><a href="#local-1628203932"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-1628203932"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1999"></a><span>      </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-2000"></a><span>
</span><a name="line-2001"></a><span class="hs-comment">-- | Look up a solved inert. NB: the returned 'CtEvidence' might not</span><span>
</span><a name="line-2002"></a><span class="hs-comment">-- match the input exactly. See Note [Use loose types in inert set].</span><span>
</span><a name="line-2003"></a><span class="hs-identifier">lookupSolvedDict</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-2004"></a><span class="hs-comment">-- Returns just if exactly this predicate type exists in the solved.</span><span>
</span><a name="line-2005"></a><a name="lookupSolvedDict"><a href="TcSMonad.html#lookupSolvedDict"><span class="hs-identifier">lookupSolvedDict</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#IS"><span class="hs-identifier hs-var">IS</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_solved_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203933"><a href="#local-1628203933"><span class="hs-identifier">solved</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628203934"><a href="#local-1628203934"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628203935"><a href="#local-1628203935"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2006"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcSMonad.html#findDict"><span class="hs-identifier hs-var">findDict</span></a><span> </span><a href="#local-1628203933"><span class="hs-identifier hs-var">solved</span></a><span> </span><a href="#local-1628203934"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628203935"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2007"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628203936"><a href="#local-1628203936"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628203936"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-2008"></a><span>      </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-2009"></a><span>
</span><a name="line-2010"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   Irreds
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-2015"></a><span>
</span><a name="line-2016"></a><span class="hs-identifier">foldIrreds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203579"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203579"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203579"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203579"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-2017"></a><a name="foldIrreds"><a href="TcSMonad.html#foldIrreds"><span class="hs-identifier">foldIrreds</span></a></a><span> </span><a name="local-1628203937"><a href="#local-1628203937"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1628203938"><a href="#local-1628203938"><span class="hs-identifier">irreds</span></a></a><span> </span><a name="local-1628203939"><a href="#local-1628203939"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#foldrBag"><span class="hs-identifier hs-var">foldrBag</span></a><span> </span><a href="#local-1628203937"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1628203939"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-1628203938"><span class="hs-identifier hs-var">irreds</span></a><span>
</span><a name="line-2018"></a><span>
</span><a name="line-2019"></a><span>
</span><a name="line-2020"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   Type equalities
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-2025"></a><span>
</span><a name="line-2026"></a><span class="hs-keyword">type</span><span> </span><a name="EqualCtList"><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier">EqualCtList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>
</span><a name="line-2027"></a><span>
</span><a name="line-2028"></a><span class="hs-comment">{- Note [EqualCtList invariants]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    * All are equalities
    * All these equalities have the same LHS
    * The list is never empty
    * No element of the list can rewrite any other

 From the fourth invariant it follows that the list is
   - A single Given, or
   - Any number of Wanteds and/or Deriveds
-}</span><span>
</span><a name="line-2039"></a><span>
</span><a name="line-2040"></a><span class="hs-identifier">addTyEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span>
</span><a name="line-2041"></a><a name="addTyEq"><a href="TcSMonad.html#addTyEq"><span class="hs-identifier">addTyEq</span></a></a><span> </span><a name="local-1628203940"><a href="#local-1628203940"><span class="hs-identifier">old_list</span></a></a><span> </span><a name="local-1628203941"><a href="#local-1628203941"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1628203942"><a href="#local-1628203942"><span class="hs-identifier">it</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv_C"><span class="hs-identifier hs-var">extendVarEnv_C</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628203943"><a href="#local-1628203943"><span class="hs-identifier">old_eqs</span></a></a><span> </span><a name="local-1628203944"><a href="#local-1628203944"><span class="hs-identifier">_new_eqs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203942"><span class="hs-identifier hs-var">it</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628203943"><span class="hs-identifier hs-var">old_eqs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2042"></a><span>                                        </span><a href="#local-1628203940"><span class="hs-identifier hs-var">old_list</span></a><span> </span><a href="#local-1628203941"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628203942"><span class="hs-identifier hs-var">it</span></a><span class="hs-special">]</span><span>
</span><a name="line-2043"></a><span>
</span><a name="line-2044"></a><span class="hs-identifier">foldTyEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203578"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203578"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203578"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203578"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-2045"></a><a name="foldTyEqs"><a href="TcSMonad.html#foldTyEqs"><span class="hs-identifier">foldTyEqs</span></a></a><span> </span><a name="local-1628203945"><a href="#local-1628203945"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1628203946"><a href="#local-1628203946"><span class="hs-identifier">eqs</span></a></a><span> </span><a name="local-1628203947"><a href="#local-1628203947"><span class="hs-identifier">z</span></a></a><span>
</span><a name="line-2046"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#foldVarEnv"><span class="hs-identifier hs-var">foldVarEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628203948"><a href="#local-1628203948"><span class="hs-identifier">cts</span></a></a><span> </span><a name="local-1628203949"><a href="#local-1628203949"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><a href="#local-1628203945"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1628203949"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-1628203948"><span class="hs-identifier hs-var">cts</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203947"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-1628203946"><span class="hs-identifier hs-var">eqs</span></a><span>
</span><a name="line-2047"></a><span>
</span><a name="line-2048"></a><span class="hs-identifier">findTyEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span>
</span><a name="line-2049"></a><a name="findTyEqs"><a href="TcSMonad.html#findTyEqs"><span class="hs-identifier">findTyEqs</span></a></a><span> </span><a name="local-1628203950"><a href="#local-1628203950"><span class="hs-identifier">icans</span></a></a><span> </span><a name="local-1628203951"><a href="#local-1628203951"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inert_eqs</span><span> </span><a href="#local-1628203950"><span class="hs-identifier hs-var">icans</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203951"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2050"></a><span>
</span><a name="line-2051"></a><span class="hs-identifier">delTyEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#TyVarEnv"><span class="hs-identifier hs-type">TyVarEnv</span></a><span> </span><a href="TcSMonad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a><span>
</span><a name="line-2052"></a><a name="delTyEq"><a href="TcSMonad.html#delTyEq"><span class="hs-identifier">delTyEq</span></a></a><span> </span><a name="local-1628203952"><a href="#local-1628203952"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628203953"><a href="#local-1628203953"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1628203954"><a href="#local-1628203954"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#modifyVarEnv"><span class="hs-identifier hs-var">modifyVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1628203955"><span class="hs-identifier hs-var">isThisOne</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628203952"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628203953"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2053"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1628203955"><a href="#local-1628203955"><span class="hs-identifier">isThisOne</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203956"><a href="#local-1628203956"><span class="hs-identifier">t1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span> </span><a href="#local-1628203954"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-1628203956"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-2054"></a><span>        </span><span class="hs-identifier">isThisOne</span><span> </span><span class="hs-identifier">_</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2055"></a><span>
</span><a name="line-2056"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   TcAppMap
*                                                                      *
************************************************************************

Note [Use loose types in inert set]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Say we know (Eq (a |&gt; c1)) and we need (Eq (a |&gt; c2)). One is clearly
solvable from the other. So, we do lookup in the inert set using
loose types, which omit the kind-check.

We must be careful when using the result of a lookup because it may
not match the requsted info exactly!

-}</span><span>
</span><a name="line-2072"></a><span>
</span><a name="line-2073"></a><span class="hs-keyword">type</span><span> </span><a name="TcAppMap"><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier">TcAppMap</span></a></a><span> </span><a name="local-1628203533"><a href="#local-1628203533"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="TrieMap.html#LooseTypeMap"><span class="hs-identifier hs-type">LooseTypeMap</span></a><span> </span><a href="#local-1628203533"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-2074"></a><span>    </span><span class="hs-comment">-- Indexed by tycon then the arg types, using &quot;loose&quot; matching, where</span><span>
</span><a name="line-2075"></a><span>    </span><span class="hs-comment">-- we don't require kind equality. This allows, for example, (a |&gt; co)</span><span>
</span><a name="line-2076"></a><span>    </span><span class="hs-comment">-- to match (a).</span><span>
</span><a name="line-2077"></a><span>    </span><span class="hs-comment">-- See Note [Use loose types in inert set]</span><span>
</span><a name="line-2078"></a><span>    </span><span class="hs-comment">-- Used for types and classes; hence UniqFM</span><span>
</span><a name="line-2079"></a><span>
</span><a name="line-2080"></a><span class="hs-identifier">isEmptyTcAppMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203577"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2081"></a><a name="isEmptyTcAppMap"><a href="TcSMonad.html#isEmptyTcAppMap"><span class="hs-identifier">isEmptyTcAppMap</span></a></a><span> </span><a name="local-1628203957"><a href="#local-1628203957"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#isNullUFM"><span class="hs-identifier hs-var">isNullUFM</span></a><span> </span><a href="#local-1628203957"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-2082"></a><span>
</span><a name="line-2083"></a><span class="hs-identifier">emptyTcAppMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203576"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2084"></a><a name="emptyTcAppMap"><a href="TcSMonad.html#emptyTcAppMap"><span class="hs-identifier">emptyTcAppMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span>
</span><a name="line-2085"></a><span>
</span><a name="line-2086"></a><span class="hs-identifier">findTcApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203575"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="#local-1628203575"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2087"></a><a name="findTcApp"><a href="TcSMonad.html#findTcApp"><span class="hs-identifier">findTcApp</span></a></a><span> </span><a name="local-1628203958"><a href="#local-1628203958"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628203959"><a href="#local-1628203959"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-1628203960"><a href="#local-1628203960"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628203961"><a href="#local-1628203961"><span class="hs-identifier">tys_map</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span> </span><a href="#local-1628203958"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628203959"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-2088"></a><span>                       </span><span class="hs-special">;</span><span> </span><a href="TrieMap.html#lookupTM"><span class="hs-identifier hs-var">lookupTM</span></a><span> </span><a href="#local-1628203960"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628203961"><span class="hs-identifier hs-var">tys_map</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2089"></a><span>
</span><a name="line-2090"></a><span class="hs-identifier">delTcApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203574"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203574"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2091"></a><a name="delTcApp"><a href="TcSMonad.html#delTcApp"><span class="hs-identifier">delTcApp</span></a></a><span> </span><a name="local-1628203962"><a href="#local-1628203962"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628203963"><a href="#local-1628203963"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628203964"><a href="#local-1628203964"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#adjustUFM"><span class="hs-identifier hs-var">adjustUFM</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#deleteTM"><span class="hs-identifier hs-var">deleteTM</span></a><span> </span><a href="#local-1628203964"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203962"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628203963"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-2092"></a><span>
</span><a name="line-2093"></a><span class="hs-identifier">insertTcApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203573"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203573"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203573"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2094"></a><a name="insertTcApp"><a href="TcSMonad.html#insertTcApp"><span class="hs-identifier">insertTcApp</span></a></a><span> </span><a name="local-1628203965"><a href="#local-1628203965"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628203966"><a href="#local-1628203966"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628203967"><a href="#local-1628203967"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-1628203968"><a href="#local-1628203968"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#alterUFM"><span class="hs-identifier hs-var">alterUFM</span></a><span> </span><a href="#local-1628203969"><span class="hs-identifier hs-var">alter_tm</span></a><span> </span><a href="#local-1628203965"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628203966"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-2095"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2096"></a><span>    </span><a name="local-1628203969"><a href="#local-1628203969"><span class="hs-identifier">alter_tm</span></a></a><span> </span><a name="local-1628203970"><a href="#local-1628203970"><span class="hs-identifier">mb_tm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#insertTM"><span class="hs-identifier hs-var">insertTM</span></a><span> </span><a href="#local-1628203967"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628203968"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203970"><span class="hs-identifier hs-var">mb_tm</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><a href="TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2097"></a><span>
</span><a name="line-2098"></a><span class="hs-comment">-- mapTcApp :: (a-&gt;b) -&gt; TcAppMap a -&gt; TcAppMap b</span><span>
</span><a name="line-2099"></a><span class="hs-comment">-- mapTcApp f = mapUFM (mapTM f)</span><span>
</span><a name="line-2100"></a><span>
</span><a name="line-2101"></a><span class="hs-identifier">filterTcAppMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-2102"></a><a name="filterTcAppMap"><a href="TcSMonad.html#filterTcAppMap"><span class="hs-identifier">filterTcAppMap</span></a></a><span> </span><a name="local-1628203971"><a href="#local-1628203971"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628203972"><a href="#local-1628203972"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-2103"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#mapUFM"><span class="hs-identifier hs-var">mapUFM</span></a><span> </span><a href="#local-1628203973"><span class="hs-identifier hs-var">do_tm</span></a><span> </span><a href="#local-1628203972"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-2104"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2105"></a><span>    </span><a name="local-1628203973"><a href="#local-1628203973"><span class="hs-identifier">do_tm</span></a></a><span> </span><a name="local-1628203975"><a href="#local-1628203975"><span class="hs-identifier">tm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a><span> </span><a href="#local-1628203974"><span class="hs-identifier hs-var">insert_mb</span></a><span> </span><a href="#local-1628203975"><span class="hs-identifier hs-var">tm</span></a><span> </span><a href="TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a><span>
</span><a name="line-2106"></a><span>    </span><a name="local-1628203974"><a href="#local-1628203974"><span class="hs-identifier">insert_mb</span></a></a><span> </span><a name="local-1628203976"><a href="#local-1628203976"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1628203977"><a href="#local-1628203977"><span class="hs-identifier">tm</span></a></a><span>
</span><a name="line-2107"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628203971"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628203976"><span class="hs-identifier hs-var">ct</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#insertTM"><span class="hs-identifier hs-var">insertTM</span></a><span> </span><a href="#local-1628203978"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628203976"><span class="hs-identifier hs-var">ct</span></a><span> </span><a href="#local-1628203977"><span class="hs-identifier hs-var">tm</span></a><span>
</span><a name="line-2108"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628203977"><span class="hs-identifier hs-var">tm</span></a><span>
</span><a name="line-2109"></a><span>       </span><span class="hs-keyword">where</span><span>
</span><a name="line-2110"></a><span>         </span><a name="local-1628203978"><a href="#local-1628203978"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628203976"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2111"></a><span>                </span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203979"><a href="#local-1628203979"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203979"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2112"></a><span>                </span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628203980"><a href="#local-1628203980"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203980"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2113"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;filterTcAppMap&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628203976"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-2114"></a><span>
</span><a name="line-2115"></a><span class="hs-identifier">tcAppMapToBag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203572"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="#local-1628203572"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2116"></a><a name="tcAppMapToBag"><a href="TcSMonad.html#tcAppMapToBag"><span class="hs-identifier">tcAppMapToBag</span></a></a><span> </span><a name="local-1628203981"><a href="#local-1628203981"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a><span> </span><a href="Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a><span> </span><a href="#local-1628203981"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span>
</span><a name="line-2117"></a><span>
</span><a name="line-2118"></a><span class="hs-identifier">foldTcAppMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1628203570"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203571"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203571"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203570"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203571"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203571"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-2119"></a><a name="foldTcAppMap"><a href="TcSMonad.html#foldTcAppMap"><span class="hs-identifier">foldTcAppMap</span></a></a><span> </span><a name="local-1628203982"><a href="#local-1628203982"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1628203983"><a href="#local-1628203983"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628203984"><a href="#local-1628203984"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#foldUFM"><span class="hs-identifier hs-var">foldUFM</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a><span> </span><a href="#local-1628203982"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203984"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-1628203983"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-2120"></a><span>
</span><a name="line-2121"></a><span>
</span><a name="line-2122"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   DictMap
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-2127"></a><span>
</span><a name="line-2128"></a><span class="hs-keyword">type</span><span> </span><a name="DictMap"><a href="TcSMonad.html#DictMap"><span class="hs-identifier">DictMap</span></a></a><span> </span><a name="local-1628203532"><a href="#local-1628203532"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203532"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2129"></a><span>
</span><a name="line-2130"></a><span class="hs-identifier">emptyDictMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="#local-1628203569"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2131"></a><a name="emptyDictMap"><a href="TcSMonad.html#emptyDictMap"><span class="hs-identifier">emptyDictMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#emptyTcAppMap"><span class="hs-identifier hs-var">emptyTcAppMap</span></a><span>
</span><a name="line-2132"></a><span>
</span><a name="line-2133"></a><span class="hs-comment">-- sizeDictMap :: DictMap a -&gt; Int</span><span>
</span><a name="line-2134"></a><span class="hs-comment">-- sizeDictMap m = foldDicts (\ _ x -&gt; x+1) m 0</span><span>
</span><a name="line-2135"></a><span>
</span><a name="line-2136"></a><span class="hs-identifier">findDict</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="#local-1628203568"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="#local-1628203568"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2137"></a><a name="findDict"><a href="TcSMonad.html#findDict"><span class="hs-identifier">findDict</span></a></a><span> </span><a name="local-1628203985"><a href="#local-1628203985"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628203986"><a href="#local-1628203986"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628203987"><a href="#local-1628203987"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#findTcApp"><span class="hs-identifier hs-var">findTcApp</span></a><span> </span><a href="#local-1628203985"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-1628203986"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203987"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2138"></a><span>
</span><a name="line-2139"></a><span class="hs-identifier">findDictsByClass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="#local-1628203567"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="#local-1628203567"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2140"></a><a name="findDictsByClass"><a href="TcSMonad.html#findDictsByClass"><span class="hs-identifier">findDictsByClass</span></a></a><span> </span><a name="local-1628203988"><a href="#local-1628203988"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628203989"><a href="#local-1628203989"><span class="hs-identifier">cls</span></a></a><span>
</span><a name="line-2141"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628203990"><a href="#local-1628203990"><span class="hs-identifier">tm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span> </span><a href="#local-1628203988"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628203989"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a><span> </span><a href="Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a><span> </span><a href="#local-1628203990"><span class="hs-identifier hs-var">tm</span></a><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span>
</span><a name="line-2142"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span>
</span><a name="line-2143"></a><span>
</span><a name="line-2144"></a><span class="hs-identifier">delDict</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="#local-1628203566"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="#local-1628203566"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2145"></a><a name="delDict"><a href="TcSMonad.html#delDict"><span class="hs-identifier">delDict</span></a></a><span> </span><a name="local-1628203991"><a href="#local-1628203991"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628203992"><a href="#local-1628203992"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628203993"><a href="#local-1628203993"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#delTcApp"><span class="hs-identifier hs-var">delTcApp</span></a><span> </span><a href="#local-1628203991"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-1628203992"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203993"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2146"></a><span>
</span><a name="line-2147"></a><span class="hs-identifier">addDict</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="#local-1628203565"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203565"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="#local-1628203565"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2148"></a><a name="addDict"><a href="TcSMonad.html#addDict"><span class="hs-identifier">addDict</span></a></a><span> </span><a name="local-1628203994"><a href="#local-1628203994"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628203995"><a href="#local-1628203995"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628203996"><a href="#local-1628203996"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-1628203997"><a href="#local-1628203997"><span class="hs-identifier">item</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#insertTcApp"><span class="hs-identifier hs-var">insertTcApp</span></a><span> </span><a href="#local-1628203994"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-1628203995"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628203996"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628203997"><span class="hs-identifier hs-var">item</span></a><span>
</span><a name="line-2149"></a><span>
</span><a name="line-2150"></a><span class="hs-identifier">addDictsByClass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-2151"></a><a name="addDictsByClass"><a href="TcSMonad.html#addDictsByClass"><span class="hs-identifier">addDictsByClass</span></a></a><span> </span><a name="local-1628203998"><a href="#local-1628203998"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628203999"><a href="#local-1628203999"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-1628204000"><a href="#local-1628204000"><span class="hs-identifier">items</span></a></a><span>
</span><a name="line-2152"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#addToUFM"><span class="hs-identifier hs-var">addToUFM</span></a><span> </span><a href="#local-1628203998"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628203999"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#foldrBag"><span class="hs-identifier hs-var">foldrBag</span></a><span> </span><a href="#local-1628204001"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a><span> </span><a href="#local-1628204000"><span class="hs-identifier hs-var">items</span></a><span class="hs-special">)</span><span>
</span><a name="line-2153"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2154"></a><span>    </span><a name="local-1628204001"><a href="#local-1628204001"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-1628204002"><a href="#local-1628204002"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204003"><a href="#local-1628204003"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628204004"><a href="#local-1628204004"><span class="hs-identifier">tm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#insertTM"><span class="hs-identifier hs-var">insertTM</span></a><span> </span><a href="#local-1628204003"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628204002"><span class="hs-identifier hs-var">ct</span></a><span> </span><a href="#local-1628204004"><span class="hs-identifier hs-var">tm</span></a><span>
</span><a name="line-2155"></a><span>    </span><span class="hs-identifier">add</span><span> </span><a name="local-1628204005"><a href="#local-1628204005"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;addDictsByClass&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204005"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-2156"></a><span>
</span><a name="line-2157"></a><span class="hs-identifier">filterDicts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-2158"></a><a name="filterDicts"><a href="TcSMonad.html#filterDicts"><span class="hs-identifier">filterDicts</span></a></a><span> </span><a name="local-1628204006"><a href="#local-1628204006"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628204007"><a href="#local-1628204007"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#filterTcAppMap"><span class="hs-identifier hs-var">filterTcAppMap</span></a><span> </span><a href="#local-1628204006"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628204007"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-2159"></a><span>
</span><a name="line-2160"></a><span class="hs-identifier">partitionDicts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-2161"></a><a name="partitionDicts"><a href="TcSMonad.html#partitionDicts"><span class="hs-identifier">partitionDicts</span></a></a><span> </span><a name="local-1628204008"><a href="#local-1628204008"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628204009"><a href="#local-1628204009"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a><span> </span><a href="#local-1628204010"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1628204009"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#emptyDicts"><span class="hs-identifier hs-var">emptyDicts</span></a><span class="hs-special">)</span><span>
</span><a name="line-2162"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2163"></a><span>    </span><a name="local-1628204010"><a href="#local-1628204010"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1628204012"><a href="#local-1628204012"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628204013"><a href="#local-1628204013"><span class="hs-identifier">yeses</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204014"><a href="#local-1628204014"><span class="hs-identifier">noes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204008"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628204012"><span class="hs-identifier hs-var">ct</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628204012"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204013"><span class="hs-identifier hs-var">yeses</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204014"><span class="hs-identifier hs-var">noes</span></a><span class="hs-special">)</span><span>
</span><a name="line-2164"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628204013"><span class="hs-identifier hs-var">yeses</span></a><span class="hs-special">,</span><span>              </span><a href="#local-1628204011"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="#local-1628204012"><span class="hs-identifier hs-var">ct</span></a><span> </span><a href="#local-1628204014"><span class="hs-identifier hs-var">noes</span></a><span class="hs-special">)</span><span>
</span><a name="line-2165"></a><span>    </span><a name="local-1628204011"><a href="#local-1628204011"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-1628204015"><a href="#local-1628204015"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_class</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204016"><a href="#local-1628204016"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204017"><a href="#local-1628204017"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628204018"><a href="#local-1628204018"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-2166"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#addDict"><span class="hs-identifier hs-var">addDict</span></a><span> </span><a href="#local-1628204018"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628204016"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-1628204017"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628204015"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-2167"></a><span>    </span><span class="hs-identifier">add</span><span> </span><a name="local-1628204019"><a href="#local-1628204019"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;partitionDicts&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204019"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-2168"></a><span>
</span><a name="line-2169"></a><span class="hs-identifier">dictsToBag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="#local-1628203564"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="#local-1628203564"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2170"></a><a name="dictsToBag"><a href="TcSMonad.html#dictsToBag"><span class="hs-identifier">dictsToBag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#tcAppMapToBag"><span class="hs-identifier hs-var">tcAppMapToBag</span></a><span>
</span><a name="line-2171"></a><span>
</span><a name="line-2172"></a><span class="hs-identifier">foldDicts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1628203562"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203563"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203563"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="#local-1628203562"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203563"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203563"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-2173"></a><a name="foldDicts"><a href="TcSMonad.html#foldDicts"><span class="hs-identifier">foldDicts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a><span>
</span><a name="line-2174"></a><span>
</span><a name="line-2175"></a><span class="hs-identifier">emptyDicts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a><span> </span><a href="#local-1628203561"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2176"></a><a name="emptyDicts"><a href="TcSMonad.html#emptyDicts"><span class="hs-identifier">emptyDicts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#emptyTcAppMap"><span class="hs-identifier hs-var">emptyTcAppMap</span></a><span>
</span><a name="line-2177"></a><span>
</span><a name="line-2178"></a><span>
</span><a name="line-2179"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   FunEqMap
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-2184"></a><span>
</span><a name="line-2185"></a><span class="hs-keyword">type</span><span> </span><a name="FunEqMap"><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier">FunEqMap</span></a></a><span> </span><a name="local-1628203531"><a href="#local-1628203531"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203531"><span class="hs-identifier hs-type">a</span></a><span>  </span><span class="hs-comment">-- A map whose key is a (TyCon, [Type]) pair</span><span>
</span><a name="line-2186"></a><span>
</span><a name="line-2187"></a><span class="hs-identifier">emptyFunEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a><span> </span><a href="#local-1628203560"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2188"></a><a name="emptyFunEqs"><a href="TcSMonad.html#emptyFunEqs"><span class="hs-identifier">emptyFunEqs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#emptyTcAppMap"><span class="hs-identifier hs-var">emptyTcAppMap</span></a><span>
</span><a name="line-2189"></a><span>
</span><a name="line-2190"></a><span class="hs-identifier">sizeFunEqMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="#local-1628203559"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-2191"></a><a name="sizeFunEqMap"><a href="TcSMonad.html#sizeFunEqMap"><span class="hs-identifier">sizeFunEqMap</span></a></a><span> </span><a name="local-1628204020"><a href="#local-1628204020"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628204021"><a href="#local-1628204021"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628204021"><span class="hs-identifier hs-var">x</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-1628204020"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2192"></a><span>
</span><a name="line-2193"></a><span class="hs-identifier">findFunEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="#local-1628203558"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="#local-1628203558"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2194"></a><a name="findFunEq"><a href="TcSMonad.html#findFunEq"><span class="hs-identifier">findFunEq</span></a></a><span> </span><a name="local-1628204022"><a href="#local-1628204022"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628204023"><a href="#local-1628204023"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1628204024"><a href="#local-1628204024"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#findTcApp"><span class="hs-identifier hs-var">findTcApp</span></a><span> </span><a href="#local-1628204022"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-1628204023"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204024"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2195"></a><span>
</span><a name="line-2196"></a><span class="hs-identifier">funEqsToBag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="#local-1628203557"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="#local-1628203557"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2197"></a><a name="funEqsToBag"><a href="TcSMonad.html#funEqsToBag"><span class="hs-identifier">funEqsToBag</span></a></a><span> </span><a name="local-1628204025"><a href="#local-1628204025"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a><span> </span><a href="Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a><span> </span><a href="#local-1628204025"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span>
</span><a name="line-2198"></a><span>
</span><a name="line-2199"></a><span class="hs-identifier">findFunEqsByTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="#local-1628203556"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1628203556"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-2200"></a><span class="hs-comment">-- Get inert function equation constraints that have the given tycon</span><span>
</span><a name="line-2201"></a><span class="hs-comment">-- in their head.  Not that the constraints remain in the inert set.</span><span>
</span><a name="line-2202"></a><span class="hs-comment">-- We use this to check for derived interactions with built-in type-function</span><span>
</span><a name="line-2203"></a><span class="hs-comment">-- constructors.</span><span>
</span><a name="line-2204"></a><a name="findFunEqsByTyCon"><a href="TcSMonad.html#findFunEqsByTyCon"><span class="hs-identifier">findFunEqsByTyCon</span></a></a><span> </span><a name="local-1628204026"><a href="#local-1628204026"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628204027"><a href="#local-1628204027"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-2205"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628204028"><a href="#local-1628204028"><span class="hs-identifier">tm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span> </span><a href="#local-1628204026"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628204027"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><a href="#local-1628204028"><span class="hs-identifier hs-var">tm</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2206"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2207"></a><span>
</span><a name="line-2208"></a><span class="hs-identifier">foldFunEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1628203554"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203555"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203555"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="#local-1628203554"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203555"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203555"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-2209"></a><a name="foldFunEqs"><a href="TcSMonad.html#foldFunEqs"><span class="hs-identifier">foldFunEqs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a><span>
</span><a name="line-2210"></a><span>
</span><a name="line-2211"></a><span class="hs-comment">-- mapFunEqs :: (a -&gt; b) -&gt; FunEqMap a -&gt; FunEqMap b</span><span>
</span><a name="line-2212"></a><span class="hs-comment">-- mapFunEqs = mapTcApp</span><span>
</span><a name="line-2213"></a><span>
</span><a name="line-2214"></a><span class="hs-identifier">filterFunEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-2215"></a><a name="filterFunEqs"><a href="TcSMonad.html#filterFunEqs"><span class="hs-identifier">filterFunEqs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#filterTcAppMap"><span class="hs-identifier hs-var">filterTcAppMap</span></a><span>
</span><a name="line-2216"></a><span>
</span><a name="line-2217"></a><span class="hs-identifier">insertFunEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="#local-1628203553"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203553"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="#local-1628203553"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2218"></a><a name="insertFunEq"><a href="TcSMonad.html#insertFunEq"><span class="hs-identifier">insertFunEq</span></a></a><span> </span><a name="local-1628204029"><a href="#local-1628204029"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628204030"><a href="#local-1628204030"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1628204031"><a href="#local-1628204031"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-1628204032"><a href="#local-1628204032"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#insertTcApp"><span class="hs-identifier hs-var">insertTcApp</span></a><span> </span><a href="#local-1628204029"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-1628204030"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204031"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628204032"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-2219"></a><span>
</span><a name="line-2220"></a><span class="hs-comment">-- insertFunEqCt :: FunEqMap Ct -&gt; Ct -&gt; FunEqMap Ct</span><span>
</span><a name="line-2221"></a><span class="hs-comment">-- insertFunEqCt m ct@(CFunEqCan { cc_fun = tc, cc_tyargs = tys })</span><span>
</span><a name="line-2222"></a><span class="hs-comment">--  = insertFunEq m tc tys ct</span><span>
</span><a name="line-2223"></a><span class="hs-comment">-- insertFunEqCt _ ct = pprPanic &quot;insertFunEqCt&quot; (ppr ct)</span><span>
</span><a name="line-2224"></a><span>
</span><a name="line-2225"></a><span class="hs-identifier">partitionFunEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-2226"></a><span class="hs-comment">-- Optimise for the case where the predicate is false</span><span>
</span><a name="line-2227"></a><span class="hs-comment">-- partitionFunEqs is called only from kick-out, and kick-out usually</span><span>
</span><a name="line-2228"></a><span class="hs-comment">-- kicks out very few equalities, so we want to optimise for that case</span><span>
</span><a name="line-2229"></a><a name="partitionFunEqs"><a href="TcSMonad.html#partitionFunEqs"><span class="hs-identifier">partitionFunEqs</span></a></a><span> </span><a name="local-1628204033"><a href="#local-1628204033"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628204034"><a href="#local-1628204034"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628204035"><span class="hs-identifier hs-var">yeses</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><a href="#local-1628204037"><span class="hs-identifier hs-var">del</span></a><span> </span><a href="#local-1628204034"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628204035"><span class="hs-identifier hs-var">yeses</span></a><span class="hs-special">)</span><span>
</span><a name="line-2230"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2231"></a><span>    </span><a name="local-1628204035"><a href="#local-1628204035"><span class="hs-identifier">yeses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a><span> </span><a href="#local-1628204036"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1628204034"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2232"></a><span>    </span><a name="local-1628204036"><a href="#local-1628204036"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1628204038"><a href="#local-1628204038"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1628204039"><a href="#local-1628204039"><span class="hs-identifier">yeses</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204033"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628204038"><span class="hs-identifier hs-var">ct</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204038"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628204039"><span class="hs-identifier hs-var">yeses</span></a><span>
</span><a name="line-2233"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204039"><span class="hs-identifier hs-var">yeses</span></a><span>
</span><a name="line-2234"></a><span>    </span><a name="local-1628204037"><a href="#local-1628204037"><span class="hs-identifier">del</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_fun</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204040"><a href="#local-1628204040"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204041"><a href="#local-1628204041"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628204042"><a href="#local-1628204042"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-2235"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#delFunEq"><span class="hs-identifier hs-var">delFunEq</span></a><span> </span><a href="#local-1628204042"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628204040"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1628204041"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2236"></a><span>    </span><span class="hs-identifier">del</span><span> </span><a name="local-1628204043"><a href="#local-1628204043"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;partitionFunEqs&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204043"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-2237"></a><span>
</span><a name="line-2238"></a><span class="hs-identifier">delFunEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="#local-1628203552"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a><span> </span><a href="#local-1628203552"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2239"></a><a name="delFunEq"><a href="TcSMonad.html#delFunEq"><span class="hs-identifier">delFunEq</span></a></a><span> </span><a name="local-1628204044"><a href="#local-1628204044"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628204045"><a href="#local-1628204045"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1628204046"><a href="#local-1628204046"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#delTcApp"><span class="hs-identifier hs-var">delTcApp</span></a><span> </span><a href="#local-1628204044"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-1628204045"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204046"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2240"></a><span>
</span><a name="line-2241"></a><span class="hs-comment">------------------------------</span><span>
</span><a name="line-2242"></a><span class="hs-keyword">type</span><span> </span><a name="ExactFunEqMap"><a href="TcSMonad.html#ExactFunEqMap"><span class="hs-identifier">ExactFunEqMap</span></a></a><span> </span><a name="local-1628203530"><a href="#local-1628203530"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="TrieMap.html#TypeMap"><span class="hs-identifier hs-type">TypeMap</span></a><span> </span><a href="#local-1628203530"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-2243"></a><span>
</span><a name="line-2244"></a><span class="hs-identifier">emptyExactFunEqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#ExactFunEqMap"><span class="hs-identifier hs-type">ExactFunEqMap</span></a><span> </span><a href="#local-1628203551"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2245"></a><a name="emptyExactFunEqs"><a href="TcSMonad.html#emptyExactFunEqs"><span class="hs-identifier">emptyExactFunEqs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span>
</span><a name="line-2246"></a><span>
</span><a name="line-2247"></a><span class="hs-identifier">findExactFunEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#ExactFunEqMap"><span class="hs-identifier hs-type">ExactFunEqMap</span></a><span> </span><a href="#local-1628203550"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="#local-1628203550"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2248"></a><a name="findExactFunEq"><a href="TcSMonad.html#findExactFunEq"><span class="hs-identifier">findExactFunEq</span></a></a><span> </span><a name="local-1628204047"><a href="#local-1628204047"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628204048"><a href="#local-1628204048"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1628204049"><a href="#local-1628204049"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204050"><a href="#local-1628204050"><span class="hs-identifier">tys_map</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span> </span><a href="#local-1628204047"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-1628204048"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2249"></a><span>                             </span><span class="hs-special">;</span><span> </span><a href="TrieMap.html#lookupTM"><span class="hs-identifier hs-var">lookupTM</span></a><span> </span><a href="#local-1628204049"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628204050"><span class="hs-identifier hs-var">tys_map</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2250"></a><span>
</span><a name="line-2251"></a><span class="hs-identifier">insertExactFunEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#ExactFunEqMap"><span class="hs-identifier hs-type">ExactFunEqMap</span></a><span> </span><a href="#local-1628203549"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628203549"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#ExactFunEqMap"><span class="hs-identifier hs-type">ExactFunEqMap</span></a><span> </span><a href="#local-1628203549"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2252"></a><a name="insertExactFunEq"><a href="TcSMonad.html#insertExactFunEq"><span class="hs-identifier">insertExactFunEq</span></a></a><span> </span><a name="local-1628204051"><a href="#local-1628204051"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1628204052"><a href="#local-1628204052"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1628204053"><a href="#local-1628204053"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-1628204054"><a href="#local-1628204054"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#alterUFM"><span class="hs-identifier hs-var">alterUFM</span></a><span> </span><a href="#local-1628204055"><span class="hs-identifier hs-var">alter_tm</span></a><span> </span><a href="#local-1628204051"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-1628204052"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2253"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1628204055"><a href="#local-1628204055"><span class="hs-identifier">alter_tm</span></a></a><span> </span><a name="local-1628204056"><a href="#local-1628204056"><span class="hs-identifier">mb_tm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#insertTM"><span class="hs-identifier hs-var">insertTM</span></a><span> </span><a href="#local-1628204053"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1628204054"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204056"><span class="hs-identifier hs-var">mb_tm</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><a href="TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2254"></a><span>
</span><a name="line-2255"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
*              The TcS solver monad                                    *
*                                                                      *
************************************************************************

Note [The TcS monad]
~~~~~~~~~~~~~~~~~~~~
The TcS monad is a weak form of the main Tc monad

All you can do is
    * fail
    * allocate new variables
    * fill in evidence variables

Filling in a dictionary evidence variable means to create a binding
for it, so TcS carries a mutable location where the binding can be
added.  This is initialised from the innermost implication constraint.

Note [Solving for Derived constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Sometimes we invoke the solver on a bunch of Derived constraints, not to
generate any evidence, but just to cause unification side effects or to
produce a simpler set of constraints.  If that is what we are doing, we
should do two things differently:
  a) Don't stop when you've solved all the Wanteds; instead keep going
     if there are any Deriveds in the work queue.
  b) In getInertUnsolved, include Derived ones
-}</span><span>
</span><a name="line-2285"></a><span>
</span><a name="line-2286"></a><span class="hs-keyword">data</span><span> </span><a name="TcSEnv"><a href="TcSMonad.html#TcSEnv"><span class="hs-identifier">TcSEnv</span></a></a><span>
</span><a name="line-2287"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TcSEnv"><a href="TcSMonad.html#TcSEnv"><span class="hs-identifier">TcSEnv</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2288"></a><span>      </span><a href="TcSMonad.html#tcs_ev_binds"><span class="hs-identifier">tcs_ev_binds</span></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcEvidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-2289"></a><span>          </span><span class="hs-comment">-- this could be Nothing if we can't deal with non-equality</span><span>
</span><a name="line-2290"></a><span>          </span><span class="hs-comment">-- constraints, because, say, we're in a top-level type signature</span><span>
</span><a name="line-2291"></a><span>
</span><a name="line-2292"></a><span>      </span><a href="TcSMonad.html#tcs_unified"><span class="hs-identifier">tcs_unified</span></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>
</span><a name="line-2293"></a><span>         </span><span class="hs-comment">-- The number of unification variables we have filled</span><span>
</span><a name="line-2294"></a><span>         </span><span class="hs-comment">-- The important thing is whether it is non-zero</span><span>
</span><a name="line-2295"></a><span>
</span><a name="line-2296"></a><span>      </span><a href="TcSMonad.html#tcs_count"><span class="hs-identifier">tcs_count</span></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Global step count</span><span>
</span><a name="line-2297"></a><span>
</span><a name="line-2298"></a><span>      </span><a href="TcSMonad.html#tcs_inerts"><span class="hs-identifier">tcs_inerts</span></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><a href="TcSMonad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Current inert set</span><span>
</span><a name="line-2299"></a><span>
</span><a name="line-2300"></a><span>      </span><span class="hs-comment">-- The main work-list and the flattening worklist</span><span>
</span><a name="line-2301"></a><span>      </span><span class="hs-comment">-- See Note [Work list priorities] and</span><span>
</span><a name="line-2302"></a><span>      </span><a href="TcSMonad.html#tcs_worklist"><span class="hs-identifier">tcs_worklist</span></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Current worklist</span><span>
</span><a name="line-2303"></a><span>
</span><a name="line-2304"></a><span>      </span><a href="TcSMonad.html#tcs_used_tcvs"><span class="hs-identifier">tcs_used_tcvs</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-2305"></a><span>        </span><span class="hs-comment">-- these variables were used when filling holes. Don't discard!</span><span>
</span><a name="line-2306"></a><span>        </span><span class="hs-comment">-- See also Note [Tracking redundant constraints] in TcSimplify</span><span>
</span><a name="line-2307"></a><span>
</span><a name="line-2308"></a><span>      </span><a href="TcSMonad.html#tcs_need_deriveds"><span class="hs-identifier">tcs_need_deriveds</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2309"></a><span>        </span><span class="hs-comment">-- Keep solving, even if all the unsolved constraints are Derived</span><span>
</span><a name="line-2310"></a><span>        </span><span class="hs-comment">-- See Note [Solving for Derived constraints]</span><span>
</span><a name="line-2311"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-2312"></a><span>
</span><a name="line-2313"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-2314"></a><span class="hs-keyword">newtype</span><span> </span><a name="TcS"><a href="TcSMonad.html#TcS"><span class="hs-identifier">TcS</span></a></a><span> </span><a name="local-1628203529"><a href="#local-1628203529"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TcS"><a href="TcSMonad.html#TcS"><span class="hs-identifier">TcS</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#unTcS"><span class="hs-identifier">unTcS</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628203529"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2315"></a><span>
</span><a name="line-2316"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Functor"><span class="hs-identifier hs-type">Functor</span></a><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2317"></a><span>  </span><a name="local-805306541"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier">fmap</span></a></a><span> </span><a name="local-1628204344"><a href="#local-1628204344"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628204345"><a href="#local-1628204345"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="#local-1628204344"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">unTcS</span><span> </span><a href="#local-1628204345"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-2318"></a><span>
</span><a name="line-2319"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Applicative"><span class="hs-identifier hs-type">Applicative</span></a><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2320"></a><span>  </span><a name="local-805307120"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier">pure</span></a></a><span> </span><a name="local-1628204343"><a href="#local-1628204343"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628204343"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-2321"></a><span>  </span><span class="hs-special">(</span><a name="local-805307119"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator">&lt;*&gt;</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#ap"><span class="hs-identifier hs-var">ap</span></a><span>
</span><a name="line-2322"></a><span>
</span><a name="line-2323"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2324"></a><span>  </span><a name="local-805306538"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fail"><span class="hs-identifier">fail</span></a></a><span> </span><a name="local-1628204338"><a href="#local-1628204338"><span class="hs-identifier">err</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fail"><span class="hs-identifier hs-var">fail</span></a><span> </span><a href="#local-1628204338"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-2325"></a><span>  </span><a name="local-1628204339"><a href="#local-1628204339"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-805306539"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator">&gt;&gt;=</span></a></a><span> </span><a name="local-1628204340"><a href="#local-1628204340"><span class="hs-identifier">k</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628204341"><a href="#local-1628204341"><span class="hs-identifier">ebs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTcS</span><span> </span><a href="#local-1628204339"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1628204341"><span class="hs-identifier hs-var">ebs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628204342"><a href="#local-1628204342"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTcS</span><span> </span><span class="hs-special">(</span><a href="#local-1628204340"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1628204342"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204341"><span class="hs-identifier hs-var">ebs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2326"></a><span>
</span><a name="line-2327"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710</span><span>
</span><a name="line-2328"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.Fail.html#MonadFail"><span class="hs-identifier hs-type">MonadFail</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">MonadFail</span></a><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2329"></a><span>  </span><a name="local-805306544"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.Fail.html#fail"><span class="hs-identifier">fail</span></a></a><span> </span><a name="local-1628204337"><a href="#local-1628204337"><span class="hs-identifier">err</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fail"><span class="hs-identifier hs-var">fail</span></a><span> </span><a href="#local-1628204337"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-2330"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-2331"></a><span>
</span><a name="line-2332"></a><span class="hs-keyword">instance</span><span> </span><a href="UniqSupply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2333"></a><span>   </span><a name="local-1912711713"><a href="UniqSupply.html#getUniqueSupplyM"><span class="hs-identifier">getUniqueSupplyM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="UniqSupply.html#getUniqueSupplyM"><span class="hs-identifier hs-var">getUniqueSupplyM</span></a><span>
</span><a name="line-2334"></a><span>
</span><a name="line-2335"></a><span class="hs-comment">-- Basic functionality</span><span>
</span><a name="line-2336"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-2337"></a><span class="hs-identifier">wrapTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628203548"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203548"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2338"></a><span class="hs-comment">-- Do not export wrapTcS, because it promotes an arbitrary TcM to TcS,</span><span>
</span><a name="line-2339"></a><span class="hs-comment">-- and TcS is supposed to have limited functionality</span><span>
</span><a name="line-2340"></a><a name="wrapTcS"><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier">wrapTcS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><span class="hs-comment">-- a TcM action will not use the TcEvBinds</span><span>
</span><a name="line-2341"></a><span>
</span><a name="line-2342"></a><span class="hs-identifier">wrapErrTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628203547"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203547"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2343"></a><span class="hs-comment">-- The thing wrapped should just fail</span><span>
</span><a name="line-2344"></a><span class="hs-comment">-- There's no static check; it's up to the user</span><span>
</span><a name="line-2345"></a><span class="hs-comment">-- Having a variant for each error message is too painful</span><span>
</span><a name="line-2346"></a><a name="wrapErrTcS"><a href="TcSMonad.html#wrapErrTcS"><span class="hs-identifier">wrapErrTcS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span>
</span><a name="line-2347"></a><span>
</span><a name="line-2348"></a><span class="hs-identifier">wrapWarnTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628203546"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203546"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2349"></a><span class="hs-comment">-- The thing wrapped should just add a warning, or no-op</span><span>
</span><a name="line-2350"></a><span class="hs-comment">-- There's no static check; it's up to the user</span><span>
</span><a name="line-2351"></a><a name="wrapWarnTcS"><a href="TcSMonad.html#wrapWarnTcS"><span class="hs-identifier">wrapWarnTcS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span>
</span><a name="line-2352"></a><span>
</span><a name="line-2353"></a><span class="hs-identifier">failTcS</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">panicTcS</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203545"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2354"></a><span class="hs-identifier">warnTcS</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2355"></a><span class="hs-identifier">addErrTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2356"></a><a name="failTcS"><a href="TcSMonad.html#failTcS"><span class="hs-identifier">failTcS</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcRnMonad.html#failWith"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">failWith</span></a><span>
</span><a name="line-2357"></a><a name="warnTcS"><a href="TcSMonad.html#warnTcS"><span class="hs-identifier">warnTcS</span></a></a><span> </span><a name="local-1628204057"><a href="#local-1628204057"><span class="hs-identifier">flag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcRnMonad.html#addWarn"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">addWarn</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="#local-1628204057"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span>
</span><a name="line-2358"></a><a name="addErrTcS"><a href="TcSMonad.html#addErrTcS"><span class="hs-identifier">addErrTcS</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">addErr</span></a><span>
</span><a name="line-2359"></a><a name="panicTcS"><a href="TcSMonad.html#panicTcS"><span class="hs-identifier">panicTcS</span></a></a><span> </span><a name="local-1628204058"><a href="#local-1628204058"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;TcCanonical&quot;</span><span> </span><a href="#local-1628204058"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-2360"></a><span>
</span><a name="line-2361"></a><span class="hs-identifier">traceTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2362"></a><a name="traceTcS"><a href="TcSMonad.html#traceTcS"><span class="hs-identifier">traceTcS</span></a></a><span> </span><a name="local-1628204059"><a href="#local-1628204059"><span class="hs-identifier">herald</span></a></a><span> </span><a name="local-1628204060"><a href="#local-1628204060"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">traceTc</span></a><span> </span><a href="#local-1628204059"><span class="hs-identifier hs-var">herald</span></a><span> </span><a href="#local-1628204060"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2363"></a><span>
</span><a name="line-2364"></a><span class="hs-identifier">runTcPluginTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span> </span><a href="#local-1628203544"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203544"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2365"></a><a name="runTcPluginTcS"><a href="TcSMonad.html#runTcPluginTcS"><span class="hs-identifier">runTcPluginTcS</span></a></a><span> </span><a name="local-1628204061"><a href="#local-1628204061"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcRnTypes.html#runTcPluginM"><span class="hs-identifier hs-var">runTcPluginM</span></a><span> </span><a href="#local-1628204061"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a><span> </span><a href="TcSMonad.html#getTcEvBinds"><span class="hs-identifier hs-var">getTcEvBinds</span></a><span>
</span><a name="line-2366"></a><span>
</span><a name="line-2367"></a><span class="hs-keyword">instance</span><span> </span><a href="DynFlags.html#HasDynFlags"><span class="hs-identifier hs-type">HasDynFlags</span></a><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2368"></a><span>    </span><a name="local-1912741864"><a href="DynFlags.html#getDynFlags"><span class="hs-identifier">getDynFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-2369"></a><span>
</span><a name="line-2370"></a><span class="hs-identifier">getGlobalRdrEnvTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-2371"></a><a name="getGlobalRdrEnvTcS"><a href="TcSMonad.html#getGlobalRdrEnvTcS"><span class="hs-identifier">getGlobalRdrEnvTcS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="TcRnMonad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a><span>
</span><a name="line-2372"></a><span>
</span><a name="line-2373"></a><span class="hs-identifier">bumpStepCountTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2374"></a><a name="bumpStepCountTcS"><a href="TcSMonad.html#bumpStepCountTcS"><span class="hs-identifier">bumpStepCountTcS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628204062"><a href="#local-1628204062"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204063"><a href="#local-1628204063"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcs_count</span><span> </span><a href="#local-1628204062"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-2375"></a><span>                                    </span><span class="hs-special">;</span><span> </span><a name="local-1628204064"><a href="#local-1628204064"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204063"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-2376"></a><span>                                    </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><a href="#local-1628204063"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204064"><span class="hs-identifier hs-var">n</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2377"></a><span>
</span><a name="line-2378"></a><span class="hs-comment">-- | Mark variables as used filling a coercion hole</span><span>
</span><a name="line-2379"></a><span class="hs-identifier">useVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2380"></a><a name="useVars"><a href="TcSMonad.html#useVars"><span class="hs-identifier">useVars</span></a></a><span> </span><a name="local-1628204065"><a href="#local-1628204065"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628204066"><a href="#local-1628204066"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204067"><a href="#local-1628204067"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcs_used_tcvs</span><span> </span><a href="#local-1628204066"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-2381"></a><span>                                </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#updTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">updTcRef</span></a><span> </span><a href="#local-1628204067"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204065"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2382"></a><span>
</span><a name="line-2383"></a><span class="hs-identifier">csTraceTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2384"></a><a name="csTraceTcS"><a href="TcSMonad.html#csTraceTcS"><span class="hs-identifier">csTraceTcS</span></a></a><span> </span><a name="local-1628204068"><a href="#local-1628204068"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-2385"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcSMonad.html#csTraceTcM"><span class="hs-identifier hs-var">csTraceTcM</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628204068"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2386"></a><span>
</span><a name="line-2387"></a><span class="hs-identifier">traceFireTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2388"></a><span class="hs-comment">-- Dump a rule-firing trace</span><span>
</span><a name="line-2389"></a><a name="traceFireTcS"><a href="TcSMonad.html#traceFireTcS"><span class="hs-identifier">traceFireTcS</span></a></a><span> </span><a name="local-1628204069"><a href="#local-1628204069"><span class="hs-identifier">ev</span></a></a><span> </span><a name="local-1628204070"><a href="#local-1628204070"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-2390"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628204071"><a href="#local-1628204071"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#csTraceTcM"><span class="hs-identifier hs-var">csTraceTcM</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2391"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204072"><a href="#local-1628204072"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcs_count</span><span> </span><a href="#local-1628204071"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-2392"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204073"><a href="#local-1628204073"><span class="hs-identifier">tclvl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTcLevel"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getTcLevel</span></a><span>
</span><a name="line-2393"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-1628204072"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;U:&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204073"><span class="hs-identifier hs-var">tclvl</span></a><span>
</span><a name="line-2394"></a><span>                                          </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctLocDepth"><span class="hs-identifier hs-var">ctLocDepth</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a><span> </span><a href="#local-1628204069"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2395"></a><span>                       </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1628204070"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">)</span><span>
</span><a name="line-2396"></a><span>                     </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204069"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2397"></a><span>
</span><a name="line-2398"></a><span class="hs-identifier">csTraceTcM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2399"></a><span class="hs-comment">-- Constraint-solver tracing, -ddump-cs-trace</span><span>
</span><a name="line-2400"></a><a name="csTraceTcM"><a href="TcSMonad.html#csTraceTcM"><span class="hs-identifier">csTraceTcM</span></a></a><span> </span><a name="local-1628204074"><a href="#local-1628204074"><span class="hs-identifier">trace_level</span></a></a><span> </span><a name="local-1628204075"><a href="#local-1628204075"><span class="hs-identifier">mk_doc</span></a></a><span>
</span><a name="line-2401"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204076"><a href="#local-1628204076"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-2402"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><span>  </span><span class="hs-special">(</span><a href="DynFlags.html#dopt"><span class="hs-identifier hs-var">dopt</span></a><span> </span><a href="DynFlags.html#Opt_D_dump_cs_trace"><span class="hs-identifier hs-var">Opt_D_dump_cs_trace</span></a><span> </span><a href="#local-1628204076"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="DynFlags.html#dopt"><span class="hs-identifier hs-var">dopt</span></a><span> </span><a href="DynFlags.html#Opt_D_dump_tc_trace"><span class="hs-identifier hs-var">Opt_D_dump_tc_trace</span></a><span> </span><a href="#local-1628204076"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-2403"></a><span>              </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1628204074"><span class="hs-identifier hs-var">trace_level</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier">traceLevel</span><span> </span><a href="#local-1628204076"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2404"></a><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204077"><a href="#local-1628204077"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204075"><span class="hs-identifier hs-var">mk_doc</span></a><span>
</span><a name="line-2405"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTcRn"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">traceTcRn</span></a><span> </span><a href="DynFlags.html#Opt_D_dump_cs_trace"><span class="hs-identifier hs-var">Opt_D_dump_cs_trace</span></a><span> </span><a href="#local-1628204077"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2406"></a><span>
</span><a name="line-2407"></a><span class="hs-identifier">runTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203543"><span class="hs-identifier hs-type">a</span></a><span>                </span><span class="hs-comment">-- What to run</span><span>
</span><a name="line-2408"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203543"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="TcEvidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a><span class="hs-special">)</span><span>
</span><a name="line-2409"></a><a name="runTcS"><a href="TcSMonad.html#runTcS"><span class="hs-identifier">runTcS</span></a></a><span> </span><a name="local-1628204078"><a href="#local-1628204078"><span class="hs-identifier">tcs</span></a></a><span>
</span><a name="line-2410"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204079"><a href="#local-1628204079"><span class="hs-identifier">ev_binds_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcEvBinds</span></a><span>
</span><a name="line-2411"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204080"><a href="#local-1628204080"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#runTcSWithEvBinds"><span class="hs-identifier hs-var">runTcSWithEvBinds</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204079"><span class="hs-identifier hs-var">ev_binds_var</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204078"><span class="hs-identifier hs-var">tcs</span></a><span>
</span><a name="line-2412"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204081"><a href="#local-1628204081"><span class="hs-identifier">ev_binds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTcEvBindsMap"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getTcEvBindsMap</span></a><span> </span><a href="#local-1628204079"><span class="hs-identifier hs-var">ev_binds_var</span></a><span>
</span><a name="line-2413"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204080"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204081"><span class="hs-identifier hs-var">ev_binds</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2414"></a><span>
</span><a name="line-2415"></a><span class="hs-comment">-- | This variant of 'runTcS' will keep solving, even when only Deriveds</span><span>
</span><a name="line-2416"></a><span class="hs-comment">-- are left around. It also doesn't return any evidence, as callers won't</span><span>
</span><a name="line-2417"></a><span class="hs-comment">-- need it.</span><span>
</span><a name="line-2418"></a><span class="hs-identifier">runTcSDeriveds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203542"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628203542"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2419"></a><a name="runTcSDeriveds"><a href="TcSMonad.html#runTcSDeriveds"><span class="hs-identifier">runTcSDeriveds</span></a></a><span> </span><a name="local-1628204082"><a href="#local-1628204082"><span class="hs-identifier">tcs</span></a></a><span>
</span><a name="line-2420"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204083"><a href="#local-1628204083"><span class="hs-identifier">ev_binds_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcEvBinds</span></a><span>
</span><a name="line-2421"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#runTcSWithEvBinds"><span class="hs-identifier hs-var">runTcSWithEvBinds</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204083"><span class="hs-identifier hs-var">ev_binds_var</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204082"><span class="hs-identifier hs-var">tcs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2422"></a><span>
</span><a name="line-2423"></a><span class="hs-comment">-- | This can deal only with equality constraints.</span><span>
</span><a name="line-2424"></a><span class="hs-identifier">runTcSEqualities</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203541"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628203541"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2425"></a><a name="runTcSEqualities"><a href="TcSMonad.html#runTcSEqualities"><span class="hs-identifier">runTcSEqualities</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#runTcSWithEvBinds"><span class="hs-identifier hs-var">runTcSWithEvBinds</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-2426"></a><span>
</span><a name="line-2427"></a><span class="hs-identifier">runTcSWithEvBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>  </span><span class="hs-comment">-- ^ keep running even if only Deriveds are left?</span><span>
</span><a name="line-2428"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcEvidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a><span>
</span><a name="line-2429"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203540"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2430"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-1628203540"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2431"></a><a name="runTcSWithEvBinds"><a href="TcSMonad.html#runTcSWithEvBinds"><span class="hs-identifier">runTcSWithEvBinds</span></a></a><span> </span><a name="local-1628204084"><a href="#local-1628204084"><span class="hs-identifier">solve_deriveds</span></a></a><span> </span><a name="local-1628204085"><a href="#local-1628204085"><span class="hs-identifier">ev_binds_var</span></a></a><span> </span><a name="local-1628204086"><a href="#local-1628204086"><span class="hs-identifier">tcs</span></a></a><span>
</span><a name="line-2432"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204087"><a href="#local-1628204087"><span class="hs-identifier">unified_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2433"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204088"><a href="#local-1628204088"><span class="hs-identifier">step_count</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2434"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204089"><a href="#local-1628204089"><span class="hs-identifier">inert_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><a href="TcSMonad.html#emptyInert"><span class="hs-identifier hs-var">emptyInert</span></a><span>
</span><a name="line-2435"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204090"><a href="#local-1628204090"><span class="hs-identifier">wl_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><a href="TcSMonad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a><span>
</span><a name="line-2436"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204091"><a href="#local-1628204091"><span class="hs-identifier">used_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span> </span><span class="hs-comment">-- never read from, but see</span><span>
</span><a name="line-2437"></a><span>                                              </span><span class="hs-comment">-- nestImplicTcS</span><span>
</span><a name="line-2438"></a><span>
</span><a name="line-2439"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204092"><a href="#local-1628204092"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcSEnv"><span class="hs-identifier hs-var">TcSEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcs_ev_binds</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204085"><span class="hs-identifier hs-var">ev_binds_var</span></a><span>
</span><a name="line-2440"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_unified</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204087"><span class="hs-identifier hs-var">unified_var</span></a><span>
</span><a name="line-2441"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_count</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204088"><span class="hs-identifier hs-var">step_count</span></a><span>
</span><a name="line-2442"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_inerts</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204089"><span class="hs-identifier hs-var">inert_var</span></a><span>
</span><a name="line-2443"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_worklist</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204090"><span class="hs-identifier hs-var">wl_var</span></a><span>
</span><a name="line-2444"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_used_tcvs</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204091"><span class="hs-identifier hs-var">used_var</span></a><span>
</span><a name="line-2445"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_need_deriveds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204084"><span class="hs-identifier hs-var">solve_deriveds</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2446"></a><span>
</span><a name="line-2447"></a><span>             </span><span class="hs-comment">-- Run the computation</span><span>
</span><a name="line-2448"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204093"><a href="#local-1628204093"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unTcS</span><span> </span><a href="#local-1628204086"><span class="hs-identifier hs-var">tcs</span></a><span> </span><a href="#local-1628204092"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-2449"></a><span>
</span><a name="line-2450"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204094"><a href="#local-1628204094"><span class="hs-identifier">count</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204088"><span class="hs-identifier hs-var">step_count</span></a><span>
</span><a name="line-2451"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204094"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2452"></a><span>         </span><a href="TcSMonad.html#csTraceTcM"><span class="hs-identifier hs-var">csTraceTcM</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Constraint solver steps =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-1628204094"><span class="hs-identifier hs-var">count</span></a><span class="hs-special">)</span><span>
</span><a name="line-2453"></a><span>
</span><a name="line-2454"></a><span class="hs-cpp">#ifdef DEBUG</span><span>
</span><a name="line-2455"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="Maybes.html#whenIsJust"><span class="hs-identifier hs-var">whenIsJust</span></a><span> </span><a href="#local-1628204085"><span class="hs-identifier hs-var">ev_binds_var</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628204095"><a href="#local-1628204095"><span class="hs-identifier">ebv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2456"></a><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204096"><a href="#local-1628204096"><span class="hs-identifier">ev_binds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTcEvBinds"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getTcEvBinds</span></a><span> </span><a href="#local-1628204095"><span class="hs-identifier hs-var">ebv</span></a><span>
</span><a name="line-2457"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#checkForCyclicBinds"><span class="hs-identifier hs-var">checkForCyclicBinds</span></a><span> </span><a href="#local-1628204096"><span class="hs-identifier hs-var">ev_binds</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2458"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-2459"></a><span>
</span><a name="line-2460"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628204093"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2461"></a><span>
</span><a name="line-2462"></a><span class="hs-cpp">#ifdef DEBUG</span><span>
</span><a name="line-2463"></a><span class="hs-identifier">checkForCyclicBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcEvidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2464"></a><a name="checkForCyclicBinds"><a href="TcSMonad.html#checkForCyclicBinds"><span class="hs-identifier">checkForCyclicBinds</span></a></a><span> </span><a name="local-1628204097"><a href="#local-1628204097"><span class="hs-identifier">ev_binds</span></a></a><span>
</span><a name="line-2465"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628204098"><span class="hs-identifier hs-var">cycles</span></a><span>
</span><a name="line-2466"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2467"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628204099"><span class="hs-identifier hs-var">coercion_cycles</span></a><span>
</span><a name="line-2468"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Cycle in evidence binds&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204098"><span class="hs-identifier hs-var">cycles</span></a><span>
</span><a name="line-2469"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2470"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;Cycle in coercion bindings&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204099"><span class="hs-identifier hs-var">coercion_cycles</span></a><span>
</span><a name="line-2471"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2472"></a><span>    </span><span class="hs-identifier">cycles</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="TcEvidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-2473"></a><span>    </span><a name="local-1628204098"><a href="#local-1628204098"><span class="hs-identifier">cycles</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1628204102"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-var">CyclicSCC</span></a><span> </span><a name="local-1628204102"><a href="#local-1628204102"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Digraph.html#stronglyConnCompFromEdgedVertices"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVertices</span></a><span> </span><a href="#local-1628204101"><span class="hs-identifier hs-var">edges</span></a><span class="hs-special">]</span><span>
</span><a name="line-2474"></a><span>
</span><a name="line-2475"></a><span>    </span><a name="local-1628204099"><a href="#local-1628204099"><span class="hs-identifier">coercion_cycles</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1628204103"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628204103"><a href="#local-1628204103"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204098"><span class="hs-identifier hs-var">cycles</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><a href="#local-1628204100"><span class="hs-identifier hs-var">is_co_bind</span></a><span> </span><a href="#local-1628204103"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-2476"></a><span>    </span><a name="local-1628204100"><a href="#local-1628204100"><span class="hs-identifier">is_co_bind</span></a></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#EvBind"><span class="hs-identifier hs-var">EvBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eb_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204104"><a href="#local-1628204104"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isEqPred"><span class="hs-identifier hs-var">isEqPred</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-1628204104"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-2477"></a><span>
</span><a name="line-2478"></a><span>    </span><span class="hs-identifier">edges</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcEvidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2479"></a><span>    </span><a name="local-1628204101"><a href="#local-1628204101"><span class="hs-identifier">edges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-1628204105"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204106"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">,</span><span> </span><a href="VarSet.html#varSetElems"><span class="hs-identifier hs-var">varSetElems</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#evVarsOfTerm"><span class="hs-identifier hs-var">evVarsOfTerm</span></a><span> </span><a href="#local-1628204107"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2480"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="local-1628204105"><a href="#local-1628204105"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcEvidence.html#EvBind"><span class="hs-identifier hs-var">EvBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eb_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204106"><a href="#local-1628204106"><span class="hs-identifier">bndr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">eb_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204107"><a href="#local-1628204107"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628204097"><span class="hs-identifier hs-var">ev_binds</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2481"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-2482"></a><span>
</span><a name="line-2483"></a><span class="hs-identifier">nestImplicTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcEvidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span> </span><span class="hs-comment">-- bound in this implication</span><span>
</span><a name="line-2484"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203539"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2485"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628203539"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- also returns any vars used when filling</span><span>
</span><a name="line-2486"></a><span>                                      </span><span class="hs-comment">-- coercion holes (for redundant-constraint</span><span>
</span><a name="line-2487"></a><span>                                      </span><span class="hs-comment">-- tracking)</span><span>
</span><a name="line-2488"></a><a name="nestImplicTcS"><a href="TcSMonad.html#nestImplicTcS"><span class="hs-identifier">nestImplicTcS</span></a></a><span> </span><a name="local-1628204108"><a href="#local-1628204108"><span class="hs-identifier">m_ref</span></a></a><span> </span><a name="local-1628204109"><a href="#local-1628204109"><span class="hs-identifier">bound_tcvs</span></a></a><span> </span><a name="local-1628204110"><a href="#local-1628204110"><span class="hs-identifier">inner_tclvl</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a name="local-1628204111"><a href="#local-1628204111"><span class="hs-identifier">thing_inside</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2489"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1628204126"><a href="#local-1628204126"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204127"><a href="#local-1628204127"><span class="hs-identifier">used_tcvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-2490"></a><span>         </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a href="TcSMonad.html#TcSEnv"><span class="hs-identifier hs-var">TcSEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcs_unified</span><span>       </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204112"><a href="#local-1628204112"><span class="hs-identifier">unified_var</span></a></a><span>
</span><a name="line-2491"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_inerts</span><span>        </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204113"><a href="#local-1628204113"><span class="hs-identifier">old_inert_var</span></a></a><span>
</span><a name="line-2492"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_count</span><span>         </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204114"><a href="#local-1628204114"><span class="hs-identifier">count</span></a></a><span>
</span><a name="line-2493"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_need_deriveds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204115"><a href="#local-1628204115"><span class="hs-identifier">solve_deriveds</span></a></a><span>
</span><a name="line-2494"></a><span>                        </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2495"></a><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204116"><a href="#local-1628204116"><span class="hs-identifier">inerts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204113"><span class="hs-identifier hs-var">old_inert_var</span></a><span>
</span><a name="line-2496"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204117"><a href="#local-1628204117"><span class="hs-identifier">nest_inert</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204116"><span class="hs-identifier hs-var">inerts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_flat_cache</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#emptyExactFunEqs"><span class="hs-identifier hs-var">emptyExactFunEqs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2497"></a><span>                                     </span><span class="hs-comment">-- See Note [Do not inherit the flat cache]</span><span>
</span><a name="line-2498"></a><span>         </span><span class="hs-special">;</span><span> </span><a name="local-1628204118"><a href="#local-1628204118"><span class="hs-identifier">new_inert_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><a href="#local-1628204117"><span class="hs-identifier hs-var">nest_inert</span></a><span>
</span><a name="line-2499"></a><span>         </span><span class="hs-special">;</span><span> </span><a name="local-1628204119"><a href="#local-1628204119"><span class="hs-identifier">new_wl_var</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><a href="TcSMonad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a><span>
</span><a name="line-2500"></a><span>         </span><span class="hs-special">;</span><span> </span><a name="local-1628204120"><a href="#local-1628204120"><span class="hs-identifier">new_used_var</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-2501"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204121"><a href="#local-1628204121"><span class="hs-identifier">nest_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcSEnv"><span class="hs-identifier hs-var">TcSEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcs_ev_binds</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204108"><span class="hs-identifier hs-var">m_ref</span></a><span>
</span><a name="line-2502"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_unified</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204112"><span class="hs-identifier hs-var">unified_var</span></a><span>
</span><a name="line-2503"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_count</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204114"><span class="hs-identifier hs-var">count</span></a><span>
</span><a name="line-2504"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_inerts</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204118"><span class="hs-identifier hs-var">new_inert_var</span></a><span>
</span><a name="line-2505"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_worklist</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204119"><span class="hs-identifier hs-var">new_wl_var</span></a><span>
</span><a name="line-2506"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_used_tcvs</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204120"><span class="hs-identifier hs-var">new_used_var</span></a><span>
</span><a name="line-2507"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_need_deriveds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204115"><span class="hs-identifier hs-var">solve_deriveds</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2508"></a><span>         </span><span class="hs-special">;</span><span> </span><a name="local-1628204122"><a href="#local-1628204122"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setTcLevel"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">setTcLevel</span></a><span> </span><a href="#local-1628204110"><span class="hs-identifier hs-var">inner_tclvl</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2509"></a><span>                  </span><a href="#local-1628204111"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-1628204121"><span class="hs-identifier hs-var">nest_env</span></a><span>
</span><a name="line-2510"></a><span>
</span><a name="line-2511"></a><span class="hs-cpp">#ifdef DEBUG</span><span>
</span><a name="line-2512"></a><span>         </span><span class="hs-comment">-- Perform a check that the thing_inside did not cause cycles</span><span>
</span><a name="line-2513"></a><span>         </span><span class="hs-special">;</span><span> </span><a href="Maybes.html#whenIsJust"><span class="hs-identifier hs-var">whenIsJust</span></a><span> </span><a href="#local-1628204108"><span class="hs-identifier hs-var">m_ref</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204123"><a href="#local-1628204123"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2514"></a><span>           </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204124"><a href="#local-1628204124"><span class="hs-identifier">ev_binds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTcEvBinds"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getTcEvBinds</span></a><span> </span><a href="#local-1628204123"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-2515"></a><span>              </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#checkForCyclicBinds"><span class="hs-identifier hs-var">checkForCyclicBinds</span></a><span> </span><a href="#local-1628204124"><span class="hs-identifier hs-var">ev_binds</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2516"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-2517"></a><span>         </span><span class="hs-special">;</span><span> </span><a name="local-1628204125"><a href="#local-1628204125"><span class="hs-identifier">used_tcvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204120"><span class="hs-identifier hs-var">new_used_var</span></a><span>
</span><a name="line-2518"></a><span>         </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204122"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204125"><span class="hs-identifier hs-var">used_tcvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2519"></a><span>
</span><a name="line-2520"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204130"><a href="#local-1628204130"><span class="hs-identifier">local_ev_vars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204108"><span class="hs-identifier hs-var">m_ref</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2521"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-2522"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628204128"><a href="#local-1628204128"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204129"><a href="#local-1628204129"><span class="hs-identifier">binds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#getTcEvBinds"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getTcEvBinds</span></a><span> </span><a href="#local-1628204128"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-2523"></a><span>                          </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarSet.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TcEvidence.html#evBindVar"><span class="hs-identifier hs-var">evBindVar</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-1628204129"><span class="hs-identifier hs-var">binds</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2524"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204131"><a href="#local-1628204131"><span class="hs-identifier">all_locals</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204109"><span class="hs-identifier hs-var">bound_tcvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204130"><span class="hs-identifier hs-var">local_ev_vars</span></a><span>
</span><a name="line-2525"></a><span>             </span><span class="hs-special">(</span><a name="local-1628204132"><a href="#local-1628204132"><span class="hs-identifier">inner_used_tcvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204133"><a href="#local-1628204133"><span class="hs-identifier">outer_used_tcvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2526"></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#partitionVarSet"><span class="hs-identifier hs-var">partitionVarSet</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204131"><span class="hs-identifier hs-var">all_locals</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204127"><span class="hs-identifier hs-var">used_tcvs</span></a><span>
</span><a name="line-2527"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#useVars"><span class="hs-identifier hs-var">useVars</span></a><span> </span><a href="#local-1628204133"><span class="hs-identifier hs-var">outer_used_tcvs</span></a><span>
</span><a name="line-2528"></a><span>
</span><a name="line-2529"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204126"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204132"><span class="hs-identifier hs-var">inner_used_tcvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2530"></a><span>
</span><a name="line-2531"></a><span class="hs-comment">{- Note [Do not inherit the flat cache]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We do not want to inherit the flat cache when processing nested
implications.  Consider
   a ~ F b, forall c. b~Int =&gt; blah
If we have F b ~ fsk in the flat-cache, and we push that into the
nested implication, we might miss that F b can be rewritten to F Int,
and hence perhpas solve it.  Moreover, the fsk from outside is
flattened out after solving the outer level, but and we don't
do that flattening recursively.
-}</span><span>
</span><a name="line-2542"></a><span>
</span><a name="line-2543"></a><span class="hs-identifier">nestTcS</span><span> </span><span class="hs-glyph">::</span><span>  </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203538"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203538"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2544"></a><span class="hs-comment">-- Use the current untouchables, augmenting the current</span><span>
</span><a name="line-2545"></a><span class="hs-comment">-- evidence bindings, and solved dictionaries</span><span>
</span><a name="line-2546"></a><span class="hs-comment">-- But have no effect on the InertCans, or on the inert_flat_cache</span><span>
</span><a name="line-2547"></a><span class="hs-comment">--  (the latter because the thing inside a nestTcS does unflattening)</span><span>
</span><a name="line-2548"></a><a name="nestTcS"><a href="TcSMonad.html#nestTcS"><span class="hs-identifier">nestTcS</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a name="local-1628204134"><a href="#local-1628204134"><span class="hs-identifier">thing_inside</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2549"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204135"><a href="#local-1628204135"><span class="hs-identifier">env</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcSMonad.html#TcSEnv"><span class="hs-identifier hs-var">TcSEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcs_inerts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204136"><a href="#local-1628204136"><span class="hs-identifier">inerts_var</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2550"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204137"><a href="#local-1628204137"><span class="hs-identifier">inerts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204136"><span class="hs-identifier hs-var">inerts_var</span></a><span>
</span><a name="line-2551"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204138"><a href="#local-1628204138"><span class="hs-identifier">new_inert_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><a href="#local-1628204137"><span class="hs-identifier hs-var">inerts</span></a><span>
</span><a name="line-2552"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204139"><a href="#local-1628204139"><span class="hs-identifier">new_wl_var</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><a href="TcSMonad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a><span>
</span><a name="line-2553"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204140"><a href="#local-1628204140"><span class="hs-identifier">nest_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204135"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcs_inerts</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204138"><span class="hs-identifier hs-var">new_inert_var</span></a><span>
</span><a name="line-2554"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcs_worklist</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204139"><span class="hs-identifier hs-var">new_wl_var</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2555"></a><span>
</span><a name="line-2556"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204141"><a href="#local-1628204141"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204134"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-1628204140"><span class="hs-identifier hs-var">nest_env</span></a><span>
</span><a name="line-2557"></a><span>
</span><a name="line-2558"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204142"><a href="#local-1628204142"><span class="hs-identifier">new_inerts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204138"><span class="hs-identifier hs-var">new_inert_var</span></a><span>
</span><a name="line-2559"></a><span>
</span><a name="line-2560"></a><span>       </span><span class="hs-comment">-- we want to propogate the safe haskell failures</span><span>
</span><a name="line-2561"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204143"><a href="#local-1628204143"><span class="hs-identifier">old_ic</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">inert_cans</span><span> </span><a href="#local-1628204137"><span class="hs-identifier hs-var">inerts</span></a><span>
</span><a name="line-2562"></a><span>             </span><a name="local-1628204144"><a href="#local-1628204144"><span class="hs-identifier">new_ic</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">inert_cans</span><span> </span><a href="#local-1628204142"><span class="hs-identifier hs-var">new_inerts</span></a><span>
</span><a name="line-2563"></a><span>             </span><a name="local-1628204145"><a href="#local-1628204145"><span class="hs-identifier">nxt_ic</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204143"><span class="hs-identifier hs-var">old_ic</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_safehask</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">inert_safehask</span><span> </span><a href="#local-1628204144"><span class="hs-identifier hs-var">new_ic</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2564"></a><span>
</span><a name="line-2565"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><a href="#local-1628204136"><span class="hs-identifier hs-var">inerts_var</span></a><span>  </span><span class="hs-comment">-- See Note [Propagate the solved dictionaries]</span><span>
</span><a name="line-2566"></a><span>                        </span><span class="hs-special">(</span><a href="#local-1628204137"><span class="hs-identifier hs-var">inerts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_solved_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">inert_solved_dicts</span><span> </span><a href="#local-1628204142"><span class="hs-identifier hs-var">new_inerts</span></a><span>
</span><a name="line-2567"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">inert_cans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204145"><span class="hs-identifier hs-var">nxt_ic</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2568"></a><span>
</span><a name="line-2569"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628204141"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2570"></a><span>
</span><a name="line-2571"></a><span class="hs-comment">{-
Note [Propagate the solved dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's really quite important that nestTcS does not discard the solved
dictionaries from the thing_inside.
Consider
   Eq [a]
   forall b. empty =&gt;  Eq [a]
We solve the simple (Eq [a]), under nestTcS, and then turn our attention to
the implications.  It's definitely fine to use the solved dictionaries on
the inner implications, and it can make a signficant performance difference
if you do so.
-}</span><span>
</span><a name="line-2584"></a><span>
</span><a name="line-2585"></a><span class="hs-comment">-- Getters and setters of TcEnv fields</span><span>
</span><a name="line-2586"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-2587"></a><span>
</span><a name="line-2588"></a><span class="hs-comment">-- Getter of inerts and worklist</span><span>
</span><a name="line-2589"></a><span class="hs-identifier">getTcSInertsRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><a href="TcSMonad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a><span class="hs-special">)</span><span>
</span><a name="line-2590"></a><a name="getTcSInertsRef"><a href="TcSMonad.html#getTcSInertsRef"><span class="hs-identifier">getTcSInertsRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">tcs_inerts</span><span class="hs-special">)</span><span>
</span><a name="line-2591"></a><span>
</span><a name="line-2592"></a><span class="hs-identifier">getTcSWorkListRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span class="hs-special">)</span><span>
</span><a name="line-2593"></a><a name="getTcSWorkListRef"><a href="TcSMonad.html#getTcSWorkListRef"><span class="hs-identifier">getTcSWorkListRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">tcs_worklist</span><span class="hs-special">)</span><span>
</span><a name="line-2594"></a><span>
</span><a name="line-2595"></a><span class="hs-identifier">getTcSInerts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcSMonad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a><span>
</span><a name="line-2596"></a><a name="getTcSInerts"><a href="TcSMonad.html#getTcSInerts"><span class="hs-identifier">getTcSInerts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#getTcSInertsRef"><span class="hs-identifier hs-var">getTcSInertsRef</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span class="hs-special">)</span><span>
</span><a name="line-2597"></a><span>
</span><a name="line-2598"></a><span class="hs-identifier">setTcSInerts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2599"></a><a name="setTcSInerts"><a href="TcSMonad.html#setTcSInerts"><span class="hs-identifier">setTcSInerts</span></a></a><span> </span><a name="local-1628204146"><a href="#local-1628204146"><span class="hs-identifier">ics</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204147"><a href="#local-1628204147"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcSInertsRef"><span class="hs-identifier hs-var">getTcSInertsRef</span></a><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><a href="#local-1628204147"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-1628204146"><span class="hs-identifier hs-var">ics</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2600"></a><span>
</span><a name="line-2601"></a><span class="hs-identifier">getWorkListImplics</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span class="hs-special">)</span><span>
</span><a name="line-2602"></a><a name="getWorkListImplics"><a href="TcSMonad.html#getWorkListImplics"><span class="hs-identifier">getWorkListImplics</span></a></a><span>
</span><a name="line-2603"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204148"><a href="#local-1628204148"><span class="hs-identifier">wl_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a><span>
</span><a name="line-2604"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204149"><a href="#local-1628204149"><span class="hs-identifier">wl_curr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204148"><span class="hs-identifier hs-var">wl_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-2605"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">wl_implics</span><span> </span><a href="#local-1628204149"><span class="hs-identifier hs-var">wl_curr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2606"></a><span>
</span><a name="line-2607"></a><span class="hs-identifier">updWorkListTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2608"></a><a name="updWorkListTcS"><a href="TcSMonad.html#updWorkListTcS"><span class="hs-identifier">updWorkListTcS</span></a></a><span> </span><a name="local-1628204150"><a href="#local-1628204150"><span class="hs-identifier">f</span></a></a><span>
</span><a name="line-2609"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204151"><a href="#local-1628204151"><span class="hs-identifier">wl_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a><span>
</span><a name="line-2610"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204152"><a href="#local-1628204152"><span class="hs-identifier">wl_curr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204151"><span class="hs-identifier hs-var">wl_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-2611"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204153"><a href="#local-1628204153"><span class="hs-identifier">new_work</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204150"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1628204152"><span class="hs-identifier hs-var">wl_curr</span></a><span>
</span><a name="line-2612"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><a href="#local-1628204151"><span class="hs-identifier hs-var">wl_var</span></a><span> </span><a href="#local-1628204153"><span class="hs-identifier hs-var">new_work</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2613"></a><span>
</span><a name="line-2614"></a><span class="hs-comment">-- | Should we keep solving even only deriveds are left?</span><span>
</span><a name="line-2615"></a><span class="hs-identifier">keepSolvingDeriveds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2616"></a><a name="keepSolvingDeriveds"><a href="TcSMonad.html#keepSolvingDeriveds"><span class="hs-identifier">keepSolvingDeriveds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">tcs_need_deriveds</span><span class="hs-special">)</span><span>
</span><a name="line-2617"></a><span>
</span><a name="line-2618"></a><span class="hs-identifier">emitWorkNC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2619"></a><a name="emitWorkNC"><a href="TcSMonad.html#emitWorkNC"><span class="hs-identifier">emitWorkNC</span></a></a><span> </span><a name="local-1628204154"><a href="#local-1628204154"><span class="hs-identifier">evs</span></a></a><span>
</span><a name="line-2620"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628204154"><span class="hs-identifier hs-var">evs</span></a><span>
</span><a name="line-2621"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2622"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2623"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="#local-1628204154"><span class="hs-identifier hs-var">evs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2624"></a><span>
</span><a name="line-2625"></a><span class="hs-identifier">emitWork</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2626"></a><a name="emitWork"><a href="TcSMonad.html#emitWork"><span class="hs-identifier">emitWork</span></a></a><span> </span><a name="local-1628204155"><a href="#local-1628204155"><span class="hs-identifier">cts</span></a></a><span>
</span><a name="line-2627"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;Emitting fresh work&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204155"><span class="hs-identifier hs-var">cts</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2628"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#extendWorkListCts"><span class="hs-identifier hs-var">extendWorkListCts</span></a><span> </span><a href="#local-1628204155"><span class="hs-identifier hs-var">cts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2629"></a><span>
</span><a name="line-2630"></a><span class="hs-identifier">emitInsoluble</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2631"></a><span class="hs-comment">-- Emits a non-canonical constraint that will stand for a frozen error in the inerts.</span><span>
</span><a name="line-2632"></a><a name="emitInsoluble"><a href="TcSMonad.html#emitInsoluble"><span class="hs-identifier">emitInsoluble</span></a></a><span> </span><a name="local-1628204156"><a href="#local-1628204156"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-2633"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;Emit insoluble&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204156"><span class="hs-identifier hs-var">ct</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="TcRnTypes.html#pprCtLoc"><span class="hs-identifier hs-var">pprCtLoc</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctLoc"><span class="hs-identifier hs-var">ctLoc</span></a><span> </span><a href="#local-1628204156"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2634"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a><span> </span><a href="#local-1628204158"><span class="hs-identifier hs-var">add_insol</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2635"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2636"></a><span>    </span><a name="local-1628204157"><a href="#local-1628204157"><span class="hs-identifier">this_pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a><span> </span><a href="#local-1628204156"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-2637"></a><span>    </span><a name="local-1628204158"><a href="#local-1628204158"><span class="hs-identifier">add_insol</span></a></a><span> </span><a name="local-1628204159"><a href="#local-1628204159"><span class="hs-identifier">is</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcSMonad.html#IS"><span class="hs-identifier hs-var">IS</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_cans</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204160"><a href="#local-1628204160"><span class="hs-identifier">ics</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcSMonad.html#IC"><span class="hs-identifier hs-var">IC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_insols</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204161"><a href="#local-1628204161"><span class="hs-identifier">old_insols</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2638"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628204162"><span class="hs-identifier hs-var">already_there</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204159"><span class="hs-identifier hs-var">is</span></a><span>
</span><a name="line-2639"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204159"><span class="hs-identifier hs-var">is</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_cans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204160"><span class="hs-identifier hs-var">ics</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_insols</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204161"><span class="hs-identifier hs-var">old_insols</span></a><span> </span><span class="hs-special">`</span><a href="TcRnTypes.html#snocCts"><span class="hs-identifier hs-var">snocCts</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628204156"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2640"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-2641"></a><span>        </span><a name="local-1628204162"><a href="#local-1628204162"><span class="hs-identifier">already_there</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isWantedCt"><span class="hs-identifier hs-var">isWantedCt</span></a><span> </span><a href="#local-1628204156"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Bag.html#anyBag"><span class="hs-identifier hs-var">anyBag</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#tcEqType"><span class="hs-identifier hs-var">tcEqType</span></a><span> </span><a href="#local-1628204157"><span class="hs-identifier hs-var">this_pred</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcRnTypes.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204161"><span class="hs-identifier hs-var">old_insols</span></a><span>
</span><a name="line-2642"></a><span>             </span><span class="hs-comment">-- See Note [Do not add duplicate derived insolubles]</span><span>
</span><a name="line-2643"></a><span>
</span><a name="line-2644"></a><span class="hs-identifier">newTcRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1628203537"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="#local-1628203537"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-2645"></a><a name="newTcRef"><a href="TcSMonad.html#newTcRef"><span class="hs-identifier">newTcRef</span></a></a><span> </span><a name="local-1628204163"><a href="#local-1628204163"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><a href="#local-1628204163"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-2646"></a><span>
</span><a name="line-2647"></a><span class="hs-identifier">readTcRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="#local-1628203536"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203536"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2648"></a><a name="readTcRef"><a href="TcSMonad.html#readTcRef"><span class="hs-identifier">readTcRef</span></a></a><span> </span><a name="local-1628204164"><a href="#local-1628204164"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204164"><span class="hs-identifier hs-var">ref</span></a><span class="hs-special">)</span><span>
</span><a name="line-2649"></a><span>
</span><a name="line-2650"></a><span class="hs-identifier">updTcRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="#local-1628203535"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1628203535"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><a href="#local-1628203535"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2651"></a><a name="updTcRef"><a href="TcSMonad.html#updTcRef"><span class="hs-identifier">updTcRef</span></a></a><span> </span><a name="local-1628204165"><a href="#local-1628204165"><span class="hs-identifier">ref</span></a></a><span> </span><a name="local-1628204166"><a href="#local-1628204166"><span class="hs-identifier">upd_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#updTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">updTcRef</span></a><span> </span><a href="#local-1628204165"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="#local-1628204166"><span class="hs-identifier hs-var">upd_fn</span></a><span class="hs-special">)</span><span>
</span><a name="line-2652"></a><span>
</span><a name="line-2653"></a><span class="hs-identifier">getTcEvBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcEvidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2654"></a><a name="getTcEvBinds"><a href="TcSMonad.html#getTcEvBinds"><span class="hs-identifier">getTcEvBinds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">tcs_ev_binds</span><span class="hs-special">)</span><span>
</span><a name="line-2655"></a><span>
</span><a name="line-2656"></a><span class="hs-identifier">getTcEvBindsFromVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcEvidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcEvidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a><span class="hs-special">)</span><span>
</span><a name="line-2657"></a><a name="getTcEvBindsFromVar"><a href="TcSMonad.html#getTcEvBindsFromVar"><span class="hs-identifier">getTcEvBindsFromVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcRnMonad.html#getTcEvBinds"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getTcEvBinds</span></a><span>
</span><a name="line-2658"></a><span>
</span><a name="line-2659"></a><span class="hs-identifier">getTcLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>
</span><a name="line-2660"></a><a name="getTcLevel"><a href="TcSMonad.html#getTcLevel"><span class="hs-identifier">getTcLevel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="TcRnMonad.html#getTcLevel"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getTcLevel</span></a><span>
</span><a name="line-2661"></a><span>
</span><a name="line-2662"></a><span class="hs-identifier">getTcEvBindsMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcEvidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a><span>
</span><a name="line-2663"></a><a name="getTcEvBindsMap"><a href="TcSMonad.html#getTcEvBindsMap"><span class="hs-identifier">getTcEvBindsMap</span></a></a><span>
</span><a name="line-2664"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204167"><a href="#local-1628204167"><span class="hs-identifier">ev_binds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcEvBinds"><span class="hs-identifier hs-var">getTcEvBinds</span></a><span>
</span><a name="line-2665"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204167"><span class="hs-identifier hs-var">ev_binds</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2666"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#EvBindsVar"><span class="hs-identifier hs-var">EvBindsVar</span></a><span> </span><a name="local-1628204168"><a href="#local-1628204168"><span class="hs-identifier">ev_ref</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204168"><span class="hs-identifier hs-var">ev_ref</span></a><span>
</span><a name="line-2667"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="TcEvidence.html#emptyEvBindMap"><span class="hs-identifier hs-var">emptyEvBindMap</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2668"></a><span>
</span><a name="line-2669"></a><span class="hs-identifier">unifyTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2670"></a><span class="hs-comment">-- Unify a meta-tyvar with a type</span><span>
</span><a name="line-2671"></a><span class="hs-comment">-- We keep track of how many unifications have happened in tcs_unified,</span><span>
</span><a name="line-2672"></a><span class="hs-comment">--</span><span>
</span><a name="line-2673"></a><span class="hs-comment">-- We should never unify the same variable twice!</span><span>
</span><a name="line-2674"></a><a name="unifyTyVar"><a href="TcSMonad.html#unifyTyVar"><span class="hs-identifier">unifyTyVar</span></a></a><span> </span><a name="local-1628204169"><a href="#local-1628204169"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1628204170"><a href="#local-1628204170"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2675"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isMetaTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2676"></a><span>    </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204171"><a href="#local-1628204171"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2677"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;unifyTyVar&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204169"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;:=&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204170"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2678"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#writeMetaTyVar"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeMetaTyVar</span></a><span> </span><a href="#local-1628204169"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1628204170"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2679"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#updTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">updTcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcs_unified</span><span> </span><a href="#local-1628204171"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2680"></a><span>
</span><a name="line-2681"></a><span class="hs-identifier">unflattenFmv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2682"></a><span class="hs-comment">-- Fill a flatten-meta-var, simply by unifying it.</span><span>
</span><a name="line-2683"></a><span class="hs-comment">-- This does NOT count as a unification in tcs_unified.</span><span>
</span><a name="line-2684"></a><a name="unflattenFmv"><a href="TcSMonad.html#unflattenFmv"><span class="hs-identifier">unflattenFmv</span></a></a><span> </span><a name="local-1628204172"><a href="#local-1628204172"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1628204173"><a href="#local-1628204173"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2685"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isMetaTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2686"></a><span>    </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2687"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;unflattenFmv&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204172"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;:=&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204173"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2688"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#writeMetaTyVar"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeMetaTyVar</span></a><span> </span><a href="#local-1628204172"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1628204173"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2689"></a><span>
</span><a name="line-2690"></a><span class="hs-identifier">reportUnifications</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="#local-1628203534"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="#local-1628203534"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-2691"></a><a name="reportUnifications"><a href="TcSMonad.html#reportUnifications"><span class="hs-identifier">reportUnifications</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a name="local-1628204174"><a href="#local-1628204174"><span class="hs-identifier">thing_inside</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2692"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204175"><a href="#local-1628204175"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2693"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204176"><a href="#local-1628204176"><span class="hs-identifier">inner_unified</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2694"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204177"><a href="#local-1628204177"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204174"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204175"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcs_unified</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204176"><span class="hs-identifier hs-var">inner_unified</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2695"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204178"><a href="#local-1628204178"><span class="hs-identifier">n_unifs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204176"><span class="hs-identifier hs-var">inner_unified</span></a><span>
</span><a name="line-2696"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#updTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">updTcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcs_unified</span><span> </span><a href="#local-1628204175"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="#local-1628204178"><span class="hs-identifier hs-var">n_unifs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2697"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204178"><span class="hs-identifier hs-var">n_unifs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204177"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2698"></a><span>
</span><a name="line-2699"></a><span class="hs-identifier">getDefaultInfo</span><span> </span><span class="hs-glyph">::</span><span>  </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2700"></a><a name="getDefaultInfo"><a href="TcSMonad.html#getDefaultInfo"><span class="hs-identifier">getDefaultInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="TcEnv.html#tcGetDefaultTys"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">tcGetDefaultTys</span></a><span>
</span><a name="line-2701"></a><span>
</span><a name="line-2702"></a><span class="hs-comment">-- Just get some environments needed for instance looking up and matching</span><span>
</span><a name="line-2703"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-2704"></a><span>
</span><a name="line-2705"></a><span class="hs-identifier">getInstEnvs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="InstEnv.html#InstEnvs"><span class="hs-identifier hs-type">InstEnvs</span></a><span>
</span><a name="line-2706"></a><a name="getInstEnvs"><a href="TcSMonad.html#getInstEnvs"><span class="hs-identifier">getInstEnvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcEnv.html#tcGetInstEnvs"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">tcGetInstEnvs</span></a><span>
</span><a name="line-2707"></a><span>
</span><a name="line-2708"></a><span class="hs-identifier">getFamInstEnvs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a><span class="hs-special">,</span><span> </span><a href="FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2709"></a><a name="getFamInstEnvs"><a href="TcSMonad.html#getFamInstEnvs"><span class="hs-identifier">getFamInstEnvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="FamInst.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">FamInst</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a><span>
</span><a name="line-2710"></a><span>
</span><a name="line-2711"></a><span class="hs-identifier">getTopEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-2712"></a><a name="getTopEnv"><a href="TcSMonad.html#getTopEnv"><span class="hs-identifier">getTopEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#getTopEnv"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getTopEnv</span></a><span>
</span><a name="line-2713"></a><span>
</span><a name="line-2714"></a><span class="hs-identifier">getGblEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-2715"></a><a name="getGblEnv"><a href="TcSMonad.html#getGblEnv"><span class="hs-identifier">getGblEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-2716"></a><span>
</span><a name="line-2717"></a><span class="hs-identifier">getLclEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span>
</span><a name="line-2718"></a><a name="getLclEnv"><a href="TcSMonad.html#getLclEnv"><span class="hs-identifier">getLclEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getLclEnv</span></a><span>
</span><a name="line-2719"></a><span>
</span><a name="line-2720"></a><span class="hs-identifier">tcLookupClass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span>
</span><a name="line-2721"></a><a name="tcLookupClass"><a href="TcSMonad.html#tcLookupClass"><span class="hs-identifier">tcLookupClass</span></a></a><span> </span><a name="local-1628204179"><a href="#local-1628204179"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcEnv.html#tcLookupClass"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">tcLookupClass</span></a><span> </span><a href="#local-1628204179"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-2722"></a><span>
</span><a name="line-2723"></a><span class="hs-comment">-- Setting names as used (used in the deriving of Coercible evidence)</span><span>
</span><a name="line-2724"></a><span class="hs-comment">-- Too hackish to expose it to TcS? In that case somehow extract the used</span><span>
</span><a name="line-2725"></a><span class="hs-comment">-- constructors from the result of solveInteract</span><span>
</span><a name="line-2726"></a><span class="hs-identifier">addUsedDataCons</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2727"></a><a name="addUsedDataCons"><a href="TcSMonad.html#addUsedDataCons"><span class="hs-identifier">addUsedDataCons</span></a></a><span> </span><a name="local-1628204180"><a href="#local-1628204180"><span class="hs-identifier">rdr_env</span></a></a><span> </span><a name="local-1628204181"><a href="#local-1628204181"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="RnEnv.html#addUsedDataCons"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">addUsedDataCons</span></a><span> </span><a href="#local-1628204180"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-1628204181"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-2728"></a><span>
</span><a name="line-2729"></a><span class="hs-comment">-- Various smaller utilities [TODO, maybe will be absorbed in the instance matcher]</span><span>
</span><a name="line-2730"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-2731"></a><span>
</span><a name="line-2732"></a><span class="hs-identifier">checkWellStagedDFun</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2733"></a><a name="checkWellStagedDFun"><a href="TcSMonad.html#checkWellStagedDFun"><span class="hs-identifier">checkWellStagedDFun</span></a></a><span> </span><a name="local-1628204182"><a href="#local-1628204182"><span class="hs-identifier">pred</span></a></a><span> </span><a name="local-1628204183"><a href="#local-1628204183"><span class="hs-identifier">dfun_id</span></a></a><span> </span><a name="local-1628204184"><a href="#local-1628204184"><span class="hs-identifier">loc</span></a></a><span>
</span><a name="line-2734"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#setCtLocM"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">setCtLocM</span></a><span> </span><a href="#local-1628204184"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2735"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204187"><a href="#local-1628204187"><span class="hs-identifier">use_stage</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getStage"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getStage</span></a><span>
</span><a name="line-2736"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#checkWellStaged"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">checkWellStaged</span></a><span> </span><a href="#local-1628204185"><span class="hs-identifier hs-var">pp_thing</span></a><span> </span><a href="#local-1628204186"><span class="hs-identifier hs-var">bind_lvl</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#thLevel"><span class="hs-identifier hs-var">thLevel</span></a><span> </span><a href="#local-1628204187"><span class="hs-identifier hs-var">use_stage</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2737"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2738"></a><span>    </span><a name="local-1628204185"><a href="#local-1628204185"><span class="hs-identifier">pp_thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;instance for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204182"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">)</span><span>
</span><a name="line-2739"></a><span>    </span><a name="local-1628204186"><a href="#local-1628204186"><span class="hs-identifier">bind_lvl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcEnv.html#topIdLvl"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">topIdLvl</span></a><span> </span><a href="#local-1628204183"><span class="hs-identifier hs-var">dfun_id</span></a><span>
</span><a name="line-2740"></a><span>
</span><a name="line-2741"></a><span class="hs-identifier">pprEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2742"></a><a name="pprEq"><a href="TcSMonad.html#pprEq"><span class="hs-identifier">pprEq</span></a></a><span> </span><a name="local-1628204188"><a href="#local-1628204188"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1628204189"><a href="#local-1628204189"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a><span> </span><a href="#local-1628204188"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'~'</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a><span> </span><a href="#local-1628204189"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2743"></a><span>
</span><a name="line-2744"></a><span class="hs-identifier">isTouchableMetaTyVarTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2745"></a><a name="isTouchableMetaTyVarTcS"><a href="TcSMonad.html#isTouchableMetaTyVarTcS"><span class="hs-identifier">isTouchableMetaTyVarTcS</span></a></a><span> </span><a name="local-1628204190"><a href="#local-1628204190"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2746"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204191"><a href="#local-1628204191"><span class="hs-identifier">tclvl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a><span>
</span><a name="line-2747"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcType.html#isTouchableMetaTyVar"><span class="hs-identifier hs-var">isTouchableMetaTyVar</span></a><span> </span><a href="#local-1628204191"><span class="hs-identifier hs-var">tclvl</span></a><span> </span><a href="#local-1628204190"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2748"></a><span>
</span><a name="line-2749"></a><span class="hs-identifier">isFilledMetaTyVar_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-2750"></a><a name="isFilledMetaTyVar_maybe"><a href="TcSMonad.html#isFilledMetaTyVar_maybe"><span class="hs-identifier">isFilledMetaTyVar_maybe</span></a></a><span> </span><a name="local-1628204192"><a href="#local-1628204192"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2751"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-1628204192"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2752"></a><span>     </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204193"><a href="#local-1628204193"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2753"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204194"><a href="#local-1628204194"><span class="hs-identifier">cts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-1628204193"><span class="hs-identifier hs-var">ref</span></a><span class="hs-special">)</span><span>
</span><a name="line-2754"></a><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204194"><span class="hs-identifier hs-var">cts</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2755"></a><span>                  </span><a href="TcType.html#Indirect"><span class="hs-identifier hs-var">Indirect</span></a><span> </span><a name="local-1628204195"><a href="#local-1628204195"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628204195"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2756"></a><span>                  </span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2757"></a><span>     </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-2758"></a><span>
</span><a name="line-2759"></a><span class="hs-identifier">isFilledMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2760"></a><a name="isFilledMetaTyVar"><a href="TcSMonad.html#isFilledMetaTyVar"><span class="hs-identifier">isFilledMetaTyVar</span></a></a><span> </span><a name="local-1628204196"><a href="#local-1628204196"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#isFilledMetaTyVar"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isFilledMetaTyVar</span></a><span> </span><a href="#local-1628204196"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2761"></a><span>
</span><a name="line-2762"></a><span class="hs-identifier">zonkTyCoVarsAndFV</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyCoVarSet"><span class="hs-identifier hs-type">TcTyCoVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcType.html#TcTyCoVarSet"><span class="hs-identifier hs-type">TcTyCoVarSet</span></a><span>
</span><a name="line-2763"></a><a name="zonkTyCoVarsAndFV"><a href="TcSMonad.html#zonkTyCoVarsAndFV"><span class="hs-identifier">zonkTyCoVarsAndFV</span></a></a><span> </span><a name="local-1628204197"><a href="#local-1628204197"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">zonkTyCoVarsAndFV</span></a><span> </span><a href="#local-1628204197"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2764"></a><span>
</span><a name="line-2765"></a><span class="hs-identifier">zonkCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2766"></a><a name="zonkCo"><a href="TcSMonad.html#zonkCo"><span class="hs-identifier">zonkCo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcMType.html#zonkCo"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">zonkCo</span></a><span>
</span><a name="line-2767"></a><span>
</span><a name="line-2768"></a><span class="hs-identifier">zonkTcType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-2769"></a><a name="zonkTcType"><a href="TcSMonad.html#zonkTcType"><span class="hs-identifier">zonkTcType</span></a></a><span> </span><a name="local-1628204198"><a href="#local-1628204198"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-1628204198"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2770"></a><span>
</span><a name="line-2771"></a><span class="hs-identifier">zonkTcTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span>
</span><a name="line-2772"></a><a name="zonkTcTypes"><a href="TcSMonad.html#zonkTcTypes"><span class="hs-identifier">zonkTcTypes</span></a></a><span> </span><a name="local-1628204199"><a href="#local-1628204199"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#zonkTcTypes"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">zonkTcTypes</span></a><span> </span><a href="#local-1628204199"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2773"></a><span>
</span><a name="line-2774"></a><span class="hs-identifier">zonkTcTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-2775"></a><a name="zonkTcTyVar"><a href="TcSMonad.html#zonkTcTyVar"><span class="hs-identifier">zonkTcTyVar</span></a></a><span> </span><a name="local-1628204200"><a href="#local-1628204200"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">zonkTcTyVar</span></a><span> </span><a href="#local-1628204200"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2776"></a><span>
</span><a name="line-2777"></a><span class="hs-identifier">zonkSimples</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-2778"></a><a name="zonkSimples"><a href="TcSMonad.html#zonkSimples"><span class="hs-identifier">zonkSimples</span></a></a><span> </span><a name="local-1628204201"><a href="#local-1628204201"><span class="hs-identifier">cts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#zonkSimples"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">zonkSimples</span></a><span> </span><a href="#local-1628204201"><span class="hs-identifier hs-var">cts</span></a><span class="hs-special">)</span><span>
</span><a name="line-2779"></a><span>
</span><a name="line-2780"></a><span class="hs-identifier">zonkWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-2781"></a><a name="zonkWC"><a href="TcSMonad.html#zonkWC"><span class="hs-identifier">zonkWC</span></a></a><span> </span><a name="local-1628204202"><a href="#local-1628204202"><span class="hs-identifier">wc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#zonkWC"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">zonkWC</span></a><span> </span><a href="#local-1628204202"><span class="hs-identifier hs-var">wc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2782"></a><span>
</span><a name="line-2783"></a><span class="hs-comment">{-
Note [Do not add duplicate derived insolubles]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In general we *must* add an insoluble (Int ~ Bool) even if there is
one such there already, because they may come from distinct call
sites.  Not only do we want an error message for each, but with
-fdefer-type-errors we must generate evidence for each.  But for
*derived* insolubles, we only want to report each one once.  Why?

(a) A constraint (C r s t) where r -&gt; s, say, may generate the same fundep
    equality many times, as the original constraint is successively rewritten.

(b) Ditto the successive iterations of the main solver itself, as it traverses
    the constraint tree. See example below.

Also for *given* insolubles we may get repeated errors, as we
repeatedly traverse the constraint tree.  These are relatively rare
anyway, so removing duplicates seems ok.  (Alternatively we could take
the SrcLoc into account.)

Note that the test does not need to be particularly efficient because
it is only used if the program has a type error anyway.

Example of (b): assume a top-level class and instance declaration:

  class D a b | a -&gt; b
  instance D [a] [a]

Assume we have started with an implication:

  forall c. Eq c =&gt; { wc_simple = D [c] c [W] }

which we have simplified to:

  forall c. Eq c =&gt; { wc_simple = D [c] c [W]
                    , wc_insols = (c ~ [c]) [D] }

For some reason, e.g. because we floated an equality somewhere else,
we might try to re-solve this implication. If we do not do a
dropDerivedWC, then we will end up trying to solve the following
constraints the second time:

  (D [c] c) [W]
  (c ~ [c]) [D]

which will result in two Deriveds to end up in the insoluble set:

  wc_simple   = D [c] c [W]
  wc_insols = (c ~ [c]) [D], (c ~ [c]) [D]
-}</span><span>
</span><a name="line-2833"></a><span>
</span><a name="line-2834"></a><span class="hs-comment">-- Flatten skolems</span><span>
</span><a name="line-2835"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-2836"></a><span class="hs-identifier">newFlattenSkolem</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-2837"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>         </span><span class="hs-comment">-- F xis</span><span>
</span><a name="line-2838"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- [W] x:: F xis ~ fsk</span><span>
</span><a name="line-2839"></a><a name="newFlattenSkolem"><a href="TcSMonad.html#newFlattenSkolem"><span class="hs-identifier">newFlattenSkolem</span></a></a><span> </span><a href="TcRnTypes.html#Given"><span class="hs-identifier hs-var">Given</span></a><span> </span><a name="local-1628204203"><a href="#local-1628204203"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204204"><a href="#local-1628204204"><span class="hs-identifier">fam_ty</span></a></a><span>
</span><a name="line-2840"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204205"><a href="#local-1628204205"><span class="hs-identifier">fsk</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newFsk"><span class="hs-identifier hs-var">newFsk</span></a><span> </span><a href="#local-1628204204"><span class="hs-identifier hs-var">fam_ty</span></a><span>
</span><a name="line-2841"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204206"><a href="#local-1628204206"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="#local-1628204204"><span class="hs-identifier hs-var">fam_ty</span></a><span>
</span><a name="line-2842"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204207"><a href="#local-1628204207"><span class="hs-identifier">ev</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a><span> </span><a href="#local-1628204203"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a><span> </span><a href="#local-1628204204"><span class="hs-identifier hs-var">fam_ty</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1628204205"><span class="hs-identifier hs-var">fsk</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2843"></a><span>                                   </span><a href="TcEvidence.html#EvCoercion"><span class="hs-identifier hs-var">EvCoercion</span></a><span> </span><a href="#local-1628204206"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2844"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204207"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204206"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204205"><span class="hs-identifier hs-var">fsk</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2845"></a><span>
</span><a name="line-2846"></a><span class="hs-identifier">newFlattenSkolem</span><span> </span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a name="local-1628204208"><a href="#local-1628204208"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204209"><a href="#local-1628204209"><span class="hs-identifier">fam_ty</span></a></a><span>
</span><a name="line-2847"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204210"><a href="#local-1628204210"><span class="hs-identifier">fmv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newFmv"><span class="hs-identifier hs-var">newFmv</span></a><span> </span><a href="#local-1628204209"><span class="hs-identifier hs-var">fam_ty</span></a><span>
</span><a name="line-2848"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204211"><a href="#local-1628204211"><span class="hs-identifier">ev</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204212"><a href="#local-1628204212"><span class="hs-identifier">hole_co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a><span> </span><a href="#local-1628204208"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-1628204209"><span class="hs-identifier hs-var">fam_ty</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1628204210"><span class="hs-identifier hs-var">fmv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2849"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204211"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204212"><span class="hs-identifier hs-var">hole_co</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204210"><span class="hs-identifier hs-var">fmv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2850"></a><span>
</span><a name="line-2851"></a><span class="hs-identifier">newFlattenSkolem</span><span> </span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span> </span><a name="local-1628204213"><a href="#local-1628204213"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204214"><a href="#local-1628204214"><span class="hs-identifier">fam_ty</span></a></a><span>
</span><a name="line-2852"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204215"><a href="#local-1628204215"><span class="hs-identifier">fmv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newFmv"><span class="hs-identifier hs-var">newFmv</span></a><span> </span><a href="#local-1628204214"><span class="hs-identifier hs-var">fam_ty</span></a><span>
</span><a name="line-2853"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204216"><a href="#local-1628204216"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newDerivedNC"><span class="hs-identifier hs-var">newDerivedNC</span></a><span> </span><a href="#local-1628204213"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a><span> </span><a href="#local-1628204214"><span class="hs-identifier hs-var">fam_ty</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1628204215"><span class="hs-identifier hs-var">fmv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2854"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628204216"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;newFlattenSkolem [D]&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204214"><span class="hs-identifier hs-var">fam_ty</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628204215"><span class="hs-identifier hs-var">fmv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2855"></a><span>
</span><a name="line-2856"></a><span class="hs-identifier">newFsk</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">newFmv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-2857"></a><a name="newFsk"><a href="TcSMonad.html#newFsk"><span class="hs-identifier">newFsk</span></a></a><span> </span><a name="local-1628204217"><a href="#local-1628204217"><span class="hs-identifier">fam_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#newFskTyVar"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newFskTyVar</span></a><span> </span><a href="#local-1628204217"><span class="hs-identifier hs-var">fam_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2858"></a><a name="newFmv"><a href="TcSMonad.html#newFmv"><span class="hs-identifier">newFmv</span></a></a><span> </span><a name="local-1628204218"><a href="#local-1628204218"><span class="hs-identifier">fam_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#newFmvTyVar"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newFmvTyVar</span></a><span> </span><a href="#local-1628204218"><span class="hs-identifier hs-var">fam_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2859"></a><span>
</span><a name="line-2860"></a><span class="hs-identifier">extendFlatCache</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2861"></a><a name="extendFlatCache"><a href="TcSMonad.html#extendFlatCache"><span class="hs-identifier">extendFlatCache</span></a></a><span> </span><a name="local-1628204219"><a href="#local-1628204219"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1628204220"><a href="#local-1628204220"><span class="hs-identifier">xi_args</span></a></a><span> </span><a name="local-1628204221"><a href="#local-1628204221"><span class="hs-identifier">stuff</span></a></a><span>
</span><a name="line-2862"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204222"><a href="#local-1628204222"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-2863"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_FlatCache"><span class="hs-identifier hs-var">Opt_FlatCache</span></a><span> </span><a href="#local-1628204222"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2864"></a><span>         </span><a href="TcSMonad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1628204223"><a href="#local-1628204223"><span class="hs-identifier">is</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcSMonad.html#IS"><span class="hs-identifier hs-var">IS</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_flat_cache</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204224"><a href="#local-1628204224"><span class="hs-identifier">fc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2865"></a><span>            </span><a href="#local-1628204223"><span class="hs-identifier hs-var">is</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inert_flat_cache</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#insertExactFunEq"><span class="hs-identifier hs-var">insertExactFunEq</span></a><span> </span><a href="#local-1628204224"><span class="hs-identifier hs-var">fc</span></a><span> </span><a href="#local-1628204219"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1628204220"><span class="hs-identifier hs-var">xi_args</span></a><span> </span><a href="#local-1628204221"><span class="hs-identifier hs-var">stuff</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2866"></a><span>
</span><a name="line-2867"></a><span class="hs-comment">-- Instantiations</span><span>
</span><a name="line-2868"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-2869"></a><span>
</span><a name="line-2870"></a><span class="hs-identifier">instDFunType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#DFunInstType"><span class="hs-identifier hs-type">DFunInstType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span class="hs-special">)</span><span>
</span><a name="line-2871"></a><a name="instDFunType"><a href="TcSMonad.html#instDFunType"><span class="hs-identifier">instDFunType</span></a></a><span> </span><a name="local-1628204225"><a href="#local-1628204225"><span class="hs-identifier">dfun_id</span></a></a><span> </span><a name="local-1628204226"><a href="#local-1628204226"><span class="hs-identifier">inst_tys</span></a></a><span>
</span><a name="line-2872"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Inst.html#instDFunType"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">instDFunType</span></a><span> </span><a href="#local-1628204225"><span class="hs-identifier hs-var">dfun_id</span></a><span> </span><a href="#local-1628204226"><span class="hs-identifier hs-var">inst_tys</span></a><span>
</span><a name="line-2873"></a><span>
</span><a name="line-2874"></a><span class="hs-identifier">newFlexiTcSTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-2875"></a><a name="newFlexiTcSTy"><a href="TcSMonad.html#newFlexiTcSTy"><span class="hs-identifier">newFlexiTcSTy</span></a></a><span> </span><a name="local-1628204227"><a href="#local-1628204227"><span class="hs-identifier">knd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span> </span><a href="#local-1628204227"><span class="hs-identifier hs-var">knd</span></a><span class="hs-special">)</span><span>
</span><a name="line-2876"></a><span>
</span><a name="line-2877"></a><span class="hs-identifier">cloneMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-2878"></a><a name="cloneMetaTyVar"><a href="TcSMonad.html#cloneMetaTyVar"><span class="hs-identifier">cloneMetaTyVar</span></a></a><span> </span><a name="local-1628204228"><a href="#local-1628204228"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#cloneMetaTyVar"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">cloneMetaTyVar</span></a><span> </span><a href="#local-1628204228"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2879"></a><span>
</span><a name="line-2880"></a><span class="hs-identifier">demoteUnfilledFmv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2881"></a><span class="hs-comment">-- If a flatten-meta-var is still un-filled,</span><span>
</span><a name="line-2882"></a><span class="hs-comment">-- turn it into an ordinary meta-var</span><span>
</span><a name="line-2883"></a><a name="demoteUnfilledFmv"><a href="TcSMonad.html#demoteUnfilledFmv"><span class="hs-identifier">demoteUnfilledFmv</span></a></a><span> </span><a name="local-1628204229"><a href="#local-1628204229"><span class="hs-identifier">fmv</span></a></a><span>
</span><a name="line-2884"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204230"><a href="#local-1628204230"><span class="hs-identifier">is_filled</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#isFilledMetaTyVar"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isFilledMetaTyVar</span></a><span> </span><a href="#local-1628204229"><span class="hs-identifier hs-var">fmv</span></a><span>
</span><a name="line-2885"></a><span>                 </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><a href="#local-1628204230"><span class="hs-identifier hs-var">is_filled</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2886"></a><span>                   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204231"><a href="#local-1628204231"><span class="hs-identifier">tv_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1628204229"><span class="hs-identifier hs-var">fmv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2887"></a><span>                      </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#writeMetaTyVar"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeMetaTyVar</span></a><span> </span><a href="#local-1628204229"><span class="hs-identifier hs-var">fmv</span></a><span> </span><a href="#local-1628204231"><span class="hs-identifier hs-var">tv_ty</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2888"></a><span>
</span><a name="line-2889"></a><span class="hs-identifier">instFlexiTcS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TKVar"><span class="hs-identifier hs-type">TKVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2890"></a><a name="instFlexiTcS"><a href="TcSMonad.html#instFlexiTcS"><span class="hs-identifier">instFlexiTcS</span></a></a><span> </span><a name="local-1628204232"><a href="#local-1628204232"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="MonadUtils.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a><span> </span><a href="#local-1628204233"><span class="hs-identifier hs-var">inst_one</span></a><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span> </span><a href="#local-1628204232"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2891"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2892"></a><span>     </span><a name="local-1628204233"><a href="#local-1628204233"><span class="hs-identifier">inst_one</span></a></a><span> </span><a name="local-1628204234"><a href="#local-1628204234"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1628204235"><a href="#local-1628204235"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2893"></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204236"><a href="#local-1628204236"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#instFlexiTcSHelper"><span class="hs-identifier hs-var">instFlexiTcSHelper</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-1628204235"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2894"></a><span>                                          </span><span class="hs-special">(</span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span> </span><a href="#local-1628204234"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1628204235"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2895"></a><span>              </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a><span> </span><a href="#local-1628204234"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628204235"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1628204236"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628204236"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2896"></a><span>
</span><a name="line-2897"></a><span class="hs-identifier">instFlexiTcSHelper</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-2898"></a><a name="instFlexiTcSHelper"><a href="TcSMonad.html#instFlexiTcSHelper"><span class="hs-identifier">instFlexiTcSHelper</span></a></a><span> </span><a name="local-1628204237"><a href="#local-1628204237"><span class="hs-identifier">tvname</span></a></a><span> </span><a name="local-1628204238"><a href="#local-1628204238"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-2899"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204239"><a href="#local-1628204239"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-2900"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204240"><a href="#local-1628204240"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newMetaDetails</span></a><span> </span><a href="TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a><span>
</span><a name="line-2901"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204241"><a href="#local-1628204241"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#setNameUnique"><span class="hs-identifier hs-var">setNameUnique</span></a><span> </span><a href="#local-1628204237"><span class="hs-identifier hs-var">tvname</span></a><span> </span><a href="#local-1628204239"><span class="hs-identifier hs-var">uniq</span></a><span>
</span><a name="line-2902"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-1628204241"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1628204238"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="#local-1628204240"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2903"></a><span>
</span><a name="line-2904"></a><span>
</span><a name="line-2905"></a><span>
</span><a name="line-2906"></a><span class="hs-comment">-- Creating and setting evidence variables and CtFlavors</span><span>
</span><a name="line-2907"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-2908"></a><span>
</span><a name="line-2909"></a><span class="hs-keyword">data</span><span> </span><a name="MaybeNew"><a href="TcSMonad.html#MaybeNew"><span class="hs-identifier">MaybeNew</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Fresh"><a href="TcSMonad.html#Fresh"><span class="hs-identifier">Fresh</span></a></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Cached"><a href="TcSMonad.html#Cached"><span class="hs-identifier">Cached</span></a></a><span> </span><a href="TcEvidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a><span>
</span><a name="line-2910"></a><span>
</span><a name="line-2911"></a><span class="hs-identifier">isFresh</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2912"></a><a name="isFresh"><a href="TcSMonad.html#isFresh"><span class="hs-identifier">isFresh</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#Fresh"><span class="hs-identifier hs-var">Fresh</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2913"></a><span class="hs-identifier">isFresh</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#Cached"><span class="hs-identifier hs-var">Cached</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2914"></a><span>
</span><a name="line-2915"></a><span class="hs-identifier">freshGoals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcSMonad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">]</span><span>
</span><a name="line-2916"></a><a name="freshGoals"><a href="TcSMonad.html#freshGoals"><span class="hs-identifier">freshGoals</span></a></a><span> </span><a name="local-1628204242"><a href="#local-1628204242"><span class="hs-identifier">mns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628204243"><span class="hs-identifier hs-var">ctev</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TcSMonad.html#Fresh"><span class="hs-identifier hs-var">Fresh</span></a><span> </span><a name="local-1628204243"><a href="#local-1628204243"><span class="hs-identifier">ctev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628204242"><span class="hs-identifier hs-var">mns</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2917"></a><span>
</span><a name="line-2918"></a><span class="hs-identifier">getEvTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEvidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a><span>
</span><a name="line-2919"></a><a name="getEvTerm"><a href="TcSMonad.html#getEvTerm"><span class="hs-identifier">getEvTerm</span></a></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#Fresh"><span class="hs-identifier hs-var">Fresh</span></a><span> </span><a name="local-1628204244"><a href="#local-1628204244"><span class="hs-identifier">ctev</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvTerm"><span class="hs-identifier hs-var">ctEvTerm</span></a><span> </span><a href="#local-1628204244"><span class="hs-identifier hs-var">ctev</span></a><span>
</span><a name="line-2920"></a><span class="hs-identifier">getEvTerm</span><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#Cached"><span class="hs-identifier hs-var">Cached</span></a><span> </span><a name="local-1628204245"><a href="#local-1628204245"><span class="hs-identifier">evt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204245"><span class="hs-identifier hs-var">evt</span></a><span>
</span><a name="line-2921"></a><span>
</span><a name="line-2922"></a><span class="hs-identifier">setEvBind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcEvidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2923"></a><a name="setEvBind"><a href="TcSMonad.html#setEvBind"><span class="hs-identifier">setEvBind</span></a></a><span> </span><a name="local-1628204246"><a href="#local-1628204246"><span class="hs-identifier">ev_bind</span></a></a><span>
</span><a name="line-2924"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204247"><a href="#local-1628204247"><span class="hs-identifier">tc_evbinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getTcEvBinds"><span class="hs-identifier hs-var">getTcEvBinds</span></a><span>
</span><a name="line-2925"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204247"><span class="hs-identifier hs-var">tc_evbinds</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2926"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628204248"><a href="#local-1628204248"><span class="hs-identifier">evb</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#addTcEvBind"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">addTcEvBind</span></a><span> </span><a href="#local-1628204248"><span class="hs-identifier hs-var">evb</span></a><span> </span><a href="#local-1628204246"><span class="hs-identifier hs-var">ev_bind</span></a><span>
</span><a name="line-2927"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;setEvBind&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204246"><span class="hs-identifier hs-var">ev_bind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2928"></a><span>
</span><a name="line-2929"></a><span class="hs-comment">-- | Equalities only</span><span>
</span><a name="line-2930"></a><span class="hs-identifier">setWantedEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcEvDest"><span class="hs-identifier hs-type">TcEvDest</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2931"></a><a name="setWantedEq"><a href="TcSMonad.html#setWantedEq"><span class="hs-identifier">setWantedEq</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a><span> </span><a name="local-1628204249"><a href="#local-1628204249"><span class="hs-identifier">hole</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628204250"><a href="#local-1628204250"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-2932"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#useVars"><span class="hs-identifier hs-var">useVars</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a><span> </span><a href="#local-1628204250"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2933"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcMType.html#fillCoercionHole"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fillCoercionHole</span></a><span> </span><a href="#local-1628204249"><span class="hs-identifier hs-var">hole</span></a><span> </span><a href="#local-1628204250"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2934"></a><span class="hs-identifier">setWantedEq</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a><span> </span><a name="local-1628204251"><a href="#local-1628204251"><span class="hs-identifier">ev</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;setWantedEq&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204251"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-2935"></a><span>
</span><a name="line-2936"></a><span class="hs-comment">-- | Equalities only</span><span>
</span><a name="line-2937"></a><span class="hs-identifier">setEqIfWanted</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2938"></a><a name="setEqIfWanted"><a href="TcSMonad.html#setEqIfWanted"><span class="hs-identifier">setEqIfWanted</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204252"><a href="#local-1628204252"><span class="hs-identifier">dest</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628204253"><a href="#local-1628204253"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#setWantedEq"><span class="hs-identifier hs-var">setWantedEq</span></a><span> </span><a href="#local-1628204252"><span class="hs-identifier hs-var">dest</span></a><span> </span><a href="#local-1628204253"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2939"></a><span class="hs-identifier">setEqIfWanted</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2940"></a><span>
</span><a name="line-2941"></a><span class="hs-comment">-- | Good for equalities and non-equalities</span><span>
</span><a name="line-2942"></a><span class="hs-identifier">setWantedEvTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcEvDest"><span class="hs-identifier hs-type">TcEvDest</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEvidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2943"></a><a name="setWantedEvTerm"><a href="TcSMonad.html#setWantedEvTerm"><span class="hs-identifier">setWantedEvTerm</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a><span> </span><a name="local-1628204254"><a href="#local-1628204254"><span class="hs-identifier">hole</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628204255"><a href="#local-1628204255"><span class="hs-identifier">tm</span></a></a><span>
</span><a name="line-2944"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204256"><a href="#local-1628204256"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcEvidence.html#evTermCoercion"><span class="hs-identifier hs-var">evTermCoercion</span></a><span> </span><a href="#local-1628204255"><span class="hs-identifier hs-var">tm</span></a><span>
</span><a name="line-2945"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#useVars"><span class="hs-identifier hs-var">useVars</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a><span> </span><a href="#local-1628204256"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2946"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcMType.html#fillCoercionHole"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fillCoercionHole</span></a><span> </span><a href="#local-1628204254"><span class="hs-identifier hs-var">hole</span></a><span> </span><a href="#local-1628204256"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2947"></a><span class="hs-identifier">setWantedEvTerm</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a><span> </span><a name="local-1628204257"><a href="#local-1628204257"><span class="hs-identifier">ev</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628204258"><a href="#local-1628204258"><span class="hs-identifier">tm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#setWantedEvBind"><span class="hs-identifier hs-var">setWantedEvBind</span></a><span> </span><a href="#local-1628204257"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-1628204258"><span class="hs-identifier hs-var">tm</span></a><span>
</span><a name="line-2948"></a><span>
</span><a name="line-2949"></a><span class="hs-identifier">setWantedEvBind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEvidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2950"></a><a name="setWantedEvBind"><a href="TcSMonad.html#setWantedEvBind"><span class="hs-identifier">setWantedEvBind</span></a></a><span> </span><a name="local-1628204259"><a href="#local-1628204259"><span class="hs-identifier">ev_id</span></a></a><span> </span><a name="local-1628204260"><a href="#local-1628204260"><span class="hs-identifier">tm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#setEvBind"><span class="hs-identifier hs-var">setEvBind</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#mkWantedEvBind"><span class="hs-identifier hs-var">mkWantedEvBind</span></a><span> </span><a href="#local-1628204259"><span class="hs-identifier hs-var">ev_id</span></a><span> </span><a href="#local-1628204260"><span class="hs-identifier hs-var">tm</span></a><span class="hs-special">)</span><span>
</span><a name="line-2951"></a><span>
</span><a name="line-2952"></a><span class="hs-identifier">setEvBindIfWanted</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEvidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2953"></a><a name="setEvBindIfWanted"><a href="TcSMonad.html#setEvBindIfWanted"><span class="hs-identifier">setEvBindIfWanted</span></a></a><span> </span><a name="local-1628204261"><a href="#local-1628204261"><span class="hs-identifier">ev</span></a></a><span> </span><a name="local-1628204262"><a href="#local-1628204262"><span class="hs-identifier">tm</span></a></a><span>
</span><a name="line-2954"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204261"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2955"></a><span>      </span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628204263"><a href="#local-1628204263"><span class="hs-identifier">dest</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2956"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#setWantedEvTerm"><span class="hs-identifier hs-var">setWantedEvTerm</span></a><span> </span><a href="#local-1628204263"><span class="hs-identifier hs-var">dest</span></a><span> </span><a href="#local-1628204262"><span class="hs-identifier hs-var">tm</span></a><span>
</span><a name="line-2957"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2958"></a><span>
</span><a name="line-2959"></a><span class="hs-identifier">newTcEvBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcEvidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a><span>
</span><a name="line-2960"></a><a name="newTcEvBinds"><a href="TcSMonad.html#newTcEvBinds"><span class="hs-identifier">newTcEvBinds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="TcRnMonad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newTcEvBinds</span></a><span>
</span><a name="line-2961"></a><span>
</span><a name="line-2962"></a><span class="hs-identifier">newEvVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span>
</span><a name="line-2963"></a><a name="newEvVar"><a href="TcSMonad.html#newEvVar"><span class="hs-identifier">newEvVar</span></a></a><span> </span><a name="local-1628204264"><a href="#local-1628204264"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#newEvVar"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newEvVar</span></a><span> </span><a href="#local-1628204264"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">)</span><span>
</span><a name="line-2964"></a><span>
</span><a name="line-2965"></a><span class="hs-identifier">newGivenEvVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span class="hs-special">,</span><span> </span><a href="TcEvidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-2966"></a><span class="hs-comment">-- Make a new variable of the given PredType,</span><span>
</span><a name="line-2967"></a><span class="hs-comment">-- immediately bind it to the given term</span><span>
</span><a name="line-2968"></a><span class="hs-comment">-- and return its CtEvidence</span><span>
</span><a name="line-2969"></a><span class="hs-comment">-- See Note [Bind new Givens immediately] in TcRnTypes</span><span>
</span><a name="line-2970"></a><a name="newGivenEvVar"><a href="TcSMonad.html#newGivenEvVar"><span class="hs-identifier">newGivenEvVar</span></a></a><span> </span><a name="local-1628204265"><a href="#local-1628204265"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628204266"><a href="#local-1628204266"><span class="hs-identifier">pred</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204267"><a href="#local-1628204267"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2971"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204268"><a href="#local-1628204268"><span class="hs-identifier">new_ev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newBoundEvVarId"><span class="hs-identifier hs-var">newBoundEvVarId</span></a><span> </span><a href="#local-1628204266"><span class="hs-identifier hs-var">pred</span></a><span> </span><a href="#local-1628204267"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-2972"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier hs-var">CtGiven</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204266"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_evar</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204268"><span class="hs-identifier hs-var">new_ev</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204265"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2973"></a><span>
</span><a name="line-2974"></a><span class="hs-comment">-- | Make a new 'Id' of the given type, bound (in the monad's EvBinds) to the</span><span>
</span><a name="line-2975"></a><span class="hs-comment">-- given term</span><span>
</span><a name="line-2976"></a><span class="hs-identifier">newBoundEvVarId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEvidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span>
</span><a name="line-2977"></a><a name="newBoundEvVarId"><a href="TcSMonad.html#newBoundEvVarId"><span class="hs-identifier">newBoundEvVarId</span></a></a><span> </span><a name="local-1628204269"><a href="#local-1628204269"><span class="hs-identifier">pred</span></a></a><span> </span><a name="local-1628204270"><a href="#local-1628204270"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-2978"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204271"><a href="#local-1628204271"><span class="hs-identifier">new_ev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a><span> </span><a href="#local-1628204269"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-2979"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#setEvBind"><span class="hs-identifier hs-var">setEvBind</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#mkGivenEvBind"><span class="hs-identifier hs-var">mkGivenEvBind</span></a><span> </span><a href="#local-1628204271"><span class="hs-identifier hs-var">new_ev</span></a><span> </span><a href="#local-1628204270"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2980"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628204271"><span class="hs-identifier hs-var">new_ev</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2981"></a><span>
</span><a name="line-2982"></a><span class="hs-identifier">newGivenEvVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span class="hs-special">,</span><span> </span><a href="TcEvidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">]</span><span>
</span><a name="line-2983"></a><a name="newGivenEvVars"><a href="TcSMonad.html#newGivenEvVars"><span class="hs-identifier">newGivenEvVars</span></a></a><span> </span><a name="local-1628204272"><a href="#local-1628204272"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204273"><a href="#local-1628204273"><span class="hs-identifier">pts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a><span> </span><a href="#local-1628204272"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204273"><span class="hs-identifier hs-var">pts</span></a><span>
</span><a name="line-2984"></a><span>
</span><a name="line-2985"></a><span class="hs-comment">-- | Make a new equality CtEvidence</span><span>
</span><a name="line-2986"></a><span class="hs-identifier">newWantedEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-2987"></a><a name="newWantedEq"><a href="TcSMonad.html#newWantedEq"><span class="hs-identifier">newWantedEq</span></a></a><span> </span><a name="local-1628204274"><a href="#local-1628204274"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204275"><a href="#local-1628204275"><span class="hs-identifier">role</span></a></a><span> </span><a name="local-1628204276"><a href="#local-1628204276"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1628204277"><a href="#local-1628204277"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-2988"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204279"><a href="#local-1628204279"><span class="hs-identifier">hole</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcMType.html#newCoercionHole"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newCoercionHole</span></a><span>
</span><a name="line-2989"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;Emitting new coercion hole&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204279"><span class="hs-identifier hs-var">hole</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204278"><span class="hs-identifier hs-var">pty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2990"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204278"><span class="hs-identifier hs-var">pty</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a><span> </span><a href="#local-1628204279"><span class="hs-identifier hs-var">hole</span></a><span>
</span><a name="line-2991"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204274"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">}</span><span>
</span><a name="line-2992"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkHoleCo"><span class="hs-identifier hs-var">mkHoleCo</span></a><span> </span><a href="#local-1628204279"><span class="hs-identifier hs-var">hole</span></a><span> </span><a href="#local-1628204275"><span class="hs-identifier hs-var">role</span></a><span> </span><a href="#local-1628204276"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1628204277"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2993"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2994"></a><span>    </span><a name="local-1628204278"><a href="#local-1628204278"><span class="hs-identifier">pty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a><span> </span><a href="#local-1628204275"><span class="hs-identifier hs-var">role</span></a><span> </span><a href="#local-1628204276"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1628204277"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2995"></a><span>
</span><a name="line-2996"></a><span class="hs-comment">-- no equalities here. Use newWantedEqNC instead</span><span>
</span><a name="line-2997"></a><span class="hs-identifier">newWantedEvVarNC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-2998"></a><span class="hs-comment">-- Don't look up in the solved/inerts; we know it's not there</span><span>
</span><a name="line-2999"></a><a name="newWantedEvVarNC"><a href="TcSMonad.html#newWantedEvVarNC"><span class="hs-identifier">newWantedEvVarNC</span></a></a><span> </span><a name="local-1628204280"><a href="#local-1628204280"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204281"><a href="#local-1628204281"><span class="hs-identifier">pty</span></a></a><span>
</span><a name="line-3000"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- checkReductionDepth loc pty</span><span>
</span><a name="line-3001"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628204282"><a href="#local-1628204282"><span class="hs-identifier">new_ev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a><span> </span><a href="#local-1628204281"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-3002"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;Emitting new wanted&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204282"><span class="hs-identifier hs-var">new_ev</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204281"><span class="hs-identifier hs-var">pty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-3003"></a><span>                                         </span><a href="TcRnTypes.html#pprCtLoc"><span class="hs-identifier hs-var">pprCtLoc</span></a><span> </span><a href="#local-1628204280"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-3004"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204281"><span class="hs-identifier hs-var">pty</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a><span> </span><a href="#local-1628204282"><span class="hs-identifier hs-var">new_ev</span></a><span>
</span><a name="line-3005"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204280"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-3006"></a><span>
</span><a name="line-3007"></a><span class="hs-identifier">newWantedEvVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcSMonad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a><span>
</span><a name="line-3008"></a><span class="hs-comment">-- For anything except ClassPred, this is the same as newWantedEvVarNC</span><span>
</span><a name="line-3009"></a><a name="newWantedEvVar"><a href="TcSMonad.html#newWantedEvVar"><span class="hs-identifier">newWantedEvVar</span></a></a><span> </span><a name="local-1628204283"><a href="#local-1628204283"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204284"><a href="#local-1628204284"><span class="hs-identifier">pty</span></a></a><span>
</span><a name="line-3010"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204285"><a href="#local-1628204285"><span class="hs-identifier">mb_ct</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#lookupInInerts"><span class="hs-identifier hs-var">lookupInInerts</span></a><span> </span><a href="#local-1628204284"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-3011"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628204285"><span class="hs-identifier hs-var">mb_ct</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-3012"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628204286"><a href="#local-1628204286"><span class="hs-identifier">ctev</span></a></a><span>
</span><a name="line-3013"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isDerived"><span class="hs-identifier hs-var">isDerived</span></a><span> </span><a href="#local-1628204286"><span class="hs-identifier hs-var">ctev</span></a><span class="hs-special">)</span><span>
</span><a name="line-3014"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;newWantedEvVar/cache hit&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204286"><span class="hs-identifier hs-var">ctev</span></a><span>
</span><a name="line-3015"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcSMonad.html#Cached"><span class="hs-identifier hs-var">Cached</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvTerm"><span class="hs-identifier hs-var">ctEvTerm</span></a><span> </span><a href="#local-1628204286"><span class="hs-identifier hs-var">ctev</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3016"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204287"><a href="#local-1628204287"><span class="hs-identifier">ctev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newWantedEvVarNC"><span class="hs-identifier hs-var">newWantedEvVarNC</span></a><span> </span><a href="#local-1628204283"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204284"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-3017"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#Fresh"><span class="hs-identifier hs-var">Fresh</span></a><span> </span><a href="#local-1628204287"><span class="hs-identifier hs-var">ctev</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3018"></a><span>
</span><a name="line-3019"></a><span class="hs-comment">-- deals with both equalities and non equalities. Tries to look</span><span>
</span><a name="line-3020"></a><span class="hs-comment">-- up non-equalities in the cache</span><span>
</span><a name="line-3021"></a><span class="hs-identifier">newWanted</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcSMonad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a><span>
</span><a name="line-3022"></a><a name="newWanted"><a href="TcSMonad.html#newWanted"><span class="hs-identifier">newWanted</span></a></a><span> </span><a name="local-1628204288"><a href="#local-1628204288"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204289"><a href="#local-1628204289"><span class="hs-identifier">pty</span></a></a><span>
</span><a name="line-3023"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628204290"><a href="#local-1628204290"><span class="hs-identifier">role</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204291"><a href="#local-1628204291"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204292"><a href="#local-1628204292"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getEqPredTys_maybe"><span class="hs-identifier hs-var">getEqPredTys_maybe</span></a><span> </span><a href="#local-1628204289"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-3024"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#Fresh"><span class="hs-identifier hs-var">Fresh</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcSMonad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a><span> </span><a href="#local-1628204288"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204290"><span class="hs-identifier hs-var">role</span></a><span> </span><a href="#local-1628204291"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1628204292"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-3025"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-3026"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#newWantedEvVar"><span class="hs-identifier hs-var">newWantedEvVar</span></a><span> </span><a href="#local-1628204288"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204289"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-3027"></a><span>
</span><a name="line-3028"></a><span class="hs-identifier">emitNewDerived</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-3029"></a><a name="emitNewDerived"><a href="TcSMonad.html#emitNewDerived"><span class="hs-identifier">emitNewDerived</span></a></a><span> </span><a name="local-1628204293"><a href="#local-1628204293"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204294"><a href="#local-1628204294"><span class="hs-identifier">pred</span></a></a><span>
</span><a name="line-3030"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204295"><a href="#local-1628204295"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newDerivedNC"><span class="hs-identifier hs-var">newDerivedNC</span></a><span> </span><a href="#local-1628204293"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204294"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-3031"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;Emitting new derived&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204295"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-3032"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#extendWorkListDerived"><span class="hs-identifier hs-var">extendWorkListDerived</span></a><span> </span><a href="#local-1628204293"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204295"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3033"></a><span>
</span><a name="line-3034"></a><span class="hs-identifier">emitNewDeriveds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-3035"></a><a name="emitNewDeriveds"><a href="TcSMonad.html#emitNewDeriveds"><span class="hs-identifier">emitNewDeriveds</span></a></a><span> </span><a name="local-1628204296"><a href="#local-1628204296"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204297"><a href="#local-1628204297"><span class="hs-identifier">preds</span></a></a><span>
</span><a name="line-3036"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628204297"><span class="hs-identifier hs-var">preds</span></a><span>
</span><a name="line-3037"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-3038"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-3039"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204298"><a href="#local-1628204298"><span class="hs-identifier">evs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#newDerivedNC"><span class="hs-identifier hs-var">newDerivedNC</span></a><span> </span><a href="#local-1628204296"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204297"><span class="hs-identifier hs-var">preds</span></a><span>
</span><a name="line-3040"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;Emitting new deriveds&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204298"><span class="hs-identifier hs-var">evs</span></a><span class="hs-special">)</span><span>
</span><a name="line-3041"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#extendWorkListDeriveds"><span class="hs-identifier hs-var">extendWorkListDeriveds</span></a><span> </span><a href="#local-1628204296"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204298"><span class="hs-identifier hs-var">evs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3042"></a><span>
</span><a name="line-3043"></a><span class="hs-identifier">emitNewDerivedEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-3044"></a><span class="hs-comment">-- Create new equality Derived and put it in the work list</span><span>
</span><a name="line-3045"></a><span class="hs-comment">-- There's no caching, no lookupInInerts</span><span>
</span><a name="line-3046"></a><a name="emitNewDerivedEq"><a href="TcSMonad.html#emitNewDerivedEq"><span class="hs-identifier">emitNewDerivedEq</span></a></a><span> </span><a name="local-1628204299"><a href="#local-1628204299"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204300"><a href="#local-1628204300"><span class="hs-identifier">role</span></a></a><span> </span><a name="local-1628204301"><a href="#local-1628204301"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1628204302"><a href="#local-1628204302"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-3047"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204303"><a href="#local-1628204303"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newDerivedNC"><span class="hs-identifier hs-var">newDerivedNC</span></a><span> </span><a href="#local-1628204299"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a><span> </span><a href="#local-1628204300"><span class="hs-identifier hs-var">role</span></a><span> </span><a href="#local-1628204301"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1628204302"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-3048"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a><span> </span><span class="hs-string">&quot;Emitting new derived equality&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628204303"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="TcRnTypes.html#pprCtLoc"><span class="hs-identifier hs-var">pprCtLoc</span></a><span> </span><a href="#local-1628204299"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-3049"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#extendWorkListDerived"><span class="hs-identifier hs-var">extendWorkListDerived</span></a><span> </span><a href="#local-1628204299"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204303"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3050"></a><span>
</span><a name="line-3051"></a><span class="hs-identifier">newDerivedNC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-3052"></a><a name="newDerivedNC"><a href="TcSMonad.html#newDerivedNC"><span class="hs-identifier">newDerivedNC</span></a></a><span> </span><a name="local-1628204304"><a href="#local-1628204304"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204305"><a href="#local-1628204305"><span class="hs-identifier">pred</span></a></a><span>
</span><a name="line-3053"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- checkReductionDepth loc pred</span><span>
</span><a name="line-3054"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtDerived"><span class="hs-identifier hs-var">CtDerived</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204305"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204304"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3055"></a><span>
</span><a name="line-3056"></a><span class="hs-comment">-- --------- Check done in TcInteract.selectNewWorkItem???? ---------</span><span>
</span><a name="line-3057"></a><span class="hs-comment">-- | Checks if the depth of the given location is too much. Fails if</span><span>
</span><a name="line-3058"></a><span class="hs-comment">-- it's too big, with an appropriate error message.</span><span>
</span><a name="line-3059"></a><span class="hs-identifier">checkReductionDepth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>   </span><span class="hs-comment">-- ^ type being reduced</span><span>
</span><a name="line-3060"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-3061"></a><a name="checkReductionDepth"><a href="TcSMonad.html#checkReductionDepth"><span class="hs-identifier">checkReductionDepth</span></a></a><span> </span><a name="local-1628204306"><a href="#local-1628204306"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204307"><a href="#local-1628204307"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-3062"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204308"><a href="#local-1628204308"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-3063"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#subGoalDepthExceeded"><span class="hs-identifier hs-var">subGoalDepthExceeded</span></a><span> </span><a href="#local-1628204308"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctLocDepth"><span class="hs-identifier hs-var">ctLocDepth</span></a><span> </span><a href="#local-1628204306"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-3064"></a><span>         </span><a href="TcSMonad.html#wrapErrTcS"><span class="hs-identifier hs-var">wrapErrTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-3065"></a><span>         </span><a href="TcErrors.html#solverDepthErrorTcS"><span class="hs-identifier hs-var">solverDepthErrorTcS</span></a><span> </span><a href="#local-1628204306"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204307"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3066"></a><span>
</span><a name="line-3067"></a><span class="hs-identifier">matchFam</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3068"></a><a name="matchFam"><a href="TcSMonad.html#matchFam"><span class="hs-identifier">matchFam</span></a></a><span> </span><a name="local-1628204309"><a href="#local-1628204309"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-1628204310"><a href="#local-1628204310"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcSMonad.html#matchFamTcM"><span class="hs-identifier hs-var">matchFamTcM</span></a><span> </span><a href="#local-1628204309"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-1628204310"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-3069"></a><span>
</span><a name="line-3070"></a><span class="hs-identifier">matchFamTcM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3071"></a><span class="hs-comment">-- Given (F tys) return (ty, co), where co :: F tys ~ ty</span><span>
</span><a name="line-3072"></a><a name="matchFamTcM"><a href="TcSMonad.html#matchFamTcM"><span class="hs-identifier">matchFamTcM</span></a></a><span> </span><a name="local-1628204311"><a href="#local-1628204311"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-1628204312"><a href="#local-1628204312"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-3073"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628204313"><a href="#local-1628204313"><span class="hs-identifier">fam_envs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="FamInst.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">FamInst</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a><span>
</span><a name="line-3074"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="FamInstEnv.html#reduceTyFamApp_maybe"><span class="hs-identifier hs-var">reduceTyFamApp_maybe</span></a><span> </span><a href="#local-1628204313"><span class="hs-identifier hs-var">fam_envs</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-1628204311"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-1628204312"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3075"></a><span>
</span><a name="line-3076"></a><span class="hs-comment">{-
Note [Residual implications]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The wl_implics in the WorkList are the residual implication
constraints that are generated while solving or canonicalising the
current worklist.  Specifically, when canonicalising
   (forall a. t1 ~ forall a. t2)
from which we get the implication
   (forall a. t1 ~ t2)
See TcSMonad.deferTcSForAllEq
-}</span><span>
</span><a name="line-3087"></a><span>
</span><a name="line-3088"></a><span class="hs-comment">-- Deferring forall equalities as implications</span><span>
</span><a name="line-3089"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-3090"></a><span>
</span><a name="line-3091"></a><span class="hs-identifier">deferTcSForAllEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-comment">-- Nominal or Representational</span><span>
</span><a name="line-3092"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>  </span><span class="hs-comment">-- Original wanted equality flavor</span><span>
</span><a name="line-3093"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- among the kinds of the binders</span><span>
</span><a name="line-3094"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ForAll tvs1 body1</span><span>
</span><a name="line-3095"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ForAll tvs2 body2</span><span>
</span><a name="line-3096"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcSMonad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-3097"></a><a name="deferTcSForAllEq"><a href="TcSMonad.html#deferTcSForAllEq"><span class="hs-identifier">deferTcSForAllEq</span></a></a><span> </span><a name="local-1628204314"><a href="#local-1628204314"><span class="hs-identifier">role</span></a></a><span> </span><a name="local-1628204315"><a href="#local-1628204315"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-1628204316"><a href="#local-1628204316"><span class="hs-identifier">kind_cos</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628204317"><a href="#local-1628204317"><span class="hs-identifier">bndrs1</span></a></a><span class="hs-special">,</span><a name="local-1628204318"><a href="#local-1628204318"><span class="hs-identifier">body1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1628204319"><a href="#local-1628204319"><span class="hs-identifier">bndrs2</span></a></a><span class="hs-special">,</span><a name="local-1628204320"><a href="#local-1628204320"><span class="hs-identifier">body2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3098"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204323"><a href="#local-1628204323"><span class="hs-identifier">tvs1'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#zipWithEqual"><span class="hs-identifier hs-var">zipWithEqual</span></a><span> </span><span class="hs-string">&quot;deferTcSForAllEq&quot;</span><span>
</span><a name="line-3099"></a><span>                       </span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1628204321"><span class="hs-identifier hs-var">tvs1</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628204316"><span class="hs-identifier hs-var">kind_cos</span></a><span>
</span><a name="line-3100"></a><span>            </span><a name="local-1628204324"><a href="#local-1628204324"><span class="hs-identifier">body2'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyWithUnchecked"><span class="hs-identifier hs-var">substTyWithUnchecked</span></a><span> </span><a href="#local-1628204322"><span class="hs-identifier hs-var">tvs2</span></a><span> </span><a href="#local-1628204323"><span class="hs-identifier hs-var">tvs1'</span></a><span> </span><a href="#local-1628204320"><span class="hs-identifier hs-var">body2</span></a><span>
</span><a name="line-3101"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204325"><a href="#local-1628204325"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204326"><a href="#local-1628204326"><span class="hs-identifier">skol_tvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcMType.html#tcInstSkolTyVars"><span class="hs-identifier hs-var">TcM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">tcInstSkolTyVars</span></a><span> </span><a href="#local-1628204321"><span class="hs-identifier hs-var">tvs1</span></a><span>
</span><a name="line-3102"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204327"><a href="#local-1628204327"><span class="hs-identifier">phi1</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">Type</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">substTyUnchecked</span></a><span> </span><a href="#local-1628204325"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628204318"><span class="hs-identifier hs-var">body1</span></a><span>
</span><a name="line-3103"></a><span>            </span><a name="local-1628204328"><a href="#local-1628204328"><span class="hs-identifier">phi2</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">Type</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">substTyUnchecked</span></a><span> </span><a href="#local-1628204325"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628204324"><span class="hs-identifier hs-var">body2'</span></a><span>
</span><a name="line-3104"></a><span>            </span><a name="local-1628204329"><a href="#local-1628204329"><span class="hs-identifier">skol_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#UnifyForAllSkol"><span class="hs-identifier hs-var">UnifyForAllSkol</span></a><span> </span><a href="#local-1628204327"><span class="hs-identifier hs-var">phi1</span></a><span>
</span><a name="line-3105"></a><span>
</span><a name="line-3106"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-1628204330"><a href="#local-1628204330"><span class="hs-identifier">ctev</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628204331"><a href="#local-1628204331"><span class="hs-identifier">hole_co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a><span> </span><a href="#local-1628204315"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-1628204314"><span class="hs-identifier hs-var">role</span></a><span> </span><a href="#local-1628204327"><span class="hs-identifier hs-var">phi1</span></a><span> </span><a href="#local-1628204328"><span class="hs-identifier hs-var">phi2</span></a><span>
</span><a name="line-3107"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-1628204332"><a href="#local-1628204332"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span>
</span><a name="line-3108"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204333"><a href="#local-1628204333"><span class="hs-identifier">new_tclvl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcl_tclvl</span><span> </span><a href="#local-1628204332"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-3109"></a><span>            </span><a name="local-1628204334"><a href="#local-1628204334"><span class="hs-identifier">wc</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#singleCt"><span class="hs-identifier hs-var">singleCt</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="#local-1628204330"><span class="hs-identifier hs-var">ctev</span></a><span class="hs-special">)</span><span>
</span><a name="line-3110"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span>
</span><a name="line-3111"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_insol</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3112"></a><span>            </span><a name="local-1628204335"><a href="#local-1628204335"><span class="hs-identifier">imp</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Implic"><span class="hs-identifier hs-var">Implic</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_tclvl</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204333"><span class="hs-identifier hs-var">new_tclvl</span></a><span>
</span><a name="line-3113"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_skols</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204326"><span class="hs-identifier hs-var">skol_tvs</span></a><span>
</span><a name="line-3114"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_no_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3115"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_given</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-3116"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_wanted</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204334"><span class="hs-identifier hs-var">wc</span></a><span>
</span><a name="line-3117"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_status</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#IC_Unsolved"><span class="hs-identifier hs-var">IC_Unsolved</span></a><span>
</span><a name="line-3118"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_binds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-comment">-- no place to put binds</span><span>
</span><a name="line-3119"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_env</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204332"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-3120"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_info</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628204329"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3121"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcSMonad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a><span> </span><span class="hs-special">(</span><a href="TcSMonad.html#extendWorkListImplic"><span class="hs-identifier hs-var">extendWorkListImplic</span></a><span> </span><a href="#local-1628204335"><span class="hs-identifier hs-var">imp</span></a><span class="hs-special">)</span><span>
</span><a name="line-3122"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628204336"><a href="#local-1628204336"><span class="hs-identifier">cobndrs</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><a href="#local-1628204326"><span class="hs-identifier hs-var">skol_tvs</span></a><span> </span><a href="#local-1628204316"><span class="hs-identifier hs-var">kind_cos</span></a><span>
</span><a name="line-3123"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkForAllCos"><span class="hs-identifier hs-var">mkForAllCos</span></a><span> </span><a href="#local-1628204336"><span class="hs-identifier hs-var">cobndrs</span></a><span> </span><a href="#local-1628204331"><span class="hs-identifier hs-var">hole_co</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3124"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-3125"></a><span>     </span><a name="local-1628204321"><a href="#local-1628204321"><span class="hs-identifier">tvs1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a><span> </span><span class="hs-string">&quot;deferTcSForAllEq&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628204317"><span class="hs-identifier hs-var">bndrs1</span></a><span>
</span><a name="line-3126"></a><span>     </span><a name="local-1628204322"><a href="#local-1628204322"><span class="hs-identifier">tvs2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a><span> </span><span class="hs-string">&quot;deferTcSForAllEq&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1628204319"><span class="hs-identifier hs-var">bndrs2</span></a><span>
</span><a name="line-3127"></a></pre></body></html>