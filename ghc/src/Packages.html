<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- (c) The University of Glasgow, 2006</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE CPP, ScopedTypeVariables #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-comment">-- | Package manipulation</span><span>
</span><a name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Packages</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-7"></a><span>        </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PackageConfig</span><span class="hs-special">,</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span>        </span><span class="hs-comment">-- * Reading the package config, and processing cmdline args</span><span>
</span><a name="line-10"></a><span>        </span><a href="Packages.html#PackageState"><span class="hs-identifier hs-type">PackageState</span></a><span class="hs-special">(</span><span class="hs-identifier">preloadPackages</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">explicitPackages</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>        </span><a href="Packages.html#emptyPackageState"><span class="hs-identifier hs-var">emptyPackageState</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>        </span><a href="Packages.html#initPackages"><span class="hs-identifier hs-var">initPackages</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="Packages.html#readPackageConfigs"><span class="hs-identifier hs-var">readPackageConfigs</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="Packages.html#getPackageConfRefs"><span class="hs-identifier hs-var">getPackageConfRefs</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="Packages.html#resolvePackageConfig"><span class="hs-identifier hs-var">resolvePackageConfig</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="Packages.html#readPackageConfig"><span class="hs-identifier hs-var">readPackageConfig</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="Packages.html#listPackageConfigMap"><span class="hs-identifier hs-var">listPackageConfigMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span>        </span><span class="hs-comment">-- * Querying the package config</span><span>
</span><a name="line-20"></a><span>        </span><a href="Packages.html#lookupPackage"><span class="hs-identifier hs-var">lookupPackage</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="Packages.html#searchPackageId"><span class="hs-identifier hs-var">searchPackageId</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="Packages.html#getPackageDetails"><span class="hs-identifier hs-var">getPackageDetails</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="Packages.html#listVisibleModuleNames"><span class="hs-identifier hs-var">listVisibleModuleNames</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="Packages.html#lookupModuleInAllPackages"><span class="hs-identifier hs-var">lookupModuleInAllPackages</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><a href="Packages.html#lookupModuleWithSuggestions"><span class="hs-identifier hs-var">lookupModuleWithSuggestions</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="Packages.html#lookupPluginModuleWithSuggestions"><span class="hs-identifier hs-var">lookupPluginModuleWithSuggestions</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>        </span><a href="Packages.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="Packages.html#ModuleSuggestion"><span class="hs-identifier hs-type">ModuleSuggestion</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>        </span><span class="hs-comment">-- * Inspecting the set of packages in scope</span><span>
</span><a name="line-32"></a><span>        </span><a href="Packages.html#getPackageIncludePath"><span class="hs-identifier hs-var">getPackageIncludePath</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>        </span><a href="Packages.html#getPackageLibraryPath"><span class="hs-identifier hs-var">getPackageLibraryPath</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>        </span><a href="Packages.html#getPackageLinkOpts"><span class="hs-identifier hs-var">getPackageLinkOpts</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="Packages.html#getPackageExtraCcOpts"><span class="hs-identifier hs-var">getPackageExtraCcOpts</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="Packages.html#getPackageFrameworkPath"><span class="hs-identifier hs-var">getPackageFrameworkPath</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="Packages.html#getPackageFrameworks"><span class="hs-identifier hs-var">getPackageFrameworks</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="Packages.html#getPreloadPackagesAnd"><span class="hs-identifier hs-var">getPreloadPackagesAnd</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>        </span><a href="Packages.html#collectIncludeDirs"><span class="hs-identifier hs-var">collectIncludeDirs</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#collectLibraryPaths"><span class="hs-identifier hs-var">collectLibraryPaths</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#collectLinkOpts"><span class="hs-identifier hs-var">collectLinkOpts</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="Packages.html#packageHsLibs"><span class="hs-identifier hs-var">packageHsLibs</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>        </span><span class="hs-comment">-- * Utils</span><span>
</span><a name="line-44"></a><span>        </span><a href="Packages.html#unitIdPackageIdString"><span class="hs-identifier hs-var">unitIdPackageIdString</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>        </span><a href="Packages.html#pprFlag"><span class="hs-identifier hs-var">pprFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>        </span><a href="Packages.html#pprPackages"><span class="hs-identifier hs-var">pprPackages</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>        </span><a href="Packages.html#pprPackagesSimple"><span class="hs-identifier hs-var">pprPackagesSimple</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="Packages.html#pprModuleMap"><span class="hs-identifier hs-var">pprModuleMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>        </span><a href="Packages.html#isDllName"><span class="hs-identifier hs-var">isDllName</span></a><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span class="hs-keyword">where</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.PackageDb.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">PackageDb</span></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="PackageConfig.html"><span class="hs-identifier">PackageConfig</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>             </span><span class="hs-special">(</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="Panic.html"><span class="hs-identifier">Panic</span></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Environment.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Environment</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Environment.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span>         </span><span class="hs-special">(</span><span> </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span class="hs-special">,</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="Exception.html"><span class="hs-identifier">Exception</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="../directory-1.2.5.1/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Directory</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">FilePath</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">FilePath</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">FilePath</span><span class="hs-operator">.</span><span class="hs-identifier">Posix</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">FilePath</span><span class="hs-operator">.</span><span class="hs-identifier">Posix</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Char.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Unicode.html#toUpper"><span class="hs-identifier hs-var">toUpper</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">List</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Set</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#Set"><span class="hs-identifier hs-type">Set</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Semigroup.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Semigroup</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Semigroup.html#Semigroup"><span class="hs-identifier hs-type">Semigroup</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Semigroup.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Semigroup</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Semigroup</span><span>
</span><a name="line-83"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="FiniteMap.html"><span class="hs-identifier">FiniteMap</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Set</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- The Package state</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-comment">-- | Package state is all stored in 'DynFlags', including the details of</span><span>
</span><a name="line-92"></a><span class="hs-comment">-- all packages, which packages are exposed, and which modules they</span><span>
</span><a name="line-93"></a><span class="hs-comment">-- provide.</span><span>
</span><a name="line-94"></a><span class="hs-comment">--</span><span>
</span><a name="line-95"></a><span class="hs-comment">-- The package state is computed by 'initPackages', and kept in DynFlags.</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- It is influenced by various package flags:</span><span>
</span><a name="line-97"></a><span class="hs-comment">--</span><span>
</span><a name="line-98"></a><span class="hs-comment">--   * @-package &lt;pkg&gt;@ and @-package-id &lt;pkg&gt;@ cause @&lt;pkg&gt;@ to become exposed.</span><span>
</span><a name="line-99"></a><span class="hs-comment">--     If @-hide-all-packages@ was not specified, these commands also cause</span><span>
</span><a name="line-100"></a><span class="hs-comment">--      all other packages with the same name to become hidden.</span><span>
</span><a name="line-101"></a><span class="hs-comment">--</span><span>
</span><a name="line-102"></a><span class="hs-comment">--   * @-hide-package &lt;pkg&gt;@ causes @&lt;pkg&gt;@ to become hidden.</span><span>
</span><a name="line-103"></a><span class="hs-comment">--</span><span>
</span><a name="line-104"></a><span class="hs-comment">--   * (there are a few more flags, check below for their semantics)</span><span>
</span><a name="line-105"></a><span class="hs-comment">--</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- The package state has the following properties.</span><span>
</span><a name="line-107"></a><span class="hs-comment">--</span><span>
</span><a name="line-108"></a><span class="hs-comment">--   * Let @exposedPackages@ be the set of packages thus exposed.</span><span>
</span><a name="line-109"></a><span class="hs-comment">--     Let @depExposedPackages@ be the transitive closure from @exposedPackages@ of</span><span>
</span><a name="line-110"></a><span class="hs-comment">--     their dependencies.</span><span>
</span><a name="line-111"></a><span class="hs-comment">--</span><span>
</span><a name="line-112"></a><span class="hs-comment">--   * When searching for a module from an preload import declaration,</span><span>
</span><a name="line-113"></a><span class="hs-comment">--     only the exposed modules in @exposedPackages@ are valid.</span><span>
</span><a name="line-114"></a><span class="hs-comment">--</span><span>
</span><a name="line-115"></a><span class="hs-comment">--   * When searching for a module from an implicit import, all modules</span><span>
</span><a name="line-116"></a><span class="hs-comment">--     from @depExposedPackages@ are valid.</span><span>
</span><a name="line-117"></a><span class="hs-comment">--</span><span>
</span><a name="line-118"></a><span class="hs-comment">--   * When linking in a compilation manager mode, we link in packages the</span><span>
</span><a name="line-119"></a><span class="hs-comment">--     program depends on (the compiler knows this list by the</span><span>
</span><a name="line-120"></a><span class="hs-comment">--     time it gets to the link step).  Also, we link in all packages</span><span>
</span><a name="line-121"></a><span class="hs-comment">--     which were mentioned with preload @-package@ flags on the command-line,</span><span>
</span><a name="line-122"></a><span class="hs-comment">--     or are a transitive dependency of same, or are \&quot;base\&quot;\/\&quot;rts\&quot;.</span><span>
</span><a name="line-123"></a><span class="hs-comment">--     The reason for this is that we might need packages which don't</span><span>
</span><a name="line-124"></a><span class="hs-comment">--     contain any Haskell modules, and therefore won't be discovered</span><span>
</span><a name="line-125"></a><span class="hs-comment">--     by the normal mechanism of dependency tracking.</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">-- Notes on DLLs</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- ~~~~~~~~~~~~~</span><span>
</span><a name="line-129"></a><span class="hs-comment">-- When compiling module A, which imports module B, we need to</span><span>
</span><a name="line-130"></a><span class="hs-comment">-- know whether B will be in the same DLL as A.</span><span>
</span><a name="line-131"></a><span class="hs-comment">--      If it's in the same DLL, we refer to B_f_closure</span><span>
</span><a name="line-132"></a><span class="hs-comment">--      If it isn't, we refer to _imp__B_f_closure</span><span>
</span><a name="line-133"></a><span class="hs-comment">-- When compiling A, we record in B's Module value whether it's</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- in a different DLL, by setting the DLL flag.</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-comment">-- | Given a module name, there may be multiple ways it came into scope,</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- possibly simultaneously.  This data type tracks all the possible ways</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- it could have come into scope.  Warning: don't use the record functions,</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- they're partial!</span><span>
</span><a name="line-140"></a><span class="hs-keyword">data</span><span> </span><a name="ModuleOrigin"><a href="Packages.html#ModuleOrigin"><span class="hs-identifier">ModuleOrigin</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-141"></a><span>    </span><span class="hs-comment">-- | Module is hidden, and thus never will be available for import.</span><span>
</span><a name="line-142"></a><span>    </span><span class="hs-comment">-- (But maybe the user didn't realize), so we'll still keep track</span><span>
</span><a name="line-143"></a><span>    </span><span class="hs-comment">-- of these modules.)</span><span>
</span><a name="line-144"></a><span>    </span><a name="ModHidden"><a href="Packages.html#ModHidden"><span class="hs-identifier">ModHidden</span></a></a><span>
</span><a name="line-145"></a><span>    </span><span class="hs-comment">-- | Module is public, and could have come from some places.</span><span>
</span><a name="line-146"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ModOrigin"><a href="Packages.html#ModOrigin"><span class="hs-identifier">ModOrigin</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-147"></a><span>        </span><span class="hs-comment">-- | @Just False@ means that this module is in</span><span>
</span><a name="line-148"></a><span>        </span><span class="hs-comment">-- someone's @exported-modules@ list, but that package is hidden;</span><span>
</span><a name="line-149"></a><span>        </span><span class="hs-comment">-- @Just True@ means that it is available; @Nothing@ means neither</span><span>
</span><a name="line-150"></a><span>        </span><span class="hs-comment">-- applies.</span><span>
</span><a name="line-151"></a><span>        </span><a href="Packages.html#fromOrigPackage"><span class="hs-identifier">fromOrigPackage</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-152"></a><span>        </span><span class="hs-comment">-- | Is the module available from a reexport of an exposed package?</span><span>
</span><a name="line-153"></a><span>        </span><span class="hs-comment">-- There could be multiple.</span><span>
</span><a name="line-154"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Packages.html#fromExposedReexport"><span class="hs-identifier">fromExposedReexport</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-155"></a><span>        </span><span class="hs-comment">-- | Is the module available from a reexport of a hidden package?</span><span>
</span><a name="line-156"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Packages.html#fromHiddenReexport"><span class="hs-identifier">fromHiddenReexport</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-157"></a><span>        </span><span class="hs-comment">-- | Did the module export come from a package flag? (ToDo: track</span><span>
</span><a name="line-158"></a><span>        </span><span class="hs-comment">-- more information.</span><span>
</span><a name="line-159"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Packages.html#fromPackageFlag"><span class="hs-identifier">fromPackageFlag</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-160"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-161"></a><span>
</span><a name="line-162"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-163"></a><span>    </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="Packages.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hidden module&quot;</span><span>
</span><a name="line-164"></a><span>    </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><a name="local-1627577177"><a href="#local-1627577177"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-1627577178"><a href="#local-1627577178"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1627577179"><a href="#local-1627577179"><span class="hs-identifier">rhs</span></a></a><span> </span><a name="local-1627577180"><a href="#local-1627577180"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-165"></a><span>        </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-1627577177"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-166"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-167"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hidden package&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-168"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;exposed package&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-169"></a><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627577178"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-170"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-171"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;reexport by&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-172"></a><span>                    </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627577178"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-173"></a><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627577179"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-174"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-175"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hidden reexport by&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-176"></a><span>                    </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627577178"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-177"></a><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-1627577180"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;package flag&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>        </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-comment">-- | Smart constructor for a module which is in @exposed-modules@.  Takes</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- as an argument whether or not the defining package is exposed.</span><span>
</span><a name="line-182"></a><span class="hs-identifier">fromExposedModules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span>
</span><a name="line-183"></a><a name="fromExposedModules"><a href="Packages.html#fromExposedModules"><span class="hs-identifier">fromExposedModules</span></a></a><span> </span><a name="local-1627576654"><a href="#local-1627576654"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627576654"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-comment">-- | Smart constructor for a module which is in @reexported-modules@.  Takes</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- as an argument whether or not the reexporting package is expsed, and</span><span>
</span><a name="line-187"></a><span class="hs-comment">-- also its 'PackageConfig'.</span><span>
</span><a name="line-188"></a><span class="hs-identifier">fromReexportedModules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span>
</span><a name="line-189"></a><a name="fromReexportedModules"><a href="Packages.html#fromReexportedModules"><span class="hs-identifier">fromReexportedModules</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a name="local-1627576655"><a href="#local-1627576655"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627576655"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-190"></a><span class="hs-identifier">fromReexportedModules</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-1627576656"><a href="#local-1627576656"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627576656"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">-- | Smart constructor for a module which was bound by a package flag.</span><span>
</span><a name="line-193"></a><span class="hs-identifier">fromFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span>
</span><a name="line-194"></a><a name="fromFlag"><a href="Packages.html#fromFlag"><span class="hs-identifier">fromFlag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710</span><span>
</span><a name="line-197"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Semigroup.html#Semigroup"><span class="hs-identifier hs-type">Semigroup</span></a><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-198"></a><span>    </span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><a name="local-1627577162"><a href="#local-1627577162"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-1627577163"><a href="#local-1627577163"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1627577164"><a href="#local-1627577164"><span class="hs-identifier">rhs</span></a></a><span> </span><a name="local-1627577165"><a href="#local-1627577165"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-805306881"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Semigroup.html#%3C%3E"><span class="hs-operator">&lt;&gt;</span></a></a><span> </span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><a name="local-1627577166"><a href="#local-1627577166"><span class="hs-identifier">e'</span></a></a><span> </span><a name="local-1627577167"><a href="#local-1627577167"><span class="hs-identifier">res'</span></a></a><span> </span><a name="local-1627577168"><a href="#local-1627577168"><span class="hs-identifier">rhs'</span></a></a><span> </span><a name="local-1627577169"><a href="#local-1627577169"><span class="hs-identifier">f'</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-199"></a><span>        </span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577170"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627577162"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-1627577166"><span class="hs-identifier hs-var">e'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627577163"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627577167"><span class="hs-identifier hs-var">res'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627577164"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627577168"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627577165"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1627577169"><span class="hs-identifier hs-var">f'</span></a><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-1627577170"><a href="#local-1627577170"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577171"><a href="#local-1627577171"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577172"><a href="#local-1627577172"><span class="hs-identifier">b'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627577171"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627577172"><span class="hs-identifier hs-var">b'</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627577171"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-202"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;ModOrigin: package both exposed/hidden&quot;</span><span>
</span><a name="line-203"></a><span>            </span><span class="hs-identifier">g</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a name="local-1627577173"><a href="#local-1627577173"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577173"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-204"></a><span>            </span><span class="hs-identifier">g</span><span> </span><a name="local-1627577174"><a href="#local-1627577174"><span class="hs-identifier">x</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577174"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-205"></a><span>    </span><a name="local-1627577175"><a href="#local-1627577175"><span class="hs-identifier">_x</span></a></a><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><a name="local-1627577176"><a href="#local-1627577176"><span class="hs-identifier">_y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;ModOrigin: hidden module redefined&quot;</span><span>
</span><a name="line-206"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Monoid"><span class="hs-identifier hs-type">Monoid</span></a><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-209"></a><span>    </span><a name="local-805306882"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mempty"><span class="hs-identifier">mempty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-210"></a><span>    </span><a name="local-805306883"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mappend"><span class="hs-identifier">mappend</span></a></a><span> </span><span class="hs-special">(</span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><a name="local-1627577149"><a href="#local-1627577149"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-1627577150"><a href="#local-1627577150"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-1627577151"><a href="#local-1627577151"><span class="hs-identifier">rhs</span></a></a><span> </span><a name="local-1627577152"><a href="#local-1627577152"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><a name="local-1627577153"><a href="#local-1627577153"><span class="hs-identifier">e'</span></a></a><span> </span><a name="local-1627577154"><a href="#local-1627577154"><span class="hs-identifier">res'</span></a></a><span> </span><a name="local-1627577155"><a href="#local-1627577155"><span class="hs-identifier">rhs'</span></a></a><span> </span><a name="local-1627577156"><a href="#local-1627577156"><span class="hs-identifier">f'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-211"></a><span>        </span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577157"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627577149"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-1627577153"><span class="hs-identifier hs-var">e'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627577150"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627577154"><span class="hs-identifier hs-var">res'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627577151"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627577155"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627577152"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1627577156"><span class="hs-identifier hs-var">f'</span></a><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-1627577157"><a href="#local-1627577157"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577158"><a href="#local-1627577158"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577159"><a href="#local-1627577159"><span class="hs-identifier">b'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627577158"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627577159"><span class="hs-identifier hs-var">b'</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627577158"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-214"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;ModOrigin: package both exposed/hidden&quot;</span><span>
</span><a name="line-215"></a><span>            </span><span class="hs-identifier">g</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a name="local-1627577160"><a href="#local-1627577160"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577160"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-216"></a><span>            </span><span class="hs-identifier">g</span><span> </span><a name="local-1627577161"><a href="#local-1627577161"><span class="hs-identifier">x</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577161"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-217"></a><span>    </span><span class="hs-identifier">mappend</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;ModOrigin: hidden module redefined&quot;</span><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-comment">-- | Is the name from the import actually visible? (i.e. does it cause</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- ambiguity, or is it only relevant when we're making suggestions?)</span><span>
</span><a name="line-221"></a><span class="hs-identifier">originVisible</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-222"></a><a name="originVisible"><a href="Packages.html#originVisible"><span class="hs-identifier">originVisible</span></a></a><span> </span><a href="Packages.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-223"></a><span class="hs-identifier">originVisible</span><span> </span><span class="hs-special">(</span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><a name="local-1627576657"><a href="#local-1627576657"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627576658"><a href="#local-1627576658"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627576659"><a href="#local-1627576659"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576657"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627576658"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1627576659"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-comment">-- | Are there actually no providers for this module?  This will never occur</span><span>
</span><a name="line-226"></a><span class="hs-comment">-- except when we're filtering based on package imports.</span><span>
</span><a name="line-227"></a><span class="hs-identifier">originEmpty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-228"></a><a name="originEmpty"><a href="Packages.html#originEmpty"><span class="hs-identifier">originEmpty</span></a></a><span> </span><span class="hs-special">(</span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-229"></a><span class="hs-identifier">originEmpty</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-comment">-- | 'UniqFM' map from 'UnitId'</span><span>
</span><a name="line-232"></a><span class="hs-keyword">type</span><span> </span><a name="UnitIdMap"><a href="Packages.html#UnitIdMap"><span class="hs-identifier">UnitIdMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-comment">-- | 'UniqFM' map from 'UnitId' to 'PackageConfig'</span><span>
</span><a name="line-235"></a><span class="hs-keyword">type</span><span> </span><a name="PackageConfigMap"><a href="Packages.html#PackageConfigMap"><span class="hs-identifier">PackageConfigMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#UnitIdMap"><span class="hs-identifier hs-type">UnitIdMap</span></a><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-comment">-- | 'UniqFM' map from 'UnitId' to (1) whether or not all modules which</span><span>
</span><a name="line-238"></a><span class="hs-comment">-- are exposed should be dumped into scope, (2) any custom renamings that</span><span>
</span><a name="line-239"></a><span class="hs-comment">-- should also be apply, and (3) what package name is associated with the</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- key, if it might be hidden</span><span>
</span><a name="line-241"></a><span class="hs-keyword">type</span><span> </span><a name="VisibilityMap"><a href="Packages.html#VisibilityMap"><span class="hs-identifier">VisibilityMap</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-242"></a><span>    </span><a href="Packages.html#UnitIdMap"><span class="hs-identifier hs-type">UnitIdMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span class="hs-comment">-- | Map from 'ModuleName' to 'Module' to all the origins of the bindings</span><span>
</span><a name="line-245"></a><span class="hs-comment">-- in scope.  The 'PackageConf' is not cached, mostly for convenience reasons</span><span>
</span><a name="line-246"></a><span class="hs-comment">-- (since this is the slow path, we'll just look it up again).</span><span>
</span><a name="line-247"></a><span class="hs-keyword">type</span><span> </span><a name="ModuleToPkgConfAll"><a href="Packages.html#ModuleToPkgConfAll"><span class="hs-identifier">ModuleToPkgConfAll</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-248"></a><span>    </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-keyword">data</span><span> </span><a name="PackageState"><a href="Packages.html#PackageState"><span class="hs-identifier">PackageState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PackageState"><a href="Packages.html#PackageState"><span class="hs-identifier">PackageState</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-251"></a><span>  </span><span class="hs-comment">-- | A mapping of 'UnitId' to 'PackageConfig'.  This list is adjusted</span><span>
</span><a name="line-252"></a><span>  </span><span class="hs-comment">-- so that only valid packages are here.  'PackageConfig' reflects</span><span>
</span><a name="line-253"></a><span>  </span><span class="hs-comment">-- what was stored *on disk*, except for the 'trusted' flag, which</span><span>
</span><a name="line-254"></a><span>  </span><span class="hs-comment">-- is adjusted at runtime.  (In particular, some packages in this map</span><span>
</span><a name="line-255"></a><span>  </span><span class="hs-comment">-- may have the 'exposed' flag be 'False'.)</span><span>
</span><a name="line-256"></a><span>  </span><a href="Packages.html#pkgIdMap"><span class="hs-identifier">pkgIdMap</span></a><span>              </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span>  </span><span class="hs-comment">-- | The packages we're going to link in eagerly.  This list</span><span>
</span><a name="line-259"></a><span>  </span><span class="hs-comment">-- should be in reverse dependency order; that is, a package</span><span>
</span><a name="line-260"></a><span>  </span><span class="hs-comment">-- is always mentioned before the packages it depends on.</span><span>
</span><a name="line-261"></a><span>  </span><a href="Packages.html#preloadPackages"><span class="hs-identifier">preloadPackages</span></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span>  </span><span class="hs-comment">-- | Packages which we explicitly depend on (from a command line flag).</span><span>
</span><a name="line-264"></a><span>  </span><span class="hs-comment">-- We'll use this to generate version macros.</span><span>
</span><a name="line-265"></a><span>  </span><a href="Packages.html#explicitPackages"><span class="hs-identifier">explicitPackages</span></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span>  </span><span class="hs-comment">-- | This is a full map from 'ModuleName' to all modules which may possibly</span><span>
</span><a name="line-268"></a><span>  </span><span class="hs-comment">-- be providing it.  These providers may be hidden (but we'll still want</span><span>
</span><a name="line-269"></a><span>  </span><span class="hs-comment">-- to report them in error messages), or it may be an ambiguous import.</span><span>
</span><a name="line-270"></a><span>  </span><a href="Packages.html#moduleToPkgConfAll"><span class="hs-identifier">moduleToPkgConfAll</span></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#ModuleToPkgConfAll"><span class="hs-identifier hs-type">ModuleToPkgConfAll</span></a><span class="hs-special">,</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span>  </span><span class="hs-comment">-- | A map, like 'moduleToPkgConfAll', but controlling plugin visibility.</span><span>
</span><a name="line-273"></a><span>  </span><a href="Packages.html#pluginModuleToPkgConfAll"><span class="hs-identifier">pluginModuleToPkgConfAll</span></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#ModuleToPkgConfAll"><span class="hs-identifier hs-type">ModuleToPkgConfAll</span></a><span>
</span><a name="line-274"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-identifier">emptyPackageState</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#PackageState"><span class="hs-identifier hs-type">PackageState</span></a><span>
</span><a name="line-277"></a><a name="emptyPackageState"><a href="Packages.html#emptyPackageState"><span class="hs-identifier">emptyPackageState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#PackageState"><span class="hs-identifier hs-var">PackageState</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-278"></a><span>    </span><span class="hs-identifier">pkgIdMap</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span class="hs-special">,</span><span>
</span><a name="line-279"></a><span>    </span><span class="hs-identifier">preloadPackages</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-280"></a><span>    </span><span class="hs-identifier">explicitPackages</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-281"></a><span>    </span><span class="hs-identifier">moduleToPkgConfAll</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#empty"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">,</span><span>
</span><a name="line-282"></a><span>    </span><span class="hs-identifier">pluginModuleToPkgConfAll</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#empty"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-283"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span class="hs-keyword">type</span><span> </span><a name="InstalledPackageIndex"><a href="Packages.html#InstalledPackageIndex"><span class="hs-identifier">InstalledPackageIndex</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-comment">-- | Empty package configuration map</span><span>
</span><a name="line-288"></a><span class="hs-identifier">emptyPackageConfigMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span>
</span><a name="line-289"></a><a name="emptyPackageConfigMap"><a href="Packages.html#emptyPackageConfigMap"><span class="hs-identifier">emptyPackageConfigMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span class="hs-comment">-- | Find the package we know about with the given key (e.g. @foo_HASH@), if any</span><span>
</span><a name="line-292"></a><span class="hs-identifier">lookupPackage</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-293"></a><a name="lookupPackage"><a href="Packages.html#lookupPackage"><span class="hs-identifier">lookupPackage</span></a></a><span> </span><a name="local-1627576660"><a href="#local-1627576660"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#lookupPackage%27"><span class="hs-identifier hs-var">lookupPackage'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pkgIdMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pkgState</span><span> </span><a href="#local-1627576660"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-identifier">lookupPackage'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-296"></a><a name="lookupPackage%27"><a href="Packages.html#lookupPackage%27"><span class="hs-identifier">lookupPackage'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-comment">-- | Search for packages with a given package ID (e.g. \&quot;foo-0.1\&quot;)</span><span>
</span><a name="line-299"></a><span class="hs-identifier">searchPackageId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PackageConfig.html#SourcePackageId"><span class="hs-identifier hs-type">SourcePackageId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-300"></a><a name="searchPackageId"><a href="Packages.html#searchPackageId"><span class="hs-identifier">searchPackageId</span></a></a><span> </span><a name="local-1627576661"><a href="#local-1627576661"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576662"><a href="#local-1627576662"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1627576662"><span class="hs-identifier hs-var">pid</span></a><span> </span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">sourcePackageId</span><span class="hs-special">)</span><span>
</span><a name="line-301"></a><span>                               </span><span class="hs-special">(</span><a href="Packages.html#listPackageConfigMap"><span class="hs-identifier hs-var">listPackageConfigMap</span></a><span> </span><a href="#local-1627576661"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-comment">-- | Extends the package configuration map with a list of package configs.</span><span>
</span><a name="line-304"></a><span class="hs-identifier">extendPackageConfigMap</span><span>
</span><a name="line-305"></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span>
</span><a name="line-306"></a><a name="extendPackageConfigMap"><a href="Packages.html#extendPackageConfigMap"><span class="hs-identifier">extendPackageConfigMap</span></a></a><span> </span><a name="local-1627576663"><a href="#local-1627576663"><span class="hs-identifier">pkg_map</span></a></a><span> </span><a name="local-1627576664"><a href="#local-1627576664"><span class="hs-identifier">new_pkgs</span></a></a><span>
</span><a name="line-307"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a><span> </span><a href="#local-1627576665"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="#local-1627576663"><span class="hs-identifier hs-var">pkg_map</span></a><span> </span><a href="#local-1627576664"><span class="hs-identifier hs-var">new_pkgs</span></a><span>
</span><a name="line-308"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576665"><a href="#local-1627576665"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-1627576666"><a href="#local-1627576666"><span class="hs-identifier">pkg_map</span></a></a><span> </span><a name="local-1627576667"><a href="#local-1627576667"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#addToUFM"><span class="hs-identifier hs-var">addToUFM</span></a><span> </span><a href="#local-1627576666"><span class="hs-identifier hs-var">pkg_map</span></a><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-1627576667"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576667"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span class="hs-comment">-- | Looks up the package with the given id in the package state, panicing if it is</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- not found</span><span>
</span><a name="line-312"></a><span class="hs-identifier">getPackageDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-313"></a><a name="getPackageDetails"><a href="Packages.html#getPackageDetails"><span class="hs-identifier">getPackageDetails</span></a></a><span> </span><a name="local-1627576668"><a href="#local-1627576668"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576669"><a href="#local-1627576669"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-314"></a><span>    </span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-string">&quot;getPackageDetails&quot;</span><span> </span><span class="hs-special">(</span><a href="Packages.html#lookupPackage"><span class="hs-identifier hs-var">lookupPackage</span></a><span> </span><a href="#local-1627576668"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576669"><span class="hs-identifier hs-var">pid</span></a><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span class="hs-comment">-- | Get a list of entries from the package database.  NB: be careful with</span><span>
</span><a name="line-317"></a><span class="hs-comment">-- this function, although all packages in this map are &quot;visible&quot;, this</span><span>
</span><a name="line-318"></a><span class="hs-comment">-- does not imply that the exposed-modules of the package are available</span><span>
</span><a name="line-319"></a><span class="hs-comment">-- (they may have been thinned or renamed).</span><span>
</span><a name="line-320"></a><span class="hs-identifier">listPackageConfigMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-321"></a><a name="listPackageConfigMap"><a href="Packages.html#listPackageConfigMap"><span class="hs-identifier">listPackageConfigMap</span></a></a><span> </span><a name="local-1627576670"><a href="#local-1627576670"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#eltsUFM"><span class="hs-identifier hs-var">eltsUFM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pkgIdMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pkgState</span><span> </span><a href="#local-1627576670"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-324"></a><span class="hs-comment">-- Loading the package db files and building up the package state</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-comment">-- | Call this after 'DynFlags.parseDynFlags'.  It reads the package</span><span>
</span><a name="line-327"></a><span class="hs-comment">-- database files, and sets up various internal tables of package</span><span>
</span><a name="line-328"></a><span class="hs-comment">-- information, according to the package-related flags on the</span><span>
</span><a name="line-329"></a><span class="hs-comment">-- command-line (@-package@, @-hide-package@ etc.)</span><span>
</span><a name="line-330"></a><span class="hs-comment">--</span><span>
</span><a name="line-331"></a><span class="hs-comment">-- Returns a list of packages to link in if we're doing dynamic linking.</span><span>
</span><a name="line-332"></a><span class="hs-comment">-- This list contains the packages that the user explicitly mentioned with</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- @-package@ flags.</span><span>
</span><a name="line-334"></a><span class="hs-comment">--</span><span>
</span><a name="line-335"></a><span class="hs-comment">-- 'initPackages' can be called again subsequently after updating the</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- 'packageFlags' field of the 'DynFlags', and it will update the</span><span>
</span><a name="line-337"></a><span class="hs-comment">-- 'pkgState' in 'DynFlags' and return a list of packages to</span><span>
</span><a name="line-338"></a><span class="hs-comment">-- link in.</span><span>
</span><a name="line-339"></a><span class="hs-identifier">initPackages</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-340"></a><a name="initPackages"><a href="Packages.html#initPackages"><span class="hs-identifier">initPackages</span></a></a><span> </span><a name="local-1627576671"><a href="#local-1627576671"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-341"></a><span>  </span><a name="local-1627576675"><a href="#local-1627576675"><span class="hs-identifier">pkg_db</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-342"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">pkgDatabase</span><span> </span><a href="#local-1627576671"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-343"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#readPackageConfigs"><span class="hs-identifier hs-var">readPackageConfigs</span></a><span> </span><a href="#local-1627576671"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-344"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627576672"><a href="#local-1627576672"><span class="hs-identifier">db</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627576673"><a href="#local-1627576673"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576674"><a href="#local-1627576674"><span class="hs-identifier">pkgs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-345"></a><span>                                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627576673"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#setBatchPackageFlags"><span class="hs-identifier hs-var">setBatchPackageFlags</span></a><span> </span><a href="#local-1627576671"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576674"><span class="hs-identifier hs-var">pkgs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627576672"><span class="hs-identifier hs-var">db</span></a><span>
</span><a name="line-346"></a><span>  </span><span class="hs-special">(</span><a name="local-1627576676"><a href="#local-1627576676"><span class="hs-identifier">pkg_state</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576677"><a href="#local-1627576677"><span class="hs-identifier">preload</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576678"><a href="#local-1627576678"><span class="hs-identifier">this_pkg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-347"></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Packages.html#mkPackageState"><span class="hs-identifier hs-var">mkPackageState</span></a><span> </span><a href="#local-1627576671"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576675"><span class="hs-identifier hs-var">pkg_db</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-348"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576671"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">pkgDatabase</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627576675"><span class="hs-identifier hs-var">pkg_db</span></a><span class="hs-special">,</span><span>
</span><a name="line-349"></a><span>                  </span><span class="hs-identifier">pkgState</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576676"><span class="hs-identifier hs-var">pkg_state</span></a><span class="hs-special">,</span><span>
</span><a name="line-350"></a><span>                  </span><span class="hs-identifier">thisPackage</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576678"><span class="hs-identifier hs-var">this_pkg</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-351"></a><span>          </span><a href="#local-1627576677"><span class="hs-identifier hs-var">preload</span></a><span class="hs-special">)</span><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- Reading the package database(s)</span><span>
</span><a name="line-355"></a><span>
</span><a name="line-356"></a><span class="hs-identifier">readPackageConfigs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-357"></a><a name="readPackageConfigs"><a href="Packages.html#readPackageConfigs"><span class="hs-identifier">readPackageConfigs</span></a></a><span> </span><a name="local-1627576679"><a href="#local-1627576679"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-358"></a><span>  </span><a name="local-1627576680"><a href="#local-1627576680"><span class="hs-identifier">conf_refs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Packages.html#getPackageConfRefs"><span class="hs-identifier hs-var">getPackageConfRefs</span></a><span> </span><a href="#local-1627576679"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-359"></a><span>  </span><a name="local-1627576681"><a href="#local-1627576681"><span class="hs-identifier">confs</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#resolvePackageConfig"><span class="hs-identifier hs-var">resolvePackageConfig</span></a><span> </span><a href="#local-1627576679"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576680"><span class="hs-identifier hs-var">conf_refs</span></a><span>
</span><a name="line-360"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#readPackageConfig"><span class="hs-identifier hs-var">readPackageConfig</span></a><span> </span><a href="#local-1627576679"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576681"><span class="hs-identifier hs-var">confs</span></a><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-identifier">getPackageConfRefs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#PkgConfRef"><span class="hs-identifier hs-type">PkgConfRef</span></a><span class="hs-special">]</span><span>
</span><a name="line-364"></a><a name="getPackageConfRefs"><a href="Packages.html#getPackageConfRefs"><span class="hs-identifier">getPackageConfRefs</span></a></a><span> </span><a name="local-1627576682"><a href="#local-1627576682"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-365"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576683"><a href="#local-1627576683"><span class="hs-identifier">system_conf_refs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#UserPkgConf"><span class="hs-identifier hs-var">UserPkgConf</span></a><span class="hs-special">,</span><span> </span><a href="DynFlags.html#GlobalPkgConf"><span class="hs-identifier hs-var">GlobalPkgConf</span></a><span class="hs-special">]</span><span>
</span><a name="line-366"></a><span>
</span><a name="line-367"></a><span>  </span><a name="local-1627576684"><a href="#local-1627576684"><span class="hs-identifier">e_pkg_path</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Exception.html#tryIO"><span class="hs-identifier hs-var">tryIO</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Environment.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Unicode.html#toUpper"><span class="hs-identifier hs-var">toUpper</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#programName"><span class="hs-identifier hs-var">programName</span></a><span> </span><a href="#local-1627576682"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;_PACKAGE_PATH&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-368"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576685"><a href="#local-1627576685"><span class="hs-identifier">base_conf_refs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627576684"><span class="hs-identifier hs-var">e_pkg_path</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-369"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576683"><span class="hs-identifier hs-var">system_conf_refs</span></a><span>
</span><a name="line-370"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><a name="local-1627576686"><a href="#local-1627576686"><span class="hs-identifier">path</span></a></a><span>
</span><a name="line-371"></a><span>         </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627576686"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#isSearchPathSeparator"><span class="hs-identifier hs-var">isSearchPathSeparator</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a><span> </span><a href="#local-1627576686"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">)</span><span>
</span><a name="line-372"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#PkgConfFile"><span class="hs-identifier hs-var">PkgConfFile</span></a><span> </span><span class="hs-special">(</span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#splitSearchPath"><span class="hs-identifier hs-var">splitSearchPath</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#init"><span class="hs-identifier hs-var">init</span></a><span> </span><a href="#local-1627576686"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576683"><span class="hs-identifier hs-var">system_conf_refs</span></a><span>
</span><a name="line-373"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-374"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DynFlags.html#PkgConfFile"><span class="hs-identifier hs-var">PkgConfFile</span></a><span> </span><span class="hs-special">(</span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#splitSearchPath"><span class="hs-identifier hs-var">splitSearchPath</span></a><span> </span><a href="#local-1627576686"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">)</span><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">extraPkgConfs</span><span> </span><a href="#local-1627576682"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576685"><span class="hs-identifier hs-var">base_conf_refs</span></a><span class="hs-special">)</span><span>
</span><a name="line-377"></a><span>  </span><span class="hs-comment">-- later packages shadow earlier ones.  extraPkgConfs</span><span>
</span><a name="line-378"></a><span>  </span><span class="hs-comment">-- is in the opposite order to the flags on the</span><span>
</span><a name="line-379"></a><span>  </span><span class="hs-comment">-- command line.</span><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span class="hs-identifier">resolvePackageConfig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#PkgConfRef"><span class="hs-identifier hs-type">PkgConfRef</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">)</span><span>
</span><a name="line-382"></a><a name="resolvePackageConfig"><a href="Packages.html#resolvePackageConfig"><span class="hs-identifier">resolvePackageConfig</span></a></a><span> </span><a name="local-1627576687"><a href="#local-1627576687"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="DynFlags.html#GlobalPkgConf"><span class="hs-identifier hs-var">GlobalPkgConf</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#systemPackageConfig"><span class="hs-identifier hs-var">systemPackageConfig</span></a><span> </span><a href="#local-1627576687"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-383"></a><span class="hs-comment">-- NB: This logic is reimplemented in Cabal, so if you change it,</span><span>
</span><a name="line-384"></a><span class="hs-comment">-- make sure you update Cabal.  (Or, better yet, dump it in the</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- compiler info so Cabal can use the info.)</span><span>
</span><a name="line-386"></a><span class="hs-identifier">resolvePackageConfig</span><span> </span><a name="local-1627576688"><a href="#local-1627576688"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="DynFlags.html#UserPkgConf"><span class="hs-identifier hs-var">UserPkgConf</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Exception.html#handleIO"><span class="hs-identifier hs-var">handleIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-387"></a><span>  </span><a name="local-1627576689"><a href="#local-1627576689"><span class="hs-identifier">dir</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#versionedAppDir"><span class="hs-identifier hs-var">versionedAppDir</span></a><span> </span><a href="#local-1627576688"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-388"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576690"><a href="#local-1627576690"><span class="hs-identifier">pkgconf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576689"><span class="hs-identifier hs-var">dir</span></a><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><span class="hs-string">&quot;package.conf.d&quot;</span><span>
</span><a name="line-389"></a><span>  </span><a name="local-1627576691"><a href="#local-1627576691"><span class="hs-identifier">exist</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../directory-1.2.5.1/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#doesDirectoryExist"><span class="hs-identifier hs-var">doesDirectoryExist</span></a><span> </span><a href="#local-1627576690"><span class="hs-identifier hs-var">pkgconf</span></a><span>
</span><a name="line-390"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627576691"><span class="hs-identifier hs-var">exist</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627576690"><span class="hs-identifier hs-var">pkgconf</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-391"></a><span class="hs-identifier">resolvePackageConfig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#PkgConfFile"><span class="hs-identifier hs-var">PkgConfFile</span></a><span> </span><a name="local-1627576692"><a href="#local-1627576692"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627576692"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-392"></a><span>
</span><a name="line-393"></a><span class="hs-identifier">readPackageConfig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-394"></a><a name="readPackageConfig"><a href="Packages.html#readPackageConfig"><span class="hs-identifier">readPackageConfig</span></a></a><span> </span><a name="local-1627576693"><a href="#local-1627576693"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576694"><a href="#local-1627576694"><span class="hs-identifier">conf_file</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-395"></a><span>  </span><a name="local-1627576702"><a href="#local-1627576702"><span class="hs-identifier">isdir</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../directory-1.2.5.1/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#doesDirectoryExist"><span class="hs-identifier hs-var">doesDirectoryExist</span></a><span> </span><a href="#local-1627576694"><span class="hs-identifier hs-var">conf_file</span></a><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span>  </span><a name="local-1627576706"><a href="#local-1627576706"><span class="hs-identifier">proto_pkg_configs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-398"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627576702"><span class="hs-identifier hs-var">isdir</span></a><span>
</span><a name="line-399"></a><span>       </span><span class="hs-keyword">then</span><span> </span><a href="#local-1627576695"><span class="hs-identifier hs-var">readDirStylePackageConfig</span></a><span> </span><a href="#local-1627576694"><span class="hs-identifier hs-var">conf_file</span></a><span>
</span><a name="line-400"></a><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-401"></a><span>            </span><a name="local-1627576703"><a href="#local-1627576703"><span class="hs-identifier">isfile</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../directory-1.2.5.1/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a><span> </span><a href="#local-1627576694"><span class="hs-identifier hs-var">conf_file</span></a><span>
</span><a name="line-402"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627576703"><span class="hs-identifier hs-var">isfile</span></a><span>
</span><a name="line-403"></a><span>               </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-404"></a><span>                 </span><a name="local-1627576704"><a href="#local-1627576704"><span class="hs-identifier">mpkgs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576696"><span class="hs-identifier hs-var">tryReadOldFileStylePackageConfig</span></a><span>
</span><a name="line-405"></a><span>                 </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627576704"><span class="hs-identifier hs-var">mpkgs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-406"></a><span>                   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627576705"><a href="#local-1627576705"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627576705"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-407"></a><span>                   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-408"></a><span>                      </span><span class="hs-string">&quot;ghc no longer supports single-file style package &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-409"></a><span>                      </span><span class="hs-string">&quot;databases (&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576694"><span class="hs-identifier hs-var">conf_file</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-410"></a><span>                      </span><span class="hs-string">&quot;) use 'ghc-pkg init' to create the database with &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-411"></a><span>                      </span><span class="hs-string">&quot;the correct format.&quot;</span><span>
</span><a name="line-412"></a><span>               </span><span class="hs-keyword">else</span><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-413"></a><span>                      </span><span class="hs-string">&quot;can't find a package database at &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576694"><span class="hs-identifier hs-var">conf_file</span></a><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-416"></a><span>      </span><a name="local-1627576707"><a href="#local-1627576707"><span class="hs-identifier">top_dir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#topDir"><span class="hs-identifier hs-var">topDir</span></a><span> </span><a href="#local-1627576693"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-417"></a><span>      </span><a name="local-1627576708"><a href="#local-1627576708"><span class="hs-identifier">pkgroot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a><span> </span><a href="#local-1627576694"><span class="hs-identifier hs-var">conf_file</span></a><span>
</span><a name="line-418"></a><span>      </span><a name="local-1627576709"><a href="#local-1627576709"><span class="hs-identifier">pkg_configs1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#mungePackagePaths"><span class="hs-identifier hs-var">mungePackagePaths</span></a><span> </span><a href="#local-1627576707"><span class="hs-identifier hs-var">top_dir</span></a><span> </span><a href="#local-1627576708"><span class="hs-identifier hs-var">pkgroot</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576706"><span class="hs-identifier hs-var">proto_pkg_configs</span></a><span>
</span><a name="line-419"></a><span>      </span><a name="local-1627576710"><a href="#local-1627576710"><span class="hs-identifier">pkg_configs2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#setBatchPackageFlags"><span class="hs-identifier hs-var">setBatchPackageFlags</span></a><span> </span><a href="#local-1627576693"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576709"><span class="hs-identifier hs-var">pkg_configs1</span></a><span>
</span><a name="line-420"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-421"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576694"><span class="hs-identifier hs-var">conf_file</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576710"><span class="hs-identifier hs-var">pkg_configs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-423"></a><span>    </span><a name="local-1627576695"><a href="#local-1627576695"><span class="hs-identifier">readDirStylePackageConfig</span></a></a><span> </span><a name="local-1627576697"><a href="#local-1627576697"><span class="hs-identifier">conf_dir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-424"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576698"><a href="#local-1627576698"><span class="hs-identifier">filename</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576697"><span class="hs-identifier hs-var">conf_dir</span></a><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><span class="hs-string">&quot;package.cache&quot;</span><span>
</span><a name="line-425"></a><span>      </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-1627576693"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Using binary package database:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1627576698"><span class="hs-identifier hs-var">filename</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>      </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.PackageDb.html#readPackageDbForGhc"><span class="hs-identifier hs-var">readPackageDbForGhc</span></a><span> </span><a href="#local-1627576698"><span class="hs-identifier hs-var">filename</span></a><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span>    </span><span class="hs-comment">-- Single-file style package dbs have been deprecated for some time, but</span><span>
</span><a name="line-429"></a><span>    </span><span class="hs-comment">-- it turns out that Cabal was using them in one place. So this is a</span><span>
</span><a name="line-430"></a><span>    </span><span class="hs-comment">-- workaround to allow older Cabal versions to use this newer ghc.</span><span>
</span><a name="line-431"></a><span>    </span><span class="hs-comment">-- We check if the file db contains just &quot;[]&quot; and if so, we look for a new</span><span>
</span><a name="line-432"></a><span>    </span><span class="hs-comment">-- dir-style db in conf_file.d/, ie in a dir next to the given file.</span><span>
</span><a name="line-433"></a><span>    </span><span class="hs-comment">-- We cannot just replace the file with a new dir style since Cabal still</span><span>
</span><a name="line-434"></a><span>    </span><span class="hs-comment">-- assumes it's a file and tries to overwrite with 'writeFile'.</span><span>
</span><a name="line-435"></a><span>    </span><span class="hs-comment">-- ghc-pkg also cooperates with this workaround.</span><span>
</span><a name="line-436"></a><span>    </span><a name="local-1627576696"><a href="#local-1627576696"><span class="hs-identifier">tryReadOldFileStylePackageConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-437"></a><span>      </span><a name="local-1627576699"><a href="#local-1627576699"><span class="hs-identifier">content</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/System.IO.html#readFile"><span class="hs-identifier hs-var">readFile</span></a><span> </span><a href="#local-1627576694"><span class="hs-identifier hs-var">conf_file</span></a><span> </span><span class="hs-special">`</span><a href="Exception.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a><span class="hs-special">`</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-438"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-1627576699"><span class="hs-identifier hs-var">content</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;[]&quot;</span><span>
</span><a name="line-439"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-440"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576700"><a href="#local-1627576700"><span class="hs-identifier">conf_dir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576694"><span class="hs-identifier hs-var">conf_file</span></a><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><span class="hs-string">&quot;d&quot;</span><span>
</span><a name="line-441"></a><span>          </span><a name="local-1627576701"><a href="#local-1627576701"><span class="hs-identifier">direxists</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../directory-1.2.5.1/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#doesDirectoryExist"><span class="hs-identifier hs-var">doesDirectoryExist</span></a><span> </span><a href="#local-1627576700"><span class="hs-identifier hs-var">conf_dir</span></a><span>
</span><a name="line-442"></a><span>          </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627576701"><span class="hs-identifier hs-var">direxists</span></a><span>
</span><a name="line-443"></a><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-1627576693"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Ignoring old file-style db and trying:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1627576700"><span class="hs-identifier hs-var">conf_dir</span></a><span class="hs-special">)</span><span>
</span><a name="line-444"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576695"><span class="hs-identifier hs-var">readDirStylePackageConfig</span></a><span> </span><a href="#local-1627576700"><span class="hs-identifier hs-var">conf_dir</span></a><span class="hs-special">)</span><span>
</span><a name="line-445"></a><span>             </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ghc-pkg will create it when it's updated</span><span>
</span><a name="line-446"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-447"></a><span>
</span><a name="line-448"></a><span class="hs-identifier">setBatchPackageFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-449"></a><a name="setBatchPackageFlags"><a href="Packages.html#setBatchPackageFlags"><span class="hs-identifier">setBatchPackageFlags</span></a></a><span> </span><a name="local-1627576711"><a href="#local-1627576711"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576712"><a href="#local-1627576712"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576713"><span class="hs-identifier hs-var">maybeDistrustAll</span></a><span> </span><a href="#local-1627576712"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-450"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-451"></a><span>    </span><a name="local-1627576713"><a href="#local-1627576713"><span class="hs-identifier">maybeDistrustAll</span></a></a><span> </span><a name="local-1627576715"><a href="#local-1627576715"><span class="hs-identifier">pkgs'</span></a></a><span>
</span><a name="line-452"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_DistrustAllPackages"><span class="hs-identifier hs-var">Opt_DistrustAllPackages</span></a><span> </span><a href="#local-1627576711"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627576714"><span class="hs-identifier hs-var">distrust</span></a><span> </span><a href="#local-1627576715"><span class="hs-identifier hs-var">pkgs'</span></a><span>
</span><a name="line-453"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                           </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576715"><span class="hs-identifier hs-var">pkgs'</span></a><span>
</span><a name="line-454"></a><span>
</span><a name="line-455"></a><span>    </span><a name="local-1627576714"><a href="#local-1627576714"><span class="hs-identifier">distrust</span></a></a><span> </span><a name="local-1627576716"><a href="#local-1627576716"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576716"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">trusted</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-456"></a><span>
</span><a name="line-457"></a><span class="hs-comment">-- TODO: This code is duplicated in utils/ghc-pkg/Main.hs</span><span>
</span><a name="line-458"></a><span class="hs-identifier">mungePackagePaths</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-459"></a><span class="hs-comment">-- Perform path/URL variable substitution as per the Cabal ${pkgroot} spec</span><span>
</span><a name="line-460"></a><span class="hs-comment">-- (http://www.haskell.org/pipermail/libraries/2009-May/011772.html)</span><span>
</span><a name="line-461"></a><span class="hs-comment">-- Paths/URLs can be relative to ${pkgroot} or ${pkgrooturl}.</span><span>
</span><a name="line-462"></a><span class="hs-comment">-- The &quot;pkgroot&quot; is the directory containing the package database.</span><span>
</span><a name="line-463"></a><span class="hs-comment">--</span><span>
</span><a name="line-464"></a><span class="hs-comment">-- Also perform a similar substitution for the older GHC-specific</span><span>
</span><a name="line-465"></a><span class="hs-comment">-- &quot;$topdir&quot; variable. The &quot;topdir&quot; is the location of the ghc</span><span>
</span><a name="line-466"></a><span class="hs-comment">-- installation (obtained from the -B option).</span><span>
</span><a name="line-467"></a><a name="mungePackagePaths"><a href="Packages.html#mungePackagePaths"><span class="hs-identifier">mungePackagePaths</span></a></a><span> </span><a name="local-1627576717"><a href="#local-1627576717"><span class="hs-identifier">top_dir</span></a></a><span> </span><a name="local-1627576718"><a href="#local-1627576718"><span class="hs-identifier">pkgroot</span></a></a><span> </span><a name="local-1627576719"><a href="#local-1627576719"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-468"></a><span>    </span><a href="#local-1627576719"><span class="hs-identifier hs-var">pkg</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-469"></a><span>      </span><span class="hs-identifier">importDirs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576720"><span class="hs-identifier hs-var">munge_paths</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">importDirs</span><span> </span><a href="#local-1627576719"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-470"></a><span>      </span><span class="hs-identifier">includeDirs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576720"><span class="hs-identifier hs-var">munge_paths</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">includeDirs</span><span> </span><a href="#local-1627576719"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-471"></a><span>      </span><span class="hs-identifier">libraryDirs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576720"><span class="hs-identifier hs-var">munge_paths</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">libraryDirs</span><span> </span><a href="#local-1627576719"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-472"></a><span>      </span><span class="hs-identifier">frameworkDirs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576720"><span class="hs-identifier hs-var">munge_paths</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">frameworkDirs</span><span> </span><a href="#local-1627576719"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-473"></a><span>      </span><span class="hs-identifier">haddockInterfaces</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576720"><span class="hs-identifier hs-var">munge_paths</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">haddockInterfaces</span><span> </span><a href="#local-1627576719"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-474"></a><span>      </span><span class="hs-identifier">haddockHTMLs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576721"><span class="hs-identifier hs-var">munge_urls</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">haddockHTMLs</span><span> </span><a href="#local-1627576719"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span>
</span><a name="line-475"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-476"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-477"></a><span>    </span><a name="local-1627576720"><a href="#local-1627576720"><span class="hs-identifier">munge_paths</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627576722"><span class="hs-identifier hs-var">munge_path</span></a><span>
</span><a name="line-478"></a><span>    </span><a name="local-1627576721"><a href="#local-1627576721"><span class="hs-identifier">munge_urls</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627576723"><span class="hs-identifier hs-var">munge_url</span></a><span>
</span><a name="line-479"></a><span>
</span><a name="line-480"></a><span>    </span><a name="local-1627576722"><a href="#local-1627576722"><span class="hs-identifier">munge_path</span></a></a><span> </span><a name="local-1627576726"><a href="#local-1627576726"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-481"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627576727"><a href="#local-1627576727"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576725"><span class="hs-identifier hs-var">stripVarPrefix</span></a><span> </span><span class="hs-string">&quot;${pkgroot}&quot;</span><span> </span><a href="#local-1627576726"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576718"><span class="hs-identifier hs-var">pkgroot</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576727"><span class="hs-identifier hs-var">p'</span></a><span>
</span><a name="line-482"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627576728"><a href="#local-1627576728"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576725"><span class="hs-identifier hs-var">stripVarPrefix</span></a><span> </span><span class="hs-string">&quot;$topdir&quot;</span><span>    </span><a href="#local-1627576726"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576717"><span class="hs-identifier hs-var">top_dir</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576728"><span class="hs-identifier hs-var">p'</span></a><span>
</span><a name="line-483"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                                </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576726"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span>    </span><a name="local-1627576723"><a href="#local-1627576723"><span class="hs-identifier">munge_url</span></a></a><span> </span><a name="local-1627576729"><a href="#local-1627576729"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-486"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627576730"><a href="#local-1627576730"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576725"><span class="hs-identifier hs-var">stripVarPrefix</span></a><span> </span><span class="hs-string">&quot;${pkgrooturl}&quot;</span><span> </span><a href="#local-1627576729"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576724"><span class="hs-identifier hs-var">toUrlPath</span></a><span> </span><a href="#local-1627576718"><span class="hs-identifier hs-var">pkgroot</span></a><span> </span><a href="#local-1627576730"><span class="hs-identifier hs-var">p'</span></a><span>
</span><a name="line-487"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627576731"><a href="#local-1627576731"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576725"><span class="hs-identifier hs-var">stripVarPrefix</span></a><span> </span><span class="hs-string">&quot;$httptopdir&quot;</span><span>   </span><a href="#local-1627576729"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576724"><span class="hs-identifier hs-var">toUrlPath</span></a><span> </span><a href="#local-1627576717"><span class="hs-identifier hs-var">top_dir</span></a><span> </span><a href="#local-1627576731"><span class="hs-identifier hs-var">p'</span></a><span>
</span><a name="line-488"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576729"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span>    </span><a name="local-1627576724"><a href="#local-1627576724"><span class="hs-identifier">toUrlPath</span></a></a><span> </span><a name="local-1627576732"><a href="#local-1627576732"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-1627576733"><a href="#local-1627576733"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;file:///&quot;</span><span>
</span><a name="line-491"></a><span>                 </span><span class="hs-comment">-- URLs always use posix style '/' separators:</span><span>
</span><a name="line-492"></a><span>                 </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#joinPath"><span class="hs-identifier hs-var">FilePath</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Posix</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">joinPath</span></a><span>
</span><a name="line-493"></a><span>                        </span><span class="hs-special">(</span><a href="#local-1627576732"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-comment">-- We need to drop a leading &quot;/&quot; or &quot;\\&quot;</span><span>
</span><a name="line-494"></a><span>                             </span><span class="hs-comment">-- if there is one:</span><span>
</span><a name="line-495"></a><span>                             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#dropWhile"><span class="hs-identifier hs-var">dropWhile</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#isPathSeparator"><span class="hs-identifier hs-var">isPathSeparator</span></a><span class="hs-special">)</span><span>
</span><a name="line-496"></a><span>                                       </span><span class="hs-special">(</span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#splitDirectories"><span class="hs-identifier hs-var">FilePath</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitDirectories</span></a><span> </span><a href="#local-1627576733"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-497"></a><span>
</span><a name="line-498"></a><span>    </span><span class="hs-comment">-- We could drop the separator here, and then use &lt;/&gt; above. However,</span><span>
</span><a name="line-499"></a><span>    </span><span class="hs-comment">-- by leaving it in and using ++ we keep the same path separator</span><span>
</span><a name="line-500"></a><span>    </span><span class="hs-comment">-- rather than letting FilePath change it to use \ as the separator</span><span>
</span><a name="line-501"></a><span>    </span><a name="local-1627576725"><a href="#local-1627576725"><span class="hs-identifier">stripVarPrefix</span></a></a><span> </span><a name="local-1627576734"><a href="#local-1627576734"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-1627576735"><a href="#local-1627576735"><span class="hs-identifier">path</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#stripPrefix"><span class="hs-identifier hs-var">stripPrefix</span></a><span> </span><a href="#local-1627576734"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-1627576735"><span class="hs-identifier hs-var">path</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-502"></a><span>                              </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-503"></a><span>                              </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627576736"><a href="#local-1627576736"><span class="hs-identifier">cs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627576737"><a href="#local-1627576737"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#isPathSeparator"><span class="hs-identifier hs-var">isPathSeparator</span></a><span> </span><a href="#local-1627576737"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627576736"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-504"></a><span>                              </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-505"></a><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-508"></a><span class="hs-comment">-- Modify our copy of the package database based on trust flags,</span><span>
</span><a name="line-509"></a><span class="hs-comment">-- -trust and -distrust.</span><span>
</span><a name="line-510"></a><span>
</span><a name="line-511"></a><span class="hs-identifier">applyTrustFlag</span><span>
</span><a name="line-512"></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-513"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#UnusablePackages"><span class="hs-identifier hs-type">UnusablePackages</span></a><span>
</span><a name="line-514"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-515"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#TrustFlag"><span class="hs-identifier hs-type">TrustFlag</span></a><span>
</span><a name="line-516"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-517"></a><a name="applyTrustFlag"><a href="Packages.html#applyTrustFlag"><span class="hs-identifier">applyTrustFlag</span></a></a><span> </span><a name="local-1627576738"><a href="#local-1627576738"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576739"><a href="#local-1627576739"><span class="hs-identifier">unusable</span></a></a><span> </span><a name="local-1627576740"><a href="#local-1627576740"><span class="hs-identifier">pkgs</span></a></a><span> </span><a name="local-1627576741"><a href="#local-1627576741"><span class="hs-identifier">flag</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-518"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627576741"><span class="hs-identifier hs-var">flag</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-519"></a><span>    </span><span class="hs-comment">-- we trust all matching packages. Maybe should only trust first one?</span><span>
</span><a name="line-520"></a><span>    </span><span class="hs-comment">-- and leave others the same or set them untrusted</span><span>
</span><a name="line-521"></a><span>    </span><a href="DynFlags.html#TrustPackage"><span class="hs-identifier hs-var">TrustPackage</span></a><span> </span><a name="local-1627576742"><a href="#local-1627576742"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-522"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="Packages.html#selectPackages"><span class="hs-identifier hs-var">selectPackages</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#matchingStr"><span class="hs-identifier hs-var">matchingStr</span></a><span> </span><a href="#local-1627576742"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576740"><span class="hs-identifier hs-var">pkgs</span></a><span> </span><a href="#local-1627576739"><span class="hs-identifier hs-var">unusable</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-523"></a><span>         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a name="local-1627576743"><a href="#local-1627576743"><span class="hs-identifier">ps</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#trustFlagErr"><span class="hs-identifier hs-var">trustFlagErr</span></a><span> </span><a href="#local-1627576738"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576741"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="#local-1627576743"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-524"></a><span>         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><a name="local-1627576744"><a href="#local-1627576744"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><a name="local-1627576745"><a href="#local-1627576745"><span class="hs-identifier">qs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627576746"><span class="hs-identifier hs-var">trust</span></a><span> </span><a href="#local-1627576744"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576745"><span class="hs-identifier hs-var">qs</span></a><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span>          </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576746"><a href="#local-1627576746"><span class="hs-identifier">trust</span></a></a><span> </span><a name="local-1627576747"><a href="#local-1627576747"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576747"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">trusted</span><span class="hs-glyph">=</span><span class="hs-identifier hs-var">True</span><span class="hs-special">}</span><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span>    </span><a href="DynFlags.html#DistrustPackage"><span class="hs-identifier hs-var">DistrustPackage</span></a><span> </span><a name="local-1627576748"><a href="#local-1627576748"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-528"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="Packages.html#selectPackages"><span class="hs-identifier hs-var">selectPackages</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#matchingStr"><span class="hs-identifier hs-var">matchingStr</span></a><span> </span><a href="#local-1627576748"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576740"><span class="hs-identifier hs-var">pkgs</span></a><span> </span><a href="#local-1627576739"><span class="hs-identifier hs-var">unusable</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-529"></a><span>         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a name="local-1627576749"><a href="#local-1627576749"><span class="hs-identifier">ps</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#trustFlagErr"><span class="hs-identifier hs-var">trustFlagErr</span></a><span> </span><a href="#local-1627576738"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576741"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="#local-1627576749"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-530"></a><span>         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><a name="local-1627576750"><a href="#local-1627576750"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><a name="local-1627576751"><a href="#local-1627576751"><span class="hs-identifier">qs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627576752"><span class="hs-identifier hs-var">distrust</span></a><span> </span><a href="#local-1627576750"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576751"><span class="hs-identifier hs-var">qs</span></a><span class="hs-special">)</span><span>
</span><a name="line-531"></a><span>          </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576752"><a href="#local-1627576752"><span class="hs-identifier">distrust</span></a></a><span> </span><a name="local-1627576753"><a href="#local-1627576753"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576753"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">trusted</span><span class="hs-glyph">=</span><span class="hs-identifier hs-var">False</span><span class="hs-special">}</span><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span class="hs-identifier">applyPackageFlag</span><span>
</span><a name="line-534"></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-535"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#UnusablePackages"><span class="hs-identifier hs-type">UnusablePackages</span></a><span>
</span><a name="line-536"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- if False, if you expose a package, it implicitly hides</span><span>
</span><a name="line-537"></a><span>           </span><span class="hs-comment">-- any previously exposed packages with the same name</span><span>
</span><a name="line-538"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-539"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a><span>           </span><span class="hs-comment">-- Initially exposed</span><span>
</span><a name="line-540"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#PackageFlag"><span class="hs-identifier hs-type">PackageFlag</span></a><span>               </span><span class="hs-comment">-- flag to apply</span><span>
</span><a name="line-541"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Packages.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a><span>        </span><span class="hs-comment">-- Now exposed</span><span>
</span><a name="line-542"></a><span>
</span><a name="line-543"></a><a name="applyPackageFlag"><a href="Packages.html#applyPackageFlag"><span class="hs-identifier">applyPackageFlag</span></a></a><span> </span><a name="local-1627576754"><a href="#local-1627576754"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576755"><a href="#local-1627576755"><span class="hs-identifier">unusable</span></a></a><span> </span><a name="local-1627576756"><a href="#local-1627576756"><span class="hs-identifier">no_hide_others</span></a></a><span> </span><a name="local-1627576757"><a href="#local-1627576757"><span class="hs-identifier">pkgs</span></a></a><span> </span><a name="local-1627576758"><a href="#local-1627576758"><span class="hs-identifier">vm</span></a></a><span> </span><a name="local-1627576759"><a href="#local-1627576759"><span class="hs-identifier">flag</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-544"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627576759"><span class="hs-identifier hs-var">flag</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-545"></a><span>    </span><a href="DynFlags.html#ExposePackage"><span class="hs-identifier hs-var">ExposePackage</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627576760"><a href="#local-1627576760"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#ModRenaming"><span class="hs-identifier hs-var">ModRenaming</span></a><span> </span><a name="local-1627576761"><a href="#local-1627576761"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627576762"><a href="#local-1627576762"><span class="hs-identifier">rns</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-546"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="Packages.html#selectPackages"><span class="hs-identifier hs-var">selectPackages</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#matching"><span class="hs-identifier hs-var">matching</span></a><span> </span><a href="#local-1627576760"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576757"><span class="hs-identifier hs-var">pkgs</span></a><span> </span><a href="#local-1627576755"><span class="hs-identifier hs-var">unusable</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-547"></a><span>         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a name="local-1627576763"><a href="#local-1627576763"><span class="hs-identifier">ps</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#packageFlagErr"><span class="hs-identifier hs-var">packageFlagErr</span></a><span> </span><a href="#local-1627576754"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576759"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="#local-1627576763"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-548"></a><span>         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><a name="local-1627576764"><a href="#local-1627576764"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627576766"><span class="hs-identifier hs-var">vm'</span></a><span>
</span><a name="line-549"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-550"></a><span>           </span><a name="local-1627576765"><a href="#local-1627576765"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#fsPackageName"><span class="hs-identifier hs-var">fsPackageName</span></a><span> </span><a href="#local-1627576764"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-551"></a><span>           </span><a name="local-1627576766"><a href="#local-1627576766"><span class="hs-identifier">vm'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#addToUFM_C"><span class="hs-identifier hs-var">addToUFM_C</span></a><span> </span><a href="#local-1627576767"><span class="hs-identifier hs-var">edit</span></a><span> </span><a href="#local-1627576768"><span class="hs-identifier hs-var">vm_cleared</span></a><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-1627576764"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627576761"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576762"><span class="hs-identifier hs-var">rns</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576765"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-552"></a><span>           </span><a name="local-1627576767"><a href="#local-1627576767"><span class="hs-identifier">edit</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627576769"><a href="#local-1627576769"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576770"><a href="#local-1627576770"><span class="hs-identifier">rns</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576771"><a href="#local-1627576771"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627576772"><a href="#local-1627576772"><span class="hs-identifier">b'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576773"><a href="#local-1627576773"><span class="hs-identifier">rns'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627576769"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1627576772"><span class="hs-identifier hs-var">b'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576770"><span class="hs-identifier hs-var">rns</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576773"><span class="hs-identifier hs-var">rns'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576771"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-553"></a><span>           </span><span class="hs-comment">-- In the old days, if you said `ghc -package p-0.1 -package p-0.2`</span><span>
</span><a name="line-554"></a><span>           </span><span class="hs-comment">-- (or if p-0.1 was registered in the pkgdb as exposed: True),</span><span>
</span><a name="line-555"></a><span>           </span><span class="hs-comment">-- the second package flag would override the first one and you</span><span>
</span><a name="line-556"></a><span>           </span><span class="hs-comment">-- would only see p-0.2 in exposed modules.  This is good for</span><span>
</span><a name="line-557"></a><span>           </span><span class="hs-comment">-- usability.</span><span>
</span><a name="line-558"></a><span>           </span><span class="hs-comment">--</span><span>
</span><a name="line-559"></a><span>           </span><span class="hs-comment">-- However, with thinning and renaming (or Backpack), there might be</span><span>
</span><a name="line-560"></a><span>           </span><span class="hs-comment">-- situations where you legitimately want to see two versions of a</span><span>
</span><a name="line-561"></a><span>           </span><span class="hs-comment">-- package at the same time, and this behavior would make it</span><span>
</span><a name="line-562"></a><span>           </span><span class="hs-comment">-- impossible to do so.  So we decided that if you pass</span><span>
</span><a name="line-563"></a><span>           </span><span class="hs-comment">-- -hide-all-packages, this should turn OFF the overriding behavior</span><span>
</span><a name="line-564"></a><span>           </span><span class="hs-comment">-- where an exposed package hides all other packages with the same</span><span>
</span><a name="line-565"></a><span>           </span><span class="hs-comment">-- name.  This should not affect Cabal at all, which only ever</span><span>
</span><a name="line-566"></a><span>           </span><span class="hs-comment">-- exposes one package at a time.</span><span>
</span><a name="line-567"></a><span>           </span><span class="hs-comment">--</span><span>
</span><a name="line-568"></a><span>           </span><span class="hs-comment">-- NB: Why a variable no_hide_others?  We have to apply this logic to</span><span>
</span><a name="line-569"></a><span>           </span><span class="hs-comment">-- -plugin-package too, and it's more consistent if the switch in</span><span>
</span><a name="line-570"></a><span>           </span><span class="hs-comment">-- behavior is based off of</span><span>
</span><a name="line-571"></a><span>           </span><span class="hs-comment">-- -hide-all-packages/-hide-all-plugin-packages depending on what</span><span>
</span><a name="line-572"></a><span>           </span><span class="hs-comment">-- flag is in question.</span><span>
</span><a name="line-573"></a><span>           </span><a name="local-1627576768"><a href="#local-1627576768"><span class="hs-identifier">vm_cleared</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627576756"><span class="hs-identifier hs-var">no_hide_others</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576758"><span class="hs-identifier hs-var">vm</span></a><span>
</span><a name="line-574"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#filterUFM_Directly"><span class="hs-identifier hs-var">filterUFM_Directly</span></a><span>
</span><a name="line-575"></a><span>                            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627576774"><a href="#local-1627576774"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-1627576775"><a href="#local-1627576775"><span class="hs-identifier">n'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576774"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-1627576764"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-576"></a><span>                                                </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1627576765"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1627576775"><span class="hs-identifier hs-var">n'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576758"><span class="hs-identifier hs-var">vm</span></a><span>
</span><a name="line-577"></a><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;applyPackageFlag&quot;</span><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span>    </span><a href="DynFlags.html#HidePackage"><span class="hs-identifier hs-var">HidePackage</span></a><span> </span><a name="local-1627576776"><a href="#local-1627576776"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-580"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="Packages.html#selectPackages"><span class="hs-identifier hs-var">selectPackages</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#matchingStr"><span class="hs-identifier hs-var">matchingStr</span></a><span> </span><a href="#local-1627576776"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576757"><span class="hs-identifier hs-var">pkgs</span></a><span> </span><a href="#local-1627576755"><span class="hs-identifier hs-var">unusable</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-581"></a><span>         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a name="local-1627576777"><a href="#local-1627576777"><span class="hs-identifier">ps</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#packageFlagErr"><span class="hs-identifier hs-var">packageFlagErr</span></a><span> </span><a href="#local-1627576754"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576759"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="#local-1627576777"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-582"></a><span>         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><a name="local-1627576778"><a href="#local-1627576778"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627576779"><span class="hs-identifier hs-var">vm'</span></a><span>
</span><a name="line-583"></a><span>          </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576779"><a href="#local-1627576779"><span class="hs-identifier">vm'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#delListFromUFM"><span class="hs-identifier hs-var">delListFromUFM</span></a><span> </span><a href="#local-1627576758"><span class="hs-identifier hs-var">vm</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-1627576778"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-584"></a><span>
</span><a name="line-585"></a><span class="hs-identifier">selectPackages</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-586"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#UnusablePackages"><span class="hs-identifier hs-type">UnusablePackages</span></a><span>
</span><a name="line-587"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#UnusablePackageReason"><span class="hs-identifier hs-type">UnusablePackageReason</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-588"></a><span>                  </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-589"></a><a name="selectPackages"><a href="Packages.html#selectPackages"><span class="hs-identifier">selectPackages</span></a></a><span> </span><a name="local-1627576780"><a href="#local-1627576780"><span class="hs-identifier">matches</span></a></a><span> </span><a name="local-1627576781"><a href="#local-1627576781"><span class="hs-identifier">pkgs</span></a></a><span> </span><a name="local-1627576782"><a href="#local-1627576782"><span class="hs-identifier">unusable</span></a></a><span>
</span><a name="line-590"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627576783"><a href="#local-1627576783"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><a name="local-1627576784"><a href="#local-1627576784"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span> </span><a href="#local-1627576780"><span class="hs-identifier hs-var">matches</span></a><span> </span><a href="#local-1627576781"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-591"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627576783"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-592"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576780"><span class="hs-identifier hs-var">matches</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#elems"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span></a><span> </span><a href="#local-1627576782"><span class="hs-identifier hs-var">unusable</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>        </span><span class="hs-comment">-- NB: packages from later package databases are LATER</span><span>
</span><a name="line-594"></a><span>        </span><span class="hs-comment">-- in the list.  We want to prefer the latest package.</span><span>
</span><a name="line-595"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#sortByVersion"><span class="hs-identifier hs-var">sortByVersion</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627576783"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1627576784"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span>
</span><a name="line-596"></a><span>
</span><a name="line-597"></a><span class="hs-comment">-- A package named on the command line can either include the</span><span>
</span><a name="line-598"></a><span class="hs-comment">-- version, or just the name if it is unambiguous.</span><span>
</span><a name="line-599"></a><span class="hs-identifier">matchingStr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-600"></a><a name="matchingStr"><a href="Packages.html#matchingStr"><span class="hs-identifier">matchingStr</span></a></a><span> </span><a name="local-1627576785"><a href="#local-1627576785"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-1627576786"><a href="#local-1627576786"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-601"></a><span>        </span><span class="hs-glyph">=</span><span>  </span><a href="#local-1627576785"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PackageConfig.html#sourcePackageIdString"><span class="hs-identifier hs-var">sourcePackageIdString</span></a><span> </span><a href="#local-1627576786"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-602"></a><span>        </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1627576785"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PackageConfig.html#packageNameString"><span class="hs-identifier hs-var">packageNameString</span></a><span> </span><a href="#local-1627576786"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-603"></a><span>
</span><a name="line-604"></a><span class="hs-identifier">matchingId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-605"></a><a name="matchingId"><a href="Packages.html#matchingId"><span class="hs-identifier">matchingId</span></a></a><span> </span><a name="local-1627576787"><a href="#local-1627576787"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-1627576788"><a href="#local-1627576788"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576787"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Module.html#unitIdString"><span class="hs-identifier hs-var">unitIdString</span></a><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-1627576788"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-606"></a><span>
</span><a name="line-607"></a><span class="hs-identifier">matching</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#PackageArg"><span class="hs-identifier hs-type">PackageArg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-608"></a><a name="matching"><a href="Packages.html#matching"><span class="hs-identifier">matching</span></a></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#PackageArg"><span class="hs-identifier hs-var">PackageArg</span></a><span> </span><a name="local-1627576789"><a href="#local-1627576789"><span class="hs-identifier">str</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#matchingStr"><span class="hs-identifier hs-var">matchingStr</span></a><span> </span><a href="#local-1627576789"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-609"></a><span class="hs-identifier">matching</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#UnitIdArg"><span class="hs-identifier hs-var">UnitIdArg</span></a><span> </span><a name="local-1627576790"><a href="#local-1627576790"><span class="hs-identifier">str</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#matchingId"><span class="hs-identifier hs-var">matchingId</span></a><span> </span><a href="#local-1627576790"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-610"></a><span>
</span><a name="line-611"></a><span class="hs-identifier">sortByVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-612"></a><a name="sortByVersion"><a href="Packages.html#sortByVersion"><span class="hs-identifier">sortByVersion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#comparing"><span class="hs-identifier hs-var">comparing</span></a><span> </span><span class="hs-identifier">packageVersion</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-613"></a><span>
</span><a name="line-614"></a><span class="hs-identifier">comparing</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627576652"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627576653"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576652"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576653"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576653"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-615"></a><a name="comparing"><a href="Packages.html#comparing"><span class="hs-identifier">comparing</span></a></a><span> </span><a name="local-1627576791"><a href="#local-1627576791"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627576792"><a href="#local-1627576792"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627576793"><a href="#local-1627576793"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576791"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627576792"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-1627576791"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627576793"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-616"></a><span>
</span><a name="line-617"></a><span class="hs-identifier">packageFlagErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-618"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#PackageFlag"><span class="hs-identifier hs-type">PackageFlag</span></a><span>
</span><a name="line-619"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#UnusablePackageReason"><span class="hs-identifier hs-type">UnusablePackageReason</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-620"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1627576651"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-621"></a><span>
</span><a name="line-622"></a><span class="hs-comment">-- for missing DPH package we emit a more helpful error message, because</span><span>
</span><a name="line-623"></a><span class="hs-comment">-- this may be the result of using -fdph-par or -fdph-seq.</span><span>
</span><a name="line-624"></a><a name="packageFlagErr"><a href="Packages.html#packageFlagErr"><span class="hs-identifier">packageFlagErr</span></a></a><span> </span><a name="local-1627576794"><a href="#local-1627576794"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#ExposePackage"><span class="hs-identifier hs-var">ExposePackage</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#PackageArg"><span class="hs-identifier hs-var">PackageArg</span></a><span> </span><a name="local-1627576795"><a href="#local-1627576795"><span class="hs-identifier">pkg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-625"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627576797"><span class="hs-identifier hs-var">is_dph_package</span></a><span> </span><a href="#local-1627576795"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-626"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a><span> </span><a href="#local-1627576794"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1627576796"><span class="hs-identifier hs-var">dph_err</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-627"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576796"><a href="#local-1627576796"><span class="hs-identifier">dph_err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1627576795"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot; package is not installed.&quot;</span><span>
</span><a name="line-628"></a><span>                  </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;To install it: \&quot;cabal install dph\&quot;.&quot;</span><span>
</span><a name="line-629"></a><span>        </span><a name="local-1627576797"><a href="#local-1627576797"><span class="hs-identifier">is_dph_package</span></a></a><span> </span><a name="local-1627576798"><a href="#local-1627576798"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;dph&quot;</span><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576798"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-630"></a><span class="hs-identifier">packageFlagErr</span><span> </span><a name="local-1627576799"><a href="#local-1627576799"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576800"><a href="#local-1627576800"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-1627576801"><a href="#local-1627576801"><span class="hs-identifier">reasons</span></a></a><span>
</span><a name="line-631"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#packageFlagErr%27"><span class="hs-identifier hs-var">packageFlagErr'</span></a><span> </span><a href="#local-1627576799"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#pprFlag"><span class="hs-identifier hs-var">pprFlag</span></a><span> </span><a href="#local-1627576800"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576801"><span class="hs-identifier hs-var">reasons</span></a><span>
</span><a name="line-632"></a><span>
</span><a name="line-633"></a><span class="hs-identifier">trustFlagErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-634"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#TrustFlag"><span class="hs-identifier hs-type">TrustFlag</span></a><span>
</span><a name="line-635"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#UnusablePackageReason"><span class="hs-identifier hs-type">UnusablePackageReason</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-636"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1627576650"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-637"></a><a name="trustFlagErr"><a href="Packages.html#trustFlagErr"><span class="hs-identifier">trustFlagErr</span></a></a><span> </span><a name="local-1627576802"><a href="#local-1627576802"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576803"><a href="#local-1627576803"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-1627576804"><a href="#local-1627576804"><span class="hs-identifier">reasons</span></a></a><span>
</span><a name="line-638"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#packageFlagErr%27"><span class="hs-identifier hs-var">packageFlagErr'</span></a><span> </span><a href="#local-1627576802"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#pprTrustFlag"><span class="hs-identifier hs-var">pprTrustFlag</span></a><span> </span><a href="#local-1627576803"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576804"><span class="hs-identifier hs-var">reasons</span></a><span>
</span><a name="line-639"></a><span>
</span><a name="line-640"></a><span class="hs-identifier">packageFlagErr'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-641"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-642"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#UnusablePackageReason"><span class="hs-identifier hs-type">UnusablePackageReason</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-643"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1627576649"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-644"></a><a name="packageFlagErr%27"><a href="Packages.html#packageFlagErr%27"><span class="hs-identifier">packageFlagErr'</span></a></a><span> </span><a name="local-1627576805"><a href="#local-1627576805"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576806"><a href="#local-1627576806"><span class="hs-identifier">flag_doc</span></a></a><span> </span><a name="local-1627576807"><a href="#local-1627576807"><span class="hs-identifier">reasons</span></a></a><span>
</span><a name="line-645"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a><span> </span><a href="#local-1627576805"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1627576808"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-646"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576808"><a href="#local-1627576808"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;cannot satisfy &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="#local-1627576806"><span class="hs-identifier hs-var">flag_doc</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-647"></a><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627576807"><span class="hs-identifier hs-var">reasons</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;: &quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-648"></a><span>              </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="#local-1627576809"><span class="hs-identifier hs-var">ppr_reasons</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-649"></a><span>                      </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(use -v for more information)&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-650"></a><span>        </span><a name="local-1627576809"><a href="#local-1627576809"><span class="hs-identifier">ppr_reasons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627576810"><span class="hs-identifier hs-var">ppr_reason</span></a><span> </span><a href="#local-1627576807"><span class="hs-identifier hs-var">reasons</span></a><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>        </span><a name="local-1627576810"><a href="#local-1627576810"><span class="hs-identifier">ppr_reason</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627576811"><a href="#local-1627576811"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576812"><a href="#local-1627576812"><span class="hs-identifier">reason</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-652"></a><span>            </span><a href="Packages.html#pprReason"><span class="hs-identifier hs-var">pprReason</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576811"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1627576812"><span class="hs-identifier hs-var">reason</span></a><span>
</span><a name="line-653"></a><span>
</span><a name="line-654"></a><span class="hs-identifier">pprFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#PackageFlag"><span class="hs-identifier hs-type">PackageFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-655"></a><a name="pprFlag"><a href="Packages.html#pprFlag"><span class="hs-identifier">pprFlag</span></a></a><span> </span><a name="local-1627576813"><a href="#local-1627576813"><span class="hs-identifier">flag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627576813"><span class="hs-identifier hs-var">flag</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-656"></a><span>    </span><a href="DynFlags.html#HidePackage"><span class="hs-identifier hs-var">HidePackage</span></a><span> </span><a name="local-1627576814"><a href="#local-1627576814"><span class="hs-identifier">p</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;-hide-package &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1627576814"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-657"></a><span>    </span><a href="DynFlags.html#ExposePackage"><span class="hs-identifier hs-var">ExposePackage</span></a><span> </span><a name="local-1627576815"><a href="#local-1627576815"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1627576815"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-658"></a><span>
</span><a name="line-659"></a><span class="hs-identifier">pprTrustFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#TrustFlag"><span class="hs-identifier hs-type">TrustFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-660"></a><a name="pprTrustFlag"><a href="Packages.html#pprTrustFlag"><span class="hs-identifier">pprTrustFlag</span></a></a><span> </span><a name="local-1627576816"><a href="#local-1627576816"><span class="hs-identifier">flag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627576816"><span class="hs-identifier hs-var">flag</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-661"></a><span>    </span><a href="DynFlags.html#TrustPackage"><span class="hs-identifier hs-var">TrustPackage</span></a><span> </span><a name="local-1627576817"><a href="#local-1627576817"><span class="hs-identifier">p</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;-trust &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1627576817"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-662"></a><span>    </span><a href="DynFlags.html#DistrustPackage"><span class="hs-identifier hs-var">DistrustPackage</span></a><span> </span><a name="local-1627576818"><a href="#local-1627576818"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;-distrust &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1627576818"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-665"></a><span class="hs-comment">-- Wired-in packages</span><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-identifier">wired_in_pkgids</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-668"></a><a name="wired_in_pkgids"><a href="Packages.html#wired_in_pkgids"><span class="hs-identifier">wired_in_pkgids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Module.html#unitIdString"><span class="hs-identifier hs-var">unitIdString</span></a><span> </span><a href="Module.html#wiredInUnitIds"><span class="hs-identifier hs-var">wiredInUnitIds</span></a><span>
</span><a name="line-669"></a><span>
</span><a name="line-670"></a><span class="hs-keyword">type</span><span> </span><a name="WiredPackagesMap"><a href="Packages.html#WiredPackagesMap"><span class="hs-identifier">WiredPackagesMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-671"></a><span>
</span><a name="line-672"></a><span class="hs-identifier">findWiredInPackages</span><span>
</span><a name="line-673"></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-674"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- database</span><span>
</span><a name="line-675"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a><span>             </span><span class="hs-comment">-- info on what packages are visible</span><span>
</span><a name="line-676"></a><span>                                </span><span class="hs-comment">-- for wired in selection</span><span>
</span><a name="line-677"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- package database updated for wired in</span><span>
</span><a name="line-678"></a><span>          </span><a href="Packages.html#WiredPackagesMap"><span class="hs-identifier hs-type">WiredPackagesMap</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- map from unit id to wired identity</span><span>
</span><a name="line-679"></a><span>
</span><a name="line-680"></a><a name="findWiredInPackages"><a href="Packages.html#findWiredInPackages"><span class="hs-identifier">findWiredInPackages</span></a></a><span> </span><a name="local-1627576819"><a href="#local-1627576819"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576820"><a href="#local-1627576820"><span class="hs-identifier">pkgs</span></a></a><span> </span><a name="local-1627576821"><a href="#local-1627576821"><span class="hs-identifier">vis_map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-681"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-682"></a><span>  </span><span class="hs-comment">-- Now we must find our wired-in packages, and rename them to</span><span>
</span><a name="line-683"></a><span>  </span><span class="hs-comment">-- their canonical names (eg. base-1.0 ==&gt; base).</span><span>
</span><a name="line-684"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-685"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-686"></a><span>        </span><span class="hs-identifier">matches</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-687"></a><span>        </span><a name="local-1627576824"><a href="#local-1627576824"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-special">`</span><a name="local-1627576822"><a href="#local-1627576822"><span class="hs-identifier">matches</span></a></a><span class="hs-special">`</span><span> </span><a name="local-1627576825"><a href="#local-1627576825"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PackageConfig.html#packageNameString"><span class="hs-identifier hs-var">packageNameString</span></a><span> </span><a href="#local-1627576824"><span class="hs-identifier hs-var">pc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627576825"><span class="hs-identifier hs-var">pid</span></a><span>
</span><a name="line-688"></a><span>
</span><a name="line-689"></a><span>        </span><span class="hs-comment">-- find which package corresponds to each wired-in package</span><span>
</span><a name="line-690"></a><span>        </span><span class="hs-comment">-- delete any other packages with the same name</span><span>
</span><a name="line-691"></a><span>        </span><span class="hs-comment">-- update the package and any dependencies to point to the new</span><span>
</span><a name="line-692"></a><span>        </span><span class="hs-comment">-- one.</span><span>
</span><a name="line-693"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-694"></a><span>        </span><span class="hs-comment">-- When choosing which package to map to a wired-in package</span><span>
</span><a name="line-695"></a><span>        </span><span class="hs-comment">-- name, we try to pick the latest version of exposed packages.</span><span>
</span><a name="line-696"></a><span>        </span><span class="hs-comment">-- However, if there are no exposed wired in packages available</span><span>
</span><a name="line-697"></a><span>        </span><span class="hs-comment">-- (e.g. -hide-all-packages was used), we can't bail: we *have*</span><span>
</span><a name="line-698"></a><span>        </span><span class="hs-comment">-- to assign a package for the wired-in package: so we try again</span><span>
</span><a name="line-699"></a><span>        </span><span class="hs-comment">-- with hidden packages included to (and pick the latest</span><span>
</span><a name="line-700"></a><span>        </span><span class="hs-comment">-- version).</span><span>
</span><a name="line-701"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-702"></a><span>        </span><span class="hs-comment">-- You can also override the default choice by using -ignore-package:</span><span>
</span><a name="line-703"></a><span>        </span><span class="hs-comment">-- this works even when there is no exposed wired in package</span><span>
</span><a name="line-704"></a><span>        </span><span class="hs-comment">-- available.</span><span>
</span><a name="line-705"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-706"></a><span>        </span><span class="hs-identifier">findWiredInPackage</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>
</span><a name="line-707"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">)</span><span>
</span><a name="line-708"></a><span>        </span><a name="local-1627576823"><a href="#local-1627576823"><span class="hs-identifier">findWiredInPackage</span></a></a><span> </span><a name="local-1627576826"><a href="#local-1627576826"><span class="hs-identifier">pkgs</span></a></a><span> </span><a name="local-1627576827"><a href="#local-1627576827"><span class="hs-identifier">wired_pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-709"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576831"><a href="#local-1627576831"><span class="hs-identifier">all_ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1627576833"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1627576833"><a href="#local-1627576833"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576826"><span class="hs-identifier hs-var">pkgs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576833"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="#local-1627576822"><span class="hs-identifier hs-var">matches</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576827"><span class="hs-identifier hs-var">wired_pkg</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-710"></a><span>               </span><a name="local-1627576832"><a href="#local-1627576832"><span class="hs-identifier">all_exposed_ps</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-711"></a><span>                    </span><span class="hs-special">[</span><span> </span><a href="#local-1627576834"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1627576834"><a href="#local-1627576834"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576831"><span class="hs-identifier hs-var">all_ps</span></a><span>
</span><a name="line-712"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="UniqFM.html#elemUFM"><span class="hs-identifier hs-var">elemUFM</span></a><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-1627576834"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576821"><span class="hs-identifier hs-var">vis_map</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-713"></a><span>           </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627576832"><span class="hs-identifier hs-var">all_exposed_ps</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-714"></a><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627576831"><span class="hs-identifier hs-var">all_ps</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-715"></a><span>                       </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576828"><span class="hs-identifier hs-var">notfound</span></a><span>
</span><a name="line-716"></a><span>                       </span><a name="local-1627576835"><a href="#local-1627576835"><span class="hs-identifier">many</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576829"><span class="hs-identifier hs-var">pick</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#sortByVersion"><span class="hs-identifier hs-var">sortByVersion</span></a><span> </span><a href="#local-1627576835"><span class="hs-identifier hs-var">many</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-717"></a><span>            </span><a name="local-1627576836"><a href="#local-1627576836"><span class="hs-identifier">many</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576829"><span class="hs-identifier hs-var">pick</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#sortByVersion"><span class="hs-identifier hs-var">sortByVersion</span></a><span> </span><a href="#local-1627576836"><span class="hs-identifier hs-var">many</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-718"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-719"></a><span>                </span><a name="local-1627576828"><a href="#local-1627576828"><span class="hs-identifier">notfound</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-720"></a><span>                          </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-1627576819"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-721"></a><span>                            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;wired-in package &quot;</span><span>
</span><a name="line-722"></a><span>                                 </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1627576827"><span class="hs-identifier hs-var">wired_pkg</span></a><span>
</span><a name="line-723"></a><span>                                 </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot; not found.&quot;</span><span>
</span><a name="line-724"></a><span>                          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-725"></a><span>                </span><span class="hs-identifier">pick</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-726"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">)</span><span>
</span><a name="line-727"></a><span>                </span><a name="local-1627576829"><a href="#local-1627576829"><span class="hs-identifier">pick</span></a></a><span> </span><a name="local-1627576830"><a href="#local-1627576830"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-728"></a><span>                        </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-1627576819"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-729"></a><span>                            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;wired-in package &quot;</span><span>
</span><a name="line-730"></a><span>                                 </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1627576827"><span class="hs-identifier hs-var">wired_pkg</span></a><span>
</span><a name="line-731"></a><span>                                 </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot; mapped to &quot;</span><span>
</span><a name="line-732"></a><span>                                 </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576830"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span>
</span><a name="line-733"></a><span>                        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627576830"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span>
</span><a name="line-734"></a><span>
</span><a name="line-735"></a><span>
</span><a name="line-736"></a><span>  </span><a name="local-1627576837"><a href="#local-1627576837"><span class="hs-identifier">mb_wired_in_pkgs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576823"><span class="hs-identifier hs-var">findWiredInPackage</span></a><span> </span><a href="#local-1627576820"><span class="hs-identifier hs-var">pkgs</span></a><span class="hs-special">)</span><span> </span><a href="Packages.html#wired_in_pkgids"><span class="hs-identifier hs-var">wired_in_pkgids</span></a><span>
</span><a name="line-737"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-738"></a><span>        </span><a name="local-1627576838"><a href="#local-1627576838"><span class="hs-identifier">wired_in_pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a><span> </span><a href="#local-1627576837"><span class="hs-identifier hs-var">mb_wired_in_pkgs</span></a><span>
</span><a name="line-739"></a><span>        </span><a name="local-1627576839"><a href="#local-1627576839"><span class="hs-identifier">wired_in_ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576838"><span class="hs-identifier hs-var">wired_in_pkgs</span></a><span>
</span><a name="line-740"></a><span>
</span><a name="line-741"></a><span>        </span><span class="hs-comment">-- this is old: we used to assume that if there were</span><span>
</span><a name="line-742"></a><span>        </span><span class="hs-comment">-- multiple versions of wired-in packages installed that</span><span>
</span><a name="line-743"></a><span>        </span><span class="hs-comment">-- they were mutually exclusive.  Now we're assuming that</span><span>
</span><a name="line-744"></a><span>        </span><span class="hs-comment">-- you have one &quot;main&quot; version of each wired-in package</span><span>
</span><a name="line-745"></a><span>        </span><span class="hs-comment">-- (the latest version), and the others are backward-compat</span><span>
</span><a name="line-746"></a><span>        </span><span class="hs-comment">-- wrappers that depend on this one.  e.g. base-4.0 is the</span><span>
</span><a name="line-747"></a><span>        </span><span class="hs-comment">-- latest, base-3.0 is a compat wrapper depending on base-4.0.</span><span>
</span><a name="line-748"></a><span>        </span><span class="hs-comment">{-
        deleteOtherWiredInPackages pkgs = filterOut bad pkgs
          where bad p = any (p `matches`) wired_in_pkgids
                      &amp;&amp; package p `notElem` map fst wired_in_ids
        -}</span><span>
</span><a name="line-753"></a><span>
</span><a name="line-754"></a><span>        </span><span class="hs-identifier">wiredInMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-755"></a><span>        </span><a name="local-1627576840"><a href="#local-1627576840"><span class="hs-identifier">wiredInMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a><span> </span><a href="#local-1627576842"><span class="hs-identifier hs-var">add_mapping</span></a><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#empty"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span> </span><a href="#local-1627576820"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-756"></a><span>          </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576842"><a href="#local-1627576842"><span class="hs-identifier">add_mapping</span></a></a><span> </span><a name="local-1627576843"><a href="#local-1627576843"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627576844"><a href="#local-1627576844"><span class="hs-identifier">pkg</span></a></a><span>
</span><a name="line-757"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576845"><a href="#local-1627576845"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576844"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-758"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="#local-1627576845"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576839"><span class="hs-identifier hs-var">wired_in_ids</span></a><span>
</span><a name="line-759"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#insert"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-1627576845"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#stringToUnitId"><span class="hs-identifier hs-var">stringToUnitId</span></a><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#packageNameString"><span class="hs-identifier hs-var">packageNameString</span></a><span> </span><a href="#local-1627576844"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627576843"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-760"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576843"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span>        </span><a name="local-1627576841"><a href="#local-1627576841"><span class="hs-identifier">updateWiredInDependencies</span></a></a><span> </span><a name="local-1627576846"><a href="#local-1627576846"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576848"><span class="hs-identifier hs-var">upd_deps</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1627576847"><span class="hs-identifier hs-var">upd_pkg</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576846"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-763"></a><span>          </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576847"><a href="#local-1627576847"><span class="hs-identifier">upd_pkg</span></a></a><span> </span><a name="local-1627576851"><a href="#local-1627576851"><span class="hs-identifier">pkg</span></a></a><span>
</span><a name="line-764"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576851"><span class="hs-identifier hs-var">pkg</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576839"><span class="hs-identifier hs-var">wired_in_ids</span></a><span>
</span><a name="line-765"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576851"><span class="hs-identifier hs-var">pkg</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-766"></a><span>                      </span><span class="hs-identifier">unitId</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#stringToUnitId"><span class="hs-identifier hs-var">stringToUnitId</span></a><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#packageNameString"><span class="hs-identifier hs-var">packageNameString</span></a><span> </span><a href="#local-1627576851"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span>
</span><a name="line-767"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-768"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-769"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576851"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-770"></a><span>                </span><a name="local-1627576848"><a href="#local-1627576848"><span class="hs-identifier">upd_deps</span></a></a><span> </span><a name="local-1627576852"><a href="#local-1627576852"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576852"><span class="hs-identifier hs-var">pkg</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-771"></a><span>                      </span><span class="hs-identifier">depends</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627576850"><span class="hs-identifier hs-var">upd_wired_in</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">depends</span><span> </span><a href="#local-1627576852"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-772"></a><span>                      </span><span class="hs-identifier">exposedModules</span><span>
</span><a name="line-773"></a><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627576853"><a href="#local-1627576853"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-1627576854"><a href="#local-1627576854"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627576853"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="#local-1627576849"><span class="hs-identifier hs-var">upd_wired_in_mod</span></a><span> </span><a href="#local-1627576854"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-774"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier">exposedModules</span><span> </span><a href="#local-1627576852"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span>
</span><a name="line-775"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-776"></a><span>                </span><a name="local-1627576849"><a href="#local-1627576849"><span class="hs-identifier">upd_wired_in_mod</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><a name="local-1627576855"><a href="#local-1627576855"><span class="hs-identifier">uid</span></a></a><span> </span><a name="local-1627576856"><a href="#local-1627576856"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576850"><span class="hs-identifier hs-var">upd_wired_in</span></a><span> </span><a href="#local-1627576855"><span class="hs-identifier hs-var">uid</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576856"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-777"></a><span>                </span><a name="local-1627576850"><a href="#local-1627576850"><span class="hs-identifier">upd_wired_in</span></a></a><span> </span><a name="local-1627576857"><a href="#local-1627576857"><span class="hs-identifier">key</span></a></a><span>
</span><a name="line-778"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627576858"><a href="#local-1627576858"><span class="hs-identifier">key'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#lookup"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span></a><span> </span><a href="#local-1627576857"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="#local-1627576840"><span class="hs-identifier hs-var">wiredInMap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576858"><span class="hs-identifier hs-var">key'</span></a><span>
</span><a name="line-779"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576857"><span class="hs-identifier hs-var">key</span></a><span>
</span><a name="line-780"></a><span>
</span><a name="line-781"></a><span>
</span><a name="line-782"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576841"><span class="hs-identifier hs-var">updateWiredInDependencies</span></a><span> </span><a href="#local-1627576820"><span class="hs-identifier hs-var">pkgs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576840"><span class="hs-identifier hs-var">wiredInMap</span></a><span class="hs-special">)</span><span>
</span><a name="line-783"></a><span>
</span><a name="line-784"></a><span class="hs-identifier">updateVisibilityMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#WiredPackagesMap"><span class="hs-identifier hs-type">WiredPackagesMap</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a><span>
</span><a name="line-785"></a><a name="updateVisibilityMap"><a href="Packages.html#updateVisibilityMap"><span class="hs-identifier">updateVisibilityMap</span></a></a><span> </span><a name="local-1627576859"><a href="#local-1627576859"><span class="hs-identifier">wiredInMap</span></a></a><span> </span><a name="local-1627576860"><a href="#local-1627576860"><span class="hs-identifier">vis_map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a><span> </span><a href="#local-1627576861"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627576860"><span class="hs-identifier hs-var">vis_map</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#toList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><a href="#local-1627576859"><span class="hs-identifier hs-var">wiredInMap</span></a><span class="hs-special">)</span><span>
</span><a name="line-786"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576861"><a href="#local-1627576861"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627576862"><a href="#local-1627576862"><span class="hs-identifier">vm</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627576863"><a href="#local-1627576863"><span class="hs-identifier">from</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576864"><a href="#local-1627576864"><span class="hs-identifier">to</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span> </span><a href="#local-1627576860"><span class="hs-identifier hs-var">vis_map</span></a><span> </span><a href="#local-1627576863"><span class="hs-identifier hs-var">from</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-787"></a><span>                    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576862"><span class="hs-identifier hs-var">vm</span></a><span>
</span><a name="line-788"></a><span>                    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627576865"><a href="#local-1627576865"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="UniqFM.html#addToUFM"><span class="hs-identifier hs-var">addToUFM</span></a><span> </span><a href="#local-1627576862"><span class="hs-identifier hs-var">vm</span></a><span> </span><a href="#local-1627576864"><span class="hs-identifier hs-var">to</span></a><span> </span><a href="#local-1627576865"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-789"></a><span>
</span><a name="line-790"></a><span>
</span><a name="line-791"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-792"></a><span>
</span><a name="line-793"></a><span class="hs-keyword">type</span><span> </span><a name="IsShadowed"><a href="Packages.html#IsShadowed"><span class="hs-identifier">IsShadowed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-794"></a><span class="hs-keyword">data</span><span> </span><a name="UnusablePackageReason"><a href="Packages.html#UnusablePackageReason"><span class="hs-identifier">UnusablePackageReason</span></a></a><span>
</span><a name="line-795"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IgnoredWithFlag"><a href="Packages.html#IgnoredWithFlag"><span class="hs-identifier">IgnoredWithFlag</span></a></a><span>
</span><a name="line-796"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MissingDependencies"><a href="Packages.html#MissingDependencies"><span class="hs-identifier">MissingDependencies</span></a></a><span> </span><a href="Packages.html#IsShadowed"><span class="hs-identifier hs-type">IsShadowed</span></a><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>
</span><a name="line-797"></a><span>
</span><a name="line-798"></a><span class="hs-keyword">type</span><span> </span><a name="UnusablePackages"><a href="Packages.html#UnusablePackages"><span class="hs-identifier">UnusablePackages</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-799"></a><span>                            </span><span class="hs-special">(</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#UnusablePackageReason"><span class="hs-identifier hs-type">UnusablePackageReason</span></a><span class="hs-special">)</span><span>
</span><a name="line-800"></a><span>
</span><a name="line-801"></a><span class="hs-identifier">pprReason</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#UnusablePackageReason"><span class="hs-identifier hs-type">UnusablePackageReason</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-802"></a><a name="pprReason"><a href="Packages.html#pprReason"><span class="hs-identifier">pprReason</span></a></a><span> </span><a name="local-1627576866"><a href="#local-1627576866"><span class="hs-identifier">pref</span></a></a><span> </span><a name="local-1627576867"><a href="#local-1627576867"><span class="hs-identifier">reason</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627576867"><span class="hs-identifier hs-var">reason</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-803"></a><span>  </span><a href="Packages.html#IgnoredWithFlag"><span class="hs-identifier hs-var">IgnoredWithFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-804"></a><span>      </span><a href="#local-1627576866"><span class="hs-identifier hs-var">pref</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ignored due to an -ignore-package flag&quot;</span><span>
</span><a name="line-805"></a><span>  </span><a href="Packages.html#MissingDependencies"><span class="hs-identifier hs-var">MissingDependencies</span></a><span> </span><a name="local-1627576868"><a href="#local-1627576868"><span class="hs-identifier">is_shadowed</span></a></a><span> </span><a name="local-1627576869"><a href="#local-1627576869"><span class="hs-identifier">deps</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-806"></a><span>      </span><a href="#local-1627576866"><span class="hs-identifier hs-var">pref</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;unusable due to&quot;</span><span>
</span><a name="line-807"></a><span>           </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-1627576868"><span class="hs-identifier hs-var">is_shadowed</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;shadowed&quot;</span><span>
</span><a name="line-808"></a><span>                               </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;missing or recursive&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-809"></a><span>           </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;dependencies:&quot;</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-810"></a><span>        </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627576869"><span class="hs-identifier hs-var">deps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-811"></a><span>
</span><a name="line-812"></a><span class="hs-identifier">reportUnusable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#UnusablePackages"><span class="hs-identifier hs-type">UnusablePackages</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-813"></a><a name="reportUnusable"><a href="Packages.html#reportUnusable"><span class="hs-identifier">reportUnusable</span></a></a><span> </span><a name="local-1627576870"><a href="#local-1627576870"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576871"><a href="#local-1627576871"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="#local-1627576872"><span class="hs-identifier hs-var">report</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#toList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><a href="#local-1627576871"><span class="hs-identifier hs-var">pkgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-814"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-815"></a><span>    </span><a name="local-1627576872"><a href="#local-1627576872"><span class="hs-identifier">report</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627576873"><a href="#local-1627576873"><span class="hs-identifier">ipid</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627576874"><a href="#local-1627576874"><span class="hs-identifier">reason</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-816"></a><span>       </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-1627576870"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-817"></a><span>         </span><a href="Packages.html#pprReason"><span class="hs-identifier hs-var">pprReason</span></a><span>
</span><a name="line-818"></a><span>           </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;package&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627576873"><span class="hs-identifier hs-var">ipid</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-1627576874"><span class="hs-identifier hs-var">reason</span></a><span>
</span><a name="line-819"></a><span>
</span><a name="line-820"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-821"></a><span class="hs-comment">--</span><span>
</span><a name="line-822"></a><span class="hs-comment">-- Detect any packages that have missing dependencies, and also any</span><span>
</span><a name="line-823"></a><span class="hs-comment">-- mutually-recursive groups of packages (loops in the package graph</span><span>
</span><a name="line-824"></a><span class="hs-comment">-- are not allowed).  We do this by taking the least fixpoint of the</span><span>
</span><a name="line-825"></a><span class="hs-comment">-- dependency graph, repeatedly adding packages whose dependencies are</span><span>
</span><a name="line-826"></a><span class="hs-comment">-- satisfied until no more can be added.</span><span>
</span><a name="line-827"></a><span class="hs-comment">--</span><span>
</span><a name="line-828"></a><span class="hs-identifier">findBroken</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#IsShadowed"><span class="hs-identifier hs-type">IsShadowed</span></a><span>
</span><a name="line-829"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-830"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-831"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#UnusablePackages"><span class="hs-identifier hs-type">UnusablePackages</span></a><span>
</span><a name="line-832"></a><a name="findBroken"><a href="Packages.html#findBroken"><span class="hs-identifier">findBroken</span></a></a><span> </span><a name="local-1627576875"><a href="#local-1627576875"><span class="hs-identifier">is_shadowed</span></a></a><span> </span><a name="local-1627576876"><a href="#local-1627576876"><span class="hs-identifier">pkgs</span></a></a><span> </span><a name="local-1627576877"><a href="#local-1627576877"><span class="hs-identifier">pkg_map0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576878"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1627576877"><span class="hs-identifier hs-var">pkg_map0</span></a><span> </span><a href="#local-1627576876"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-833"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-834"></a><span>   </span><a name="local-1627576878"><a href="#local-1627576878"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627576880"><a href="#local-1627576880"><span class="hs-identifier">avail</span></a></a><span> </span><a name="local-1627576881"><a href="#local-1627576881"><span class="hs-identifier">pkg_map</span></a></a><span> </span><a name="local-1627576882"><a href="#local-1627576882"><span class="hs-identifier">not_avail</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-835"></a><span>     </span><span class="hs-keyword">case</span><span> </span><a href="Util.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576879"><span class="hs-identifier hs-var">depsAvailable</span></a><span> </span><a href="#local-1627576881"><span class="hs-identifier hs-var">pkg_map</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576882"><span class="hs-identifier hs-var">not_avail</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-836"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a name="local-1627576883"><a href="#local-1627576883"><span class="hs-identifier">not_avail</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-837"></a><span>            </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#fromList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576884"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627576884"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#MissingDependencies"><span class="hs-identifier hs-var">MissingDependencies</span></a><span> </span><a href="#local-1627576875"><span class="hs-identifier hs-var">is_shadowed</span></a><span> </span><a href="#local-1627576885"><span class="hs-identifier hs-var">deps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-838"></a><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1627576884"><a href="#local-1627576884"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-1627576885"><a href="#local-1627576885"><span class="hs-identifier">deps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576883"><span class="hs-identifier hs-var">not_avail</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-839"></a><span>        </span><span class="hs-special">(</span><a name="local-1627576886"><a href="#local-1627576886"><span class="hs-identifier">new_avail</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576887"><a href="#local-1627576887"><span class="hs-identifier">not_avail</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-840"></a><span>            </span><a href="#local-1627576878"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576886"><span class="hs-identifier hs-var">new_avail</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576880"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576888"><span class="hs-identifier hs-var">pkg_map'</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1627576887"><span class="hs-identifier hs-var">not_avail</span></a><span class="hs-special">)</span><span>
</span><a name="line-841"></a><span>            </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576888"><a href="#local-1627576888"><span class="hs-identifier">pkg_map'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FiniteMap.html#insertList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insertList</span></a><span>
</span><a name="line-842"></a><span>                             </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576889"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576889"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1627576889"><a href="#local-1627576889"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576886"><span class="hs-identifier hs-var">new_avail</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-843"></a><span>                             </span><a href="#local-1627576881"><span class="hs-identifier hs-var">pkg_map</span></a><span>
</span><a name="line-844"></a><span>
</span><a name="line-845"></a><span>   </span><span class="hs-identifier">depsAvailable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#InstalledPackageIndex"><span class="hs-identifier hs-type">InstalledPackageIndex</span></a><span>
</span><a name="line-846"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-847"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-848"></a><span>   </span><a name="local-1627576879"><a href="#local-1627576879"><span class="hs-identifier">depsAvailable</span></a></a><span> </span><a name="local-1627576890"><a href="#local-1627576890"><span class="hs-identifier">pkg_map</span></a></a><span> </span><a name="local-1627576891"><a href="#local-1627576891"><span class="hs-identifier">pkg</span></a></a><span>
</span><a name="line-849"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627576892"><span class="hs-identifier hs-var">dangling</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a href="#local-1627576891"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-850"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576891"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576892"><span class="hs-identifier hs-var">dangling</span></a><span class="hs-special">)</span><span>
</span><a name="line-851"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576892"><a href="#local-1627576892"><span class="hs-identifier">dangling</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#member"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">member</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576890"><span class="hs-identifier hs-var">pkg_map</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">depends</span><span> </span><a href="#local-1627576891"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span>
</span><a name="line-852"></a><span>
</span><a name="line-853"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-854"></a><span class="hs-comment">-- Ignore packages</span><span>
</span><a name="line-855"></a><span>
</span><a name="line-856"></a><span class="hs-identifier">ignorePackages</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="DynFlags.html#IgnorePackageFlag"><span class="hs-identifier hs-type">IgnorePackageFlag</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#UnusablePackages"><span class="hs-identifier hs-type">UnusablePackages</span></a><span>
</span><a name="line-857"></a><a name="ignorePackages"><a href="Packages.html#ignorePackages"><span class="hs-identifier">ignorePackages</span></a></a><span> </span><a name="local-1627576893"><a href="#local-1627576893"><span class="hs-identifier">flags</span></a></a><span> </span><a name="local-1627576894"><a href="#local-1627576894"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#fromList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><a href="#local-1627576895"><span class="hs-identifier hs-var">doit</span></a><span> </span><a href="#local-1627576893"><span class="hs-identifier hs-var">flags</span></a><span class="hs-special">)</span><span>
</span><a name="line-858"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-859"></a><span>  </span><a name="local-1627576895"><a href="#local-1627576895"><span class="hs-identifier">doit</span></a></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#IgnorePackage"><span class="hs-identifier hs-var">IgnorePackage</span></a><span> </span><a name="local-1627576896"><a href="#local-1627576896"><span class="hs-identifier">str</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-860"></a><span>     </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#matchingStr"><span class="hs-identifier hs-var">matchingStr</span></a><span> </span><a href="#local-1627576896"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576894"><span class="hs-identifier hs-var">pkgs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-861"></a><span>         </span><span class="hs-special">(</span><a name="local-1627576897"><a href="#local-1627576897"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576898"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627576898"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#IgnoredWithFlag"><span class="hs-identifier hs-var">IgnoredWithFlag</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-862"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a name="local-1627576898"><a href="#local-1627576898"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576897"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-863"></a><span>        </span><span class="hs-comment">-- missing package is not an error for -ignore-package,</span><span>
</span><a name="line-864"></a><span>        </span><span class="hs-comment">-- because a common usage is to -ignore-package P as</span><span>
</span><a name="line-865"></a><span>        </span><span class="hs-comment">-- a preventative measure just in case P exists.</span><span>
</span><a name="line-866"></a><span>
</span><a name="line-867"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-868"></a><span class="hs-comment">-- When all the command-line options are in, we can process our package</span><span>
</span><a name="line-869"></a><span class="hs-comment">-- settings and populate the package state.</span><span>
</span><a name="line-870"></a><span>
</span><a name="line-871"></a><span class="hs-identifier">mkPackageState</span><span>
</span><a name="line-872"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-873"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- initial databases</span><span>
</span><a name="line-874"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- preloaded packages</span><span>
</span><a name="line-875"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Packages.html#PackageState"><span class="hs-identifier hs-type">PackageState</span></a><span class="hs-special">,</span><span>
</span><a name="line-876"></a><span>           </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- new packages to preload</span><span>
</span><a name="line-877"></a><span>           </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- this package, might be modified if the current</span><span>
</span><a name="line-878"></a><span>                      </span><span class="hs-comment">-- package is a wired-in package.</span><span>
</span><a name="line-879"></a><span>
</span><a name="line-880"></a><a name="mkPackageState"><a href="Packages.html#mkPackageState"><span class="hs-identifier">mkPackageState</span></a></a><span> </span><a name="local-1627576899"><a href="#local-1627576899"><span class="hs-identifier">dflags0</span></a></a><span> </span><a name="local-1627576900"><a href="#local-1627576900"><span class="hs-identifier">dbs</span></a></a><span> </span><a name="local-1627576901"><a href="#local-1627576901"><span class="hs-identifier">preload0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-881"></a><span>  </span><a name="local-1627576902"><a href="#local-1627576902"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#interpretPackageEnv"><span class="hs-identifier hs-var">interpretPackageEnv</span></a><span> </span><a href="#local-1627576899"><span class="hs-identifier hs-var">dflags0</span></a><span>
</span><a name="line-882"></a><span>
</span><a name="line-883"></a><span>  </span><span class="hs-comment">-- Compute the unit id</span><span>
</span><a name="line-884"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576903"><a href="#local-1627576903"><span class="hs-identifier">this_package</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">thisPackage</span><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-885"></a><span>
</span><a name="line-886"></a><span class="hs-comment">{-
   Plan.

   There are two main steps for making the package state:

    1. We want to build a single, unified package database based
       on all of the input databases, which upholds the invariant that
       there is only one package per any UnitId, and that there are no
       dangling dependencies. We'll do this by successively merging each
       input database into this unified database:

       a) if an input database defines unit ID that is already in
          the unified database, that package SHADOWS the existing
          package in the current unified database
            * for every such shadowed package, we remove it and any
              packages which transitively depend on it from the
              unified datbase

       b) remove packages selected by -ignore-package from input database

       c) remove any packages with missing dependencies or mutually recursive
          dependencies from the input database

       d) report (with -v) any packages that were removed by steps 1-3

       e) merge the input database into the unified database

    2. We want to look at the flags controlling package visibility,
       and build a mapping of what module names are in scope and
       where they live.

       a) on the final, unified database, we apply -trust/-distrust
          flags directly, modifying the database so that the 'trusted'
          field has the correct value.

       b) we use the -package/-hide-package flags to compute a
          visibility map, stating what packages are &quot;exposed&quot; for
          the purposes of computing the module map.
          * if any flag refers to a package which was removed by 1-5, then
            we can give an error message explaining why
          * if -hide-all-packages what not specified, this step also
            hides packages which are superseded by later exposed packages
          * this step is done TWICE if -plugin-package/-hide-all-plugin-packages
            are used

       c) based on the visibility map, we pick wired packages and rewrite
          them to have the expected unitId.

       d) finally, using the visibility map and the package database,
          we build a mapping saying what every in scope module name points to.
-}</span><span>
</span><a name="line-937"></a><span>
</span><a name="line-938"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576904"><a href="#local-1627576904"><span class="hs-identifier">other_flags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">packageFlags</span><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-939"></a><span>      </span><a name="local-1627576905"><a href="#local-1627576905"><span class="hs-identifier">ignore_flags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ignorePackageFlags</span><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-940"></a><span>
</span><a name="line-941"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576906"><a href="#local-1627576906"><span class="hs-identifier">merge</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627576907"><a href="#local-1627576907"><span class="hs-identifier">pkg_map</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576908"><a href="#local-1627576908"><span class="hs-identifier">prev_unusable</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627576909"><a href="#local-1627576909"><span class="hs-identifier">db_path</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576910"><a href="#local-1627576910"><span class="hs-identifier">db</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-942"></a><span>            </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-943"></a><span>                </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;loading package database&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1627576909"><span class="hs-identifier hs-var">db_path</span></a><span>
</span><a name="line-944"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#toList"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><a href="#local-1627576911"><span class="hs-identifier hs-var">shadow_set</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627576927"><a href="#local-1627576927"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-945"></a><span>                </span><a href="ErrUtils.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-946"></a><span>                    </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;package&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627576927"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-947"></a><span>                    </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;shadows a previously defined package&quot;</span><span>
</span><a name="line-948"></a><span>            </span><a href="Packages.html#reportUnusable"><span class="hs-identifier hs-var">reportUnusable</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576920"><span class="hs-identifier hs-var">unusable</span></a><span>
</span><a name="line-949"></a><span>            </span><span class="hs-comment">-- NB: an unusable unit ID can become usable again</span><span>
</span><a name="line-950"></a><span>            </span><span class="hs-comment">-- if it's validly specified in a later package stack.</span><span>
</span><a name="line-951"></a><span>            </span><span class="hs-comment">-- Keep unusable up-to-date!</span><span>
</span><a name="line-952"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576921"><span class="hs-identifier hs-var">pkg_map'</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627576908"><span class="hs-identifier hs-var">prev_unusable</span></a><span> </span><span class="hs-special">`</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#difference"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">difference</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576921"><span class="hs-identifier hs-var">pkg_map'</span></a><span class="hs-special">)</span><span>
</span><a name="line-953"></a><span>                                    </span><span class="hs-special">`</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#union"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576920"><span class="hs-identifier hs-var">unusable</span></a><span class="hs-special">)</span><span>
</span><a name="line-954"></a><span>        </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">-- The set of UnitIds which appear in both</span><span>
</span><a name="line-955"></a><span>              </span><span class="hs-comment">-- db and pkgs (to be shadowed from pkgs)</span><span>
</span><a name="line-956"></a><span>              </span><span class="hs-identifier">shadow_set</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#Set"><span class="hs-identifier hs-type">Set</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-957"></a><span>              </span><a name="local-1627576911"><a href="#local-1627576911"><span class="hs-identifier">shadow_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><a href="#local-1627576922"><span class="hs-identifier hs-var">ins</span></a><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#empty"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span> </span><a href="#local-1627576910"><span class="hs-identifier hs-var">db</span></a><span>
</span><a name="line-958"></a><span>                </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576922"><a href="#local-1627576922"><span class="hs-identifier">ins</span></a></a><span> </span><a name="local-1627576923"><a href="#local-1627576923"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-1627576924"><a href="#local-1627576924"><span class="hs-identifier">s</span></a></a><span>
</span><a name="line-959"></a><span>                        </span><span class="hs-comment">-- If the package from the upper database is</span><span>
</span><a name="line-960"></a><span>                        </span><span class="hs-comment">-- in the lower database, and the ABIs don't</span><span>
</span><a name="line-961"></a><span>                        </span><span class="hs-comment">-- match...</span><span>
</span><a name="line-962"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627576925"><a href="#local-1627576925"><span class="hs-identifier">old_pkg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#lookup"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576923"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576907"><span class="hs-identifier hs-var">pkg_map</span></a><span>
</span><a name="line-963"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abiHash</span><span> </span><a href="#local-1627576925"><span class="hs-identifier hs-var">old_pkg</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier">abiHash</span><span> </span><a href="#local-1627576923"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-964"></a><span>                        </span><span class="hs-comment">-- ...add this unit ID to the set of unit IDs</span><span>
</span><a name="line-965"></a><span>                        </span><span class="hs-comment">-- which (transitively) should be shadowed from</span><span>
</span><a name="line-966"></a><span>                        </span><span class="hs-comment">-- the lower database.</span><span>
</span><a name="line-967"></a><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#insert"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576923"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576924"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-968"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-969"></a><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576924"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-970"></a><span>              </span><span class="hs-comment">-- Remove shadow_set from pkg_map...</span><span>
</span><a name="line-971"></a><span>              </span><span class="hs-identifier">shadowed_pkgs0</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-972"></a><span>              </span><a name="local-1627576912"><a href="#local-1627576912"><span class="hs-identifier">shadowed_pkgs0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#member"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">member</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576911"><span class="hs-identifier hs-var">shadow_set</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">unitId</span><span class="hs-special">)</span><span>
</span><a name="line-973"></a><span>                                      </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#elems"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span></a><span> </span><a href="#local-1627576907"><span class="hs-identifier hs-var">pkg_map</span></a><span class="hs-special">)</span><span>
</span><a name="line-974"></a><span>              </span><span class="hs-comment">-- ...and then remove anything transitively broken</span><span>
</span><a name="line-975"></a><span>              </span><span class="hs-comment">-- this way.</span><span>
</span><a name="line-976"></a><span>              </span><a name="local-1627576913"><a href="#local-1627576913"><span class="hs-identifier">shadowed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#findBroken"><span class="hs-identifier hs-var">findBroken</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-1627576912"><span class="hs-identifier hs-var">shadowed_pkgs0</span></a><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#empty"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-977"></a><span>              </span><span class="hs-identifier">shadowed_pkgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-978"></a><span>              </span><a name="local-1627576914"><a href="#local-1627576914"><span class="hs-identifier">shadowed_pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#member"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">member</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576913"><span class="hs-identifier hs-var">shadowed</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">unitId</span><span class="hs-special">)</span><span>
</span><a name="line-979"></a><span>                                     </span><a href="#local-1627576912"><span class="hs-identifier hs-var">shadowed_pkgs0</span></a><span>
</span><a name="line-980"></a><span>
</span><a name="line-981"></a><span>              </span><span class="hs-comment">-- Apply ignore flags to db (TODO: could extend command line</span><span>
</span><a name="line-982"></a><span>              </span><span class="hs-comment">-- flag format to support per-database ignore now!  More useful</span><span>
</span><a name="line-983"></a><span>              </span><span class="hs-comment">-- than what we have now.)</span><span>
</span><a name="line-984"></a><span>              </span><a name="local-1627576915"><a href="#local-1627576915"><span class="hs-identifier">ignored</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#ignorePackages"><span class="hs-identifier hs-var">ignorePackages</span></a><span> </span><a href="#local-1627576905"><span class="hs-identifier hs-var">ignore_flags</span></a><span> </span><a href="#local-1627576910"><span class="hs-identifier hs-var">db</span></a><span>
</span><a name="line-985"></a><span>              </span><a name="local-1627576916"><a href="#local-1627576916"><span class="hs-identifier">db2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#member"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">member</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576915"><span class="hs-identifier hs-var">ignored</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">unitId</span><span class="hs-special">)</span><span> </span><a href="#local-1627576910"><span class="hs-identifier hs-var">db</span></a><span>
</span><a name="line-986"></a><span>
</span><a name="line-987"></a><span>              </span><span class="hs-comment">-- Look for broken packages (either from ignore, or possibly</span><span>
</span><a name="line-988"></a><span>              </span><span class="hs-comment">-- because the db was broken to begin with)</span><span>
</span><a name="line-989"></a><span>              </span><a name="local-1627576917"><a href="#local-1627576917"><span class="hs-identifier">mk_pkg_map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#fromList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627576926"><a href="#local-1627576926"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576926"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576926"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-990"></a><span>              </span><a name="local-1627576918"><a href="#local-1627576918"><span class="hs-identifier">broken</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#findBroken"><span class="hs-identifier hs-var">findBroken</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1627576916"><span class="hs-identifier hs-var">db2</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576917"><span class="hs-identifier hs-var">mk_pkg_map</span></a><span> </span><a href="#local-1627576914"><span class="hs-identifier hs-var">shadowed_pkgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-991"></a><span>              </span><a name="local-1627576919"><a href="#local-1627576919"><span class="hs-identifier">db3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#member"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">member</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576918"><span class="hs-identifier hs-var">broken</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">unitId</span><span class="hs-special">)</span><span> </span><a href="#local-1627576916"><span class="hs-identifier hs-var">db2</span></a><span>
</span><a name="line-992"></a><span>
</span><a name="line-993"></a><span>              </span><a name="local-1627576920"><a href="#local-1627576920"><span class="hs-identifier">unusable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576913"><span class="hs-identifier hs-var">shadowed</span></a><span> </span><span class="hs-special">`</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#union"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576915"><span class="hs-identifier hs-var">ignored</span></a><span>
</span><a name="line-994"></a><span>                                  </span><span class="hs-special">`</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#union"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576918"><span class="hs-identifier hs-var">broken</span></a><span>
</span><a name="line-995"></a><span>
</span><a name="line-996"></a><span>              </span><span class="hs-comment">-- Now merge the sets together (NB: later overrides</span><span>
</span><a name="line-997"></a><span>              </span><span class="hs-comment">-- earlier!)</span><span>
</span><a name="line-998"></a><span>              </span><span class="hs-identifier">pkg_map'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-999"></a><span>              </span><a name="local-1627576921"><a href="#local-1627576921"><span class="hs-identifier">pkg_map'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576917"><span class="hs-identifier hs-var">mk_pkg_map</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576914"><span class="hs-identifier hs-var">shadowed_pkgs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576919"><span class="hs-identifier hs-var">db3</span></a><span class="hs-special">)</span><span>
</span><a name="line-1000"></a><span>
</span><a name="line-1001"></a><span>  </span><span class="hs-special">(</span><a name="local-1627576928"><a href="#local-1627576928"><span class="hs-identifier">pkg_map1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576929"><a href="#local-1627576929"><span class="hs-identifier">unusable</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span> </span><a href="#local-1627576906"><span class="hs-identifier hs-var">merge</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#empty"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#empty"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576900"><span class="hs-identifier hs-var">dbs</span></a><span>
</span><a name="line-1002"></a><span>  </span><span class="hs-comment">-- Apply trust flags (these flags apply regardless of whether</span><span>
</span><a name="line-1003"></a><span>  </span><span class="hs-comment">-- or not packages are visible or not)</span><span>
</span><a name="line-1004"></a><span>  </span><a name="local-1627576930"><a href="#local-1627576930"><span class="hs-identifier">pkgs1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#applyTrustFlag"><span class="hs-identifier hs-var">applyTrustFlag</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576929"><span class="hs-identifier hs-var">unusable</span></a><span class="hs-special">)</span><span>
</span><a name="line-1005"></a><span>                 </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#elems"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span></a><span> </span><a href="#local-1627576928"><span class="hs-identifier hs-var">pkg_map1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">trustFlags</span><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1006"></a><span>
</span><a name="line-1007"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1008"></a><span>  </span><span class="hs-comment">-- Calculate the initial set of packages, prior to any package flags.</span><span>
</span><a name="line-1009"></a><span>  </span><span class="hs-comment">-- This set contains the latest version of all valid (not unusable) packages,</span><span>
</span><a name="line-1010"></a><span>  </span><span class="hs-comment">-- or is empty if we have -hide-all-packages</span><span>
</span><a name="line-1011"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1012"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576931"><a href="#local-1627576931"><span class="hs-identifier">preferLater</span></a></a><span> </span><a name="local-1627576935"><a href="#local-1627576935"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-1627576936"><a href="#local-1627576936"><span class="hs-identifier">pkg'</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1013"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="Packages.html#comparing"><span class="hs-identifier hs-var">comparing</span></a><span> </span><span class="hs-identifier">packageVersion</span><span> </span><a href="#local-1627576935"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-1627576936"><span class="hs-identifier hs-var">pkg'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1014"></a><span>            </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576935"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-1015"></a><span>            </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576936"><span class="hs-identifier hs-var">pkg'</span></a><span>
</span><a name="line-1016"></a><span>      </span><a name="local-1627576932"><a href="#local-1627576932"><span class="hs-identifier">calcInitial</span></a></a><span> </span><a name="local-1627576937"><a href="#local-1627576937"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627576938"><a href="#local-1627576938"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#addToUFM_C"><span class="hs-identifier hs-var">addToUFM_C</span></a><span> </span><a href="#local-1627576931"><span class="hs-identifier hs-var">preferLater</span></a><span> </span><a href="#local-1627576937"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#fsPackageName"><span class="hs-identifier hs-var">fsPackageName</span></a><span> </span><a href="#local-1627576938"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576938"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-1017"></a><span>      </span><a name="local-1627576933"><a href="#local-1627576933"><span class="hs-identifier">initial</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_HideAllPackages"><span class="hs-identifier hs-var">Opt_HideAllPackages</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1018"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span>
</span><a name="line-1019"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a><span> </span><a href="#local-1627576932"><span class="hs-identifier hs-var">calcInitial</span></a><span> </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span> </span><a href="#local-1627576930"><span class="hs-identifier hs-var">pkgs1</span></a><span>
</span><a name="line-1020"></a><span>      </span><a name="local-1627576934"><a href="#local-1627576934"><span class="hs-identifier">vis_map1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#foldUFM"><span class="hs-identifier hs-var">foldUFM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627576939"><a href="#local-1627576939"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627576940"><a href="#local-1627576940"><span class="hs-identifier">vm</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1021"></a><span>                            </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">exposed</span><span> </span><a href="#local-1627576939"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1022"></a><span>                               </span><span class="hs-keyword">then</span><span> </span><a href="UniqFM.html#addToUFM"><span class="hs-identifier hs-var">addToUFM</span></a><span> </span><a href="#local-1627576940"><span class="hs-identifier hs-var">vm</span></a><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-1627576939"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1023"></a><span>                                             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Packages.html#fsPackageName"><span class="hs-identifier hs-var">fsPackageName</span></a><span> </span><a href="#local-1627576939"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1024"></a><span>                               </span><span class="hs-keyword">else</span><span> </span><a href="#local-1627576940"><span class="hs-identifier hs-var">vm</span></a><span class="hs-special">)</span><span>
</span><a name="line-1025"></a><span>                         </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span> </span><a href="#local-1627576933"><span class="hs-identifier hs-var">initial</span></a><span>
</span><a name="line-1026"></a><span>
</span><a name="line-1027"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1028"></a><span>  </span><span class="hs-comment">-- Compute a visibility map according to the command-line flags (-package,</span><span>
</span><a name="line-1029"></a><span>  </span><span class="hs-comment">-- -hide-package).  This needs to know about the unusable packages, since if a</span><span>
</span><a name="line-1030"></a><span>  </span><span class="hs-comment">-- user tries to enable an unusable package, we should let them know.</span><span>
</span><a name="line-1031"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1032"></a><span>  </span><a name="local-1627576941"><a href="#local-1627576941"><span class="hs-identifier">vis_map2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#applyPackageFlag"><span class="hs-identifier hs-var">applyPackageFlag</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576929"><span class="hs-identifier hs-var">unusable</span></a><span>
</span><a name="line-1033"></a><span>                        </span><span class="hs-special">(</span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_HideAllPackages"><span class="hs-identifier hs-var">Opt_HideAllPackages</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576930"><span class="hs-identifier hs-var">pkgs1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1034"></a><span>                            </span><a href="#local-1627576934"><span class="hs-identifier hs-var">vis_map1</span></a><span> </span><a href="#local-1627576904"><span class="hs-identifier hs-var">other_flags</span></a><span>
</span><a name="line-1035"></a><span>
</span><a name="line-1036"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1037"></a><span>  </span><span class="hs-comment">-- Sort out which packages are wired in. This has to be done last, since</span><span>
</span><a name="line-1038"></a><span>  </span><span class="hs-comment">-- it modifies the unit ids of wired in packages, but when we process</span><span>
</span><a name="line-1039"></a><span>  </span><span class="hs-comment">-- package arguments we need to key against the old versions.</span><span>
</span><a name="line-1040"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1041"></a><span>  </span><span class="hs-special">(</span><a name="local-1627576942"><a href="#local-1627576942"><span class="hs-identifier">pkgs2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576943"><a href="#local-1627576943"><span class="hs-identifier">wired_map</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Packages.html#findWiredInPackages"><span class="hs-identifier hs-var">findWiredInPackages</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576930"><span class="hs-identifier hs-var">pkgs1</span></a><span> </span><a href="#local-1627576941"><span class="hs-identifier hs-var">vis_map2</span></a><span>
</span><a name="line-1042"></a><span>
</span><a name="line-1043"></a><span>  </span><span class="hs-comment">-- Update the visibility map, so we treat wired packages as visible.</span><span>
</span><a name="line-1044"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576944"><a href="#local-1627576944"><span class="hs-identifier">vis_map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#updateVisibilityMap"><span class="hs-identifier hs-var">updateVisibilityMap</span></a><span> </span><a href="#local-1627576943"><span class="hs-identifier hs-var">wired_map</span></a><span> </span><a href="#local-1627576941"><span class="hs-identifier hs-var">vis_map2</span></a><span>
</span><a name="line-1045"></a><span>
</span><a name="line-1046"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576945"><a href="#local-1627576945"><span class="hs-identifier">hide_plugin_pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_HideAllPluginPackages"><span class="hs-identifier hs-var">Opt_HideAllPluginPackages</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1047"></a><span>  </span><a name="local-1627576948"><a href="#local-1627576948"><span class="hs-identifier">plugin_vis_map</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-1048"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">pluginPackageFlags</span><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1049"></a><span>        </span><span class="hs-comment">-- common case; try to share the old vis_map</span><span>
</span><a name="line-1050"></a><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1627576945"><span class="hs-identifier hs-var">hide_plugin_pkgs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627576944"><span class="hs-identifier hs-var">vis_map</span></a><span>
</span><a name="line-1051"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span>
</span><a name="line-1052"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576946"><a href="#local-1627576946"><span class="hs-identifier">plugin_vis_map1</span></a></a><span>
</span><a name="line-1053"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627576945"><span class="hs-identifier hs-var">hide_plugin_pkgs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span>
</span><a name="line-1054"></a><span>                        </span><span class="hs-comment">-- Use the vis_map PRIOR to wired in,</span><span>
</span><a name="line-1055"></a><span>                        </span><span class="hs-comment">-- because otherwise applyPackageFlag</span><span>
</span><a name="line-1056"></a><span>                        </span><span class="hs-comment">-- won't work.</span><span>
</span><a name="line-1057"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576941"><span class="hs-identifier hs-var">vis_map2</span></a><span>
</span><a name="line-1058"></a><span>                </span><a name="local-1627576947"><a href="#local-1627576947"><span class="hs-identifier">plugin_vis_map2</span></a></a><span>
</span><a name="line-1059"></a><span>                    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#applyPackageFlag"><span class="hs-identifier hs-var">applyPackageFlag</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576929"><span class="hs-identifier hs-var">unusable</span></a><span>
</span><a name="line-1060"></a><span>                                </span><span class="hs-special">(</span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_HideAllPluginPackages"><span class="hs-identifier hs-var">Opt_HideAllPluginPackages</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576930"><span class="hs-identifier hs-var">pkgs1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1061"></a><span>                             </span><a href="#local-1627576946"><span class="hs-identifier hs-var">plugin_vis_map1</span></a><span>
</span><a name="line-1062"></a><span>                             </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pluginPackageFlags</span><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1063"></a><span>                </span><span class="hs-comment">-- Updating based on wired in packages is mostly</span><span>
</span><a name="line-1064"></a><span>                </span><span class="hs-comment">-- good hygiene, because it won't matter: no wired in</span><span>
</span><a name="line-1065"></a><span>                </span><span class="hs-comment">-- package has a compiler plugin.</span><span>
</span><a name="line-1066"></a><span>                </span><span class="hs-comment">-- TODO: If a wired in package had a compiler plugin,</span><span>
</span><a name="line-1067"></a><span>                </span><span class="hs-comment">-- and you tried to pick different wired in packages</span><span>
</span><a name="line-1068"></a><span>                </span><span class="hs-comment">-- with the plugin flags and the normal flags... what</span><span>
</span><a name="line-1069"></a><span>                </span><span class="hs-comment">-- would happen?  I don't know!  But this doesn't seem</span><span>
</span><a name="line-1070"></a><span>                </span><span class="hs-comment">-- likely to actually happen.</span><span>
</span><a name="line-1071"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#updateVisibilityMap"><span class="hs-identifier hs-var">updateVisibilityMap</span></a><span> </span><a href="#local-1627576943"><span class="hs-identifier hs-var">wired_map</span></a><span> </span><a href="#local-1627576947"><span class="hs-identifier hs-var">plugin_vis_map2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1072"></a><span>
</span><a name="line-1073"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1074"></a><span>  </span><span class="hs-comment">-- Here we build up a set of the packages mentioned in -package</span><span>
</span><a name="line-1075"></a><span>  </span><span class="hs-comment">-- flags on the command line; these are called the &quot;preload&quot;</span><span>
</span><a name="line-1076"></a><span>  </span><span class="hs-comment">-- packages.  we link these packages in eagerly.  The preload set</span><span>
</span><a name="line-1077"></a><span>  </span><span class="hs-comment">-- should contain at least rts &amp; base, which is why we pretend that</span><span>
</span><a name="line-1078"></a><span>  </span><span class="hs-comment">-- the command line contains -package rts &amp; -package base.</span><span>
</span><a name="line-1079"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1080"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576949"><a href="#local-1627576949"><span class="hs-identifier">preload1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576953"><a href="#local-1627576953"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627576952"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1081"></a><span>                   </span><span class="hs-keyword">in</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a><span> </span><a href="#local-1627576953"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#lookup"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span></a><span> </span><a href="#local-1627576953"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="#local-1627576943"><span class="hs-identifier hs-var">wired_map</span></a><span class="hs-special">)</span><span>
</span><a name="line-1082"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a name="local-1627576951"><a href="#local-1627576951"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576904"><span class="hs-identifier hs-var">other_flags</span></a><span class="hs-special">,</span><span> </span><a name="local-1627576952"><a href="#local-1627576952"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576950"><span class="hs-identifier hs-var">get_exposed</span></a><span> </span><a href="#local-1627576951"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1083"></a><span>
</span><a name="line-1084"></a><span>      </span><a name="local-1627576950"><a href="#local-1627576950"><span class="hs-identifier">get_exposed</span></a></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#ExposePackage"><span class="hs-identifier hs-var">ExposePackage</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627576954"><a href="#local-1627576954"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Packages.html#sortByVersion"><span class="hs-identifier hs-var">sortByVersion</span></a><span>
</span><a name="line-1085"></a><span>                                      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#matching"><span class="hs-identifier hs-var">matching</span></a><span> </span><a href="#local-1627576954"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1086"></a><span>                                      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1627576930"><span class="hs-identifier hs-var">pkgs1</span></a><span>
</span><a name="line-1087"></a><span>      </span><span class="hs-identifier">get_exposed</span><span> </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1088"></a><span>
</span><a name="line-1089"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576955"><a href="#local-1627576955"><span class="hs-identifier">pkg_db</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#extendPackageConfigMap"><span class="hs-identifier hs-var">extendPackageConfigMap</span></a><span> </span><a href="Packages.html#emptyPackageConfigMap"><span class="hs-identifier hs-var">emptyPackageConfigMap</span></a><span> </span><a href="#local-1627576942"><span class="hs-identifier hs-var">pkgs2</span></a><span>
</span><a name="line-1090"></a><span>
</span><a name="line-1091"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576956"><a href="#local-1627576956"><span class="hs-identifier">preload2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576949"><span class="hs-identifier hs-var">preload1</span></a><span>
</span><a name="line-1092"></a><span>
</span><a name="line-1093"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-1094"></a><span>      </span><span class="hs-comment">-- add base &amp; rts to the preload packages</span><span>
</span><a name="line-1095"></a><span>      </span><a name="local-1627576957"><a href="#local-1627576957"><span class="hs-identifier">basicLinkedPackages</span></a></a><span>
</span><a name="line-1096"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_AutoLinkPackages"><span class="hs-identifier hs-var">Opt_AutoLinkPackages</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1097"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a><span> </span><a href="UniqFM.html#elemUFM"><span class="hs-identifier hs-var">elemUFM</span></a><span> </span><a href="#local-1627576955"><span class="hs-identifier hs-var">pkg_db</span></a><span class="hs-special">)</span><span>
</span><a name="line-1098"></a><span>                </span><span class="hs-special">[</span><a href="Module.html#baseUnitId"><span class="hs-identifier hs-var">baseUnitId</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a><span class="hs-special">]</span><span>
</span><a name="line-1099"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1100"></a><span>      </span><span class="hs-comment">-- but in any case remove the current package from the set of</span><span>
</span><a name="line-1101"></a><span>      </span><span class="hs-comment">-- preloaded packages so that base/rts does not end up in the</span><span>
</span><a name="line-1102"></a><span>      </span><span class="hs-comment">-- set up preloaded package when we are just building it</span><span>
</span><a name="line-1103"></a><span>      </span><a name="local-1627576958"><a href="#local-1627576958"><span class="hs-identifier">preload3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#nub"><span class="hs-identifier hs-var">nub</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1627576903"><span class="hs-identifier hs-var">this_package</span></a><span class="hs-special">)</span><span>
</span><a name="line-1104"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576957"><span class="hs-identifier hs-var">basicLinkedPackages</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576956"><span class="hs-identifier hs-var">preload2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1105"></a><span>
</span><a name="line-1106"></a><span>  </span><span class="hs-comment">-- Close the preload packages with their dependencies</span><span>
</span><a name="line-1107"></a><span>  </span><a name="local-1627576959"><a href="#local-1627576959"><span class="hs-identifier">dep_preload</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Packages.html#closeDeps"><span class="hs-identifier hs-var">closeDeps</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576955"><span class="hs-identifier hs-var">pkg_db</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><a href="#local-1627576958"><span class="hs-identifier hs-var">preload3</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1108"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576960"><a href="#local-1627576960"><span class="hs-identifier">new_dep_preload</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#notElem"><span class="hs-identifier hs-var">notElem</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627576901"><span class="hs-identifier hs-var">preload0</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576959"><span class="hs-identifier hs-var">dep_preload</span></a><span>
</span><a name="line-1109"></a><span>
</span><a name="line-1110"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627576961"><a href="#local-1627576961"><span class="hs-identifier">pstate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#PackageState"><span class="hs-identifier hs-var">PackageState</span></a><span class="hs-special">{</span><span>
</span><a name="line-1111"></a><span>    </span><span class="hs-identifier">preloadPackages</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576959"><span class="hs-identifier hs-var">dep_preload</span></a><span class="hs-special">,</span><span>
</span><a name="line-1112"></a><span>    </span><span class="hs-identifier">explicitPackages</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#foldUFM"><span class="hs-identifier hs-var">foldUFM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627576962"><a href="#local-1627576962"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-1627576963"><a href="#local-1627576963"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1113"></a><span>                            </span><span class="hs-keyword">if</span><span> </span><a href="UniqFM.html#elemUFM"><span class="hs-identifier hs-var">elemUFM</span></a><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-1627576962"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576944"><span class="hs-identifier hs-var">vis_map</span></a><span>
</span><a name="line-1114"></a><span>                                </span><span class="hs-keyword">then</span><span> </span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-1627576962"><span class="hs-identifier hs-var">pkg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1627576963"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-1115"></a><span>                                </span><span class="hs-keyword">else</span><span> </span><a href="#local-1627576963"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1627576955"><span class="hs-identifier hs-var">pkg_db</span></a><span class="hs-special">,</span><span>
</span><a name="line-1116"></a><span>    </span><span class="hs-identifier">pkgIdMap</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576955"><span class="hs-identifier hs-var">pkg_db</span></a><span class="hs-special">,</span><span>
</span><a name="line-1117"></a><span>    </span><span class="hs-identifier">moduleToPkgConfAll</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#mkModuleToPkgConfAll"><span class="hs-identifier hs-var">mkModuleToPkgConfAll</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576955"><span class="hs-identifier hs-var">pkg_db</span></a><span> </span><a href="#local-1627576944"><span class="hs-identifier hs-var">vis_map</span></a><span class="hs-special">,</span><span>
</span><a name="line-1118"></a><span>    </span><span class="hs-identifier">pluginModuleToPkgConfAll</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#mkModuleToPkgConfAll"><span class="hs-identifier hs-var">mkModuleToPkgConfAll</span></a><span> </span><a href="#local-1627576902"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627576955"><span class="hs-identifier hs-var">pkg_db</span></a><span> </span><a href="#local-1627576948"><span class="hs-identifier hs-var">plugin_vis_map</span></a><span>
</span><a name="line-1119"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1120"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576961"><span class="hs-identifier hs-var">pstate</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576960"><span class="hs-identifier hs-var">new_dep_preload</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576903"><span class="hs-identifier hs-var">this_package</span></a><span class="hs-special">)</span><span>
</span><a name="line-1121"></a><span>
</span><a name="line-1122"></a><span>
</span><a name="line-1123"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1124"></a><span class="hs-comment">-- | Makes the mapping from module to package info</span><span>
</span><a name="line-1125"></a><span>
</span><a name="line-1126"></a><span class="hs-identifier">mkModuleToPkgConfAll</span><span>
</span><a name="line-1127"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-1128"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span>
</span><a name="line-1129"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a><span>
</span><a name="line-1130"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#ModuleToPkgConfAll"><span class="hs-identifier hs-type">ModuleToPkgConfAll</span></a><span>
</span><a name="line-1131"></a><a name="mkModuleToPkgConfAll"><a href="Packages.html#mkModuleToPkgConfAll"><span class="hs-identifier">mkModuleToPkgConfAll</span></a></a><span> </span><a name="local-1627576964"><a href="#local-1627576964"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627576965"><a href="#local-1627576965"><span class="hs-identifier">pkg_db</span></a></a><span> </span><a name="local-1627576966"><a href="#local-1627576966"><span class="hs-identifier">vis_map</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1132"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a><span> </span><a href="#local-1627576972"><span class="hs-identifier hs-var">extend_modmap</span></a><span> </span><a href="#local-1627576967"><span class="hs-identifier hs-var">emptyMap</span></a><span> </span><span class="hs-special">(</span><a href="UniqFM.html#eltsUFM"><span class="hs-identifier hs-var">eltsUFM</span></a><span> </span><a href="#local-1627576965"><span class="hs-identifier hs-var">pkg_db</span></a><span class="hs-special">)</span><span>
</span><a name="line-1133"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1134"></a><span>  </span><a name="local-1627576967"><a href="#local-1627576967"><span class="hs-identifier">emptyMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#empty"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1135"></a><span>  </span><a name="local-1627576968"><a href="#local-1627576968"><span class="hs-identifier">sing</span></a></a><span> </span><a name="local-1627576973"><a href="#local-1627576973"><span class="hs-identifier">pk</span></a></a><span> </span><a name="local-1627576974"><a href="#local-1627576974"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#singleton"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span> </span><a href="#local-1627576973"><span class="hs-identifier hs-var">pk</span></a><span> </span><a href="#local-1627576974"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-1136"></a><span>  </span><a name="local-1627576969"><a href="#local-1627576969"><span class="hs-identifier">addListTo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a><span> </span><a href="#local-1627576970"><span class="hs-identifier hs-var">merge</span></a><span>
</span><a name="line-1137"></a><span>  </span><a name="local-1627576970"><a href="#local-1627576970"><span class="hs-identifier">merge</span></a></a><span> </span><a name="local-1627576975"><a href="#local-1627576975"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627576976"><a href="#local-1627576976"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576977"><a href="#local-1627576977"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#insertWith"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insertWith</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#unionWith"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unionWith</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mappend"><span class="hs-identifier hs-var">mappend</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576976"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1627576977"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-1627576975"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-1138"></a><span>  </span><a name="local-1627576971"><a href="#local-1627576971"><span class="hs-identifier">setOrigins</span></a></a><span> </span><a name="local-1627576978"><a href="#local-1627576978"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627576979"><a href="#local-1627576979"><span class="hs-identifier">os</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="#local-1627576979"><span class="hs-identifier hs-var">os</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627576978"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-1139"></a><span>  </span><a name="local-1627576972"><a href="#local-1627576972"><span class="hs-identifier">extend_modmap</span></a></a><span> </span><a name="local-1627576980"><a href="#local-1627576980"><span class="hs-identifier">modmap</span></a></a><span> </span><a name="local-1627576981"><a href="#local-1627576981"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576969"><span class="hs-identifier hs-var">addListTo</span></a><span> </span><a href="#local-1627576980"><span class="hs-identifier hs-var">modmap</span></a><span> </span><a href="#local-1627576982"><span class="hs-identifier hs-var">theBindings</span></a><span>
</span><a name="line-1140"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-1141"></a><span>    </span><span class="hs-identifier">theBindings</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1142"></a><span>    </span><a name="local-1627576982"><a href="#local-1627576982"><span class="hs-identifier">theBindings</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627576992"><a href="#local-1627576992"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><a name="local-1627576993"><a href="#local-1627576993"><span class="hs-identifier">rns</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span> </span><a href="#local-1627576966"><span class="hs-identifier hs-var">vis_map</span></a><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-1627576981"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1143"></a><span>                              </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576983"><span class="hs-identifier hs-var">newBindings</span></a><span> </span><a href="#local-1627576992"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-1627576993"><span class="hs-identifier hs-var">rns</span></a><span>
</span><a name="line-1144"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576983"><span class="hs-identifier hs-var">newBindings</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1145"></a><span>
</span><a name="line-1146"></a><span>    </span><span class="hs-identifier">newBindings</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1147"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1148"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1149"></a><span>    </span><a name="local-1627576983"><a href="#local-1627576983"><span class="hs-identifier">newBindings</span></a></a><span> </span><a name="local-1627576994"><a href="#local-1627576994"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-1627576995"><a href="#local-1627576995"><span class="hs-identifier">rns</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576985"><span class="hs-identifier hs-var">es</span></a><span> </span><a href="#local-1627576994"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627576987"><span class="hs-identifier hs-var">hiddens</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627576984"><span class="hs-identifier hs-var">rnBinding</span></a><span> </span><a href="#local-1627576995"><span class="hs-identifier hs-var">rns</span></a><span>
</span><a name="line-1150"></a><span>
</span><a name="line-1151"></a><span>    </span><span class="hs-identifier">rnBinding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">)</span><span>
</span><a name="line-1152"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span class="hs-special">)</span><span>
</span><a name="line-1153"></a><span>    </span><a name="local-1627576984"><a href="#local-1627576984"><span class="hs-identifier">rnBinding</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627576996"><a href="#local-1627576996"><span class="hs-identifier">orig</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627576997"><a href="#local-1627576997"><span class="hs-identifier">new</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627576997"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576971"><span class="hs-identifier hs-var">setOrigins</span></a><span> </span><a href="#local-1627576998"><span class="hs-identifier hs-var">origEntry</span></a><span> </span><a href="Packages.html#fromFlag"><span class="hs-identifier hs-var">fromFlag</span></a><span class="hs-special">)</span><span>
</span><a name="line-1154"></a><span>     </span><span class="hs-keyword">where</span><span> </span><a name="local-1627576998"><a href="#local-1627576998"><span class="hs-identifier">origEntry</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span> </span><a href="#local-1627576986"><span class="hs-identifier hs-var">esmap</span></a><span> </span><a href="#local-1627576996"><span class="hs-identifier hs-var">orig</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1155"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627576999"><a href="#local-1627576999"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627576999"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1156"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#throwGhcException"><span class="hs-identifier hs-var">throwGhcException</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a><span> </span><a href="#local-1627576964"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1157"></a><span>                        </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;package flag: could not find module name&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1158"></a><span>                            </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627576996"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in package&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627576988"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1159"></a><span>
</span><a name="line-1160"></a><span>    </span><span class="hs-identifier">es</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1161"></a><span>    </span><a name="local-1627576985"><a href="#local-1627576985"><span class="hs-identifier">es</span></a></a><span> </span><a name="local-1627577000"><a href="#local-1627577000"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1162"></a><span>     </span><span class="hs-special">(</span><a name="local-1627577001"><a href="#local-1627577001"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627577002"><a href="#local-1627577002"><span class="hs-identifier">exposedReexport</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576990"><span class="hs-identifier hs-var">exposed_mods</span></a><span>
</span><a name="line-1163"></a><span>     </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627577003"><a href="#local-1627577003"><span class="hs-identifier">pk'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627577004"><a href="#local-1627577004"><span class="hs-identifier">m'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627577005"><a href="#local-1627577005"><span class="hs-identifier">pkg'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627577006"><a href="#local-1627577006"><span class="hs-identifier">origin'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1164"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627577002"><span class="hs-identifier hs-var">exposedReexport</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1165"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627576988"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627577001"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576981"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#fromExposedModules"><span class="hs-identifier hs-var">fromExposedModules</span></a><span> </span><a href="#local-1627577000"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1166"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><a name="local-1627577007"><a href="#local-1627577007"><span class="hs-identifier">pk'</span></a></a><span> </span><a name="local-1627577008"><a href="#local-1627577008"><span class="hs-identifier">m'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1167"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-1627577009"><a href="#local-1627577009"><span class="hs-identifier">pkg'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627576989"><span class="hs-identifier hs-var">pkg_lookup</span></a><span> </span><a href="#local-1627577007"><span class="hs-identifier hs-var">pk'</span></a><span>
</span><a name="line-1168"></a><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-1627577007"><span class="hs-identifier hs-var">pk'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627577008"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627577009"><span class="hs-identifier hs-var">pkg'</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#fromReexportedModules"><span class="hs-identifier hs-var">fromReexportedModules</span></a><span> </span><a href="#local-1627577000"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-1627577009"><span class="hs-identifier hs-var">pkg'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1169"></a><span>     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577001"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576968"><span class="hs-identifier hs-var">sing</span></a><span> </span><a href="#local-1627577003"><span class="hs-identifier hs-var">pk'</span></a><span> </span><a href="#local-1627577004"><span class="hs-identifier hs-var">m'</span></a><span> </span><a href="#local-1627577005"><span class="hs-identifier hs-var">pkg'</span></a><span> </span><a href="#local-1627577006"><span class="hs-identifier hs-var">origin'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1170"></a><span>
</span><a name="line-1171"></a><span>    </span><span class="hs-identifier">esmap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#Map"><span class="hs-identifier hs-type">Map</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span class="hs-special">)</span><span>
</span><a name="line-1172"></a><span>    </span><a name="local-1627576986"><a href="#local-1627576986"><span class="hs-identifier">esmap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#listToUFM"><span class="hs-identifier hs-var">listToUFM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627576985"><span class="hs-identifier hs-var">es</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- parameter here doesn't matter, orig will</span><span>
</span><a name="line-1173"></a><span>                                 </span><span class="hs-comment">-- be overwritten</span><span>
</span><a name="line-1174"></a><span>
</span><a name="line-1175"></a><span>    </span><a name="local-1627576987"><a href="#local-1627576987"><span class="hs-identifier">hiddens</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1627577010"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627576968"><span class="hs-identifier hs-var">sing</span></a><span> </span><a href="#local-1627576988"><span class="hs-identifier hs-var">pk</span></a><span> </span><a href="#local-1627577010"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1627576981"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="Packages.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1627577010"><a href="#local-1627577010"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627576991"><span class="hs-identifier hs-var">hidden_mods</span></a><span class="hs-special">]</span><span>
</span><a name="line-1176"></a><span>
</span><a name="line-1177"></a><span>    </span><a name="local-1627576988"><a href="#local-1627576988"><span class="hs-identifier">pk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-1627576981"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-1178"></a><span>    </span><a name="local-1627576989"><a href="#local-1627576989"><span class="hs-identifier">pkg_lookup</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-string">&quot;mkModuleToPkgConf&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Packages.html#lookupPackage%27"><span class="hs-identifier hs-var">lookupPackage'</span></a><span> </span><a href="#local-1627576965"><span class="hs-identifier hs-var">pkg_db</span></a><span>
</span><a name="line-1179"></a><span>
</span><a name="line-1180"></a><span>    </span><a name="local-1627576990"><a href="#local-1627576990"><span class="hs-identifier">exposed_mods</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">exposedModules</span><span> </span><a href="#local-1627576981"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-1181"></a><span>    </span><a name="local-1627576991"><a href="#local-1627576991"><span class="hs-identifier">hidden_mods</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hiddenModules</span><span> </span><a href="#local-1627576981"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-1182"></a><span>
</span><a name="line-1183"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1184"></a><span class="hs-comment">-- Extracting information from the packages in scope</span><span>
</span><a name="line-1185"></a><span>
</span><a name="line-1186"></a><span class="hs-comment">-- Many of these functions take a list of packages: in those cases,</span><span>
</span><a name="line-1187"></a><span class="hs-comment">-- the list is expected to contain the &quot;dependent packages&quot;,</span><span>
</span><a name="line-1188"></a><span class="hs-comment">-- i.e. those packages that were found to be depended on by the</span><span>
</span><a name="line-1189"></a><span class="hs-comment">-- current module/program.  These can be auto or non-auto packages, it</span><span>
</span><a name="line-1190"></a><span class="hs-comment">-- doesn't really matter.  The list is always combined with the list</span><span>
</span><a name="line-1191"></a><span class="hs-comment">-- of preload (command-line) packages to determine which packages to</span><span>
</span><a name="line-1192"></a><span class="hs-comment">-- use.</span><span>
</span><a name="line-1193"></a><span>
</span><a name="line-1194"></a><span class="hs-comment">-- | Find all the include directories in these and the preload packages</span><span>
</span><a name="line-1195"></a><span class="hs-identifier">getPackageIncludePath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-1196"></a><a name="getPackageIncludePath"><a href="Packages.html#getPackageIncludePath"><span class="hs-identifier">getPackageIncludePath</span></a></a><span> </span><a name="local-1627577011"><a href="#local-1627577011"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577012"><a href="#local-1627577012"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1197"></a><span>  </span><a href="Packages.html#collectIncludeDirs"><span class="hs-identifier hs-var">collectIncludeDirs</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span class="hs-special">`</span><span> </span><a href="Packages.html#getPreloadPackagesAnd"><span class="hs-identifier hs-var">getPreloadPackagesAnd</span></a><span> </span><a href="#local-1627577011"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627577012"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-1198"></a><span>
</span><a name="line-1199"></a><span class="hs-identifier">collectIncludeDirs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">]</span><span>
</span><a name="line-1200"></a><a name="collectIncludeDirs"><a href="Packages.html#collectIncludeDirs"><span class="hs-identifier">collectIncludeDirs</span></a></a><span> </span><a name="local-1627577013"><a href="#local-1627577013"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#nub"><span class="hs-identifier hs-var">nub</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-identifier">includeDirs</span><span> </span><a href="#local-1627577013"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1201"></a><span>
</span><a name="line-1202"></a><span class="hs-comment">-- | Find all the library paths in these and the preload packages</span><span>
</span><a name="line-1203"></a><span class="hs-identifier">getPackageLibraryPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-1204"></a><a name="getPackageLibraryPath"><a href="Packages.html#getPackageLibraryPath"><span class="hs-identifier">getPackageLibraryPath</span></a></a><span> </span><a name="local-1627577014"><a href="#local-1627577014"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577015"><a href="#local-1627577015"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1205"></a><span>  </span><a href="Packages.html#collectLibraryPaths"><span class="hs-identifier hs-var">collectLibraryPaths</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span class="hs-special">`</span><span> </span><a href="Packages.html#getPreloadPackagesAnd"><span class="hs-identifier hs-var">getPreloadPackagesAnd</span></a><span> </span><a href="#local-1627577014"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627577015"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-1206"></a><span>
</span><a name="line-1207"></a><span class="hs-identifier">collectLibraryPaths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">]</span><span>
</span><a name="line-1208"></a><a name="collectLibraryPaths"><a href="Packages.html#collectLibraryPaths"><span class="hs-identifier">collectLibraryPaths</span></a></a><span> </span><a name="local-1627577016"><a href="#local-1627577016"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#nub"><span class="hs-identifier hs-var">nub</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-identifier">libraryDirs</span><span> </span><a href="#local-1627577016"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1209"></a><span>
</span><a name="line-1210"></a><span class="hs-comment">-- | Find all the link options in these and the preload packages,</span><span>
</span><a name="line-1211"></a><span class="hs-comment">-- returning (package hs lib options, extra library options, other flags)</span><span>
</span><a name="line-1212"></a><span class="hs-identifier">getPackageLinkOpts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1213"></a><a name="getPackageLinkOpts"><a href="Packages.html#getPackageLinkOpts"><span class="hs-identifier">getPackageLinkOpts</span></a></a><span> </span><a name="local-1627577017"><a href="#local-1627577017"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577018"><a href="#local-1627577018"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1214"></a><span>  </span><a href="Packages.html#collectLinkOpts"><span class="hs-identifier hs-var">collectLinkOpts</span></a><span> </span><a href="#local-1627577017"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span class="hs-special">`</span><span> </span><a href="Packages.html#getPreloadPackagesAnd"><span class="hs-identifier hs-var">getPreloadPackagesAnd</span></a><span> </span><a href="#local-1627577017"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627577018"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-1215"></a><span>
</span><a name="line-1216"></a><span class="hs-identifier">collectLinkOpts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><a name="collectLinkOpts"><a href="Packages.html#collectLinkOpts"><span class="hs-identifier">collectLinkOpts</span></a></a><span> </span><a name="local-1627577019"><a href="#local-1627577019"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577020"><a href="#local-1627577020"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1218"></a><span>    </span><span class="hs-special">(</span><span>
</span><a name="line-1219"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;-l&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Packages.html#packageHsLibs"><span class="hs-identifier hs-var">packageHsLibs</span></a><span> </span><a href="#local-1627577019"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627577020"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span>
</span><a name="line-1220"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;-l&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">extraLibraries</span><span class="hs-special">)</span><span> </span><a href="#local-1627577020"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span>
</span><a name="line-1221"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-identifier">ldOptions</span><span> </span><a href="#local-1627577020"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-1222"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-1223"></a><span>
</span><a name="line-1224"></a><span class="hs-identifier">packageHsLibs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-1225"></a><a name="packageHsLibs"><a href="Packages.html#packageHsLibs"><span class="hs-identifier">packageHsLibs</span></a></a><span> </span><a name="local-1627577021"><a href="#local-1627577021"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577022"><a href="#local-1627577022"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577028"><span class="hs-identifier hs-var">mkDynName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1627577029"><span class="hs-identifier hs-var">addSuffix</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsLibraries</span><span> </span><a href="#local-1627577022"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1226"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1227"></a><span>        </span><a name="local-1627577023"><a href="#local-1627577023"><span class="hs-identifier">ways0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ways</span><span> </span><a href="#local-1627577021"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1228"></a><span>
</span><a name="line-1229"></a><span>        </span><a name="local-1627577024"><a href="#local-1627577024"><span class="hs-identifier">ways1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="DynFlags.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627577023"><span class="hs-identifier hs-var">ways0</span></a><span>
</span><a name="line-1230"></a><span>        </span><span class="hs-comment">-- the name of a shared library is libHSfoo-ghc&lt;version&gt;.so</span><span>
</span><a name="line-1231"></a><span>        </span><span class="hs-comment">-- we leave out the _dyn, because it is superfluous</span><span>
</span><a name="line-1232"></a><span>
</span><a name="line-1233"></a><span>        </span><span class="hs-comment">-- debug RTS includes support for -eventlog</span><span>
</span><a name="line-1234"></a><span>        </span><a name="local-1627577025"><a href="#local-1627577025"><span class="hs-identifier">ways2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#WayDebug"><span class="hs-identifier hs-var">WayDebug</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627577024"><span class="hs-identifier hs-var">ways1</span></a><span>
</span><a name="line-1235"></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="DynFlags.html#WayEventLog"><span class="hs-identifier hs-var">WayEventLog</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627577024"><span class="hs-identifier hs-var">ways1</span></a><span>
</span><a name="line-1236"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1237"></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577024"><span class="hs-identifier hs-var">ways1</span></a><span>
</span><a name="line-1238"></a><span>
</span><a name="line-1239"></a><span>        </span><a name="local-1627577026"><a href="#local-1627577026"><span class="hs-identifier">tag</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#mkBuildTag"><span class="hs-identifier hs-var">mkBuildTag</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="DynFlags.html#wayRTSOnly"><span class="hs-identifier hs-var">wayRTSOnly</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627577025"><span class="hs-identifier hs-var">ways2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1240"></a><span>        </span><a name="local-1627577027"><a href="#local-1627577027"><span class="hs-identifier">rts_tag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#mkBuildTag"><span class="hs-identifier hs-var">mkBuildTag</span></a><span> </span><a href="#local-1627577025"><span class="hs-identifier hs-var">ways2</span></a><span>
</span><a name="line-1241"></a><span>
</span><a name="line-1242"></a><span>        </span><a name="local-1627577028"><a href="#local-1627577028"><span class="hs-identifier">mkDynName</span></a></a><span> </span><a name="local-1627577031"><a href="#local-1627577031"><span class="hs-identifier">x</span></a></a><span>
</span><a name="line-1243"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#notElem"><span class="hs-identifier hs-var">notElem</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">ways</span><span> </span><a href="#local-1627577021"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577031"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1244"></a><span>         </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;HS&quot;</span><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627577031"><span class="hs-identifier hs-var">x</span></a><span>          </span><span class="hs-glyph">=</span><span>
</span><a name="line-1245"></a><span>              </span><a href="#local-1627577031"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-char">'-'</span><span class="hs-glyph">:</span><a href="DynFlags.html#programName"><span class="hs-identifier hs-var">programName</span></a><span> </span><a href="#local-1627577021"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="DynFlags.html#projectVersion"><span class="hs-identifier hs-var">projectVersion</span></a><span> </span><a href="#local-1627577021"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1246"></a><span>           </span><span class="hs-comment">-- For non-Haskell libraries, we use the name &quot;Cfoo&quot;. The .a</span><span>
</span><a name="line-1247"></a><span>           </span><span class="hs-comment">-- file is libCfoo.a, and the .so is libfoo.so. That way the</span><span>
</span><a name="line-1248"></a><span>           </span><span class="hs-comment">-- linker knows what we mean for the vanilla (-lCfoo) and dyn</span><span>
</span><a name="line-1249"></a><span>           </span><span class="hs-comment">-- (-lfoo) ways. We therefore need to strip the 'C' off here.</span><span>
</span><a name="line-1250"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577032"><a href="#local-1627577032"><span class="hs-identifier">x'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#stripPrefix"><span class="hs-identifier hs-var">stripPrefix</span></a><span> </span><span class="hs-string">&quot;C&quot;</span><span> </span><a href="#local-1627577031"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577032"><span class="hs-identifier hs-var">x'</span></a><span>
</span><a name="line-1251"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1252"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Don't understand library name &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627577031"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1253"></a><span>
</span><a name="line-1254"></a><span>        </span><a name="local-1627577029"><a href="#local-1627577029"><span class="hs-identifier">addSuffix</span></a></a><span> </span><a name="local-1627577033"><a href="#local-1627577033"><span class="hs-identifier">rts</span></a></a><span class="hs-glyph">@</span><span class="hs-string">&quot;HSrts&quot;</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577033"><span class="hs-identifier hs-var">rts</span></a><span>       </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577030"><span class="hs-identifier hs-var">expandTag</span></a><span> </span><a href="#local-1627577027"><span class="hs-identifier hs-var">rts_tag</span></a><span class="hs-special">)</span><span>
</span><a name="line-1255"></a><span>        </span><span class="hs-identifier">addSuffix</span><span> </span><a name="local-1627577034"><a href="#local-1627577034"><span class="hs-identifier">other_lib</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577034"><span class="hs-identifier hs-var">other_lib</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577030"><span class="hs-identifier hs-var">expandTag</span></a><span> </span><a href="#local-1627577026"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">)</span><span>
</span><a name="line-1256"></a><span>
</span><a name="line-1257"></a><span>        </span><a name="local-1627577030"><a href="#local-1627577030"><span class="hs-identifier">expandTag</span></a></a><span> </span><a name="local-1627577035"><a href="#local-1627577035"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627577035"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-1258"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-char">'_'</span><span class="hs-glyph">:</span><a href="#local-1627577035"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1259"></a><span>
</span><a name="line-1260"></a><span class="hs-comment">-- | Find all the C-compiler options in these and the preload packages</span><span>
</span><a name="line-1261"></a><span class="hs-identifier">getPackageExtraCcOpts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-1262"></a><a name="getPackageExtraCcOpts"><a href="Packages.html#getPackageExtraCcOpts"><span class="hs-identifier">getPackageExtraCcOpts</span></a></a><span> </span><a name="local-1627577036"><a href="#local-1627577036"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577037"><a href="#local-1627577037"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1263"></a><span>  </span><a name="local-1627577038"><a href="#local-1627577038"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Packages.html#getPreloadPackagesAnd"><span class="hs-identifier hs-var">getPreloadPackagesAnd</span></a><span> </span><a href="#local-1627577036"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627577037"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-1264"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-identifier">ccOptions</span><span> </span><a href="#local-1627577038"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1265"></a><span>
</span><a name="line-1266"></a><span class="hs-comment">-- | Find all the package framework paths in these and the preload packages</span><span>
</span><a name="line-1267"></a><span class="hs-identifier">getPackageFrameworkPath</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-1268"></a><a name="getPackageFrameworkPath"><a href="Packages.html#getPackageFrameworkPath"><span class="hs-identifier">getPackageFrameworkPath</span></a></a><span> </span><a name="local-1627577039"><a href="#local-1627577039"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577040"><a href="#local-1627577040"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1269"></a><span>  </span><a name="local-1627577041"><a href="#local-1627577041"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Packages.html#getPreloadPackagesAnd"><span class="hs-identifier hs-var">getPreloadPackagesAnd</span></a><span> </span><a href="#local-1627577039"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627577040"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-1270"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#nub"><span class="hs-identifier hs-var">nub</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-identifier">frameworkDirs</span><span> </span><a href="#local-1627577041"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1271"></a><span>
</span><a name="line-1272"></a><span class="hs-comment">-- | Find all the package frameworks in these and the preload packages</span><span>
</span><a name="line-1273"></a><span class="hs-identifier">getPackageFrameworks</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-1274"></a><a name="getPackageFrameworks"><a href="Packages.html#getPackageFrameworks"><span class="hs-identifier">getPackageFrameworks</span></a></a><span> </span><a name="local-1627577042"><a href="#local-1627577042"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577043"><a href="#local-1627577043"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1275"></a><span>  </span><a name="local-1627577044"><a href="#local-1627577044"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Packages.html#getPreloadPackagesAnd"><span class="hs-identifier hs-var">getPreloadPackagesAnd</span></a><span> </span><a href="#local-1627577042"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627577043"><span class="hs-identifier hs-var">pkgs</span></a><span>
</span><a name="line-1276"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-identifier">frameworks</span><span> </span><a href="#local-1627577044"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1277"></a><span>
</span><a name="line-1278"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1279"></a><span class="hs-comment">-- Package Utils</span><span>
</span><a name="line-1280"></a><span>
</span><a name="line-1281"></a><span class="hs-comment">-- | Takes a 'ModuleName', and if the module is in any package returns</span><span>
</span><a name="line-1282"></a><span class="hs-comment">-- list of modules which take that name.</span><span>
</span><a name="line-1283"></a><span class="hs-identifier">lookupModuleInAllPackages</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-1284"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-1285"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1286"></a><a name="lookupModuleInAllPackages"><a href="Packages.html#lookupModuleInAllPackages"><span class="hs-identifier">lookupModuleInAllPackages</span></a></a><span> </span><a name="local-1627577045"><a href="#local-1627577045"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577046"><a href="#local-1627577046"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-1287"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Packages.html#lookupModuleWithSuggestions"><span class="hs-identifier hs-var">lookupModuleWithSuggestions</span></a><span> </span><a href="#local-1627577045"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627577046"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1288"></a><span>      </span><a href="Packages.html#LookupFound"><span class="hs-identifier hs-var">LookupFound</span></a><span> </span><a name="local-1627577047"><a href="#local-1627577047"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627577048"><a href="#local-1627577048"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1627577047"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-1627577048"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1289"></a><span>      </span><a href="Packages.html#LookupMultiple"><span class="hs-identifier hs-var">LookupMultiple</span></a><span> </span><a name="local-1627577049"><a href="#local-1627577049"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627577050"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627577049"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-1290"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-1627577050"><a href="#local-1627577050"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627577051"><a href="#local-1627577051"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627577051"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span> </span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-string">&quot;lookupModule&quot;</span><span> </span><span class="hs-special">(</span><a href="Packages.html#lookupPackage"><span class="hs-identifier hs-var">lookupPackage</span></a><span> </span><a href="#local-1627577045"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1291"></a><span>                                                         </span><span class="hs-special">(</span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-1627577051"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1292"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1293"></a><span>
</span><a name="line-1294"></a><span class="hs-comment">-- | The result of performing a lookup</span><span>
</span><a name="line-1295"></a><span class="hs-keyword">data</span><span> </span><a name="LookupResult"><a href="Packages.html#LookupResult"><span class="hs-identifier">LookupResult</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1296"></a><span>    </span><span class="hs-comment">-- | Found the module uniquely, nothing else to do</span><span>
</span><a name="line-1297"></a><span>    </span><a name="LookupFound"><a href="Packages.html#LookupFound"><span class="hs-identifier">LookupFound</span></a></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-1298"></a><span>    </span><span class="hs-comment">-- | Multiple modules with the same name in scope</span><span>
</span><a name="line-1299"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LookupMultiple"><a href="Packages.html#LookupMultiple"><span class="hs-identifier">LookupMultiple</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1300"></a><span>    </span><span class="hs-comment">-- | No modules found, but there were some hidden ones with</span><span>
</span><a name="line-1301"></a><span>    </span><span class="hs-comment">-- an exact name match.  First is due to package hidden, second</span><span>
</span><a name="line-1302"></a><span>    </span><span class="hs-comment">-- is due to module being hidden</span><span>
</span><a name="line-1303"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LookupHidden"><a href="Packages.html#LookupHidden"><span class="hs-identifier">LookupHidden</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1304"></a><span>    </span><span class="hs-comment">-- | Nothing found, here are some suggested different names</span><span>
</span><a name="line-1305"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LookupNotFound"><a href="Packages.html#LookupNotFound"><span class="hs-identifier">LookupNotFound</span></a></a><span> </span><span class="hs-special">[</span><a href="Packages.html#ModuleSuggestion"><span class="hs-identifier hs-type">ModuleSuggestion</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- suggestions</span><span>
</span><a name="line-1306"></a><span>
</span><a name="line-1307"></a><span class="hs-keyword">data</span><span> </span><a name="ModuleSuggestion"><a href="Packages.html#ModuleSuggestion"><span class="hs-identifier">ModuleSuggestion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SuggestVisible"><a href="Packages.html#SuggestVisible"><span class="hs-identifier">SuggestVisible</span></a></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span>
</span><a name="line-1308"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a name="SuggestHidden"><a href="Packages.html#SuggestHidden"><span class="hs-identifier">SuggestHidden</span></a></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span>
</span><a name="line-1309"></a><span>
</span><a name="line-1310"></a><span class="hs-identifier">lookupModuleWithSuggestions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-1311"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-1312"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-1313"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a><span>
</span><a name="line-1314"></a><a name="lookupModuleWithSuggestions"><a href="Packages.html#lookupModuleWithSuggestions"><span class="hs-identifier">lookupModuleWithSuggestions</span></a></a><span> </span><a name="local-1627577052"><a href="#local-1627577052"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-1315"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#lookupModuleWithSuggestions%27"><span class="hs-identifier hs-var">lookupModuleWithSuggestions'</span></a><span> </span><a href="#local-1627577052"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1316"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">moduleToPkgConfAll</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pkgState</span><span> </span><a href="#local-1627577052"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1317"></a><span>
</span><a name="line-1318"></a><span class="hs-identifier">lookupPluginModuleWithSuggestions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-1319"></a><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-1320"></a><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-1321"></a><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a><span>
</span><a name="line-1322"></a><a name="lookupPluginModuleWithSuggestions"><a href="Packages.html#lookupPluginModuleWithSuggestions"><span class="hs-identifier">lookupPluginModuleWithSuggestions</span></a></a><span> </span><a name="local-1627577053"><a href="#local-1627577053"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-1323"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#lookupModuleWithSuggestions%27"><span class="hs-identifier hs-var">lookupModuleWithSuggestions'</span></a><span> </span><a href="#local-1627577053"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1324"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">pluginModuleToPkgConfAll</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pkgState</span><span> </span><a href="#local-1627577053"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1325"></a><span>
</span><a name="line-1326"></a><span class="hs-identifier">lookupModuleWithSuggestions'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-1327"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#ModuleToPkgConfAll"><span class="hs-identifier hs-type">ModuleToPkgConfAll</span></a><span>
</span><a name="line-1328"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-1329"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-1330"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a><span>
</span><a name="line-1331"></a><a name="lookupModuleWithSuggestions%27"><a href="Packages.html#lookupModuleWithSuggestions%27"><span class="hs-identifier">lookupModuleWithSuggestions'</span></a></a><span> </span><a name="local-1627577054"><a href="#local-1627577054"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577055"><a href="#local-1627577055"><span class="hs-identifier">mod_map</span></a></a><span> </span><a name="local-1627577056"><a href="#local-1627577056"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627577057"><a href="#local-1627577057"><span class="hs-identifier">mb_pn</span></a></a><span>
</span><a name="line-1332"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#lookup"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span></a><span> </span><a href="#local-1627577056"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1627577055"><span class="hs-identifier hs-var">mod_map</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1333"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#LookupNotFound"><span class="hs-identifier hs-var">LookupNotFound</span></a><span> </span><a href="#local-1627577062"><span class="hs-identifier hs-var">suggestions</span></a><span>
</span><a name="line-1334"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577087"><a href="#local-1627577087"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1335"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a><span> </span><a href="#local-1627577058"><span class="hs-identifier hs-var">classify</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#toList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><a href="#local-1627577087"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1336"></a><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#LookupNotFound"><span class="hs-identifier hs-var">LookupNotFound</span></a><span> </span><a href="#local-1627577062"><span class="hs-identifier hs-var">suggestions</span></a><span>
</span><a name="line-1337"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a name="local-1627577088"><a href="#local-1627577088"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#LookupFound"><span class="hs-identifier hs-var">LookupFound</span></a><span> </span><a href="#local-1627577088"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577060"><span class="hs-identifier hs-var">mod_pkg</span></a><span> </span><a href="#local-1627577088"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-1338"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627577089"><a href="#local-1627577089"><span class="hs-identifier">exposed</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#LookupMultiple"><span class="hs-identifier hs-var">LookupMultiple</span></a><span> </span><a href="#local-1627577089"><span class="hs-identifier hs-var">exposed</span></a><span>
</span><a name="line-1339"></a><span>            </span><span class="hs-special">(</span><a name="local-1627577090"><a href="#local-1627577090"><span class="hs-identifier">hidden_pkg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627577091"><a href="#local-1627577091"><span class="hs-identifier">hidden_mod</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#LookupHidden"><span class="hs-identifier hs-var">LookupHidden</span></a><span> </span><a href="#local-1627577090"><span class="hs-identifier hs-var">hidden_pkg</span></a><span> </span><a href="#local-1627577091"><span class="hs-identifier hs-var">hidden_mod</span></a><span>
</span><a name="line-1340"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1341"></a><span>    </span><a name="local-1627577058"><a href="#local-1627577058"><span class="hs-identifier">classify</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627577065"><a href="#local-1627577065"><span class="hs-identifier">hidden_pkg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627577066"><a href="#local-1627577066"><span class="hs-identifier">hidden_mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627577067"><a href="#local-1627577067"><span class="hs-identifier">exposed</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627577068"><a href="#local-1627577068"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627577069"><a href="#local-1627577069"><span class="hs-identifier">origin0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1342"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-1627577070"><a href="#local-1627577070"><span class="hs-identifier">origin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577061"><span class="hs-identifier hs-var">filterOrigin</span></a><span> </span><a href="#local-1627577057"><span class="hs-identifier hs-var">mb_pn</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577060"><span class="hs-identifier hs-var">mod_pkg</span></a><span> </span><a href="#local-1627577068"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627577069"><span class="hs-identifier hs-var">origin0</span></a><span>
</span><a name="line-1343"></a><span>          </span><a name="local-1627577071"><a href="#local-1627577071"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627577068"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627577070"><span class="hs-identifier hs-var">origin</span></a><span class="hs-special">)</span><span>
</span><a name="line-1344"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627577070"><span class="hs-identifier hs-var">origin</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1345"></a><span>          </span><a href="Packages.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627577065"><span class="hs-identifier hs-var">hidden_pkg</span></a><span class="hs-special">,</span><span>   </span><a href="#local-1627577071"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-1627577066"><span class="hs-identifier hs-var">hidden_mod</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627577067"><span class="hs-identifier hs-var">exposed</span></a><span class="hs-special">)</span><span>
</span><a name="line-1346"></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Packages.html#originEmpty"><span class="hs-identifier hs-var">originEmpty</span></a><span> </span><a href="#local-1627577070"><span class="hs-identifier hs-var">origin</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627577065"><span class="hs-identifier hs-var">hidden_pkg</span></a><span class="hs-special">,</span><span>   </span><a href="#local-1627577066"><span class="hs-identifier hs-var">hidden_mod</span></a><span class="hs-special">,</span><span>   </span><a href="#local-1627577067"><span class="hs-identifier hs-var">exposed</span></a><span class="hs-special">)</span><span>
</span><a name="line-1347"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="Packages.html#originVisible"><span class="hs-identifier hs-var">originVisible</span></a><span> </span><a href="#local-1627577070"><span class="hs-identifier hs-var">origin</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627577065"><span class="hs-identifier hs-var">hidden_pkg</span></a><span class="hs-special">,</span><span>   </span><a href="#local-1627577066"><span class="hs-identifier hs-var">hidden_mod</span></a><span class="hs-special">,</span><span>   </span><a href="#local-1627577071"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-1627577067"><span class="hs-identifier hs-var">exposed</span></a><span class="hs-special">)</span><span>
</span><a name="line-1348"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627577071"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-1627577065"><span class="hs-identifier hs-var">hidden_pkg</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627577066"><span class="hs-identifier hs-var">hidden_mod</span></a><span class="hs-special">,</span><span>   </span><a href="#local-1627577067"><span class="hs-identifier hs-var">exposed</span></a><span class="hs-special">)</span><span>
</span><a name="line-1349"></a><span>
</span><a name="line-1350"></a><span>    </span><a name="local-1627577059"><a href="#local-1627577059"><span class="hs-identifier">pkg_lookup</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-string">&quot;lookupModuleWithSuggestions&quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Packages.html#lookupPackage"><span class="hs-identifier hs-var">lookupPackage</span></a><span> </span><a href="#local-1627577054"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1351"></a><span>    </span><a name="local-1627577060"><a href="#local-1627577060"><span class="hs-identifier">mod_pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577059"><span class="hs-identifier hs-var">pkg_lookup</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">moduleUnitId</span><span>
</span><a name="line-1352"></a><span>
</span><a name="line-1353"></a><span>    </span><span class="hs-comment">-- Filters out origins which are not associated with the given package</span><span>
</span><a name="line-1354"></a><span>    </span><span class="hs-comment">-- qualifier.  No-op if there is no package qualifier.  Test if this</span><span>
</span><a name="line-1355"></a><span>    </span><span class="hs-comment">-- excluded all origins with 'originEmpty'.</span><span>
</span><a name="line-1356"></a><span>    </span><span class="hs-identifier">filterOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-1357"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span>
</span><a name="line-1358"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span>
</span><a name="line-1359"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span>
</span><a name="line-1360"></a><span>    </span><a name="local-1627577061"><a href="#local-1627577061"><span class="hs-identifier">filterOrigin</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627577072"><a href="#local-1627577072"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577072"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-1361"></a><span>    </span><span class="hs-identifier">filterOrigin</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577073"><a href="#local-1627577073"><span class="hs-identifier">pn</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627577074"><a href="#local-1627577074"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-1627577075"><a href="#local-1627577075"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1362"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627577075"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1363"></a><span>          </span><a href="Packages.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627577076"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627577074"><span class="hs-identifier hs-var">pkg</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Packages.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a><span>
</span><a name="line-1364"></a><span>          </span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fromOrigPackage</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1627577078"><a href="#local-1627577078"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fromExposedReexport</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1627577079"><a href="#local-1627577079"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1365"></a><span>                      </span><span class="hs-identifier">fromHiddenReexport</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1627577080"><a href="#local-1627577080"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1366"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1367"></a><span>                  </span><span class="hs-identifier">fromOrigPackage</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627577076"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627577074"><span class="hs-identifier hs-var">pkg</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-1627577078"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1368"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fromExposedReexport</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-1627577076"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627577079"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1369"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fromHiddenReexport</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-1627577076"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627577080"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1370"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fromPackageFlag</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">-- always excluded</span><span>
</span><a name="line-1371"></a><span>                </span><span class="hs-special">}</span><span>
</span><a name="line-1372"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-1627577076"><a href="#local-1627577076"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627577077"><a href="#local-1627577077"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627577073"><span class="hs-identifier hs-var">pn</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Packages.html#fsPackageName"><span class="hs-identifier hs-var">fsPackageName</span></a><span> </span><a href="#local-1627577077"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-1373"></a><span>
</span><a name="line-1374"></a><span>    </span><a name="local-1627577062"><a href="#local-1627577062"><span class="hs-identifier">suggestions</span></a></a><span>
</span><a name="line-1375"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_HelpfulErrors"><span class="hs-identifier hs-var">Opt_HelpfulErrors</span></a><span> </span><a href="#local-1627577054"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1376"></a><span>           </span><a href="Util.html#fuzzyLookup"><span class="hs-identifier hs-var">fuzzyLookup</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a><span> </span><a href="#local-1627577056"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627577063"><span class="hs-identifier hs-var">all_mods</span></a><span>
</span><a name="line-1377"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1378"></a><span>
</span><a name="line-1379"></a><span>    </span><span class="hs-identifier">all_mods</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#ModuleSuggestion"><span class="hs-identifier hs-type">ModuleSuggestion</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- All modules</span><span>
</span><a name="line-1380"></a><span>    </span><a name="local-1627577063"><a href="#local-1627577063"><span class="hs-identifier">all_mods</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#comparing"><span class="hs-identifier hs-var">comparing</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1381"></a><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="Module.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a><span> </span><a href="#local-1627577081"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627577083"><span class="hs-identifier hs-var">suggestion</span></a><span class="hs-special">)</span><span>
</span><a name="line-1382"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1627577081"><a href="#local-1627577081"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627577082"><a href="#local-1627577082"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#toList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleToPkgConfAll</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pkgState</span><span> </span><a href="#local-1627577054"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1383"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local-1627577083"><a href="#local-1627577083"><span class="hs-identifier">suggestion</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577064"><span class="hs-identifier hs-var">getSuggestion</span></a><span> </span><a href="#local-1627577081"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#toList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><a href="#local-1627577082"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1384"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-1385"></a><span>    </span><a name="local-1627577064"><a href="#local-1627577064"><span class="hs-identifier">getSuggestion</span></a></a><span> </span><a name="local-1627577084"><a href="#local-1627577084"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627577085"><a href="#local-1627577085"><span class="hs-identifier">mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627577086"><a href="#local-1627577086"><span class="hs-identifier">origin</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1386"></a><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="Packages.html#originVisible"><span class="hs-identifier hs-var">originVisible</span></a><span> </span><a href="#local-1627577086"><span class="hs-identifier hs-var">origin</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Packages.html#SuggestVisible"><span class="hs-identifier hs-var">SuggestVisible</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Packages.html#SuggestHidden"><span class="hs-identifier hs-var">SuggestHidden</span></a><span class="hs-special">)</span><span>
</span><a name="line-1387"></a><span>            </span><a href="#local-1627577084"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1627577085"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-1627577086"><span class="hs-identifier hs-var">origin</span></a><span>
</span><a name="line-1388"></a><span>
</span><a name="line-1389"></a><span class="hs-identifier">listVisibleModuleNames</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">]</span><span>
</span><a name="line-1390"></a><a name="listVisibleModuleNames"><a href="Packages.html#listVisibleModuleNames"><span class="hs-identifier">listVisibleModuleNames</span></a></a><span> </span><a name="local-1627577092"><a href="#local-1627577092"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1391"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-1627577093"><span class="hs-identifier hs-var">visible</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#toList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleToPkgConfAll</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pkgState</span><span> </span><a href="#local-1627577092"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1392"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1627577093"><a href="#local-1627577093"><span class="hs-identifier">visible</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627577094"><a href="#local-1627577094"><span class="hs-identifier">ms</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><a href="Packages.html#originVisible"><span class="hs-identifier hs-var">originVisible</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#elems"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span></a><span> </span><a href="#local-1627577094"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-1393"></a><span>
</span><a name="line-1394"></a><span class="hs-comment">-- | Find all the 'PackageConfig' in both the preload packages from 'DynFlags' and corresponding to the list of</span><span>
</span><a name="line-1395"></a><span class="hs-comment">-- 'PackageConfig's</span><span>
</span><a name="line-1396"></a><span class="hs-identifier">getPreloadPackagesAnd</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span class="hs-special">]</span><span>
</span><a name="line-1397"></a><a name="getPreloadPackagesAnd"><a href="Packages.html#getPreloadPackagesAnd"><span class="hs-identifier">getPreloadPackagesAnd</span></a></a><span> </span><a name="local-1627577095"><a href="#local-1627577095"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577096"><a href="#local-1627577096"><span class="hs-identifier">pkgids</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1398"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-1399"></a><span>      </span><a name="local-1627577097"><a href="#local-1627577097"><span class="hs-identifier">state</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pkgState</span><span> </span><a href="#local-1627577095"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1400"></a><span>      </span><a name="local-1627577098"><a href="#local-1627577098"><span class="hs-identifier">pkg_map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pkgIdMap</span><span> </span><a href="#local-1627577097"><span class="hs-identifier hs-var">state</span></a><span>
</span><a name="line-1401"></a><span>      </span><a name="local-1627577099"><a href="#local-1627577099"><span class="hs-identifier">preload</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">preloadPackages</span><span> </span><a href="#local-1627577097"><span class="hs-identifier hs-var">state</span></a><span>
</span><a name="line-1402"></a><span>      </span><a name="local-1627577100"><a href="#local-1627577100"><span class="hs-identifier">pairs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><a href="#local-1627577096"><span class="hs-identifier hs-var">pkgids</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1403"></a><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1404"></a><span>  </span><a name="local-1627577101"><a href="#local-1627577101"><span class="hs-identifier">all_pkgs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Packages.html#throwErr"><span class="hs-identifier hs-var">throwErr</span></a><span> </span><a href="#local-1627577095"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#add_package"><span class="hs-identifier hs-var">add_package</span></a><span> </span><a href="#local-1627577098"><span class="hs-identifier hs-var">pkg_map</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627577099"><span class="hs-identifier hs-var">preload</span></a><span> </span><a href="#local-1627577100"><span class="hs-identifier hs-var">pairs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1405"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#getPackageDetails"><span class="hs-identifier hs-var">getPackageDetails</span></a><span> </span><a href="#local-1627577095"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627577101"><span class="hs-identifier hs-var">all_pkgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1406"></a><span>
</span><a name="line-1407"></a><span class="hs-comment">-- Takes a list of packages, and returns the list with dependencies included,</span><span>
</span><a name="line-1408"></a><span class="hs-comment">-- in reverse dependency order (a package appears before those it depends on).</span><span>
</span><a name="line-1409"></a><span class="hs-identifier">closeDeps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-1410"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span>
</span><a name="line-1411"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1412"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>
</span><a name="line-1413"></a><a name="closeDeps"><a href="Packages.html#closeDeps"><span class="hs-identifier">closeDeps</span></a></a><span> </span><a name="local-1627577102"><a href="#local-1627577102"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577103"><a href="#local-1627577103"><span class="hs-identifier">pkg_map</span></a></a><span> </span><a name="local-1627577104"><a href="#local-1627577104"><span class="hs-identifier">ps</span></a></a><span>
</span><a name="line-1414"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#throwErr"><span class="hs-identifier hs-var">throwErr</span></a><span> </span><a href="#local-1627577102"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#closeDepsErr"><span class="hs-identifier hs-var">closeDepsErr</span></a><span> </span><a href="#local-1627577103"><span class="hs-identifier hs-var">pkg_map</span></a><span> </span><a href="#local-1627577104"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1415"></a><span>
</span><a name="line-1416"></a><span class="hs-identifier">throwErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Maybes.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span> </span><a href="#local-1627576648"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1627576648"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1417"></a><a name="throwErr"><a href="Packages.html#throwErr"><span class="hs-identifier">throwErr</span></a></a><span> </span><a name="local-1627577105"><a href="#local-1627577105"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577106"><a href="#local-1627577106"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-1418"></a><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627577106"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1419"></a><span>                </span><a href="Maybes.html#Failed"><span class="hs-identifier hs-var">Failed</span></a><span> </span><a name="local-1627577107"><a href="#local-1627577107"><span class="hs-identifier">e</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a><span> </span><a href="#local-1627577105"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627577107"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1420"></a><span>                </span><a href="Maybes.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a><span> </span><a name="local-1627577108"><a href="#local-1627577108"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627577108"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1421"></a><span>
</span><a name="line-1422"></a><span class="hs-identifier">closeDepsErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span>
</span><a name="line-1423"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">,</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1424"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Maybes.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>
</span><a name="line-1425"></a><a name="closeDepsErr"><a href="Packages.html#closeDepsErr"><span class="hs-identifier">closeDepsErr</span></a></a><span> </span><a name="local-1627577109"><a href="#local-1627577109"><span class="hs-identifier">pkg_map</span></a></a><span> </span><a name="local-1627577110"><a href="#local-1627577110"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#add_package"><span class="hs-identifier hs-var">add_package</span></a><span> </span><a href="#local-1627577109"><span class="hs-identifier hs-var">pkg_map</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1627577110"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-1426"></a><span>
</span><a name="line-1427"></a><span class="hs-comment">-- internal helper</span><span>
</span><a name="line-1428"></a><span class="hs-identifier">add_package</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span>
</span><a name="line-1429"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>
</span><a name="line-1430"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">,</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">)</span><span>
</span><a name="line-1431"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Maybes.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>
</span><a name="line-1432"></a><a name="add_package"><a href="Packages.html#add_package"><span class="hs-identifier">add_package</span></a></a><span> </span><a name="local-1627577111"><a href="#local-1627577111"><span class="hs-identifier">pkg_db</span></a></a><span> </span><a name="local-1627577112"><a href="#local-1627577112"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627577113"><a href="#local-1627577113"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627577114"><a href="#local-1627577114"><span class="hs-identifier">mb_parent</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1433"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627577113"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627577112"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627577112"><span class="hs-identifier hs-var">ps</span></a><span>     </span><span class="hs-comment">-- Check if we've already added this package</span><span>
</span><a name="line-1434"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1435"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="Packages.html#lookupPackage%27"><span class="hs-identifier hs-var">lookupPackage'</span></a><span> </span><a href="#local-1627577111"><span class="hs-identifier hs-var">pkg_db</span></a><span> </span><a href="#local-1627577113"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1436"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Maybes.html#Failed"><span class="hs-identifier hs-var">Failed</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#missingPackageMsg"><span class="hs-identifier hs-var">missingPackageMsg</span></a><span> </span><a href="#local-1627577113"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-1437"></a><span>                           </span><a href="Packages.html#missingDependencyMsg"><span class="hs-identifier hs-var">missingDependencyMsg</span></a><span> </span><a href="#local-1627577114"><span class="hs-identifier hs-var">mb_parent</span></a><span class="hs-special">)</span><span>
</span><a name="line-1438"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577115"><a href="#local-1627577115"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1439"></a><span>           </span><span class="hs-comment">-- Add the package's dependents also</span><span>
</span><a name="line-1440"></a><span>           </span><a name="local-1627577119"><a href="#local-1627577119"><span class="hs-identifier">ps'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span> </span><a href="#local-1627577116"><span class="hs-identifier hs-var">add_unit_key</span></a><span> </span><a href="#local-1627577112"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">depends</span><span> </span><a href="#local-1627577115"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1441"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577113"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1627577119"><span class="hs-identifier hs-var">ps'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1442"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-1443"></a><span>            </span><a name="local-1627577116"><a href="#local-1627577116"><span class="hs-identifier">add_unit_key</span></a></a><span> </span><a name="local-1627577117"><a href="#local-1627577117"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-1627577118"><a href="#local-1627577118"><span class="hs-identifier">key</span></a></a><span>
</span><a name="line-1444"></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#add_package"><span class="hs-identifier hs-var">add_package</span></a><span> </span><a href="#local-1627577111"><span class="hs-identifier hs-var">pkg_db</span></a><span> </span><a href="#local-1627577117"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577118"><span class="hs-identifier hs-var">key</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627577113"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1445"></a><span>
</span><a name="line-1446"></a><span class="hs-identifier">missingPackageMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-1627576647"><span class="hs-identifier hs-type">pkgid</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627576647"><span class="hs-identifier hs-type">pkgid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1447"></a><a name="missingPackageMsg"><a href="Packages.html#missingPackageMsg"><span class="hs-identifier">missingPackageMsg</span></a></a><span> </span><a name="local-1627577120"><a href="#local-1627577120"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;unknown package:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627577120"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1448"></a><span>
</span><a name="line-1449"></a><span class="hs-identifier">missingDependencyMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1450"></a><a name="missingDependencyMsg"><a href="Packages.html#missingDependencyMsg"><span class="hs-identifier">missingDependencyMsg</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1451"></a><span class="hs-identifier">missingDependencyMsg</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577121"><a href="#local-1627577121"><span class="hs-identifier">parent</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1452"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#space"><span class="hs-identifier hs-var">space</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;dependency of&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a><span> </span><a href="#local-1627577121"><span class="hs-identifier hs-var">parent</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1453"></a><span>
</span><a name="line-1454"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1455"></a><span>
</span><a name="line-1456"></a><span class="hs-identifier">unitIdPackageIdString</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>
</span><a name="line-1457"></a><a name="unitIdPackageIdString"><a href="Packages.html#unitIdPackageIdString"><span class="hs-identifier">unitIdPackageIdString</span></a></a><span> </span><a name="local-1627577122"><a href="#local-1627577122"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577123"><a href="#local-1627577123"><span class="hs-identifier">pkg_key</span></a></a><span>
</span><a name="line-1458"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627577123"><span class="hs-identifier hs-var">pkg_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Module.html#mainUnitId"><span class="hs-identifier hs-var">mainUnitId</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-string">&quot;main&quot;</span><span>
</span><a name="line-1459"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="PackageConfig.html#sourcePackageIdString"><span class="hs-identifier hs-var">sourcePackageIdString</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#lookupPackage"><span class="hs-identifier hs-var">lookupPackage</span></a><span> </span><a href="#local-1627577122"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627577123"><span class="hs-identifier hs-var">pkg_key</span></a><span class="hs-special">)</span><span>
</span><a name="line-1460"></a><span>
</span><a name="line-1461"></a><span class="hs-comment">-- | Will the 'Name' come from a dynamically linked library?</span><span>
</span><a name="line-1462"></a><span class="hs-identifier">isDllName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1463"></a><span class="hs-comment">-- Despite the &quot;dll&quot;, I think this function just means that</span><span>
</span><a name="line-1464"></a><span class="hs-comment">-- the symbol comes from another dynamically-linked package,</span><span>
</span><a name="line-1465"></a><span class="hs-comment">-- and applies on all platforms, not just Windows</span><span>
</span><a name="line-1466"></a><a name="isDllName"><a href="Packages.html#isDllName"><span class="hs-identifier">isDllName</span></a></a><span> </span><a name="local-1627577124"><a href="#local-1627577124"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627577125"><a href="#local-1627577125"><span class="hs-identifier">_this_pkg</span></a></a><span> </span><a name="local-1627577126"><a href="#local-1627577126"><span class="hs-identifier">this_mod</span></a></a><span> </span><a name="local-1627577127"><a href="#local-1627577127"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1467"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#notElem"><span class="hs-identifier hs-var">notElem</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">ways</span><span> </span><a href="#local-1627577124"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1468"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577128"><a href="#local-1627577128"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-1627577127"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1469"></a><span>    </span><span class="hs-comment">-- Issue #8696 - when GHC is dynamically linked, it will attempt</span><span>
</span><a name="line-1470"></a><span>    </span><span class="hs-comment">-- to load the dynamic dependencies of object files at compile</span><span>
</span><a name="line-1471"></a><span>    </span><span class="hs-comment">-- time for things like QuasiQuotes or</span><span>
</span><a name="line-1472"></a><span>    </span><span class="hs-comment">-- TemplateHaskell. Unfortunately, this interacts badly with</span><span>
</span><a name="line-1473"></a><span>    </span><span class="hs-comment">-- intra-package linking, because we don't generate indirect</span><span>
</span><a name="line-1474"></a><span>    </span><span class="hs-comment">-- (dynamic) symbols for intra-package calls. This means that if a</span><span>
</span><a name="line-1475"></a><span>    </span><span class="hs-comment">-- module with an intra-package call is loaded without its</span><span>
</span><a name="line-1476"></a><span>    </span><span class="hs-comment">-- dependencies, then GHC fails to link. This is the cause of #</span><span>
</span><a name="line-1477"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-1478"></a><span>    </span><span class="hs-comment">-- In the mean time, always force dynamic indirections to be</span><span>
</span><a name="line-1479"></a><span>    </span><span class="hs-comment">-- generated: when the module name isn't the module being</span><span>
</span><a name="line-1480"></a><span>    </span><span class="hs-comment">-- compiled, references are dynamic.</span><span>
</span><a name="line-1481"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627577128"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1627577126"><span class="hs-identifier hs-var">this_mod</span></a><span>
</span><a name="line-1482"></a><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1483"></a><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">dllSplit</span><span> </span><a href="#local-1627577124"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1484"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1485"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577129"><a href="#local-1627577129"><span class="hs-identifier">ss</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1486"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-1627577130"><a href="#local-1627577130"><span class="hs-identifier">findMod</span></a></a><span> </span><a name="local-1627577131"><a href="#local-1627577131"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627577132"><a href="#local-1627577132"><span class="hs-identifier">modStr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-1627577131"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-1487"></a><span>                               </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#find"><span class="hs-identifier hs-var">find</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577132"><span class="hs-identifier hs-var">modStr</span></a><span> </span><span class="hs-special">`</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Base.html#member"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">member</span></a><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><a href="#local-1627577129"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1488"></a><span>                                  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627577133"><a href="#local-1627577133"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627577133"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-1489"></a><span>                                  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Can't find &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627577132"><span class="hs-identifier hs-var">modStr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;in DLL split&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1490"></a><span>               </span><span class="hs-keyword">in</span><span> </span><a href="#local-1627577130"><span class="hs-identifier hs-var">findMod</span></a><span> </span><a href="#local-1627577128"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1627577130"><span class="hs-identifier hs-var">findMod</span></a><span> </span><a href="#local-1627577126"><span class="hs-identifier hs-var">this_mod</span></a><span>
</span><a name="line-1491"></a><span>
</span><a name="line-1492"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- no, it is not even an external name</span><span>
</span><a name="line-1493"></a><span>
</span><a name="line-1494"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1495"></a><span class="hs-comment">-- Displaying packages</span><span>
</span><a name="line-1496"></a><span>
</span><a name="line-1497"></a><span class="hs-comment">-- | Show (very verbose) package info</span><span>
</span><a name="line-1498"></a><span class="hs-identifier">pprPackages</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1499"></a><a name="pprPackages"><a href="Packages.html#pprPackages"><span class="hs-identifier">pprPackages</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#pprPackagesWith"><span class="hs-identifier hs-var">pprPackagesWith</span></a><span> </span><a href="PackageConfig.html#pprPackageConfig"><span class="hs-identifier hs-var">pprPackageConfig</span></a><span>
</span><a name="line-1500"></a><span>
</span><a name="line-1501"></a><span class="hs-identifier">pprPackagesWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1502"></a><a name="pprPackagesWith"><a href="Packages.html#pprPackagesWith"><span class="hs-identifier">pprPackagesWith</span></a></a><span> </span><a name="local-1627577134"><a href="#local-1627577134"><span class="hs-identifier">pprIPI</span></a></a><span> </span><a name="local-1627577135"><a href="#local-1627577135"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1503"></a><span>    </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#intersperse"><span class="hs-identifier hs-var">intersperse</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;---&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627577134"><span class="hs-identifier hs-var">pprIPI</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#listPackageConfigMap"><span class="hs-identifier hs-var">listPackageConfigMap</span></a><span> </span><a href="#local-1627577135"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1504"></a><span>
</span><a name="line-1505"></a><span class="hs-comment">-- | Show simplified package info.</span><span>
</span><a name="line-1506"></a><span class="hs-comment">--</span><span>
</span><a name="line-1507"></a><span class="hs-comment">-- The idea is to only print package id, and any information that might</span><span>
</span><a name="line-1508"></a><span class="hs-comment">-- be different from the package databases (exposure, trust)</span><span>
</span><a name="line-1509"></a><span class="hs-identifier">pprPackagesSimple</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1510"></a><a name="pprPackagesSimple"><a href="Packages.html#pprPackagesSimple"><span class="hs-identifier">pprPackagesSimple</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#pprPackagesWith"><span class="hs-identifier hs-var">pprPackagesWith</span></a><span> </span><a href="#local-1627577136"><span class="hs-identifier hs-var">pprIPI</span></a><span>
</span><a name="line-1511"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-1627577136"><a href="#local-1627577136"><span class="hs-identifier">pprIPI</span></a></a><span> </span><a name="local-1627577137"><a href="#local-1627577137"><span class="hs-identifier">ipi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627577138"><a href="#local-1627577138"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unitId</span><span> </span><a href="#local-1627577137"><span class="hs-identifier hs-var">ipi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1512"></a><span>                           </span><a name="local-1627577139"><a href="#local-1627577139"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">exposed</span><span> </span><a href="#local-1627577137"><span class="hs-identifier hs-var">ipi</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;E&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot; &quot;</span><span>
</span><a name="line-1513"></a><span>                           </span><a name="local-1627577140"><a href="#local-1627577140"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">trusted</span><span> </span><a href="#local-1627577137"><span class="hs-identifier hs-var">ipi</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;T&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot; &quot;</span><span>
</span><a name="line-1514"></a><span>                       </span><span class="hs-keyword">in</span><span> </span><a href="#local-1627577139"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="#local-1627577140"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;  &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a><span> </span><a href="#local-1627577138"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-1515"></a><span>
</span><a name="line-1516"></a><span class="hs-comment">-- | Show the mapping of modules to where they come from.</span><span>
</span><a name="line-1517"></a><span class="hs-identifier">pprModuleMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1518"></a><a name="pprModuleMap"><a href="Packages.html#pprModuleMap"><span class="hs-identifier">pprModuleMap</span></a></a><span> </span><a name="local-1627577141"><a href="#local-1627577141"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1519"></a><span>  </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627577142"><span class="hs-identifier hs-var">pprLine</span></a><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#toList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleToPkgConfAll</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pkgState</span><span> </span><a href="#local-1627577141"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1520"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1521"></a><span>      </span><a name="local-1627577142"><a href="#local-1627577142"><span class="hs-identifier">pprLine</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627577144"><a href="#local-1627577144"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><a name="local-1627577145"><a href="#local-1627577145"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627577144"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">50</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627577143"><span class="hs-identifier hs-var">pprEntry</span></a><span> </span><a href="#local-1627577144"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#toList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><a href="#local-1627577145"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1522"></a><span>      </span><a name="local-1627577143"><a href="#local-1627577143"><span class="hs-identifier">pprEntry</span></a></a><span> </span><a name="local-1627577146"><a href="#local-1627577146"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627577147"><a href="#local-1627577147"><span class="hs-identifier">m'</span></a></a><span class="hs-special">,</span><a name="local-1627577148"><a href="#local-1627577148"><span class="hs-identifier">o</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1523"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627577146"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-1627577147"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-1627577147"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627577148"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">)</span><span>
</span><a name="line-1524"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627577147"><span class="hs-identifier hs-var">m'</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627577148"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">)</span><span>
</span><a name="line-1525"></a><span>
</span><a name="line-1526"></a><span class="hs-identifier">fsPackageName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PackageConfig.html#PackageConfig"><span class="hs-identifier hs-type">PackageConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-1527"></a><a name="fsPackageName"><a href="Packages.html#fsPackageName"><span class="hs-identifier">fsPackageName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="PackageConfig.html#packageNameString"><span class="hs-identifier hs-var">packageNameString</span></a><span>
</span><a name="line-1528"></a></pre></body></html>