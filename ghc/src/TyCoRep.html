<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1998
\section[TyCoRep]{Type and Coercion - friends' interface}

Note [The Type-related module hierarchy]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  Class
  CoAxiom
  TyCon    imports Class, CoAxiom
  TyCoRep  imports Class, CoAxiom, TyCon
  TysPrim  imports TyCoRep ( including mkTyConTy )
  Kind     imports TysPrim ( mainly for primitive kinds )
  Type     imports Kind
  Coercion imports Type
-}</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-comment">-- We expose the relevant stuff from this module via the Type module</span><span>
</span><a name="line-19"></a><span class="hs-pragma">{-# OPTIONS_HADDOCK hide #-}</span><span>
</span><a name="line-20"></a><span class="hs-pragma">{-# LANGUAGE CPP, DeriveDataTypeable, DeriveFunctor, DeriveFoldable,
             DeriveTraversable, MultiWayIf #-}</span><span>
</span><a name="line-22"></a><span class="hs-pragma">{-# LANGUAGE ImplicitParams #-}</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TyCoRep</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-25"></a><span>        </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>        </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="TyCoRep.html#TyLit"><span class="hs-identifier hs-type">TyLit</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="TyCoRep.html#KindOrType"><span class="hs-identifier hs-type">KindOrType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>        </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- Synonyms</span><span>
</span><a name="line-31"></a><span>        </span><a href="TyCoRep.html#VisibilityFlag"><span class="hs-identifier hs-type">VisibilityFlag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span>        </span><span class="hs-comment">-- * Coercions</span><span>
</span><a name="line-34"></a><span>        </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#LeftOrRight"><span class="hs-identifier hs-type">LeftOrRight</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="TyCoRep.html#UnivCoProvenance"><span class="hs-identifier hs-type">UnivCoProvenance</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="TyCoRep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CoercionR"><span class="hs-identifier hs-type">CoercionR</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CoercionP"><span class="hs-identifier hs-type">CoercionP</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#KindCoercion"><span class="hs-identifier hs-type">KindCoercion</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>        </span><span class="hs-comment">-- * Functions over types</span><span>
</span><a name="line-39"></a><span>        </span><a href="TyCoRep.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>        </span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkFunTys"><span class="hs-identifier hs-var">mkFunTys</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="TyCoRep.html#isLiftedTypeKind"><span class="hs-identifier hs-var">isLiftedTypeKind</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isUnliftedTypeKind"><span class="hs-identifier hs-var">isUnliftedTypeKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>        </span><a href="TyCoRep.html#isCoercionType"><span class="hs-identifier hs-var">isCoercionType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isRuntimeRepTy"><span class="hs-identifier hs-var">isRuntimeRepTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isRuntimeRepVar"><span class="hs-identifier hs-var">isRuntimeRepVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>        </span><a href="TyCoRep.html#isRuntimeRepKindedTy"><span class="hs-identifier hs-var">isRuntimeRepKindedTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#dropRuntimeRepArgs"><span class="hs-identifier hs-var">dropRuntimeRepArgs</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><a href="TyCoRep.html#sameVis"><span class="hs-identifier hs-var">sameVis</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>        </span><span class="hs-comment">-- * Functions over binders</span><span>
</span><a name="line-47"></a><span>        </span><a href="TyCoRep.html#binderType"><span class="hs-identifier hs-var">binderType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#delBinderVar"><span class="hs-identifier hs-var">delBinderVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isInvisibleBinder"><span class="hs-identifier hs-var">isInvisibleBinder</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isVisibleBinder"><span class="hs-identifier hs-var">isVisibleBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="TyCoRep.html#isNamedBinder"><span class="hs-identifier hs-var">isNamedBinder</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isAnonBinder"><span class="hs-identifier hs-var">isAnonBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>        </span><span class="hs-comment">-- * Functions over coercions</span><span>
</span><a name="line-51"></a><span>        </span><a href="TyCoRep.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span>        </span><span class="hs-comment">-- * Pretty-printing</span><span>
</span><a name="line-54"></a><span>        </span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTypeApp"><span class="hs-identifier hs-var">pprTypeApp</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier hs-var">pprTvBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTvBndrs"><span class="hs-identifier hs-var">pprTvBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>        </span><a href="TyCoRep.html#pprTyThing"><span class="hs-identifier hs-var">pprTyThing</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTyThingCategory"><span class="hs-identifier hs-var">pprTyThingCategory</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprSigmaType"><span class="hs-identifier hs-var">pprSigmaType</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>        </span><a href="TyCoRep.html#pprTheta"><span class="hs-identifier hs-var">pprTheta</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprForAll"><span class="hs-identifier hs-var">pprForAll</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprForAllImplicit"><span class="hs-identifier hs-var">pprForAllImplicit</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprUserForAll"><span class="hs-identifier hs-var">pprUserForAll</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>        </span><a href="TyCoRep.html#pprThetaArrowTy"><span class="hs-identifier hs-var">pprThetaArrowTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprClassPred"><span class="hs-identifier hs-var">pprClassPred</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>        </span><a href="TyCoRep.html#pprKind"><span class="hs-identifier hs-var">pprKind</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprParendKind"><span class="hs-identifier hs-var">pprParendKind</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTyLit"><span class="hs-identifier hs-var">pprTyLit</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>        </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#maybeParen"><span class="hs-identifier hs-var">maybeParen</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTcAppCo"><span class="hs-identifier hs-var">pprTcAppCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTcAppTy"><span class="hs-identifier hs-var">pprTcAppTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>        </span><a href="TyCoRep.html#pprPrefixApp"><span class="hs-identifier hs-var">pprPrefixApp</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprArrowChain"><span class="hs-identifier hs-var">pprArrowChain</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>        </span><a href="TyCoRep.html#pprDataCons"><span class="hs-identifier hs-var">pprDataCons</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span>        </span><span class="hs-comment">-- * Free variables</span><span>
</span><a name="line-64"></a><span>        </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeDSet"><span class="hs-identifier hs-var">tyCoVarsOfTypeDSet</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypesDSet"><span class="hs-identifier hs-var">tyCoVarsOfTypesDSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>        </span><a href="TyCoRep.html#tyCoVarsBndrAcc"><span class="hs-identifier hs-var">tyCoVarsBndrAcc</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">tyCoVarsOfTypeAcc</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeList"><span class="hs-identifier hs-var">tyCoVarsOfTypeList</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>        </span><a href="TyCoRep.html#tyCoVarsOfTypesAcc"><span class="hs-identifier hs-var">tyCoVarsOfTypesAcc</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypesList"><span class="hs-identifier hs-var">tyCoVarsOfTypesList</span></a><span class="hs-special">,</span><span>
</span><a name="line-67"></a><span>        </span><a href="TyCoRep.html#closeOverKindsDSet"><span class="hs-identifier hs-var">closeOverKindsDSet</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#closeOverKindsAcc"><span class="hs-identifier hs-var">closeOverKindsAcc</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>        </span><a href="TyCoRep.html#coVarsOfType"><span class="hs-identifier hs-var">coVarsOfType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#coVarsOfTypes"><span class="hs-identifier hs-var">coVarsOfTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>        </span><a href="TyCoRep.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#coVarsOfCos"><span class="hs-identifier hs-var">coVarsOfCos</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>        </span><a href="TyCoRep.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCos"><span class="hs-identifier hs-var">tyCoVarsOfCos</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>        </span><a href="TyCoRep.html#tyCoVarsOfCoDSet"><span class="hs-identifier hs-var">tyCoVarsOfCoDSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>        </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">tyCoVarsOfCoAcc</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCosAcc"><span class="hs-identifier hs-var">tyCoVarsOfCosAcc</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>        </span><a href="TyCoRep.html#tyCoVarsOfCoList"><span class="hs-identifier hs-var">tyCoVarsOfCoList</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfProv"><span class="hs-identifier hs-var">tyCoVarsOfProv</span></a><span class="hs-special">,</span><span>
</span><a name="line-74"></a><span>        </span><a href="TyCoRep.html#closeOverKinds"><span class="hs-identifier hs-var">closeOverKinds</span></a><span class="hs-special">,</span><span>
</span><a name="line-75"></a><span>        </span><a href="TyCoRep.html#tyCoVarsOfTelescope"><span class="hs-identifier hs-var">tyCoVarsOfTelescope</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span>        </span><span class="hs-comment">-- * Substitutions</span><span>
</span><a name="line-78"></a><span>        </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>        </span><a href="TyCoRep.html#emptyTvSubstEnv"><span class="hs-identifier hs-var">emptyTvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#emptyCvSubstEnv"><span class="hs-identifier hs-var">emptyCvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#composeTCvSubstEnv"><span class="hs-identifier hs-var">composeTCvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#composeTCvSubst"><span class="hs-identifier hs-var">composeTCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>        </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-81"></a><span>        </span><a href="TyCoRep.html#mkTCvSubst"><span class="hs-identifier hs-var">mkTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTvSubst"><span class="hs-identifier hs-var">mkTvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>        </span><a href="TyCoRep.html#getTvSubstEnv"><span class="hs-identifier hs-var">getTvSubstEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>        </span><a href="TyCoRep.html#getCvSubstEnv"><span class="hs-identifier hs-var">getCvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#getTCvInScope"><span class="hs-identifier hs-var">getTCvInScope</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isInScope"><span class="hs-identifier hs-var">isInScope</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#notElemTCvSubst"><span class="hs-identifier hs-var">notElemTCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>        </span><a href="TyCoRep.html#setTvSubstEnv"><span class="hs-identifier hs-var">setTvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#setCvSubstEnv"><span class="hs-identifier hs-var">setCvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#zapTCvSubst"><span class="hs-identifier hs-var">zapTCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>        </span><a href="TyCoRep.html#extendTCvInScope"><span class="hs-identifier hs-var">extendTCvInScope</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTCvInScopeList"><span class="hs-identifier hs-var">extendTCvInScopeList</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTCvInScopeSet"><span class="hs-identifier hs-var">extendTCvInScopeSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>        </span><a href="TyCoRep.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>        </span><a href="TyCoRep.html#extendCvSubst"><span class="hs-identifier hs-var">extendCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendCvSubstWithClone"><span class="hs-identifier hs-var">extendCvSubstWithClone</span></a><span class="hs-special">,</span><span>
</span><a name="line-88"></a><span>        </span><a href="TyCoRep.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTvSubstWithClone"><span class="hs-identifier hs-var">extendTvSubstWithClone</span></a><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>        </span><a href="TyCoRep.html#extendTvSubstList"><span class="hs-identifier hs-var">extendTvSubstList</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTvSubstAndInScope"><span class="hs-identifier hs-var">extendTvSubstAndInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>        </span><a href="TyCoRep.html#extendTvSubstBinder"><span class="hs-identifier hs-var">extendTvSubstBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-91"></a><span>        </span><a href="TyCoRep.html#unionTCvSubst"><span class="hs-identifier hs-var">unionTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#zipTyEnv"><span class="hs-identifier hs-var">zipTyEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#zipCoEnv"><span class="hs-identifier hs-var">zipCoEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyCoInScopeSet"><span class="hs-identifier hs-var">mkTyCoInScopeSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-92"></a><span>        </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#zipCvSubst"><span class="hs-identifier hs-var">zipCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>        </span><a href="TyCoRep.html#zipTyBinderSubst"><span class="hs-identifier hs-var">zipTyBinderSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>        </span><a href="TyCoRep.html#mkTvSubstPrs"><span class="hs-identifier hs-var">mkTvSubstPrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>        </span><a href="TyCoRep.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyWithCoVars"><span class="hs-identifier hs-var">substTyWithCoVars</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTysWith"><span class="hs-identifier hs-var">substTysWith</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTysWithCoVars"><span class="hs-identifier hs-var">substTysWithCoVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-97"></a><span>        </span><a href="TyCoRep.html#substCoWith"><span class="hs-identifier hs-var">substCoWith</span></a><span class="hs-special">,</span><span>
</span><a name="line-98"></a><span>        </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyAddInScope"><span class="hs-identifier hs-var">substTyAddInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>        </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTysUnchecked"><span class="hs-identifier hs-var">substTysUnchecked</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substThetaUnchecked"><span class="hs-identifier hs-var">substThetaUnchecked</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>        </span><a href="TyCoRep.html#substTyWithBindersUnchecked"><span class="hs-identifier hs-var">substTyWithBindersUnchecked</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyWithUnchecked"><span class="hs-identifier hs-var">substTyWithUnchecked</span></a><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>        </span><a href="TyCoRep.html#substCoUnchecked"><span class="hs-identifier hs-var">substCoUnchecked</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substCoWithUnchecked"><span class="hs-identifier hs-var">substCoWithUnchecked</span></a><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>        </span><a href="TyCoRep.html#substTyWithBinders"><span class="hs-identifier hs-var">substTyWithBinders</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyWithInScope"><span class="hs-identifier hs-var">substTyWithInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-103"></a><span>        </span><a href="TyCoRep.html#substTys"><span class="hs-identifier hs-var">substTys</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a><span class="hs-special">,</span><span>
</span><a name="line-104"></a><span>        </span><a href="TyCoRep.html#lookupTyVar"><span class="hs-identifier hs-var">lookupTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyVarBndr"><span class="hs-identifier hs-var">substTyVarBndr</span></a><span class="hs-special">,</span><span>
</span><a name="line-105"></a><span>        </span><a href="TyCoRep.html#substCo"><span class="hs-identifier hs-var">substCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substCos"><span class="hs-identifier hs-var">substCos</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substCoVar"><span class="hs-identifier hs-var">substCoVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substCoVars"><span class="hs-identifier hs-var">substCoVars</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#lookupCoVar"><span class="hs-identifier hs-var">lookupCoVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-106"></a><span>        </span><a href="TyCoRep.html#substCoVarBndr"><span class="hs-identifier hs-var">substCoVarBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#cloneTyVarBndr"><span class="hs-identifier hs-var">cloneTyVarBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#cloneTyVarBndrs"><span class="hs-identifier hs-var">cloneTyVarBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-107"></a><span>        </span><a href="TyCoRep.html#substTyVar"><span class="hs-identifier hs-var">substTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyVars"><span class="hs-identifier hs-var">substTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-108"></a><span>        </span><a href="TyCoRep.html#substForAllCoBndr"><span class="hs-identifier hs-var">substForAllCoBndr</span></a><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>        </span><a href="TyCoRep.html#substTyVarBndrCallback"><span class="hs-identifier hs-var">substTyVarBndrCallback</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substForAllCoBndrCallback"><span class="hs-identifier hs-var">substForAllCoBndrCallback</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>        </span><a href="TyCoRep.html#substCoVarBndrCallback"><span class="hs-identifier hs-var">substCoVarBndrCallback</span></a><span class="hs-special">,</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span>        </span><span class="hs-comment">-- * Tidying type related things up for printing</span><span>
</span><a name="line-113"></a><span>        </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span class="hs-special">,</span><span>      </span><a href="TyCoRep.html#tidyTypes"><span class="hs-identifier hs-var">tidyTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-114"></a><span>        </span><a href="TyCoRep.html#tidyOpenType"><span class="hs-identifier hs-var">tidyOpenType</span></a><span class="hs-special">,</span><span>  </span><a href="TyCoRep.html#tidyOpenTypes"><span class="hs-identifier hs-var">tidyOpenTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-115"></a><span>        </span><a href="TyCoRep.html#tidyOpenKind"><span class="hs-identifier hs-var">tidyOpenKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-116"></a><span>        </span><a href="TyCoRep.html#tidyTyCoVarBndr"><span class="hs-identifier hs-var">tidyTyCoVarBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tidyTyCoVarBndrs"><span class="hs-identifier hs-var">tidyTyCoVarBndrs</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tidyFreeTyCoVars"><span class="hs-identifier hs-var">tidyFreeTyCoVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-117"></a><span>        </span><a href="TyCoRep.html#tidyOpenTyCoVar"><span class="hs-identifier hs-var">tidyOpenTyCoVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tidyOpenTyCoVars"><span class="hs-identifier hs-var">tidyOpenTyCoVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-118"></a><span>        </span><a href="TyCoRep.html#tidyTyVarOcc"><span class="hs-identifier hs-var">tidyTyVarOcc</span></a><span class="hs-special">,</span><span>
</span><a name="line-119"></a><span>        </span><a href="TyCoRep.html#tidyTopType"><span class="hs-identifier hs-var">tidyTopType</span></a><span class="hs-special">,</span><span>
</span><a name="line-120"></a><span>        </span><a href="TyCoRep.html#tidyKind"><span class="hs-identifier hs-var">tidyKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-121"></a><span>        </span><a href="TyCoRep.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tidyCos"><span class="hs-identifier hs-var">tidyCos</span></a><span>
</span><a name="line-122"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span class="hs-special">(</span><span> </span><a href="DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a><span>
</span><a name="line-127"></a><span>                              </span><span class="hs-special">,</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#eqSpecTyVar"><span class="hs-identifier hs-var">eqSpecTyVar</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span class="hs-special">(</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isCoercionTy"><span class="hs-identifier hs-var">isCoercionTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span>
</span><a name="line-129"></a><span>                          </span><span class="hs-special">,</span><span> </span><a href="Type.html#partitionInvisibles"><span class="hs-identifier hs-var">partitionInvisibles</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>   </span><span class="hs-comment">-- Transitively pulls in a LOT of stuff, better to break the loop</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span>
</span><a name="line-133"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="ConLike.html"><span class="hs-identifier">ConLike</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-comment">-- friends:</span><span>
</span><a name="line-136"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-137"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-138"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-139"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="OccName.html#varName"><span class="hs-identifier hs-var">varName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-141"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-142"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-143"></a><span class="hs-keyword">import</span><span> </span><a href="CoAxiom.html"><span class="hs-identifier">CoAxiom</span></a><span>
</span><a name="line-144"></a><span class="hs-keyword">import</span><span> </span><a href="FV.html"><span class="hs-identifier">FV</span></a><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-comment">-- others</span><span>
</span><a name="line-147"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>
</span><a name="line-148"></a><span class="hs-keyword">import</span><span> </span><a href="Binary.html"><span class="hs-identifier">Binary</span></a><span>
</span><a name="line-149"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-150"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-151"></a><span class="hs-keyword">import</span><span> </span><a href="StaticFlags.html"><span class="hs-identifier">StaticFlags</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="StaticFlags.html#opt_PprStyle_Debug"><span class="hs-identifier hs-var">opt_PprStyle_Debug</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-153"></a><span class="hs-keyword">import</span><span> </span><a href="Pair.html"><span class="hs-identifier">Pair</span></a><span>
</span><a name="line-154"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-155"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span>
</span><a name="line-156"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-157"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-comment">-- libraries</span><span>
</span><a name="line-160"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Data.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Data</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Data</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span>
</span><a name="line-162"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- for CoercionHole</span><span>
</span><a name="line-163"></a><span class="hs-cpp">#if MIN_VERSION_GLASGOW_HASKELL(7,10,2,0)</span><span>
</span><a name="line-164"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">Stack</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#CallStack"><span class="hs-identifier hs-type">CallStack</span></a><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
\subsection{The data type}
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span class="hs-comment">-- | The key representation of types within the compiler</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-comment">-- If you edit this type, you may need to update the GHC formalism</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- See Note [GHC Formalism] in coreSyn/CoreLint.hs</span><span>
</span><a name="line-179"></a><span class="hs-keyword">data</span><span> </span><a name="Type"><a href="TyCoRep.html#Type"><span class="hs-identifier">Type</span></a></a><span>
</span><a name="line-180"></a><span>  </span><span class="hs-comment">-- See Note [Non-trivial definitional equality]</span><span>
</span><a name="line-181"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TyVarTy"><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier">TyVarTy</span></a></a><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-comment">-- ^ Vanilla type or kind variable (*never* a coercion variable)</span><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AppTy"><a href="TyCoRep.html#AppTy"><span class="hs-identifier">AppTy</span></a></a><span>         </span><span class="hs-comment">-- See Note [AppTy rep]</span><span>
</span><a name="line-184"></a><span>        </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-185"></a><span>        </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>            </span><span class="hs-comment">-- ^ Type application to something other than a 'TyCon'. Parameters:</span><span>
</span><a name="line-186"></a><span>                        </span><span class="hs-comment">--</span><span>
</span><a name="line-187"></a><span>                        </span><span class="hs-comment">--  1) Function: must /not/ be a 'TyConApp',</span><span>
</span><a name="line-188"></a><span>                        </span><span class="hs-comment">--     must be another 'AppTy', or 'TyVarTy'</span><span>
</span><a name="line-189"></a><span>                        </span><span class="hs-comment">--</span><span>
</span><a name="line-190"></a><span>                        </span><span class="hs-comment">--  2) Argument type</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TyConApp"><a href="TyCoRep.html#TyConApp"><span class="hs-identifier">TyConApp</span></a></a><span>      </span><span class="hs-comment">-- See Note [AppTy rep]</span><span>
</span><a name="line-193"></a><span>        </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-194"></a><span>        </span><span class="hs-special">[</span><a href="TyCoRep.html#KindOrType"><span class="hs-identifier hs-type">KindOrType</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ Application of a 'TyCon', including newtypes /and/ synonyms.</span><span>
</span><a name="line-195"></a><span>                        </span><span class="hs-comment">-- Invariant: saturated applications of 'FunTyCon' must</span><span>
</span><a name="line-196"></a><span>                        </span><span class="hs-comment">-- use 'FunTy' and saturated synonyms must use their own</span><span>
</span><a name="line-197"></a><span>                        </span><span class="hs-comment">-- constructors. However, /unsaturated/ 'FunTyCon's</span><span>
</span><a name="line-198"></a><span>                        </span><span class="hs-comment">-- do appear as 'TyConApp's.</span><span>
</span><a name="line-199"></a><span>                        </span><span class="hs-comment">-- Parameters:</span><span>
</span><a name="line-200"></a><span>                        </span><span class="hs-comment">--</span><span>
</span><a name="line-201"></a><span>                        </span><span class="hs-comment">-- 1) Type constructor being applied to.</span><span>
</span><a name="line-202"></a><span>                        </span><span class="hs-comment">--</span><span>
</span><a name="line-203"></a><span>                        </span><span class="hs-comment">-- 2) Type arguments. Might not have enough type arguments</span><span>
</span><a name="line-204"></a><span>                        </span><span class="hs-comment">--    here to saturate the constructor.</span><span>
</span><a name="line-205"></a><span>                        </span><span class="hs-comment">--    Even type synonyms are not necessarily saturated;</span><span>
</span><a name="line-206"></a><span>                        </span><span class="hs-comment">--    for example unsaturated type synonyms</span><span>
</span><a name="line-207"></a><span>                        </span><span class="hs-comment">--    can appear as the right hand side of a type synonym.</span><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ForAllTy"><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier">ForAllTy</span></a></a><span>
</span><a name="line-210"></a><span>        </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span>
</span><a name="line-211"></a><span>        </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>            </span><span class="hs-comment">-- ^ A &#928; type.</span><span>
</span><a name="line-212"></a><span>                        </span><span class="hs-comment">-- This includes arrow types, constructed with</span><span>
</span><a name="line-213"></a><span>                        </span><span class="hs-comment">-- @ForAllTy (Anon ...)@. See also Note [TyBinder].</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LitTy"><a href="TyCoRep.html#LitTy"><span class="hs-identifier">LitTy</span></a></a><span> </span><a href="TyCoRep.html#TyLit"><span class="hs-identifier hs-type">TyLit</span></a><span>     </span><span class="hs-comment">-- ^ Type literals are similar to type constructors.</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CastTy"><a href="TyCoRep.html#CastTy"><span class="hs-identifier">CastTy</span></a></a><span>
</span><a name="line-218"></a><span>        </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-219"></a><span>        </span><a href="TyCoRep.html#KindCoercion"><span class="hs-identifier hs-type">KindCoercion</span></a><span>  </span><span class="hs-comment">-- ^ A kind cast. The coercion is always nominal.</span><span>
</span><a name="line-220"></a><span>                      </span><span class="hs-comment">-- INVARIANT: The cast is never refl.</span><span>
</span><a name="line-221"></a><span>                      </span><span class="hs-comment">-- INVARIANT: The cast is &quot;pushed down&quot; as far as it</span><span>
</span><a name="line-222"></a><span>                      </span><span class="hs-comment">-- can go. See Note [Pushing down casts]</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoercionTy"><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier">CoercionTy</span></a></a><span>
</span><a name="line-225"></a><span>        </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>    </span><span class="hs-comment">-- ^ Injection of a Coercion into a type</span><span>
</span><a name="line-226"></a><span>                    </span><span class="hs-comment">-- This should only ever be used in the RHS of an AppTy,</span><span>
</span><a name="line-227"></a><span>                    </span><span class="hs-comment">-- in the list of a TyConApp, when applying a promoted</span><span>
</span><a name="line-228"></a><span>                    </span><span class="hs-comment">-- GADT data constructor</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Data.html#Data"><span class="hs-identifier hs-type">Data</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Data</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Data</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Typeable</span></a><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-comment">-- NOTE:  Other parts of the code assume that type literals do not contain</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- types or type variables.</span><span>
</span><a name="line-235"></a><span class="hs-keyword">data</span><span> </span><a name="TyLit"><a href="TyCoRep.html#TyLit"><span class="hs-identifier">TyLit</span></a></a><span>
</span><a name="line-236"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NumTyLit"><a href="TyCoRep.html#NumTyLit"><span class="hs-identifier">NumTyLit</span></a></a><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-237"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StrTyLit"><a href="TyCoRep.html#StrTyLit"><span class="hs-identifier">StrTyLit</span></a></a><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-238"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Data.html#Data"><span class="hs-identifier hs-type">Data</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Data</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Data</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Typeable</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span class="hs-comment">-- | A 'TyBinder' represents an argument to a function. TyBinders can be dependent</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- ('Named') or nondependent ('Anon'). They may also be visible or not.</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- See also Note [TyBinder]</span><span>
</span><a name="line-243"></a><span class="hs-keyword">data</span><span> </span><a name="TyBinder"><a href="TyCoRep.html#TyBinder"><span class="hs-identifier">TyBinder</span></a></a><span>
</span><a name="line-244"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Named"><a href="TyCoRep.html#Named"><span class="hs-identifier">Named</span></a></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><a href="TyCoRep.html#VisibilityFlag"><span class="hs-identifier hs-type">VisibilityFlag</span></a><span>  </span><span class="hs-comment">-- Always a TyVar (not CoVar or Id)</span><span>
</span><a name="line-245"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Anon"><a href="TyCoRep.html#Anon"><span class="hs-identifier">Anon</span></a></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>   </span><span class="hs-comment">-- Visibility is determined by the type (Constraint vs. *)</span><span>
</span><a name="line-246"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Data</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Typeable</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Data.html#Data"><span class="hs-identifier hs-type">Data</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Data</span></a><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span class="hs-comment">-- | Is something required to appear in source Haskell ('Visible'),</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- permitted by request ('Specified') (visible type application), or</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- prohibited entirely from appearing in source Haskell ('Invisible')?</span><span>
</span><a name="line-251"></a><span class="hs-comment">-- Examples in Note [VisibilityFlag]</span><span>
</span><a name="line-252"></a><span class="hs-keyword">data</span><span> </span><a name="VisibilityFlag"><a href="TyCoRep.html#VisibilityFlag"><span class="hs-identifier">VisibilityFlag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Visible"><a href="TyCoRep.html#Visible"><span class="hs-identifier">Visible</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Specified"><a href="TyCoRep.html#Specified"><span class="hs-identifier">Specified</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Invisible"><a href="TyCoRep.html#Invisible"><span class="hs-identifier">Invisible</span></a></a><span>
</span><a name="line-253"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Data</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Typeable</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Data.html#Data"><span class="hs-identifier hs-type">Data</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Data</span></a><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-comment">-- | Do these denote the same level of visibility? Except that</span><span>
</span><a name="line-256"></a><span class="hs-comment">-- 'Specified' and 'Invisible' are considered the same. Used</span><span>
</span><a name="line-257"></a><span class="hs-comment">-- for printing.</span><span>
</span><a name="line-258"></a><span class="hs-identifier">sameVis</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#VisibilityFlag"><span class="hs-identifier hs-type">VisibilityFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#VisibilityFlag"><span class="hs-identifier hs-type">VisibilityFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-259"></a><a name="sameVis"><a href="TyCoRep.html#sameVis"><span class="hs-identifier">sameVis</span></a></a><span> </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">Visible</span></a><span> </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">Visible</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-260"></a><span class="hs-identifier">sameVis</span><span> </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">Visible</span></a><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-261"></a><span class="hs-identifier">sameVis</span><span> </span><span class="hs-identifier">_</span><span>       </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">Visible</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-262"></a><span class="hs-identifier">sameVis</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="TyCoRep.html#VisibilityFlag"><span class="hs-identifier hs-type">VisibilityFlag</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-265"></a><span>  </span><a name="local-1912728500"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-1627604645"><a href="#local-1627604645"><span class="hs-identifier">bh</span></a></a><span> </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">Visible</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-1627604645"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-266"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-1627604646"><a href="#local-1627604646"><span class="hs-identifier">bh</span></a></a><span> </span><a href="TyCoRep.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-1627604646"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-267"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-1627604647"><a href="#local-1627604647"><span class="hs-identifier">bh</span></a></a><span> </span><a href="TyCoRep.html#Invisible"><span class="hs-identifier hs-var">Invisible</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-1627604647"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span>  </span><a name="local-1912728502"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-1627604648"><a href="#local-1627604648"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-270"></a><span>    </span><a name="local-1627604649"><a href="#local-1627604649"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a><span> </span><a href="#local-1627604648"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-271"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627604649"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-272"></a><span>      </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">Visible</span></a><span>
</span><a name="line-273"></a><span>      </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="TyCoRep.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span>
</span><a name="line-274"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="TyCoRep.html#Invisible"><span class="hs-identifier hs-var">Invisible</span></a><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-keyword">type</span><span> </span><a name="KindOrType"><a href="TyCoRep.html#KindOrType"><span class="hs-identifier">KindOrType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-comment">-- See Note [Arguments to type constructors]</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-comment">-- | The key type representing kinds in the compiler.</span><span>
</span><a name="line-279"></a><span class="hs-keyword">type</span><span> </span><a name="Kind"><a href="TyCoRep.html#Kind"><span class="hs-identifier">Kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-comment">{-
Note [TyBinder]
~~~~~~~~~~~~~~~
This represents the type of binders -- that is, the type of an argument
to a Pi-type. GHC Core currently supports two different Pi-types:
a non-dependent function, written with -&gt;, and a dependent compile-time-only
polytype, written with forall. Both Pi-types classify terms/types that
take an argument. In other words, if `x` is either a function or a polytype,
`x arg` makes sense (for an appropriate `arg`). It is thus often convenient
to group Pi-types together. This is ForAllTy.

The two constructors for TyBinder sort out the two different possibilities.
`Named` builds a polytype, while `Anon` builds an ordinary function.
(ForAllTy (Anon arg) res used to be called FunTy arg res.)

Note [The kind invariant]
~~~~~~~~~~~~~~~~~~~~~~~~~
The kinds
   #          UnliftedTypeKind
   OpenKind   super-kind of *, #

can never appear under an arrow or type constructor in a kind; they
can only be at the top level of a kind.  It follows that primitive TyCons,
which have a naughty pseudo-kind
   State# :: * -&gt; #
must always be saturated, so that we can never get a type whose kind
has a UnliftedTypeKind or ArgTypeKind underneath an arrow.

Nor can we abstract over a type variable with any of these kinds.

    k :: = kk | # | ArgKind | (#) | OpenKind
    kk :: = * | kk -&gt; kk | T kk1 ... kkn

So a type variable can only be abstracted kk.

Note [Arguments to type constructors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Because of kind polymorphism, in addition to type application we now
have kind instantiation. We reuse the same notations to do so.

For example:

  Just (* -&gt; *) Maybe
  Right * Nat Zero

are represented by:

  TyConApp (PromotedDataCon Just) [* -&gt; *, Maybe]
  TyConApp (PromotedDataCon Right) [*, Nat, (PromotedDataCon Zero)]

Important note: Nat is used as a *kind* and not as a type. This can be
confusing, since type-level Nat and kind-level Nat are identical. We
use the kind of (PromotedDataCon Right) to know if its arguments are
kinds or types.

This kind instantiation only happens in TyConApp currently.

Note [Pushing down casts]
~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have (a :: k1 -&gt; *), (b :: k1), and (co :: * ~ q).
The type (a b |&gt; co) is `eqType` to ((a |&gt; co') b), where
co' = (-&gt;) &lt;k1&gt; co. Thus, to make this visible to functions
that inspect types, we always push down coercions, preferring
the second form. Note that this also applies to TyConApps!

Note [Non-trivial definitional equality]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Is Int |&gt; &lt;*&gt; the same as Int? YES! In order to reduce headaches,
we decide that any reflexive casts in types are just ignored. More
generally, the `eqType` function, which defines Core's type equality
relation, ignores casts and coercion arguments, as long as the
two types have the same kind. This allows us to be a little sloppier
in keeping track of coercions, which is a good thing. It also means
that eqType does not depend on eqCoercion, which is also a good thing.

Note [VisibilityFlag]
~~~~~~~~~~~~~~~~~~~~~
All named binders are equipped with a visibility flag, which says
whether or not arguments for this binder should be visible (explicit)
in source Haskell. Historically, all named binders (that is, polytype
binders) have been Invisible. But now it's more complicated.

Invisible:
 Argument does not ever appear in source Haskell. With visible type
 application, only GHC-generated polytypes have Invisible binders.
 This exactly corresponds to &quot;generalized&quot; variables from the
 Visible Type Applications paper (ESOP'16).

 Example: f x = x
 `f` will be inferred to have type `forall a. a -&gt; a`, where `a` is
 Invisible. Note that there is no type annotation for `f`.

 Printing: With -fprint-explicit-foralls, Invisible binders are written
 in braces. Otherwise, they are printed like Specified binders.

Specified:
 The argument for this binder may appear in source Haskell only with
 visible type application. Otherwise, it is omitted.

 Example: id :: forall a. a -&gt; a
 `a` is a Specified binder, because you can say `id @Int` in source Haskell.

 Example: const :: a -&gt; b -&gt; a
 Both `a` and `b` are Specified binders, even though they are not bound
 by an explicit forall.

 Printing: a list of Specified binders are put between `forall` and `.`:
 const :: forall a b. a -&gt; b -&gt; a

Visible:
 The argument must be given. Visible binders come up only with TypeInType.

 Example: data Proxy k (a :: k) = P
 The kind of Proxy is forall k -&gt; k -&gt; *, where k is a Visible binder.

 Printing: As in the example above, Visible binders are put between `forall`
 and `-&gt;`. This syntax is not parsed (yet), however.

-------------------------------------
                Note [PredTy]
-}</span><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span class="hs-comment">-- | A type of the form @p@ of kind @Constraint@ represents a value whose type is</span><span>
</span><a name="line-404"></a><span class="hs-comment">-- the Haskell predicate @p@, where a predicate is what occurs before</span><span>
</span><a name="line-405"></a><span class="hs-comment">-- the @=&gt;@ in a Haskell type.</span><span>
</span><a name="line-406"></a><span class="hs-comment">--</span><span>
</span><a name="line-407"></a><span class="hs-comment">-- We use 'PredType' as documentation to mark those types that we guarantee to have</span><span>
</span><a name="line-408"></a><span class="hs-comment">-- this kind.</span><span>
</span><a name="line-409"></a><span class="hs-comment">--</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- It can be expanded into its representation, but:</span><span>
</span><a name="line-411"></a><span class="hs-comment">--</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- * The type checker must treat it as opaque</span><span>
</span><a name="line-413"></a><span class="hs-comment">--</span><span>
</span><a name="line-414"></a><span class="hs-comment">-- * The rest of the compiler treats it as transparent</span><span>
</span><a name="line-415"></a><span class="hs-comment">--</span><span>
</span><a name="line-416"></a><span class="hs-comment">-- Consider these examples:</span><span>
</span><a name="line-417"></a><span class="hs-comment">--</span><span>
</span><a name="line-418"></a><span class="hs-comment">-- &gt; f :: (Eq a) =&gt; a -&gt; Int</span><span>
</span><a name="line-419"></a><span class="hs-comment">-- &gt; g :: (?x :: Int -&gt; Int) =&gt; a -&gt; Int</span><span>
</span><a name="line-420"></a><span class="hs-comment">-- &gt; h :: (r\l) =&gt; {r} =&gt; {l::Int | r}</span><span>
</span><a name="line-421"></a><span class="hs-comment">--</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- Here the @Eq a@ and @?x :: Int -&gt; Int@ and @r\l@ are all called \&quot;predicates\&quot;</span><span>
</span><a name="line-423"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">PredType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span class="hs-comment">-- | A collection of 'PredType's</span><span>
</span><a name="line-426"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">ThetaType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">PredType</span><span class="hs-special">]</span><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span class="hs-comment">{-
(We don't support TREX records yet, but the setup is designed
to expand to allow them.)

A Haskell qualified type, such as that for f,g,h above, is
represented using
        * a FunTy for the double arrow
        * with a type of kind Constraint as the function argument

The predicate really does turn into a real extra argument to the
function.  If the argument has type (p :: Constraint) then the predicate p is
represented by evidence of type p.

%************************************************************************
%*                                                                      *
            Simple constructors
%*                                                                      *
%************************************************************************

These functions are here so that they can be used by TysPrim,
which in turn is imported by Type
-}</span><span>
</span><a name="line-450"></a><span>
</span><a name="line-451"></a><span class="hs-comment">-- named with &quot;Only&quot; to prevent naive use of mkTyVarTy</span><span>
</span><a name="line-452"></a><span class="hs-identifier">mkTyVarTy</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyVar</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-453"></a><span class="hs-identifier">mkTyVarTy</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">dcolon</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyVarKind</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>                  </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><span class="hs-identifier">v</span><span>
</span><a name="line-455"></a><span>
</span><a name="line-456"></a><span class="hs-identifier">mkTyVarTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">TyVar</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Type</span><span class="hs-special">]</span><span>
</span><a name="line-457"></a><span class="hs-identifier">mkTyVarTys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">mkTyVarTy</span><span> </span><span class="hs-comment">-- a common use of mkTyVarTy</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mkFunTy</span><span class="hs-special">`</span><span>      </span><span class="hs-comment">-- Associates to the right</span><span>
</span><a name="line-460"></a><span class="hs-comment">-- | Make an arrow type</span><span>
</span><a name="line-461"></a><span class="hs-identifier">mkFunTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-462"></a><span class="hs-identifier">mkFunTy</span><span> </span><span class="hs-identifier">arg</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">res</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ForAllTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Anon</span><span> </span><span class="hs-identifier">arg</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">res</span><span>
</span><a name="line-463"></a><span>
</span><a name="line-464"></a><span class="hs-comment">-- | Make nested arrow types</span><span>
</span><a name="line-465"></a><span class="hs-identifier">mkFunTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-466"></a><span class="hs-identifier">mkFunTys</span><span> </span><span class="hs-identifier">tys</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foldr</span><span> </span><span class="hs-identifier">mkFunTy</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">ty</span></a><span> </span><span class="hs-identifier">tys</span><span>
</span><a name="line-467"></a><span>
</span><a name="line-468"></a><span class="hs-comment">-- | Wraps foralls over the type using the provided 'TyVar's from left to right</span><span>
</span><a name="line-469"></a><span class="hs-identifier">mkForAllTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">TyBinder</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-470"></a><span class="hs-identifier">mkForAllTys</span><span> </span><span class="hs-identifier">tyvars</span><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foldr</span><span> </span><span class="hs-identifier">ForAllTy</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">ty</span></a><span> </span><span class="hs-identifier">tyvars</span><span>
</span><a name="line-471"></a><span>
</span><a name="line-472"></a><span class="hs-comment">-- | Does this type classify a core Coercion?</span><span>
</span><a name="line-473"></a><span class="hs-identifier">isCoercionType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-474"></a><span class="hs-identifier">isCoercionType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyConApp</span><span> </span><span class="hs-identifier">tc</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">)</span><span>
</span><a name="line-475"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="isCoercionType"><a href="TyCoRep.html#isCoercionType"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">hasKey</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">eqPrimTyConKey</span><span class="hs-special">)</span><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tc</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">hasKey</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">eqReprPrimTyConKey</span><span class="hs-special">)</span><span>
</span><a name="line-476"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">length</span><span> </span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-477"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">True</span></a><span>
</span><a name="line-478"></a><span class="hs-identifier">isCoercionType</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-479"></a><span>
</span><a name="line-480"></a><span class="hs-identifier">binderType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyBinder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-481"></a><span class="hs-identifier">binderType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Named</span><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">_</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varType</span><span> </span><span class="hs-identifier">v</span><span>
</span><a name="line-482"></a><a name="binderType"><a href="TyCoRep.html#binderType"><span class="hs-identifier">binderType</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Anon</span></a><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ty</span><span>
</span><a name="line-483"></a><span>
</span><a name="line-484"></a><span class="hs-comment">-- | Remove the binder's variable from the set, if the binder has</span><span>
</span><a name="line-485"></a><span class="hs-comment">-- a variable.</span><span>
</span><a name="line-486"></a><span class="hs-identifier">delBinderVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">VarSet</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyBinder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">VarSet</span><span>
</span><a name="line-487"></a><span class="hs-identifier">delBinderVar</span><span> </span><span class="hs-identifier">vars</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Named</span><span> </span><span class="hs-identifier">tv</span><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">_</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">vars</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">delVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tv</span><span>
</span><a name="line-488"></a><a name="delBinderVar"><a href="TyCoRep.html#delBinderVar"><span class="hs-identifier">delBinderVar</span></a></a><span> </span><a name="local-1627603756"><a href="#local-1627603756"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Anon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627603756"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span class="hs-comment">-- | Remove the binder's variable from the set, if the binder has</span><span>
</span><a name="line-491"></a><span class="hs-comment">-- a variable.</span><span>
</span><a name="line-492"></a><span class="hs-identifier">delBinderVarFV</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyBinder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FV</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FV</span><span>
</span><a name="line-493"></a><span class="hs-identifier">delBinderVarFV</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Named</span><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">tv</span></a><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">_</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">vars</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">delFV</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-identifier">vars</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-494"></a><a name="delBinderVarFV"><a href="TyCoRep.html#delBinderVarFV"><span class="hs-identifier">delBinderVarFV</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Anon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><a name="local-1627603760"><a href="#local-1627603760"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-1627603761"><a href="#local-1627603761"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603762"><a href="#local-1627603762"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603763"><a href="#local-1627603763"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#delFV"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><a href="#local-1627603762"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span class="hs-comment">-- | Does this binder bind an invisible argument?</span><span>
</span><a name="line-497"></a><span class="hs-identifier">isInvisibleBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyBinder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-498"></a><span class="hs-identifier">isInvisibleBinder</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Named</span><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">_</span></a><span> </span><span class="hs-identifier">vis</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">vis</span><span> </span><span class="hs-operator">/=</span><span> </span><span class="hs-identifier">Visible</span><span>
</span><a name="line-499"></a><a name="isInvisibleBinder"><a href="TyCoRep.html#isInvisibleBinder"><span class="hs-identifier">isInvisibleBinder</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Anon</span></a><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isPredTy</span><span> </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-500"></a><span>
</span><a name="line-501"></a><span class="hs-comment">-- | Does this binder bind a visible argument?</span><span>
</span><a name="line-502"></a><span class="hs-identifier">isVisibleBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyBinder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-503"></a><span class="hs-identifier">isVisibleBinder</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">not</span><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-operator hs-type">.</span></a><span> </span><span class="hs-identifier">isInvisibleBinder</span><span>
</span><a name="line-504"></a><span>
</span><a name="line-505"></a><span class="hs-identifier">isNamedBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyBinder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-506"></a><span class="hs-identifier">isNamedBinder</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Named</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-507"></a><a name="isNamedBinder"><a href="TyCoRep.html#isNamedBinder"><span class="hs-identifier">isNamedBinder</span></a></a><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-508"></a><span>
</span><a name="line-509"></a><span class="hs-identifier">isAnonBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyBinder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-510"></a><span class="hs-identifier">isAnonBinder</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Anon</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-511"></a><a name="isAnonBinder"><a href="TyCoRep.html#isAnonBinder"><span class="hs-identifier">isAnonBinder</span></a></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-512"></a><span>
</span><a name="line-513"></a><span class="hs-comment">-- | Create the plain type constructor type which has been applied to no type arguments at all.</span><span>
</span><a name="line-514"></a><span class="hs-identifier">mkTyConTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-515"></a><span class="hs-identifier">mkTyConTy</span><span> </span><span class="hs-identifier">tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TyConApp</span><span> </span><span class="hs-identifier">tycon</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-516"></a><span>
</span><a name="line-517"></a><span class="hs-comment">{-
Some basic functions, put here to break loops eg with the pretty printer
-}</span><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-comment">-- | This version considers Constraint to be distinct from *.</span><span>
</span><a name="line-522"></a><span class="hs-identifier">isLiftedTypeKind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Kind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-523"></a><span class="hs-identifier">isLiftedTypeKind</span><span> </span><span class="hs-identifier">ki</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">ki'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">coreView</span><span> </span><span class="hs-identifier">ki</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isLiftedTypeKind</span><span> </span><span class="hs-identifier">ki'</span><span>
</span><a name="line-524"></a><a name="isLiftedTypeKind"><a href="TyCoRep.html#isLiftedTypeKind"><span class="hs-identifier">isLiftedTypeKind</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyConApp</span><span> </span><a name="local-1627603772"><a href="#local-1627603772"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-identifier">TyConApp</span><span> </span><span class="hs-identifier">ptr_rep</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">tc</span><span>      </span><span class="hs-special">`</span><span class="hs-identifier">hasKey</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tYPETyConKey</span><span>
</span><a name="line-526"></a><span>  </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">ptr_rep</span><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">ptrRepLiftedDataConKey</span><span>
</span><a name="line-527"></a><span class="hs-identifier">isLiftedTypeKind</span><span> </span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">_</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="PrelNames.html#ptrRepLiftedDataConKey"><span class="hs-identifier hs-var">False</span></a><span>
</span><a name="line-528"></a><span>
</span><a name="line-529"></a><span class="hs-identifier">isUnliftedTypeKind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Kind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-530"></a><span class="hs-identifier">isUnliftedTypeKind</span><span> </span><span class="hs-identifier">ki</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">ki'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">coreView</span><span> </span><span class="hs-identifier">ki</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isUnliftedTypeKind</span><span> </span><span class="hs-identifier">ki'</span><span>
</span><a name="line-531"></a><a name="isUnliftedTypeKind"><a href="TyCoRep.html#isUnliftedTypeKind"><span class="hs-identifier">isUnliftedTypeKind</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyConApp</span><span> </span><a name="local-1627603776"><a href="#local-1627603776"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-identifier">TyConApp</span><span> </span><span class="hs-identifier">ptr_rep</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-532"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">tc</span><span>       </span><span class="hs-special">`</span><span class="hs-identifier">hasKey</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tYPETyConKey</span><span>
</span><a name="line-533"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ptr_rep</span><span>  </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">ptrRepLiftedDataConKey</span><span>
</span><a name="line-534"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627603778"><span class="hs-identifier hs-var">False</span></a><span>
</span><a name="line-535"></a><span class="hs-identifier">isUnliftedTypeKind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyConApp</span><span> </span><span class="hs-identifier">tc</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">arg</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-536"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tc</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">hasKey</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tYPETyConKey</span><span> </span><a name="local-1627603779"><a href="#local-1627603779"><span class="hs-operator">&amp;&amp;</span></a></a><span> </span><span class="hs-identifier">isEmptyVarSet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfType</span><span> </span><span class="hs-identifier">arg</span><span class="hs-special">)</span><span>
</span><a name="line-537"></a><span>      </span><span class="hs-comment">-- all other possibilities are unlifted</span><span>
</span><a name="line-538"></a><span class="hs-identifier">isUnliftedTypeKind</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span class="hs-comment">-- | Is this the type 'RuntimeRep'?</span><span>
</span><a name="line-541"></a><span class="hs-identifier">isRuntimeRepTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-542"></a><span class="hs-identifier">isRuntimeRepTy</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">ty'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">coreView</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isRuntimeRepTy</span><span> </span><span class="hs-identifier">ty'</span><span>
</span><a name="line-543"></a><a name="isRuntimeRepTy"><a href="TyCoRep.html#isRuntimeRepTy"><span class="hs-identifier">isRuntimeRepTy</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyConApp</span><span> </span><a name="local-1627603782"><a href="#local-1627603782"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">hasKey</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">runtimeRepTyConKey</span><span>
</span><a name="line-544"></a><span class="hs-identifier">isRuntimeRepTy</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">False</span></a><span>
</span><a name="line-545"></a><span>
</span><a name="line-546"></a><span class="hs-comment">-- | Is this a type of kind RuntimeRep? (e.g. PtrRep)</span><span>
</span><a name="line-547"></a><span class="hs-identifier">isRuntimeRepKindedTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-548"></a><span class="hs-identifier">isRuntimeRepKindedTy</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isRuntimeRepTy</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">typeKind</span><span>
</span><a name="line-549"></a><span>
</span><a name="line-550"></a><span class="hs-comment">-- | Is a tyvar of type 'RuntimeRep'?</span><span>
</span><a name="line-551"></a><span class="hs-identifier">isRuntimeRepVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-552"></a><span class="hs-identifier">isRuntimeRepVar</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isRuntimeRepTy</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">tyVarKind</span><span>
</span><a name="line-553"></a><span>
</span><a name="line-554"></a><span class="hs-comment">-- | Drops prefix of RuntimeRep constructors in 'TyConApp's. Useful for e.g.</span><span>
</span><a name="line-555"></a><span class="hs-comment">-- dropping 'PtrRep arguments of unboxed tuple TyCon applications:</span><span>
</span><a name="line-556"></a><span class="hs-comment">--</span><span>
</span><a name="line-557"></a><span class="hs-comment">--   dropRuntimeRepArgs [ 'PtrRepLifted, 'PtrRepUnlifted</span><span>
</span><a name="line-558"></a><span class="hs-comment">--                      , String, Int# ] == [String, Int#]</span><span>
</span><a name="line-559"></a><span class="hs-comment">--</span><span>
</span><a name="line-560"></a><span class="hs-identifier">dropRuntimeRepArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Type</span><span class="hs-special">]</span><span>
</span><a name="line-561"></a><span class="hs-identifier">dropRuntimeRepArgs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dropWhile</span><span> </span><span class="hs-identifier">isRuntimeRepKindedTy</span><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Coercions
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-570"></a><span>
</span><a name="line-571"></a><span class="hs-comment">-- | A 'Coercion' is concrete evidence of the equality/convertibility</span><span>
</span><a name="line-572"></a><span class="hs-comment">-- of two types.</span><span>
</span><a name="line-573"></a><span>
</span><a name="line-574"></a><span class="hs-comment">-- If you edit this type, you may need to update the GHC formalism</span><span>
</span><a name="line-575"></a><span class="hs-comment">-- See Note [GHC Formalism] in coreSyn/CoreLint.hs</span><span>
</span><a name="line-576"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">Coercion</span><span>
</span><a name="line-577"></a><span>  </span><span class="hs-comment">-- Each constructor has a &quot;role signature&quot;, indicating the way roles are</span><span>
</span><a name="line-578"></a><span>  </span><span class="hs-comment">-- propagated through coercions.</span><span>
</span><a name="line-579"></a><span>  </span><span class="hs-comment">--    -  P, N, and R stand for coercions of the given role</span><span>
</span><a name="line-580"></a><span>  </span><span class="hs-comment">--    -  e stands for a coercion of a specific unknown role</span><span>
</span><a name="line-581"></a><span>  </span><span class="hs-comment">--           (think &quot;role polymorphism&quot;)</span><span>
</span><a name="line-582"></a><span>  </span><span class="hs-comment">--    -  &quot;e&quot; stands for an explicit role parameter indicating role e.</span><span>
</span><a name="line-583"></a><span>  </span><span class="hs-comment">--    -   _ stands for a parameter that is not a Role or Coercion.</span><span>
</span><a name="line-584"></a><span>
</span><a name="line-585"></a><span>  </span><span class="hs-comment">-- These ones mirror the shape of types</span><span>
</span><a name="line-586"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Refl :: &quot;e&quot; -&gt; _ -&gt; e</span><span>
</span><a name="line-587"></a><span>    </span><span class="hs-identifier">Refl</span><span> </span><span class="hs-identifier">Role</span><span> </span><span class="hs-identifier">Type</span><span>  </span><span class="hs-comment">-- See Note [Refl invariant]</span><span>
</span><a name="line-588"></a><span>          </span><span class="hs-comment">-- Invariant: applications of (Refl T) to a bunch of identity coercions</span><span>
</span><a name="line-589"></a><span>          </span><span class="hs-comment">--            always show up as Refl.</span><span>
</span><a name="line-590"></a><span>          </span><span class="hs-comment">-- For example  (Refl T) (Refl a) (Refl b) shows up as (Refl (T a b)).</span><span>
</span><a name="line-591"></a><span>
</span><a name="line-592"></a><span>          </span><span class="hs-comment">-- Applications of (Refl T) to some coercions, at least one of</span><span>
</span><a name="line-593"></a><span>          </span><span class="hs-comment">-- which is NOT the identity, show up as TyConAppCo.</span><span>
</span><a name="line-594"></a><span>          </span><span class="hs-comment">-- (They may not be fully saturated however.)</span><span>
</span><a name="line-595"></a><span>          </span><span class="hs-comment">-- ConAppCo coercions (like all coercions other than Refl)</span><span>
</span><a name="line-596"></a><span>          </span><span class="hs-comment">-- are NEVER the identity.</span><span>
</span><a name="line-597"></a><span>
</span><a name="line-598"></a><span>          </span><span class="hs-comment">-- Use (Refl Representational _), not (SubCo (Refl Nominal _))</span><span>
</span><a name="line-599"></a><span>
</span><a name="line-600"></a><span>  </span><span class="hs-comment">-- These ones simply lift the correspondingly-named</span><span>
</span><a name="line-601"></a><span>  </span><span class="hs-comment">-- Type constructors into Coercions</span><span>
</span><a name="line-602"></a><span>
</span><a name="line-603"></a><span>  </span><span class="hs-comment">-- TyConAppCo :: &quot;e&quot; -&gt; _ -&gt; ?? -&gt; e</span><span>
</span><a name="line-604"></a><span>  </span><span class="hs-comment">-- See Note [TyConAppCo roles]</span><span>
</span><a name="line-605"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">TyConAppCo</span><span> </span><span class="hs-identifier">Role</span><span> </span><span class="hs-identifier">TyCon</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Coercion</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- lift TyConApp</span><span>
</span><a name="line-606"></a><span>               </span><span class="hs-comment">-- The TyCon is never a synonym;</span><span>
</span><a name="line-607"></a><span>               </span><span class="hs-comment">-- we expand synonyms eagerly</span><span>
</span><a name="line-608"></a><span>               </span><span class="hs-comment">-- But it can be a type function</span><span>
</span><a name="line-609"></a><span>
</span><a name="line-610"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">AppCo</span><span> </span><span class="hs-identifier">Coercion</span><span> </span><span class="hs-identifier">CoercionN</span><span>             </span><span class="hs-comment">-- lift AppTy</span><span>
</span><a name="line-611"></a><span>          </span><span class="hs-comment">-- AppCo :: e -&gt; N -&gt; e</span><span>
</span><a name="line-612"></a><span>
</span><a name="line-613"></a><span>  </span><span class="hs-comment">-- See Note [Forall coercions]</span><span>
</span><a name="line-614"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ForAllCo</span><span> </span><span class="hs-identifier">TyVar</span><span> </span><span class="hs-identifier">KindCoercion</span><span> </span><span class="hs-identifier">Coercion</span><span>
</span><a name="line-615"></a><span>         </span><span class="hs-comment">-- ForAllCo :: _ -&gt; N -&gt; e -&gt; e</span><span>
</span><a name="line-616"></a><span>
</span><a name="line-617"></a><span>  </span><span class="hs-comment">-- These are special</span><span>
</span><a name="line-618"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CoVarCo</span><span> </span><span class="hs-identifier">CoVar</span><span>      </span><span class="hs-comment">-- :: _ -&gt; (N or R)</span><span>
</span><a name="line-619"></a><span>                       </span><span class="hs-comment">-- result role depends on the tycon of the variable's type</span><span>
</span><a name="line-620"></a><span>
</span><a name="line-621"></a><span>    </span><span class="hs-comment">-- AxiomInstCo :: e -&gt; _ -&gt; [N] -&gt; e</span><span>
</span><a name="line-622"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">AxiomInstCo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CoAxiom</span><span> </span><span class="hs-identifier">Branched</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">BranchIndex</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Coercion</span><span class="hs-special">]</span><span>
</span><a name="line-623"></a><span>     </span><span class="hs-comment">-- See also [CoAxiom index]</span><span>
</span><a name="line-624"></a><span>     </span><span class="hs-comment">-- The coercion arguments always *precisely* saturate</span><span>
</span><a name="line-625"></a><span>     </span><span class="hs-comment">-- arity of (that branch of) the CoAxiom. If there are</span><span>
</span><a name="line-626"></a><span>     </span><span class="hs-comment">-- any left over, we use AppCo.</span><span>
</span><a name="line-627"></a><span>     </span><span class="hs-comment">-- See [Coercion axioms applied to coercions]</span><span>
</span><a name="line-628"></a><span>
</span><a name="line-629"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">UnivCo</span><span> </span><span class="hs-identifier">UnivCoProvenance</span><span> </span><span class="hs-identifier">Role</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-630"></a><span>      </span><span class="hs-comment">-- :: _ -&gt; &quot;e&quot; -&gt; _ -&gt; _ -&gt; e</span><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">SymCo</span><span> </span><span class="hs-identifier">Coercion</span><span>             </span><span class="hs-comment">-- :: e -&gt; e</span><span>
</span><a name="line-633"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">TransCo</span><span> </span><span class="hs-identifier">Coercion</span><span> </span><span class="hs-identifier">Coercion</span><span>  </span><span class="hs-comment">-- :: e -&gt; e -&gt; e</span><span>
</span><a name="line-634"></a><span>
</span><a name="line-635"></a><span>    </span><span class="hs-comment">-- The number coercions should match exactly the expectations</span><span>
</span><a name="line-636"></a><span>    </span><span class="hs-comment">-- of the CoAxiomRule (i.e., the rule is fully saturated).</span><span>
</span><a name="line-637"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">AxiomRuleCo</span><span> </span><span class="hs-identifier">CoAxiomRule</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Coercion</span><span class="hs-special">]</span><span>
</span><a name="line-638"></a><span>
</span><a name="line-639"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">NthCo</span><span>  </span><span class="hs-identifier">Int</span><span>         </span><span class="hs-identifier">Coercion</span><span>     </span><span class="hs-comment">-- Zero-indexed; decomposes (T t0 ... tn)</span><span>
</span><a name="line-640"></a><span>    </span><span class="hs-comment">-- :: _ -&gt; e -&gt; ?? (inverse of TyConAppCo, see Note [TyConAppCo roles])</span><span>
</span><a name="line-641"></a><span>    </span><span class="hs-comment">-- Using NthCo on a ForAllCo gives an N coercion always</span><span>
</span><a name="line-642"></a><span>    </span><span class="hs-comment">-- See Note [NthCo and newtypes]</span><span>
</span><a name="line-643"></a><span>
</span><a name="line-644"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">LRCo</span><span>   </span><span class="hs-identifier">LeftOrRight</span><span> </span><span class="hs-identifier">CoercionN</span><span>     </span><span class="hs-comment">-- Decomposes (t_left t_right)</span><span>
</span><a name="line-645"></a><span>    </span><span class="hs-comment">-- :: _ -&gt; N -&gt; N</span><span>
</span><a name="line-646"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">InstCo</span><span> </span><span class="hs-identifier">Coercion</span><span> </span><span class="hs-identifier">CoercionN</span><span>
</span><a name="line-647"></a><span>    </span><span class="hs-comment">-- :: e -&gt; N -&gt; e</span><span>
</span><a name="line-648"></a><span>    </span><span class="hs-comment">-- See Note [InstCo roles]</span><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span>  </span><span class="hs-comment">-- Coherence applies a coercion to the left-hand type of another coercion</span><span>
</span><a name="line-651"></a><span>  </span><span class="hs-comment">-- See Note [Coherence]</span><span>
</span><a name="line-652"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CoherenceCo</span><span> </span><span class="hs-identifier">Coercion</span><span> </span><span class="hs-identifier">KindCoercion</span><span>
</span><a name="line-653"></a><span>     </span><span class="hs-comment">-- :: e -&gt; N -&gt; e</span><span>
</span><a name="line-654"></a><span>
</span><a name="line-655"></a><span>  </span><span class="hs-comment">-- Extract a kind coercion from a (heterogeneous) type coercion</span><span>
</span><a name="line-656"></a><span>  </span><span class="hs-comment">-- NB: all kind coercions are Nominal</span><span>
</span><a name="line-657"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">KindCo</span><span> </span><span class="hs-identifier">Coercion</span><span>
</span><a name="line-658"></a><span>     </span><span class="hs-comment">-- :: e -&gt; N</span><span>
</span><a name="line-659"></a><span>
</span><a name="line-660"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">SubCo</span><span> </span><span class="hs-identifier">CoercionN</span><span>                  </span><span class="hs-comment">-- Turns a ~N into a ~R</span><span>
</span><a name="line-661"></a><span>    </span><span class="hs-comment">-- :: N -&gt; R</span><span>
</span><a name="line-662"></a><span>
</span><a name="line-663"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Data</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-664"></a><span>
</span><a name="line-665"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">CoercionN</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Coercion</span><span>       </span><span class="hs-comment">-- always nominal</span><span>
</span><a name="line-666"></a><span class="hs-keyword">type</span><span> </span><a name="CoercionN"><a href="TyCoRep.html#CoercionN"><span class="hs-identifier">CoercionR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>       </span><span class="hs-comment">-- always representational</span><span>
</span><a name="line-667"></a><span class="hs-keyword">type</span><span> </span><a name="CoercionR"><a href="TyCoRep.html#CoercionR"><span class="hs-identifier">CoercionP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>       </span><span class="hs-comment">-- always phantom</span><span>
</span><a name="line-668"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">KindCoercion</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CoercionN</span><span>   </span><span class="hs-comment">-- always nominal</span><span>
</span><a name="line-669"></a><span>
</span><a name="line-670"></a><span class="hs-comment">-- If you edit this type, you may need to update the GHC formalism</span><span>
</span><a name="line-671"></a><span class="hs-comment">-- See Note [GHC Formalism] in coreSyn/CoreLint.hs</span><span>
</span><a name="line-672"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">LeftOrRight</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CLeft</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CRight</span><span>
</span><a name="line-673"></a><span>                 </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><a name="CRight"><a href="TyCoRep.html#CRight"><span class="hs-identifier">Eq</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Data</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-674"></a><span>
</span><a name="line-675"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Binary</span><span> </span><span class="hs-identifier">LeftOrRight</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-676"></a><span>   </span><span class="hs-identifier">put_</span><span> </span><span class="hs-identifier">bh</span><span> </span><span class="hs-identifier">CLeft</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#LeftOrRight"><span class="hs-identifier hs-type">putByte</span></a><span> </span><span class="hs-identifier">bh</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-677"></a><span>   </span><a name="local-1912728500"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-1627604641"><a href="#local-1627604641"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-identifier">CRight</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-1627604641"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-678"></a><span>
</span><a name="line-679"></a><span>   </span><span class="hs-identifier">get</span><span> </span><span class="hs-identifier">bh</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">h</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getByte</span><span> </span><span class="hs-identifier">bh</span><span>
</span><a name="line-680"></a><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Binary.html#getByte"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-681"></a><span>                   </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">CLeft</span><span>
</span><a name="line-682"></a><span>                   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier">CRight</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-683"></a><span>
</span><a name="line-684"></a><span class="hs-identifier">pickLR</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">LeftOrRight</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-685"></a><span class="hs-identifier">pickLR</span><span> </span><span class="hs-identifier">CLeft</span><span>  </span><span class="hs-special">(</span><a href="TyCoRep.html#LeftOrRight"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">,</span><a href="TyCoRep.html#LeftOrRight"><span class="hs-identifier hs-type">_</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">l</span><span>
</span><a name="line-686"></a><a name="pickLR"><a href="TyCoRep.html#pickLR"><span class="hs-identifier">pickLR</span></a></a><span> </span><span class="hs-identifier">CRight</span><span> </span><span class="hs-special">(</span><a name="local-1627603784"><a href="#local-1627603784"><span class="hs-identifier">_</span></a></a><span class="hs-special">,</span><span class="hs-identifier">r</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627603784"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-687"></a><span>
</span><a name="line-688"></a><span>
</span><a name="line-689"></a><span class="hs-comment">{-
Note [Refl invariant]
~~~~~~~~~~~~~~~~~~~~~
Invariant 1:

Coercions have the following invariant
     Refl is always lifted as far as possible.

You might think that a consequencs is:
     Every identity coercions has Refl at the root

But that's not quite true because of coercion variables.  Consider
     g         where g :: Int~Int
     Left h    where h :: Maybe Int ~ Maybe Int
etc.  So the consequence is only true of coercions that
have no coercion variables.

Note [Coercion axioms applied to coercions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The reason coercion axioms can be applied to coercions and not just
types is to allow for better optimization.  There are some cases where
we need to be able to &quot;push transitivity inside&quot; an axiom in order to
expose further opportunities for optimization.

For example, suppose we have

  C a : t[a] ~ F a
  g   : b ~ c

and we want to optimize

  sym (C b) ; t[g] ; C c

which has the kind

  F b ~ F c

(stopping through t[b] and t[c] along the way).

We'd like to optimize this to just F g -- but how?  The key is
that we need to allow axioms to be instantiated by *coercions*,
not just by types.  Then we can (in certain cases) push
transitivity inside the axiom instantiations, and then react
opposite-polarity instantiations of the same axiom.  In this
case, e.g., we match t[g] against the LHS of (C c)'s kind, to
obtain the substitution  a |-&gt; g  (note this operation is sort
of the dual of lifting!) and hence end up with

  C g : t[b] ~ F c

which indeed has the same kind as  t[g] ; C c.

Now we have

  sym (C b) ; C g

which can be optimized to F g.

Note [CoAxiom index]
~~~~~~~~~~~~~~~~~~~~
A CoAxiom has 1 or more branches. Each branch has contains a list
of the free type variables in that branch, the LHS type patterns,
and the RHS type for that branch. When we apply an axiom to a list
of coercions, we must choose which branch of the axiom we wish to
use, as the different branches may have different numbers of free
type variables. (The number of type patterns is always the same
among branches, but that doesn't quite concern us here.)

The Int in the AxiomInstCo constructor is the 0-indexed number
of the chosen branch.

Note [Forall coercions]
~~~~~~~~~~~~~~~~~~~~~~~
Constructing coercions between forall-types can be a bit tricky,
because the kinds of the bound tyvars can be different.

The typing rule is:


  kind_co : k1 ~ k2
  tv1:k1 |- co : t1 ~ t2
  -------------------------------------------------------------------
  ForAllCo tv1 kind_co co : all tv1:k1. t1  ~
                            all tv1:k2. (t2[tv1 |-&gt; tv1 |&gt; sym kind_co])

First, the TyVar stored in a ForAllCo is really an optimisation: this field
should be a Name, as its kind is redundant. Thinking of the field as a Name
is helpful in understanding what a ForAllCo means.

The idea is that kind_co gives the two kinds of the tyvar. See how, in the
conclusion, tv1 is assigned kind k1 on the left but kind k2 on the right.

Of course, a type variable can't have different kinds at the same time. So,
we arbitrarily prefer the first kind when using tv1 in the inner coercion
co, which shows that t1 equals t2.

The last wrinkle is that we need to fix the kinds in the conclusion. In
t2, tv1 is assumed to have kind k1, but it has kind k2 in the conclusion of
the rule. So we do a kind-fixing substitution, replacing (tv1:k1) with
(tv1:k2) |&gt; sym kind_co. This substitution is slightly bizarre, because it
mentions the same name with different kinds, but it *is* well-kinded, noting
that `(tv1:k2) |&gt; sym kind_co` has kind k1.

This all really would work storing just a Name in the ForAllCo. But we can't
add Names to, e.g., VarSets, and there generally is just an impedence mismatch
in a bunch of places. So we use tv1. When we need tv2, we can use
setTyVarKind.

Note [Coherence]
~~~~~~~~~~~~~~~~
The Coherence typing rule is thus:

  g1 : s ~ t    s : k1    g2 : k1 ~ k2
  ------------------------------------
  CoherenceCo g1 g2 : (s |&gt; g2) ~ t

While this looks (and is) unsymmetric, a combination of other coercion
combinators can make the symmetric version.

For role information, see Note [Roles and kind coercions].

Note [Predicate coercions]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
   g :: a~b
How can we coerce between types
   ([c]~a) =&gt; [a] -&gt; c
and
   ([c]~b) =&gt; [b] -&gt; c
where the equality predicate *itself* differs?

Answer: we simply treat (~) as an ordinary type constructor, so these
types really look like

   ((~) [c] a) -&gt; [a] -&gt; c
   ((~) [c] b) -&gt; [b] -&gt; c

So the coercion between the two is obviously

   ((~) [c] g) -&gt; [g] -&gt; c

Another way to see this to say that we simply collapse predicates to
their representation type (see Type.coreView and Type.predTypeRep).

This collapse is done by mkPredCo; there is no PredCo constructor
in Coercion.  This is important because we need Nth to work on
predicates too:
    Nth 1 ((~) [c] g) = g
See Simplify.simplCoercionF, which generates such selections.

Note [Roles]
~~~~~~~~~~~~
Roles are a solution to the GeneralizedNewtypeDeriving problem, articulated
in Trac #1496. The full story is in docs/core-spec/core-spec.pdf. Also, see
http://ghc.haskell.org/trac/ghc/wiki/RolesImplementation

Here is one way to phrase the problem:

Given:
newtype Age = MkAge Int
type family F x
type instance F Age = Bool
type instance F Int = Char

This compiles down to:
axAge :: Age ~ Int
axF1 :: F Age ~ Bool
axF2 :: F Int ~ Char

Then, we can make:
(sym (axF1) ; F axAge ; axF2) :: Bool ~ Char

Yikes!

The solution is _roles_, as articulated in &quot;Generative Type Abstraction and
Type-level Computation&quot; (POPL 2010), available at
http://www.seas.upenn.edu/~sweirich/papers/popl163af-weirich.pdf

The specification for roles has evolved somewhat since that paper. For the
current full details, see the documentation in docs/core-spec. Here are some
highlights.

We label every equality with a notion of type equivalence, of which there are
three options: Nominal, Representational, and Phantom. A ground type is
nominally equivalent only with itself. A newtype (which is considered a ground
type in Haskell) is representationally equivalent to its representation.
Anything is &quot;phantomly&quot; equivalent to anything else. We use &quot;N&quot;, &quot;R&quot;, and &quot;P&quot;
to denote the equivalences.

The axioms above would be:
axAge :: Age ~R Int
axF1 :: F Age ~N Bool
axF2 :: F Age ~N Char

Then, because transitivity applies only to coercions proving the same notion
of equivalence, the above construction is impossible.

However, there is still an escape hatch: we know that any two types that are
nominally equivalent are representationally equivalent as well. This is what
the form SubCo proves -- it &quot;demotes&quot; a nominal equivalence into a
representational equivalence. So, it would seem the following is possible:

sub (sym axF1) ; F axAge ; sub axF2 :: Bool ~R Char   -- WRONG

What saves us here is that the arguments to a type function F, lifted into a
coercion, *must* prove nominal equivalence. So, (F axAge) is ill-formed, and
we are safe.

Roles are attached to parameters to TyCons. When lifting a TyCon into a
coercion (through TyConAppCo), we need to ensure that the arguments to the
TyCon respect their roles. For example:

data T a b = MkT a (F b)

If we know that a1 ~R a2, then we know (T a1 b) ~R (T a2 b). But, if we know
that b1 ~R b2, we know nothing about (T a b1) and (T a b2)! This is because
the type function F branches on b's *name*, not representation. So, we say
that 'a' has role Representational and 'b' has role Nominal. The third role,
Phantom, is for parameters not used in the type's definition. Given the
following definition

data Q a = MkQ Int

the Phantom role allows us to say that (Q Bool) ~R (Q Char), because we
can construct the coercion Bool ~P Char (using UnivCo).

See the paper cited above for more examples and information.

Note [TyConAppCo roles]
~~~~~~~~~~~~~~~~~~~~~~~
The TyConAppCo constructor has a role parameter, indicating the role at
which the coercion proves equality. The choice of this parameter affects
the required roles of the arguments of the TyConAppCo. To help explain
it, assume the following definition:

  type instance F Int = Bool   -- Axiom axF : F Int ~N Bool
  newtype Age = MkAge Int      -- Axiom axAge : Age ~R Int
  data Foo a = MkFoo a         -- Role on Foo's parameter is Representational

TyConAppCo Nominal Foo axF : Foo (F Int) ~N Foo Bool
  For (TyConAppCo Nominal) all arguments must have role Nominal. Why?
  So that Foo Age ~N Foo Int does *not* hold.

TyConAppCo Representational Foo (SubCo axF) : Foo (F Int) ~R Foo Bool
TyConAppCo Representational Foo axAge       : Foo Age     ~R Foo Int
  For (TyConAppCo Representational), all arguments must have the roles
  corresponding to the result of tyConRoles on the TyCon. This is the
  whole point of having roles on the TyCon to begin with. So, we can
  have Foo Age ~R Foo Int, if Foo's parameter has role R.

  If a Representational TyConAppCo is over-saturated (which is otherwise fine),
  the spill-over arguments must all be at Nominal. This corresponds to the
  behavior for AppCo.

TyConAppCo Phantom Foo (UnivCo Phantom Int Bool) : Foo Int ~P Foo Bool
  All arguments must have role Phantom. This one isn't strictly
  necessary for soundness, but this choice removes ambiguity.

The rules here dictate the roles of the parameters to mkTyConAppCo
(should be checked by Lint).

Note [NthCo and newtypes]
~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have

  newtype N a = MkN Int
  type role N representational

This yields axiom

  NTCo:N :: forall a. N a ~R Int

We can then build

  co :: forall a b. N a ~R N b
  co = NTCo:N a ; sym (NTCo:N b)

for any `a` and `b`. Because of the role annotation on N, if we use
NthCo, we'll get out a representational coercion. That is:

  NthCo 0 co :: forall a b. a ~R b

Yikes! Clearly, this is terrible. The solution is simple: forbid
NthCo to be used on newtypes if the internal coercion is representational.

This is not just some corner case discovered by a segfault somewhere;
it was discovered in the proof of soundness of roles and described
in the &quot;Safe Coercions&quot; paper (ICFP '14).

Note [InstCo roles]
~~~~~~~~~~~~~~~~~~~
Here is (essentially) the typing rule for InstCo:

g :: (forall a. t1) ~r (forall a. t2)
w :: s1 ~N s2
------------------------------- InstCo
InstCo g w :: (t1 [a |-&gt; s1]) ~r (t2 [a |-&gt; s2])

Note that the Coercion w *must* be nominal. This is necessary
because the variable a might be used in a &quot;nominal position&quot;
(that is, a place where role inference would require a nominal
role) in t1 or t2. If we allowed w to be representational, we
could get bogus equalities.

A more nuanced treatment might be able to relax this condition
somewhat, by checking if t1 and/or t2 use their bound variables
in nominal ways. If not, having w be representational is OK.


%************************************************************************
%*                                                                      *
                UnivCoProvenance
%*                                                                      *
%************************************************************************

A UnivCo is a coercion whose proof does not directly express its role
and kind (indeed for some UnivCos, like UnsafeCoerceProv, there /is/
no proof).

The different kinds of UnivCo are described by UnivCoProvenance.  Really
each is entirely separate, but they all share the need to represent their
role and kind, which is done in the UnivCo constructor.

-}</span><span>
</span><a name="line-1013"></a><span>
</span><a name="line-1014"></a><span class="hs-comment">-- | For simplicity, we have just one UnivCo that represents a coercion from</span><span>
</span><a name="line-1015"></a><span class="hs-comment">-- some type to some other type, with (in general) no restrictions on the</span><span>
</span><a name="line-1016"></a><span class="hs-comment">-- type. The UnivCoProvenance specifies more exactly what the coercion really</span><span>
</span><a name="line-1017"></a><span class="hs-comment">-- is and why a program should (or shouldn't!) trust the coercion.</span><span>
</span><a name="line-1018"></a><span class="hs-comment">-- It is reasonable to consider each constructor of 'UnivCoProvenance'</span><span>
</span><a name="line-1019"></a><span class="hs-comment">-- as a totally independent coercion form; their only commonality is</span><span>
</span><a name="line-1020"></a><span class="hs-comment">-- that they don't tell you what types they coercion between. (That info</span><span>
</span><a name="line-1021"></a><span class="hs-comment">-- is in the 'UnivCo' constructor of 'Coercion'.</span><span>
</span><a name="line-1022"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">UnivCoProvenance</span><span>
</span><a name="line-1023"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">UnsafeCoerceProv</span><span>   </span><span class="hs-comment">-- ^ From @unsafeCoerce#@. These are unsound.</span><span>
</span><a name="line-1024"></a><span>
</span><a name="line-1025"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">PhantomProv</span><span> </span><span class="hs-identifier">KindCoercion</span><span> </span><span class="hs-comment">-- ^ See Note [Phantom coercions]. Only in Phantom</span><span>
</span><a name="line-1026"></a><span>                             </span><span class="hs-comment">-- roled coercions</span><span>
</span><a name="line-1027"></a><span>
</span><a name="line-1028"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ProofIrrelProv</span><span> </span><span class="hs-identifier">KindCoercion</span><span>  </span><span class="hs-comment">-- ^ From the fact that any two coercions are</span><span>
</span><a name="line-1029"></a><span>                                 </span><span class="hs-comment">--   considered equivalent. See Note [ProofIrrelProv].</span><span>
</span><a name="line-1030"></a><span>                                 </span><span class="hs-comment">-- Can be used in Nominal or Representational coercions</span><span>
</span><a name="line-1031"></a><span>
</span><a name="line-1032"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">PluginProv</span><span> </span><span class="hs-identifier">String</span><span>  </span><span class="hs-comment">-- ^ From a plugin, which asserts that this coercion</span><span>
</span><a name="line-1033"></a><span>                       </span><span class="hs-comment">--   is sound. The string is for the use of the plugin.</span><span>
</span><a name="line-1034"></a><span>
</span><a name="line-1035"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">HoleProv</span><span> </span><span class="hs-identifier">CoercionHole</span><span>  </span><span class="hs-comment">-- ^ See Note [Coercion holes]</span><span>
</span><a name="line-1036"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Data</span><a href="TyCoRep.html#CoercionHole"><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Data</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-1037"></a><span>
</span><a name="line-1038"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Outputable</span><span> </span><span class="hs-identifier">UnivCoProvenance</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1039"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">UnsafeCoerceProv</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#UnivCoProvenance"><span class="hs-identifier hs-type">text</span></a><span> </span><span class="hs-string">&quot;(unsafeCoerce#)&quot;</span><span>
</span><a name="line-1040"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(phantom)&quot;</span><span>
</span><a name="line-1041"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ProofIrrelProv</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(proof irrel.)&quot;</span><span>
</span><a name="line-1042"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">parens</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;plugin&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">text</span><span> </span><span class="hs-identifier">str</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1043"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">HoleProv</span></a><span> </span><span class="hs-identifier">hole</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hole&quot;</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">hole</span></a><span class="hs-special">)</span><span>
</span><a name="line-1044"></a><span>
</span><a name="line-1045"></a><span class="hs-comment">-- | A coercion to be filled in by the type-checker. See Note [Coercion holes]</span><span>
</span><a name="line-1046"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">CoercionHole</span><span>
</span><a name="line-1047"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CoercionHole</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">chUnique</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Unique</span><span>   </span><span class="hs-comment">-- ^ used only for debugging</span><span>
</span><a name="line-1048"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">chCoercion</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">IORef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Coercion</span><span class="hs-special">)</span><span>
</span><a name="line-1049"></a><span>                 </span><span class="hs-special">}</span><span>
</span><a name="line-1050"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-1051"></a><span>
</span><a name="line-1052"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Data</span><span> </span><span class="hs-identifier">CoercionHole</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1053"></a><span>  </span><span class="hs-comment">-- don't traverse?</span><span>
</span><a name="line-1054"></a><span>  </span><span class="hs-identifier">toConstr</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">abstractConstr</span><span> </span><span class="hs-string">&quot;CoercionHole&quot;</span><span>
</span><a name="line-1055"></a><span>  </span><a name="local-1912605886"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Data.html#toConstr"><span class="hs-identifier">gunfold</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#abstractConstr"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;gunfold&quot;</span><span>
</span><a name="line-1056"></a><span>  </span><span class="hs-identifier">dataTypeOf</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mkNoRepType</span><span> </span><span class="hs-string">&quot;CoercionHole&quot;</span><span>
</span><a name="line-1057"></a><span>
</span><a name="line-1058"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Outputable</span><span> </span><span class="hs-identifier">CoercionHole</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1059"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CoercionHole</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">u</span></a><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">_</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">braces</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1060"></a><span>
</span><a name="line-1061"></a><span>
</span><a name="line-1062"></a><span class="hs-comment">{- Note [Phantom coercions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
     data T a = T1 | T2
Then we have
     T s ~R T t
for any old s,t. The witness for this is (TyConAppCo T Rep co),
where (co :: s ~P t) is a phantom coercion built with PhantomProv.
The role of the UnivCo is always Phantom.  The Coercion stored is the
(nominal) kind coercion between the types
   kind(s) ~N kind (t)

Note [Coercion holes]
~~~~~~~~~~~~~~~~~~~~~~~~
During typechecking, constraint solving for type classes works by
  - Generate an evidence Id,  d7 :: Num a
  - Wrap it in a Wanted constraint, [W] d7 :: Num a
  - Use the evidence Id where the evidence is needed
  - Solve the constraint later
  - When solved, add an enclosing let-binding  let d7 = .... in ....
    which actually binds d7 to the (Num a) evidence

For equality constraints we use a different strategy.  See Note [The
equality types story] in TysPrim for background on equality constraints.
  - For boxed equality constraints, (t1 ~N t2) and (t1 ~R t2), it's just
    like type classes above. (Indeed, boxed equality constraints *are* classes.)
  - But for /unboxed/ equality constraints (t1 ~R# t2) and (t1 ~N# t2)
    we use a different plan

For unboxed equalities:
  - Generate a CoercionHole, a mutable variable just like a unification
    variable
  - Wrap the CoercionHole in a Wanted constraint; see TcRnTypes.TcEvDest
  - Use the CoercionHole in a Coercion, via HoleProv
  - Solve the constraint later
  - When solved, fill in the CoercionHole by side effect, instead of
    doing the let-binding thing

The main reason for all this is that there may be no good place to let-bind
the evidence for unboxed equalities:
  - We emit constraints for kind coercions, to be used
    to cast a type's kind. These coercions then must be used in types. Because
    they might appear in a top-level type, there is no place to bind these
   (unlifted) coercions in the usual way.

  - A coercion for (forall a. t1) ~ forall a. t2) will look like
       forall a. (coercion for t1~t2)
    But the coercion for (t1~t2) may mention 'a', and we don't have let-bindings
    within coercions.  We could add them, but coercion holes are easier.

Other notes about HoleCo:

 * INVARIANT: CoercionHole and HoleProv are used only during type checking,
   and should never appear in Core. Just like unification variables; a Type
   can contain a TcTyVar, but only during type checking. If, one day, we
   use type-level information to separate out forms that can appear during
   type-checking vs forms that can appear in core proper, holes in Core will
   be ruled out.

 * The Unique carried with a coercion hole is used solely for debugging.

 * Coercion holes can be compared for equality only like other coercions:
   only by looking at the types coerced.

 * We don't use holes for other evidence because other evidence wants to
   be /shared/. But coercions are entirely erased, so there's little
   benefit to sharing.

Note [ProofIrrelProv]
~~~~~~~~~~~~~~~~~~~~~
A ProofIrrelProv is a coercion between coercions. For example:

  data G a where
    MkG :: G Bool

In core, we get

  G :: * -&gt; *
  MkG :: forall (a :: *). (a ~ Bool) -&gt; G a

Now, consider 'MkG -- that is, MkG used in a type -- and suppose we want
a proof that ('MkG co1 a1) ~ ('MkG co2 a2). This will have to be

  TyConAppCo Nominal MkG [co3, co4]
  where
    co3 :: co1 ~ co2
    co4 :: a1 ~ a2

Note that
  co1 :: a1 ~ Bool
  co2 :: a2 ~ Bool

Here,
  co3 = UnivCo (ProofIrrelProv co5) Nominal (CoercionTy co1) (CoercionTy co2)
  where
    co5 :: (a1 ~ Bool) ~ (a2 ~ Bool)
    co5 = TyConAppCo Nominal (~) [&lt;*&gt;, &lt;*&gt;, co4, &lt;Bool&gt;]


%************************************************************************
%*                                                                      *
                 Free variables of types and coercions
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-1167"></a><span>
</span><a name="line-1168"></a><span class="hs-comment">{- Note [Free variables of types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The family of functions tyCoVarsOfType, tyCoVarsOfTypes etc, returns
a VarSet that is closed over the types of its variables.  More precisely,
  if    S = tyCoVarsOfType( t )
  and   (a:k) is in S
  then  tyCoVarsOftype( k ) is a subset of S

Example: The tyCoVars of this ((a:* -&gt; k) Int) is {a, k}.

We could /not/ close over the kinds of the variable occurrences, and
instead do so at call sites, but it seems that we always want to do
so, so it's easiest to do it here.
-}</span><span>
</span><a name="line-1182"></a><span>
</span><a name="line-1183"></a><span>
</span><a name="line-1184"></a><span class="hs-comment">-- | Returns free variables of a type, including kind variables as</span><span>
</span><a name="line-1185"></a><span class="hs-comment">-- a non-deterministic set. For type synonyms it does /not/ expand the</span><span>
</span><a name="line-1186"></a><span class="hs-comment">-- synonym.</span><span>
</span><a name="line-1187"></a><span class="hs-identifier">tyCoVarsOfType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyCoVarSet</span><span>
</span><a name="line-1188"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1189"></a><span class="hs-identifier">tyCoVarsOfType</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVSet</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-identifier">ty</span><span>
</span><a name="line-1190"></a><span>
</span><a name="line-1191"></a><span class="hs-comment">-- | `tyVarsOfType` that returns free variables of a type in a deterministic</span><span>
</span><a name="line-1192"></a><span class="hs-comment">-- set. For explanation of why using `VarSet` is not deterministic see</span><span>
</span><a name="line-1193"></a><span class="hs-comment">-- Note [Deterministic FV] in FV.</span><span>
</span><a name="line-1194"></a><span class="hs-identifier">tyCoVarsOfTypeDSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">DTyCoVarSet</span><span>
</span><a name="line-1195"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1196"></a><span class="hs-identifier">tyCoVarsOfTypeDSet</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVDSet</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-identifier">ty</span><span>
</span><a name="line-1197"></a><span>
</span><a name="line-1198"></a><span class="hs-comment">-- | `tyVarsOfType` that returns free variables of a type in deterministic</span><span>
</span><a name="line-1199"></a><span class="hs-comment">-- order. For explanation of why using `VarSet` is not deterministic see</span><span>
</span><a name="line-1200"></a><span class="hs-comment">-- Note [Deterministic FV] in FV.</span><span>
</span><a name="line-1201"></a><span class="hs-identifier">tyCoVarsOfTypeList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">TyCoVar</span><span class="hs-special">]</span><span>
</span><a name="line-1202"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1203"></a><span class="hs-identifier">tyCoVarsOfTypeList</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVList</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-identifier">ty</span><span>
</span><a name="line-1204"></a><span>
</span><a name="line-1205"></a><span class="hs-comment">-- | The worker for `tyVarsOfType` and `tyVarsOfTypeList`.</span><span>
</span><a name="line-1206"></a><span class="hs-comment">-- The previous implementation used `unionVarSet` which is O(n+m) and can</span><span>
</span><a name="line-1207"></a><span class="hs-comment">-- make the function quadratic.</span><span>
</span><a name="line-1208"></a><span class="hs-comment">-- It's exported, so that it can be composed with</span><span>
</span><a name="line-1209"></a><span class="hs-comment">-- other functions that compute free variables.</span><span>
</span><a name="line-1210"></a><span class="hs-comment">-- See Note [FV naming conventions] in FV.</span><span>
</span><a name="line-1211"></a><span class="hs-comment">--</span><span>
</span><a name="line-1212"></a><span class="hs-comment">-- Eta-expanded because that makes it run faster (apparently)</span><span>
</span><a name="line-1213"></a><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FV</span><span>
</span><a name="line-1214"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1215"></a><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyVarTy</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span>        </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">oneVar</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionFV</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyVarKind</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">c</span><span>
</span><a name="line-1216"></a><a name="tyCoVarsOfTypeAcc"><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier">tyCoVarsOfTypeAcc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyConApp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">)</span><span>   </span><a name="local-1627603790"><a href="#local-1627603790"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627603791"><a href="#local-1627603791"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627603792"><a href="#local-1627603792"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyCoVarsOfTypesAcc</span><span> </span><span class="hs-identifier">tys</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1217"></a><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><a name="local-1627603794"><a href="#local-1627603794"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627603795"><a href="#local-1627603795"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627603796"><a href="#local-1627603796"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypesAcc"><span class="hs-identifier hs-var">noVars</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypesAcc"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypesAcc"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypesAcc"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1218"></a><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-identifier">arg</span><span class="hs-special">)</span><span>    </span><a name="local-1627603797"><a href="#local-1627603797"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627603798"><a href="#local-1627603798"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627603799"><a href="#local-1627603799"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionFV</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-identifier">arg</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">c</span><span>
</span><a name="line-1219"></a><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ForAllTy</span><span> </span><span class="hs-identifier">bndr</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span> </span><a name="local-1627603802"><a href="#local-1627603802"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627603803"><a href="#local-1627603803"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627603804"><a href="#local-1627603804"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyCoVarsBndrAcc</span><span> </span><span class="hs-identifier">bndr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>  </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1220"></a><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><span class="hs-identifier">ty</span><span> </span><a name="local-1627603805"><a href="#local-1627603805"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>     </span><a name="local-1627603807"><a href="#local-1627603807"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627603808"><a href="#local-1627603808"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627603809"><a href="#local-1627603809"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-special">`</span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">c</span><span>
</span><a name="line-1221"></a><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CoercionTy</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span>    </span><a name="local-1627603812"><a href="#local-1627603812"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627603813"><a href="#local-1627603813"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627603814"><a href="#local-1627603814"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-1627603810"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-identifier">b</span><span> </span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1222"></a><span>
</span><a name="line-1223"></a><span class="hs-identifier">tyCoVarsBndrAcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyBinder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FV</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FV</span><span>
</span><a name="line-1224"></a><span class="hs-comment">-- Free vars of (forall b. &lt;thing with fvs&gt;)</span><span>
</span><a name="line-1225"></a><span class="hs-identifier">tyCoVarsBndrAcc</span><span> </span><span class="hs-identifier">bndr</span><span> </span><span class="hs-identifier">fvs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">delBinderVarFV</span><span> </span><span class="hs-identifier">bndr</span><span> </span><span class="hs-identifier">fvs</span><span>
</span><a name="line-1226"></a><span>                           </span><span class="hs-special">`</span><a href="TyCoRep.html#delBinderVarFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">binderType</span><span> </span><span class="hs-identifier">bndr</span><span class="hs-special">)</span><span>
</span><a name="line-1227"></a><span>
</span><a name="line-1228"></a><span class="hs-comment">-- | Returns free variables of types, including kind variables as</span><span>
</span><a name="line-1229"></a><span class="hs-comment">-- a non-deterministic set. For type synonyms it does /not/ expand the</span><span>
</span><a name="line-1230"></a><span class="hs-comment">-- synonym.</span><span>
</span><a name="line-1231"></a><span class="hs-identifier">tyCoVarsOfTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyCoVarSet</span><span>
</span><a name="line-1232"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1233"></a><span class="hs-identifier">tyCoVarsOfTypes</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVSet</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyCoVarsOfTypesAcc</span><span> </span><span class="hs-identifier">tys</span><span>
</span><a name="line-1234"></a><span>
</span><a name="line-1235"></a><span class="hs-comment">-- | Returns free variables of types, including kind variables as</span><span>
</span><a name="line-1236"></a><span class="hs-comment">-- a deterministic set. For type synonyms it does /not/ expand the</span><span>
</span><a name="line-1237"></a><span class="hs-comment">-- synonym.</span><span>
</span><a name="line-1238"></a><span class="hs-identifier">tyCoVarsOfTypesDSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">DTyCoVarSet</span><span>
</span><a name="line-1239"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1240"></a><span class="hs-identifier">tyCoVarsOfTypesDSet</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVDSet</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyCoVarsOfTypesAcc</span><span> </span><span class="hs-identifier">tys</span><span>
</span><a name="line-1241"></a><span>
</span><a name="line-1242"></a><span class="hs-comment">-- | Returns free variables of types, including kind variables as</span><span>
</span><a name="line-1243"></a><span class="hs-comment">-- a deterministically ordered list. For type synonyms it does /not/ expand the</span><span>
</span><a name="line-1244"></a><span class="hs-comment">-- synonym.</span><span>
</span><a name="line-1245"></a><span class="hs-identifier">tyCoVarsOfTypesList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">TyCoVar</span><span class="hs-special">]</span><span>
</span><a name="line-1246"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1247"></a><span class="hs-identifier">tyCoVarsOfTypesList</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVList</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyCoVarsOfTypesAcc</span><span> </span><span class="hs-identifier">tys</span><span>
</span><a name="line-1248"></a><span>
</span><a name="line-1249"></a><span class="hs-identifier">tyCoVarsOfTypesAcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FV</span><span>
</span><a name="line-1250"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1251"></a><span class="hs-identifier">tyCoVarsOfTypesAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ty</span><span class="hs-glyph">:</span><span class="hs-identifier">tys</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionFV</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfTypesAcc</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1252"></a><a name="tyCoVarsOfTypesAcc"><a href="TyCoRep.html#tyCoVarsOfTypesAcc"><span class="hs-identifier">tyCoVarsOfTypesAcc</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><a name="local-1627603826"><a href="#local-1627603826"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603827"><a href="#local-1627603827"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603828"><a href="#local-1627603828"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">noVars</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">fv_cand</span></a><span> </span><span class="hs-identifier">in_scope</span><span> </span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1253"></a><span>
</span><a name="line-1254"></a><span class="hs-identifier">tyCoVarsOfCo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyCoVarSet</span><span>
</span><a name="line-1255"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1256"></a><span class="hs-identifier">tyCoVarsOfCo</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVSet</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">co</span><span>
</span><a name="line-1257"></a><span>
</span><a name="line-1258"></a><span class="hs-comment">-- | Get a deterministic set of the vars free in a coercion</span><span>
</span><a name="line-1259"></a><span class="hs-identifier">tyCoVarsOfCoDSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">DTyCoVarSet</span><span>
</span><a name="line-1260"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1261"></a><span class="hs-identifier">tyCoVarsOfCoDSet</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVDSet</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">co</span><span>
</span><a name="line-1262"></a><span>
</span><a name="line-1263"></a><span class="hs-identifier">tyCoVarsOfCoList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">TyCoVar</span><span class="hs-special">]</span><span>
</span><a name="line-1264"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1265"></a><span class="hs-identifier">tyCoVarsOfCoList</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVList</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">co</span><span>
</span><a name="line-1266"></a><span>
</span><a name="line-1267"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FV</span><span>
</span><a name="line-1268"></a><span class="hs-comment">-- Extracts type and coercion variables from a coercion</span><span>
</span><a name="line-1269"></a><span class="hs-comment">-- See Note [Free variables of types]</span><span>
</span><a name="line-1270"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Refl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span>         </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1271"></a><a name="tyCoVarsOfCoAcc"><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier">tyCoVarsOfCoAcc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyConAppCo</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">cos</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">tyCoVarsOfCosAcc</span></a><span> </span><span class="hs-identifier">cos</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1272"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-identifier">arg</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><a name="local-1627603841"><a href="#local-1627603841"><span class="hs-identifier">acc</span></a></a><span>
</span><a name="line-1273"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionFV</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">arg</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1274"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ForAllCo</span><span> </span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-identifier">kind_co</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">fv_cand</span></a><span> </span><span class="hs-identifier">in_scope</span><span> </span><a href="#local-1627603845"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1275"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">delFV</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><a name="local-1627603849"><a href="#local-1627603849"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionFV</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">kind_co</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1276"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1277"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">oneVar</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionFV</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1278"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">AxiomInstCo</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><a href="#local-1627603855"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyCoVarsOfCosAcc</span><span> </span><span class="hs-identifier">cos</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1279"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">t1</span><span> </span><span class="hs-identifier">t2</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1280"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfProvAcc</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionFV</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><a name="local-1627603867"><a href="#local-1627603867"><span class="hs-identifier">t1</span></a></a><span>
</span><a name="line-1281"></a><span>                         </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">tyCoVarsOfTypeAcc</span></a><span> </span><a href="#local-1627603863"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1282"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SymCo</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span>          </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">fv_cand</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeAcc"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-identifier">acc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><a href="#local-1627603867"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1283"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TransCo</span><span> </span><span class="hs-identifier">co1</span><span> </span><span class="hs-identifier">co2</span><span class="hs-special">)</span><span>   </span><a name="local-1627603869"><a href="#local-1627603869"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603870"><a href="#local-1627603870"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603871"><a href="#local-1627603871"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">co1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionFV</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">co2</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1284"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">_</span></a><span> </span><a name="local-1627603872"><a href="#local-1627603872"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>        </span><a name="local-1627603874"><a href="#local-1627603874"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603875"><a href="#local-1627603875"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603876"><a href="#local-1627603876"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1285"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span>         </span><a name="local-1627603878"><a href="#local-1627603878"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603879"><a href="#local-1627603879"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603880"><a href="#local-1627603880"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">tyCoVarsOfCoAcc</span></a><span> </span><a href="#local-1627603877"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-1627603878"><span class="hs-identifier hs-var">fv_cand</span></a><span> </span><a href="#local-1627603879"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-1627603880"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1286"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">InstCo</span><span> </span><a name="local-1627603881"><a href="#local-1627603881"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-identifier">arg</span><span class="hs-special">)</span><span>     </span><a name="local-1627603882"><a href="#local-1627603882"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603883"><a href="#local-1627603883"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603884"><a href="#local-1627603884"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionFV</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">arg</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1287"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CoherenceCo</span><span> </span><span class="hs-identifier">c1</span><span> </span><span class="hs-identifier">c2</span><span class="hs-special">)</span><span> </span><a name="local-1627603887"><a href="#local-1627603887"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603888"><a href="#local-1627603888"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603889"><a href="#local-1627603889"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">tyCoVarsOfCoAcc</span></a><span> </span><a href="#local-1627603885"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">tyCoVarsOfCoAcc</span></a><span> </span><a href="#local-1627603886"><span class="hs-identifier hs-var">c2</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1288"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>         </span><a name="local-1627603892"><a href="#local-1627603892"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603893"><a href="#local-1627603893"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603894"><a href="#local-1627603894"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1289"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span>          </span><a name="local-1627603896"><a href="#local-1627603896"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603897"><a href="#local-1627603897"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603898"><a href="#local-1627603898"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">tyCoVarsOfCoAcc</span></a><span> </span><a href="#local-1627603895"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-1627603896"><span class="hs-identifier hs-var">fv_cand</span></a><span> </span><a href="#local-1627603897"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-1627603898"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1290"></a><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">AxiomRuleCo</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">cs</span><span class="hs-special">)</span><span>  </span><a name="local-1627603900"><a href="#local-1627603900"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603901"><a href="#local-1627603901"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603902"><a href="#local-1627603902"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyCoVarsOfCosAcc</span><span> </span><span class="hs-identifier">cs</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1291"></a><span>
</span><a name="line-1292"></a><span class="hs-identifier">tyCoVarsOfProv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">UnivCoProvenance</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyCoVarSet</span><span>
</span><a name="line-1293"></a><span class="hs-identifier">tyCoVarsOfProv</span><span> </span><span class="hs-identifier">prov</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#UnivCoProvenance"><span class="hs-identifier hs-type">runFVSet</span></a><span> </span><a href="TyCoRep.html#UnivCoProvenance"><span class="hs-operator hs-type">$</span></a><span> </span><span class="hs-identifier">tyCoVarsOfProvAcc</span><span> </span><span class="hs-identifier">prov</span><span>
</span><a name="line-1294"></a><span>
</span><a name="line-1295"></a><span class="hs-identifier">tyCoVarsOfProvAcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">UnivCoProvenance</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FV</span><span>
</span><a name="line-1296"></a><span class="hs-identifier">tyCoVarsOfProvAcc</span><span> </span><span class="hs-identifier">UnsafeCoerceProv</span><span>    </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">noVars</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1297"></a><a name="tyCoVarsOfProvAcc"><a href="TyCoRep.html#tyCoVarsOfProvAcc"><span class="hs-identifier">tyCoVarsOfProvAcc</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>    </span><a name="local-1627603908"><a href="#local-1627603908"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603909"><a href="#local-1627603909"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603910"><a href="#local-1627603910"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><a href="#local-1627603909"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1298"></a><span class="hs-identifier">tyCoVarsOfProvAcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ProofIrrelProv</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span> </span><a name="local-1627603912"><a href="#local-1627603912"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603913"><a href="#local-1627603913"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603914"><a href="#local-1627603914"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">tyCoVarsOfCoAcc</span></a><span> </span><a href="#local-1627603911"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-1627603912"><span class="hs-identifier hs-var">fv_cand</span></a><span> </span><a href="#local-1627603913"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-1627603914"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1299"></a><span class="hs-identifier">tyCoVarsOfProvAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">)</span><span>      </span><a name="local-1627603916"><a href="#local-1627603916"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603917"><a href="#local-1627603917"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603918"><a href="#local-1627603918"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">noVars</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfCoAcc"><span class="hs-identifier hs-var">fv_cand</span></a><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1300"></a><span class="hs-identifier">tyCoVarsOfProvAcc</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">HoleProv</span></a><span> </span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">)</span><span>        </span><a name="local-1627603919"><a href="#local-1627603919"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603920"><a href="#local-1627603920"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603921"><a href="#local-1627603921"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#noVars"><span class="hs-identifier hs-var">noVars</span></a><span> </span><a href="#local-1627603919"><span class="hs-identifier hs-var">fv_cand</span></a><span> </span><a href="#local-1627603920"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-1627603921"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1301"></a><span>
</span><a name="line-1302"></a><span class="hs-identifier">tyCoVarsOfCos</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Coercion</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyCoVarSet</span><span>
</span><a name="line-1303"></a><span class="hs-identifier">tyCoVarsOfCos</span><span> </span><span class="hs-identifier">cos</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVSet</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyCoVarsOfCosAcc</span><span> </span><span class="hs-identifier">cos</span><span>
</span><a name="line-1304"></a><span>
</span><a name="line-1305"></a><span class="hs-identifier">tyCoVarsOfCosAcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Coercion</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FV</span><span>
</span><a name="line-1306"></a><span class="hs-identifier">tyCoVarsOfCosAcc</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">noVars</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1307"></a><a name="tyCoVarsOfCosAcc"><a href="TyCoRep.html#tyCoVarsOfCosAcc"><span class="hs-identifier">tyCoVarsOfCosAcc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">co</span><span class="hs-glyph">:</span><span class="hs-identifier">cos</span><span class="hs-special">)</span><span> </span><a name="local-1627603926"><a href="#local-1627603926"><span class="hs-identifier">fv_cand</span></a></a><span> </span><a name="local-1627603927"><a href="#local-1627603927"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627603928"><a href="#local-1627603928"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfCoAcc</span><span> </span><a href="#local-1627603927"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionFV</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfCosAcc</span><span> </span><span class="hs-identifier">cos</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fv_cand</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">acc</span><span>
</span><a name="line-1308"></a><span>
</span><a name="line-1309"></a><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CoVarSet</span><span>
</span><a name="line-1310"></a><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyVarTy</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyVarKind</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span>
</span><a name="line-1311"></a><a name="coVarsOfType"><a href="TyCoRep.html#coVarsOfType"><span class="hs-identifier">coVarsOfType</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyConApp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfTypes</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1312"></a><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coVarsOfTypes"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-1313"></a><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-identifier">arg</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-identifier">arg</span><span>
</span><a name="line-1314"></a><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ForAllTy</span><span> </span><span class="hs-identifier">bndr</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span>
</span><a name="line-1315"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfType</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">delBinderVar</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">bndr</span><span>
</span><a name="line-1316"></a><span>    </span><span class="hs-special">`</span><a href="TyCoRep.html#coVarsOfType"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">binderType</span><span> </span><span class="hs-identifier">bndr</span><span class="hs-special">)</span><span>
</span><a name="line-1317"></a><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CastTy</span><span> </span><a href="TyCoRep.html#coVarsOfType"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="TyCoRep.html#coVarsOfType"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-identifier">co</span><span>
</span><a name="line-1318"></a><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CoercionTy</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coVarsOfType"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span> </span><span class="hs-identifier">co</span><span>
</span><a name="line-1319"></a><span>
</span><a name="line-1320"></a><span class="hs-identifier">coVarsOfTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyCoVarSet</span><span>
</span><a name="line-1321"></a><span class="hs-identifier">coVarsOfTypes</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mapUnionVarSet</span><span> </span><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-identifier">tys</span><span>
</span><a name="line-1322"></a><span>
</span><a name="line-1323"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CoVarSet</span><span>
</span><a name="line-1324"></a><span class="hs-comment">-- Extract *coercion* variables only.  Tiresome to repeat the code, but easy.</span><span>
</span><a name="line-1325"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Refl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-identifier">ty</span><span>
</span><a name="line-1326"></a><a name="coVarsOfCo"><a href="TyCoRep.html#coVarsOfCo"><span class="hs-identifier">coVarsOfCo</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyConAppCo</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">args</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfCos</span><span> </span><span class="hs-identifier">args</span><span>
</span><a name="line-1327"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-identifier">arg</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfCo</span><span> </span><a href="TyCoRep.html#coVarsOfCos"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-identifier">arg</span><span>
</span><a name="line-1328"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ForAllCo</span><span> </span><a name="local-1627603947"><a href="#local-1627603947"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">kind_co</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span>
</span><a name="line-1329"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfCo</span><span> </span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">delVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-identifier">kind_co</span><span>
</span><a name="line-1330"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CoVarCo</span><span> </span><a href="VarSet.html#delVarSet"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unitVarSet</span></a><span> </span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">coVarsOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span>
</span><a name="line-1331"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">AxiomInstCo</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">args</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfCos</span><span> </span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1332"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">t1</span><span> </span><span class="hs-identifier">t2</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfProv</span><span> </span><a href="TyCoRep.html#coVarsOfCos"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">coVarsOfTypes</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">t2</span><span class="hs-special">]</span><span>
</span><a name="line-1333"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coVarsOfProv"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span> </span><span class="hs-identifier">co</span><span>
</span><a name="line-1334"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TransCo</span><span> </span><span class="hs-identifier">co1</span><span> </span><span class="hs-identifier">co2</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span> </span><span class="hs-identifier">co1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-identifier">co2</span><span>
</span><a name="line-1335"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">_</span></a><span> </span><a name="local-1627603957"><a href="#local-1627603957"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span> </span><a href="#local-1627603957"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1336"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span> </span><a href="#local-1627603959"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1337"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">InstCo</span><span> </span><a name="local-1627603960"><a href="#local-1627603960"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-identifier">arg</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span> </span><a href="#local-1627603960"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-identifier">arg</span><span>
</span><a name="line-1338"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CoherenceCo</span><span> </span><span class="hs-identifier">c1</span><span> </span><span class="hs-identifier">c2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfCos</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">c1</span><span class="hs-special">,</span><span> </span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">c2</span></a><span class="hs-special">]</span><span>
</span><a name="line-1339"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coVarsOfCos"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span> </span><span class="hs-identifier">co</span><span>
</span><a name="line-1340"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span> </span><a href="#local-1627603965"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1341"></a><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">AxiomRuleCo</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">cs</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">coVarsOfCos</span><span> </span><span class="hs-identifier">cs</span><span>
</span><a name="line-1342"></a><span>
</span><a name="line-1343"></a><span class="hs-identifier">coVarsOfProv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">UnivCoProvenance</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CoVarSet</span><span>
</span><a name="line-1344"></a><span class="hs-identifier">coVarsOfProv</span><span> </span><span class="hs-identifier">UnsafeCoerceProv</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">emptyVarSet</span><span>
</span><a name="line-1345"></a><a name="coVarsOfProv"><a href="TyCoRep.html#coVarsOfProv"><span class="hs-identifier">coVarsOfProv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span> </span><span class="hs-identifier">co</span><span>
</span><a name="line-1346"></a><span class="hs-identifier">coVarsOfProv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ProofIrrelProv</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a><span> </span><a href="#local-1627603968"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1347"></a><span class="hs-identifier">coVarsOfProv</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">emptyVarSet</span><span>
</span><a name="line-1348"></a><span class="hs-identifier">coVarsOfProv</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">HoleProv</span></a><span> </span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-1349"></a><span>
</span><a name="line-1350"></a><span class="hs-identifier">coVarsOfCos</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Coercion</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CoVarSet</span><span>
</span><a name="line-1351"></a><span class="hs-identifier">coVarsOfCos</span><span> </span><span class="hs-identifier">cos</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mapUnionVarSet</span><span> </span><span class="hs-identifier">coVarsOfCo</span><span> </span><span class="hs-identifier">cos</span><span>
</span><a name="line-1352"></a><span>
</span><a name="line-1353"></a><span class="hs-comment">-- | Add the kind variables free in the kinds of the tyvars in the given set.</span><span>
</span><a name="line-1354"></a><span class="hs-comment">-- Returns a non-deterministic set.</span><span>
</span><a name="line-1355"></a><span class="hs-identifier">closeOverKinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyVarSet</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyVarSet</span><span>
</span><a name="line-1356"></a><span class="hs-identifier">closeOverKinds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVSet</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">closeOverKindsAcc</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">varSetElems</span><span>
</span><a name="line-1357"></a><span>
</span><a name="line-1358"></a><span class="hs-comment">-- | Given a list of tyvars returns a deterministic FV computation that</span><span>
</span><a name="line-1359"></a><span class="hs-comment">-- returns the given tyvars with the kind variables free in the kinds of the</span><span>
</span><a name="line-1360"></a><span class="hs-comment">-- given tyvars.</span><span>
</span><a name="line-1361"></a><span class="hs-identifier">closeOverKindsAcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">TyVar</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FV</span><span>
</span><a name="line-1362"></a><span class="hs-identifier">closeOverKindsAcc</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1363"></a><span>  </span><a name="closeOverKindsAcc"><a href="TyCoRep.html#closeOverKindsAcc"><span class="hs-identifier">mapUnionFV</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfTypeAcc</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">tyVarKind</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionFV</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">someVars</span><span> </span><span class="hs-identifier">tvs</span><span>
</span><a name="line-1364"></a><span>
</span><a name="line-1365"></a><span class="hs-comment">-- | Add the kind variables free in the kinds of the tyvars in the given set.</span><span>
</span><a name="line-1366"></a><span class="hs-comment">-- Returns a deterministic set.</span><span>
</span><a name="line-1367"></a><span class="hs-identifier">closeOverKindsDSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DTyVarSet</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">DTyVarSet</span><span>
</span><a name="line-1368"></a><span class="hs-identifier">closeOverKindsDSet</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runFVDSet</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">closeOverKindsAcc</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">dVarSetElems</span><span>
</span><a name="line-1369"></a><span>
</span><a name="line-1370"></a><span class="hs-comment">-- | Gets the free vars of a telescope, scoped over a given free var set.</span><span>
</span><a name="line-1371"></a><span class="hs-identifier">tyCoVarsOfTelescope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyCoVarSet</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyCoVarSet</span><span>
</span><a name="line-1372"></a><span class="hs-identifier">tyCoVarsOfTelescope</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">fvs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fvs</span><span>
</span><a name="line-1373"></a><a name="tyCoVarsOfTelescope"><a href="TyCoRep.html#tyCoVarsOfTelescope"><span class="hs-identifier">tyCoVarsOfTelescope</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">v</span><span class="hs-glyph">:</span><a name="local-1627603972"><a href="#local-1627603972"><span class="hs-identifier">vs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">fvs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyCoVarsOfTelescope</span><span> </span><span class="hs-identifier">vs</span><span> </span><span class="hs-identifier">fvs</span><span>
</span><a name="line-1374"></a><span>                                 </span><span class="hs-special">`</span><a href="TyCoRep.html#tyCoVarsOfTelescope"><span class="hs-identifier hs-var">delVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTelescope"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1375"></a><span>                                 </span><span class="hs-special">`</span><span class="hs-identifier">unionVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span>
</span><a name="line-1376"></a><span>
</span><a name="line-1377"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                        TyThing
%*                                                                      *
%************************************************************************

Despite the fact that DataCon has to be imported via a hi-boot route,
this module seems the right place for TyThing, because it's needed for
funTyCon and all the types in TysPrim.

Note [ATyCon for classes]
~~~~~~~~~~~~~~~~~~~~~~~~~
Both classes and type constructors are represented in the type environment
as ATyCon.  You can tell the difference, and get to the class, with
   isClassTyCon :: TyCon -&gt; Bool
   tyConClass_maybe :: TyCon -&gt; Maybe Class
The Class and its associated TyCon have the same Name.
-}</span><span>
</span><a name="line-1396"></a><span>
</span><a name="line-1397"></a><span class="hs-comment">-- | A global typecheckable-thing, essentially anything that has a name.</span><span>
</span><a name="line-1398"></a><span class="hs-comment">-- Not to be confused with a 'TcTyThing', which is also a typecheckable</span><span>
</span><a name="line-1399"></a><span class="hs-comment">-- thing but in the *local* context.  See 'TcEnv' for how to retrieve</span><span>
</span><a name="line-1400"></a><span class="hs-comment">-- a 'TyThing' given a 'Name'.</span><span>
</span><a name="line-1401"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">TyThing</span><span>
</span><a name="line-1402"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">AnId</span><span>     </span><span class="hs-identifier">Id</span><span>
</span><a name="line-1403"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">AConLike</span><span> </span><span class="hs-identifier">ConLike</span><span>
</span><a name="line-1404"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AConLike"><a href="TyCoRep.html#AConLike"><span class="hs-identifier">ATyCon</span></a></a><span>   </span><a href="ConLike.html#ConLike"><span class="hs-identifier hs-type">TyCon</span></a><span>       </span><span class="hs-comment">-- TyCons and classes; see Note [ATyCon for classes]</span><span>
</span><a name="line-1405"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ACoAxiom</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CoAxiom</span><span> </span><span class="hs-identifier">Branched</span><span class="hs-special">)</span><span>
</span><a name="line-1406"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">Ord</span></a><span class="hs-special">)</span><span>
</span><a name="line-1407"></a><span>
</span><a name="line-1408"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Outputable</span><span> </span><span class="hs-identifier">TyThing</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1409"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pprTyThing</span><span>
</span><a name="line-1410"></a><span>
</span><a name="line-1411"></a><span class="hs-identifier">pprTyThing</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyThing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-1412"></a><span class="hs-identifier">pprTyThing</span><span> </span><span class="hs-identifier">thing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pprTyThingCategory</span><span> </span><span class="hs-identifier">thing</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getName</span><span> </span><span class="hs-identifier">thing</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1413"></a><span>
</span><a name="line-1414"></a><span class="hs-identifier">pprTyThingCategory</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TyThing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SDoc</span><span>
</span><a name="line-1415"></a><span class="hs-identifier">pprTyThingCategory</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ATyCon</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1416"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="pprTyThingCategory"><a href="TyCoRep.html#pprTyThingCategory"><span class="hs-identifier">isClassTyCon</span></a></a><span> </span><span class="hs-identifier">tc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Class&quot;</span><span>
</span><a name="line-1417"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isClassTyCon"><span class="hs-identifier hs-var">otherwise</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type constructor&quot;</span><span>
</span><a name="line-1418"></a><span class="hs-identifier">pprTyThingCategory</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ACoAxiom</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Coercion axiom&quot;</span><span>
</span><a name="line-1419"></a><span class="hs-identifier">pprTyThingCategory</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">AnId</span></a><span>   </span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Identifier&quot;</span><span>
</span><a name="line-1420"></a><span class="hs-identifier">pprTyThingCategory</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">AConLike</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RealDataCon</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Data constructor&quot;</span><span>
</span><a name="line-1421"></a><span class="hs-identifier">pprTyThingCategory</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">PatSynCon</span></a><span> </span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">_</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Pattern synonym&quot;</span><span>
</span><a name="line-1422"></a><span>
</span><a name="line-1423"></a><span>
</span><a name="line-1424"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">NamedThing</span><span> </span><span class="hs-identifier">TyThing</span><span> </span><span class="hs-keyword">where</span><span>       </span><span class="hs-comment">-- Can't put this with the type</span><span>
</span><a name="line-1425"></a><span>  </span><span class="hs-identifier">getName</span><span> </span><span class="hs-special">(</span><a href="Name.html#NamedThing"><span class="hs-identifier hs-type">AnId</span></a><span> </span><a href="Name.html#NamedThing"><span class="hs-identifier hs-type">id</span></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getName</span><span> </span><span class="hs-identifier">id</span><span>    </span><span class="hs-comment">-- decl, because the DataCon instance</span><span>
</span><a name="line-1426"></a><span>  </span><a name="local-1912759012"><a href="Name.html#getName"><span class="hs-identifier">getName</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ATyCon</span><span> </span><span class="hs-identifier">tc</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-1627604634"><span class="hs-identifier hs-var">tc</span></a><span>    </span><span class="hs-comment">-- isn't visible there</span><span>
</span><a name="line-1427"></a><span>  </span><span class="hs-identifier">getName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ACoAxiom</span><span> </span><span class="hs-identifier">cc</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-1627604635"><span class="hs-identifier hs-var">cc</span></a><span>
</span><a name="line-1428"></a><span>  </span><span class="hs-identifier">getName</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><a name="local-1627604636"><a href="#local-1627604636"><span class="hs-identifier">cl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-1627604636"><span class="hs-identifier hs-var">cl</span></a><span>
</span><a name="line-1429"></a><span>
</span><a name="line-1430"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                        Substitutions
      Data type defined here to avoid unnecessary mutual recursion
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-1438"></a><span>
</span><a name="line-1439"></a><span class="hs-comment">-- | Type &amp; coercion substitution</span><span>
</span><a name="line-1440"></a><span class="hs-comment">--</span><span>
</span><a name="line-1441"></a><span class="hs-comment">-- #tcvsubst_invariant#</span><span>
</span><a name="line-1442"></a><span class="hs-comment">-- The following invariants must hold of a 'TCvSubst':</span><span>
</span><a name="line-1443"></a><span class="hs-comment">--</span><span>
</span><a name="line-1444"></a><span class="hs-comment">-- 1. The in-scope set is needed /only/ to</span><span>
</span><a name="line-1445"></a><span class="hs-comment">-- guide the generation of fresh uniques</span><span>
</span><a name="line-1446"></a><span class="hs-comment">--</span><span>
</span><a name="line-1447"></a><span class="hs-comment">-- 2. In particular, the /kind/ of the type variables in</span><span>
</span><a name="line-1448"></a><span class="hs-comment">-- the in-scope set is not relevant</span><span>
</span><a name="line-1449"></a><span class="hs-comment">--</span><span>
</span><a name="line-1450"></a><span class="hs-comment">-- 3. The substitution is only applied ONCE! This is because</span><span>
</span><a name="line-1451"></a><span class="hs-comment">-- in general such application will not reach a fixed point.</span><span>
</span><a name="line-1452"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1453"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">InScopeSet</span><span> </span><span class="hs-comment">-- The in-scope type and kind variables</span><span>
</span><a name="line-1454"></a><span>             </span><a href="VarEnv.html#InScopeSet"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span> </span><span class="hs-comment">-- Substitutes both type and kind variables</span><span>
</span><a name="line-1455"></a><span>             </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a><span> </span><span class="hs-comment">-- Substitutes coercion variables</span><span>
</span><a name="line-1456"></a><span>        </span><span class="hs-comment">-- See Note [Apply Once]</span><span>
</span><a name="line-1457"></a><span>        </span><span class="hs-comment">-- and Note [Extending the TvSubstEnv]</span><span>
</span><a name="line-1458"></a><span>        </span><span class="hs-comment">-- and Note [Substituting types and coercions]</span><span>
</span><a name="line-1459"></a><span>        </span><span class="hs-comment">-- and Note [The substitution invariant]</span><span>
</span><a name="line-1460"></a><span>
</span><a name="line-1461"></a><span class="hs-comment">-- | A substitution of 'Type's for 'TyVar's</span><span>
</span><a name="line-1462"></a><span class="hs-comment">--                 and 'Kind's for 'KindVar's</span><span>
</span><a name="line-1463"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">TvSubstEnv</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TyVarEnv</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-1464"></a><span>        </span><span class="hs-comment">-- A TvSubstEnv is used both inside a TCvSubst (with the apply-once</span><span>
</span><a name="line-1465"></a><span>        </span><span class="hs-comment">-- invariant discussed in Note [Apply Once]), and also independently</span><span>
</span><a name="line-1466"></a><span>        </span><span class="hs-comment">-- in the middle of matching, and unification (see Types.Unify)</span><span>
</span><a name="line-1467"></a><span>        </span><span class="hs-comment">-- So you have to look at the context to know if it's idempotent or</span><span>
</span><a name="line-1468"></a><span>        </span><span class="hs-comment">-- apply-once or whatever</span><span>
</span><a name="line-1469"></a><span>
</span><a name="line-1470"></a><span class="hs-comment">-- | A substitution of 'Coercion's for 'CoVar's</span><span>
</span><a name="line-1471"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">CvSubstEnv</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CoVarEnv</span><span> </span><span class="hs-identifier">Coercion</span><span>
</span><a name="line-1472"></a><span>
</span><a name="line-1473"></a><span class="hs-comment">{-
Note [Apply Once]
~~~~~~~~~~~~~~~~~
We use TCvSubsts to instantiate things, and we might instantiate
        forall a b. ty
\with the types
        [a, b], or [b, a].
So the substitution might go [a-&gt;b, b-&gt;a].  A similar situation arises in Core
when we find a beta redex like
        (/\ a /\ b -&gt; e) b a
Then we also end up with a substitution that permutes type variables. Other
variations happen to; for example [a -&gt; (a, b)].

        ****************************************************
        *** So a TCvSubst must be applied precisely once ***
        ****************************************************

A TCvSubst is not idempotent, but, unlike the non-idempotent substitution
we use during unifications, it must not be repeatedly applied.

Note [Extending the TvSubstEnv]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
See #tcvsubst_invariant# for the invariants that must hold.

This invariant allows a short-cut when the subst envs are empty:
if the TvSubstEnv and CvSubstEnv are empty --- i.e. (isEmptyTCvSubst subst)
holds --- then (substTy subst ty) does nothing.

For example, consider:
        (/\a. /\b:(a~Int). ...b..) Int
We substitute Int for 'a'.  The Unique of 'b' does not change, but
nevertheless we add 'b' to the TvSubstEnv, because b's kind does change

This invariant has several crucial consequences:

* In substTyVarBndr, we need extend the TvSubstEnv
        - if the unique has changed
        - or if the kind has changed

* In substTyVar, we do not need to consult the in-scope set;
  the TvSubstEnv is enough

* In substTy, substTheta, we can short-circuit when the TvSubstEnv is empty

Note [Substituting types and coercions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Types and coercions are mutually recursive, and either may have variables
&quot;belonging&quot; to the other. Thus, every time we wish to substitute in a
type, we may also need to substitute in a coercion, and vice versa.
However, the constructor used to create type variables is distinct from
that of coercion variables, so we carry two VarEnvs in a TCvSubst. Note
that it would be possible to use the CoercionTy constructor to combine
these environments, but that seems like a false economy.

Note that the TvSubstEnv should *never* map a CoVar (built with the Id
constructor) and the CvSubstEnv should *never* map a TyVar. Furthermore,
the range of the TvSubstEnv should *never* include a type headed with
CoercionTy.

Note [The substitution invariant]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When calling (substTy subst ty) it should be the case that
the in-scope set in the substitution is a superset of both:

  * The free vars of the range of the substitution
  * The free vars of ty minus the domain of the substitution

If we want to substitute [a -&gt; ty1, b -&gt; ty2] I used to
think it was enough to generate an in-scope set that includes
fv(ty1,ty2).  But that's not enough; we really should also take the
free vars of the type we are substituting into!  Example:
     (forall b. (a,b,x)) [a -&gt; List b]
Then if we use the in-scope set {b}, there is a danger we will rename
the forall'd variable to 'x' by mistake, getting this:
     (forall x. (List b, x, x))

Breaking this invariant caused the bug from #11371.
-}</span><span>
</span><a name="line-1551"></a><span>
</span><a name="line-1552"></a><span class="hs-identifier">emptyTvSubstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TvSubstEnv</span><span>
</span><a name="line-1553"></a><span class="hs-identifier">emptyTvSubstEnv</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">emptyVarEnv</span><span>
</span><a name="line-1554"></a><span>
</span><a name="line-1555"></a><span class="hs-identifier">emptyCvSubstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CvSubstEnv</span><span>
</span><a name="line-1556"></a><span class="hs-identifier">emptyCvSubstEnv</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">emptyVarEnv</span><span>
</span><a name="line-1557"></a><span>
</span><a name="line-1558"></a><span class="hs-identifier">composeTCvSubstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">InScopeSet</span><span>
</span><a name="line-1559"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TvSubstEnv</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">CvSubstEnv</span><span class="hs-special">)</span><span>
</span><a name="line-1560"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1561"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1562"></a><span class="hs-comment">-- ^ @(compose env1 env2)(x)@ is @env1(env2(x))@; i.e. apply @env2@ then @env1@.</span><span>
</span><a name="line-1563"></a><span class="hs-comment">-- It assumes that both are idempotent.</span><span>
</span><a name="line-1564"></a><span class="hs-comment">-- Typically, @env1@ is the refinement to a base substitution @env2@</span><span>
</span><a name="line-1565"></a><span class="hs-identifier">composeTCvSubstEnv</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tenv1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cenv1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tenv2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cenv2</span><span class="hs-special">)</span><span>
</span><a name="line-1566"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a name="composeTCvSubstEnv"><a href="TyCoRep.html#composeTCvSubstEnv"><span class="hs-identifier">tenv1</span></a></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">plusVarEnv</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">mapVarEnv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">substTy</span><span> </span><span class="hs-identifier">subst1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tenv2</span><span>
</span><a name="line-1567"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-1627603979"><span class="hs-identifier hs-var">cenv1</span></a><span> </span><span class="hs-special">`</span><a href="VarEnv.html#plusVarEnv"><span class="hs-identifier hs-var">plusVarEnv</span></a><span class="hs-special">`</span><span> </span><a href="VarEnv.html#mapVarEnv"><span class="hs-identifier hs-var">mapVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substCo</span></a><span> </span><a href="#local-1627603983"><span class="hs-identifier hs-var">subst1</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627603981"><span class="hs-identifier hs-var">cenv2</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1568"></a><span>        </span><span class="hs-comment">-- First apply env1 to the range of env2</span><span>
</span><a name="line-1569"></a><span>        </span><span class="hs-comment">-- Then combine the two, making sure that env1 loses if</span><span>
</span><a name="line-1570"></a><span>        </span><span class="hs-comment">-- both bind the same variable; that's why env1 is the</span><span>
</span><a name="line-1571"></a><span>        </span><span class="hs-comment">--  *left* argument to plusVarEnv, because the right arg wins</span><span>
</span><a name="line-1572"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1573"></a><span>    </span><span class="hs-identifier">subst1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv1</span><span> </span><span class="hs-identifier">cenv1</span><span>
</span><a name="line-1574"></a><span>
</span><a name="line-1575"></a><span class="hs-comment">-- | Composes two substitutions, applying the second one provided first,</span><span>
</span><a name="line-1576"></a><span class="hs-comment">-- like in function composition.</span><span>
</span><a name="line-1577"></a><span class="hs-identifier">composeTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1578"></a><span class="hs-identifier">composeTCvSubst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">is1</span><span> </span><span class="hs-identifier">tenv1</span><span> </span><span class="hs-identifier">cenv1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">is2</span><span> </span><span class="hs-identifier">tenv2</span><span> </span><span class="hs-identifier">cenv2</span><span class="hs-special">)</span><span>
</span><a name="line-1579"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="composeTCvSubst"><a href="TyCoRep.html#composeTCvSubst"><span class="hs-identifier">TCvSubst</span></a></a><span> </span><span class="hs-identifier">is3</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">tenv3</span></a><span> </span><span class="hs-identifier">cenv3</span><span>
</span><a name="line-1580"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1581"></a><span>    </span><span class="hs-identifier">is3</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">is1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">unionInScope</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is2</span><span>
</span><a name="line-1582"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">tenv3</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cenv3</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">composeTCvSubstEnv</span><span> </span><span class="hs-identifier">is3</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tenv1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cenv1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tenv2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cenv2</span><span class="hs-special">)</span><span>
</span><a name="line-1583"></a><span>
</span><a name="line-1584"></a><span class="hs-identifier">emptyTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1585"></a><span class="hs-identifier">emptyTCvSubst</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">emptyInScopeSet</span><span> </span><span class="hs-identifier">emptyTvSubstEnv</span><span> </span><span class="hs-identifier">emptyCvSubstEnv</span><span>
</span><a name="line-1586"></a><span>
</span><a name="line-1587"></a><span class="hs-identifier">mkEmptyTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">InScopeSet</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1588"></a><span class="hs-identifier">mkEmptyTCvSubst</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#InScopeSet"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">emptyTvSubstEnv</span><span> </span><span class="hs-identifier">emptyCvSubstEnv</span><span>
</span><a name="line-1589"></a><span>
</span><a name="line-1590"></a><span class="hs-identifier">isEmptyTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1591"></a><span>         </span><span class="hs-comment">-- See Note [Extending the TvSubstEnv]</span><span>
</span><a name="line-1592"></a><span class="hs-identifier">isEmptyTCvSubst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-identifier">cenv</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isEmptyVarEnv</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">isEmptyVarEnv</span><span> </span><span class="hs-identifier">cenv</span><span>
</span><a name="line-1593"></a><span>
</span><a name="line-1594"></a><span class="hs-identifier">mkTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">InScopeSet</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TvSubstEnv</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">CvSubstEnv</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1595"></a><span class="hs-identifier">mkTCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tenv</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cenv</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">cenv</span></a><span>
</span><a name="line-1596"></a><span>
</span><a name="line-1597"></a><span class="hs-identifier">mkTvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">InScopeSet</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TvSubstEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1598"></a><span class="hs-comment">-- ^ Mkae a TCvSubst with specified tyvar subst and empty covar subst</span><span>
</span><a name="line-1599"></a><span class="hs-identifier">mkTvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-identifier">emptyCvSubstEnv</span><span>
</span><a name="line-1600"></a><span>
</span><a name="line-1601"></a><span class="hs-identifier">getTvSubstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TvSubstEnv</span><span>
</span><a name="line-1602"></a><span class="hs-identifier">getTvSubstEnv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">_</span></a><span> </span><span class="hs-identifier">env</span><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">_</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">env</span></a><span>
</span><a name="line-1603"></a><span>
</span><a name="line-1604"></a><span class="hs-identifier">getCvSubstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CvSubstEnv</span><span>
</span><a name="line-1605"></a><span class="hs-identifier">getCvSubstEnv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">_</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">env</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">env</span></a><span>
</span><a name="line-1606"></a><span>
</span><a name="line-1607"></a><span class="hs-identifier">getTCvInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">InScopeSet</span><span>
</span><a name="line-1608"></a><span class="hs-identifier">getTCvInScope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><a href="VarEnv.html#InScopeSet"><span class="hs-identifier hs-type">_</span></a><span> </span><a href="VarEnv.html#InScopeSet"><span class="hs-identifier hs-type">_</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">in_scope</span><span>
</span><a name="line-1609"></a><span>
</span><a name="line-1610"></a><span class="hs-identifier">isInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1611"></a><span class="hs-identifier">isInScope</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-type">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">elemInScopeSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">in_scope</span><span>
</span><a name="line-1612"></a><span>
</span><a name="line-1613"></a><span class="hs-identifier">notElemTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1614"></a><span class="hs-identifier">notElemTCvSubst</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">_</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">tenv</span></a><span> </span><span class="hs-identifier">cenv</span><span class="hs-special">)</span><span>
</span><a name="line-1615"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="notElemTCvSubst"><a href="TyCoRep.html#notElemTCvSubst"><span class="hs-identifier">isTyVar</span></a></a><span> </span><a name="notElemTCvSubst"><a href="TyCoRep.html#notElemTCvSubst"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-1616"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">elemVarEnv</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tenv</span><span class="hs-special">)</span><span>
</span><a name="line-1617"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>
</span><a name="line-1618"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">elemVarEnv</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">cenv</span><span class="hs-special">)</span><span>
</span><a name="line-1619"></a><span>
</span><a name="line-1620"></a><span class="hs-identifier">setTvSubstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TvSubstEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1621"></a><span class="hs-identifier">setTvSubstEnv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">_</span></a><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">cenv</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-identifier">cenv</span><span>
</span><a name="line-1622"></a><span>
</span><a name="line-1623"></a><span class="hs-identifier">setCvSubstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CvSubstEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1624"></a><span class="hs-identifier">setCvSubstEnv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">tenv</span></a><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">_</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">cenv</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-identifier">cenv</span><span>
</span><a name="line-1625"></a><span>
</span><a name="line-1626"></a><span class="hs-identifier">zapTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1627"></a><span class="hs-identifier">zapTCvSubst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">_</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">_</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">emptyVarEnv</span><span> </span><span class="hs-identifier">emptyVarEnv</span><span>
</span><a name="line-1628"></a><span>
</span><a name="line-1629"></a><span class="hs-identifier">extendTCvInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1630"></a><span class="hs-identifier">extendTCvInScope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">cenv</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">var</span><span>
</span><a name="line-1631"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="extendTCvInScope"><a href="TyCoRep.html#extendTCvInScope"><span class="hs-identifier">TCvSubst</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">extendInScopeSet</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">var</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-identifier">cenv</span><span>
</span><a name="line-1632"></a><span>
</span><a name="line-1633"></a><span class="hs-identifier">extendTCvInScopeList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1634"></a><span class="hs-identifier">extendTCvInScopeList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">cenv</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">vars</span><span>
</span><a name="line-1635"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="extendTCvInScopeList"><a href="TyCoRep.html#extendTCvInScopeList"><span class="hs-identifier">TCvSubst</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">extendInScopeSetList</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">vars</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-identifier">cenv</span><span>
</span><a name="line-1636"></a><span>
</span><a name="line-1637"></a><span class="hs-identifier">extendTCvInScopeSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">VarSet</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1638"></a><span class="hs-identifier">extendTCvInScopeSet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-identifier">cenv</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">vars</span><span>
</span><a name="line-1639"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="extendTCvInScopeSet"><a href="TyCoRep.html#extendTCvInScopeSet"><span class="hs-identifier">TCvSubst</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">extendInScopeSetSet</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">vars</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-identifier">cenv</span><span>
</span><a name="line-1640"></a><span>
</span><a name="line-1641"></a><span class="hs-identifier">extendTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyCoVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1642"></a><span class="hs-identifier">extendTCvSubst</span><span> </span><span class="hs-identifier">subst</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">ty</span></a><span>
</span><a name="line-1643"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="extendTCvSubst"><a href="TyCoRep.html#extendTCvSubst"><span class="hs-identifier">isTyVar</span></a></a><span> </span><a name="extendTCvSubst"><a href="TyCoRep.html#extendTCvSubst"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-1644"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">extendTvSubst</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-identifier">ty</span><span>
</span><a name="line-1645"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#extendTvSubst"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a href="TyCoRep.html#extendTvSubst"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627604028"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1646"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">extendCvSubst</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-identifier">co</span><span>
</span><a name="line-1647"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#extendCvSubst"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1648"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;extendTCvSubst&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;|-&gt;&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span>
</span><a name="line-1649"></a><span>
</span><a name="line-1650"></a><span class="hs-identifier">extendTvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1651"></a><span class="hs-identifier">extendTvSubst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">cenv</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">tv</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">ty</span></a><span>
</span><a name="line-1652"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="extendTvSubst"><a href="TyCoRep.html#extendTvSubst"><span class="hs-identifier">TCvSubst</span></a></a><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">extendVarEnv</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-identifier">tv</span><span> </span><a name="local-1627604035"><a href="#local-1627604035"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">cenv</span><span>
</span><a name="line-1653"></a><span>
</span><a name="line-1654"></a><span class="hs-identifier">extendTvSubstWithClone</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1655"></a><span class="hs-comment">-- Adds a new tv -&gt; tv mapping, /and/ extends the in-scope set</span><span>
</span><a name="line-1656"></a><span class="hs-identifier">extendTvSubstWithClone</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-identifier">cenv</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-identifier">tv'</span><span>
</span><a name="line-1657"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="extendTvSubstWithClone"><a href="TyCoRep.html#extendTvSubstWithClone"><span class="hs-identifier">TCvSubst</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">extendInScopeSet</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tv'</span><span class="hs-special">)</span><span>
</span><a name="line-1658"></a><span>             </span><span class="hs-special">(</span><a href="VarEnv.html#extendInScopeSet"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><span class="hs-identifier">tenv</span><span> </span><a href="#local-1627604037"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkTyVarTy</span><span> </span><span class="hs-identifier">tv'</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1659"></a><span>             </span><span class="hs-identifier">cenv</span><span>
</span><a name="line-1660"></a><span>
</span><a name="line-1661"></a><span class="hs-identifier">extendCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CoVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1662"></a><span class="hs-identifier">extendCvSubst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">cenv</span></a><span class="hs-special">)</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-identifier">co</span><span>
</span><a name="line-1663"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="extendCvSubst"><a href="TyCoRep.html#extendCvSubst"><span class="hs-identifier">TCvSubst</span></a></a><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">extendVarEnv</span><span> </span><span class="hs-identifier">cenv</span><span> </span><a name="local-1627604046"><a href="#local-1627604046"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span>
</span><a name="line-1664"></a><span>
</span><a name="line-1665"></a><span class="hs-identifier">extendCvSubstWithClone</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CoVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CoVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1666"></a><span class="hs-identifier">extendCvSubstWithClone</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">cenv</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">cv</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">cv'</span></a><span>
</span><a name="line-1667"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="extendCvSubstWithClone"><a href="TyCoRep.html#extendCvSubstWithClone"><span class="hs-identifier">TCvSubst</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">extendInScopeSet</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">cv'</span><span class="hs-special">)</span><span>
</span><a name="line-1668"></a><span>             </span><span class="hs-identifier">tenv</span><span>
</span><a name="line-1669"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier">extendVarEnv</span><span> </span><span class="hs-identifier">cenv</span><span> </span><span class="hs-identifier">cv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkCoVarCo</span><span> </span><span class="hs-identifier">cv'</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1670"></a><span>
</span><a name="line-1671"></a><span class="hs-identifier">extendTvSubstAndInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1672"></a><span class="hs-comment">-- Also extends the in-scope set</span><span>
</span><a name="line-1673"></a><span class="hs-identifier">extendTvSubstAndInScope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-identifier">cenv</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-identifier">ty</span><span>
</span><a name="line-1674"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="extendTvSubstAndInScope"><a href="TyCoRep.html#extendTvSubstAndInScope"><span class="hs-identifier">TCvSubst</span></a></a><span> </span><span class="hs-special">(</span><a name="extendTvSubstAndInScope"><a href="TyCoRep.html#extendTvSubstAndInScope"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">extendInScopeSetSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfType</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span>
</span><a name="line-1675"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier">extendVarEnv</span><span> </span><a href="VarEnv.html#extendInScopeSetSet"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="VarEnv.html#extendInScopeSetSet"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="VarEnv.html#extendInScopeSetSet"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1676"></a><span>             </span><span class="hs-identifier">cenv</span><span>
</span><a name="line-1677"></a><span>
</span><a name="line-1678"></a><span class="hs-identifier">extendTvSubstList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1679"></a><span class="hs-identifier">extendTvSubstList</span><span> </span><span class="hs-identifier">subst</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">tvs</span></a><span> </span><span class="hs-identifier">tys</span><span>
</span><a name="line-1680"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="extendTvSubstList"><a href="TyCoRep.html#extendTvSubstList"><span class="hs-identifier">foldl2</span></a></a><span> </span><span class="hs-identifier">extendTvSubst</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-identifier">tys</span><span>
</span><a name="line-1681"></a><span>
</span><a name="line-1682"></a><span class="hs-identifier">extendTvSubstBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyBinder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1683"></a><span class="hs-identifier">extendTvSubstBinder</span><span> </span><span class="hs-identifier">env</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">Anon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">_</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">env</span><span>
</span><a name="line-1684"></a><a name="extendTvSubstBinder"><a href="TyCoRep.html#extendTvSubstBinder"><span class="hs-identifier">extendTvSubstBinder</span></a></a><span> </span><a name="local-1627604060"><a href="#local-1627604060"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Named</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">extendTvSubst</span><span> </span><span class="hs-identifier">env</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-identifier">ty</span><span>
</span><a name="line-1685"></a><span>
</span><a name="line-1686"></a><span class="hs-identifier">unionTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TCvSubst</span><span>
</span><a name="line-1687"></a><span class="hs-comment">-- Works when the ranges are disjoint</span><span>
</span><a name="line-1688"></a><span class="hs-identifier">unionTCvSubst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope1</span><span> </span><span class="hs-identifier">tenv1</span><span> </span><span class="hs-identifier">cenv1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TCvSubst</span><span> </span><span class="hs-identifier">in_scope2</span><span> </span><span class="hs-identifier">tenv2</span><span> </span><span class="hs-identifier">cenv2</span><span class="hs-special">)</span><span>
</span><a name="line-1689"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="unionTCvSubst"><a href="TyCoRep.html#unionTCvSubst"><span class="hs-identifier">ASSERT</span></a></a><span class="hs-special">(</span><span> </span><a href="#local-1627604066"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">tenv1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">intersectsVarEnv</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tenv2</span><span class="hs-special">)</span><span>
</span><a name="line-1690"></a><span>         </span><a href="Util.html#debugIsOn"><span class="hs-operator hs-var">&amp;&amp;</span></a><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">cenv1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">intersectsVarEnv</span><span class="hs-special">`</span><span> </span><a href="VarEnv.html#intersectsVarEnv"><span class="hs-identifier hs-var">cenv2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1691"></a><span>    </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604064"><span class="hs-identifier hs-var">in_scope1</span></a><span> </span><span class="hs-special">`</span><a href="VarEnv.html#unionInScope"><span class="hs-identifier hs-var">unionInScope</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627604067"><span class="hs-identifier hs-var">in_scope2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1692"></a><span>             </span><span class="hs-special">(</span><a href="#local-1627604065"><span class="hs-identifier hs-var">tenv1</span></a><span>     </span><span class="hs-special">`</span><a href="VarEnv.html#plusVarEnv"><span class="hs-identifier hs-var">plusVarEnv</span></a><span class="hs-special">`</span><span>   </span><a href="#local-1627604068"><span class="hs-identifier hs-var">tenv2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1693"></a><span>             </span><span class="hs-special">(</span><a href="#local-1627604066"><span class="hs-identifier hs-var">cenv1</span></a><span>     </span><span class="hs-special">`</span><a href="VarEnv.html#plusVarEnv"><span class="hs-identifier hs-var">plusVarEnv</span></a><span class="hs-special">`</span><span>   </span><a href="#local-1627604069"><span class="hs-identifier hs-var">cenv2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1694"></a><span>
</span><a name="line-1695"></a><span class="hs-comment">-- mkTvSubstPrs and zipTvSubst generate the in-scope set from</span><span>
</span><a name="line-1696"></a><span class="hs-comment">-- the types given; but it's just a thunk so with a bit of luck</span><span>
</span><a name="line-1697"></a><span class="hs-comment">-- it'll never be evaluated</span><span>
</span><a name="line-1698"></a><span>
</span><a name="line-1699"></a><span class="hs-comment">-- | Generates an in-scope set from the free variables in a list of types</span><span>
</span><a name="line-1700"></a><span class="hs-comment">-- and a list of coercions</span><span>
</span><a name="line-1701"></a><span class="hs-identifier">mkTyCoInScopeSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a><span>
</span><a name="line-1702"></a><a name="mkTyCoInScopeSet"><a href="TyCoRep.html#mkTyCoInScopeSet"><span class="hs-identifier">mkTyCoInScopeSet</span></a></a><span> </span><a name="local-1627604070"><a href="#local-1627604070"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-1627604071"><a href="#local-1627604071"><span class="hs-identifier">cos</span></a></a><span>
</span><a name="line-1703"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1627604070"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCos"><span class="hs-identifier hs-var">tyCoVarsOfCos</span></a><span> </span><a href="#local-1627604071"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-1704"></a><span>
</span><a name="line-1705"></a><span class="hs-comment">-- | Generates the in-scope set for the 'TCvSubst' from the types in the incoming</span><span>
</span><a name="line-1706"></a><span class="hs-comment">-- environment. No CoVars, please!</span><span>
</span><a name="line-1707"></a><span class="hs-identifier">zipTvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-1708"></a><a name="zipTvSubst"><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier">zipTvSubst</span></a></a><span> </span><a name="local-1627604072"><a href="#local-1627604072"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627604073"><a href="#local-1627604073"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1709"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a><span>
</span><a name="line-1710"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-1627604072"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604072"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604073"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1711"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprTrace"><span class="hs-identifier hs-var">pprTrace</span></a><span> </span><span class="hs-string">&quot;zipTvSubst&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604072"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604073"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span>
</span><a name="line-1712"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1713"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTvSubst"><span class="hs-identifier hs-var">mkTvSubst</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1627604073"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627604074"><span class="hs-identifier hs-var">tenv</span></a><span>
</span><a name="line-1714"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1715"></a><span>    </span><a name="local-1627604074"><a href="#local-1627604074"><span class="hs-identifier">tenv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zipTyEnv"><span class="hs-identifier hs-var">zipTyEnv</span></a><span> </span><a href="#local-1627604072"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627604073"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1716"></a><span>
</span><a name="line-1717"></a><span class="hs-comment">-- | Generates the in-scope set for the 'TCvSubst' from the types in the incoming</span><span>
</span><a name="line-1718"></a><span class="hs-comment">-- environment.  No TyVars, please!</span><span>
</span><a name="line-1719"></a><span class="hs-identifier">zipCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-1720"></a><a name="zipCvSubst"><a href="TyCoRep.html#zipCvSubst"><span class="hs-identifier">zipCvSubst</span></a></a><span> </span><a name="local-1627604075"><a href="#local-1627604075"><span class="hs-identifier">cvs</span></a></a><span> </span><a name="local-1627604076"><a href="#local-1627604076"><span class="hs-identifier">cos</span></a></a><span>
</span><a name="line-1721"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a><span>
</span><a name="line-1722"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a><span> </span><a href="#local-1627604075"><span class="hs-identifier hs-var">cvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604075"><span class="hs-identifier hs-var">cvs</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604076"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-1723"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprTrace"><span class="hs-identifier hs-var">pprTrace</span></a><span> </span><span class="hs-string">&quot;zipCvSubst&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604075"><span class="hs-identifier hs-var">cvs</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604076"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span>
</span><a name="line-1724"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1725"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfCos"><span class="hs-identifier hs-var">tyCoVarsOfCos</span></a><span> </span><a href="#local-1627604076"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="TyCoRep.html#emptyTvSubstEnv"><span class="hs-identifier hs-var">emptyTvSubstEnv</span></a><span> </span><a href="#local-1627604077"><span class="hs-identifier hs-var">cenv</span></a><span>
</span><a name="line-1726"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1727"></a><span>    </span><a name="local-1627604077"><a href="#local-1627604077"><span class="hs-identifier">cenv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zipCoEnv"><span class="hs-identifier hs-var">zipCoEnv</span></a><span> </span><a href="#local-1627604075"><span class="hs-identifier hs-var">cvs</span></a><span> </span><a href="#local-1627604076"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-1728"></a><span>
</span><a name="line-1729"></a><span class="hs-comment">-- | Create a TCvSubst combining the binders and types provided.</span><span>
</span><a name="line-1730"></a><span class="hs-comment">-- NB: It is specifically OK if the lists are of different lengths.</span><span>
</span><a name="line-1731"></a><span class="hs-identifier">zipTyBinderSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-1732"></a><a name="zipTyBinderSubst"><a href="TyCoRep.html#zipTyBinderSubst"><span class="hs-identifier">zipTyBinderSubst</span></a></a><span> </span><a name="local-1627604078"><a href="#local-1627604078"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-1627604079"><a href="#local-1627604079"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1733"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTvSubst"><span class="hs-identifier hs-var">mkTvSubst</span></a><span> </span><a href="#local-1627604080"><span class="hs-identifier hs-var">is</span></a><span> </span><a href="#local-1627604081"><span class="hs-identifier hs-var">tenv</span></a><span>
</span><a name="line-1734"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1735"></a><span>    </span><a name="local-1627604080"><a href="#local-1627604080"><span class="hs-identifier">is</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1627604079"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1736"></a><span>    </span><a name="local-1627604081"><a href="#local-1627604081"><span class="hs-identifier">tenv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-1627604082"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604083"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-1627604082"><a href="#local-1627604082"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627604083"><a href="#local-1627604083"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><a href="#local-1627604078"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-1627604079"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1737"></a><span>
</span><a name="line-1738"></a><span class="hs-comment">-- | Generates the in-scope set for the 'TCvSubst' from the types in the</span><span>
</span><a name="line-1739"></a><span class="hs-comment">-- incoming environment. No CoVars, please!</span><span>
</span><a name="line-1740"></a><span class="hs-identifier">mkTvSubstPrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-1741"></a><a name="mkTvSubstPrs"><a href="TyCoRep.html#mkTvSubstPrs"><span class="hs-identifier">mkTvSubstPrs</span></a></a><span> </span><a name="local-1627604084"><a href="#local-1627604084"><span class="hs-identifier">prs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1742"></a><span>    </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">onlyTyVarsAndNoCoercionTy</span><span class="hs-special">,</span><span> </span><a href="#local-1627604087"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;prs&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">prs</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1743"></a><span>    </span><a href="TyCoRep.html#mkTvSubst"><span class="hs-identifier hs-var">mkTvSubst</span></a><span> </span><a href="#local-1627604086"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-1627604085"><span class="hs-identifier hs-var">tenv</span></a><span>
</span><a name="line-1744"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1627604085"><a href="#local-1627604085"><span class="hs-identifier">tenv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a><span> </span><a href="#local-1627604084"><span class="hs-identifier hs-var">prs</span></a><span>
</span><a name="line-1745"></a><span>        </span><a name="local-1627604086"><a href="#local-1627604086"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-1627604084"><span class="hs-identifier hs-var">prs</span></a><span>
</span><a name="line-1746"></a><span>        </span><a name="local-1627604087"><a href="#local-1627604087"><span class="hs-identifier">onlyTyVarsAndNoCoercionTy</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1747"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#and"><span class="hs-identifier hs-var">and</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-1627604088"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Type.html#isCoercionTy"><span class="hs-identifier hs-var">isCoercionTy</span></a><span> </span><a href="#local-1627604089"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1748"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1627604088"><a href="#local-1627604088"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604089"><a href="#local-1627604089"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627604084"><span class="hs-identifier hs-var">prs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1749"></a><span>
</span><a name="line-1750"></a><span class="hs-identifier">zipTyEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span>
</span><a name="line-1751"></a><a name="zipTyEnv"><a href="TyCoRep.html#zipTyEnv"><span class="hs-identifier">zipTyEnv</span></a></a><span> </span><a name="local-1627604090"><a href="#local-1627604090"><span class="hs-identifier">tyvars</span></a></a><span> </span><a name="local-1627604091"><a href="#local-1627604091"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1752"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">all</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">isCoercionTy</span><span class="hs-special">)</span><span> </span><a href="Type.html#isCoercionTy"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1753"></a><span>    </span><a href="VarEnv.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a><span> </span><span class="hs-string">&quot;zipTyEnv&quot;</span><span> </span><a href="#local-1627604090"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="#local-1627604091"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1754"></a><span>        </span><span class="hs-comment">-- There used to be a special case for when</span><span>
</span><a name="line-1755"></a><span>        </span><span class="hs-comment">--      ty == TyVarTy tv</span><span>
</span><a name="line-1756"></a><span>        </span><span class="hs-comment">-- (a not-uncommon case) in which case the substitution was dropped.</span><span>
</span><a name="line-1757"></a><span>        </span><span class="hs-comment">-- But the type-tidier changes the print-name of a type variable without</span><span>
</span><a name="line-1758"></a><span>        </span><span class="hs-comment">-- changing the unique, and that led to a bug.   Why?  Pre-tidying, we had</span><span>
</span><a name="line-1759"></a><span>        </span><span class="hs-comment">-- a type {Foo t}, where Foo is a one-method class.  So Foo is really a newtype.</span><span>
</span><a name="line-1760"></a><span>        </span><span class="hs-comment">-- And it happened that t was the type variable of the class.  Post-tiding,</span><span>
</span><a name="line-1761"></a><span>        </span><span class="hs-comment">-- it got turned into {Foo t2}.  The ext-core printer expanded this using</span><span>
</span><a name="line-1762"></a><span>        </span><span class="hs-comment">-- sourceTypeRep, but that said &quot;Oh, t == t2&quot; because they have the same unique,</span><span>
</span><a name="line-1763"></a><span>        </span><span class="hs-comment">-- and so generated a rep type mentioning t not t2.</span><span>
</span><a name="line-1764"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-1765"></a><span>        </span><span class="hs-comment">-- Simplest fix is to nuke the &quot;optimisation&quot;</span><span>
</span><a name="line-1766"></a><span>
</span><a name="line-1767"></a><span class="hs-identifier">zipCoEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a><span>
</span><a name="line-1768"></a><a name="zipCoEnv"><a href="TyCoRep.html#zipCoEnv"><span class="hs-identifier">zipCoEnv</span></a></a><span> </span><a name="local-1627604092"><a href="#local-1627604092"><span class="hs-identifier">cvs</span></a></a><span> </span><a name="local-1627604093"><a href="#local-1627604093"><span class="hs-identifier">cos</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a><span> </span><span class="hs-string">&quot;zipCoEnv&quot;</span><span> </span><a href="#local-1627604092"><span class="hs-identifier hs-var">cvs</span></a><span> </span><a href="#local-1627604093"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-1769"></a><span>
</span><a name="line-1770"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1771"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><a name="local-1627604631"><a href="#local-1627604631"><span class="hs-identifier">ins</span></a></a><span> </span><a name="local-1627604632"><a href="#local-1627604632"><span class="hs-identifier">tenv</span></a></a><span> </span><a name="local-1627604633"><a href="#local-1627604633"><span class="hs-identifier">cenv</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1772"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;TCvSubst&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1773"></a><span>                      </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In scope:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604631"><span class="hs-identifier hs-var">ins</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1774"></a><span>                      </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type env:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604632"><span class="hs-identifier hs-var">tenv</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1775"></a><span>                      </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Co env:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604633"><span class="hs-identifier hs-var">cenv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1776"></a><span>
</span><a name="line-1777"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                Performing type or kind substitutions
%*                                                                      *
%************************************************************************

Note [Sym and ForAllCo]
~~~~~~~~~~~~~~~~~~~~~~~
In OptCoercion, we try to push &quot;sym&quot; out to the leaves of a coercion. But,
how do we push sym into a ForAllCo? It's a little ugly.

Here is the typing rule:

h : k1 ~# k2
(tv : k1) |- g : ty1 ~# ty2
----------------------------
ForAllCo tv h g : (ForAllTy (tv : k1) ty1) ~#
                  (ForAllTy (tv : k2) (ty2[tv |-&gt; tv |&gt; sym h]))

Here is what we want:

ForAllCo tv h' g' : (ForAllTy (tv : k2) (ty2[tv |-&gt; tv |&gt; sym h])) ~#
                    (ForAllTy (tv : k1) ty1)


Because the kinds of the type variables to the right of the colon are the kinds
coerced by h', we know (h' : k2 ~# k1). Thus, (h' = sym h).

Now, we can rewrite ty1 to be (ty1[tv |-&gt; tv |&gt; sym h' |&gt; h']). We thus want

ForAllCo tv h' g' :
  (ForAllTy (tv : k2) (ty2[tv |-&gt; tv |&gt; h'])) ~#
  (ForAllTy (tv : k1) (ty1[tv |-&gt; tv |&gt; h'][tv |-&gt; tv |&gt; sym h']))

We thus see that we want

g' : ty2[tv |-&gt; tv |&gt; h'] ~# ty1[tv |-&gt; tv |&gt; h']

and thus g' = sym (g[tv |-&gt; tv |&gt; h']).

Putting it all together, we get this:

sym (ForAllCo tv h g)
==&gt;
ForAllCo tv (sym h) (sym g[tv |-&gt; tv |&gt; sym h])

-}</span><span>
</span><a name="line-1825"></a><span>
</span><a name="line-1826"></a><span class="hs-comment">-- | Type substitution, see 'zipTvSubst'</span><span>
</span><a name="line-1827"></a><span class="hs-identifier">substTyWith</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-1828"></a><span class="hs-comment">-- CallStack wasn't present in GHC 7.10.1, disable callstacks in stage 1</span><span>
</span><a name="line-1829"></a><span class="hs-cpp">#if MIN_VERSION_GLASGOW_HASKELL(7,10,2,0)</span><span>
</span><a name="line-1830"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">?</span><span class="hs-identifier">callStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#CallStack"><span class="hs-identifier hs-type">CallStack</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-1831"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1832"></a><span>    </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1833"></a><span class="hs-comment">-- Works only if the domain of the substitution is a</span><span>
</span><a name="line-1834"></a><span class="hs-comment">-- superset of the type being substituted into</span><span>
</span><a name="line-1835"></a><a name="substTyWith"><a href="TyCoRep.html#substTyWith"><span class="hs-identifier">substTyWith</span></a></a><span> </span><a name="local-1627604094"><a href="#local-1627604094"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627604095"><a href="#local-1627604095"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-operator">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604094"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1836"></a><span>                      </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><a href="#local-1627604094"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627604095"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1837"></a><span>
</span><a name="line-1838"></a><span class="hs-comment">-- | Type substitution, see 'zipTvSubst'. Disables sanity checks.</span><span>
</span><a name="line-1839"></a><span class="hs-comment">-- The problems that the sanity checks in substTy catch are described in</span><span>
</span><a name="line-1840"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-1841"></a><span class="hs-comment">-- The goal of #11371 is to migrate all the calls of substTyUnchecked to</span><span>
</span><a name="line-1842"></a><span class="hs-comment">-- substTy and remove this function. Please don't use in new code.</span><span>
</span><a name="line-1843"></a><span class="hs-identifier">substTyWithUnchecked</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1844"></a><a name="substTyWithUnchecked"><a href="TyCoRep.html#substTyWithUnchecked"><span class="hs-identifier">substTyWithUnchecked</span></a></a><span> </span><a name="local-1627604096"><a href="#local-1627604096"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627604097"><a href="#local-1627604097"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1845"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-operator">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604096"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1846"></a><span>    </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><a href="#local-1627604096"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627604097"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1847"></a><span>
</span><a name="line-1848"></a><span class="hs-comment">-- | Substitute tyvars within a type using a known 'InScopeSet'.</span><span>
</span><a name="line-1849"></a><span class="hs-comment">-- Pre-condition: the 'in_scope' set should satisfy Note [The substitution</span><span>
</span><a name="line-1850"></a><span class="hs-comment">-- invariant]; specifically it should include the free vars of 'tys',</span><span>
</span><a name="line-1851"></a><span class="hs-comment">-- and of 'ty' minus the domain of the subst.</span><span>
</span><a name="line-1852"></a><span class="hs-identifier">substTyWithInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1853"></a><a name="substTyWithInScope"><a href="TyCoRep.html#substTyWithInScope"><span class="hs-identifier">substTyWithInScope</span></a></a><span> </span><a name="local-1627604098"><a href="#local-1627604098"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627604099"><a href="#local-1627604099"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627604100"><a href="#local-1627604100"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-1627604101"><a href="#local-1627604101"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1854"></a><span>  </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-operator">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604099"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1855"></a><span>  </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTvSubst"><span class="hs-identifier hs-var">mkTvSubst</span></a><span> </span><a href="#local-1627604098"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-1627604102"><span class="hs-identifier hs-var">tenv</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604101"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1856"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1627604102"><a href="#local-1627604102"><span class="hs-identifier">tenv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zipTyEnv"><span class="hs-identifier hs-var">zipTyEnv</span></a><span> </span><a href="#local-1627604099"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627604100"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1857"></a><span>
</span><a name="line-1858"></a><span class="hs-comment">-- | Coercion substitution, see 'zipTvSubst'</span><span>
</span><a name="line-1859"></a><span class="hs-identifier">substCoWith</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-1860"></a><span class="hs-comment">-- CallStack wasn't present in GHC 7.10.1, disable callstacks in stage 1</span><span>
</span><a name="line-1861"></a><span class="hs-cpp">#if MIN_VERSION_GLASGOW_HASKELL(7,10,2,0)</span><span>
</span><a name="line-1862"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">?</span><span class="hs-identifier">callStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#CallStack"><span class="hs-identifier hs-type">CallStack</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-1863"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1864"></a><span>    </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1865"></a><a name="substCoWith"><a href="TyCoRep.html#substCoWith"><span class="hs-identifier">substCoWith</span></a></a><span> </span><a name="local-1627604103"><a href="#local-1627604103"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627604104"><a href="#local-1627604104"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-operator">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604103"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1866"></a><span>                      </span><a href="TyCoRep.html#substCo"><span class="hs-identifier hs-var">substCo</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><a href="#local-1627604103"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627604104"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1867"></a><span>
</span><a name="line-1868"></a><span class="hs-comment">-- | Coercion substitution, see 'zipTvSubst'. Disables sanity checks.</span><span>
</span><a name="line-1869"></a><span class="hs-comment">-- The problems that the sanity checks in substCo catch are described in</span><span>
</span><a name="line-1870"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-1871"></a><span class="hs-comment">-- The goal of #11371 is to migrate all the calls of substCoUnchecked to</span><span>
</span><a name="line-1872"></a><span class="hs-comment">-- substCo and remove this function. Please don't use in new code.</span><span>
</span><a name="line-1873"></a><span class="hs-identifier">substCoWithUnchecked</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1874"></a><a name="substCoWithUnchecked"><a href="TyCoRep.html#substCoWithUnchecked"><span class="hs-identifier">substCoWithUnchecked</span></a></a><span> </span><a name="local-1627604105"><a href="#local-1627604105"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627604106"><a href="#local-1627604106"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1875"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-operator">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604105"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1876"></a><span>    </span><a href="TyCoRep.html#substCoUnchecked"><span class="hs-identifier hs-var">substCoUnchecked</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><a href="#local-1627604105"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627604106"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1877"></a><span>
</span><a name="line-1878"></a><span>
</span><a name="line-1879"></a><span>
</span><a name="line-1880"></a><span class="hs-comment">-- | Substitute covars within a type</span><span>
</span><a name="line-1881"></a><span class="hs-identifier">substTyWithCoVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1882"></a><a name="substTyWithCoVars"><a href="TyCoRep.html#substTyWithCoVars"><span class="hs-identifier">substTyWithCoVars</span></a></a><span> </span><a name="local-1627604107"><a href="#local-1627604107"><span class="hs-identifier">cvs</span></a></a><span> </span><a name="local-1627604108"><a href="#local-1627604108"><span class="hs-identifier">cos</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#zipCvSubst"><span class="hs-identifier hs-var">zipCvSubst</span></a><span> </span><a href="#local-1627604107"><span class="hs-identifier hs-var">cvs</span></a><span> </span><a href="#local-1627604108"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-1883"></a><span>
</span><a name="line-1884"></a><span class="hs-comment">-- | Type substitution, see 'zipTvSubst'</span><span>
</span><a name="line-1885"></a><span class="hs-identifier">substTysWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1886"></a><a name="substTysWith"><a href="TyCoRep.html#substTysWith"><span class="hs-identifier">substTysWith</span></a></a><span> </span><a name="local-1627604109"><a href="#local-1627604109"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627604110"><a href="#local-1627604110"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-operator">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604109"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1887"></a><span>                       </span><a href="TyCoRep.html#substTys"><span class="hs-identifier hs-var">substTys</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><a href="#local-1627604109"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627604110"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1888"></a><span>
</span><a name="line-1889"></a><span class="hs-comment">-- | Type substitution, see 'zipTvSubst'</span><span>
</span><a name="line-1890"></a><span class="hs-identifier">substTysWithCoVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1891"></a><a name="substTysWithCoVars"><a href="TyCoRep.html#substTysWithCoVars"><span class="hs-identifier">substTysWithCoVars</span></a></a><span> </span><a name="local-1627604111"><a href="#local-1627604111"><span class="hs-identifier">cvs</span></a></a><span> </span><a name="local-1627604112"><a href="#local-1627604112"><span class="hs-identifier">cos</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">cvs</span><span> </span><span class="hs-operator">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604111"><span class="hs-identifier hs-var">cos</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1892"></a><span>                             </span><a href="TyCoRep.html#substTys"><span class="hs-identifier hs-var">substTys</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#zipCvSubst"><span class="hs-identifier hs-var">zipCvSubst</span></a><span> </span><a href="#local-1627604111"><span class="hs-identifier hs-var">cvs</span></a><span> </span><a href="#local-1627604112"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-1893"></a><span>
</span><a name="line-1894"></a><span class="hs-comment">-- | Type substitution using 'Binder's. Anonymous binders</span><span>
</span><a name="line-1895"></a><span class="hs-comment">-- simply ignore their matching type.</span><span>
</span><a name="line-1896"></a><span class="hs-identifier">substTyWithBinders</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-1897"></a><span class="hs-comment">-- CallStack wasn't present in GHC 7.10.1, disable callstacks in stage 1</span><span>
</span><a name="line-1898"></a><span class="hs-cpp">#if MIN_VERSION_GLASGOW_HASKELL(7,10,2,0)</span><span>
</span><a name="line-1899"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">?</span><span class="hs-identifier">callStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#CallStack"><span class="hs-identifier hs-type">CallStack</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-1900"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1901"></a><span>    </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1902"></a><a name="substTyWithBinders"><a href="TyCoRep.html#substTyWithBinders"><span class="hs-identifier">substTyWithBinders</span></a></a><span> </span><a name="local-1627604113"><a href="#local-1627604113"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-1627604114"><a href="#local-1627604114"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">bndrs</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">length</span><span> </span><a href="#local-1627604113"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1903"></a><span>                               </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#zipTyBinderSubst"><span class="hs-identifier hs-var">zipTyBinderSubst</span></a><span> </span><a href="#local-1627604113"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-1627604114"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1904"></a><span>
</span><a name="line-1905"></a><span class="hs-comment">-- | Type substitution using 'Binder's disabling the sanity checks.</span><span>
</span><a name="line-1906"></a><span class="hs-comment">-- Anonymous binders simply ignore their matching type.</span><span>
</span><a name="line-1907"></a><span class="hs-comment">-- The problems that the sanity checks in substTy catch are described in</span><span>
</span><a name="line-1908"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-1909"></a><span class="hs-comment">-- The goal of #11371 is to migrate all the calls of substTyUnchecked to</span><span>
</span><a name="line-1910"></a><span class="hs-comment">-- substTy and remove this function. Please don't use in new code.</span><span>
</span><a name="line-1911"></a><span class="hs-identifier">substTyWithBindersUnchecked</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1912"></a><a name="substTyWithBindersUnchecked"><a href="TyCoRep.html#substTyWithBindersUnchecked"><span class="hs-identifier">substTyWithBindersUnchecked</span></a></a><span> </span><a name="local-1627604115"><a href="#local-1627604115"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-1627604116"><a href="#local-1627604116"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1913"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">bndrs</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">length</span><span> </span><a href="#local-1627604115"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1914"></a><span>    </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#zipTyBinderSubst"><span class="hs-identifier hs-var">zipTyBinderSubst</span></a><span> </span><a href="#local-1627604115"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-1627604116"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1915"></a><span>
</span><a name="line-1916"></a><span class="hs-comment">-- | Substitute within a 'Type' after adding the free variables of the type</span><span>
</span><a name="line-1917"></a><span class="hs-comment">-- to the in-scope set. This is useful for the case when the free variables</span><span>
</span><a name="line-1918"></a><span class="hs-comment">-- aren't already in the in-scope set or easily available.</span><span>
</span><a name="line-1919"></a><span class="hs-comment">-- See also Note [The substitution invariant].</span><span>
</span><a name="line-1920"></a><span class="hs-identifier">substTyAddInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1921"></a><a name="substTyAddInScope"><a href="TyCoRep.html#substTyAddInScope"><span class="hs-identifier">substTyAddInScope</span></a></a><span> </span><a name="local-1627604117"><a href="#local-1627604117"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627604118"><a href="#local-1627604118"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1922"></a><span>  </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#extendTCvInScopeSet"><span class="hs-identifier hs-var">extendTCvInScopeSet</span></a><span> </span><a href="#local-1627604117"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627604118"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604118"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1923"></a><span>
</span><a name="line-1924"></a><span class="hs-comment">-- | When calling `substTy` it should be the case that the in-scope set in</span><span>
</span><a name="line-1925"></a><span class="hs-comment">-- the substitution is a superset of the free vars of the range of the</span><span>
</span><a name="line-1926"></a><span class="hs-comment">-- substitution.</span><span>
</span><a name="line-1927"></a><span class="hs-comment">-- See also Note [The substitution invariant].</span><span>
</span><a name="line-1928"></a><span class="hs-identifier">isValidTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1929"></a><a name="isValidTCvSubst"><a href="TyCoRep.html#isValidTCvSubst"><span class="hs-identifier">isValidTCvSubst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><a name="local-1627604119"><a href="#local-1627604119"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627604120"><a href="#local-1627604120"><span class="hs-identifier">tenv</span></a></a><span> </span><a name="local-1627604121"><a href="#local-1627604121"><span class="hs-identifier">cenv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1930"></a><span>  </span><span class="hs-special">(</span><a href="#local-1627604122"><span class="hs-identifier hs-var">tenvFVs</span></a><span> </span><span class="hs-special">`</span><a href="VarEnv.html#varSetInScope"><span class="hs-identifier hs-var">varSetInScope</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627604119"><span class="hs-identifier hs-var">in_scope</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-1931"></a><span>  </span><span class="hs-special">(</span><a href="#local-1627604123"><span class="hs-identifier hs-var">cenvFVs</span></a><span> </span><span class="hs-special">`</span><a href="VarEnv.html#varSetInScope"><span class="hs-identifier hs-var">varSetInScope</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627604119"><span class="hs-identifier hs-var">in_scope</span></a><span class="hs-special">)</span><span>
</span><a name="line-1932"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1933"></a><span>  </span><a name="local-1627604122"><a href="#local-1627604122"><span class="hs-identifier">tenvFVs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarEnv.html#varEnvElts"><span class="hs-identifier hs-var">varEnvElts</span></a><span> </span><a href="#local-1627604120"><span class="hs-identifier hs-var">tenv</span></a><span>
</span><a name="line-1934"></a><span>  </span><a name="local-1627604123"><a href="#local-1627604123"><span class="hs-identifier">cenvFVs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCos"><span class="hs-identifier hs-var">tyCoVarsOfCos</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarEnv.html#varEnvElts"><span class="hs-identifier hs-var">varEnvElts</span></a><span> </span><a href="#local-1627604121"><span class="hs-identifier hs-var">cenv</span></a><span>
</span><a name="line-1935"></a><span>
</span><a name="line-1936"></a><span class="hs-comment">-- | This checks if the substitution satisfies the invariant from</span><span>
</span><a name="line-1937"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-1938"></a><span class="hs-identifier">checkValidSubst</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-1939"></a><span class="hs-cpp">#if MIN_VERSION_GLASGOW_HASKELL(7,10,2,0)</span><span>
</span><a name="line-1940"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">?</span><span class="hs-identifier">callStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#CallStack"><span class="hs-identifier hs-type">CallStack</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-1941"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1942"></a><span>    </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627603743"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627603743"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1943"></a><a name="checkValidSubst"><a href="TyCoRep.html#checkValidSubst"><span class="hs-identifier">checkValidSubst</span></a></a><span> </span><a name="local-1627604124"><a href="#local-1627604124"><span class="hs-identifier">subst</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><a name="local-1627604125"><a href="#local-1627604125"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627604126"><a href="#local-1627604126"><span class="hs-identifier">tenv</span></a></a><span> </span><a name="local-1627604127"><a href="#local-1627604127"><span class="hs-identifier">cenv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604128"><a href="#local-1627604128"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-1627604129"><a href="#local-1627604129"><span class="hs-identifier">cos</span></a></a><span> </span><a name="local-1627604130"><a href="#local-1627604130"><span class="hs-identifier">a</span></a></a><span>
</span><a name="line-1944"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">isValidTCvSubst</span></a><span> </span><a href="TyCoRep.html#isValidTCvSubst"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">,</span><span>
</span><a name="line-1945"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;in_scope&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-operator">$$</span><span>
</span><a name="line-1946"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;tenv&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-operator">$$</span><span>
</span><a name="line-1947"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;tenvFVs&quot;</span><span>
</span><a name="line-1948"></a><span>               </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfTypes</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">varEnvElts</span><span> </span><span class="hs-identifier">tenv</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$$</span><span>
</span><a name="line-1949"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;cenv&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">cenv</span><span> </span><span class="hs-operator">$$</span><span>
</span><a name="line-1950"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;cenvFVs&quot;</span><span>
</span><a name="line-1951"></a><span>               </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyCoVarsOfCos</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">varEnvElts</span><span> </span><span class="hs-identifier">cenv</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$$</span><span>
</span><a name="line-1952"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;tys&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-operator">$$</span><span>
</span><a name="line-1953"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;cos&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">cos</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1954"></a><span>    </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tysCosFVsInScope</span><span class="hs-special">,</span><span>
</span><a name="line-1955"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;in_scope&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">in_scope</span><span> </span><span class="hs-operator">$$</span><span>
</span><a name="line-1956"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;tenv&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tenv</span><span> </span><span class="hs-operator">$$</span><span>
</span><a name="line-1957"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;cenv&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">cenv</span><span> </span><span class="hs-operator">$$</span><span>
</span><a name="line-1958"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;tys&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-operator">$$</span><span>
</span><a name="line-1959"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;cos&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">cos</span><span> </span><span class="hs-operator">$$</span><span>
</span><a name="line-1960"></a><span>             </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;needInScope&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">needInScope</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1961"></a><span>    </span><a href="#local-1627604130"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1962"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1963"></a><span>  </span><a name="local-1627604131"><a href="#local-1627604131"><span class="hs-identifier">substDomain</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#varEnvKeys"><span class="hs-identifier hs-var">varEnvKeys</span></a><span> </span><a href="#local-1627604126"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="VarEnv.html#varEnvKeys"><span class="hs-identifier hs-var">varEnvKeys</span></a><span> </span><a href="#local-1627604127"><span class="hs-identifier hs-var">cenv</span></a><span>
</span><a name="line-1964"></a><span>  </span><a name="local-1627604132"><a href="#local-1627604132"><span class="hs-identifier">needInScope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1627604128"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCos"><span class="hs-identifier hs-var">tyCoVarsOfCos</span></a><span> </span><a href="#local-1627604129"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-1965"></a><span>                  </span><span class="hs-special">`</span><a href="UniqFM.html#delListFromUFM_Directly"><span class="hs-identifier hs-var">delListFromUFM_Directly</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627604131"><span class="hs-identifier hs-var">substDomain</span></a><span>
</span><a name="line-1966"></a><span>  </span><a name="local-1627604133"><a href="#local-1627604133"><span class="hs-identifier">tysCosFVsInScope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604132"><span class="hs-identifier hs-var">needInScope</span></a><span> </span><span class="hs-special">`</span><a href="VarEnv.html#varSetInScope"><span class="hs-identifier hs-var">varSetInScope</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627604125"><span class="hs-identifier hs-var">in_scope</span></a><span>
</span><a name="line-1967"></a><span>
</span><a name="line-1968"></a><span>
</span><a name="line-1969"></a><span class="hs-comment">-- | Substitute within a 'Type'</span><span>
</span><a name="line-1970"></a><span class="hs-comment">-- The substitution has to satisfy the invariants described in</span><span>
</span><a name="line-1971"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-1972"></a><span class="hs-identifier">substTy</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-1973"></a><span class="hs-comment">-- CallStack wasn't present in GHC 7.10.1, disable callstacks in stage 1</span><span>
</span><a name="line-1974"></a><span class="hs-cpp">#if MIN_VERSION_GLASGOW_HASKELL(7,10,2,0)</span><span>
</span><a name="line-1975"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">?</span><span class="hs-identifier">callStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#CallStack"><span class="hs-identifier hs-type">CallStack</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-1976"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1977"></a><span>    </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1978"></a><a name="substTy"><a href="TyCoRep.html#substTy"><span class="hs-identifier">substTy</span></a></a><span> </span><a name="local-1627604134"><a href="#local-1627604134"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627604135"><a href="#local-1627604135"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1979"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a><span> </span><a href="#local-1627604134"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604135"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1980"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#checkValidSubst"><span class="hs-identifier hs-var">checkValidSubst</span></a><span> </span><a href="#local-1627604134"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627604135"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#subst_ty"><span class="hs-identifier hs-var">subst_ty</span></a><span> </span><a href="#local-1627604134"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604135"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1981"></a><span>
</span><a name="line-1982"></a><span class="hs-comment">-- | Substitute within a 'Type' disabling the sanity checks.</span><span>
</span><a name="line-1983"></a><span class="hs-comment">-- The problems that the sanity checks in substTy catch are described in</span><span>
</span><a name="line-1984"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-1985"></a><span class="hs-comment">-- The goal of #11371 is to migrate all the calls of substTyUnchecked to</span><span>
</span><a name="line-1986"></a><span class="hs-comment">-- substTy and remove this function. Please don't use in new code.</span><span>
</span><a name="line-1987"></a><span class="hs-identifier">substTyUnchecked</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1988"></a><a name="substTyUnchecked"><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier">substTyUnchecked</span></a></a><span> </span><a name="local-1627604136"><a href="#local-1627604136"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627604137"><a href="#local-1627604137"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1989"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a><span> </span><a href="#local-1627604136"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604137"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1990"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#subst_ty"><span class="hs-identifier hs-var">subst_ty</span></a><span> </span><a href="#local-1627604136"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604137"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1991"></a><span>
</span><a name="line-1992"></a><span class="hs-comment">-- | Substitute within several 'Type's</span><span>
</span><a name="line-1993"></a><span class="hs-comment">-- The substitution has to satisfy the invariants described in</span><span>
</span><a name="line-1994"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-1995"></a><span class="hs-identifier">substTys</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-1996"></a><span class="hs-comment">-- CallStack wasn't present in GHC 7.10.1, disable callstacks in stage 1</span><span>
</span><a name="line-1997"></a><span class="hs-cpp">#if MIN_VERSION_GLASGOW_HASKELL(7,10,2,0)</span><span>
</span><a name="line-1998"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">?</span><span class="hs-identifier">callStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#CallStack"><span class="hs-identifier hs-type">CallStack</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-1999"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-2000"></a><span>    </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-2001"></a><a name="substTys"><a href="TyCoRep.html#substTys"><span class="hs-identifier">substTys</span></a></a><span> </span><a name="local-1627604138"><a href="#local-1627604138"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627604139"><a href="#local-1627604139"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2002"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a><span> </span><a href="#local-1627604138"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604139"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2003"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#checkValidSubst"><span class="hs-identifier hs-var">checkValidSubst</span></a><span> </span><a href="#local-1627604138"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604139"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#subst_ty"><span class="hs-identifier hs-var">subst_ty</span></a><span> </span><a href="#local-1627604138"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604139"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2004"></a><span>
</span><a name="line-2005"></a><span class="hs-comment">-- | Substitute within several 'Type's disabling the sanity checks.</span><span>
</span><a name="line-2006"></a><span class="hs-comment">-- The problems that the sanity checks in substTys catch are described in</span><span>
</span><a name="line-2007"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-2008"></a><span class="hs-comment">-- The goal of #11371 is to migrate all the calls of substTysUnchecked to</span><span>
</span><a name="line-2009"></a><span class="hs-comment">-- substTys and remove this function. Please don't use in new code.</span><span>
</span><a name="line-2010"></a><span class="hs-identifier">substTysUnchecked</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-2011"></a><a name="substTysUnchecked"><a href="TyCoRep.html#substTysUnchecked"><span class="hs-identifier">substTysUnchecked</span></a></a><span> </span><a name="local-1627604140"><a href="#local-1627604140"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627604141"><a href="#local-1627604141"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2012"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a><span> </span><a href="#local-1627604140"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604141"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2013"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#subst_ty"><span class="hs-identifier hs-var">subst_ty</span></a><span> </span><a href="#local-1627604140"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604141"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2014"></a><span>
</span><a name="line-2015"></a><span class="hs-comment">-- | Substitute within a 'ThetaType'</span><span>
</span><a name="line-2016"></a><span class="hs-comment">-- The substitution has to satisfy the invariants described in</span><span>
</span><a name="line-2017"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-2018"></a><span class="hs-identifier">substTheta</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-2019"></a><span class="hs-comment">-- CallStack wasn't present in GHC 7.10.1, disable callstacks in stage 1</span><span>
</span><a name="line-2020"></a><span class="hs-cpp">#if MIN_VERSION_GLASGOW_HASKELL(7,10,2,0)</span><span>
</span><a name="line-2021"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">?</span><span class="hs-identifier">callStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#CallStack"><span class="hs-identifier hs-type">CallStack</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-2022"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-2023"></a><span>    </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>
</span><a name="line-2024"></a><a name="substTheta"><a href="TyCoRep.html#substTheta"><span class="hs-identifier">substTheta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTys"><span class="hs-identifier hs-var">substTys</span></a><span>
</span><a name="line-2025"></a><span>
</span><a name="line-2026"></a><span class="hs-comment">-- | Substitute within a 'ThetaType' disabling the sanity checks.</span><span>
</span><a name="line-2027"></a><span class="hs-comment">-- The problems that the sanity checks in substTys catch are described in</span><span>
</span><a name="line-2028"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-2029"></a><span class="hs-comment">-- The goal of #11371 is to migrate all the calls of substThetaUnchecked to</span><span>
</span><a name="line-2030"></a><span class="hs-comment">-- substTheta and remove this function. Please don't use in new code.</span><span>
</span><a name="line-2031"></a><span class="hs-identifier">substThetaUnchecked</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>
</span><a name="line-2032"></a><a name="substThetaUnchecked"><a href="TyCoRep.html#substThetaUnchecked"><span class="hs-identifier">substThetaUnchecked</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTysUnchecked"><span class="hs-identifier hs-var">substTysUnchecked</span></a><span>
</span><a name="line-2033"></a><span>
</span><a name="line-2034"></a><span>
</span><a name="line-2035"></a><span class="hs-identifier">subst_ty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2036"></a><span class="hs-comment">-- subst_ty is the main workhorse for type substitution</span><span>
</span><a name="line-2037"></a><span class="hs-comment">--</span><span>
</span><a name="line-2038"></a><span class="hs-comment">-- Note that the in_scope set is poked only if we hit a forall</span><span>
</span><a name="line-2039"></a><span class="hs-comment">-- so it may often never be fully computed</span><span>
</span><a name="line-2040"></a><a name="subst_ty"><a href="TyCoRep.html#subst_ty"><span class="hs-identifier">subst_ty</span></a></a><span> </span><a name="local-1627604142"><a href="#local-1627604142"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627604143"><a href="#local-1627604143"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2041"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604144"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604143"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2042"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2043"></a><span>    </span><a name="local-1627604144"><a href="#local-1627604144"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-1627604145"><a href="#local-1627604145"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyVar"><span class="hs-identifier hs-var">substTyVar</span></a><span> </span><a href="#local-1627604142"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604145"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2044"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-1627604146"><a href="#local-1627604146"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-1627604147"><a href="#local-1627604147"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604144"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604146"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604144"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604147"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2045"></a><span>                </span><span class="hs-comment">-- The mkAppTy smart constructor is important</span><span>
</span><a name="line-2046"></a><span>                </span><span class="hs-comment">-- we might be replacing (a Int), represented with App</span><span>
</span><a name="line-2047"></a><span>                </span><span class="hs-comment">-- by [Int], represented with TyConApp</span><span>
</span><a name="line-2048"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-1627604148"><a href="#local-1627604148"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604149"><a href="#local-1627604149"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627604150"><a href="#local-1627604150"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627604144"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604149"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2049"></a><span>                           </span><span class="hs-keyword">in</span><span>  </span><a href="#local-1627604150"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#seqList"><span class="hs-identifier hs-var">seqList</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="#local-1627604148"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604150"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2050"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-1627604151"><a href="#local-1627604151"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604152"><a href="#local-1627604152"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2051"></a><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604144"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604151"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604144"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604152"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-2052"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-1627604153"><a href="#local-1627604153"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1627604154"><a href="#local-1627604154"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604155"><a href="#local-1627604155"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2053"></a><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TyCoRep.html#substTyVarBndrUnchecked"><span class="hs-identifier hs-var">substTyVarBndrUnchecked</span></a><span> </span><a href="#local-1627604142"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604153"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2054"></a><span>                             </span><span class="hs-special">(</span><a name="local-1627604156"><a href="#local-1627604156"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604157"><a href="#local-1627604157"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2055"></a><span>                               </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604157"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604154"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span>
</span><a name="line-2056"></a><span>                                            </span><span class="hs-special">(</span><a href="TyCoRep.html#subst_ty"><span class="hs-identifier hs-var">subst_ty</span></a><span> </span><a href="#local-1627604156"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-1627604155"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2057"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-1627604158"><a href="#local-1627604158"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604158"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-2058"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-1627604159"><a href="#local-1627604159"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1627604160"><a href="#local-1627604160"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604144"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604159"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#subst_co"><span class="hs-identifier hs-var">subst_co</span></a><span> </span><a href="#local-1627604142"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604160"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2059"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-1627604161"><a href="#local-1627604161"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#subst_co"><span class="hs-identifier hs-var">subst_co</span></a><span> </span><a href="#local-1627604142"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604161"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2060"></a><span>
</span><a name="line-2061"></a><span class="hs-identifier">substTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2062"></a><a name="substTyVar"><a href="TyCoRep.html#substTyVar"><span class="hs-identifier">substTyVar</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627604162"><a href="#local-1627604162"><span class="hs-identifier">tenv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1627604163"><a href="#local-1627604163"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2063"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier hs-var">tv</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2064"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1627604162"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="#local-1627604163"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2065"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627604164"><a href="#local-1627604164"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627604164"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2066"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a href="#local-1627604163"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2067"></a><span>
</span><a name="line-2068"></a><span class="hs-identifier">substTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-2069"></a><a name="substTyVars"><a href="TyCoRep.html#substTyVars"><span class="hs-identifier">substTyVars</span></a></a><span> </span><a name="local-1627604165"><a href="#local-1627604165"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#substTyVar"><span class="hs-identifier hs-var">substTyVar</span></a><span> </span><a href="#local-1627604165"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-2070"></a><span>
</span><a name="line-2071"></a><span class="hs-identifier">lookupTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2072"></a><span>        </span><span class="hs-comment">-- See Note [Extending the TCvSubst]</span><span>
</span><a name="line-2073"></a><a name="lookupTyVar"><a href="TyCoRep.html#lookupTyVar"><span class="hs-identifier">lookupTyVar</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627604166"><a href="#local-1627604166"><span class="hs-identifier">tenv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1627604167"><a href="#local-1627604167"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2074"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier hs-var">tv</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2075"></a><span>    </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1627604166"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="#local-1627604167"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2076"></a><span>
</span><a name="line-2077"></a><span class="hs-comment">-- | Substitute within a 'Coercion'</span><span>
</span><a name="line-2078"></a><span class="hs-comment">-- The substitution has to satisfy the invariants described in</span><span>
</span><a name="line-2079"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-2080"></a><span class="hs-identifier">substCo</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-2081"></a><span class="hs-comment">-- CallStack wasn't present in GHC 7.10.1, disable callstacks in stage 1</span><span>
</span><a name="line-2082"></a><span class="hs-cpp">#if MIN_VERSION_GLASGOW_HASKELL(7,10,2,0)</span><span>
</span><a name="line-2083"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">?</span><span class="hs-identifier">callStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#CallStack"><span class="hs-identifier hs-type">CallStack</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-2084"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-2085"></a><span>    </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2086"></a><a name="substCo"><a href="TyCoRep.html#substCo"><span class="hs-identifier">substCo</span></a></a><span> </span><a name="local-1627604168"><a href="#local-1627604168"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627604169"><a href="#local-1627604169"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-2087"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a><span> </span><a href="#local-1627604168"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604169"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2088"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#checkValidSubst"><span class="hs-identifier hs-var">checkValidSubst</span></a><span> </span><a href="#local-1627604168"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627604169"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#subst_co"><span class="hs-identifier hs-var">subst_co</span></a><span> </span><a href="#local-1627604168"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604169"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2089"></a><span>
</span><a name="line-2090"></a><span class="hs-comment">-- | Substitute within a 'Coercion' disabling sanity checks.</span><span>
</span><a name="line-2091"></a><span class="hs-comment">-- The problems that the sanity checks in substCo catch are described in</span><span>
</span><a name="line-2092"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-2093"></a><span class="hs-comment">-- The goal of #11371 is to migrate all the calls of substCoUnchecked to</span><span>
</span><a name="line-2094"></a><span class="hs-comment">-- substCo and remove this function. Please don't use in new code.</span><span>
</span><a name="line-2095"></a><span class="hs-identifier">substCoUnchecked</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2096"></a><a name="substCoUnchecked"><a href="TyCoRep.html#substCoUnchecked"><span class="hs-identifier">substCoUnchecked</span></a></a><span> </span><a name="local-1627604170"><a href="#local-1627604170"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627604171"><a href="#local-1627604171"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-2097"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a><span> </span><a href="#local-1627604170"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604171"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2098"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#subst_co"><span class="hs-identifier hs-var">subst_co</span></a><span> </span><a href="#local-1627604170"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604171"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2099"></a><span>
</span><a name="line-2100"></a><span class="hs-comment">-- | Substitute within several 'Coercion's</span><span>
</span><a name="line-2101"></a><span class="hs-comment">-- The substitution has to satisfy the invariants described in</span><span>
</span><a name="line-2102"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-2103"></a><span class="hs-identifier">substCos</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-2104"></a><span class="hs-comment">-- CallStack wasn't present in GHC 7.10.1, disable callstacks in stage 1</span><span>
</span><a name="line-2105"></a><span class="hs-cpp">#if MIN_VERSION_GLASGOW_HASKELL(7,10,2,0)</span><span>
</span><a name="line-2106"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">?</span><span class="hs-identifier">callStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#CallStack"><span class="hs-identifier hs-type">CallStack</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-2107"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-2108"></a><span>    </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>
</span><a name="line-2109"></a><a name="substCos"><a href="TyCoRep.html#substCos"><span class="hs-identifier">substCos</span></a></a><span> </span><a name="local-1627604172"><a href="#local-1627604172"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627604173"><a href="#local-1627604173"><span class="hs-identifier">cos</span></a></a><span>
</span><a name="line-2110"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a><span> </span><a href="#local-1627604172"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604173"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-2111"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#checkValidSubst"><span class="hs-identifier hs-var">checkValidSubst</span></a><span> </span><a href="#local-1627604172"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1627604173"><span class="hs-identifier hs-var">cos</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#subst_co"><span class="hs-identifier hs-var">subst_co</span></a><span> </span><a href="#local-1627604172"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604173"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-2112"></a><span>
</span><a name="line-2113"></a><span class="hs-identifier">subst_co</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2114"></a><a name="subst_co"><a href="TyCoRep.html#subst_co"><span class="hs-identifier">subst_co</span></a></a><span> </span><a name="local-1627604174"><a href="#local-1627604174"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627604175"><a href="#local-1627604175"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-2115"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604175"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2116"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2117"></a><span>    </span><span class="hs-identifier">go_ty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2118"></a><span>    </span><a name="local-1627604176"><a href="#local-1627604176"><span class="hs-identifier">go_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#subst_ty"><span class="hs-identifier hs-var">subst_ty</span></a><span> </span><a href="#local-1627604174"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-2119"></a><span>
</span><a name="line-2120"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2121"></a><span>    </span><a name="local-1627604177"><a href="#local-1627604177"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-1627604179"><a href="#local-1627604179"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-1627604180"><a href="#local-1627604180"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><a href="#local-1627604179"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604176"><span class="hs-identifier hs-var">go_ty</span></a><span> </span><a href="#local-1627604180"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2122"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a name="local-1627604181"><a href="#local-1627604181"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-1627604182"><a href="#local-1627604182"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604183"><a href="#local-1627604183"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627604184"><a href="#local-1627604184"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604183"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2123"></a><span>                               </span><span class="hs-keyword">in</span><span>  </span><a href="#local-1627604184"><span class="hs-identifier hs-var">args'</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#seqList"><span class="hs-identifier hs-var">seqList</span></a><span class="hs-special">`</span><span> </span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span> </span><a href="#local-1627604181"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-1627604182"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604184"><span class="hs-identifier hs-var">args'</span></a><span>
</span><a name="line-2124"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-1627604185"><a href="#local-1627604185"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-1627604186"><a href="#local-1627604186"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604185"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604186"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2125"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-1627604187"><a href="#local-1627604187"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1627604188"><a href="#local-1627604188"><span class="hs-identifier">kind_co</span></a></a><span> </span><a name="local-1627604189"><a href="#local-1627604189"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2126"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TyCoRep.html#substForAllCoBndrUnchecked"><span class="hs-identifier hs-var">substForAllCoBndrUnchecked</span></a><span> </span><a href="#local-1627604174"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604187"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1627604188"><span class="hs-identifier hs-var">kind_co</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1627604190"><a href="#local-1627604190"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604191"><a href="#local-1627604191"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604192"><a href="#local-1627604192"><span class="hs-identifier">kind_co'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2127"></a><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604191"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604192"><span class="hs-identifier hs-var">kind_co'</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="TyCoRep.html#subst_co"><span class="hs-identifier hs-var">subst_co</span></a><span> </span><a href="#local-1627604190"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-1627604189"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2128"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-1627604193"><a href="#local-1627604193"><span class="hs-identifier">cv</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substCoVar"><span class="hs-identifier hs-var">substCoVar</span></a><span> </span><a href="#local-1627604174"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604193"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-2129"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><a name="local-1627604194"><a href="#local-1627604194"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-1627604195"><a href="#local-1627604195"><span class="hs-identifier">ind</span></a></a><span> </span><a name="local-1627604196"><a href="#local-1627604196"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var">mkAxiomInstCo</span></a><span> </span><a href="#local-1627604194"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-1627604195"><span class="hs-identifier hs-var">ind</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604196"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-2130"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a name="local-1627604197"><a href="#local-1627604197"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604198"><a href="#local-1627604198"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-1627604199"><a href="#local-1627604199"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-1627604200"><a href="#local-1627604200"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604178"><span class="hs-identifier hs-var">go_prov</span></a><span> </span><a href="#local-1627604197"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604198"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span>
</span><a name="line-2131"></a><span>                                </span><span class="hs-special">(</span><a href="#local-1627604176"><span class="hs-identifier hs-var">go_ty</span></a><span> </span><a href="#local-1627604199"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604176"><span class="hs-identifier hs-var">go_ty</span></a><span> </span><a href="#local-1627604200"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2132"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-1627604201"><a href="#local-1627604201"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604201"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2133"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-1627604202"><a href="#local-1627604202"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-1627604203"><a href="#local-1627604203"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604202"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604203"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2134"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a name="local-1627604204"><a href="#local-1627604204"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-1627604205"><a href="#local-1627604205"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><a href="#local-1627604204"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604205"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2135"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><a name="local-1627604206"><a href="#local-1627604206"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-1627604207"><a href="#local-1627604207"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkLRCo"><span class="hs-identifier hs-var">mkLRCo</span></a><span> </span><a href="#local-1627604206"><span class="hs-identifier hs-var">lr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604207"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2136"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-1627604208"><a href="#local-1627604208"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-1627604209"><a href="#local-1627604209"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604208"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604209"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2137"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a name="local-1627604210"><a href="#local-1627604210"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-1627604211"><a href="#local-1627604211"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkCoherenceCo"><span class="hs-identifier hs-var">mkCoherenceCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604210"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604211"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2138"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a name="local-1627604212"><a href="#local-1627604212"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604212"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2139"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-1627604213"><a href="#local-1627604213"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604213"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2140"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><a name="local-1627604214"><a href="#local-1627604214"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-1627604215"><a href="#local-1627604215"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627604216"><a href="#local-1627604216"><span class="hs-identifier">cs1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604215"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-2141"></a><span>                                </span><span class="hs-keyword">in</span><span> </span><a href="#local-1627604216"><span class="hs-identifier hs-var">cs1</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#seqList"><span class="hs-identifier hs-var">seqList</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><a href="#local-1627604214"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-1627604216"><span class="hs-identifier hs-var">cs1</span></a><span>
</span><a name="line-2142"></a><span>
</span><a name="line-2143"></a><span>    </span><a name="local-1627604178"><a href="#local-1627604178"><span class="hs-identifier">go_prov</span></a></a><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>
</span><a name="line-2144"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a name="local-1627604217"><a href="#local-1627604217"><span class="hs-identifier">kco</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604217"><span class="hs-identifier hs-var">kco</span></a><span class="hs-special">)</span><span>
</span><a name="line-2145"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><a name="local-1627604218"><a href="#local-1627604218"><span class="hs-identifier">kco</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604177"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604218"><span class="hs-identifier hs-var">kco</span></a><span class="hs-special">)</span><span>
</span><a name="line-2146"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><a name="local-1627604219"><a href="#local-1627604219"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604219"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-2147"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><a name="local-1627604220"><a href="#local-1627604220"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#HoleProv"><span class="hs-identifier hs-var">HoleProv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604220"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-2148"></a><span>      </span><span class="hs-comment">-- NB: this last case is a little suspicious, but we need it. Originally,</span><span>
</span><a name="line-2149"></a><span>      </span><span class="hs-comment">-- there was a panic here, but it triggered from deeplySkolemise. Because</span><span>
</span><a name="line-2150"></a><span>      </span><span class="hs-comment">-- we only skolemise tyvars that are manually bound, this operation makes</span><span>
</span><a name="line-2151"></a><span>      </span><span class="hs-comment">-- sense, even over a coercion with holes.</span><span>
</span><a name="line-2152"></a><span>
</span><a name="line-2153"></a><span class="hs-identifier">substForAllCoBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-2154"></a><a name="substForAllCoBndr"><a href="TyCoRep.html#substForAllCoBndr"><span class="hs-identifier">substForAllCoBndr</span></a></a><span> </span><a name="local-1627604221"><a href="#local-1627604221"><span class="hs-identifier">subst</span></a></a><span>
</span><a name="line-2155"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substForAllCoBndrCallback"><span class="hs-identifier hs-var">substForAllCoBndrCallback</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substCo"><span class="hs-identifier hs-var">substCo</span></a><span> </span><a href="#local-1627604221"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604221"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-2156"></a><span>
</span><a name="line-2157"></a><span class="hs-comment">-- | Like 'substForAllCoBndr', but disables sanity checks.</span><span>
</span><a name="line-2158"></a><span class="hs-comment">-- The problems that the sanity checks in substCo catch are described in</span><span>
</span><a name="line-2159"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-2160"></a><span class="hs-comment">-- The goal of #11371 is to migrate all the calls of substCoUnchecked to</span><span>
</span><a name="line-2161"></a><span class="hs-comment">-- substCo and remove this function. Please don't use in new code.</span><span>
</span><a name="line-2162"></a><span class="hs-identifier">substForAllCoBndrUnchecked</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-2163"></a><a name="substForAllCoBndrUnchecked"><a href="TyCoRep.html#substForAllCoBndrUnchecked"><span class="hs-identifier">substForAllCoBndrUnchecked</span></a></a><span> </span><a name="local-1627604222"><a href="#local-1627604222"><span class="hs-identifier">subst</span></a></a><span>
</span><a name="line-2164"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substForAllCoBndrCallback"><span class="hs-identifier hs-var">substForAllCoBndrCallback</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substCoUnchecked"><span class="hs-identifier hs-var">substCoUnchecked</span></a><span> </span><a href="#local-1627604222"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604222"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-2165"></a><span>
</span><a name="line-2166"></a><span class="hs-comment">-- See Note [Sym and ForAllCo]</span><span>
</span><a name="line-2167"></a><span class="hs-identifier">substForAllCoBndrCallback</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>  </span><span class="hs-comment">-- apply sym to binder?</span><span>
</span><a name="line-2168"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- transformation to kind co</span><span>
</span><a name="line-2169"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2170"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-2171"></a><a name="substForAllCoBndrCallback"><a href="TyCoRep.html#substForAllCoBndrCallback"><span class="hs-identifier">substForAllCoBndrCallback</span></a></a><span> </span><a name="local-1627604223"><a href="#local-1627604223"><span class="hs-identifier">sym</span></a></a><span> </span><a name="local-1627604224"><a href="#local-1627604224"><span class="hs-identifier">sco</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><a name="local-1627604225"><a href="#local-1627604225"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627604226"><a href="#local-1627604226"><span class="hs-identifier">tenv</span></a></a><span> </span><a name="local-1627604227"><a href="#local-1627604227"><span class="hs-identifier">cenv</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2172"></a><span>                          </span><a name="local-1627604228"><a href="#local-1627604228"><span class="hs-identifier">old_var</span></a></a><span> </span><a name="local-1627604229"><a href="#local-1627604229"><span class="hs-identifier">old_kind_co</span></a></a><span>
</span><a name="line-2173"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604225"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">`</span><a href="VarEnv.html#extendInScopeSet"><span class="hs-identifier hs-var">extendInScopeSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627604235"><span class="hs-identifier hs-var">new_var</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604230"><span class="hs-identifier hs-var">new_env</span></a><span> </span><a href="#local-1627604227"><span class="hs-identifier hs-var">cenv</span></a><span>
</span><a name="line-2174"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-1627604235"><span class="hs-identifier hs-var">new_var</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604233"><span class="hs-identifier hs-var">new_kind_co</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2175"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2176"></a><span>    </span><a name="local-1627604230"><a href="#local-1627604230"><span class="hs-identifier">new_env</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604232"><span class="hs-identifier hs-var">no_change</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1627604223"><span class="hs-identifier hs-var">sym</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#delVarEnv"><span class="hs-identifier hs-var">delVarEnv</span></a><span> </span><a href="#local-1627604226"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="#local-1627604228"><span class="hs-identifier hs-var">old_var</span></a><span>
</span><a name="line-2177"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604223"><span class="hs-identifier hs-var">sym</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-1627604226"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="#local-1627604228"><span class="hs-identifier hs-var">old_var</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2178"></a><span>                            </span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a href="#local-1627604235"><span class="hs-identifier hs-var">new_var</span></a><span> </span><span class="hs-special">`</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627604233"><span class="hs-identifier hs-var">new_kind_co</span></a><span>
</span><a name="line-2179"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-1627604226"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="#local-1627604228"><span class="hs-identifier hs-var">old_var</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a href="#local-1627604235"><span class="hs-identifier hs-var">new_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-2180"></a><span>
</span><a name="line-2181"></a><span>    </span><a name="local-1627604231"><a href="#local-1627604231"><span class="hs-identifier">no_kind_change</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a><span> </span><a href="#local-1627604229"><span class="hs-identifier hs-var">old_kind_co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2182"></a><span>    </span><a name="local-1627604232"><a href="#local-1627604232"><span class="hs-identifier">no_change</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604231"><span class="hs-identifier hs-var">no_kind_change</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-1627604235"><span class="hs-identifier hs-var">new_var</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627604228"><span class="hs-identifier hs-var">old_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-2183"></a><span>
</span><a name="line-2184"></a><span>    </span><a name="local-1627604233"><a href="#local-1627604233"><span class="hs-identifier">new_kind_co</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604231"><span class="hs-identifier hs-var">no_kind_change</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604229"><span class="hs-identifier hs-var">old_kind_co</span></a><span>
</span><a name="line-2185"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604224"><span class="hs-identifier hs-var">sco</span></a><span> </span><a href="#local-1627604229"><span class="hs-identifier hs-var">old_kind_co</span></a><span>
</span><a name="line-2186"></a><span>
</span><a name="line-2187"></a><span>    </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-1627604234"><a href="#local-1627604234"><span class="hs-identifier">new_ki1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-1627604233"><span class="hs-identifier hs-var">new_kind_co</span></a><span>
</span><a name="line-2188"></a><span>
</span><a name="line-2189"></a><span>    </span><a name="local-1627604235"><a href="#local-1627604235"><span class="hs-identifier">new_var</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#uniqAway"><span class="hs-identifier hs-var">uniqAway</span></a><span> </span><a href="#local-1627604225"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a><span> </span><a href="#local-1627604228"><span class="hs-identifier hs-var">old_var</span></a><span> </span><a href="#local-1627604234"><span class="hs-identifier hs-var">new_ki1</span></a><span class="hs-special">)</span><span>
</span><a name="line-2190"></a><span>
</span><a name="line-2191"></a><span class="hs-identifier">substCoVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2192"></a><a name="substCoVar"><a href="TyCoRep.html#substCoVar"><span class="hs-identifier">substCoVar</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627604236"><a href="#local-1627604236"><span class="hs-identifier">cenv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604237"><a href="#local-1627604237"><span class="hs-identifier">cv</span></a></a><span>
</span><a name="line-2193"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1627604236"><span class="hs-identifier hs-var">cenv</span></a><span> </span><a href="#local-1627604237"><span class="hs-identifier hs-var">cv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2194"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627604238"><a href="#local-1627604238"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627604238"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2195"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a href="#local-1627604237"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-2196"></a><span>
</span><a name="line-2197"></a><span class="hs-identifier">substCoVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>
</span><a name="line-2198"></a><a name="substCoVars"><a href="TyCoRep.html#substCoVars"><span class="hs-identifier">substCoVars</span></a></a><span> </span><a name="local-1627604239"><a href="#local-1627604239"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627604240"><a href="#local-1627604240"><span class="hs-identifier">cvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substCoVar"><span class="hs-identifier hs-var">substCoVar</span></a><span> </span><a href="#local-1627604239"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604240"><span class="hs-identifier hs-var">cvs</span></a><span>
</span><a name="line-2199"></a><span>
</span><a name="line-2200"></a><span class="hs-identifier">lookupCoVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2201"></a><a name="lookupCoVar"><a href="TyCoRep.html#lookupCoVar"><span class="hs-identifier">lookupCoVar</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627604241"><a href="#local-1627604241"><span class="hs-identifier">cenv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604242"><a href="#local-1627604242"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1627604241"><span class="hs-identifier hs-var">cenv</span></a><span> </span><a href="#local-1627604242"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-2202"></a><span>
</span><a name="line-2203"></a><span class="hs-identifier">substTyVarBndr</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-2204"></a><span class="hs-comment">-- CallStack wasn't present in GHC 7.10.1, disable callstacks in stage 1</span><span>
</span><a name="line-2205"></a><span class="hs-cpp">#if MIN_VERSION_GLASGOW_HASKELL(7,10,2,0)</span><span>
</span><a name="line-2206"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">?</span><span class="hs-identifier">callStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#CallStack"><span class="hs-identifier hs-type">CallStack</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-2207"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-2208"></a><span>    </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2209"></a><a name="substTyVarBndr"><a href="TyCoRep.html#substTyVarBndr"><span class="hs-identifier">substTyVarBndr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyVarBndrCallback"><span class="hs-identifier hs-var">substTyVarBndrCallback</span></a><span> </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span>
</span><a name="line-2210"></a><span>
</span><a name="line-2211"></a><span class="hs-comment">-- | Like 'substTyVarBndr' but disables sanity checks.</span><span>
</span><a name="line-2212"></a><span class="hs-comment">-- The problems that the sanity checks in substTy catch are described in</span><span>
</span><a name="line-2213"></a><span class="hs-comment">-- Note [The substitution invariant].</span><span>
</span><a name="line-2214"></a><span class="hs-comment">-- The goal of #11371 is to migrate all the calls of substTyUnchecked to</span><span>
</span><a name="line-2215"></a><span class="hs-comment">-- substTy and remove this function. Please don't use in new code.</span><span>
</span><a name="line-2216"></a><span class="hs-identifier">substTyVarBndrUnchecked</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2217"></a><a name="substTyVarBndrUnchecked"><a href="TyCoRep.html#substTyVarBndrUnchecked"><span class="hs-identifier">substTyVarBndrUnchecked</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyVarBndrCallback"><span class="hs-identifier hs-var">substTyVarBndrCallback</span></a><span> </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span>
</span><a name="line-2218"></a><span>
</span><a name="line-2219"></a><span class="hs-comment">-- | Substitute a tyvar in a binding position, returning an</span><span>
</span><a name="line-2220"></a><span class="hs-comment">-- extended subst and a new tyvar.</span><span>
</span><a name="line-2221"></a><span class="hs-identifier">substTyVarBndrCallback</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ the subst function</span><span>
</span><a name="line-2222"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2223"></a><a name="substTyVarBndrCallback"><a href="TyCoRep.html#substTyVarBndrCallback"><span class="hs-identifier">substTyVarBndrCallback</span></a></a><span> </span><a name="local-1627604243"><a href="#local-1627604243"><span class="hs-identifier">subst_fn</span></a></a><span> </span><a name="local-1627604244"><a href="#local-1627604244"><span class="hs-identifier">subst</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><a name="local-1627604245"><a href="#local-1627604245"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627604246"><a href="#local-1627604246"><span class="hs-identifier">tenv</span></a></a><span> </span><a name="local-1627604247"><a href="#local-1627604247"><span class="hs-identifier">cenv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604248"><a href="#local-1627604248"><span class="hs-identifier">old_var</span></a></a><span>
</span><a name="line-2224"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">_no_capture</span><span class="hs-special">,</span><span> </span><a href="#local-1627604250"><span class="hs-identifier hs-var">pprTvBndr</span></a><span> </span><span class="hs-identifier">old_var</span><span> </span><span class="hs-operator">$$</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">pprTvBndr</span></a><span> </span><span class="hs-identifier">new_var</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2225"></a><span>    </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier">old_var</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2226"></a><span>    </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604245"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">`</span><a href="VarEnv.html#extendInScopeSet"><span class="hs-identifier hs-var">extendInScopeSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627604254"><span class="hs-identifier hs-var">new_var</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604249"><span class="hs-identifier hs-var">new_env</span></a><span> </span><a href="#local-1627604247"><span class="hs-identifier hs-var">cenv</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604254"><span class="hs-identifier hs-var">new_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-2227"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2228"></a><span>    </span><a name="local-1627604249"><a href="#local-1627604249"><span class="hs-identifier">new_env</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604253"><span class="hs-identifier hs-var">no_change</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#delVarEnv"><span class="hs-identifier hs-var">delVarEnv</span></a><span> </span><a href="#local-1627604246"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="#local-1627604248"><span class="hs-identifier hs-var">old_var</span></a><span>
</span><a name="line-2229"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-1627604246"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="#local-1627604248"><span class="hs-identifier hs-var">old_var</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a href="#local-1627604254"><span class="hs-identifier hs-var">new_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-2230"></a><span>
</span><a name="line-2231"></a><span>    </span><a name="local-1627604250"><a href="#local-1627604250"><span class="hs-identifier">_no_capture</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1627604254"><span class="hs-identifier hs-var">new_var</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#varEnvElts"><span class="hs-identifier hs-var">varEnvElts</span></a><span> </span><a href="#local-1627604246"><span class="hs-identifier hs-var">tenv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2232"></a><span>    </span><span class="hs-comment">-- Assertion check that we are not capturing something in the substitution</span><span>
</span><a name="line-2233"></a><span>
</span><a name="line-2234"></a><span>    </span><a name="local-1627604251"><a href="#local-1627604251"><span class="hs-identifier">old_ki</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1627604248"><span class="hs-identifier hs-var">old_var</span></a><span>
</span><a name="line-2235"></a><span>    </span><a name="local-1627604252"><a href="#local-1627604252"><span class="hs-identifier">no_kind_change</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627604251"><span class="hs-identifier hs-var">old_ki</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- verify that kind is closed</span><span>
</span><a name="line-2236"></a><span>    </span><a name="local-1627604253"><a href="#local-1627604253"><span class="hs-identifier">no_change</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604252"><span class="hs-identifier hs-var">no_kind_change</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-1627604254"><span class="hs-identifier hs-var">new_var</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627604248"><span class="hs-identifier hs-var">old_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-2237"></a><span>        </span><span class="hs-comment">-- no_change means that the new_var is identical in</span><span>
</span><a name="line-2238"></a><span>        </span><span class="hs-comment">-- all respects to the old_var (same unique, same kind)</span><span>
</span><a name="line-2239"></a><span>        </span><span class="hs-comment">-- See Note [Extending the TCvSubst]</span><span>
</span><a name="line-2240"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-2241"></a><span>        </span><span class="hs-comment">-- In that case we don't need to extend the substitution</span><span>
</span><a name="line-2242"></a><span>        </span><span class="hs-comment">-- to map old to new.  But instead we must zap any</span><span>
</span><a name="line-2243"></a><span>        </span><span class="hs-comment">-- current substitution for the variable. For example:</span><span>
</span><a name="line-2244"></a><span>        </span><span class="hs-comment">--      (\x.e) with id_subst = [x |-&gt; e']</span><span>
</span><a name="line-2245"></a><span>        </span><span class="hs-comment">-- Here we must simply zap the substitution for x</span><span>
</span><a name="line-2246"></a><span>
</span><a name="line-2247"></a><span>    </span><a name="local-1627604254"><a href="#local-1627604254"><span class="hs-identifier">new_var</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604252"><span class="hs-identifier hs-var">no_kind_change</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#uniqAway"><span class="hs-identifier hs-var">uniqAway</span></a><span> </span><a href="#local-1627604245"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-1627604248"><span class="hs-identifier hs-var">old_var</span></a><span>
</span><a name="line-2248"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#uniqAway"><span class="hs-identifier hs-var">uniqAway</span></a><span> </span><a href="#local-1627604245"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2249"></a><span>                          </span><a href="Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a><span> </span><a href="#local-1627604248"><span class="hs-identifier hs-var">old_var</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604243"><span class="hs-identifier hs-var">subst_fn</span></a><span> </span><a href="#local-1627604244"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604251"><span class="hs-identifier hs-var">old_ki</span></a><span class="hs-special">)</span><span>
</span><a name="line-2250"></a><span>        </span><span class="hs-comment">-- The uniqAway part makes sure the new variable is not already in scope</span><span>
</span><a name="line-2251"></a><span>
</span><a name="line-2252"></a><span class="hs-identifier">substCoVarBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2253"></a><a name="substCoVarBndr"><a href="TyCoRep.html#substCoVarBndr"><span class="hs-identifier">substCoVarBndr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substCoVarBndrCallback"><span class="hs-identifier hs-var">substCoVarBndrCallback</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span>
</span><a name="line-2254"></a><span>
</span><a name="line-2255"></a><span class="hs-identifier">substCoVarBndrCallback</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- apply &quot;sym&quot; to the covar?</span><span>
</span><a name="line-2256"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-2257"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2258"></a><a name="substCoVarBndrCallback"><a href="TyCoRep.html#substCoVarBndrCallback"><span class="hs-identifier">substCoVarBndrCallback</span></a></a><span> </span><a name="local-1627604255"><a href="#local-1627604255"><span class="hs-identifier">sym</span></a></a><span> </span><a name="local-1627604256"><a href="#local-1627604256"><span class="hs-identifier">subst_fun</span></a></a><span> </span><a name="local-1627604257"><a href="#local-1627604257"><span class="hs-identifier">subst</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><a name="local-1627604258"><a href="#local-1627604258"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627604259"><a href="#local-1627604259"><span class="hs-identifier">tenv</span></a></a><span> </span><a name="local-1627604260"><a href="#local-1627604260"><span class="hs-identifier">cenv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604261"><a href="#local-1627604261"><span class="hs-identifier">old_var</span></a></a><span>
</span><a name="line-2259"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isCoVar</span><span> </span><span class="hs-identifier">old_var</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2260"></a><span>    </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604258"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">`</span><a href="VarEnv.html#extendInScopeSet"><span class="hs-identifier hs-var">extendInScopeSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627604266"><span class="hs-identifier hs-var">new_var</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604259"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="#local-1627604265"><span class="hs-identifier hs-var">new_cenv</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604266"><span class="hs-identifier hs-var">new_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-2261"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2262"></a><span>    </span><span class="hs-comment">-- When we substitute (co :: t1 ~ t2) we may get the identity (co :: t ~ t)</span><span>
</span><a name="line-2263"></a><span>    </span><span class="hs-comment">-- In that case, mkCoVarCo will return a ReflCoercion, and</span><span>
</span><a name="line-2264"></a><span>    </span><span class="hs-comment">-- we want to substitute that (not new_var) for old_var</span><span>
</span><a name="line-2265"></a><span>    </span><a name="local-1627604262"><a href="#local-1627604262"><span class="hs-identifier">new_co</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-1627604255"><span class="hs-identifier hs-var">sym</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a><span> </span><a href="#local-1627604266"><span class="hs-identifier hs-var">new_var</span></a><span>
</span><a name="line-2266"></a><span>    </span><a name="local-1627604263"><a href="#local-1627604263"><span class="hs-identifier">no_kind_change</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627604268"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604269"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2267"></a><span>    </span><a name="local-1627604264"><a href="#local-1627604264"><span class="hs-identifier">no_change</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604266"><span class="hs-identifier hs-var">new_var</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627604261"><span class="hs-identifier hs-var">old_var</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a><span> </span><a href="#local-1627604262"><span class="hs-identifier hs-var">new_co</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1627604263"><span class="hs-identifier hs-var">no_kind_change</span></a><span>
</span><a name="line-2268"></a><span>
</span><a name="line-2269"></a><span>    </span><a name="local-1627604265"><a href="#local-1627604265"><span class="hs-identifier">new_cenv</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604264"><span class="hs-identifier hs-var">no_change</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#delVarEnv"><span class="hs-identifier hs-var">delVarEnv</span></a><span> </span><a href="#local-1627604260"><span class="hs-identifier hs-var">cenv</span></a><span> </span><a href="#local-1627604261"><span class="hs-identifier hs-var">old_var</span></a><span>
</span><a name="line-2270"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-1627604260"><span class="hs-identifier hs-var">cenv</span></a><span> </span><a href="#local-1627604261"><span class="hs-identifier hs-var">old_var</span></a><span> </span><a href="#local-1627604262"><span class="hs-identifier hs-var">new_co</span></a><span>
</span><a name="line-2271"></a><span>
</span><a name="line-2272"></a><span>    </span><a name="local-1627604266"><a href="#local-1627604266"><span class="hs-identifier">new_var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#uniqAway"><span class="hs-identifier hs-var">uniqAway</span></a><span> </span><a href="#local-1627604258"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-1627604267"><span class="hs-identifier hs-var">subst_old_var</span></a><span>
</span><a name="line-2273"></a><span>    </span><a name="local-1627604267"><a href="#local-1627604267"><span class="hs-identifier">subst_old_var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkCoVar"><span class="hs-identifier hs-var">mkCoVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varName</span><span> </span><a href="#local-1627604261"><span class="hs-identifier hs-var">old_var</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604273"><span class="hs-identifier hs-var">new_var_type</span></a><span>
</span><a name="line-2274"></a><span>
</span><a name="line-2275"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627604268"><a href="#local-1627604268"><span class="hs-identifier">t1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604269"><a href="#local-1627604269"><span class="hs-identifier">t2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604270"><a href="#local-1627604270"><span class="hs-identifier">role</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coVarKindsTypesRole"><span class="hs-identifier hs-var">coVarKindsTypesRole</span></a><span> </span><a href="#local-1627604261"><span class="hs-identifier hs-var">old_var</span></a><span>
</span><a name="line-2276"></a><span>    </span><a name="local-1627604271"><a href="#local-1627604271"><span class="hs-identifier">t1'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604256"><span class="hs-identifier hs-var">subst_fun</span></a><span> </span><a href="#local-1627604257"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604268"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-2277"></a><span>    </span><a name="local-1627604272"><a href="#local-1627604272"><span class="hs-identifier">t2'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604256"><span class="hs-identifier hs-var">subst_fun</span></a><span> </span><a href="#local-1627604257"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604269"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2278"></a><span>    </span><a name="local-1627604273"><a href="#local-1627604273"><span class="hs-identifier">new_var_type</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkCoercionType"><span class="hs-identifier hs-var">mkCoercionType</span></a><span> </span><a href="#local-1627604270"><span class="hs-identifier hs-var">role</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-1627604255"><span class="hs-identifier hs-var">sym</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-1627604272"><span class="hs-identifier hs-var">t2'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604271"><span class="hs-identifier hs-var">t1'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-1627604271"><span class="hs-identifier hs-var">t1'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604272"><span class="hs-identifier hs-var">t2'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2279"></a><span>                  </span><span class="hs-comment">-- It's important to do the substitution for coercions,</span><span>
</span><a name="line-2280"></a><span>                  </span><span class="hs-comment">-- because they can have free type variables</span><span>
</span><a name="line-2281"></a><span>
</span><a name="line-2282"></a><span class="hs-identifier">cloneTyVarBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2283"></a><a name="cloneTyVarBndr"><a href="TyCoRep.html#cloneTyVarBndr"><span class="hs-identifier">cloneTyVarBndr</span></a></a><span> </span><a name="local-1627604274"><a href="#local-1627604274"><span class="hs-identifier">subst</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><a name="local-1627604275"><a href="#local-1627604275"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627604276"><a href="#local-1627604276"><span class="hs-identifier">tv_env</span></a></a><span> </span><a name="local-1627604277"><a href="#local-1627604277"><span class="hs-identifier">cv_env</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604278"><a href="#local-1627604278"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1627604279"><a href="#local-1627604279"><span class="hs-identifier">uniq</span></a></a><span>
</span><a name="line-2284"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier hs-var">tv</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- I think it's only called on TyVars</span><span>
</span><a name="line-2285"></a><span>    </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#extendInScopeSet"><span class="hs-identifier hs-var">extendInScopeSet</span></a><span> </span><a href="#local-1627604275"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-1627604283"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2286"></a><span>              </span><span class="hs-special">(</span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-1627604276"><span class="hs-identifier hs-var">tv_env</span></a><span> </span><a href="#local-1627604278"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1627604283"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627604277"><span class="hs-identifier hs-var">cv_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604283"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2287"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2288"></a><span>    </span><a name="local-1627604280"><a href="#local-1627604280"><span class="hs-identifier">old_ki</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1627604278"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2289"></a><span>    </span><a name="local-1627604281"><a href="#local-1627604281"><span class="hs-identifier">no_kind_change</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627604280"><span class="hs-identifier hs-var">old_ki</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- verify that kind is closed</span><span>
</span><a name="line-2290"></a><span>
</span><a name="line-2291"></a><span>    </span><a name="local-1627604282"><a href="#local-1627604282"><span class="hs-identifier">tv1</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604281"><span class="hs-identifier hs-var">no_kind_change</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604278"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2292"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a><span> </span><a href="#local-1627604278"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-1627604274"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604280"><span class="hs-identifier hs-var">old_ki</span></a><span class="hs-special">)</span><span>
</span><a name="line-2293"></a><span>
</span><a name="line-2294"></a><span>    </span><a name="local-1627604283"><a href="#local-1627604283"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setVarUnique"><span class="hs-identifier hs-var">setVarUnique</span></a><span> </span><a href="#local-1627604282"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-1627604279"><span class="hs-identifier hs-var">uniq</span></a><span>
</span><a name="line-2295"></a><span>
</span><a name="line-2296"></a><span class="hs-identifier">cloneTyVarBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="UniqSupply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2297"></a><a name="cloneTyVarBndrs"><a href="TyCoRep.html#cloneTyVarBndrs"><span class="hs-identifier">cloneTyVarBndrs</span></a></a><span> </span><a name="local-1627604284"><a href="#local-1627604284"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><a name="local-1627604285"><a href="#local-1627604285"><span class="hs-identifier">_usupply</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627604284"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2298"></a><span class="hs-identifier">cloneTyVarBndrs</span><span> </span><a name="local-1627604286"><a href="#local-1627604286"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627604287"><a href="#local-1627604287"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">:</span><a name="local-1627604288"><a href="#local-1627604288"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span>  </span><a name="local-1627604289"><a href="#local-1627604289"><span class="hs-identifier">usupply</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627604294"><span class="hs-identifier hs-var">subst''</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604293"><span class="hs-identifier hs-var">tv</span></a><span class="hs-glyph">:</span><a href="#local-1627604295"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2299"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2300"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604290"><a href="#local-1627604290"><span class="hs-identifier">uniq</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604291"><a href="#local-1627604291"><span class="hs-identifier">usupply'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#takeUniqFromSupply"><span class="hs-identifier hs-var">takeUniqFromSupply</span></a><span> </span><a href="#local-1627604289"><span class="hs-identifier hs-var">usupply</span></a><span>
</span><a name="line-2301"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604292"><a href="#local-1627604292"><span class="hs-identifier">subst'</span></a></a><span> </span><span class="hs-special">,</span><span> </span><a name="local-1627604293"><a href="#local-1627604293"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#cloneTyVarBndr"><span class="hs-identifier hs-var">cloneTyVarBndr</span></a><span> </span><a href="#local-1627604286"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604287"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-1627604290"><span class="hs-identifier hs-var">uniq</span></a><span>
</span><a name="line-2302"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604294"><a href="#local-1627604294"><span class="hs-identifier">subst''</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604295"><a href="#local-1627604295"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#cloneTyVarBndrs"><span class="hs-identifier hs-var">cloneTyVarBndrs</span></a><span> </span><a href="#local-1627604292"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-1627604288"><span class="hs-identifier hs-var">ts</span></a><span> </span><a href="#local-1627604291"><span class="hs-identifier hs-var">usupply'</span></a><span>
</span><a name="line-2303"></a><span>
</span><a name="line-2304"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                   Pretty-printing types

       Defined very early because of debug printing in assertions
%*                                                                      *
%************************************************************************

@pprType@ is the standard @Type@ printer; the overloaded @ppr@ function is
defined to use this.  @pprParendType@ is the same, except it puts
parens around the type, except for the atomic cases.  @pprParendType@
works just by setting the initial context precedence very high.

Note [Precedence in types]
~~~~~~~~~~~~~~~~~~~~~~~~~~
We don't keep the fixity of type operators in the operator. So the pretty printer
operates the following precedene structre:
   Type constructor application   binds more tightly than
   Operator applications          which bind more tightly than
   Function arrow

So we might see  a :+: T b -&gt; c
meaning          (a :+: (T b)) -&gt; c

Maybe operator applications should bind a bit less tightly?

Anyway, that's the current story, and it is used consistently for Type and HsType
-}</span><span>
</span><a name="line-2333"></a><span>
</span><a name="line-2334"></a><span class="hs-keyword">data</span><span> </span><a name="TyPrec"><a href="TyCoRep.html#TyPrec"><span class="hs-identifier">TyPrec</span></a></a><span>   </span><span class="hs-comment">-- See Note [Prededence in types]</span><span>
</span><a name="line-2335"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TopPrec"><a href="TyCoRep.html#TopPrec"><span class="hs-identifier">TopPrec</span></a></a><span>         </span><span class="hs-comment">-- No parens</span><span>
</span><a name="line-2336"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FunPrec"><a href="TyCoRep.html#FunPrec"><span class="hs-identifier">FunPrec</span></a></a><span>         </span><span class="hs-comment">-- Function args; no parens for tycon apps</span><span>
</span><a name="line-2337"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TyOpPrec"><a href="TyCoRep.html#TyOpPrec"><span class="hs-identifier">TyOpPrec</span></a></a><span>        </span><span class="hs-comment">-- Infix operator</span><span>
</span><a name="line-2338"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TyConPrec"><a href="TyCoRep.html#TyConPrec"><span class="hs-identifier">TyConPrec</span></a></a><span>       </span><span class="hs-comment">-- Tycon args; no parens for atomic</span><span>
</span><a name="line-2339"></a><span>  </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2340"></a><span>
</span><a name="line-2341"></a><span class="hs-identifier">maybeParen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2342"></a><a name="maybeParen"><a href="TyCoRep.html#maybeParen"><span class="hs-identifier">maybeParen</span></a></a><span> </span><a name="local-1627604296"><a href="#local-1627604296"><span class="hs-identifier">ctxt_prec</span></a></a><span> </span><a name="local-1627604297"><a href="#local-1627604297"><span class="hs-identifier">inner_prec</span></a></a><span> </span><a name="local-1627604298"><a href="#local-1627604298"><span class="hs-identifier">pretty</span></a></a><span>
</span><a name="line-2343"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604296"><span class="hs-identifier hs-var">ctxt_prec</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-1627604297"><span class="hs-identifier hs-var">inner_prec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604298"><span class="hs-identifier hs-var">pretty</span></a><span>
</span><a name="line-2344"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><a href="#local-1627604298"><span class="hs-identifier hs-var">pretty</span></a><span>
</span><a name="line-2345"></a><span>
</span><a name="line-2346"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-2347"></a><span class="hs-identifier">pprType</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pprParendType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2348"></a><a name="pprType"><a href="TyCoRep.html#pprType"><span class="hs-identifier">pprType</span></a></a><span>       </span><a name="local-1627604299"><a href="#local-1627604299"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span> </span><a href="#local-1627604299"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2349"></a><a name="pprParendType"><a href="TyCoRep.html#pprParendType"><span class="hs-identifier">pprParendType</span></a></a><span> </span><a name="local-1627604300"><a href="#local-1627604300"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#TyConPrec"><span class="hs-identifier hs-var">TyConPrec</span></a><span> </span><a href="#local-1627604300"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2350"></a><span>
</span><a name="line-2351"></a><span class="hs-identifier">pprTyLit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyLit"><span class="hs-identifier hs-type">TyLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2352"></a><a name="pprTyLit"><a href="TyCoRep.html#pprTyLit"><span class="hs-identifier">pprTyLit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_tylit"><span class="hs-identifier hs-var">ppr_tylit</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span>
</span><a name="line-2353"></a><span>
</span><a name="line-2354"></a><span class="hs-identifier">pprKind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pprParendKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2355"></a><a name="pprKind"><a href="TyCoRep.html#pprKind"><span class="hs-identifier">pprKind</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span>
</span><a name="line-2356"></a><a name="pprParendKind"><a href="TyCoRep.html#pprParendKind"><span class="hs-identifier">pprParendKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a><span>
</span><a name="line-2357"></a><span>
</span><a name="line-2358"></a><span class="hs-comment">------------</span><span>
</span><a name="line-2359"></a><span class="hs-identifier">pprClassPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2360"></a><a name="pprClassPred"><a href="TyCoRep.html#pprClassPred"><span class="hs-identifier">pprClassPred</span></a></a><span> </span><a name="local-1627604301"><a href="#local-1627604301"><span class="hs-identifier">clas</span></a></a><span> </span><a name="local-1627604302"><a href="#local-1627604302"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprTypeApp"><span class="hs-identifier hs-var">pprTypeApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-1627604301"><span class="hs-identifier hs-var">clas</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604302"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2361"></a><span>
</span><a name="line-2362"></a><span class="hs-comment">------------</span><span>
</span><a name="line-2363"></a><span class="hs-identifier">pprTheta</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2364"></a><a name="pprTheta"><a href="TyCoRep.html#pprTheta"><span class="hs-identifier">pprTheta</span></a></a><span> </span><span class="hs-special">[</span><a name="local-1627604303"><a href="#local-1627604303"><span class="hs-identifier">pred</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span> </span><a href="#local-1627604303"><span class="hs-identifier hs-var">pred</span></a><span>     </span><span class="hs-comment">-- I'm in two minds about this</span><span>
</span><a name="line-2365"></a><span class="hs-identifier">pprTheta</span><span> </span><a name="local-1627604304"><a href="#local-1627604304"><span class="hs-identifier">theta</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604304"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2366"></a><span>
</span><a name="line-2367"></a><span class="hs-identifier">pprThetaArrowTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2368"></a><a name="pprThetaArrowTy"><a href="TyCoRep.html#pprThetaArrowTy"><span class="hs-identifier">pprThetaArrowTy</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-2369"></a><span class="hs-identifier">pprThetaArrowTy</span><span> </span><span class="hs-special">[</span><a name="local-1627604305"><a href="#local-1627604305"><span class="hs-identifier">pred</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#TyOpPrec"><span class="hs-identifier hs-var">TyOpPrec</span></a><span> </span><a href="#local-1627604305"><span class="hs-identifier hs-var">pred</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#darrow"><span class="hs-identifier hs-var">darrow</span></a><span>
</span><a name="line-2370"></a><span>                         </span><span class="hs-comment">-- TyOpPrec:  Num a     =&gt; a -&gt; a  does not need parens</span><span>
</span><a name="line-2371"></a><span>                         </span><span class="hs-comment">--      bug   (a :~: b) =&gt; a -&gt; b  currently does</span><span>
</span><a name="line-2372"></a><span>                         </span><span class="hs-comment">-- Trac # 9658</span><span>
</span><a name="line-2373"></a><span class="hs-identifier">pprThetaArrowTy</span><span> </span><a name="local-1627604306"><a href="#local-1627604306"><span class="hs-identifier">preds</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604306"><span class="hs-identifier hs-var">preds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2374"></a><span>                            </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#darrow"><span class="hs-identifier hs-var">darrow</span></a><span>
</span><a name="line-2375"></a><span>    </span><span class="hs-comment">-- Notice 'fsep' here rather that 'sep', so that</span><span>
</span><a name="line-2376"></a><span>    </span><span class="hs-comment">-- type contexts don't get displayed in a giant column</span><span>
</span><a name="line-2377"></a><span>    </span><span class="hs-comment">-- Rather than</span><span>
</span><a name="line-2378"></a><span>    </span><span class="hs-comment">--  instance (Eq a,</span><span>
</span><a name="line-2379"></a><span>    </span><span class="hs-comment">--            Eq b,</span><span>
</span><a name="line-2380"></a><span>    </span><span class="hs-comment">--            Eq c,</span><span>
</span><a name="line-2381"></a><span>    </span><span class="hs-comment">--            Eq d,</span><span>
</span><a name="line-2382"></a><span>    </span><span class="hs-comment">--            Eq e,</span><span>
</span><a name="line-2383"></a><span>    </span><span class="hs-comment">--            Eq f,</span><span>
</span><a name="line-2384"></a><span>    </span><span class="hs-comment">--            Eq g,</span><span>
</span><a name="line-2385"></a><span>    </span><span class="hs-comment">--            Eq h,</span><span>
</span><a name="line-2386"></a><span>    </span><span class="hs-comment">--            Eq i,</span><span>
</span><a name="line-2387"></a><span>    </span><span class="hs-comment">--            Eq j,</span><span>
</span><a name="line-2388"></a><span>    </span><span class="hs-comment">--            Eq k,</span><span>
</span><a name="line-2389"></a><span>    </span><span class="hs-comment">--            Eq l) =&gt;</span><span>
</span><a name="line-2390"></a><span>    </span><span class="hs-comment">--           Eq (a, b, c, d, e, f, g, h, i, j, k, l)</span><span>
</span><a name="line-2391"></a><span>    </span><span class="hs-comment">-- we get</span><span>
</span><a name="line-2392"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-2393"></a><span>    </span><span class="hs-comment">--  instance (Eq a, Eq b, Eq c, Eq d, Eq e, Eq f, Eq g, Eq h, Eq i,</span><span>
</span><a name="line-2394"></a><span>    </span><span class="hs-comment">--            Eq j, Eq k, Eq l) =&gt;</span><span>
</span><a name="line-2395"></a><span>    </span><span class="hs-comment">--           Eq (a, b, c, d, e, f, g, h, i, j, k, l)</span><span>
</span><a name="line-2396"></a><span>
</span><a name="line-2397"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-2398"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2399"></a><span>    </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-1627604630"><a href="#local-1627604630"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span> </span><a href="#local-1627604630"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2400"></a><span>
</span><a name="line-2401"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TyCoRep.html#TyLit"><span class="hs-identifier hs-type">TyLit</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2402"></a><span>   </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprTyLit"><span class="hs-identifier hs-var">pprTyLit</span></a><span>
</span><a name="line-2403"></a><span>
</span><a name="line-2404"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-2405"></a><span>        </span><span class="hs-comment">-- OK, here's the main printer</span><span>
</span><a name="line-2406"></a><span>
</span><a name="line-2407"></a><span class="hs-identifier">ppr_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2408"></a><a name="ppr_type"><a href="TyCoRep.html#ppr_type"><span class="hs-identifier">ppr_type</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-1627604307"><a href="#local-1627604307"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_tvar"><span class="hs-identifier hs-var">ppr_tvar</span></a><span> </span><a href="#local-1627604307"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2409"></a><span>
</span><a name="line-2410"></a><span class="hs-identifier">ppr_type</span><span> </span><a name="local-1627604308"><a href="#local-1627604308"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-1627604309"><a href="#local-1627604309"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604310"><a href="#local-1627604310"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprTyTcApp"><span class="hs-identifier hs-var">pprTyTcApp</span></a><span> </span><a href="#local-1627604308"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627604309"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604310"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2411"></a><span class="hs-identifier">ppr_type</span><span> </span><a name="local-1627604311"><a href="#local-1627604311"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-1627604312"><a href="#local-1627604312"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_tylit"><span class="hs-identifier hs-var">ppr_tylit</span></a><span> </span><a href="#local-1627604311"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627604312"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-2412"></a><span class="hs-identifier">ppr_type</span><span> </span><a name="local-1627604313"><a href="#local-1627604313"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604314"><a href="#local-1627604314"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_forall_type"><span class="hs-identifier hs-var">ppr_forall_type</span></a><span> </span><a href="#local-1627604313"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627604314"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2413"></a><span>
</span><a name="line-2414"></a><span class="hs-identifier">ppr_type</span><span> </span><a name="local-1627604315"><a href="#local-1627604315"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-1627604316"><a href="#local-1627604316"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-1627604317"><a href="#local-1627604317"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2415"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#if_print_coercions"><span class="hs-identifier hs-var">if_print_coercions</span></a><span>
</span><a name="line-2416"></a><span>      </span><a href="#local-1627604318"><span class="hs-identifier hs-var">ppr_app_ty</span></a><span>
</span><a name="line-2417"></a><span>      </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-1627604319"><span class="hs-identifier hs-var">split_app_tys</span></a><span> </span><a href="#local-1627604316"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627604317"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2418"></a><span>          </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-1627604331"><a href="#local-1627604331"><span class="hs-identifier">head</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627604332"><a href="#local-1627604332"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="#local-1627604315"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604320"><span class="hs-identifier hs-var">mk_app_tys</span></a><span> </span><a href="#local-1627604331"><span class="hs-identifier hs-var">head</span></a><span> </span><a href="#local-1627604332"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-2419"></a><span>          </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627604318"><span class="hs-identifier hs-var">ppr_app_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2420"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2421"></a><span>    </span><a name="local-1627604318"><a href="#local-1627604318"><span class="hs-identifier">ppr_app_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#maybeParen"><span class="hs-identifier hs-var">maybeParen</span></a><span> </span><a href="#local-1627604315"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="TyCoRep.html#TyConPrec"><span class="hs-identifier hs-var">TyConPrec</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2422"></a><span>                 </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#FunPrec"><span class="hs-identifier hs-var">FunPrec</span></a><span> </span><a href="#local-1627604316"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#TyConPrec"><span class="hs-identifier hs-var">TyConPrec</span></a><span> </span><a href="#local-1627604317"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2423"></a><span>
</span><a name="line-2424"></a><span>    </span><a name="local-1627604319"><a href="#local-1627604319"><span class="hs-identifier">split_app_tys</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-1627604321"><a href="#local-1627604321"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1627604322"><a href="#local-1627604322"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604323"><a href="#local-1627604323"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604319"><span class="hs-identifier hs-var">split_app_tys</span></a><span> </span><a href="#local-1627604321"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604322"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-glyph">:</span><a href="#local-1627604323"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-2425"></a><span>    </span><span class="hs-identifier">split_app_tys</span><span> </span><a name="local-1627604324"><a href="#local-1627604324"><span class="hs-identifier">head</span></a></a><span>            </span><a name="local-1627604325"><a href="#local-1627604325"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627604324"><span class="hs-identifier hs-var">head</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604325"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-2426"></a><span>
</span><a name="line-2427"></a><span>    </span><a name="local-1627604320"><a href="#local-1627604320"><span class="hs-identifier">mk_app_tys</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-1627604326"><a href="#local-1627604326"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604327"><a href="#local-1627604327"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604328"><a href="#local-1627604328"><span class="hs-identifier">tys2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="#local-1627604326"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604327"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627604328"><span class="hs-identifier hs-var">tys2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2428"></a><span>    </span><span class="hs-identifier">mk_app_tys</span><span> </span><a name="local-1627604329"><a href="#local-1627604329"><span class="hs-identifier">ty1</span></a></a><span>                </span><a name="local-1627604330"><a href="#local-1627604330"><span class="hs-identifier">tys2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a><span> </span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a href="#local-1627604329"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1627604330"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-2429"></a><span>
</span><a name="line-2430"></a><span class="hs-identifier">ppr_type</span><span> </span><a name="local-1627604333"><a href="#local-1627604333"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-1627604334"><a href="#local-1627604334"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1627604335"><a href="#local-1627604335"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2431"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#if_print_coercions"><span class="hs-identifier hs-var">if_print_coercions</span></a><span>
</span><a name="line-2432"></a><span>      </span><span class="hs-special">(</span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span> </span><a href="#local-1627604334"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;|&gt;&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604335"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2433"></a><span>      </span><span class="hs-special">(</span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="#local-1627604333"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627604334"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2434"></a><span>
</span><a name="line-2435"></a><span class="hs-identifier">ppr_type</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-1627604336"><a href="#local-1627604336"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2436"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#if_print_coercions"><span class="hs-identifier hs-var">if_print_coercions</span></a><span>
</span><a name="line-2437"></a><span>      </span><span class="hs-special">(</span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604336"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2438"></a><span>      </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;&lt;&gt;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2439"></a><span>
</span><a name="line-2440"></a><span class="hs-identifier">ppr_forall_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2441"></a><a name="ppr_forall_type"><a href="TyCoRep.html#ppr_forall_type"><span class="hs-identifier">ppr_forall_type</span></a></a><span> </span><a name="local-1627604337"><a href="#local-1627604337"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604338"><a href="#local-1627604338"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2442"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#maybeParen"><span class="hs-identifier hs-var">maybeParen</span></a><span> </span><a href="#local-1627604337"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="TyCoRep.html#FunPrec"><span class="hs-identifier hs-var">FunPrec</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2443"></a><span>    </span><a href="Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627604339"><a href="#local-1627604339"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2444"></a><span>    </span><a href="TyCoRep.html#ppr_sigma_type"><span class="hs-identifier hs-var">ppr_sigma_type</span></a><span> </span><a href="#local-1627604339"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-1627604338"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2445"></a><span>    </span><span class="hs-comment">-- True &lt;=&gt; we always print the foralls on *nested* quantifiers</span><span>
</span><a name="line-2446"></a><span>    </span><span class="hs-comment">-- Opt_PrintExplicitForalls only affects top-level quantifiers</span><span>
</span><a name="line-2447"></a><span>
</span><a name="line-2448"></a><span class="hs-identifier">ppr_tvar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2449"></a><a name="ppr_tvar"><a href="TyCoRep.html#ppr_tvar"><span class="hs-identifier">ppr_tvar</span></a></a><span> </span><a name="local-1627604340"><a href="#local-1627604340"><span class="hs-identifier">tv</span></a></a><span>  </span><span class="hs-comment">-- Note [Infix type variables]</span><span>
</span><a name="line-2450"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#parenSymOcc"><span class="hs-identifier hs-var">parenSymOcc</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1627604340"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604340"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2451"></a><span>
</span><a name="line-2452"></a><span class="hs-identifier">ppr_tylit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyLit"><span class="hs-identifier hs-type">TyLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2453"></a><a name="ppr_tylit"><a href="TyCoRep.html#ppr_tylit"><span class="hs-identifier">ppr_tylit</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627604341"><a href="#local-1627604341"><span class="hs-identifier">tl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2454"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627604341"><span class="hs-identifier hs-var">tl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2455"></a><span>    </span><a href="TyCoRep.html#NumTyLit"><span class="hs-identifier hs-var">NumTyLit</span></a><span> </span><a name="local-1627604342"><a href="#local-1627604342"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#integer"><span class="hs-identifier hs-var">integer</span></a><span> </span><a href="#local-1627604342"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-2456"></a><span>    </span><a href="TyCoRep.html#StrTyLit"><span class="hs-identifier hs-var">StrTyLit</span></a><span> </span><a name="local-1627604343"><a href="#local-1627604343"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-1627604343"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-2457"></a><span>
</span><a name="line-2458"></a><span class="hs-identifier">if_print_coercions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>  </span><span class="hs-comment">-- if printing coercions</span><span>
</span><a name="line-2459"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>  </span><span class="hs-comment">-- otherwise</span><span>
</span><a name="line-2460"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2461"></a><a name="if_print_coercions"><a href="TyCoRep.html#if_print_coercions"><span class="hs-identifier">if_print_coercions</span></a></a><span> </span><a name="local-1627604344"><a href="#local-1627604344"><span class="hs-identifier">yes</span></a></a><span> </span><a name="local-1627604345"><a href="#local-1627604345"><span class="hs-identifier">no</span></a></a><span>
</span><a name="line-2462"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627604346"><a href="#local-1627604346"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2463"></a><span>    </span><a href="Outputable.html#getPprStyle"><span class="hs-identifier hs-var">getPprStyle</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627604347"><a href="#local-1627604347"><span class="hs-identifier">style</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2464"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_PrintExplicitCoercions"><span class="hs-identifier hs-var">Opt_PrintExplicitCoercions</span></a><span> </span><a href="#local-1627604346"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2465"></a><span>         </span><span class="hs-operator hs-var">||</span><span> </span><a href="Outputable.html#dumpStyle"><span class="hs-identifier hs-var">dumpStyle</span></a><span> </span><a href="#local-1627604347"><span class="hs-identifier hs-var">style</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Outputable.html#debugStyle"><span class="hs-identifier hs-var">debugStyle</span></a><span> </span><a href="#local-1627604347"><span class="hs-identifier hs-var">style</span></a><span>
</span><a name="line-2466"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="#local-1627604344"><span class="hs-identifier hs-var">yes</span></a><span>
</span><a name="line-2467"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="#local-1627604345"><span class="hs-identifier hs-var">no</span></a><span>
</span><a name="line-2468"></a><span>
</span><a name="line-2469"></a><span class="hs-comment">-------------------</span><span>
</span><a name="line-2470"></a><span class="hs-identifier">ppr_sigma_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-2471"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- ^ True &lt;=&gt; Show the foralls unconditionally</span><span>
</span><a name="line-2472"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2473"></a><span class="hs-comment">-- Suppose we have (forall a. Show a =&gt; forall b. a -&gt; b). When we're not</span><span>
</span><a name="line-2474"></a><span class="hs-comment">-- printing foralls, we want to drop both the (forall a) and the (forall b).</span><span>
</span><a name="line-2475"></a><span class="hs-comment">-- This logic does so.</span><span>
</span><a name="line-2476"></a><a name="ppr_sigma_type"><a href="TyCoRep.html#ppr_sigma_type"><span class="hs-identifier">ppr_sigma_type</span></a></a><span> </span><a name="local-1627604348"><a href="#local-1627604348"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-1627604349"><a href="#local-1627604349"><span class="hs-identifier">orig_ty</span></a></a><span>
</span><a name="line-2477"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_PrintExplicitForalls"><span class="hs-identifier hs-var">Opt_PrintExplicitForalls</span></a><span> </span><a href="#local-1627604348"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-2478"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><span class="hs-special">(</span><a href="VarSet.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TyCoRep.html#binderType"><span class="hs-identifier hs-var">binderType</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604352"><span class="hs-identifier hs-var">named</span></a><span>
</span><a name="line-2479"></a><span>      </span><span class="hs-comment">-- See Note [When to print foralls]</span><span>
</span><a name="line-2480"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="TyCoRep.html#pprThetaArrowTy"><span class="hs-identifier hs-var">pprThetaArrowTy</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TyCoRep.html#binderType"><span class="hs-identifier hs-var">binderType</span></a><span> </span><a href="#local-1627604353"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-2481"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprArrowChain"><span class="hs-identifier hs-var">pprArrowChain</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ppr_fun_tail"><span class="hs-identifier hs-var">ppr_fun_tail</span></a><span> </span><a href="#local-1627604351"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2482"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2483"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604350"><a href="#local-1627604350"><span class="hs-identifier">invis_bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604351"><a href="#local-1627604351"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604354"><span class="hs-identifier hs-var">split</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1627604349"><span class="hs-identifier hs-var">orig_ty</span></a><span>
</span><a name="line-2484"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604352"><a href="#local-1627604352"><span class="hs-identifier">named</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604353"><a href="#local-1627604353"><span class="hs-identifier">ctxt</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span> </span><a href="TyCoRep.html#isNamedBinder"><span class="hs-identifier hs-var">isNamedBinder</span></a><span> </span><a href="#local-1627604350"><span class="hs-identifier hs-var">invis_bndrs</span></a><span>
</span><a name="line-2485"></a><span>
</span><a name="line-2486"></a><span>    </span><a name="local-1627604354"><a href="#local-1627604354"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-1627604355"><a href="#local-1627604355"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a name="local-1627604356"><a href="#local-1627604356"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-1627604357"><a href="#local-1627604357"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isInvisibleBinder"><span class="hs-identifier hs-var">isInvisibleBinder</span></a><span> </span><a href="#local-1627604356"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604354"><span class="hs-identifier hs-var">split</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604356"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-glyph">:</span><a href="#local-1627604355"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604357"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2487"></a><span>    </span><span class="hs-identifier">split</span><span> </span><a name="local-1627604358"><a href="#local-1627604358"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-1627604359"><a href="#local-1627604359"><span class="hs-identifier">ty</span></a></a><span>                                          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627604358"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604359"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2488"></a><span>
</span><a name="line-2489"></a><span class="hs-identifier">ppr_sigma_type</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627604360"><a href="#local-1627604360"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2490"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="TyCoRep.html#pprForAll"><span class="hs-identifier hs-var">pprForAll</span></a><span> </span><a href="#local-1627604361"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-2491"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprThetaArrowTy"><span class="hs-identifier hs-var">pprThetaArrowTy</span></a><span> </span><a href="#local-1627604363"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-2492"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprArrowChain"><span class="hs-identifier hs-var">pprArrowChain</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ppr_fun_tail"><span class="hs-identifier hs-var">ppr_fun_tail</span></a><span> </span><a href="#local-1627604364"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2493"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2494"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604361"><a href="#local-1627604361"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604362"><a href="#local-1627604362"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604365"><span class="hs-identifier hs-var">split1</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1627604360"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2495"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604363"><a href="#local-1627604363"><span class="hs-identifier">ctxt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604364"><a href="#local-1627604364"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604366"><span class="hs-identifier hs-var">split2</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1627604362"><span class="hs-identifier hs-var">rho</span></a><span>
</span><a name="line-2496"></a><span>
</span><a name="line-2497"></a><span>    </span><a name="local-1627604365"><a href="#local-1627604365"><span class="hs-identifier">split1</span></a></a><span> </span><a name="local-1627604367"><a href="#local-1627604367"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a name="local-1627604368"><a href="#local-1627604368"><span class="hs-identifier">bndr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1627604369"><a href="#local-1627604369"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604365"><span class="hs-identifier hs-var">split1</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604368"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-glyph">:</span><a href="#local-1627604367"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604369"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2498"></a><span>    </span><span class="hs-identifier">split1</span><span> </span><a name="local-1627604370"><a href="#local-1627604370"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-1627604371"><a href="#local-1627604371"><span class="hs-identifier">ty</span></a></a><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627604370"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604371"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2499"></a><span>
</span><a name="line-2500"></a><span>    </span><a name="local-1627604366"><a href="#local-1627604366"><span class="hs-identifier">split2</span></a></a><span> </span><a name="local-1627604372"><a href="#local-1627604372"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-1627604373"><a href="#local-1627604373"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604374"><a href="#local-1627604374"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-1627604373"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604366"><span class="hs-identifier hs-var">split2</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604373"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-glyph">:</span><a href="#local-1627604372"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604374"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2501"></a><span>    </span><span class="hs-identifier">split2</span><span> </span><a name="local-1627604375"><a href="#local-1627604375"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-1627604376"><a href="#local-1627604376"><span class="hs-identifier">ty</span></a></a><span>                                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627604375"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604376"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2502"></a><span>
</span><a name="line-2503"></a><span>    </span><span class="hs-comment">-- We don't want to lose synonyms, so we mustn't use splitFunTys here.</span><span>
</span><a name="line-2504"></a><span class="hs-identifier">ppr_fun_tail</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">]</span><span>
</span><a name="line-2505"></a><a name="ppr_fun_tail"><a href="TyCoRep.html#ppr_fun_tail"><span class="hs-identifier">ppr_fun_tail</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-1627604377"><a href="#local-1627604377"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604378"><a href="#local-1627604378"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2506"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-1627604377"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#FunPrec"><span class="hs-identifier hs-var">FunPrec</span></a><span> </span><a href="#local-1627604377"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="TyCoRep.html#ppr_fun_tail"><span class="hs-identifier hs-var">ppr_fun_tail</span></a><span> </span><a href="#local-1627604378"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2507"></a><span class="hs-identifier">ppr_fun_tail</span><span> </span><a name="local-1627604379"><a href="#local-1627604379"><span class="hs-identifier">other_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span> </span><a href="#local-1627604379"><span class="hs-identifier hs-var">other_ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-2508"></a><span>
</span><a name="line-2509"></a><span class="hs-identifier">pprSigmaType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2510"></a><a name="pprSigmaType"><a href="TyCoRep.html#pprSigmaType"><span class="hs-identifier">pprSigmaType</span></a></a><span> </span><a name="local-1627604380"><a href="#local-1627604380"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627604381"><a href="#local-1627604381"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ppr_sigma_type"><span class="hs-identifier hs-var">ppr_sigma_type</span></a><span> </span><a href="#local-1627604381"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1627604380"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2511"></a><span>
</span><a name="line-2512"></a><span class="hs-identifier">pprUserForAll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2513"></a><span class="hs-comment">-- Print a user-level forall; see Note [When to print foralls]</span><span>
</span><a name="line-2514"></a><a name="pprUserForAll"><a href="TyCoRep.html#pprUserForAll"><span class="hs-identifier">pprUserForAll</span></a></a><span> </span><a name="local-1627604382"><a href="#local-1627604382"><span class="hs-identifier">bndrs</span></a></a><span>
</span><a name="line-2515"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627604385"><a href="#local-1627604385"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2516"></a><span>    </span><a href="Outputable.html#ppWhen"><span class="hs-identifier hs-var">ppWhen</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><a href="#local-1627604383"><span class="hs-identifier hs-var">bndr_has_kind_var</span></a><span> </span><a href="#local-1627604382"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_PrintExplicitForalls"><span class="hs-identifier hs-var">Opt_PrintExplicitForalls</span></a><span> </span><a href="#local-1627604385"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2517"></a><span>    </span><a href="TyCoRep.html#pprForAll"><span class="hs-identifier hs-var">pprForAll</span></a><span> </span><a href="#local-1627604382"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-2518"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2519"></a><span>    </span><a name="local-1627604383"><a href="#local-1627604383"><span class="hs-identifier">bndr_has_kind_var</span></a></a><span> </span><a name="local-1627604384"><a href="#local-1627604384"><span class="hs-identifier">bndr</span></a></a><span>
</span><a name="line-2520"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="VarSet.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#binderType"><span class="hs-identifier hs-var">binderType</span></a><span> </span><a href="#local-1627604384"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2521"></a><span>
</span><a name="line-2522"></a><span class="hs-identifier">pprForAllImplicit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2523"></a><a name="pprForAllImplicit"><a href="TyCoRep.html#pprForAllImplicit"><span class="hs-identifier">pprForAllImplicit</span></a></a><span> </span><a name="local-1627604386"><a href="#local-1627604386"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprForAll"><span class="hs-identifier hs-var">pprForAll</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a href="#local-1627604386"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><a href="TyCoRep.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2524"></a><span>
</span><a name="line-2525"></a><span class="hs-comment">-- | Render the &quot;forall ... .&quot; or &quot;forall ... -&gt;&quot; bit of a type.</span><span>
</span><a name="line-2526"></a><span class="hs-comment">-- Do not pass in anonymous binders!</span><span>
</span><a name="line-2527"></a><span class="hs-identifier">pprForAll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2528"></a><a name="pprForAll"><a href="TyCoRep.html#pprForAll"><span class="hs-identifier">pprForAll</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-2529"></a><span class="hs-identifier">pprForAll</span><span> </span><a name="local-1627604387"><a href="#local-1627604387"><span class="hs-identifier">bndrs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627604388"><a href="#local-1627604388"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-2530"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604391"><span class="hs-identifier hs-var">add_separator</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#forAllLit"><span class="hs-identifier hs-var">forAllLit</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1627604390"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprForAll"><span class="hs-identifier hs-var">pprForAll</span></a><span> </span><a href="#local-1627604389"><span class="hs-identifier hs-var">bndrs'</span></a><span>
</span><a name="line-2531"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2532"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604389"><a href="#local-1627604389"><span class="hs-identifier">bndrs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604390"><a href="#local-1627604390"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_tv_bndrs"><span class="hs-identifier hs-var">ppr_tv_bndrs</span></a><span> </span><a href="#local-1627604387"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-1627604388"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-2533"></a><span>
</span><a name="line-2534"></a><span>    </span><a name="local-1627604391"><a href="#local-1627604391"><span class="hs-identifier">add_separator</span></a></a><span> </span><a name="local-1627604392"><a href="#local-1627604392"><span class="hs-identifier">stuff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627604388"><span class="hs-identifier hs-var">vis</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2535"></a><span>                            </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">Visible</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627604392"><span class="hs-identifier hs-var">stuff</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#arrow"><span class="hs-identifier hs-var">arrow</span></a><span>
</span><a name="line-2536"></a><span>                            </span><a name="local-1627604393"><a href="#local-1627604393"><span class="hs-identifier">_inv</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627604392"><span class="hs-identifier hs-var">stuff</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>  </span><a href="Outputable.html#dot"><span class="hs-identifier hs-var">dot</span></a><span>
</span><a name="line-2537"></a><span class="hs-identifier">pprForAll</span><span> </span><a name="local-1627604394"><a href="#local-1627604394"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;pprForAll: anonymous binder&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604394"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2538"></a><span>
</span><a name="line-2539"></a><span class="hs-identifier">pprTvBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2540"></a><a name="pprTvBndrs"><a href="TyCoRep.html#pprTvBndrs"><span class="hs-identifier">pprTvBndrs</span></a></a><span> </span><a name="local-1627604395"><a href="#local-1627604395"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier hs-var">pprTvBndr</span></a><span> </span><a href="#local-1627604395"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2541"></a><span>
</span><a name="line-2542"></a><span class="hs-comment">-- | Render the ... in @(forall ... .)@ or @(forall ... -&gt;)@.</span><span>
</span><a name="line-2543"></a><span class="hs-comment">-- Returns both the list of not-yet-rendered binders and the doc.</span><span>
</span><a name="line-2544"></a><span class="hs-comment">-- No anonymous binders here!</span><span>
</span><a name="line-2545"></a><span class="hs-identifier">ppr_tv_bndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>
</span><a name="line-2546"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#VisibilityFlag"><span class="hs-identifier hs-type">VisibilityFlag</span></a><span>  </span><span class="hs-comment">-- ^ visibility of the first binder in the list</span><span>
</span><a name="line-2547"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2548"></a><a name="ppr_tv_bndrs"><a href="TyCoRep.html#ppr_tv_bndrs"><span class="hs-identifier">ppr_tv_bndrs</span></a></a><span> </span><a name="local-1627604396"><a href="#local-1627604396"><span class="hs-identifier">all_bndrs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-1627604397"><a href="#local-1627604397"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1627604398"><a href="#local-1627604398"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1627604399"><a href="#local-1627604399"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604400"><a href="#local-1627604400"><span class="hs-identifier">vis1</span></a></a><span>
</span><a name="line-2549"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604398"><span class="hs-identifier hs-var">vis</span></a><span> </span><span class="hs-special">`</span><a href="TyCoRep.html#sameVis"><span class="hs-identifier hs-var">sameVis</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627604400"><span class="hs-identifier hs-var">vis1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627604401"><a href="#local-1627604401"><span class="hs-identifier">bndrs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604402"><a href="#local-1627604402"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_tv_bndrs"><span class="hs-identifier hs-var">ppr_tv_bndrs</span></a><span> </span><a href="#local-1627604399"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-1627604400"><span class="hs-identifier hs-var">vis1</span></a><span>
</span><a name="line-2550"></a><span>                             </span><a name="local-1627604403"><a href="#local-1627604403"><span class="hs-identifier">pp_tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627604404"><a href="#local-1627604404"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2551"></a><span>                                     </span><span class="hs-keyword">if</span><span> </span><a href="TyCoRep.html#Invisible"><span class="hs-identifier hs-var">Invisible</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627604398"><span class="hs-identifier hs-var">vis</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-2552"></a><span>                                        </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_PrintExplicitForalls"><span class="hs-identifier hs-var">Opt_PrintExplicitForalls</span></a><span> </span><a href="#local-1627604404"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2553"></a><span>                                     </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#pprTvBndrNoParens"><span class="hs-identifier hs-var">pprTvBndrNoParens</span></a><span> </span><a href="#local-1627604397"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2554"></a><span>                                     </span><span class="hs-keyword">else</span><span> </span><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier hs-var">pprTvBndr</span></a><span> </span><a href="#local-1627604397"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2555"></a><span>                         </span><span class="hs-keyword">in</span><span>
</span><a name="line-2556"></a><span>                         </span><span class="hs-special">(</span><a href="#local-1627604401"><span class="hs-identifier hs-var">bndrs'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604403"><span class="hs-identifier hs-var">pp_tv</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1627604402"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2557"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627604396"><span class="hs-identifier hs-var">all_bndrs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2558"></a><span class="hs-identifier">ppr_tv_bndrs</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2559"></a><span class="hs-identifier">ppr_tv_bndrs</span><span> </span><a name="local-1627604405"><a href="#local-1627604405"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;ppr_tv_bndrs: anonymous binder&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604405"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2560"></a><span>
</span><a name="line-2561"></a><span class="hs-identifier">pprTvBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2562"></a><a name="pprTvBndr"><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier">pprTvBndr</span></a></a><span> </span><a name="local-1627604406"><a href="#local-1627604406"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2563"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isLiftedTypeKind"><span class="hs-identifier hs-var">isLiftedTypeKind</span></a><span> </span><a href="#local-1627604407"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_tvar"><span class="hs-identifier hs-var">ppr_tvar</span></a><span> </span><a href="#local-1627604406"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2564"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ppr_tvar"><span class="hs-identifier hs-var">ppr_tvar</span></a><span> </span><a href="#local-1627604406"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprKind"><span class="hs-identifier hs-var">pprKind</span></a><span> </span><a href="#local-1627604407"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-2565"></a><span>             </span><span class="hs-keyword">where</span><span>
</span><a name="line-2566"></a><span>               </span><a name="local-1627604407"><a href="#local-1627604407"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1627604406"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2567"></a><span>
</span><a name="line-2568"></a><span class="hs-identifier">pprTvBndrNoParens</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2569"></a><a name="pprTvBndrNoParens"><a href="TyCoRep.html#pprTvBndrNoParens"><span class="hs-identifier">pprTvBndrNoParens</span></a></a><span> </span><a name="local-1627604408"><a href="#local-1627604408"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2570"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isLiftedTypeKind"><span class="hs-identifier hs-var">isLiftedTypeKind</span></a><span> </span><a href="#local-1627604409"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_tvar"><span class="hs-identifier hs-var">ppr_tvar</span></a><span> </span><a href="#local-1627604408"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2571"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ppr_tvar"><span class="hs-identifier hs-var">ppr_tvar</span></a><span> </span><a href="#local-1627604408"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprKind"><span class="hs-identifier hs-var">pprKind</span></a><span> </span><a href="#local-1627604409"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-2572"></a><span>             </span><span class="hs-keyword">where</span><span>
</span><a name="line-2573"></a><span>               </span><a name="local-1627604409"><a href="#local-1627604409"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1627604408"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2574"></a><span>
</span><a name="line-2575"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2576"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-1627604626"><a href="#local-1627604626"><span class="hs-identifier">v</span></a></a><span> </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">Visible</span></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604626"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-2577"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-1627604627"><a href="#local-1627604627"><span class="hs-identifier">v</span></a></a><span> </span><a href="TyCoRep.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'@'</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604627"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-2578"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-1627604628"><a href="#local-1627604628"><span class="hs-identifier">v</span></a></a><span> </span><a href="TyCoRep.html#Invisible"><span class="hs-identifier hs-var">Invisible</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604628"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-2579"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-1627604629"><a href="#local-1627604629"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;[anon]&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604629"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2580"></a><span>
</span><a name="line-2581"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TyCoRep.html#VisibilityFlag"><span class="hs-identifier hs-type">VisibilityFlag</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2582"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="TyCoRep.html#Visible"><span class="hs-identifier hs-var">Visible</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;[vis]&quot;</span><span>
</span><a name="line-2583"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TyCoRep.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;[spec]&quot;</span><span>
</span><a name="line-2584"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TyCoRep.html#Invisible"><span class="hs-identifier hs-var">Invisible</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;[invis]&quot;</span><span>
</span><a name="line-2585"></a><span>
</span><a name="line-2586"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-2587"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">-- defined here to avoid orphans</span><span>
</span><a name="line-2588"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#pprCo"><span class="hs-identifier hs-var">pprCo</span></a><span>
</span><a name="line-2589"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TyCoRep.html#LeftOrRight"><span class="hs-identifier hs-type">LeftOrRight</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2590"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="TyCoRep.html#CLeft"><span class="hs-identifier hs-var">CLeft</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Left&quot;</span><span>
</span><a name="line-2591"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TyCoRep.html#CRight"><span class="hs-identifier hs-var">CRight</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Right&quot;</span><span>
</span><a name="line-2592"></a><span>
</span><a name="line-2593"></a><span class="hs-comment">{-
Note [When to print foralls]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Mostly we want to print top-level foralls when (and only when) the user specifies
-fprint-explicit-foralls.  But when kind polymorphism is at work, that suppresses
too much information; see Trac #9018.

So I'm trying out this rule: print explicit foralls if
  a) User specifies -fprint-explicit-foralls, or
  b) Any of the quantified type variables has a kind
     that mentions a kind variable

This catches common situations, such as a type siguature
     f :: m a
which means
      f :: forall k. forall (m :: k-&gt;*) (a :: k). m a
We really want to see both the &quot;forall k&quot; and the kind signatures
on m and a.  The latter comes from pprTvBndr.

Note [Infix type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
With TypeOperators you can say

   f :: (a ~&gt; b) -&gt; b

and the (~&gt;) is considered a type variable.  However, the type
pretty-printer in this module will just see (a ~&gt; b) as

   App (App (TyVarTy &quot;~&gt;&quot;) (TyVarTy &quot;a&quot;)) (TyVarTy &quot;b&quot;)

So it'll print the type in prefix form.  To avoid confusion we must
remember to parenthesise the operator, thus

   (~&gt;) a b -&gt; b

See Trac #2766.
-}</span><span>
</span><a name="line-2630"></a><span>
</span><a name="line-2631"></a><span class="hs-identifier">pprDataCons</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2632"></a><a name="pprDataCons"><a href="TyCoRep.html#pprDataCons"><span class="hs-identifier">pprDataCons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604410"><span class="hs-identifier hs-var">sepWithVBars</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="TyCoRep.html#pprDataConWithArgs"><span class="hs-identifier hs-var">pprDataConWithArgs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span>
</span><a name="line-2633"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2634"></a><span>    </span><a name="local-1627604410"><a href="#local-1627604410"><span class="hs-identifier">sepWithVBars</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-2635"></a><span>    </span><span class="hs-identifier">sepWithVBars</span><span> </span><a name="local-1627604411"><a href="#local-1627604411"><span class="hs-identifier">docs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#space"><span class="hs-identifier hs-var">space</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#vbar"><span class="hs-identifier hs-var">vbar</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604411"><span class="hs-identifier hs-var">docs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2636"></a><span>
</span><a name="line-2637"></a><span class="hs-identifier">pprDataConWithArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2638"></a><a name="pprDataConWithArgs"><a href="TyCoRep.html#pprDataConWithArgs"><span class="hs-identifier">pprDataConWithArgs</span></a></a><span> </span><a name="local-1627604412"><a href="#local-1627604412"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627604419"><span class="hs-identifier hs-var">forAllDoc</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604420"><span class="hs-identifier hs-var">thetaDoc</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604412"><span class="hs-identifier hs-var">dc</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1627604421"><span class="hs-identifier hs-var">argsDoc</span></a><span class="hs-special">]</span><span>
</span><a name="line-2639"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2640"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604413"><a href="#local-1627604413"><span class="hs-identifier">univ_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604414"><a href="#local-1627604414"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604415"><a href="#local-1627604415"><span class="hs-identifier">eq_spec</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604416"><a href="#local-1627604416"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604417"><a href="#local-1627604417"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604418"><a href="#local-1627604418"><span class="hs-identifier">_res_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a><span> </span><a href="#local-1627604412"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-2641"></a><span>    </span><a name="local-1627604419"><a href="#local-1627604419"><span class="hs-identifier">forAllDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprUserForAll"><span class="hs-identifier hs-var">pprUserForAll</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627604422"><a href="#local-1627604422"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a href="#local-1627604422"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="TyCoRep.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2642"></a><span>                </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1627604413"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#minusList"><span class="hs-identifier hs-var">minusList</span></a><span class="hs-special">`</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="DataCon.html#eqSpecTyVar"><span class="hs-identifier hs-var">eqSpecTyVar</span></a><span> </span><a href="#local-1627604415"><span class="hs-identifier hs-var">eq_spec</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627604414"><span class="hs-identifier hs-var">ex_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2643"></a><span>    </span><a name="local-1627604420"><a href="#local-1627604420"><span class="hs-identifier">thetaDoc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprThetaArrowTy"><span class="hs-identifier hs-var">pprThetaArrowTy</span></a><span> </span><a href="#local-1627604416"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-2644"></a><span>    </span><a name="local-1627604421"><a href="#local-1627604421"><span class="hs-identifier">argsDoc</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="TyCoRep.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a><span> </span><a href="#local-1627604417"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2645"></a><span>
</span><a name="line-2646"></a><span>
</span><a name="line-2647"></a><span class="hs-identifier">pprTypeApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2648"></a><a name="pprTypeApp"><a href="TyCoRep.html#pprTypeApp"><span class="hs-identifier">pprTypeApp</span></a></a><span> </span><a name="local-1627604423"><a href="#local-1627604423"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604424"><a href="#local-1627604424"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprTyTcApp"><span class="hs-identifier hs-var">pprTyTcApp</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span> </span><a href="#local-1627604423"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604424"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2649"></a><span>        </span><span class="hs-comment">-- We have to use ppr on the TyCon (not its name)</span><span>
</span><a name="line-2650"></a><span>        </span><span class="hs-comment">-- so that we get promotion quotes in the right place</span><span>
</span><a name="line-2651"></a><span>
</span><a name="line-2652"></a><span class="hs-identifier">pprTyTcApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2653"></a><span class="hs-comment">-- Used for types only; so that we can make a</span><span>
</span><a name="line-2654"></a><span class="hs-comment">-- special case for type-level lists</span><span>
</span><a name="line-2655"></a><a name="pprTyTcApp"><a href="TyCoRep.html#pprTyTcApp"><span class="hs-identifier">pprTyTcApp</span></a></a><span> </span><a name="local-1627604425"><a href="#local-1627604425"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604426"><a href="#local-1627604426"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604427"><a href="#local-1627604427"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2656"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604426"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#ipClassKey"><span class="hs-identifier hs-var">ipClassKey</span></a><span>
</span><a name="line-2657"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#StrTyLit"><span class="hs-identifier hs-var">StrTyLit</span></a><span> </span><a name="local-1627604429"><a href="#local-1627604429"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-1627604430"><a href="#local-1627604430"><span class="hs-identifier">ty</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627604427"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2658"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#maybeParen"><span class="hs-identifier hs-var">maybeParen</span></a><span> </span><a href="#local-1627604425"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="TyCoRep.html#FunPrec"><span class="hs-identifier hs-var">FunPrec</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2659"></a><span>    </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'?'</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a><span> </span><a href="#local-1627604429"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;::&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span> </span><a href="#local-1627604430"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2660"></a><span>
</span><a name="line-2661"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604426"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#consDataConKey"><span class="hs-identifier hs-var">consDataConKey</span></a><span>
</span><a name="line-2662"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-1627604431"><a href="#local-1627604431"><span class="hs-identifier">_kind</span></a></a><span class="hs-special">,</span><a name="local-1627604432"><a href="#local-1627604432"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><a name="local-1627604433"><a href="#local-1627604433"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627604427"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2663"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627604434"><a href="#local-1627604434"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2664"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_PrintExplicitKinds"><span class="hs-identifier hs-var">Opt_PrintExplicitKinds</span></a><span> </span><a href="#local-1627604434"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-1627604428"><span class="hs-identifier hs-var">ppr_deflt</span></a><span>
</span><a name="line-2665"></a><span>                                          </span><span class="hs-keyword">else</span><span> </span><a href="TyCoRep.html#pprTyList"><span class="hs-identifier hs-var">pprTyList</span></a><span> </span><a href="#local-1627604425"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627604432"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1627604433"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2666"></a><span>
</span><a name="line-2667"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="StaticFlags.html#opt_PprStyle_Debug"><span class="hs-identifier hs-var">opt_PprStyle_Debug</span></a><span>
</span><a name="line-2668"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-1627604426"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#errorMessageTypeErrorFamKey"><span class="hs-identifier hs-var">errorMessageTypeErrorFamKey</span></a><span>
</span><a name="line-2669"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(TypeError ...)&quot;</span><span>   </span><span class="hs-comment">-- Suppress detail unles you _really_ want to see</span><span>
</span><a name="line-2670"></a><span>
</span><a name="line-2671"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604426"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#tYPETyConKey"><span class="hs-identifier hs-var">tYPETyConKey</span></a><span>
</span><a name="line-2672"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-1627604435"><a href="#local-1627604435"><span class="hs-identifier">ptr_rep</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627604427"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2673"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-1627604435"><span class="hs-identifier hs-var">ptr_rep</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#ptrRepLiftedDataConKey"><span class="hs-identifier hs-var">ptrRepLiftedDataConKey</span></a><span>
</span><a name="line-2674"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#unicodeSyntax"><span class="hs-identifier hs-var">unicodeSyntax</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'&#9733;'</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'*'</span><span class="hs-special">)</span><span>
</span><a name="line-2675"></a><span>
</span><a name="line-2676"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604426"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#tYPETyConKey"><span class="hs-identifier hs-var">tYPETyConKey</span></a><span>
</span><a name="line-2677"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-1627604436"><a href="#local-1627604436"><span class="hs-identifier">ptr_rep</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627604427"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2678"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-1627604436"><span class="hs-identifier hs-var">ptr_rep</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#ptrRepUnliftedDataConKey"><span class="hs-identifier hs-var">ptrRepUnliftedDataConKey</span></a><span>
</span><a name="line-2679"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'#'</span><span>
</span><a name="line-2680"></a><span>
</span><a name="line-2681"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2682"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604428"><span class="hs-identifier hs-var">ppr_deflt</span></a><span>
</span><a name="line-2683"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2684"></a><span>    </span><a name="local-1627604428"><a href="#local-1627604428"><span class="hs-identifier">ppr_deflt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprTcAppTy"><span class="hs-identifier hs-var">pprTcAppTy</span></a><span> </span><a href="#local-1627604425"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="#local-1627604426"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604427"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2685"></a><span>
</span><a name="line-2686"></a><span class="hs-identifier">pprTcAppTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2687"></a><a name="pprTcAppTy"><a href="TyCoRep.html#pprTcAppTy"><span class="hs-identifier">pprTcAppTy</span></a></a><span> </span><a name="local-1627604437"><a href="#local-1627604437"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604438"><a href="#local-1627604438"><span class="hs-identifier">pp</span></a></a><span> </span><a name="local-1627604439"><a href="#local-1627604439"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604440"><a href="#local-1627604440"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2688"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#getPprStyle"><span class="hs-identifier hs-var">getPprStyle</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627604441"><a href="#local-1627604441"><span class="hs-identifier">style</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#pprTcApp"><span class="hs-identifier hs-var">pprTcApp</span></a><span> </span><a href="#local-1627604441"><span class="hs-identifier hs-var">style</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-1627604437"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627604438"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="#local-1627604439"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604440"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2689"></a><span>
</span><a name="line-2690"></a><span class="hs-identifier">pprTcAppCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2691"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2692"></a><a name="pprTcAppCo"><a href="TyCoRep.html#pprTcAppCo"><span class="hs-identifier">pprTcAppCo</span></a></a><span> </span><a name="local-1627604442"><a href="#local-1627604442"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604443"><a href="#local-1627604443"><span class="hs-identifier">pp</span></a></a><span> </span><a name="local-1627604444"><a href="#local-1627604444"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604445"><a href="#local-1627604445"><span class="hs-identifier">cos</span></a></a><span>
</span><a name="line-2693"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#getPprStyle"><span class="hs-identifier hs-var">getPprStyle</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627604446"><a href="#local-1627604446"><span class="hs-identifier">style</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2694"></a><span>    </span><a href="TyCoRep.html#pprTcApp"><span class="hs-identifier hs-var">pprTcApp</span></a><span> </span><a href="#local-1627604446"><span class="hs-identifier hs-var">style</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pFst</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604442"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627604443"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="#local-1627604444"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604445"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-2695"></a><span>
</span><a name="line-2696"></a><span class="hs-identifier">pprTcApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#PprStyle"><span class="hs-identifier hs-type">PprStyle</span></a><span>
</span><a name="line-2697"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627603742"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627603742"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1627603742"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2698"></a><span class="hs-comment">-- Used for both types and coercions, hence polymorphism</span><span>
</span><a name="line-2699"></a><a name="pprTcApp"><a href="TyCoRep.html#pprTcApp"><span class="hs-identifier">pprTcApp</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627604447"><a href="#local-1627604447"><span class="hs-identifier">pp</span></a></a><span> </span><a name="local-1627604448"><a href="#local-1627604448"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-special">[</span><a name="local-1627604449"><a href="#local-1627604449"><span class="hs-identifier">ty</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-2700"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604448"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#listTyConKey"><span class="hs-identifier hs-var">listTyConKey</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#pprPromotionQuote"><span class="hs-identifier hs-var">pprPromotionQuote</span></a><span> </span><a href="#local-1627604448"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span>   </span><span class="hs-special">(</span><a href="#local-1627604447"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span> </span><a href="#local-1627604449"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2701"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604448"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#parrTyConKey"><span class="hs-identifier hs-var">parrTyConKey</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#pprPromotionQuote"><span class="hs-identifier hs-var">pprPromotionQuote</span></a><span> </span><a href="#local-1627604448"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#paBrackets"><span class="hs-identifier hs-var">paBrackets</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604447"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span> </span><a href="#local-1627604449"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2702"></a><span>
</span><a name="line-2703"></a><span class="hs-identifier">pprTcApp</span><span> </span><a name="local-1627604450"><a href="#local-1627604450"><span class="hs-identifier">style</span></a></a><span> </span><a name="local-1627604451"><a href="#local-1627604451"><span class="hs-identifier">to_type</span></a></a><span> </span><a name="local-1627604452"><a href="#local-1627604452"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604453"><a href="#local-1627604453"><span class="hs-identifier">pp</span></a></a><span> </span><a name="local-1627604454"><a href="#local-1627604454"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604455"><a href="#local-1627604455"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2704"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#debugStyle"><span class="hs-identifier hs-var">debugStyle</span></a><span> </span><a href="#local-1627604450"><span class="hs-identifier hs-var">style</span></a><span class="hs-special">)</span><span>
</span><a name="line-2705"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627604456"><a href="#local-1627604456"><span class="hs-identifier">sort</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConTuple_maybe"><span class="hs-identifier hs-var">tyConTuple_maybe</span></a><span> </span><a href="#local-1627604454"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2706"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627604457"><a href="#local-1627604457"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-1627604454"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2707"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-1627604457"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627604455"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2708"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627604458"><a href="#local-1627604458"><span class="hs-identifier">num_to_drop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627604456"><span class="hs-identifier hs-var">sort</span></a><span> </span><span class="hs-keyword">of</span><span> </span><a href="BasicTypes.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627604457"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Real.html#div"><span class="hs-identifier hs-var">div</span></a><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-2709"></a><span>                                   </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2710"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprTupleApp"><span class="hs-identifier hs-var">pprTupleApp</span></a><span> </span><a href="#local-1627604452"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627604453"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="#local-1627604454"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604456"><span class="hs-identifier hs-var">sort</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a><span> </span><a href="#local-1627604458"><span class="hs-identifier hs-var">num_to_drop</span></a><span> </span><a href="#local-1627604455"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2711"></a><span>
</span><a name="line-2712"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#debugStyle"><span class="hs-identifier hs-var">debugStyle</span></a><span> </span><a href="#local-1627604450"><span class="hs-identifier hs-var">style</span></a><span class="hs-special">)</span><span>
</span><a name="line-2713"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627604459"><a href="#local-1627604459"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#isPromotedDataCon_maybe"><span class="hs-identifier hs-var">isPromotedDataCon_maybe</span></a><span> </span><a href="#local-1627604454"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2714"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627604460"><a href="#local-1627604460"><span class="hs-identifier">dc_tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a><span> </span><a href="#local-1627604459"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-2715"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627604461"><a href="#local-1627604461"><span class="hs-identifier">tup_sort</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConTuple_maybe"><span class="hs-identifier hs-var">tyConTuple_maybe</span></a><span> </span><a href="#local-1627604460"><span class="hs-identifier hs-var">dc_tc</span></a><span>
</span><a name="line-2716"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627604462"><a href="#local-1627604462"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-1627604460"><span class="hs-identifier hs-var">dc_tc</span></a><span>    </span><span class="hs-comment">-- E.g. 3 for (,,) k1 k2 k3 t1 t2 t3</span><span>
</span><a name="line-2717"></a><span>        </span><a name="local-1627604463"><a href="#local-1627604463"><span class="hs-identifier">ty_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a><span> </span><a href="#local-1627604462"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="#local-1627604455"><span class="hs-identifier hs-var">tys</span></a><span>    </span><span class="hs-comment">-- Drop the kind args</span><span>
</span><a name="line-2718"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-1627604463"><span class="hs-identifier hs-var">ty_args</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#lengthIs"><span class="hs-identifier hs-var">lengthIs</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627604462"><span class="hs-identifier hs-var">arity</span></a><span>        </span><span class="hs-comment">-- Result is saturated</span><span>
</span><a name="line-2719"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#pprPromotionQuote"><span class="hs-identifier hs-var">pprPromotionQuote</span></a><span> </span><a href="#local-1627604454"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-2720"></a><span>    </span><span class="hs-special">(</span><a href="BasicTypes.html#tupleParens"><span class="hs-identifier hs-var">tupleParens</span></a><span> </span><a href="#local-1627604461"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604453"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604463"><span class="hs-identifier hs-var">ty_args</span></a><span class="hs-special">)</span><span>
</span><a name="line-2721"></a><span>
</span><a name="line-2722"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2723"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627604464"><a href="#local-1627604464"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2724"></a><span>    </span><a href="TyCoRep.html#pprTcApp_help"><span class="hs-identifier hs-var">pprTcApp_help</span></a><span> </span><a href="#local-1627604451"><span class="hs-identifier hs-var">to_type</span></a><span> </span><a href="#local-1627604452"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627604453"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="#local-1627604454"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604455"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1627604464"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627604450"><span class="hs-identifier hs-var">style</span></a><span>
</span><a name="line-2725"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2726"></a><span>
</span><a name="line-2727"></a><span class="hs-identifier">pprTupleApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627603741"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2728"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#TupleSort"><span class="hs-identifier hs-type">TupleSort</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1627603741"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2729"></a><span class="hs-comment">-- Print a saturated tuple</span><span>
</span><a name="line-2730"></a><a name="pprTupleApp"><a href="TyCoRep.html#pprTupleApp"><span class="hs-identifier">pprTupleApp</span></a></a><span> </span><a name="local-1627604465"><a href="#local-1627604465"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604466"><a href="#local-1627604466"><span class="hs-identifier">pp</span></a></a><span> </span><a name="local-1627604467"><a href="#local-1627604467"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604468"><a href="#local-1627604468"><span class="hs-identifier">sort</span></a></a><span> </span><a name="local-1627604469"><a href="#local-1627604469"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2731"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627604469"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2732"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627604468"><span class="hs-identifier hs-var">sort</span></a><span>
</span><a name="line-2733"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="StaticFlags.html#opt_PprStyle_Debug"><span class="hs-identifier hs-var">opt_PprStyle_Debug</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(%%)&quot;</span><span>
</span><a name="line-2734"></a><span>                          </span><span class="hs-keyword">else</span><span> </span><a href="TyCoRep.html#maybeParen"><span class="hs-identifier hs-var">maybeParen</span></a><span> </span><a href="#local-1627604465"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="TyCoRep.html#FunPrec"><span class="hs-identifier hs-var">FunPrec</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2735"></a><span>                               </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;() :: Constraint&quot;</span><span>
</span><a name="line-2736"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2737"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#pprPromotionQuote"><span class="hs-identifier hs-var">pprPromotionQuote</span></a><span> </span><a href="#local-1627604467"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-2738"></a><span>    </span><a href="BasicTypes.html#tupleParens"><span class="hs-identifier hs-var">tupleParens</span></a><span> </span><a href="#local-1627604468"><span class="hs-identifier hs-var">sort</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604466"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604469"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2739"></a><span>
</span><a name="line-2740"></a><span class="hs-identifier">pprTcApp_help</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627603740"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627603740"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2741"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1627603740"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#PprStyle"><span class="hs-identifier hs-type">PprStyle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2742"></a><span class="hs-comment">-- This one has accss to the DynFlags</span><span>
</span><a name="line-2743"></a><a name="pprTcApp_help"><a href="TyCoRep.html#pprTcApp_help"><span class="hs-identifier">pprTcApp_help</span></a></a><span> </span><a name="local-1627604470"><a href="#local-1627604470"><span class="hs-identifier">to_type</span></a></a><span> </span><a name="local-1627604471"><a href="#local-1627604471"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604472"><a href="#local-1627604472"><span class="hs-identifier">pp</span></a></a><span> </span><a name="local-1627604473"><a href="#local-1627604473"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604474"><a href="#local-1627604474"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-1627604475"><a href="#local-1627604475"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627604476"><a href="#local-1627604476"><span class="hs-identifier">style</span></a></a><span>
</span><a name="line-2744"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604478"><span class="hs-identifier hs-var">print_prefix</span></a><span>
</span><a name="line-2745"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprPrefixApp"><span class="hs-identifier hs-var">pprPrefixApp</span></a><span> </span><a href="#local-1627604471"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627604479"><span class="hs-identifier hs-var">pp_tc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604472"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="TyCoRep.html#TyConPrec"><span class="hs-identifier hs-var">TyConPrec</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604481"><span class="hs-identifier hs-var">tys_wo_kinds</span></a><span class="hs-special">)</span><span>
</span><a name="line-2746"></a><span>
</span><a name="line-2747"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><a name="local-1627604482"><a href="#local-1627604482"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><a name="local-1627604483"><a href="#local-1627604483"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627604481"><span class="hs-identifier hs-var">tys_wo_kinds</span></a><span>  </span><span class="hs-comment">-- Infix, two arguments;</span><span>
</span><a name="line-2748"></a><span>                               </span><span class="hs-comment">-- we know nothing of precedence though</span><span>
</span><a name="line-2749"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprInfixApp"><span class="hs-identifier hs-var">pprInfixApp</span></a><span> </span><a href="#local-1627604471"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627604472"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="#local-1627604479"><span class="hs-identifier hs-var">pp_tc</span></a><span> </span><a href="#local-1627604482"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1627604483"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2750"></a><span>
</span><a name="line-2751"></a><span>  </span><span class="hs-glyph">|</span><span>  </span><a href="#local-1627604477"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#starKindTyConKey"><span class="hs-identifier hs-var">starKindTyConKey</span></a><span>
</span><a name="line-2752"></a><span>  </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1627604477"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#unicodeStarKindTyConKey"><span class="hs-identifier hs-var">unicodeStarKindTyConKey</span></a><span>
</span><a name="line-2753"></a><span>  </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1627604477"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#unliftedTypeKindTyConKey"><span class="hs-identifier hs-var">unliftedTypeKindTyConKey</span></a><span>
</span><a name="line-2754"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604479"><span class="hs-identifier hs-var">pp_tc</span></a><span>   </span><span class="hs-comment">-- Do not wrap *, # in parens</span><span>
</span><a name="line-2755"></a><span>
</span><a name="line-2756"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2757"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprPrefixApp"><span class="hs-identifier hs-var">pprPrefixApp</span></a><span> </span><a href="#local-1627604471"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><a href="#local-1627604479"><span class="hs-identifier hs-var">pp_tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604472"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="TyCoRep.html#TyConPrec"><span class="hs-identifier hs-var">TyConPrec</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604481"><span class="hs-identifier hs-var">tys_wo_kinds</span></a><span class="hs-special">)</span><span>
</span><a name="line-2758"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2759"></a><span>    </span><a name="local-1627604477"><a href="#local-1627604477"><span class="hs-identifier">tc_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-1627604473"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2760"></a><span>
</span><a name="line-2761"></a><span>     </span><span class="hs-comment">-- With the solver working in unlifted equality, it will want to</span><span>
</span><a name="line-2762"></a><span>     </span><span class="hs-comment">-- to print unlifted equality constraints sometimes. But these are</span><span>
</span><a name="line-2763"></a><span>     </span><span class="hs-comment">-- confusing to users. So fix them up here.</span><span>
</span><a name="line-2764"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604478"><a href="#local-1627604478"><span class="hs-identifier">print_prefix</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604479"><a href="#local-1627604479"><span class="hs-identifier">pp_tc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2765"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="#local-1627604473"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-1627604473"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#heqTyConKey"><span class="hs-identifier hs-var">heqTyConKey</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1627604480"><span class="hs-identifier hs-var">print_eqs</span></a><span>
</span><a name="line-2766"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;~&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2767"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604473"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1627604480"><span class="hs-identifier hs-var">print_eqs</span></a><span>
</span><a name="line-2768"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Coercible&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2769"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2770"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="OccName.html#isSymOcc"><span class="hs-identifier hs-var">isSymOcc</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1627604477"><span class="hs-identifier hs-var">tc_name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627604473"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2771"></a><span>
</span><a name="line-2772"></a><span>    </span><a name="local-1627604480"><a href="#local-1627604480"><span class="hs-identifier">print_eqs</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_PrintEqualityRelations"><span class="hs-identifier hs-var">Opt_PrintEqualityRelations</span></a><span> </span><a href="#local-1627604475"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-2773"></a><span>                   </span><a href="Outputable.html#dumpStyle"><span class="hs-identifier hs-var">dumpStyle</span></a><span> </span><a href="#local-1627604476"><span class="hs-identifier hs-var">style</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-2774"></a><span>                   </span><a href="Outputable.html#debugStyle"><span class="hs-identifier hs-var">debugStyle</span></a><span> </span><a href="#local-1627604476"><span class="hs-identifier hs-var">style</span></a><span>
</span><a name="line-2775"></a><span>    </span><a name="local-1627604481"><a href="#local-1627604481"><span class="hs-identifier">tys_wo_kinds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#suppressInvisibles"><span class="hs-identifier hs-var">suppressInvisibles</span></a><span> </span><a href="#local-1627604470"><span class="hs-identifier hs-var">to_type</span></a><span> </span><a href="#local-1627604475"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627604473"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604474"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2776"></a><span>
</span><a name="line-2777"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-2778"></a><span class="hs-comment">-- | Given a 'TyCon',and the args to which it is applied,</span><span>
</span><a name="line-2779"></a><span class="hs-comment">-- suppress the args that are implicit</span><span>
</span><a name="line-2780"></a><span class="hs-identifier">suppressInvisibles</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627603739"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1627603739"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1627603739"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-2781"></a><a name="suppressInvisibles"><a href="TyCoRep.html#suppressInvisibles"><span class="hs-identifier">suppressInvisibles</span></a></a><span> </span><a name="local-1627604484"><a href="#local-1627604484"><span class="hs-identifier">to_type</span></a></a><span> </span><a name="local-1627604485"><a href="#local-1627604485"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1627604486"><a href="#local-1627604486"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604487"><a href="#local-1627604487"><span class="hs-identifier">xs</span></a></a><span>
</span><a name="line-2782"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_PrintExplicitKinds"><span class="hs-identifier hs-var">Opt_PrintExplicitKinds</span></a><span> </span><a href="#local-1627604485"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604487"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-2783"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Type.html#partitionInvisibles"><span class="hs-identifier hs-var">partitionInvisibles</span></a><span> </span><a href="#local-1627604486"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604484"><span class="hs-identifier hs-var">to_type</span></a><span> </span><a href="#local-1627604487"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-2784"></a><span>
</span><a name="line-2785"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-2786"></a><span class="hs-identifier">pprTyList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2787"></a><span class="hs-comment">-- Given a type-level list (t1 ': t2), see if we can print</span><span>
</span><a name="line-2788"></a><span class="hs-comment">-- it in list notation [t1, ...].</span><span>
</span><a name="line-2789"></a><a name="pprTyList"><a href="TyCoRep.html#pprTyList"><span class="hs-identifier">pprTyList</span></a></a><span> </span><a name="local-1627604488"><a href="#local-1627604488"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604489"><a href="#local-1627604489"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1627604490"><a href="#local-1627604490"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-2790"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627604491"><span class="hs-identifier hs-var">gather</span></a><span> </span><a href="#local-1627604490"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2791"></a><span>      </span><span class="hs-special">(</span><a name="local-1627604500"><a href="#local-1627604500"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'\''</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-2792"></a><span>                                            </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#TopPrec"><span class="hs-identifier hs-var">TopPrec</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627604489"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-glyph">:</span><a href="#local-1627604500"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2793"></a><span>      </span><span class="hs-special">(</span><a name="local-1627604501"><a href="#local-1627604501"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627604502"><a href="#local-1627604502"><span class="hs-identifier">tl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#maybeParen"><span class="hs-identifier hs-var">maybeParen</span></a><span> </span><a href="#local-1627604488"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="TyCoRep.html#FunPrec"><span class="hs-identifier hs-var">FunPrec</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2794"></a><span>                            </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#FunPrec"><span class="hs-identifier hs-var">FunPrec</span></a><span> </span><a href="#local-1627604489"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span>
</span><a name="line-2795"></a><span>                               </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#ppr_type"><span class="hs-identifier hs-var">ppr_type</span></a><span> </span><a href="TyCoRep.html#FunPrec"><span class="hs-identifier hs-var">FunPrec</span></a><span> </span><a href="#local-1627604503"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1627604503"><a href="#local-1627604503"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627604501"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627604502"><span class="hs-identifier hs-var">tl</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2796"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2797"></a><span>    </span><span class="hs-identifier">gather</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-2798"></a><span>     </span><span class="hs-comment">-- (gather ty) = (tys, Nothing) means ty is a list [t1, .., tn]</span><span>
</span><a name="line-2799"></a><span>     </span><span class="hs-comment">--             = (tys, Just tl) means ty is of form t1:t2:...tn:tl</span><span>
</span><a name="line-2800"></a><span>    </span><a name="local-1627604491"><a href="#local-1627604491"><span class="hs-identifier">gather</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-1627604492"><a href="#local-1627604492"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604493"><a href="#local-1627604493"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2801"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604492"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#consDataConKey"><span class="hs-identifier hs-var">consDataConKey</span></a><span>
</span><a name="line-2802"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-1627604494"><a href="#local-1627604494"><span class="hs-identifier">_kind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604495"><a href="#local-1627604495"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><a name="local-1627604496"><a href="#local-1627604496"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627604493"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2803"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1627604497"><a href="#local-1627604497"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604498"><a href="#local-1627604498"><span class="hs-identifier">tl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627604491"><span class="hs-identifier hs-var">gather</span></a><span> </span><a href="#local-1627604496"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2804"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627604495"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-glyph">:</span><a href="#local-1627604497"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604498"><span class="hs-identifier hs-var">tl</span></a><span class="hs-special">)</span><span>
</span><a name="line-2805"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627604492"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#nilDataConKey"><span class="hs-identifier hs-var">nilDataConKey</span></a><span>
</span><a name="line-2806"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-2807"></a><span>    </span><span class="hs-identifier">gather</span><span> </span><a name="local-1627604499"><a href="#local-1627604499"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627604499"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2808"></a><span>
</span><a name="line-2809"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-2810"></a><span class="hs-identifier">pprInfixApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627603738"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627603738"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627603738"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2811"></a><a name="pprInfixApp"><a href="TyCoRep.html#pprInfixApp"><span class="hs-identifier">pprInfixApp</span></a></a><span> </span><a name="local-1627604504"><a href="#local-1627604504"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604505"><a href="#local-1627604505"><span class="hs-identifier">pp</span></a></a><span> </span><a name="local-1627604506"><a href="#local-1627604506"><span class="hs-identifier">pp_tc</span></a></a><span> </span><a name="local-1627604507"><a href="#local-1627604507"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1627604508"><a href="#local-1627604508"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-2812"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#maybeParen"><span class="hs-identifier hs-var">maybeParen</span></a><span> </span><a href="#local-1627604504"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="TyCoRep.html#TyOpPrec"><span class="hs-identifier hs-var">TyOpPrec</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2813"></a><span>    </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627604505"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="TyCoRep.html#TyOpPrec"><span class="hs-identifier hs-var">TyOpPrec</span></a><span> </span><a href="#local-1627604507"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#pprInfixVar"><span class="hs-identifier hs-var">pprInfixVar</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-1627604506"><span class="hs-identifier hs-var">pp_tc</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-1627604505"><span class="hs-identifier hs-var">pp</span></a><span> </span><a href="TyCoRep.html#TyOpPrec"><span class="hs-identifier hs-var">TyOpPrec</span></a><span> </span><a href="#local-1627604508"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-2814"></a><span>
</span><a name="line-2815"></a><span class="hs-identifier">pprPrefixApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2816"></a><a name="pprPrefixApp"><a href="TyCoRep.html#pprPrefixApp"><span class="hs-identifier">pprPrefixApp</span></a></a><span> </span><a name="local-1627604509"><a href="#local-1627604509"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604510"><a href="#local-1627604510"><span class="hs-identifier">pp_fun</span></a></a><span> </span><a name="local-1627604511"><a href="#local-1627604511"><span class="hs-identifier">pp_tys</span></a></a><span>
</span><a name="line-2817"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627604511"><span class="hs-identifier hs-var">pp_tys</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604510"><span class="hs-identifier hs-var">pp_fun</span></a><span>
</span><a name="line-2818"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#maybeParen"><span class="hs-identifier hs-var">maybeParen</span></a><span> </span><a href="#local-1627604509"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="TyCoRep.html#TyConPrec"><span class="hs-identifier hs-var">TyConPrec</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2819"></a><span>                  </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><a href="#local-1627604510"><span class="hs-identifier hs-var">pp_fun</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><a href="#local-1627604511"><span class="hs-identifier hs-var">pp_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2820"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-2821"></a><span class="hs-identifier">pprArrowChain</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyPrec"><span class="hs-identifier hs-type">TyPrec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2822"></a><span class="hs-comment">-- pprArrowChain p [a,b,c]  generates   a -&gt; b -&gt; c</span><span>
</span><a name="line-2823"></a><a name="pprArrowChain"><a href="TyCoRep.html#pprArrowChain"><span class="hs-identifier">pprArrowChain</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-2824"></a><span class="hs-identifier">pprArrowChain</span><span> </span><a name="local-1627604512"><a href="#local-1627604512"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627604513"><a href="#local-1627604513"><span class="hs-identifier">arg</span></a></a><span class="hs-glyph">:</span><a name="local-1627604514"><a href="#local-1627604514"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#maybeParen"><span class="hs-identifier hs-var">maybeParen</span></a><span> </span><a href="#local-1627604512"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="TyCoRep.html#FunPrec"><span class="hs-identifier hs-var">FunPrec</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2825"></a><span>                             </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627604513"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#arrow"><span class="hs-identifier hs-var">arrow</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604514"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2826"></a><span>
</span><a name="line-2827"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
\subsection{TidyType}
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-2834"></a><span>
</span><a name="line-2835"></a><span class="hs-comment">-- | This tidies up a type for printing in an error message, or in</span><span>
</span><a name="line-2836"></a><span class="hs-comment">-- an interface file.</span><span>
</span><a name="line-2837"></a><span class="hs-comment">--</span><span>
</span><a name="line-2838"></a><span class="hs-comment">-- It doesn't change the uniques at all, just the print names.</span><span>
</span><a name="line-2839"></a><span class="hs-identifier">tidyTyCoVarBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2840"></a><a name="tidyTyCoVarBndrs"><a href="TyCoRep.html#tidyTyCoVarBndrs"><span class="hs-identifier">tidyTyCoVarBndrs</span></a></a><span> </span><a name="local-1627604515"><a href="#local-1627604515"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627604516"><a href="#local-1627604516"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a><span> </span><a href="TyCoRep.html#tidyTyCoVarBndr"><span class="hs-identifier hs-var">tidyTyCoVarBndr</span></a><span> </span><a href="#local-1627604515"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604516"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-2841"></a><span>
</span><a name="line-2842"></a><span class="hs-identifier">tidyTyCoVarBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2843"></a><a name="tidyTyCoVarBndr"><a href="TyCoRep.html#tidyTyCoVarBndr"><span class="hs-identifier">tidyTyCoVarBndr</span></a></a><span> </span><a name="local-1627604517"><a href="#local-1627604517"><span class="hs-identifier">tidy_env</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627604518"><a href="#local-1627604518"><span class="hs-identifier">occ_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604519"><a href="#local-1627604519"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604520"><a href="#local-1627604520"><span class="hs-identifier">tyvar</span></a></a><span>
</span><a name="line-2844"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="OccName.html#tidyOccName"><span class="hs-identifier hs-var">tidyOccName</span></a><span> </span><a href="#local-1627604518"><span class="hs-identifier hs-var">occ_env</span></a><span> </span><a href="#local-1627604523"><span class="hs-identifier hs-var">occ1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2845"></a><span>      </span><span class="hs-special">(</span><a name="local-1627604524"><a href="#local-1627604524"><span class="hs-identifier">tidy'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604525"><a href="#local-1627604525"><span class="hs-identifier">occ'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1627604524"><span class="hs-identifier hs-var">tidy'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604526"><span class="hs-identifier hs-var">subst'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1627604527"><span class="hs-identifier hs-var">tyvar'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2846"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-2847"></a><span>          </span><a name="local-1627604526"><a href="#local-1627604526"><span class="hs-identifier">subst'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-1627604519"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604520"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><a href="#local-1627604527"><span class="hs-identifier hs-var">tyvar'</span></a><span>
</span><a name="line-2848"></a><span>          </span><a name="local-1627604527"><a href="#local-1627604527"><span class="hs-identifier">tyvar'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#setTyVarName"><span class="hs-identifier hs-var">setTyVarName</span></a><span> </span><a href="#local-1627604520"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><a href="#local-1627604528"><span class="hs-identifier hs-var">name'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604529"><span class="hs-identifier hs-var">kind'</span></a><span>
</span><a name="line-2849"></a><span>          </span><a name="local-1627604528"><a href="#local-1627604528"><span class="hs-identifier">name'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#tidyNameOcc"><span class="hs-identifier hs-var">tidyNameOcc</span></a><span> </span><a href="#local-1627604521"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-1627604525"><span class="hs-identifier hs-var">occ'</span></a><span>
</span><a name="line-2850"></a><span>          </span><a name="local-1627604529"><a href="#local-1627604529"><span class="hs-identifier">kind'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyKind"><span class="hs-identifier hs-var">tidyKind</span></a><span> </span><a href="#local-1627604517"><span class="hs-identifier hs-var">tidy_env</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1627604520"><span class="hs-identifier hs-var">tyvar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2851"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2852"></a><span>    </span><a name="local-1627604521"><a href="#local-1627604521"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-1627604520"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-2853"></a><span>    </span><a name="local-1627604522"><a href="#local-1627604522"><span class="hs-identifier">occ</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1627604521"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-2854"></a><span>    </span><span class="hs-comment">-- System Names are for unification variables;</span><span>
</span><a name="line-2855"></a><span>    </span><span class="hs-comment">-- when we tidy them we give them a trailing &quot;0&quot; (or 1 etc)</span><span>
</span><a name="line-2856"></a><span>    </span><span class="hs-comment">-- so that they don't take precedence for the un-modified name</span><span>
</span><a name="line-2857"></a><span>    </span><span class="hs-comment">-- Plus, indicating a unification variable in this way is a</span><span>
</span><a name="line-2858"></a><span>    </span><span class="hs-comment">-- helpful clue for users</span><span>
</span><a name="line-2859"></a><span>    </span><a name="local-1627604523"><a href="#local-1627604523"><span class="hs-identifier">occ1</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Name.html#isSystemName"><span class="hs-identifier hs-var">isSystemName</span></a><span> </span><a href="#local-1627604521"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-2860"></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-1627604520"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-2861"></a><span>           </span><span class="hs-keyword">then</span><span> </span><a href="OccName.html#mkTyVarOcc"><span class="hs-identifier hs-var">mkTyVarOcc</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#occNameString"><span class="hs-identifier hs-var">occNameString</span></a><span> </span><a href="#local-1627604522"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;0&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2862"></a><span>           </span><span class="hs-keyword">else</span><span> </span><a href="OccName.html#mkVarOcc"><span class="hs-identifier hs-var">mkVarOcc</span></a><span>   </span><span class="hs-special">(</span><a href="OccName.html#occNameString"><span class="hs-identifier hs-var">occNameString</span></a><span> </span><a href="#local-1627604522"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;0&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2863"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604522"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-2864"></a><span>
</span><a name="line-2865"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-2866"></a><span class="hs-identifier">tidyFreeTyCoVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span>
</span><a name="line-2867"></a><span class="hs-comment">-- ^ Add the free 'TyVar's to the env in tidy form,</span><span>
</span><a name="line-2868"></a><span class="hs-comment">-- so that we can tidy the type they are free in</span><span>
</span><a name="line-2869"></a><a name="tidyFreeTyCoVars"><a href="TyCoRep.html#tidyFreeTyCoVars"><span class="hs-identifier">tidyFreeTyCoVars</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627604530"><a href="#local-1627604530"><span class="hs-identifier">full_occ_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604531"><a href="#local-1627604531"><span class="hs-identifier">var_env</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604532"><a href="#local-1627604532"><span class="hs-identifier">tyvars</span></a></a><span>
</span><a name="line-2870"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyOpenTyCoVars"><span class="hs-identifier hs-var">tidyOpenTyCoVars</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604530"><span class="hs-identifier hs-var">full_occ_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604531"><span class="hs-identifier hs-var">var_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="VarSet.html#varSetElems"><span class="hs-identifier hs-var">varSetElems</span></a><span> </span><a href="#local-1627604532"><span class="hs-identifier hs-var">tyvars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2871"></a><span>
</span><a name="line-2872"></a><span>        </span><span class="hs-comment">---------------</span><span>
</span><a name="line-2873"></a><span class="hs-identifier">tidyOpenTyCoVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2874"></a><a name="tidyOpenTyCoVars"><a href="TyCoRep.html#tidyOpenTyCoVars"><span class="hs-identifier">tidyOpenTyCoVars</span></a></a><span> </span><a name="local-1627604533"><a href="#local-1627604533"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627604534"><a href="#local-1627604534"><span class="hs-identifier">tyvars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a><span> </span><a href="TyCoRep.html#tidyOpenTyCoVar"><span class="hs-identifier hs-var">tidyOpenTyCoVar</span></a><span> </span><a href="#local-1627604533"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604534"><span class="hs-identifier hs-var">tyvars</span></a><span>
</span><a name="line-2875"></a><span>
</span><a name="line-2876"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-2877"></a><span class="hs-identifier">tidyOpenTyCoVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2878"></a><span class="hs-comment">-- ^ Treat a new 'TyCoVar' as a binder, and give it a fresh tidy name</span><span>
</span><a name="line-2879"></a><span class="hs-comment">-- using the environment if one has not already been allocated. See</span><span>
</span><a name="line-2880"></a><span class="hs-comment">-- also 'tidyTyCoVarBndr'</span><span>
</span><a name="line-2881"></a><a name="tidyOpenTyCoVar"><a href="TyCoRep.html#tidyOpenTyCoVar"><span class="hs-identifier">tidyOpenTyCoVar</span></a></a><span> </span><a name="local-1627604535"><a href="#local-1627604535"><span class="hs-identifier">env</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627604536"><a href="#local-1627604536"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604537"><a href="#local-1627604537"><span class="hs-identifier">tyvar</span></a></a><span>
</span><a name="line-2882"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1627604536"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604537"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2883"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627604538"><a href="#local-1627604538"><span class="hs-identifier">tyvar'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627604535"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604538"><span class="hs-identifier hs-var">tyvar'</span></a><span class="hs-special">)</span><span>              </span><span class="hs-comment">-- Already substituted</span><span>
</span><a name="line-2884"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#tidyTyCoVarBndr"><span class="hs-identifier hs-var">tidyTyCoVarBndr</span></a><span> </span><a href="#local-1627604535"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604537"><span class="hs-identifier hs-var">tyvar</span></a><span>  </span><span class="hs-comment">-- Treat it as a binder</span><span>
</span><a name="line-2885"></a><span>
</span><a name="line-2886"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-2887"></a><span class="hs-identifier">tidyTyVarOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-2888"></a><a name="tidyTyVarOcc"><a href="TyCoRep.html#tidyTyVarOcc"><span class="hs-identifier">tidyTyVarOcc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627604539"><a href="#local-1627604539"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604540"><a href="#local-1627604540"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2889"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1627604539"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604540"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2890"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627604540"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2891"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627604541"><a href="#local-1627604541"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627604541"><span class="hs-identifier hs-var">tv'</span></a><span>
</span><a name="line-2892"></a><span>
</span><a name="line-2893"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-2894"></a><span class="hs-identifier">tidyTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-2895"></a><a name="tidyTypes"><a href="TyCoRep.html#tidyTypes"><span class="hs-identifier">tidyTypes</span></a></a><span> </span><a name="local-1627604542"><a href="#local-1627604542"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627604543"><a href="#local-1627604543"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1627604542"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604543"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2896"></a><span>
</span><a name="line-2897"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-2898"></a><span class="hs-identifier">tidyType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2899"></a><a name="tidyType"><a href="TyCoRep.html#tidyType"><span class="hs-identifier">tidyType</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-1627604544"><a href="#local-1627604544"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a href="#local-1627604544"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-2900"></a><span class="hs-identifier">tidyType</span><span> </span><a name="local-1627604545"><a href="#local-1627604545"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-1627604546"><a href="#local-1627604546"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyTyVarOcc"><span class="hs-identifier hs-var">tidyTyVarOcc</span></a><span> </span><a href="#local-1627604545"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604546"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2901"></a><span class="hs-identifier">tidyType</span><span> </span><a name="local-1627604547"><a href="#local-1627604547"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-1627604548"><a href="#local-1627604548"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-1627604549"><a href="#local-1627604549"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627604550"><a href="#local-1627604550"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyTypes"><span class="hs-identifier hs-var">tidyTypes</span></a><span> </span><a href="#local-1627604547"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604549"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2902"></a><span>                                    </span><span class="hs-keyword">in</span><span> </span><a href="#local-1627604550"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#seqList"><span class="hs-identifier hs-var">seqList</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="#local-1627604548"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-1627604550"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2903"></a><span class="hs-identifier">tidyType</span><span> </span><a name="local-1627604551"><a href="#local-1627604551"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-1627604552"><a href="#local-1627604552"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-1627604553"><a href="#local-1627604553"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1627604551"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604552"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1627604551"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604553"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2904"></a><span class="hs-identifier">tidyType</span><span> </span><a name="local-1627604554"><a href="#local-1627604554"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-1627604555"><a href="#local-1627604555"><span class="hs-identifier">fun</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604556"><a href="#local-1627604556"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2905"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1627604554"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604555"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1627604554"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604556"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2906"></a><span class="hs-identifier">tidyType</span><span> </span><a name="local-1627604557"><a href="#local-1627604557"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-1627604558"><a href="#local-1627604558"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1627604559"><a href="#local-1627604559"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604560"><a href="#local-1627604560"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2907"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604562"><span class="hs-identifier hs-var">tvp</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604559"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1627604561"><span class="hs-identifier hs-var">envp</span></a><span> </span><a href="#local-1627604560"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2908"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2909"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604561"><a href="#local-1627604561"><span class="hs-identifier">envp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604562"><a href="#local-1627604562"><span class="hs-identifier">tvp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyTyCoVarBndr"><span class="hs-identifier hs-var">tidyTyCoVarBndr</span></a><span> </span><a href="#local-1627604557"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604558"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2910"></a><span class="hs-identifier">tidyType</span><span> </span><a name="local-1627604563"><a href="#local-1627604563"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-1627604564"><a href="#local-1627604564"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1627604565"><a href="#local-1627604565"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1627604563"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604564"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a><span> </span><a href="#local-1627604563"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604565"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2911"></a><span class="hs-identifier">tidyType</span><span> </span><a name="local-1627604566"><a href="#local-1627604566"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-1627604567"><a href="#local-1627604567"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a><span> </span><a href="#local-1627604566"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604567"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2912"></a><span>
</span><a name="line-2913"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-2914"></a><span class="hs-comment">-- | Grabs the free type variables, tidies them</span><span>
</span><a name="line-2915"></a><span class="hs-comment">-- and then uses 'tidyType' to work over the type itself</span><span>
</span><a name="line-2916"></a><span class="hs-identifier">tidyOpenType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-2917"></a><a name="tidyOpenType"><a href="TyCoRep.html#tidyOpenType"><span class="hs-identifier">tidyOpenType</span></a></a><span> </span><a name="local-1627604568"><a href="#local-1627604568"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627604569"><a href="#local-1627604569"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2918"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627604570"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604573"><span class="hs-identifier hs-var">trimmed_occ_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627604571"><span class="hs-identifier hs-var">var_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627604569"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2919"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2920"></a><span>    </span><span class="hs-special">(</span><a name="local-1627604570"><a href="#local-1627604570"><span class="hs-identifier">env'</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627604571"><a href="#local-1627604571"><span class="hs-identifier">var_env</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1627604572"><a href="#local-1627604572"><span class="hs-identifier">tvs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyOpenTyCoVars"><span class="hs-identifier hs-var">tidyOpenTyCoVars</span></a><span> </span><a href="#local-1627604568"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypeList"><span class="hs-identifier hs-var">tyCoVarsOfTypeList</span></a><span> </span><a href="#local-1627604569"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2921"></a><span>    </span><a name="local-1627604573"><a href="#local-1627604573"><span class="hs-identifier">trimmed_occ_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#initTidyOccEnv"><span class="hs-identifier hs-var">initTidyOccEnv</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1627604572"><span class="hs-identifier hs-var">tvs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2922"></a><span>      </span><span class="hs-comment">-- The idea here was that we restrict the new TidyEnv to the</span><span>
</span><a name="line-2923"></a><span>      </span><span class="hs-comment">-- _free_ vars of the type, so that we don't gratuitously rename</span><span>
</span><a name="line-2924"></a><span>      </span><span class="hs-comment">-- the _bound_ variables of the type.</span><span>
</span><a name="line-2925"></a><span>
</span><a name="line-2926"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-2927"></a><span class="hs-identifier">tidyOpenTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2928"></a><a name="tidyOpenTypes"><a href="TyCoRep.html#tidyOpenTypes"><span class="hs-identifier">tidyOpenTypes</span></a></a><span> </span><a name="local-1627604574"><a href="#local-1627604574"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627604575"><a href="#local-1627604575"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a><span> </span><a href="TyCoRep.html#tidyOpenType"><span class="hs-identifier hs-var">tidyOpenType</span></a><span> </span><a href="#local-1627604574"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604575"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2929"></a><span>
</span><a name="line-2930"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-2931"></a><span class="hs-comment">-- | Calls 'tidyType' on a top-level type (i.e. with an empty tidying environment)</span><span>
</span><a name="line-2932"></a><span class="hs-identifier">tidyTopType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2933"></a><a name="tidyTopType"><a href="TyCoRep.html#tidyTopType"><span class="hs-identifier">tidyTopType</span></a></a><span> </span><a name="local-1627604576"><a href="#local-1627604576"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="VarEnv.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a><span> </span><a href="#local-1627604576"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2934"></a><span>
</span><a name="line-2935"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-2936"></a><span class="hs-identifier">tidyOpenKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-2937"></a><a name="tidyOpenKind"><a href="TyCoRep.html#tidyOpenKind"><span class="hs-identifier">tidyOpenKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyOpenType"><span class="hs-identifier hs-var">tidyOpenType</span></a><span>
</span><a name="line-2938"></a><span>
</span><a name="line-2939"></a><span class="hs-identifier">tidyKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-2940"></a><a name="tidyKind"><a href="TyCoRep.html#tidyKind"><span class="hs-identifier">tidyKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span>
</span><a name="line-2941"></a><span>
</span><a name="line-2942"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-2943"></a><span class="hs-identifier">tidyCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2944"></a><a name="tidyCo"><a href="TyCoRep.html#tidyCo"><span class="hs-identifier">tidyCo</span></a></a><span> </span><a name="local-1627604577"><a href="#local-1627604577"><span class="hs-identifier">env</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627604578"><a href="#local-1627604578"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627604579"><a href="#local-1627604579"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-2945"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604579"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2946"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2947"></a><span>    </span><a name="local-1627604580"><a href="#local-1627604580"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-1627604582"><a href="#local-1627604582"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-1627604583"><a href="#local-1627604583"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-1627604582"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1627604577"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604583"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2948"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a name="local-1627604584"><a href="#local-1627604584"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-1627604585"><a href="#local-1627604585"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627604586"><a href="#local-1627604586"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627604587"><a href="#local-1627604587"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604586"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-2949"></a><span>                               </span><span class="hs-keyword">in</span><span> </span><a href="#local-1627604587"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#seqList"><span class="hs-identifier hs-var">seqList</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a href="#local-1627604584"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-1627604585"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627604587"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2950"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-1627604588"><a href="#local-1627604588"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-1627604589"><a href="#local-1627604589"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604588"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604589"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-2951"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-1627604590"><a href="#local-1627604590"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1627604591"><a href="#local-1627604591"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-1627604592"><a href="#local-1627604592"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604594"><span class="hs-identifier hs-var">tvp</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604591"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a><span> </span><a href="#local-1627604593"><span class="hs-identifier hs-var">envp</span></a><span> </span><a href="#local-1627604592"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2952"></a><span>                               </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-1627604593"><a href="#local-1627604593"><span class="hs-identifier">envp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627604594"><a href="#local-1627604594"><span class="hs-identifier">tvp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyTyCoVarBndr"><span class="hs-identifier hs-var">tidyTyCoVarBndr</span></a><span> </span><a href="#local-1627604577"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604590"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2953"></a><span>            </span><span class="hs-comment">-- the case above duplicates a bit of work in tidying h and the kind</span><span>
</span><a name="line-2954"></a><span>            </span><span class="hs-comment">-- of tv. But the alternative is to use coercionKind, which seems worse.</span><span>
</span><a name="line-2955"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-1627604595"><a href="#local-1627604595"><span class="hs-identifier">cv</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1627604578"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627604595"><span class="hs-identifier hs-var">cv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2956"></a><span>                                 </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a href="#local-1627604595"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-2957"></a><span>                                 </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627604596"><a href="#local-1627604596"><span class="hs-identifier">cv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a href="#local-1627604596"><span class="hs-identifier hs-var">cv'</span></a><span>
</span><a name="line-2958"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><a name="local-1627604597"><a href="#local-1627604597"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-1627604598"><a href="#local-1627604598"><span class="hs-identifier">ind</span></a></a><span> </span><a name="local-1627604599"><a href="#local-1627604599"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627604600"><a href="#local-1627604600"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604599"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-2959"></a><span>                               </span><span class="hs-keyword">in</span><span>  </span><a href="#local-1627604600"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#seqList"><span class="hs-identifier hs-var">seqList</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><a href="#local-1627604597"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-1627604598"><span class="hs-identifier hs-var">ind</span></a><span> </span><a href="#local-1627604600"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2960"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a name="local-1627604601"><a href="#local-1627604601"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627604602"><a href="#local-1627604602"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-1627604603"><a href="#local-1627604603"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-1627604604"><a href="#local-1627604604"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604581"><span class="hs-identifier hs-var">go_prov</span></a><span> </span><a href="#local-1627604601"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604602"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span>
</span><a name="line-2961"></a><span>                                </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1627604577"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604603"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1627604577"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604604"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2962"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-1627604605"><a href="#local-1627604605"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604605"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2963"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-1627604606"><a href="#local-1627604606"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-1627604607"><a href="#local-1627604607"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604606"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604607"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-2964"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a name="local-1627604608"><a href="#local-1627604608"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-1627604609"><a href="#local-1627604609"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a href="#local-1627604608"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604609"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2965"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><a name="local-1627604610"><a href="#local-1627604610"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-1627604611"><a href="#local-1627604611"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><a href="#local-1627604610"><span class="hs-identifier hs-var">lr</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604611"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2966"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-1627604612"><a href="#local-1627604612"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-1627604613"><a href="#local-1627604613"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604612"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604613"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2967"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a name="local-1627604614"><a href="#local-1627604614"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-1627604615"><a href="#local-1627604615"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604614"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604615"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-2968"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a name="local-1627604616"><a href="#local-1627604616"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604616"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2969"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-1627604617"><a href="#local-1627604617"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604617"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2970"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><a name="local-1627604618"><a href="#local-1627604618"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-1627604619"><a href="#local-1627604619"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627604620"><a href="#local-1627604620"><span class="hs-identifier">cos1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyCos"><span class="hs-identifier hs-var">tidyCos</span></a><span> </span><a href="#local-1627604577"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627604619"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-2971"></a><span>                               </span><span class="hs-keyword">in</span><span> </span><a href="#local-1627604620"><span class="hs-identifier hs-var">cos1</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#seqList"><span class="hs-identifier hs-var">seqList</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><a href="#local-1627604618"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="#local-1627604620"><span class="hs-identifier hs-var">cos1</span></a><span>
</span><a name="line-2972"></a><span>
</span><a name="line-2973"></a><span>    </span><a name="local-1627604581"><a href="#local-1627604581"><span class="hs-identifier">go_prov</span></a></a><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>
</span><a name="line-2974"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a name="local-1627604621"><a href="#local-1627604621"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604621"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2975"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><a name="local-1627604622"><a href="#local-1627604622"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627604580"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627604622"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2976"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><a name="local-1627604623"><a href="#local-1627604623"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604623"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-2977"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><a name="local-1627604624"><a href="#local-1627604624"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#HoleProv"><span class="hs-identifier hs-var">HoleProv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627604624"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-2978"></a><span>
</span><a name="line-2979"></a><span class="hs-identifier">tidyCos</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>
</span><a name="line-2980"></a><a name="tidyCos"><a href="TyCoRep.html#tidyCos"><span class="hs-identifier">tidyCos</span></a></a><span> </span><a name="local-1627604625"><a href="#local-1627604625"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a><span> </span><a href="#local-1627604625"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-2981"></a></pre></body></html>