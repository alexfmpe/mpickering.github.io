<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">BuildTyCl</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-9"></a><span>        </span><a href="BuildTyCl.html#buildDataCon"><span class="hs-identifier hs-var">buildDataCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>        </span><a href="BuildTyCl.html#buildPatSyn"><span class="hs-identifier hs-var">buildPatSyn</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>        </span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#buildClass"><span class="hs-identifier hs-var">buildClass</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>        </span><a href="BuildTyCl.html#distinctAbstractTyConRhs"><span class="hs-identifier hs-var">distinctAbstractTyConRhs</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#totallyAbstractTyConRhs"><span class="hs-identifier hs-var">totallyAbstractTyConRhs</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="BuildTyCl.html#mkNewTyConRhs"><span class="hs-identifier hs-var">mkNewTyConRhs</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#mkDataTyConRhs"><span class="hs-identifier hs-var">mkDataTyConRhs</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span>
</span><a name="line-15"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="IfaceEnv.html"><span class="hs-identifier">IfaceEnv</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span class="hs-special">(</span><span> </span><a href="FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a><span class="hs-special">,</span><span> </span><a href="FamInstEnv.html#mkNewTypeCoAxiom"><span class="hs-identifier hs-var">mkNewTypeCoAxiom</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span class="hs-special">(</span><span> </span><a href="TysWiredIn.html#isCTupleTyConName"><span class="hs-identifier hs-var">isCTupleTyConName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="PatSyn.html"><span class="hs-identifier">PatSyn</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="MkId.html"><span class="hs-identifier">MkId</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span class="hs-special">(</span><span> </span><a href="SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-identifier">distinctAbstractTyConRhs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">totallyAbstractTyConRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#AlgTyConRhs"><span class="hs-identifier hs-type">AlgTyConRhs</span></a><span>
</span><a name="line-43"></a><a name="distinctAbstractTyConRhs"><a href="BuildTyCl.html#distinctAbstractTyConRhs"><span class="hs-identifier">distinctAbstractTyConRhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#AbstractTyCon"><span class="hs-identifier hs-var">AbstractTyCon</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-44"></a><a name="totallyAbstractTyConRhs"><a href="BuildTyCl.html#totallyAbstractTyConRhs"><span class="hs-identifier">totallyAbstractTyConRhs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#AbstractTyCon"><span class="hs-identifier hs-var">AbstractTyCon</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-identifier">mkDataTyConRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#AlgTyConRhs"><span class="hs-identifier hs-type">AlgTyConRhs</span></a><span>
</span><a name="line-47"></a><a name="mkDataTyConRhs"><a href="BuildTyCl.html#mkDataTyConRhs"><span class="hs-identifier">mkDataTyConRhs</span></a></a><span> </span><a name="local-1627986391"><a href="#local-1627986391"><span class="hs-identifier">cons</span></a></a><span>
</span><a name="line-48"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#DataTyCon"><span class="hs-identifier hs-var">DataTyCon</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-49"></a><span>        </span><span class="hs-identifier">data_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627986391"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>        </span><span class="hs-identifier">is_enum</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627986391"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="#local-1627986392"><span class="hs-identifier hs-var">is_enum_con</span></a><span> </span><a href="#local-1627986391"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-51"></a><span>                  </span><span class="hs-comment">-- See Note [Enumeration types] in TyCon</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-53"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-54"></a><span>    </span><a name="local-1627986392"><a href="#local-1627986392"><span class="hs-identifier">is_enum_con</span></a></a><span> </span><a name="local-1627986393"><a href="#local-1627986393"><span class="hs-identifier">con</span></a></a><span>
</span><a name="line-55"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1627986394"><a href="#local-1627986394"><span class="hs-identifier">_univ_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986395"><a href="#local-1627986395"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986396"><a href="#local-1627986396"><span class="hs-identifier">eq_spec</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986397"><a href="#local-1627986397"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986398"><a href="#local-1627986398"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986399"><a href="#local-1627986399"><span class="hs-identifier">_res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a><span> </span><a href="#local-1627986393"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-57"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627986395"><span class="hs-identifier hs-var">ex_tvs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627986396"><span class="hs-identifier hs-var">eq_spec</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627986397"><span class="hs-identifier hs-var">theta</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627986398"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-identifier">mkNewTyConRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627986389"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627986390"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="TyCon.html#AlgTyConRhs"><span class="hs-identifier hs-type">AlgTyConRhs</span></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- ^ Monadic because it makes a Name for the coercion TyCon</span><span>
</span><a name="line-62"></a><span class="hs-comment">--   We pass the Name of the parent TyCon, as well as the TyCon itself,</span><span>
</span><a name="line-63"></a><span class="hs-comment">--   because the latter is part of a knot, whereas the former is not.</span><span>
</span><a name="line-64"></a><a name="mkNewTyConRhs"><a href="BuildTyCl.html#mkNewTyConRhs"><span class="hs-identifier">mkNewTyConRhs</span></a></a><span> </span><a name="local-1627986400"><a href="#local-1627986400"><span class="hs-identifier">tycon_name</span></a></a><span> </span><a name="local-1627986401"><a href="#local-1627986401"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-1627986402"><a href="#local-1627986402"><span class="hs-identifier">con</span></a></a><span>
</span><a name="line-65"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1627986421"><a href="#local-1627986421"><span class="hs-identifier">co_tycon_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627986400"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="OccName.html#mkNewTyCoOcc"><span class="hs-identifier hs-var">mkNewTyCoOcc</span></a><span>
</span><a name="line-66"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627986422"><a href="#local-1627986422"><span class="hs-identifier">nt_ax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FamInstEnv.html#mkNewTypeCoAxiom"><span class="hs-identifier hs-var">mkNewTypeCoAxiom</span></a><span> </span><a href="#local-1627986421"><span class="hs-identifier hs-var">co_tycon_name</span></a><span> </span><a href="#local-1627986401"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-1627986407"><span class="hs-identifier hs-var">etad_tvs</span></a><span> </span><a href="#local-1627986408"><span class="hs-identifier hs-var">etad_roles</span></a><span> </span><a href="#local-1627986409"><span class="hs-identifier hs-var">etad_rhs</span></a><span>
</span><a name="line-67"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;mkNewTyConRhs&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627986422"><span class="hs-identifier hs-var">nt_ax</span></a><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#NewTyCon"><span class="hs-identifier hs-var">NewTyCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">data_con</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627986402"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>                             </span><span class="hs-identifier">nt_rhs</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627986406"><span class="hs-identifier hs-var">rhs_ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>                             </span><span class="hs-identifier">nt_etad_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627986407"><span class="hs-identifier hs-var">etad_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627986409"><span class="hs-identifier hs-var">etad_rhs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>                             </span><span class="hs-identifier">nt_co</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627986422"><span class="hs-identifier hs-var">nt_ax</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-72"></a><span>                             </span><span class="hs-comment">-- Coreview looks through newtypes with a Nothing</span><span>
</span><a name="line-73"></a><span>                             </span><span class="hs-comment">-- for nt_co, or uses explicit coercions otherwise</span><span>
</span><a name="line-74"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-75"></a><span>    </span><a name="local-1627986403"><a href="#local-1627986403"><span class="hs-identifier">tvs</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1627986401"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-76"></a><span>    </span><a name="local-1627986404"><a href="#local-1627986404"><span class="hs-identifier">roles</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a><span> </span><a href="#local-1627986401"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-77"></a><span>    </span><a name="local-1627986405"><a href="#local-1627986405"><span class="hs-identifier">inst_con_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConUserType"><span class="hs-identifier hs-var">dataConUserType</span></a><span> </span><a href="#local-1627986402"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1627986403"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>    </span><a name="local-1627986406"><a href="#local-1627986406"><span class="hs-identifier">rhs_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isFunTy</span><span> </span><span class="hs-identifier">inst_con_ty</span><span> </span><span class="hs-special">)</span><span> </span><a href="#local-1627986405"><span class="hs-identifier hs-var">funArgTy</span></a><span> </span><span class="hs-identifier">inst_con_ty</span><span>
</span><a name="line-79"></a><span>        </span><span class="hs-comment">-- Instantiate the data con with the</span><span>
</span><a name="line-80"></a><span>        </span><span class="hs-comment">-- type variables from the tycon</span><span>
</span><a name="line-81"></a><span>        </span><span class="hs-comment">-- NB: a newtype DataCon has a type that must look like</span><span>
</span><a name="line-82"></a><span>        </span><span class="hs-comment">--        forall tvs.  &lt;arg-ty&gt; -&gt; T tvs</span><span>
</span><a name="line-83"></a><span>        </span><span class="hs-comment">-- Note that we *can't* use dataConInstOrigArgTys here because</span><span>
</span><a name="line-84"></a><span>        </span><span class="hs-comment">-- the newtype arising from   class Foo a =&gt; Bar a where {}</span><span>
</span><a name="line-85"></a><span>        </span><span class="hs-comment">-- has a single argument (Foo a) that is a *type class*, so</span><span>
</span><a name="line-86"></a><span>        </span><span class="hs-comment">-- dataConInstOrigArgTys returns [].</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>    </span><span class="hs-identifier">etad_tvs</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Matched lazily, so that mkNewTypeCo can</span><span>
</span><a name="line-89"></a><span>    </span><span class="hs-identifier">etad_roles</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- return a TyCon without pulling on rhs_ty</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-identifier">etad_rhs</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>     </span><span class="hs-comment">-- See Note [Tricky iface loop] in LoadIface</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-special">(</span><a name="local-1627986407"><a href="#local-1627986407"><span class="hs-identifier">etad_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986408"><a href="#local-1627986408"><span class="hs-identifier">etad_roles</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986409"><a href="#local-1627986409"><span class="hs-identifier">etad_rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627986410"><span class="hs-identifier hs-var">eta_reduce</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627986403"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627986404"><span class="hs-identifier hs-var">roles</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627986406"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span>    </span><span class="hs-identifier">eta_reduce</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Reversed</span><span>
</span><a name="line-94"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- also reversed</span><span>
</span><a name="line-95"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>          </span><span class="hs-comment">-- Rhs type</span><span>
</span><a name="line-96"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Eta-reduced version</span><span>
</span><a name="line-97"></a><span>                                           </span><span class="hs-comment">-- (tyvars in normal order)</span><span>
</span><a name="line-98"></a><span>    </span><a name="local-1627986410"><a href="#local-1627986410"><span class="hs-identifier">eta_reduce</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627986411"><a href="#local-1627986411"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-1627986413"><a href="#local-1627986413"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627986414"><a href="#local-1627986414"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627986415"><a href="#local-1627986415"><span class="hs-identifier">fun</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986416"><a href="#local-1627986416"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a><span> </span><a href="#local-1627986414"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>                                  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627986417"><a href="#local-1627986417"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a><span> </span><a href="#local-1627986416"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>                                  </span><a href="#local-1627986417"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627986411"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>                                  </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1627986411"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627986415"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>                                </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627986410"><span class="hs-identifier hs-var">eta_reduce</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-1627986413"><span class="hs-identifier hs-var">rs</span></a><span> </span><a href="#local-1627986415"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-103"></a><span>    </span><span class="hs-identifier">eta_reduce</span><span> </span><a name="local-1627986418"><a href="#local-1627986418"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627986419"><a href="#local-1627986419"><span class="hs-identifier">rs</span></a></a><span> </span><a name="local-1627986420"><a href="#local-1627986420"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627986418"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627986419"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627986420"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-comment">------------------------------------------------------</span><span>
</span><a name="line-106"></a><span class="hs-identifier">buildDataCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a><span>
</span><a name="line-107"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-108"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>                     </span><span class="hs-comment">-- Declared infix</span><span>
</span><a name="line-109"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyConRepName"><span class="hs-identifier hs-type">TyConRepName</span></a><span>
</span><a name="line-110"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a><span class="hs-special">]</span><span>
</span><a name="line-111"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">[</span><a href="DataCon.html#HsImplBang"><span class="hs-identifier hs-type">HsImplBang</span></a><span class="hs-special">]</span><span>
</span><a name="line-112"></a><span>                </span><span class="hs-comment">-- See Note [Bangs on imported data constructors] in MkId</span><span>
</span><a name="line-113"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- Field labels</span><span>
</span><a name="line-114"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Univ and ext</span><span>
</span><a name="line-115"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DataCon.html#EqSpec"><span class="hs-identifier hs-type">EqSpec</span></a><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- Equality spec</span><span>
</span><a name="line-116"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>                </span><span class="hs-comment">-- Does not include the &quot;stupid theta&quot;</span><span>
</span><a name="line-117"></a><span>                                       </span><span class="hs-comment">-- or the GADT equalities</span><span>
</span><a name="line-118"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>           </span><span class="hs-comment">-- Argument and result types</span><span>
</span><a name="line-119"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>                    </span><span class="hs-comment">-- Rep tycon</span><span>
</span><a name="line-120"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627986387"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627986388"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>
</span><a name="line-121"></a><span class="hs-comment">-- A wrapper for DataCon.mkDataCon that</span><span>
</span><a name="line-122"></a><span class="hs-comment">--   a) makes the worker Id</span><span>
</span><a name="line-123"></a><span class="hs-comment">--   b) makes the wrapper Id if necessary, including</span><span>
</span><a name="line-124"></a><span class="hs-comment">--      allocating its unique (hence monadic)</span><span>
</span><a name="line-125"></a><a name="buildDataCon"><a href="BuildTyCl.html#buildDataCon"><span class="hs-identifier">buildDataCon</span></a></a><span> </span><a name="local-1627986423"><a href="#local-1627986423"><span class="hs-identifier">fam_envs</span></a></a><span> </span><a name="local-1627986424"><a href="#local-1627986424"><span class="hs-identifier">src_name</span></a></a><span> </span><a name="local-1627986425"><a href="#local-1627986425"><span class="hs-identifier">declared_infix</span></a></a><span> </span><a name="local-1627986426"><a href="#local-1627986426"><span class="hs-identifier">prom_info</span></a></a><span> </span><a name="local-1627986427"><a href="#local-1627986427"><span class="hs-identifier">src_bangs</span></a></a><span> </span><a name="local-1627986428"><a href="#local-1627986428"><span class="hs-identifier">impl_bangs</span></a></a><span> </span><a name="local-1627986429"><a href="#local-1627986429"><span class="hs-identifier">field_lbls</span></a></a><span>
</span><a name="line-126"></a><span>             </span><a name="local-1627986430"><a href="#local-1627986430"><span class="hs-identifier">univ_tvs</span></a></a><span> </span><a name="local-1627986431"><a href="#local-1627986431"><span class="hs-identifier">ex_tvs</span></a></a><span> </span><a name="local-1627986432"><a href="#local-1627986432"><span class="hs-identifier">eq_spec</span></a></a><span> </span><a name="local-1627986433"><a href="#local-1627986433"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-1627986434"><a href="#local-1627986434"><span class="hs-identifier">arg_tys</span></a></a><span> </span><a name="local-1627986435"><a href="#local-1627986435"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-1627986436"><a href="#local-1627986436"><span class="hs-identifier">rep_tycon</span></a></a><span>
</span><a name="line-127"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1627986437"><a href="#local-1627986437"><span class="hs-identifier">wrap_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627986424"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="OccName.html#mkDataConWrapperOcc"><span class="hs-identifier hs-var">mkDataConWrapperOcc</span></a><span>
</span><a name="line-128"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627986438"><a href="#local-1627986438"><span class="hs-identifier">work_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627986424"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="OccName.html#mkDataConWorkerOcc"><span class="hs-identifier hs-var">mkDataConWorkerOcc</span></a><span>
</span><a name="line-129"></a><span>        </span><span class="hs-comment">-- This last one takes the name of the data constructor in the source</span><span>
</span><a name="line-130"></a><span>        </span><span class="hs-comment">-- code, which (for Haskell source anyway) will be in the DataName name</span><span>
</span><a name="line-131"></a><span>        </span><span class="hs-comment">-- space, and puts it into the VarName name space</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildDataCon 1&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627986424"><span class="hs-identifier hs-var">src_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627986439"><a href="#local-1627986439"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a><span>
</span><a name="line-135"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627986440"><a href="#local-1627986440"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-136"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><a name="line-137"></a><span>                </span><a name="local-1627986441"><a href="#local-1627986441"><span class="hs-identifier">stupid_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BuildTyCl.html#mkDataConStupidTheta"><span class="hs-identifier hs-var">mkDataConStupidTheta</span></a><span> </span><a href="#local-1627986436"><span class="hs-identifier hs-var">rep_tycon</span></a><span> </span><a href="#local-1627986434"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-1627986430"><span class="hs-identifier hs-var">univ_tvs</span></a><span>
</span><a name="line-138"></a><span>                </span><a name="local-1627986442"><a href="#local-1627986442"><span class="hs-identifier">data_con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#mkDataCon"><span class="hs-identifier hs-var">mkDataCon</span></a><span> </span><a href="#local-1627986424"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="#local-1627986425"><span class="hs-identifier hs-var">declared_infix</span></a><span> </span><a href="#local-1627986426"><span class="hs-identifier hs-var">prom_info</span></a><span>
</span><a name="line-139"></a><span>                                     </span><a href="#local-1627986427"><span class="hs-identifier hs-var">src_bangs</span></a><span> </span><a href="#local-1627986429"><span class="hs-identifier hs-var">field_lbls</span></a><span>
</span><a name="line-140"></a><span>                                     </span><a href="#local-1627986430"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><a href="#local-1627986431"><span class="hs-identifier hs-var">ex_tvs</span></a><span> </span><a href="#local-1627986432"><span class="hs-identifier hs-var">eq_spec</span></a><span> </span><a href="#local-1627986433"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-141"></a><span>                                     </span><a href="#local-1627986434"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-1627986435"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="TyCon.html#NoRRI"><span class="hs-identifier hs-var">NoRRI</span></a><span> </span><a href="#local-1627986436"><span class="hs-identifier hs-var">rep_tycon</span></a><span>
</span><a name="line-142"></a><span>                                     </span><a href="#local-1627986441"><span class="hs-identifier hs-var">stupid_ctxt</span></a><span> </span><a href="#local-1627986443"><span class="hs-identifier hs-var">dc_wrk</span></a><span> </span><a href="#local-1627986444"><span class="hs-identifier hs-var">dc_rep</span></a><span>
</span><a name="line-143"></a><span>                </span><a name="local-1627986443"><a href="#local-1627986443"><span class="hs-identifier">dc_wrk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkId.html#mkDataConWorkId"><span class="hs-identifier hs-var">mkDataConWorkId</span></a><span> </span><a href="#local-1627986438"><span class="hs-identifier hs-var">work_name</span></a><span> </span><a href="#local-1627986442"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-144"></a><span>                </span><a name="local-1627986444"><a href="#local-1627986444"><span class="hs-identifier">dc_rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#initUs_"><span class="hs-identifier hs-var">initUs_</span></a><span> </span><a href="#local-1627986439"><span class="hs-identifier hs-var">us</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkDataConRep"><span class="hs-identifier hs-var">mkDataConRep</span></a><span> </span><a href="#local-1627986440"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1627986423"><span class="hs-identifier hs-var">fam_envs</span></a><span> </span><a href="#local-1627986437"><span class="hs-identifier hs-var">wrap_name</span></a><span>
</span><a name="line-145"></a><span>                                                  </span><a href="#local-1627986428"><span class="hs-identifier hs-var">impl_bangs</span></a><span> </span><a href="#local-1627986442"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildDataCon 2&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627986424"><span class="hs-identifier hs-var">src_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627986442"><span class="hs-identifier hs-var">data_con</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-comment">-- The stupid context for a data constructor should be limited to</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- the type variables mentioned in the arg_tys</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- ToDo: Or functionally dependent on?</span><span>
</span><a name="line-154"></a><span class="hs-comment">--       This whole stupid theta thing is, well, stupid.</span><span>
</span><a name="line-155"></a><span class="hs-identifier">mkDataConStupidTheta</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span>
</span><a name="line-156"></a><a name="mkDataConStupidTheta"><a href="BuildTyCl.html#mkDataConStupidTheta"><span class="hs-identifier">mkDataConStupidTheta</span></a></a><span> </span><a name="local-1627986445"><a href="#local-1627986445"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-1627986446"><a href="#local-1627986446"><span class="hs-identifier">arg_tys</span></a></a><span> </span><a name="local-1627986447"><a href="#local-1627986447"><span class="hs-identifier">univ_tvs</span></a></a><span>
</span><a name="line-157"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1627986449"><span class="hs-identifier hs-var">stupid_theta</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- The common case</span><span>
</span><a name="line-158"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-1627986451"><span class="hs-identifier hs-var">in_arg_tys</span></a><span> </span><a href="#local-1627986449"><span class="hs-identifier hs-var">stupid_theta</span></a><span>
</span><a name="line-159"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-160"></a><span>    </span><a name="local-1627986448"><a href="#local-1627986448"><span class="hs-identifier">tc_subst</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1627986445"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1627986447"><span class="hs-identifier hs-var">univ_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span>    </span><a name="local-1627986449"><a href="#local-1627986449"><span class="hs-identifier">stupid_theta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a><span> </span><a href="#local-1627986448"><span class="hs-identifier hs-var">tc_subst</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a><span> </span><a href="#local-1627986445"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span>        </span><span class="hs-comment">-- Start by instantiating the master copy of the</span><span>
</span><a name="line-163"></a><span>        </span><span class="hs-comment">-- stupid theta, taken from the TyCon</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span>    </span><a name="local-1627986450"><a href="#local-1627986450"><span class="hs-identifier">arg_tyvars</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1627986446"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-166"></a><span>    </span><a name="local-1627986451"><a href="#local-1627986451"><span class="hs-identifier">in_arg_tys</span></a></a><span> </span><a name="local-1627986452"><a href="#local-1627986452"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarSet.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-167"></a><span>                      </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627986452"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#intersectVarSet"><span class="hs-identifier hs-var">intersectVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627986450"><span class="hs-identifier hs-var">arg_tyvars</span></a><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-comment">------------------------------------------------------</span><span>
</span><a name="line-171"></a><span class="hs-identifier">buildPatSyn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-172"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Univ and req</span><span>
</span><a name="line-174"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Ex and prov</span><span>
</span><a name="line-175"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- ^ Argument types</span><span>
</span><a name="line-176"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>                 </span><span class="hs-comment">-- ^ Result type</span><span>
</span><a name="line-177"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- ^ Field labels for</span><span>
</span><a name="line-178"></a><span>                                    </span><span class="hs-comment">--   a record pattern synonym</span><span>
</span><a name="line-179"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a><span>
</span><a name="line-180"></a><a name="buildPatSyn"><a href="BuildTyCl.html#buildPatSyn"><span class="hs-identifier">buildPatSyn</span></a></a><span> </span><a name="local-1627986453"><a href="#local-1627986453"><span class="hs-identifier">src_name</span></a></a><span> </span><a name="local-1627986454"><a href="#local-1627986454"><span class="hs-identifier">declared_infix</span></a></a><span> </span><a name="local-1627986455"><a href="#local-1627986455"><span class="hs-identifier">matcher</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627986456"><a href="#local-1627986456"><span class="hs-identifier">matcher_id</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1627986457"><a href="#local-1627986457"><span class="hs-identifier">builder</span></a></a><span>
</span><a name="line-181"></a><span>            </span><span class="hs-special">(</span><a name="local-1627986458"><a href="#local-1627986458"><span class="hs-identifier">univ_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986459"><a href="#local-1627986459"><span class="hs-identifier">req_theta</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627986460"><a href="#local-1627986460"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986461"><a href="#local-1627986461"><span class="hs-identifier">prov_theta</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627986462"><a href="#local-1627986462"><span class="hs-identifier">arg_tys</span></a></a><span>
</span><a name="line-182"></a><span>            </span><a name="local-1627986463"><a href="#local-1627986463"><span class="hs-identifier">pat_ty</span></a></a><span> </span><a name="local-1627986464"><a href="#local-1627986464"><span class="hs-identifier">field_labels</span></a></a><span>
</span><a name="line-183"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- The assertion checks that the matcher is</span><span>
</span><a name="line-184"></a><span>    </span><span class="hs-comment">-- compatible with the pattern synonym</span><span>
</span><a name="line-185"></a><span>    </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">and</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">univ_tvs</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">univ_tvs1</span></a><span>
</span><a name="line-186"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ex_tvs</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">ex_tvs1</span><span>
</span><a name="line-187"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_ty</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">substTy</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">pat_ty1</span><span>
</span><a name="line-188"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">prov_theta</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqTypes</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">substTys</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">prov_theta1</span><span>
</span><a name="line-189"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">req_theta</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqTypes</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">substTys</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">req_theta1</span><span>
</span><a name="line-190"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">arg_tys</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqTypes</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">substTys</span><span> </span><span class="hs-identifier">subst</span><span> </span><span class="hs-identifier">arg_tys1</span><span>
</span><a name="line-191"></a><span>                 </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-192"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">univ_tvs</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">univ_tvs1</span><span>
</span><a name="line-193"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ex_tvs</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ex_tvs1</span><span>
</span><a name="line-194"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">pat_ty</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">pat_ty1</span><span>
</span><a name="line-195"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">prov_theta</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">prov_theta1</span><span>
</span><a name="line-196"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">req_theta</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">req_theta1</span><span>
</span><a name="line-197"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">arg_tys</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">twiddle</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">arg_tys1</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span>    </span><a href="PatSyn.html#mkPatSyn"><span class="hs-identifier hs-var">mkPatSyn</span></a><span> </span><a href="#local-1627986453"><span class="hs-identifier hs-var">src_name</span></a><span> </span><a href="#local-1627986454"><span class="hs-identifier hs-var">declared_infix</span></a><span>
</span><a name="line-199"></a><span>             </span><span class="hs-special">(</span><a href="#local-1627986458"><span class="hs-identifier hs-var">univ_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627986459"><span class="hs-identifier hs-var">req_theta</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627986460"><span class="hs-identifier hs-var">ex_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627986461"><span class="hs-identifier hs-var">prov_theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>             </span><a href="#local-1627986462"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-1627986463"><span class="hs-identifier hs-var">pat_ty</span></a><span>
</span><a name="line-201"></a><span>             </span><a href="#local-1627986455"><span class="hs-identifier hs-var">matcher</span></a><span> </span><a href="#local-1627986457"><span class="hs-identifier hs-var">builder</span></a><span> </span><a href="#local-1627986464"><span class="hs-identifier hs-var">field_labels</span></a><span>
</span><a name="line-202"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-203"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-1627986465"><a href="#local-1627986465"><span class="hs-identifier">univ_tvs1</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1627986466"><a href="#local-1627986466"><span class="hs-identifier">req_theta1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986467"><a href="#local-1627986467"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1627986456"><span class="hs-identifier hs-var">matcher_id</span></a><span>
</span><a name="line-204"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><a name="local-1627986468"><a href="#local-1627986468"><span class="hs-identifier">pat_ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986469"><a href="#local-1627986469"><span class="hs-identifier">cont_sigma</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a><span> </span><a href="#local-1627986467"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-205"></a><span>    </span><span class="hs-special">(</span><a name="local-1627986470"><a href="#local-1627986470"><span class="hs-identifier">ex_tvs1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986471"><a href="#local-1627986471"><span class="hs-identifier">prov_theta1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986472"><a href="#local-1627986472"><span class="hs-identifier">cont_tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a><span> </span><a href="#local-1627986469"><span class="hs-identifier hs-var">cont_sigma</span></a><span>
</span><a name="line-206"></a><span>    </span><span class="hs-special">(</span><a name="local-1627986473"><a href="#local-1627986473"><span class="hs-identifier">arg_tys1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a><span> </span><a href="#local-1627986472"><span class="hs-identifier hs-var">cont_tau</span></a><span>
</span><a name="line-207"></a><span>    </span><a name="local-1627986474"><a href="#local-1627986474"><span class="hs-identifier">twiddle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'~'</span><span>
</span><a name="line-208"></a><span>    </span><a name="local-1627986475"><a href="#local-1627986475"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627986465"><span class="hs-identifier hs-var">univ_tvs1</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627986470"><span class="hs-identifier hs-var">ex_tvs1</span></a><span class="hs-special">)</span><span>
</span><a name="line-209"></a><span>                       </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627986458"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627986460"><span class="hs-identifier hs-var">ex_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-comment">------------------------------------------------------</span><span>
</span><a name="line-212"></a><span class="hs-keyword">type</span><span> </span><a name="TcMethInfo"><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier">TcMethInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#DefMethSpec"><span class="hs-identifier hs-type">DefMethSpec</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>        </span><span class="hs-comment">-- A temporary intermediate, to communicate between</span><span>
</span><a name="line-214"></a><span>        </span><span class="hs-comment">-- tcClassSigs and buildClass.</span><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span class="hs-identifier">buildClass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>  </span><span class="hs-comment">-- Name of the class/tycon (they have the same Name)</span><span>
</span><a name="line-217"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>
</span><a name="line-218"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>
</span><a name="line-219"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Functional dependencies</span><span>
</span><a name="line-220"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Class.html#ClassATItem"><span class="hs-identifier hs-type">ClassATItem</span></a><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- Associated types</span><span>
</span><a name="line-221"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- Method info</span><span>
</span><a name="line-222"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#ClassMinimalDef"><span class="hs-identifier hs-type">ClassMinimalDef</span></a><span>              </span><span class="hs-comment">-- Minimal complete definition</span><span>
</span><a name="line-223"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a><span>                      </span><span class="hs-comment">-- Info for type constructor</span><span>
</span><a name="line-224"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627986385"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627986386"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><a name="buildClass"><a href="BuildTyCl.html#buildClass"><span class="hs-identifier">buildClass</span></a></a><span> </span><a name="local-1627986476"><a href="#local-1627986476"><span class="hs-identifier">tycon_name</span></a></a><span> </span><a name="local-1627986477"><a href="#local-1627986477"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627986478"><a href="#local-1627986478"><span class="hs-identifier">roles</span></a></a><span> </span><a name="local-1627986479"><a href="#local-1627986479"><span class="hs-identifier">sc_theta</span></a></a><span> </span><a name="local-1627986480"><a href="#local-1627986480"><span class="hs-identifier">binders</span></a></a><span>
</span><a name="line-227"></a><span>           </span><a name="local-1627986481"><a href="#local-1627986481"><span class="hs-identifier">fds</span></a></a><span> </span><a name="local-1627986482"><a href="#local-1627986482"><span class="hs-identifier">at_items</span></a></a><span> </span><a name="local-1627986483"><a href="#local-1627986483"><span class="hs-identifier">sig_stuff</span></a></a><span> </span><a name="local-1627986484"><a href="#local-1627986484"><span class="hs-identifier">mindef</span></a></a><span> </span><a name="local-1627986485"><a href="#local-1627986485"><span class="hs-identifier">tc_isrec</span></a></a><span>
</span><a name="line-228"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-1627986496"><a href="#local-1627986496"><span class="hs-identifier">rec_clas</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>       </span><span class="hs-comment">-- Only name generation inside loop</span><span>
</span><a name="line-229"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildClass&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627986497"><a href="#local-1627986497"><span class="hs-identifier">datacon_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627986476"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="OccName.html#mkClassDataConOcc"><span class="hs-identifier hs-var">mkClassDataConOcc</span></a><span>
</span><a name="line-232"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627986498"><a href="#local-1627986498"><span class="hs-identifier">tc_rep_name</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span> </span><a href="#local-1627986476"><span class="hs-identifier hs-var">tycon_name</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627986499"><a href="#local-1627986499"><span class="hs-identifier">op_items</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627986487"><span class="hs-identifier hs-var">mk_op_item</span></a><span> </span><a href="#local-1627986496"><span class="hs-identifier hs-var">rec_clas</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627986483"><span class="hs-identifier hs-var">sig_stuff</span></a><span>
</span><a name="line-235"></a><span>                        </span><span class="hs-comment">-- Build the selector id and default method id</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span>              </span><span class="hs-comment">-- Make selectors for the superclasses</span><span>
</span><a name="line-238"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627986500"><a href="#local-1627986500"><span class="hs-identifier">sc_sel_names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span>  </span><span class="hs-special">(</span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627986476"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="OccName.html#mkSuperDictSelOcc"><span class="hs-identifier hs-var">mkSuperDictSelOcc</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>                                </span><span class="hs-special">(</span><a href="Util.html#takeList"><span class="hs-identifier hs-var">takeList</span></a><span> </span><a href="#local-1627986479"><span class="hs-identifier hs-var">sc_theta</span></a><span> </span><span class="hs-special">[</span><a href="BasicTypes.html#fIRST_TAG"><span class="hs-identifier hs-var">fIRST_TAG</span></a><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627986501"><a href="#local-1627986501"><span class="hs-identifier">sc_sel_ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="MkId.html#mkDictSelId"><span class="hs-identifier hs-var">mkDictSelId</span></a><span> </span><a href="#local-1627986502"><span class="hs-identifier hs-var">sc_name</span></a><span> </span><a href="#local-1627986496"><span class="hs-identifier hs-var">rec_clas</span></a><span>
</span><a name="line-241"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><a name="local-1627986502"><a href="#local-1627986502"><span class="hs-identifier">sc_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627986500"><span class="hs-identifier hs-var">sc_sel_names</span></a><span class="hs-special">]</span><span>
</span><a name="line-242"></a><span>              </span><span class="hs-comment">-- We number off the Dict superclass selectors, 1, 2, 3 etc so that we</span><span>
</span><a name="line-243"></a><span>              </span><span class="hs-comment">-- can construct names for the selectors. Thus</span><span>
</span><a name="line-244"></a><span>              </span><span class="hs-comment">--      class (C a, C b) =&gt; D a b where ...</span><span>
</span><a name="line-245"></a><span>              </span><span class="hs-comment">-- gives superclass selectors</span><span>
</span><a name="line-246"></a><span>              </span><span class="hs-comment">--      D_sc1, D_sc2</span><span>
</span><a name="line-247"></a><span>              </span><span class="hs-comment">-- (We used to call them D_C, but now we can have two different</span><span>
</span><a name="line-248"></a><span>              </span><span class="hs-comment">--  superclasses both called C!)</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627986503"><a href="#local-1627986503"><span class="hs-identifier">use_newtype</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a><span> </span><a href="#local-1627986507"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-251"></a><span>                </span><span class="hs-comment">-- Use a newtype if the data constructor</span><span>
</span><a name="line-252"></a><span>                </span><span class="hs-comment">--   (a) has exactly one value field</span><span>
</span><a name="line-253"></a><span>                </span><span class="hs-comment">--       i.e. exactly one operation or superclass taken together</span><span>
</span><a name="line-254"></a><span>                </span><span class="hs-comment">--   (b) that value is of lifted type (which they always are, because</span><span>
</span><a name="line-255"></a><span>                </span><span class="hs-comment">--       we box equality superclasses)</span><span>
</span><a name="line-256"></a><span>                </span><span class="hs-comment">-- See note [Class newtypes and equality predicates]</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span>                </span><span class="hs-comment">-- We treat the dictionary superclasses as ordinary arguments.</span><span>
</span><a name="line-259"></a><span>                </span><span class="hs-comment">-- That means that in the case of</span><span>
</span><a name="line-260"></a><span>                </span><span class="hs-comment">--     class C a =&gt; D a</span><span>
</span><a name="line-261"></a><span>                </span><span class="hs-comment">-- we don't get a newtype with no arguments!</span><span>
</span><a name="line-262"></a><span>              </span><a name="local-1627986504"><a href="#local-1627986504"><span class="hs-identifier">args</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627986500"><span class="hs-identifier hs-var">sc_sel_names</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627986506"><span class="hs-identifier hs-var">op_names</span></a><span>
</span><a name="line-263"></a><span>              </span><a name="local-1627986505"><a href="#local-1627986505"><span class="hs-identifier">op_tys</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1627986509"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-1627986509"><a href="#local-1627986509"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627986483"><span class="hs-identifier hs-var">sig_stuff</span></a><span class="hs-special">]</span><span>
</span><a name="line-264"></a><span>              </span><a name="local-1627986506"><a href="#local-1627986506"><span class="hs-identifier">op_names</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-1627986510"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1627986510"><a href="#local-1627986510"><span class="hs-identifier">op</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627986483"><span class="hs-identifier hs-var">sig_stuff</span></a><span class="hs-special">]</span><span>
</span><a name="line-265"></a><span>              </span><a name="local-1627986507"><a href="#local-1627986507"><span class="hs-identifier">arg_tys</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627986479"><span class="hs-identifier hs-var">sc_theta</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627986505"><span class="hs-identifier hs-var">op_tys</span></a><span>
</span><a name="line-266"></a><span>              </span><a name="local-1627986508"><a href="#local-1627986508"><span class="hs-identifier">rec_tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-1627986496"><span class="hs-identifier hs-var">rec_clas</span></a><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627986511"><a href="#local-1627986511"><span class="hs-identifier">rep_nm</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span> </span><a href="#local-1627986497"><span class="hs-identifier hs-var">datacon_name</span></a><span>
</span><a name="line-269"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627986512"><a href="#local-1627986512"><span class="hs-identifier">dict_con</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#buildDataCon"><span class="hs-identifier hs-var">buildDataCon</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;buildClass: FamInstEnvs&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>                                   </span><a href="#local-1627986497"><span class="hs-identifier hs-var">datacon_name</span></a><span>
</span><a name="line-271"></a><span>                                   </span><span class="hs-identifier hs-var">False</span><span>        </span><span class="hs-comment">-- Not declared infix</span><span>
</span><a name="line-272"></a><span>                                   </span><a href="#local-1627986511"><span class="hs-identifier hs-var">rep_nm</span></a><span>
</span><a name="line-273"></a><span>                                   </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="#local-1627986486"><span class="hs-identifier hs-var">no_bang</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627986504"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>                                   </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="DataCon.html#HsLazy"><span class="hs-identifier hs-var">HsLazy</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627986504"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-275"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- No fields -}</span><span class="hs-special">]</span><span>
</span><a name="line-276"></a><span>                                   </span><a href="#local-1627986477"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">[</span><span class="hs-comment">{- no existentials -}</span><span class="hs-special">]</span><span>
</span><a name="line-277"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- No GADT equalities -}</span><span class="hs-special">]</span><span>
</span><a name="line-278"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-comment">{- No theta -}</span><span class="hs-special">]</span><span>
</span><a name="line-279"></a><span>                                   </span><a href="#local-1627986507"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-280"></a><span>                                   </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-1627986508"><span class="hs-identifier hs-var">rec_tycon</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><a href="#local-1627986477"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span>                                   </span><a href="#local-1627986508"><span class="hs-identifier hs-var">rec_tycon</span></a><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627986513"><a href="#local-1627986513"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627986503"><span class="hs-identifier hs-var">use_newtype</span></a><span>
</span><a name="line-284"></a><span>                 </span><span class="hs-keyword">then</span><span> </span><a href="BuildTyCl.html#mkNewTyConRhs"><span class="hs-identifier hs-var">mkNewTyConRhs</span></a><span> </span><a href="#local-1627986476"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="#local-1627986508"><span class="hs-identifier hs-var">rec_tycon</span></a><span> </span><a href="#local-1627986512"><span class="hs-identifier hs-var">dict_con</span></a><span>
</span><a name="line-285"></a><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="TysWiredIn.html#isCTupleTyConName"><span class="hs-identifier hs-var">isCTupleTyConName</span></a><span> </span><a href="#local-1627986476"><span class="hs-identifier hs-var">tycon_name</span></a><span>
</span><a name="line-286"></a><span>                 </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#TupleTyCon"><span class="hs-identifier hs-var">TupleTyCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">data_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627986512"><span class="hs-identifier hs-var">dict_con</span></a><span>
</span><a name="line-287"></a><span>                                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tup_sort</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-288"></a><span>                 </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="BuildTyCl.html#mkDataTyConRhs"><span class="hs-identifier hs-var">mkDataTyConRhs</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627986512"><span class="hs-identifier hs-var">dict_con</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627986514"><a href="#local-1627986514"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#mkClassTyCon"><span class="hs-identifier hs-var">mkClassTyCon</span></a><span> </span><a href="#local-1627986476"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="#local-1627986480"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-1627986477"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627986478"><span class="hs-identifier hs-var">roles</span></a><span>
</span><a name="line-291"></a><span>                                     </span><a href="#local-1627986513"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="#local-1627986496"><span class="hs-identifier hs-var">rec_clas</span></a><span> </span><a href="#local-1627986485"><span class="hs-identifier hs-var">tc_isrec</span></a><span> </span><a href="#local-1627986498"><span class="hs-identifier hs-var">tc_rep_name</span></a><span>
</span><a name="line-292"></a><span>                </span><span class="hs-comment">-- A class can be recursive, and in the case of newtypes</span><span>
</span><a name="line-293"></a><span>                </span><span class="hs-comment">-- this matters.  For example</span><span>
</span><a name="line-294"></a><span>                </span><span class="hs-comment">--      class C a where { op :: C b =&gt; a -&gt; b -&gt; Int }</span><span>
</span><a name="line-295"></a><span>                </span><span class="hs-comment">-- Because C has only one operation, it is represented by</span><span>
</span><a name="line-296"></a><span>                </span><span class="hs-comment">-- a newtype, and it should be a *recursive* newtype.</span><span>
</span><a name="line-297"></a><span>                </span><span class="hs-comment">-- [If we don't make it a recursive newtype, we'll expand the</span><span>
</span><a name="line-298"></a><span>                </span><span class="hs-comment">-- newtype like a synonym, but that will lead to an infinite</span><span>
</span><a name="line-299"></a><span>                </span><span class="hs-comment">-- type]</span><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span>              </span><span class="hs-special">;</span><span> </span><a name="local-1627986515"><a href="#local-1627986515"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Class.html#mkClass"><span class="hs-identifier hs-var">mkClass</span></a><span> </span><a href="#local-1627986477"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-1627986481"><span class="hs-identifier hs-var">fds</span></a><span>
</span><a name="line-302"></a><span>                                 </span><a href="#local-1627986479"><span class="hs-identifier hs-var">sc_theta</span></a><span> </span><a href="#local-1627986501"><span class="hs-identifier hs-var">sc_sel_ids</span></a><span> </span><a href="#local-1627986482"><span class="hs-identifier hs-var">at_items</span></a><span>
</span><a name="line-303"></a><span>                                 </span><a href="#local-1627986499"><span class="hs-identifier hs-var">op_items</span></a><span> </span><a href="#local-1627986484"><span class="hs-identifier hs-var">mindef</span></a><span> </span><a href="#local-1627986514"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-304"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-305"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;buildClass&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627986514"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627986515"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-307"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-308"></a><span>    </span><a name="local-1627986486"><a href="#local-1627986486"><span class="hs-identifier">no_bang</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-var">HsSrcBang</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="DataCon.html#NoSrcUnpack"><span class="hs-identifier hs-var">NoSrcUnpack</span></a><span> </span><a href="DataCon.html#NoSrcStrict"><span class="hs-identifier hs-var">NoSrcStrict</span></a><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span>    </span><span class="hs-identifier">mk_op_item</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627986488"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-1627986489"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Class.html#ClassOpItem"><span class="hs-identifier hs-type">ClassOpItem</span></a><span>
</span><a name="line-311"></a><span>    </span><a name="local-1627986487"><a href="#local-1627986487"><span class="hs-identifier">mk_op_item</span></a></a><span> </span><a name="local-1627986490"><a href="#local-1627986490"><span class="hs-identifier">rec_clas</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627986491"><a href="#local-1627986491"><span class="hs-identifier">op_name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627986492"><a href="#local-1627986492"><span class="hs-identifier">dm_spec</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627986495"><a href="#local-1627986495"><span class="hs-identifier">dm_info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627986492"><span class="hs-identifier hs-var">dm_spec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-313"></a><span>                          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-314"></a><span>                          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627986493"><a href="#local-1627986493"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627986494"><a href="#local-1627986494"><span class="hs-identifier">dm_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627986491"><span class="hs-identifier hs-var">op_name</span></a><span> </span><a href="OccName.html#mkDefaultMethodOcc"><span class="hs-identifier hs-var">mkDefaultMethodOcc</span></a><span>
</span><a name="line-315"></a><span>                                          </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627986494"><span class="hs-identifier hs-var">dm_name</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627986493"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-316"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkDictSelId"><span class="hs-identifier hs-var">mkDictSelId</span></a><span> </span><a href="#local-1627986491"><span class="hs-identifier hs-var">op_name</span></a><span> </span><a href="#local-1627986490"><span class="hs-identifier hs-var">rec_clas</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627986495"><span class="hs-identifier hs-var">dm_info</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-comment">{-
Note [Class newtypes and equality predicates]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
        class (a ~ F b) =&gt; C a b where
          op :: a -&gt; b

We cannot represent this by a newtype, even though it's not
existential, because there are two value fields (the equality
predicate and op. See Trac #2238

Moreover,
          class (a ~ F b) =&gt; C a b where {}
Here we can't use a newtype either, even though there is only
one field, because equality predicates are unboxed, and classes
are boxed.
-}</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-identifier">newImplicitBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>                       </span><span class="hs-comment">-- Base name</span><span>
</span><a name="line-337"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Occurrence name modifier</span><span>
</span><a name="line-338"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627986383"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627986384"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>            </span><span class="hs-comment">-- Implicit name</span><span>
</span><a name="line-339"></a><span class="hs-comment">-- Called in BuildTyCl to allocate the implicit binders of type/class decls</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- For source type/class decls, this is the first occurrence</span><span>
</span><a name="line-341"></a><span class="hs-comment">-- For iface ones, the LoadIface has alrady allocated a suitable name in the cache</span><span>
</span><a name="line-342"></a><a name="newImplicitBinder"><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier">newImplicitBinder</span></a></a><span> </span><a name="local-1627986516"><a href="#local-1627986516"><span class="hs-identifier">base_name</span></a></a><span> </span><a name="local-1627986517"><a href="#local-1627986517"><span class="hs-identifier">mk_sys_occ</span></a></a><span>
</span><a name="line-343"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627986520"><a href="#local-1627986520"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-1627986516"><span class="hs-identifier hs-var">base_name</span></a><span>
</span><a name="line-344"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceEnv.html#newGlobalBinder"><span class="hs-identifier hs-var">newGlobalBinder</span></a><span> </span><a href="#local-1627986520"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-1627986518"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-1627986519"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-345"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>           </span><span class="hs-comment">-- When typechecking a [d| decl bracket |],</span><span>
</span><a name="line-346"></a><span>                        </span><span class="hs-comment">-- TH generates types, classes etc with Internal names,</span><span>
</span><a name="line-347"></a><span>                        </span><span class="hs-comment">-- so we follow suit for the implicit binders</span><span>
</span><a name="line-348"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-1627986521"><a href="#local-1627986521"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-349"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a><span> </span><a href="#local-1627986521"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-1627986518"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-1627986519"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-350"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-351"></a><span>    </span><a name="local-1627986518"><a href="#local-1627986518"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627986517"><span class="hs-identifier hs-var">mk_sys_occ</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1627986516"><span class="hs-identifier hs-var">base_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-352"></a><span>    </span><a name="local-1627986519"><a href="#local-1627986519"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a><span> </span><a href="#local-1627986516"><span class="hs-identifier hs-var">base_name</span></a><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">-- | Make the 'TyConRepName' for this 'TyCon'</span><span>
</span><a name="line-355"></a><span class="hs-identifier">newTyConRepName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-1627986381"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-1627986382"><span class="hs-identifier hs-type">lcl</span></a><span> </span><a href="TyCon.html#TyConRepName"><span class="hs-identifier hs-type">TyConRepName</span></a><span>
</span><a name="line-356"></a><a name="newTyConRepName"><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier">newTyConRepName</span></a></a><span> </span><a name="local-1627986522"><a href="#local-1627986522"><span class="hs-identifier">tc_name</span></a></a><span>
</span><a name="line-357"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627986523"><a href="#local-1627986523"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-1627986522"><span class="hs-identifier hs-var">tc_name</span></a><span>
</span><a name="line-358"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-1627986524"><a href="#local-1627986524"><span class="hs-identifier">mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627986525"><a href="#local-1627986525"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConRepModOcc"><span class="hs-identifier hs-var">tyConRepModOcc</span></a><span> </span><a href="#local-1627986523"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1627986522"><span class="hs-identifier hs-var">tc_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceEnv.html#newGlobalBinder"><span class="hs-identifier hs-var">newGlobalBinder</span></a><span> </span><a href="#local-1627986524"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-1627986525"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a><span>
</span><a name="line-360"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-361"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="BuildTyCl.html#newImplicitBinder"><span class="hs-identifier hs-var">newImplicitBinder</span></a><span> </span><a href="#local-1627986522"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><a href="OccName.html#mkTyConRepOcc"><span class="hs-identifier hs-var">mkTyConRepOcc</span></a><span>
</span><a name="line-362"></a></pre></body></html>