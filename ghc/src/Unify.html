<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- (c) The University of Glasgow 2006</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unify</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-8"></a><span>        </span><a href="Unify.html#tcMatchTy"><span class="hs-identifier hs-var">tcMatchTy</span></a><span class="hs-special">,</span><span> </span><a href="Unify.html#tcMatchTys"><span class="hs-identifier hs-var">tcMatchTys</span></a><span class="hs-special">,</span><span> </span><a href="Unify.html#tcMatchTyX"><span class="hs-identifier hs-var">tcMatchTyX</span></a><span class="hs-special">,</span><span> </span><a href="Unify.html#tcMatchTysX"><span class="hs-identifier hs-var">tcMatchTysX</span></a><span class="hs-special">,</span><span> </span><a href="Unify.html#tcUnifyTyWithTFs"><span class="hs-identifier hs-var">tcUnifyTyWithTFs</span></a><span class="hs-special">,</span><span>
</span><a name="line-9"></a><span>        </span><a href="Unify.html#ruleMatchTyX"><span class="hs-identifier hs-var">ruleMatchTyX</span></a><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span>        </span><span class="hs-comment">-- * Rough matching</span><span>
</span><a name="line-12"></a><span>        </span><a href="Unify.html#roughMatchTcs"><span class="hs-identifier hs-var">roughMatchTcs</span></a><span class="hs-special">,</span><span> </span><a href="Unify.html#instanceCantMatch"><span class="hs-identifier hs-var">instanceCantMatch</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="Unify.html#typesCantMatch"><span class="hs-identifier hs-var">typesCantMatch</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span>        </span><span class="hs-comment">-- Side-effect free unification</span><span>
</span><a name="line-16"></a><span>        </span><a href="Unify.html#tcUnifyTy"><span class="hs-identifier hs-var">tcUnifyTy</span></a><span class="hs-special">,</span><span> </span><a href="Unify.html#tcUnifyTys"><span class="hs-identifier hs-var">tcUnifyTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="Unify.html#tcUnifyTysFG"><span class="hs-identifier hs-var">tcUnifyTysFG</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>        </span><a href="Unify.html#BindFlag"><span class="hs-identifier hs-type">BindFlag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="Unify.html#UnifyResult"><span class="hs-identifier hs-type">UnifyResult</span></a><span class="hs-special">,</span><span> </span><a href="Unify.html#UnifyResultM"><span class="hs-identifier hs-type">UnifyResultM</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>        </span><span class="hs-comment">-- Matching a type against a lifted type (coercion)</span><span>
</span><a name="line-22"></a><span>        </span><a href="Unify.html#liftCoMatch"><span class="hs-identifier hs-var">liftCoMatch</span></a><span>
</span><a name="line-23"></a><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="Kind.html"><span class="hs-identifier">Kind</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span class="hs-special">(</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#getTvSubstEnv"><span class="hs-identifier hs-var">getTvSubstEnv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#getCvSubstEnv"><span class="hs-identifier hs-var">getCvSubstEnv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="TyCoRep.html"><span class="hs-identifier">TyCoRep</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#getTvSubstEnv"><span class="hs-identifier hs-var">getTvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#getCvSubstEnv"><span class="hs-identifier hs-var">getCvSubstEnv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="Pair.html"><span class="hs-identifier">Pair</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-41"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.Fail.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Fail</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MonadFail</span><span>
</span><a name="line-43"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Applicative.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Applicative.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span></a><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-comment">{-

Unification is much tricker than you might think.

1. The substitution we generate binds the *template type variables*
   which are given to us explicitly.

2. We want to match in the presence of foralls;
        e.g     (forall a. t1) ~ (forall b. t2)

   That is what the RnEnv2 is for; it does the alpha-renaming
   that makes it as if a and b were the same variable.
   Initialising the RnEnv2, so that it can generate a fresh
   binder when necessary, entails knowing the free variables of
   both types.

3. We must be careful not to bind a template type variable to a
   locally bound variable.  E.g.
        (forall a. x) ~ (forall b. b)
   where x is the template type variable.  Then we do not want to
   bind x to a/b!  This is a kind of occurs check.
   The necessary locals accumulate in the RnEnv2.

Note [Kind coercions in Unify]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We wish to match/unify while ignoring casts. But, we can't just ignore
them completely, or we'll end up with ill-kinded substitutions. For example,
say we're matching `a` with `ty |&gt; co`. If we just drop the cast, we'll
return [a |-&gt; ty], but `a` and `ty` might have different kinds. We can't
just match/unify their kinds, either, because this might gratuitously
fail. After all, `co` is the witness that the kinds are the same -- they
may look nothing alike.

So, we pass a kind coercion to the match/unify worker. This coercion witnesses
the equality between the substed kind of the left-hand type and the substed
kind of the right-hand type. To get this coercion, we first have to match/unify
the kinds before looking at the types. Happily, we need look only one level
up, as all kinds are guaranteed to have kind *.

We thought, at one point, that this was all unnecessary: why should casts
be in types in the first place? But they do. In
dependent/should_compile/KindEqualities2, we see, for example
the constraint Num (Int |&gt; (blah ; sym blah)).
We naturally want to find a dictionary for that constraint, which
requires dealing with coercions in this manner.

-}</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | @tcMatchTy t1 t2@ produces a substitution (over fvs(t1))</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- @s@ such that @s(t1)@ equals @t2@.</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- The returned substitution might bind coercion variables,</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- if the variable is an argument to a GADT constructor.</span><span>
</span><a name="line-99"></a><span class="hs-comment">--</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- We don't pass in a set of &quot;template variables&quot; to be bound</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- by the match, because tcMatchTy (and similar functions) are</span><span>
</span><a name="line-102"></a><span class="hs-comment">-- always used on top-level types, so we can bind any of the</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- free variables of the LHS.</span><span>
</span><a name="line-104"></a><span class="hs-identifier">tcMatchTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-105"></a><a name="tcMatchTy"><a href="Unify.html#tcMatchTy"><span class="hs-identifier">tcMatchTy</span></a></a><span> </span><a name="local-1627623644"><a href="#local-1627623644"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1627623645"><a href="#local-1627623645"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#tcMatchTys"><span class="hs-identifier hs-var">tcMatchTys</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627623644"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627623645"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-comment">-- | This is similar to 'tcMatchTy', but extends a substitution</span><span>
</span><a name="line-108"></a><span class="hs-identifier">tcMatchTyX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>            </span><span class="hs-comment">-- ^ Substitution to extend</span><span>
</span><a name="line-109"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>                </span><span class="hs-comment">-- ^ Template</span><span>
</span><a name="line-110"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>                </span><span class="hs-comment">-- ^ Target</span><span>
</span><a name="line-111"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-112"></a><a name="tcMatchTyX"><a href="Unify.html#tcMatchTyX"><span class="hs-identifier">tcMatchTyX</span></a></a><span> </span><a name="local-1627623646"><a href="#local-1627623646"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627623647"><a href="#local-1627623647"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1627623648"><a href="#local-1627623648"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#tcMatchTysX"><span class="hs-identifier hs-var">tcMatchTysX</span></a><span> </span><a href="#local-1627623646"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627623647"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627623648"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-comment">-- | Like 'tcMatchTy' but over a list of types.</span><span>
</span><a name="line-115"></a><span class="hs-identifier">tcMatchTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- ^ Template</span><span>
</span><a name="line-116"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- ^ Target</span><span>
</span><a name="line-117"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-comment">-- ^ One-shot; in principle the template</span><span>
</span><a name="line-118"></a><span>                             </span><span class="hs-comment">-- variables could be free in the target</span><span>
</span><a name="line-119"></a><a name="tcMatchTys"><a href="Unify.html#tcMatchTys"><span class="hs-identifier">tcMatchTys</span></a></a><span> </span><a name="local-1627623649"><a href="#local-1627623649"><span class="hs-identifier">tys1</span></a></a><span> </span><a name="local-1627623650"><a href="#local-1627623650"><span class="hs-identifier">tys2</span></a></a><span>
</span><a name="line-120"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#tcMatchTysX"><span class="hs-identifier hs-var">tcMatchTysX</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span> </span><a href="#local-1627623651"><span class="hs-identifier hs-var">in_scope</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623649"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="#local-1627623650"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-121"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-122"></a><span>    </span><a name="local-1627623651"><a href="#local-1627623651"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1627623649"><span class="hs-identifier hs-var">tys1</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1627623650"><span class="hs-identifier hs-var">tys2</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-comment">-- | Like 'tcMatchTys', but extending a substitution</span><span>
</span><a name="line-125"></a><span class="hs-identifier">tcMatchTysX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>       </span><span class="hs-comment">-- ^ Substitution to extend</span><span>
</span><a name="line-126"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- ^ Template</span><span>
</span><a name="line-127"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- ^ Target</span><span>
</span><a name="line-128"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-comment">-- ^ One-shot substitution</span><span>
</span><a name="line-129"></a><a name="tcMatchTysX"><a href="Unify.html#tcMatchTysX"><span class="hs-identifier">tcMatchTysX</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><a name="local-1627623652"><a href="#local-1627623652"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-1627623653"><a href="#local-1627623653"><span class="hs-identifier">tv_env</span></a></a><span> </span><a name="local-1627623654"><a href="#local-1627623654"><span class="hs-identifier">cv_env</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623655"><a href="#local-1627623655"><span class="hs-identifier">tys1</span></a></a><span> </span><a name="local-1627623656"><a href="#local-1627623656"><span class="hs-identifier">tys2</span></a></a><span>
</span><a name="line-130"></a><span class="hs-comment">-- See Note [Kind coercions in Unify]</span><span>
</span><a name="line-131"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Unify.html#tc_unify_tys"><span class="hs-identifier hs-var">tc_unify_tys</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>                      </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- Matching, not unifying</span><span>
</span><a name="line-133"></a><span>                      </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- Not an injectivity check</span><span>
</span><a name="line-134"></a><span>                      </span><span class="hs-special">(</span><a href="VarEnv.html#mkRnEnv2"><span class="hs-identifier hs-var">mkRnEnv2</span></a><span> </span><a href="#local-1627623652"><span class="hs-identifier hs-var">in_scope</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623653"><span class="hs-identifier hs-var">tv_env</span></a><span> </span><a href="#local-1627623654"><span class="hs-identifier hs-var">cv_env</span></a><span> </span><a href="#local-1627623655"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="#local-1627623656"><span class="hs-identifier hs-var">tys2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-135"></a><span>      </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623657"><a href="#local-1627623657"><span class="hs-identifier">tv_env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627623658"><a href="#local-1627623658"><span class="hs-identifier">cv_env'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a><span> </span><a href="#local-1627623652"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-1627623657"><span class="hs-identifier hs-var">tv_env'</span></a><span> </span><a href="#local-1627623658"><span class="hs-identifier hs-var">cv_env'</span></a><span>
</span><a name="line-137"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-comment">-- | This one is called from the expression matcher,</span><span>
</span><a name="line-140"></a><span class="hs-comment">-- which already has a MatchEnv in hand</span><span>
</span><a name="line-141"></a><span class="hs-identifier">ruleMatchTyX</span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span>          </span><span class="hs-comment">-- ^ template variables</span><span>
</span><a name="line-143"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span>
</span><a name="line-144"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span>          </span><span class="hs-comment">-- ^ type substitution to extend</span><span>
</span><a name="line-145"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>                </span><span class="hs-comment">-- ^ Template</span><span>
</span><a name="line-146"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>                </span><span class="hs-comment">-- ^ Target</span><span>
</span><a name="line-147"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span>
</span><a name="line-148"></a><a name="ruleMatchTyX"><a href="Unify.html#ruleMatchTyX"><span class="hs-identifier">ruleMatchTyX</span></a></a><span> </span><a name="local-1627623659"><a href="#local-1627623659"><span class="hs-identifier">tmpl_tvs</span></a></a><span> </span><a name="local-1627623660"><a href="#local-1627623660"><span class="hs-identifier">rn_env</span></a></a><span> </span><a name="local-1627623661"><a href="#local-1627623661"><span class="hs-identifier">tenv</span></a></a><span> </span><a name="local-1627623662"><a href="#local-1627623662"><span class="hs-identifier">tmpl</span></a></a><span> </span><a name="local-1627623663"><a href="#local-1627623663"><span class="hs-identifier">target</span></a></a><span>
</span><a name="line-149"></a><span class="hs-comment">-- See Note [Kind coercions in Unify]</span><span>
</span><a name="line-150"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Unify.html#tc_unify_tys"><span class="hs-identifier hs-var">tc_unify_tys</span></a><span> </span><span class="hs-special">(</span><a href="Unify.html#matchBindFun"><span class="hs-identifier hs-var">matchBindFun</span></a><span> </span><a href="#local-1627623659"><span class="hs-identifier hs-var">tmpl_tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1627623660"><span class="hs-identifier hs-var">rn_env</span></a><span>
</span><a name="line-151"></a><span>                      </span><a href="#local-1627623661"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="TyCoRep.html#emptyCvSubstEnv"><span class="hs-identifier hs-var">emptyCvSubstEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627623662"><span class="hs-identifier hs-var">tmpl</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627623663"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-152"></a><span>      </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623664"><a href="#local-1627623664"><span class="hs-identifier">tenv'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627623664"><span class="hs-identifier hs-var">tenv'</span></a><span>
</span><a name="line-153"></a><span>      </span><span class="hs-identifier">_</span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-identifier">matchBindFun</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#BindFlag"><span class="hs-identifier hs-type">BindFlag</span></a><span>
</span><a name="line-156"></a><a name="matchBindFun"><a href="Unify.html#matchBindFun"><span class="hs-identifier">matchBindFun</span></a></a><span> </span><a name="local-1627623665"><a href="#local-1627623665"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-1627623666"><a href="#local-1627623666"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627623666"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627623665"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Unify.html#Skolem"><span class="hs-identifier hs-var">Skolem</span></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Rough matching
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-comment">-- See Note [Rough match] field in InstEnv</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-identifier">roughMatchTcs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-168"></a><a name="roughMatchTcs"><a href="Unify.html#roughMatchTcs"><span class="hs-identifier">roughMatchTcs</span></a></a><span> </span><a name="local-1627623667"><a href="#local-1627623667"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1627623668"><span class="hs-identifier hs-var">rough</span></a><span> </span><a href="#local-1627623667"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-169"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-170"></a><span>    </span><a name="local-1627623668"><a href="#local-1627623668"><span class="hs-identifier">rough</span></a></a><span> </span><a name="local-1627623669"><a href="#local-1627623669"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-171"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623670"><a href="#local-1627623670"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitCastTy_maybe"><span class="hs-identifier hs-var">splitCastTy_maybe</span></a><span> </span><a href="#local-1627623669"><span class="hs-identifier hs-var">ty</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623668"><span class="hs-identifier hs-var">rough</span></a><span> </span><a href="#local-1627623670"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-172"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623671"><a href="#local-1627623671"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-1627623669"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-1627623671"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                               </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span class="hs-identifier">instanceCantMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- (instanceCantMatch tcs1 tcs2) returns True if tcs1 cannot</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- possibly be instantiated to actual, nor vice versa;</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- False is non-committal</span><span>
</span><a name="line-179"></a><a name="instanceCantMatch"><a href="Unify.html#instanceCantMatch"><span class="hs-identifier">instanceCantMatch</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627623672"><a href="#local-1627623672"><span class="hs-identifier">mt</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1627623673"><a href="#local-1627623673"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627623674"><a href="#local-1627623674"><span class="hs-identifier">ma</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#itemCantMatch"><span class="hs-identifier hs-var">itemCantMatch</span></a><span> </span><a href="#local-1627623672"><span class="hs-identifier hs-var">mt</span></a><span> </span><a href="#local-1627623674"><span class="hs-identifier hs-var">ma</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Unify.html#instanceCantMatch"><span class="hs-identifier hs-var">instanceCantMatch</span></a><span> </span><a href="#local-1627623673"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-180"></a><span class="hs-identifier">instanceCantMatch</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- Safe</span><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span class="hs-identifier">itemCantMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-183"></a><a name="itemCantMatch"><a href="Unify.html#itemCantMatch"><span class="hs-identifier">itemCantMatch</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627623676"><a href="#local-1627623676"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627623677"><a href="#local-1627623677"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623676"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1627623677"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-184"></a><span class="hs-identifier">itemCantMatch</span><span> </span><span class="hs-identifier">_</span><span>        </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                GADTs
*                                                                      *
************************************************************************

Note [Pruning dead case alternatives]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider        data T a where
                   T1 :: T Int
                   T2 :: T a

                newtype X = MkX Int
                newtype Y = MkY Char

                type family F a
                type instance F Bool = Int

Now consider    case x of { T1 -&gt; e1; T2 -&gt; e2 }

The question before the house is this: if I know something about the type
of x, can I prune away the T1 alternative?

Suppose x::T Char.  It's impossible to construct a (T Char) using T1,
        Answer = YES we can prune the T1 branch (clearly)

Suppose x::T (F a), where 'a' is in scope.  Then 'a' might be instantiated
to 'Bool', in which case x::T Int, so
        ANSWER = NO (clearly)

We see here that we want precisely the apartness check implemented within
tcUnifyTysFG. So that's what we do! Two types cannot match if they are surely
apart. Note that since we are simply dropping dead code, a conservative test
suffices.
-}</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span class="hs-comment">-- | Given a list of pairs of types, are any two members of a pair surely</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- apart, even after arbitrary type function evaluation and substitution?</span><span>
</span><a name="line-226"></a><span class="hs-identifier">typesCantMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- See Note [Pruning dead case alternatives]</span><span>
</span><a name="line-228"></a><a name="typesCantMatch"><a href="Unify.html#typesCantMatch"><span class="hs-identifier">typesCantMatch</span></a></a><span> </span><a name="local-1627623678"><a href="#local-1627623678"><span class="hs-identifier">prs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a><span> </span><a href="#local-1627623679"><span class="hs-identifier hs-var">cant_match</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623678"><span class="hs-identifier hs-var">prs</span></a><span>
</span><a name="line-229"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-230"></a><span>    </span><span class="hs-identifier">cant_match</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-231"></a><span>    </span><a name="local-1627623679"><a href="#local-1627623679"><span class="hs-identifier">cant_match</span></a></a><span> </span><a name="local-1627623680"><a href="#local-1627623680"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-1627623681"><a href="#local-1627623681"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Unify.html#tcUnifyTysFG"><span class="hs-identifier hs-var">tcUnifyTysFG</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-1627623680"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627623681"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-232"></a><span>      </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-233"></a><span>      </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Unification
*                                                                      *
************************************************************************

Note [Fine-grained unification]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Do the types (x, x) and ([y], y) unify? The answer is seemingly &quot;no&quot; --
no substitution to finite types makes these match. But, a substitution to
*infinite* types can unify these two types: [x |-&gt; [[[...]]], y |-&gt; [[[...]]] ].
Why do we care? Consider these two type family instances:

type instance F x x   = Int
type instance F [y] y = Bool

If we also have

type instance Looper = [Looper]

then the instances potentially overlap. The solution is to use unification
over infinite terms. This is possible (see [1] for lots of gory details), but
a full algorithm is a little more power than we need. Instead, we make a
conservative approximation and just omit the occurs check.

[1]: http://research.microsoft.com/en-us/um/people/simonpj/papers/ext-f/axioms-extended.pdf

tcUnifyTys considers an occurs-check problem as the same as general unification
failure.

tcUnifyTysFG (&quot;fine-grained&quot;) returns one of three results: success, occurs-check
failure (&quot;MaybeApart&quot;), or general failure (&quot;SurelyApart&quot;).

See also Trac #8162.

It's worth noting that unification in the presence of infinite types is not
complete. This means that, sometimes, a closed type family does not reduce
when it should. See test case indexed-types/should_fail/Overlap15 for an
example.

Note [The substitution in MaybeApart]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The constructor MaybeApart carries data with it, typically a TvSubstEnv. Why?
Because consider unifying these:

(a, a, Int) ~ (b, [b], Bool)

If we go left-to-right, we start with [a |-&gt; b]. Then, on the middle terms, we
apply the subst we have so far and discover that we need [b |-&gt; [b]]. Because
this fails the occurs check, we say that the types are MaybeApart (see above
Note [Fine-grained unification]). But, we can't stop there! Because if we
continue, we discover that Int is SurelyApart from Bool, and therefore the
types are apart. This has practical consequences for the ability for closed
type family applications to reduce. See test case
indexed-types/should_compile/Overlap14.

Note [Unifying with skolems]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If we discover that two types unify if and only if a skolem variable is
substituted, we can't properly unify the types. But, that skolem variable
may later be instantiated with a unifyable type. So, we return maybeApart
in these cases.

Note [Lists of different lengths are MaybeApart]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It is unusual to call tcUnifyTys or tcUnifyTysFG with lists of different
lengths. The place where we know this can happen is from compatibleBranches in
FamInstEnv, when checking data family instances. Data family instances may be
eta-reduced; see Note [Eta reduction for data family axioms] in TcInstDcls.

We wish to say that

  D :: * -&gt; * -&gt; *
  axDF1 :: D Int ~ DFInst1
  axDF2 :: D Int Bool ~ DFInst2

overlap. If we conclude that lists of different lengths are SurelyApart, then
it will look like these do *not* overlap, causing disaster. See Trac #9371.

In usages of tcUnifyTys outside of family instances, we always use tcUnifyTys,
which can't tell the difference between MaybeApart and SurelyApart, so those
usages won't notice this design choice.
-}</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-identifier">tcUnifyTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>       </span><span class="hs-comment">-- All tyvars are bindable</span><span>
</span><a name="line-321"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-322"></a><span>                       </span><span class="hs-comment">-- A regular one-shot (idempotent) substitution</span><span>
</span><a name="line-323"></a><span class="hs-comment">-- Simple unification of two types; all type variables are bindable</span><span>
</span><a name="line-324"></a><a name="tcUnifyTy"><a href="Unify.html#tcUnifyTy"><span class="hs-identifier">tcUnifyTy</span></a></a><span> </span><a name="local-1627623682"><a href="#local-1627623682"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-1627623683"><a href="#local-1627623683"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#tcUnifyTys"><span class="hs-identifier hs-var">tcUnifyTys</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-1627623682"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627623683"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">]</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-comment">-- | Unify two types, treating type family applications as possibly unifying</span><span>
</span><a name="line-327"></a><span class="hs-comment">-- with anything and looking through injective type family applications.</span><span>
</span><a name="line-328"></a><span class="hs-identifier">tcUnifyTyWithTFs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>  </span><span class="hs-comment">-- ^ True &lt;=&gt; do two-way unification;</span><span>
</span><a name="line-329"></a><span>                          </span><span class="hs-comment">--   False &lt;=&gt; do one-way matching.</span><span>
</span><a name="line-330"></a><span>                          </span><span class="hs-comment">--   See end of sec 5.2 from the paper</span><span>
</span><a name="line-331"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-332"></a><span class="hs-comment">-- This algorithm is an implementation of the &quot;Algorithm U&quot; presented in</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- the paper &quot;Injective type families for Haskell&quot;, Figures 2 and 3.</span><span>
</span><a name="line-334"></a><span class="hs-comment">-- The code is incorporated with the standard unifier for convenience, but</span><span>
</span><a name="line-335"></a><span class="hs-comment">-- its operation should match the specification in the paper.</span><span>
</span><a name="line-336"></a><a name="tcUnifyTyWithTFs"><a href="Unify.html#tcUnifyTyWithTFs"><span class="hs-identifier">tcUnifyTyWithTFs</span></a></a><span> </span><a name="local-1627623684"><a href="#local-1627623684"><span class="hs-identifier">twoWay</span></a></a><span> </span><a name="local-1627623685"><a href="#local-1627623685"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-1627623686"><a href="#local-1627623686"><span class="hs-identifier">t2</span></a></a><span>
</span><a name="line-337"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Unify.html#tc_unify_tys"><span class="hs-identifier hs-var">tc_unify_tys</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623684"><span class="hs-identifier hs-var">twoWay</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-338"></a><span>                       </span><a href="#local-1627623687"><span class="hs-identifier hs-var">rn_env</span></a><span> </span><a href="TyCoRep.html#emptyTvSubstEnv"><span class="hs-identifier hs-var">emptyTvSubstEnv</span></a><span> </span><a href="TyCoRep.html#emptyCvSubstEnv"><span class="hs-identifier hs-var">emptyCvSubstEnv</span></a><span>
</span><a name="line-339"></a><span>                       </span><span class="hs-special">[</span><a href="#local-1627623685"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627623686"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-340"></a><span>      </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span>  </span><span class="hs-special">(</span><a name="local-1627623688"><a href="#local-1627623688"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Unify.html#niFixTCvSubst"><span class="hs-identifier hs-var">niFixTCvSubst</span></a><span> </span><a href="#local-1627623688"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-341"></a><span>      </span><a href="Unify.html#MaybeApart"><span class="hs-identifier hs-var">MaybeApart</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623689"><a href="#local-1627623689"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Unify.html#niFixTCvSubst"><span class="hs-identifier hs-var">niFixTCvSubst</span></a><span> </span><a href="#local-1627623689"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-342"></a><span>      </span><span class="hs-comment">-- we want to *succeed* in questionable cases. This is a</span><span>
</span><a name="line-343"></a><span>      </span><span class="hs-comment">-- pre-unification algorithm.</span><span>
</span><a name="line-344"></a><span>      </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-345"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-346"></a><span>    </span><a name="local-1627623687"><a href="#local-1627623687"><span class="hs-identifier">rn_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkRnEnv2"><span class="hs-identifier hs-var">mkRnEnv2</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627623685"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627623686"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">]</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-349"></a><span class="hs-identifier">tcUnifyTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#BindFlag"><span class="hs-identifier hs-type">BindFlag</span></a><span class="hs-special">)</span><span>
</span><a name="line-350"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-351"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-352"></a><span>                                </span><span class="hs-comment">-- ^ A regular one-shot (idempotent) substitution</span><span>
</span><a name="line-353"></a><span>                                </span><span class="hs-comment">-- that unifies the erased types. See comments</span><span>
</span><a name="line-354"></a><span>                                </span><span class="hs-comment">-- for 'tcUnifyTysFG'</span><span>
</span><a name="line-355"></a><span>
</span><a name="line-356"></a><span class="hs-comment">-- The two types may have common type variables, and indeed do so in the</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- second call to tcUnifyTys in FunDeps.checkClsFD</span><span>
</span><a name="line-358"></a><a name="tcUnifyTys"><a href="Unify.html#tcUnifyTys"><span class="hs-identifier">tcUnifyTys</span></a></a><span> </span><a name="local-1627623690"><a href="#local-1627623690"><span class="hs-identifier">bind_fn</span></a></a><span> </span><a name="local-1627623691"><a href="#local-1627623691"><span class="hs-identifier">tys1</span></a></a><span> </span><a name="local-1627623692"><a href="#local-1627623692"><span class="hs-identifier">tys2</span></a></a><span>
</span><a name="line-359"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Unify.html#tcUnifyTysFG"><span class="hs-identifier hs-var">tcUnifyTysFG</span></a><span> </span><a href="#local-1627623690"><span class="hs-identifier hs-var">bind_fn</span></a><span> </span><a href="#local-1627623691"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="#local-1627623692"><span class="hs-identifier hs-var">tys2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-360"></a><span>      </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><a name="local-1627623693"><a href="#local-1627623693"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627623693"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-361"></a><span>      </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-comment">-- This type does double-duty. It is used in the UM (unifier monad) and to</span><span>
</span><a name="line-364"></a><span class="hs-comment">-- return the final result. See Note [Fine-grained unification]</span><span>
</span><a name="line-365"></a><span class="hs-keyword">type</span><span> </span><a name="UnifyResult"><a href="Unify.html#UnifyResult"><span class="hs-identifier">UnifyResult</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UnifyResultM"><span class="hs-identifier hs-type">UnifyResultM</span></a><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-366"></a><span class="hs-keyword">data</span><span> </span><a name="UnifyResultM"><a href="Unify.html#UnifyResultM"><span class="hs-identifier">UnifyResultM</span></a></a><span> </span><a name="local-1627623639"><a href="#local-1627623639"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Unifiable"><a href="Unify.html#Unifiable"><span class="hs-identifier">Unifiable</span></a></a><span> </span><a href="#local-1627623639"><span class="hs-identifier hs-type">a</span></a><span>        </span><span class="hs-comment">-- the subst that unifies the types</span><span>
</span><a name="line-367"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a name="MaybeApart"><a href="Unify.html#MaybeApart"><span class="hs-identifier">MaybeApart</span></a></a><span> </span><a href="#local-1627623639"><span class="hs-identifier hs-type">a</span></a><span>       </span><span class="hs-comment">-- the subst has as much as we know</span><span>
</span><a name="line-368"></a><span>                                         </span><span class="hs-comment">-- it must be part of an most general unifier</span><span>
</span><a name="line-369"></a><span>                                         </span><span class="hs-comment">-- See Note [The substitution in MaybeApart]</span><span>
</span><a name="line-370"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a name="SurelyApart"><a href="Unify.html#SurelyApart"><span class="hs-identifier">SurelyApart</span></a></a><span>
</span><a name="line-371"></a><span>                    </span><span class="hs-keyword">deriving</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Functor"><span class="hs-identifier hs-type">Functor</span></a><span>
</span><a name="line-372"></a><span>
</span><a name="line-373"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Applicative"><span class="hs-identifier hs-type">Applicative</span></a><span> </span><a href="Unify.html#UnifyResultM"><span class="hs-identifier hs-type">UnifyResultM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-374"></a><span>  </span><a name="local-805307120"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier">pure</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span>
</span><a name="line-375"></a><span>  </span><span class="hs-special">(</span><a name="local-805307119"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator">&lt;*&gt;</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#ap"><span class="hs-identifier hs-var">ap</span></a><span>
</span><a name="line-376"></a><span>
</span><a name="line-377"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a><span> </span><a href="Unify.html#UnifyResultM"><span class="hs-identifier hs-type">UnifyResultM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span>  </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span>  </span><a name="local-805306539"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator">&gt;&gt;=</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span>
</span><a name="line-380"></a><span>  </span><a href="Unify.html#MaybeApart"><span class="hs-identifier hs-var">MaybeApart</span></a><span> </span><a name="local-1627624072"><a href="#local-1627624072"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><a name="local-1627624073"><a href="#local-1627624073"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627624073"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627624072"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-381"></a><span>                         </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><a name="local-1627624074"><a href="#local-1627624074"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#MaybeApart"><span class="hs-identifier hs-var">MaybeApart</span></a><span> </span><a href="#local-1627624074"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-382"></a><span>                         </span><a name="local-1627624075"><a href="#local-1627624075"><span class="hs-identifier">other</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627624075"><span class="hs-identifier hs-var">other</span></a><span>
</span><a name="line-383"></a><span>  </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><a name="local-1627624076"><a href="#local-1627624076"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-operator">&gt;&gt;=</span><span> </span><a name="local-1627624077"><a href="#local-1627624077"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627624077"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627624076"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Alternative"><span class="hs-identifier hs-type">Alternative</span></a><span> </span><a href="Unify.html#UnifyResultM"><span class="hs-identifier hs-type">UnifyResultM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-386"></a><span>  </span><a name="local-1912608663"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#empty"><span class="hs-identifier">empty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span>  </span><a name="local-1627624068"><a href="#local-1627624068"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a name="local-1912608662"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%7C%3E"><span class="hs-operator">&lt;|&gt;</span></a></a><span> </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627624068"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-389"></a><span>  </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-operator">&lt;|&gt;</span><span> </span><a name="local-1627624069"><a href="#local-1627624069"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627624069"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-390"></a><span>  </span><a name="local-1627624070"><a href="#local-1627624070"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Unify.html#MaybeApart"><span class="hs-identifier hs-var">MaybeApart</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;|&gt;</span><span> </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627624070"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-391"></a><span>  </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-operator">&lt;|&gt;</span><span> </span><a name="local-1627624071"><a href="#local-1627624071"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Unify.html#MaybeApart"><span class="hs-identifier hs-var">MaybeApart</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627624071"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-392"></a><span>  </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span>       </span><span class="hs-operator">&lt;|&gt;</span><span> </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#MonadPlus"><span class="hs-identifier hs-type">MonadPlus</span></a><span> </span><a href="Unify.html#UnifyResultM"><span class="hs-identifier hs-type">UnifyResultM</span></a><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span class="hs-comment">-- | @tcUnifyTysFG bind_tv tys1 tys2@ attepts to find a substitution @s@ (whose</span><span>
</span><a name="line-397"></a><span class="hs-comment">-- domain elements all respond 'BindMe' to @bind_tv@) such that</span><span>
</span><a name="line-398"></a><span class="hs-comment">-- @s(tys1)@ and that of @s(tys2)@ are equal, as witnessed by the returned</span><span>
</span><a name="line-399"></a><span class="hs-comment">-- Coercions.</span><span>
</span><a name="line-400"></a><span class="hs-identifier">tcUnifyTysFG</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#BindFlag"><span class="hs-identifier hs-type">BindFlag</span></a><span class="hs-special">)</span><span>
</span><a name="line-401"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-402"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UnifyResult"><span class="hs-identifier hs-type">UnifyResult</span></a><span>
</span><a name="line-403"></a><a name="tcUnifyTysFG"><a href="Unify.html#tcUnifyTysFG"><span class="hs-identifier">tcUnifyTysFG</span></a></a><span> </span><a name="local-1627623694"><a href="#local-1627623694"><span class="hs-identifier">bind_fn</span></a></a><span> </span><a name="local-1627623695"><a href="#local-1627623695"><span class="hs-identifier">tys1</span></a></a><span> </span><a name="local-1627623696"><a href="#local-1627623696"><span class="hs-identifier">tys2</span></a></a><span>
</span><a name="line-404"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1627623699"><a href="#local-1627623699"><span class="hs-identifier">env</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#tc_unify_tys"><span class="hs-identifier hs-var">tc_unify_tys</span></a><span> </span><a href="#local-1627623694"><span class="hs-identifier hs-var">bind_fn</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1627623698"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-405"></a><span>                                  </span><a href="TyCoRep.html#emptyTvSubstEnv"><span class="hs-identifier hs-var">emptyTvSubstEnv</span></a><span> </span><a href="TyCoRep.html#emptyCvSubstEnv"><span class="hs-identifier hs-var">emptyCvSubstEnv</span></a><span>
</span><a name="line-406"></a><span>                                  </span><a href="#local-1627623695"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="#local-1627623696"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-407"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Unify.html#niFixTCvSubst"><span class="hs-identifier hs-var">niFixTCvSubst</span></a><span> </span><a href="#local-1627623699"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-408"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-409"></a><span>    </span><a name="local-1627623697"><a href="#local-1627623697"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1627623695"><span class="hs-identifier hs-var">tys1</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-1627623696"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-410"></a><span>    </span><a name="local-1627623698"><a href="#local-1627623698"><span class="hs-identifier">env</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkRnEnv2"><span class="hs-identifier hs-var">mkRnEnv2</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><a href="#local-1627623697"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-411"></a><span>
</span><a name="line-412"></a><span class="hs-comment">-- | This function is actually the one to call the unifier -- a little</span><span>
</span><a name="line-413"></a><span class="hs-comment">-- too general for outside clients, though.</span><span>
</span><a name="line-414"></a><span class="hs-identifier">tc_unify_tys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#BindFlag"><span class="hs-identifier hs-type">BindFlag</span></a><span class="hs-special">)</span><span>
</span><a name="line-415"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>        </span><span class="hs-comment">-- ^ True &lt;=&gt; unify; False &lt;=&gt; match</span><span>
</span><a name="line-416"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>        </span><span class="hs-comment">-- ^ True &lt;=&gt; doing an injectivity check</span><span>
</span><a name="line-417"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span>
</span><a name="line-418"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span>  </span><span class="hs-comment">-- ^ substitution to extend</span><span>
</span><a name="line-419"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a><span>
</span><a name="line-420"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-421"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UnifyResultM"><span class="hs-identifier hs-type">UnifyResultM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-422"></a><a name="tc_unify_tys"><a href="Unify.html#tc_unify_tys"><span class="hs-identifier">tc_unify_tys</span></a></a><span> </span><a name="local-1627623700"><a href="#local-1627623700"><span class="hs-identifier">bind_fn</span></a></a><span> </span><a name="local-1627623701"><a href="#local-1627623701"><span class="hs-identifier">unif</span></a></a><span> </span><a name="local-1627623702"><a href="#local-1627623702"><span class="hs-identifier">inj_check</span></a></a><span> </span><a name="local-1627623703"><a href="#local-1627623703"><span class="hs-identifier">rn_env</span></a></a><span> </span><a name="local-1627623704"><a href="#local-1627623704"><span class="hs-identifier">tv_env</span></a></a><span> </span><a name="local-1627623705"><a href="#local-1627623705"><span class="hs-identifier">cv_env</span></a></a><span> </span><a name="local-1627623706"><a href="#local-1627623706"><span class="hs-identifier">tys1</span></a></a><span> </span><a name="local-1627623707"><a href="#local-1627623707"><span class="hs-identifier">tys2</span></a></a><span>
</span><a name="line-423"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#initUM"><span class="hs-identifier hs-var">initUM</span></a><span> </span><a href="#local-1627623700"><span class="hs-identifier hs-var">bind_fn</span></a><span> </span><a href="#local-1627623701"><span class="hs-identifier hs-var">unif</span></a><span> </span><a href="#local-1627623702"><span class="hs-identifier hs-var">inj_check</span></a><span> </span><a href="#local-1627623703"><span class="hs-identifier hs-var">rn_env</span></a><span> </span><a href="#local-1627623704"><span class="hs-identifier hs-var">tv_env</span></a><span> </span><a href="#local-1627623705"><span class="hs-identifier hs-var">cv_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-424"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="Unify.html#unify_tys"><span class="hs-identifier hs-var">unify_tys</span></a><span> </span><a href="#local-1627623708"><span class="hs-identifier hs-var">kis1</span></a><span> </span><a href="#local-1627623709"><span class="hs-identifier hs-var">kis2</span></a><span>
</span><a name="line-425"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="Unify.html#unify_tys"><span class="hs-identifier hs-var">unify_tys</span></a><span> </span><a href="#local-1627623706"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="#local-1627623707"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-426"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Unify.html#getTvSubstEnv"><span class="hs-identifier hs-var">getTvSubstEnv</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a><span> </span><a href="Unify.html#getCvSubstEnv"><span class="hs-identifier hs-var">getCvSubstEnv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-427"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-428"></a><span>    </span><a name="local-1627623708"><a href="#local-1627623708"><span class="hs-identifier">kis1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1627623706"><span class="hs-identifier hs-var">tys1</span></a><span>
</span><a name="line-429"></a><span>    </span><a name="local-1627623709"><a href="#local-1627623709"><span class="hs-identifier">kis2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1627623707"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-1627624065"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><span class="hs-special">(</span><a href="Unify.html#UnifyResultM"><span class="hs-identifier hs-type">UnifyResultM</span></a><span> </span><a href="#local-1627624065"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-432"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;SurelyApart&quot;</span><span>
</span><a name="line-433"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><a name="local-1627624066"><a href="#local-1627624066"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Unifiable&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627624066"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-434"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="Unify.html#MaybeApart"><span class="hs-identifier hs-var">MaybeApart</span></a><span> </span><a name="local-1627624067"><a href="#local-1627624067"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;MaybeApart&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1627624067"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-435"></a><span>
</span><a name="line-436"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Non-idempotent substitution
*                                                                      *
************************************************************************

Note [Non-idempotent substitution]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
During unification we use a TvSubstEnv/CvSubstEnv pair that is
  (a) non-idempotent
  (b) loop-free; ie repeatedly applying it yields a fixed point

Note [Finding the substitution fixpoint]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Finding the fixpoint of a non-idempotent substitution arising from a
unification is harder than it looks, because of kinds.  Consider
   T k (H k (f:k)) ~ T * (g:*)
If we unify, we get the substitution
   [ k -&gt; *
   , g -&gt; H k (f:k) ]
To make it idempotent we don't want to get just
   [ k -&gt; *
   , g -&gt; H * (f:k) ]
We also want to substitute inside f's kind, to get
   [ k -&gt; *
   , g -&gt; H k (f:*) ]
If we don't do this, we may apply the substitition to something,
and get an ill-formed type, i.e. one where typeKind will fail.
This happened, for example, in Trac #9106.

This is the reason for extending env with [f:k -&gt; f:*], in the
definition of env' in niFixTvSubst
-}</span><span>
</span><a name="line-470"></a><span>
</span><a name="line-471"></a><span class="hs-identifier">niFixTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>
</span><a name="line-472"></a><span class="hs-comment">-- Find the idempotent fixed point of the non-idempotent substitution</span><span>
</span><a name="line-473"></a><span class="hs-comment">-- See Note [Finding the substitution fixpoint]</span><span>
</span><a name="line-474"></a><span class="hs-comment">-- ToDo: use laziness instead of iteration?</span><span>
</span><a name="line-475"></a><a name="niFixTCvSubst"><a href="Unify.html#niFixTCvSubst"><span class="hs-identifier">niFixTCvSubst</span></a></a><span> </span><a name="local-1627623710"><a href="#local-1627623710"><span class="hs-identifier">tenv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623711"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627623710"><span class="hs-identifier hs-var">tenv</span></a><span>
</span><a name="line-476"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-477"></a><span>    </span><a name="local-1627623711"><a href="#local-1627623711"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627623712"><a href="#local-1627623712"><span class="hs-identifier">tenv</span></a></a><span>
</span><a name="line-478"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627623713"><span class="hs-identifier hs-var">not_fixpoint</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623711"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#mapVarEnv"><span class="hs-identifier hs-var">mapVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-1627623718"><span class="hs-identifier hs-var">subst'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623712"><span class="hs-identifier hs-var">tenv</span></a><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623716"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-480"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-481"></a><span>          </span><a name="local-1627623713"><a href="#local-1627623713"><span class="hs-identifier">not_fixpoint</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#foldVarSet"><span class="hs-identifier hs-var">foldVarSet</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">||</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1627623714"><span class="hs-identifier hs-var">in_domain</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1627623715"><span class="hs-identifier hs-var">range_tvs</span></a><span>
</span><a name="line-482"></a><span>          </span><a name="local-1627623714"><a href="#local-1627623714"><span class="hs-identifier">in_domain</span></a></a><span> </span><a name="local-1627623719"><a href="#local-1627623719"><span class="hs-identifier">tv</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623719"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarEnv.html#elemVarEnv"><span class="hs-identifier hs-var">elemVarEnv</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627623712"><span class="hs-identifier hs-var">tenv</span></a><span>
</span><a name="line-483"></a><span>
</span><a name="line-484"></a><span>          </span><a name="local-1627623715"><a href="#local-1627623715"><span class="hs-identifier">range_tvs</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#foldVarEnv"><span class="hs-identifier hs-var">foldVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span class="hs-special">)</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span> </span><a href="#local-1627623712"><span class="hs-identifier hs-var">tenv</span></a><span>
</span><a name="line-485"></a><span>          </span><a name="local-1627623716"><a href="#local-1627623716"><span class="hs-identifier">subst</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTvSubst"><span class="hs-identifier hs-var">mkTvSubst</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><a href="#local-1627623715"><span class="hs-identifier hs-var">range_tvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623712"><span class="hs-identifier hs-var">tenv</span></a><span>
</span><a name="line-486"></a><span>
</span><a name="line-487"></a><span>             </span><span class="hs-comment">-- env' extends env by replacing any free type with</span><span>
</span><a name="line-488"></a><span>             </span><span class="hs-comment">-- that same tyvar with a substituted kind</span><span>
</span><a name="line-489"></a><span>             </span><span class="hs-comment">-- See note [Finding the substitution fixpoint]</span><span>
</span><a name="line-490"></a><span>          </span><a name="local-1627623717"><a href="#local-1627623717"><span class="hs-identifier">tenv'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnvList"><span class="hs-identifier hs-var">extendVarEnvList</span></a><span> </span><a href="#local-1627623712"><span class="hs-identifier hs-var">tenv</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-1627623720"><span class="hs-identifier hs-var">rtv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-491"></a><span>                                                 </span><a href="Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a><span> </span><a href="#local-1627623720"><span class="hs-identifier hs-var">rtv</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-492"></a><span>                                                 </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-1627623716"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-493"></a><span>                                                 </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1627623720"><span class="hs-identifier hs-var">rtv</span></a><span class="hs-special">)</span><span>
</span><a name="line-494"></a><span>                                         </span><span class="hs-glyph">|</span><span> </span><a name="local-1627623720"><a href="#local-1627623720"><span class="hs-identifier">rtv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="VarSet.html#varSetElems"><span class="hs-identifier hs-var">varSetElems</span></a><span> </span><a href="#local-1627623715"><span class="hs-identifier hs-var">range_tvs</span></a><span>
</span><a name="line-495"></a><span>                                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1627623714"><span class="hs-identifier hs-var">in_domain</span></a><span> </span><a href="#local-1627623720"><span class="hs-identifier hs-var">rtv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-496"></a><span>          </span><a name="local-1627623718"><a href="#local-1627623718"><span class="hs-identifier">subst'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTvSubst"><span class="hs-identifier hs-var">mkTvSubst</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><a href="#local-1627623715"><span class="hs-identifier hs-var">range_tvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623717"><span class="hs-identifier hs-var">tenv'</span></a><span>
</span><a name="line-497"></a><span>
</span><a name="line-498"></a><span class="hs-identifier">niSubstTvSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span>
</span><a name="line-499"></a><span class="hs-comment">-- Apply the non-idempotent substitution to a set of type variables,</span><span>
</span><a name="line-500"></a><span class="hs-comment">-- remembering that the substitution isn't necessarily idempotent</span><span>
</span><a name="line-501"></a><span class="hs-comment">-- This is used in the occurs check, before extending the substitution</span><span>
</span><a name="line-502"></a><a name="niSubstTvSet"><a href="Unify.html#niSubstTvSet"><span class="hs-identifier">niSubstTvSet</span></a></a><span> </span><a name="local-1627623721"><a href="#local-1627623721"><span class="hs-identifier">tsubst</span></a></a><span> </span><a name="local-1627623722"><a href="#local-1627623722"><span class="hs-identifier">tvs</span></a></a><span>
</span><a name="line-503"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#foldVarSet"><span class="hs-identifier hs-var">foldVarSet</span></a><span> </span><span class="hs-special">(</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1627623723"><span class="hs-identifier hs-var">get</span></a><span class="hs-special">)</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span> </span><a href="#local-1627623722"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-504"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-505"></a><span>    </span><a name="local-1627623723"><a href="#local-1627623723"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-1627623724"><a href="#local-1627623724"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-506"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627623725"><a href="#local-1627623725"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1627623721"><span class="hs-identifier hs-var">tsubst</span></a><span> </span><a href="#local-1627623724"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-507"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#niSubstTvSet"><span class="hs-identifier hs-var">niSubstTvSet</span></a><span> </span><a href="#local-1627623721"><span class="hs-identifier hs-var">tsubst</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627623725"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-508"></a><span>
</span><a name="line-509"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-510"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#unitVarSet"><span class="hs-identifier hs-var">unitVarSet</span></a><span> </span><a href="#local-1627623724"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                The workhorse
*                                                                      *
************************************************************************

Note [Specification of unification]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The algorithm implemented here is rather delicate, and we depend on it
to uphold certain properties. This is a summary of these required
properties. Any reference to &quot;flattening&quot; refers to the flattening
algorithm in FamInstEnv (See Note [Flattening] in FamInstEnv), not
the flattening algorithm in the solver.

Notation:
 &#952;,&#966;    substitutions
 &#958;    type-function-free types
 &#964;,&#963;  other types
 &#964;&#9837;   type &#964;, flattened

 &#8801;    eqType

(U1) Soundness.
If (unify &#964;&#8321; &#964;&#8322;) = Unifiable &#952;, then &#952;(&#964;&#8321;) &#8801; &#952;(&#964;&#8322;). &#952; is a most general
unifier for &#964;&#8321; and &#964;&#8322;.

(U2) Completeness.
If (unify &#958;&#8321; &#958;&#8322;) = SurelyApart,
then there exists no substitution &#952; such that &#952;(&#958;&#8321;) &#8801; &#952;(&#958;&#8322;).

These two properties are stated as Property 11 in the &quot;Closed Type Families&quot;
paper (POPL'14). Below, this paper is called [CTF].

(U3) Apartness under substitution.
If (unify &#958; &#964;&#9837;) = SurelyApart, then (unify &#958; &#952;(&#964;)&#9837;) = SurelyApart, for
any &#952;. (Property 12 from [CTF])

(U4) Apart types do not unify.
If (unify &#958; &#964;&#9837;) = SurelyApart, then there exists no &#952; such that
&#952;(&#958;) = &#952;(&#964;). (Property 13 from [CTF])

THEOREM. Completeness w.r.t ~
If (unify &#964;&#8321;&#9837; &#964;&#8322;&#9837;) = SurelyApart, then there exists no proof that (&#964;&#8321; ~ &#964;&#8322;).

PROOF. See appendix of [CTF].


The unification algorithm is used for type family injectivity, as described
in the &quot;Injective Type Families&quot; paper (Haskell'15), called [ITF]. When run
in this mode, it has the following properties.

(I1) If (unify &#963; &#964;) = SurelyApart, then &#963; and &#964; are not unifiable, even
after arbitrary type family reductions. Note that &#963; and &#964; are not flattened
here.

(I2) If (unify &#963; &#964;) = MaybeApart &#952;, and if some
&#966; exists such that &#966;(&#963;) ~ &#966;(&#964;), then &#966; extends &#952;.


Furthermore, the RULES matching algorithm requires this property,
but only when using this algorithm for matching:

(M1) If (match &#963; &#964;) succeeds with &#952;, then all matchable tyvars in &#963;
are bound in &#952;.

Property M1 means that we must extend the substitution with, say
(a &#8614; a) when appropriate during matching.
See also Note [Self-substitution when matching].

(M2) Completeness of matching.
If &#952;(&#963;) = &#964;, then (match &#963; &#964;) = Unifiable &#966;, where &#952; is an extension of &#966;.

Sadly, property M2 and I2 conflict. Consider

type family F1 a b where
  F1 Int    Bool   = Char
  F1 Double String = Char

Consider now two matching problems:

P1. match (F1 a Bool) (F1 Int Bool)
P2. match (F1 a Bool) (F1 Double String)

In case P1, we must find (a &#8614; Int) to satisfy M2.
In case P2, we must /not/ find (a &#8614; Double), in order to satisfy I2. (Note
that the correct mapping for I2 is (a &#8614; Int). There is no way to discover
this, but we musn't map a to anything else!)

We thus must parameterize the algorithm over whether it's being used
for an injectivity check (refrain from looking at non-injective arguments
to type families) or not (do indeed look at those arguments).

(It's all a question of whether or not to include equation (7) from Fig. 2
of [ITF].)

This extra parameter is a bit fiddly, perhaps, but seemingly less so than
having two separate, almost-identical algorithms.

Note [Self-substitution when matching]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
What should happen when we're *matching* (not unifying) a1 with a1? We
should get a substitution [a1 |-&gt; a1]. A successful match should map all
the template variables (except ones that disappear when expanding synonyms).
But when unifying, we don't want to do this, because we'll then fall into
a loop.

This arrangement affects the code in three places:
 - If we're matching a refined template variable, don't recur. Instead, just
   check for equality. That is, if we know [a |-&gt; Maybe a] and are matching
   (a ~? Maybe Int), we want to just fail.

 - Skip the occurs check when matching. This comes up in two places, because
   matching against variables is handled separately from matching against
   full-on types.

Note that this arrangement was provoked by a real failure, where the same
unique ended up in the template as in the target. (It was a rule firing when
compiling Data.List.NonEmpty.)

Note [Matching coercion variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this:

   type family F a

   data G a where
     MkG :: F a ~ Bool =&gt; G a

   type family Foo (x :: G a) :: F a
   type instance Foo MkG = False

We would like that to be accepted. For that to work, we need to introduce
a coercion variable on the left an then use it on the right. Accordingly,
at use sites of Foo, we need to be able to use matching to figure out the
value for the coercion. (See the desugared version:

   axFoo :: [a :: *, c :: F a ~ Bool]. Foo (MkG c) = False |&gt; (sym c)

) We never want this action to happen during *unification* though, when
all bets are off.

-}</span><span>
</span><a name="line-655"></a><span>
</span><a name="line-656"></a><span class="hs-comment">-- See Note [Specification of unification]</span><span>
</span><a name="line-657"></a><span class="hs-identifier">unify_ty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>   </span><span class="hs-comment">-- Types to be unified and a co</span><span>
</span><a name="line-658"></a><span>                                       </span><span class="hs-comment">-- between their kinds</span><span>
</span><a name="line-659"></a><span>                                       </span><span class="hs-comment">-- See Note [Kind coercions in Unify]</span><span>
</span><a name="line-660"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-661"></a><span class="hs-comment">-- Respects newtypes, PredTypes</span><span>
</span><a name="line-662"></a><span>
</span><a name="line-663"></a><a name="unify_ty"><a href="Unify.html#unify_ty"><span class="hs-identifier">unify_ty</span></a></a><span> </span><a name="local-1627623726"><a href="#local-1627623726"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1627623727"><a href="#local-1627623727"><span class="hs-identifier">ty2</span></a></a><span> </span><a name="local-1627623728"><a href="#local-1627623728"><span class="hs-identifier">kco</span></a></a><span>
</span><a name="line-664"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627623729"><a href="#local-1627623729"><span class="hs-identifier">ty1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-1627623726"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#unify_ty"><span class="hs-identifier hs-var">unify_ty</span></a><span> </span><a href="#local-1627623729"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-1627623727"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-1627623728"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-665"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627623730"><a href="#local-1627623730"><span class="hs-identifier">ty2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-1627623727"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#unify_ty"><span class="hs-identifier hs-var">unify_ty</span></a><span> </span><a href="#local-1627623726"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1627623730"><span class="hs-identifier hs-var">ty2'</span></a><span> </span><a href="#local-1627623728"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-666"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-1627623731"><a href="#local-1627623731"><span class="hs-identifier">ty1'</span></a></a><span> </span><a name="local-1627623732"><a href="#local-1627623732"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627623726"><span class="hs-identifier hs-var">ty1</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#unify_ty"><span class="hs-identifier hs-var">unify_ty</span></a><span> </span><a href="#local-1627623731"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-1627623727"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623732"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627623728"><span class="hs-identifier hs-var">kco</span></a><span class="hs-special">)</span><span>
</span><a name="line-667"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-1627623733"><a href="#local-1627623733"><span class="hs-identifier">ty2'</span></a></a><span> </span><a name="local-1627623734"><a href="#local-1627623734"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627623727"><span class="hs-identifier hs-var">ty2</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#unify_ty"><span class="hs-identifier hs-var">unify_ty</span></a><span> </span><a href="#local-1627623726"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1627623733"><span class="hs-identifier hs-var">ty2'</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623728"><span class="hs-identifier hs-var">kco</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-1627623734"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-668"></a><span>
</span><a name="line-669"></a><span class="hs-identifier">unify_ty</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-1627623735"><a href="#local-1627623735"><span class="hs-identifier">tv1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623736"><a href="#local-1627623736"><span class="hs-identifier">ty2</span></a></a><span> </span><a name="local-1627623737"><a href="#local-1627623737"><span class="hs-identifier">kco</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#uVar"><span class="hs-identifier hs-var">uVar</span></a><span> </span><a href="#local-1627623735"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-1627623736"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-1627623737"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-670"></a><span class="hs-identifier">unify_ty</span><span> </span><a name="local-1627623738"><a href="#local-1627623738"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-1627623739"><a href="#local-1627623739"><span class="hs-identifier">tv2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623740"><a href="#local-1627623740"><span class="hs-identifier">kco</span></a></a><span>
</span><a name="line-671"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627623741"><a href="#local-1627623741"><span class="hs-identifier">unif</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#amIUnifying"><span class="hs-identifier hs-var">amIUnifying</span></a><span>
</span><a name="line-672"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627623741"><span class="hs-identifier hs-var">unif</span></a><span>
</span><a name="line-673"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="Unify.html#umSwapRn"><span class="hs-identifier hs-var">umSwapRn</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Unify.html#uVar"><span class="hs-identifier hs-var">uVar</span></a><span> </span><a href="#local-1627623739"><span class="hs-identifier hs-var">tv2</span></a><span> </span><a href="#local-1627623738"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-1627623740"><span class="hs-identifier hs-var">kco</span></a><span class="hs-special">)</span><span>
</span><a name="line-674"></a><span>         </span><span class="hs-keyword">else</span><span> </span><a href="Unify.html#surelyApart"><span class="hs-identifier hs-var">surelyApart</span></a><span> </span><span class="hs-special">}</span><span>  </span><span class="hs-comment">-- non-tv on left; tv on right: can't match.</span><span>
</span><a name="line-675"></a><span>
</span><a name="line-676"></a><span class="hs-identifier">unify_ty</span><span> </span><a name="local-1627623742"><a href="#local-1627623742"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1627623743"><a href="#local-1627623743"><span class="hs-identifier">ty2</span></a></a><span> </span><a name="local-1627623744"><a href="#local-1627623744"><span class="hs-identifier">_kco</span></a></a><span>
</span><a name="line-677"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623745"><a href="#local-1627623745"><span class="hs-identifier">tc1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627623746"><a href="#local-1627623746"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-1627623742"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-678"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623747"><a href="#local-1627623747"><span class="hs-identifier">tc2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627623748"><a href="#local-1627623748"><span class="hs-identifier">tys2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-1627623743"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-679"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627623745"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627623747"><span class="hs-identifier hs-var">tc2</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-special">(</span><a href="Kind.html#isStarKind"><span class="hs-identifier hs-var">isStarKind</span></a><span> </span><a href="#local-1627623742"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Kind.html#isStarKind"><span class="hs-identifier hs-var">isStarKind</span></a><span> </span><a href="#local-1627623743"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-680"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="TyCon.html#isInjectiveTyCon"><span class="hs-identifier hs-var">isInjectiveTyCon</span></a><span> </span><a href="#local-1627623745"><span class="hs-identifier hs-var">tc1</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>
</span><a name="line-681"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="Unify.html#unify_tys"><span class="hs-identifier hs-var">unify_tys</span></a><span> </span><a href="#local-1627623746"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="#local-1627623748"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-682"></a><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627623749"><a href="#local-1627623749"><span class="hs-identifier">inj</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a><span> </span><a href="#local-1627623745"><span class="hs-identifier hs-var">tc1</span></a><span>
</span><a name="line-683"></a><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TyCon.html#familyTyConInjectivityInfo"><span class="hs-identifier hs-var">familyTyConInjectivityInfo</span></a><span> </span><a href="#local-1627623745"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-684"></a><span>                               </span><a href="TyCon.html#NotInjective"><span class="hs-identifier hs-var">NotInjective</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-685"></a><span>                               </span><a href="TyCon.html#Injective"><span class="hs-identifier hs-var">Injective</span></a><span> </span><a name="local-1627623754"><a href="#local-1627623754"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627623754"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-686"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-687"></a><span>                           </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-688"></a><span>
</span><a name="line-689"></a><span>                       </span><span class="hs-special">(</span><a name="local-1627623750"><a href="#local-1627623750"><span class="hs-identifier">inj_tys1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627623751"><a href="#local-1627623751"><span class="hs-identifier">noninj_tys1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#partitionByList"><span class="hs-identifier hs-var">partitionByList</span></a><span> </span><a href="#local-1627623749"><span class="hs-identifier hs-var">inj</span></a><span> </span><a href="#local-1627623746"><span class="hs-identifier hs-var">tys1</span></a><span>
</span><a name="line-690"></a><span>                       </span><span class="hs-special">(</span><a name="local-1627623752"><a href="#local-1627623752"><span class="hs-identifier">inj_tys2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627623753"><a href="#local-1627623753"><span class="hs-identifier">noninj_tys2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#partitionByList"><span class="hs-identifier hs-var">partitionByList</span></a><span> </span><a href="#local-1627623749"><span class="hs-identifier hs-var">inj</span></a><span> </span><a href="#local-1627623748"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-691"></a><span>
</span><a name="line-692"></a><span>                 </span><span class="hs-special">;</span><span> </span><a href="Unify.html#unify_tys"><span class="hs-identifier hs-var">unify_tys</span></a><span> </span><a href="#local-1627623750"><span class="hs-identifier hs-var">inj_tys1</span></a><span> </span><a href="#local-1627623752"><span class="hs-identifier hs-var">inj_tys2</span></a><span>
</span><a name="line-693"></a><span>                 </span><span class="hs-special">;</span><span> </span><a name="local-1627623755"><a href="#local-1627623755"><span class="hs-identifier">inj_tf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#checkingInjectivity"><span class="hs-identifier hs-var">checkingInjectivity</span></a><span>
</span><a name="line-694"></a><span>                 </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><a href="#local-1627623755"><span class="hs-identifier hs-var">inj_tf</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-comment">-- See (end of) Note [Specification of unification]</span><span>
</span><a name="line-695"></a><span>                   </span><a href="Unify.html#don%27tBeSoSure"><span class="hs-identifier hs-var">don'tBeSoSure</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Unify.html#unify_tys"><span class="hs-identifier hs-var">unify_tys</span></a><span> </span><a href="#local-1627623751"><span class="hs-identifier hs-var">noninj_tys1</span></a><span> </span><a href="#local-1627623753"><span class="hs-identifier hs-var">noninj_tys2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-696"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- tc1 /= tc2</span><span>
</span><a name="line-697"></a><span>         </span><span class="hs-keyword">if</span><span> </span><a href="TyCon.html#isGenerativeTyCon"><span class="hs-identifier hs-var">isGenerativeTyCon</span></a><span> </span><a href="#local-1627623745"><span class="hs-identifier hs-var">tc1</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="TyCon.html#isGenerativeTyCon"><span class="hs-identifier hs-var">isGenerativeTyCon</span></a><span> </span><a href="#local-1627623747"><span class="hs-identifier hs-var">tc2</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>
</span><a name="line-698"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="Unify.html#surelyApart"><span class="hs-identifier hs-var">surelyApart</span></a><span>
</span><a name="line-699"></a><span>         </span><span class="hs-keyword">else</span><span> </span><a href="Unify.html#maybeApart"><span class="hs-identifier hs-var">maybeApart</span></a><span>
</span><a name="line-700"></a><span>
</span><a name="line-701"></a><span>        </span><span class="hs-comment">-- Applications need a bit of care!</span><span>
</span><a name="line-702"></a><span>        </span><span class="hs-comment">-- They can match FunTy and TyConApp, so use splitAppTy_maybe</span><span>
</span><a name="line-703"></a><span>        </span><span class="hs-comment">-- NB: we've already dealt with type variables,</span><span>
</span><a name="line-704"></a><span>        </span><span class="hs-comment">-- so if one type is an App the other one jolly well better be too</span><span>
</span><a name="line-705"></a><span class="hs-identifier">unify_ty</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-1627623756"><a href="#local-1627623756"><span class="hs-identifier">ty1a</span></a></a><span> </span><a name="local-1627623757"><a href="#local-1627623757"><span class="hs-identifier">ty1b</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623758"><a href="#local-1627623758"><span class="hs-identifier">ty2</span></a></a><span> </span><a name="local-1627623759"><a href="#local-1627623759"><span class="hs-identifier">_kco</span></a></a><span>
</span><a name="line-706"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623760"><a href="#local-1627623760"><span class="hs-identifier">ty2a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627623761"><a href="#local-1627623761"><span class="hs-identifier">ty2b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcRepSplitAppTy_maybe"><span class="hs-identifier hs-var">tcRepSplitAppTy_maybe</span></a><span> </span><a href="#local-1627623758"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-707"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#unify_ty_app"><span class="hs-identifier hs-var">unify_ty_app</span></a><span> </span><a href="#local-1627623756"><span class="hs-identifier hs-var">ty1a</span></a><span> </span><a href="#local-1627623757"><span class="hs-identifier hs-var">ty1b</span></a><span> </span><a href="#local-1627623760"><span class="hs-identifier hs-var">ty2a</span></a><span> </span><a href="#local-1627623761"><span class="hs-identifier hs-var">ty2b</span></a><span>
</span><a name="line-708"></a><span>
</span><a name="line-709"></a><span class="hs-identifier">unify_ty</span><span> </span><a name="local-1627623762"><a href="#local-1627623762"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-1627623763"><a href="#local-1627623763"><span class="hs-identifier">ty2a</span></a></a><span> </span><a name="local-1627623764"><a href="#local-1627623764"><span class="hs-identifier">ty2b</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623765"><a href="#local-1627623765"><span class="hs-identifier">_kco</span></a></a><span>
</span><a name="line-710"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623766"><a href="#local-1627623766"><span class="hs-identifier">ty1a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627623767"><a href="#local-1627623767"><span class="hs-identifier">ty1b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcRepSplitAppTy_maybe"><span class="hs-identifier hs-var">tcRepSplitAppTy_maybe</span></a><span> </span><a href="#local-1627623762"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-711"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#unify_ty_app"><span class="hs-identifier hs-var">unify_ty_app</span></a><span> </span><a href="#local-1627623766"><span class="hs-identifier hs-var">ty1a</span></a><span> </span><a href="#local-1627623767"><span class="hs-identifier hs-var">ty1b</span></a><span> </span><a href="#local-1627623763"><span class="hs-identifier hs-var">ty2a</span></a><span> </span><a href="#local-1627623764"><span class="hs-identifier hs-var">ty2b</span></a><span>
</span><a name="line-712"></a><span>
</span><a name="line-713"></a><span class="hs-identifier">unify_ty</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-1627623768"><a href="#local-1627623768"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-1627623769"><a href="#local-1627623769"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623770"><a href="#local-1627623770"><span class="hs-identifier">_kco</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627623768"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627623769"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-714"></a><span>
</span><a name="line-715"></a><span class="hs-identifier">unify_ty</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-1627623771"><a href="#local-1627623771"><span class="hs-identifier">tv1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1627623772"><a href="#local-1627623772"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-1627623773"><a href="#local-1627623773"><span class="hs-identifier">tv2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1627623774"><a href="#local-1627623774"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623775"><a href="#local-1627623775"><span class="hs-identifier">kco</span></a></a><span>
</span><a name="line-716"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="Unify.html#unify_ty"><span class="hs-identifier hs-var">unify_ty</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1627623771"><span class="hs-identifier hs-var">tv1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1627623773"><span class="hs-identifier hs-var">tv2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-717"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="Unify.html#umRnBndr2"><span class="hs-identifier hs-var">umRnBndr2</span></a><span> </span><a href="#local-1627623771"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-1627623773"><span class="hs-identifier hs-var">tv2</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Unify.html#unify_ty"><span class="hs-identifier hs-var">unify_ty</span></a><span> </span><a href="#local-1627623772"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1627623774"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-1627623775"><span class="hs-identifier hs-var">kco</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-718"></a><span>
</span><a name="line-719"></a><span class="hs-comment">-- See Note [Matching coercion variables]</span><span>
</span><a name="line-720"></a><span class="hs-identifier">unify_ty</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-1627623776"><a href="#local-1627623776"><span class="hs-identifier">co1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-1627623777"><a href="#local-1627623777"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623778"><a href="#local-1627623778"><span class="hs-identifier">kco</span></a></a><span>
</span><a name="line-721"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627623779"><a href="#local-1627623779"><span class="hs-identifier">unif</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#amIUnifying"><span class="hs-identifier hs-var">amIUnifying</span></a><span>
</span><a name="line-722"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1627623780"><a href="#local-1627623780"><span class="hs-identifier">c_subst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#getCvSubstEnv"><span class="hs-identifier hs-var">getCvSubstEnv</span></a><span>
</span><a name="line-723"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627623776"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-724"></a><span>           </span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-1627623781"><a href="#local-1627623781"><span class="hs-identifier">cv</span></a></a><span>
</span><a name="line-725"></a><span>             </span><span class="hs-glyph">|</span><span>  </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1627623779"><span class="hs-identifier hs-var">unif</span></a><span>
</span><a name="line-726"></a><span>             </span><span class="hs-special">,</span><span>  </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-1627623781"><span class="hs-identifier hs-var">cv</span></a><span> </span><span class="hs-special">`</span><a href="VarEnv.html#elemVarEnv"><span class="hs-identifier hs-var">elemVarEnv</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627623780"><span class="hs-identifier hs-var">c_subst</span></a><span class="hs-special">)</span><span>
</span><a name="line-727"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627623782"><a href="#local-1627623782"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#tvBindFlagL"><span class="hs-identifier hs-var">tvBindFlagL</span></a><span> </span><a href="#local-1627623781"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-728"></a><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627623782"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a><span>
</span><a name="line-729"></a><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="Unify.html#checkRnEnvRCo"><span class="hs-identifier hs-var">checkRnEnvRCo</span></a><span> </span><a href="#local-1627623777"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-730"></a><span>                               </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627623783"><a href="#local-1627623783"><span class="hs-identifier">co_l</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627623784"><a href="#local-1627623784"><span class="hs-identifier">co_r</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#decomposeCo"><span class="hs-identifier hs-var">decomposeCo</span></a><span> </span><span class="hs-number">4</span><span> </span><a href="#local-1627623778"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-731"></a><span>                                  </span><span class="hs-comment">-- cv :: t1 ~ t2</span><span>
</span><a name="line-732"></a><span>                                  </span><span class="hs-comment">-- co2 :: s1 ~ s2</span><span>
</span><a name="line-733"></a><span>                                  </span><span class="hs-comment">-- co_l :: t1 ~ s1</span><span>
</span><a name="line-734"></a><span>                                  </span><span class="hs-comment">-- co_r :: t2 ~ s2</span><span>
</span><a name="line-735"></a><span>                               </span><span class="hs-special">;</span><span> </span><a href="Unify.html#extendCvEnv"><span class="hs-identifier hs-var">extendCvEnv</span></a><span> </span><a href="#local-1627623781"><span class="hs-identifier hs-var">cv</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623783"><span class="hs-identifier hs-var">co_l</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span>
</span><a name="line-736"></a><span>                                                 </span><a href="#local-1627623777"><span class="hs-identifier hs-var">co2</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span>
</span><a name="line-737"></a><span>                                                 </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-1627623784"><span class="hs-identifier hs-var">co_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-738"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-739"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-740"></a><span>
</span><a name="line-741"></a><span class="hs-identifier">unify_ty</span><span> </span><a name="local-1627623785"><a href="#local-1627623785"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-742"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623786"><a href="#local-1627623786"><span class="hs-identifier">tc1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-1627623785"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-743"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#isGenerativeTyCon"><span class="hs-identifier hs-var">isGenerativeTyCon</span></a><span> </span><a href="#local-1627623786"><span class="hs-identifier hs-var">tc1</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">)</span><span>
</span><a name="line-744"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#maybeApart"><span class="hs-identifier hs-var">maybeApart</span></a><span>
</span><a name="line-745"></a><span>
</span><a name="line-746"></a><span class="hs-identifier">unify_ty</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627623787"><a href="#local-1627623787"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-747"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623788"><a href="#local-1627623788"><span class="hs-identifier">tc2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-1627623787"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-748"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#isGenerativeTyCon"><span class="hs-identifier hs-var">isGenerativeTyCon</span></a><span> </span><a href="#local-1627623788"><span class="hs-identifier hs-var">tc2</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">)</span><span>
</span><a name="line-749"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627623789"><a href="#local-1627623789"><span class="hs-identifier">unif</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#amIUnifying"><span class="hs-identifier hs-var">amIUnifying</span></a><span>
</span><a name="line-750"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627623789"><span class="hs-identifier hs-var">unif</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Unify.html#maybeApart"><span class="hs-identifier hs-var">maybeApart</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Unify.html#surelyApart"><span class="hs-identifier hs-var">surelyApart</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-751"></a><span>
</span><a name="line-752"></a><span class="hs-identifier">unify_ty</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#surelyApart"><span class="hs-identifier hs-var">surelyApart</span></a><span>
</span><a name="line-753"></a><span>
</span><a name="line-754"></a><span class="hs-identifier">unify_ty_app</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-755"></a><a name="unify_ty_app"><a href="Unify.html#unify_ty_app"><span class="hs-identifier">unify_ty_app</span></a></a><span> </span><a name="local-1627623790"><a href="#local-1627623790"><span class="hs-identifier">ty1a</span></a></a><span> </span><a name="local-1627623791"><a href="#local-1627623791"><span class="hs-identifier">ty1b</span></a></a><span> </span><a name="local-1627623792"><a href="#local-1627623792"><span class="hs-identifier">ty2a</span></a></a><span> </span><a name="local-1627623793"><a href="#local-1627623793"><span class="hs-identifier">ty2b</span></a></a><span>
</span><a name="line-756"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- TODO (RAE): Remove this exponential behavior.</span><span>
</span><a name="line-757"></a><span>         </span><span class="hs-keyword">let</span><span> </span><a name="local-1627623794"><a href="#local-1627623794"><span class="hs-identifier">ki1a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1627623790"><span class="hs-identifier hs-var">ty1a</span></a><span>
</span><a name="line-758"></a><span>             </span><a name="local-1627623795"><a href="#local-1627623795"><span class="hs-identifier">ki2a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1627623792"><span class="hs-identifier hs-var">ty2a</span></a><span>
</span><a name="line-759"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="Unify.html#unify_ty"><span class="hs-identifier hs-var">unify_ty</span></a><span> </span><a href="#local-1627623794"><span class="hs-identifier hs-var">ki1a</span></a><span> </span><a href="#local-1627623795"><span class="hs-identifier hs-var">ki2a</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-760"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627623796"><a href="#local-1627623796"><span class="hs-identifier">kind_co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="#local-1627623794"><span class="hs-identifier hs-var">ki1a</span></a><span>
</span><a name="line-761"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="Unify.html#unify_ty"><span class="hs-identifier hs-var">unify_ty</span></a><span> </span><a href="#local-1627623790"><span class="hs-identifier hs-var">ty1a</span></a><span> </span><a href="#local-1627623792"><span class="hs-identifier hs-var">ty2a</span></a><span> </span><a href="#local-1627623796"><span class="hs-identifier hs-var">kind_co</span></a><span>
</span><a name="line-762"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="Unify.html#unify_ty"><span class="hs-identifier hs-var">unify_ty</span></a><span> </span><a href="#local-1627623791"><span class="hs-identifier hs-var">ty1b</span></a><span> </span><a href="#local-1627623793"><span class="hs-identifier hs-var">ty2b</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-1627623796"><span class="hs-identifier hs-var">kind_co</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-763"></a><span>
</span><a name="line-764"></a><span class="hs-identifier">unify_tys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-765"></a><a name="unify_tys"><a href="Unify.html#unify_tys"><span class="hs-identifier">unify_tys</span></a></a><span> </span><a name="local-1627623797"><a href="#local-1627623797"><span class="hs-identifier">orig_xs</span></a></a><span> </span><a name="local-1627623798"><a href="#local-1627623798"><span class="hs-identifier">orig_ys</span></a></a><span>
</span><a name="line-766"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623799"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627623797"><span class="hs-identifier hs-var">orig_xs</span></a><span> </span><a href="#local-1627623798"><span class="hs-identifier hs-var">orig_ys</span></a><span>
</span><a name="line-767"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-768"></a><span>    </span><a name="local-1627623799"><a href="#local-1627623799"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-769"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-1627623800"><a href="#local-1627623800"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-1627623801"><a href="#local-1627623801"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627623802"><a href="#local-1627623802"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-1627623803"><a href="#local-1627623803"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-770"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="Unify.html#unify_ty"><span class="hs-identifier hs-var">unify_ty</span></a><span> </span><a href="#local-1627623800"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627623802"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1627623800"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-771"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-1627623799"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627623801"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-1627623803"><span class="hs-identifier hs-var">ys</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-772"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#maybeApart"><span class="hs-identifier hs-var">maybeApart</span></a><span>  </span><span class="hs-comment">-- See Note [Lists of different lengths are MaybeApart]</span><span>
</span><a name="line-773"></a><span>
</span><a name="line-774"></a><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-775"></a><span class="hs-identifier">uVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>           </span><span class="hs-comment">-- Variable to be unified</span><span>
</span><a name="line-776"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>            </span><span class="hs-comment">-- with this Type</span><span>
</span><a name="line-777"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>        </span><span class="hs-comment">-- :: kind tv ~N kind ty</span><span>
</span><a name="line-778"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-779"></a><span>
</span><a name="line-780"></a><a name="uVar"><a href="Unify.html#uVar"><span class="hs-identifier">uVar</span></a></a><span> </span><a name="local-1627623804"><a href="#local-1627623804"><span class="hs-identifier">tv1</span></a></a><span> </span><a name="local-1627623805"><a href="#local-1627623805"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1627623806"><a href="#local-1627623806"><span class="hs-identifier">kco</span></a></a><span>
</span><a name="line-781"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Check to see whether tv1 is refined by the substitution</span><span>
</span><a name="line-782"></a><span>        </span><a name="local-1627623807"><a href="#local-1627623807"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#getTvSubstEnv"><span class="hs-identifier hs-var">getTvSubstEnv</span></a><span>
</span><a name="line-783"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1627623807"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623804"><span class="hs-identifier hs-var">tv1</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-784"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627623808"><a href="#local-1627623808"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627623809"><a href="#local-1627623809"><span class="hs-identifier">unif</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#amIUnifying"><span class="hs-identifier hs-var">amIUnifying</span></a><span>
</span><a name="line-785"></a><span>                         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627623809"><span class="hs-identifier hs-var">unif</span></a><span>
</span><a name="line-786"></a><span>                           </span><span class="hs-keyword">then</span><span> </span><a href="Unify.html#unify_ty"><span class="hs-identifier hs-var">unify_ty</span></a><span> </span><a href="#local-1627623808"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-1627623805"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1627623806"><span class="hs-identifier hs-var">kco</span></a><span>   </span><span class="hs-comment">-- Yes, call back into unify</span><span>
</span><a name="line-787"></a><span>                           </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- when *matching*, we don't want to just recur here.</span><span>
</span><a name="line-788"></a><span>                                </span><span class="hs-comment">-- this is because the range of the subst is the target</span><span>
</span><a name="line-789"></a><span>                                </span><span class="hs-comment">-- type, not the template type. So, just check for</span><span>
</span><a name="line-790"></a><span>                                </span><span class="hs-comment">-- normal type equality.</span><span>
</span><a name="line-791"></a><span>                                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1627623808"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627623806"><span class="hs-identifier hs-var">kco</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627623805"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-792"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#uUnrefined"><span class="hs-identifier hs-var">uUnrefined</span></a><span> </span><a href="#local-1627623804"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-1627623805"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1627623805"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1627623806"><span class="hs-identifier hs-var">kco</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- No, continue</span><span>
</span><a name="line-793"></a><span>
</span><a name="line-794"></a><span class="hs-identifier">uUnrefined</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>             </span><span class="hs-comment">-- variable to be unified</span><span>
</span><a name="line-795"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>              </span><span class="hs-comment">-- with this Type</span><span>
</span><a name="line-796"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>              </span><span class="hs-comment">-- (version w/ expanded synonyms)</span><span>
</span><a name="line-797"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>          </span><span class="hs-comment">-- :: kind tv ~N kind ty</span><span>
</span><a name="line-798"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-799"></a><span>
</span><a name="line-800"></a><span class="hs-comment">-- We know that tv1 isn't refined</span><span>
</span><a name="line-801"></a><span>
</span><a name="line-802"></a><a name="uUnrefined"><a href="Unify.html#uUnrefined"><span class="hs-identifier">uUnrefined</span></a></a><span> </span><a name="local-1627623810"><a href="#local-1627623810"><span class="hs-identifier">tv1</span></a></a><span> </span><a name="local-1627623811"><a href="#local-1627623811"><span class="hs-identifier">ty2</span></a></a><span> </span><a name="local-1627623812"><a href="#local-1627623812"><span class="hs-identifier">ty2'</span></a></a><span> </span><a name="local-1627623813"><a href="#local-1627623813"><span class="hs-identifier">kco</span></a></a><span>
</span><a name="line-803"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627623814"><a href="#local-1627623814"><span class="hs-identifier">ty2''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-1627623812"><span class="hs-identifier hs-var">ty2'</span></a><span>
</span><a name="line-804"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#uUnrefined"><span class="hs-identifier hs-var">uUnrefined</span></a><span> </span><a href="#local-1627623810"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-1627623811"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-1627623814"><span class="hs-identifier hs-var">ty2''</span></a><span> </span><a href="#local-1627623813"><span class="hs-identifier hs-var">kco</span></a><span>    </span><span class="hs-comment">-- Unwrap synonyms</span><span>
</span><a name="line-805"></a><span>                </span><span class="hs-comment">-- This is essential, in case we have</span><span>
</span><a name="line-806"></a><span>                </span><span class="hs-comment">--      type Foo a = a</span><span>
</span><a name="line-807"></a><span>                </span><span class="hs-comment">-- and then unify a ~ Foo a</span><span>
</span><a name="line-808"></a><span>
</span><a name="line-809"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-1627623815"><a href="#local-1627623815"><span class="hs-identifier">tv2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627623812"><span class="hs-identifier hs-var">ty2'</span></a><span>
</span><a name="line-810"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627623816"><a href="#local-1627623816"><span class="hs-identifier">tv1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#umRnOccL"><span class="hs-identifier hs-var">umRnOccL</span></a><span> </span><a href="#local-1627623810"><span class="hs-identifier hs-var">tv1</span></a><span>
</span><a name="line-811"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1627623817"><a href="#local-1627623817"><span class="hs-identifier">tv2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#umRnOccR"><span class="hs-identifier hs-var">umRnOccR</span></a><span> </span><a href="#local-1627623815"><span class="hs-identifier hs-var">tv2</span></a><span>
</span><a name="line-812"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1627623818"><a href="#local-1627623818"><span class="hs-identifier">unif</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#amIUnifying"><span class="hs-identifier hs-var">amIUnifying</span></a><span>
</span><a name="line-813"></a><span>           </span><span class="hs-comment">-- See Note [Self-substitution when matching]</span><span>
</span><a name="line-814"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623816"><span class="hs-identifier hs-var">tv1'</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1627623817"><span class="hs-identifier hs-var">tv2'</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-1627623818"><span class="hs-identifier hs-var">unif</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-815"></a><span>       </span><span class="hs-special">{</span><span> </span><a name="local-1627623819"><a href="#local-1627623819"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#getTvSubstEnv"><span class="hs-identifier hs-var">getTvSubstEnv</span></a><span>
</span><a name="line-816"></a><span>          </span><span class="hs-comment">-- Check to see whether tv2 is refined</span><span>
</span><a name="line-817"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1627623819"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623815"><span class="hs-identifier hs-var">tv2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-818"></a><span>         </span><span class="hs-special">{</span><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627623820"><a href="#local-1627623820"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627623818"><span class="hs-identifier hs-var">unif</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#uUnrefined"><span class="hs-identifier hs-var">uUnrefined</span></a><span> </span><a href="#local-1627623810"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-1627623820"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-1627623820"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-1627623813"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-819"></a><span>         </span><span class="hs-special">;</span><span>  </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-820"></a><span>       </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">-- So both are unrefined</span><span>
</span><a name="line-821"></a><span>
</span><a name="line-822"></a><span>           </span><span class="hs-comment">-- And then bind one or the other,</span><span>
</span><a name="line-823"></a><span>           </span><span class="hs-comment">-- depending on which is bindable</span><span>
</span><a name="line-824"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1627623821"><a href="#local-1627623821"><span class="hs-identifier">b1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#tvBindFlagL"><span class="hs-identifier hs-var">tvBindFlagL</span></a><span> </span><a href="#local-1627623810"><span class="hs-identifier hs-var">tv1</span></a><span>
</span><a name="line-825"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1627623822"><a href="#local-1627623822"><span class="hs-identifier">b2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#tvBindFlagR"><span class="hs-identifier hs-var">tvBindFlagR</span></a><span> </span><a href="#local-1627623815"><span class="hs-identifier hs-var">tv2</span></a><span>
</span><a name="line-826"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627623823"><a href="#local-1627623823"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-1627623810"><span class="hs-identifier hs-var">tv1</span></a><span>
</span><a name="line-827"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-1627623821"><span class="hs-identifier hs-var">b1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627623822"><span class="hs-identifier hs-var">b2</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-828"></a><span>           </span><span class="hs-special">(</span><a href="Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="Unify.html#checkRnEnvR"><span class="hs-identifier hs-var">checkRnEnvR</span></a><span> </span><a href="#local-1627623811"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-comment">-- make sure ty2 is not a local</span><span>
</span><a name="line-829"></a><span>                                    </span><span class="hs-special">;</span><span> </span><a href="Unify.html#extendTvEnv"><span class="hs-identifier hs-var">extendTvEnv</span></a><span> </span><a href="#local-1627623810"><span class="hs-identifier hs-var">tv1</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623811"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">`</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-1627623813"><span class="hs-identifier hs-var">kco</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-830"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627623818"><span class="hs-identifier hs-var">unif</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="Unify.html#checkRnEnvL"><span class="hs-identifier hs-var">checkRnEnvL</span></a><span> </span><a href="#local-1627623823"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-comment">-- ditto for ty1</span><span>
</span><a name="line-831"></a><span>                                    </span><span class="hs-special">;</span><span> </span><a href="Unify.html#extendTvEnv"><span class="hs-identifier hs-var">extendTvEnv</span></a><span> </span><a href="#local-1627623815"><span class="hs-identifier hs-var">tv2</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623823"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627623813"><span class="hs-identifier hs-var">kco</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-832"></a><span>
</span><a name="line-833"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627623816"><span class="hs-identifier hs-var">tv1'</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627623817"><span class="hs-identifier hs-var">tv2'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-834"></a><span>             </span><span class="hs-comment">-- How could this happen? If we're only matching and if</span><span>
</span><a name="line-835"></a><span>             </span><span class="hs-comment">-- we're comparing forall-bound variables.</span><span>
</span><a name="line-836"></a><span>
</span><a name="line-837"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#maybeApart"><span class="hs-identifier hs-var">maybeApart</span></a><span> </span><span class="hs-comment">-- See Note [Unification with skolems]</span><span>
</span><a name="line-838"></a><span>  </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-839"></a><span>
</span><a name="line-840"></a><span class="hs-identifier">uUnrefined</span><span> </span><a name="local-1627623824"><a href="#local-1627623824"><span class="hs-identifier">tv1</span></a></a><span> </span><a name="local-1627623825"><a href="#local-1627623825"><span class="hs-identifier">ty2</span></a></a><span> </span><a name="local-1627623826"><a href="#local-1627623826"><span class="hs-identifier">ty2'</span></a></a><span> </span><a name="local-1627623827"><a href="#local-1627623827"><span class="hs-identifier">kco</span></a></a><span> </span><span class="hs-comment">-- ty2 is not a type variable</span><span>
</span><a name="line-841"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627623828"><a href="#local-1627623828"><span class="hs-identifier">occurs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#elemNiSubstSet"><span class="hs-identifier hs-var">elemNiSubstSet</span></a><span> </span><a href="#local-1627623824"><span class="hs-identifier hs-var">tv1</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627623826"><span class="hs-identifier hs-var">ty2'</span></a><span class="hs-special">)</span><span>
</span><a name="line-842"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1627623829"><a href="#local-1627623829"><span class="hs-identifier">unif</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#amIUnifying"><span class="hs-identifier hs-var">amIUnifying</span></a><span>
</span><a name="line-843"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627623829"><span class="hs-identifier hs-var">unif</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-1627623828"><span class="hs-identifier hs-var">occurs</span></a><span>  </span><span class="hs-comment">-- See Note [Self-substitution when matching]</span><span>
</span><a name="line-844"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="Unify.html#maybeApart"><span class="hs-identifier hs-var">maybeApart</span></a><span>       </span><span class="hs-comment">-- Occurs check, see Note [Fine-grained unification]</span><span>
</span><a name="line-845"></a><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="Unify.html#bindTv"><span class="hs-identifier hs-var">bindTv</span></a><span> </span><a href="#local-1627623824"><span class="hs-identifier hs-var">tv1</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623825"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">`</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-1627623827"><span class="hs-identifier hs-var">kco</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-846"></a><span>            </span><span class="hs-comment">-- Bind tyvar to the synonym if poss</span><span>
</span><a name="line-847"></a><span>
</span><a name="line-848"></a><span class="hs-identifier">elemNiSubstSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-849"></a><a name="elemNiSubstSet"><a href="Unify.html#elemNiSubstSet"><span class="hs-identifier">elemNiSubstSet</span></a></a><span> </span><a name="local-1627623830"><a href="#local-1627623830"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-1627623831"><a href="#local-1627623831"><span class="hs-identifier">set</span></a></a><span>
</span><a name="line-850"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627623832"><a href="#local-1627623832"><span class="hs-identifier">tsubst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#getTvSubstEnv"><span class="hs-identifier hs-var">getTvSubstEnv</span></a><span>
</span><a name="line-851"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1627623830"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="Unify.html#niSubstTvSet"><span class="hs-identifier hs-var">niSubstTvSet</span></a><span> </span><a href="#local-1627623832"><span class="hs-identifier hs-var">tsubst</span></a><span> </span><a href="#local-1627623831"><span class="hs-identifier hs-var">set</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-852"></a><span>
</span><a name="line-853"></a><span class="hs-identifier">bindTv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-854"></a><a name="bindTv"><a href="Unify.html#bindTv"><span class="hs-identifier">bindTv</span></a></a><span> </span><a name="local-1627623833"><a href="#local-1627623833"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1627623834"><a href="#local-1627623834"><span class="hs-identifier">ty</span></a></a><span>    </span><span class="hs-comment">-- ty is not a variable</span><span>
</span><a name="line-855"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="Unify.html#checkRnEnvR"><span class="hs-identifier hs-var">checkRnEnvR</span></a><span> </span><a href="#local-1627623834"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-comment">-- make sure ty mentions no local variables</span><span>
</span><a name="line-856"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-1627623835"><a href="#local-1627623835"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#tvBindFlagL"><span class="hs-identifier hs-var">tvBindFlagL</span></a><span> </span><a href="#local-1627623833"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-857"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627623835"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-858"></a><span>            </span><a href="Unify.html#Skolem"><span class="hs-identifier hs-var">Skolem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#maybeApart"><span class="hs-identifier hs-var">maybeApart</span></a><span>  </span><span class="hs-comment">-- See Note [Unification with skolems]</span><span>
</span><a name="line-859"></a><span>            </span><a href="Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#extendTvEnv"><span class="hs-identifier hs-var">extendTvEnv</span></a><span> </span><a href="#local-1627623833"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1627623834"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-860"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-861"></a><span>
</span><a name="line-862"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                Binding decisions
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-869"></a><span>
</span><a name="line-870"></a><span class="hs-keyword">data</span><span> </span><a name="BindFlag"><a href="Unify.html#BindFlag"><span class="hs-identifier">BindFlag</span></a></a><span>
</span><a name="line-871"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="BindMe"><a href="Unify.html#BindMe"><span class="hs-identifier">BindMe</span></a></a><span>      </span><span class="hs-comment">-- A regular type variable</span><span>
</span><a name="line-872"></a><span>
</span><a name="line-873"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Skolem"><a href="Unify.html#Skolem"><span class="hs-identifier">Skolem</span></a></a><span>      </span><span class="hs-comment">-- This type variable is a skolem constant</span><span>
</span><a name="line-874"></a><span>                </span><span class="hs-comment">-- Don't bind it; it only matches itself</span><span>
</span><a name="line-875"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Eq</span><span>
</span><a name="line-876"></a><span>
</span><a name="line-877"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Unification monad
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-884"></a><span>
</span><a name="line-885"></a><span class="hs-keyword">data</span><span> </span><a name="UMEnv"><a href="Unify.html#UMEnv"><span class="hs-identifier">UMEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="UMEnv"><a href="Unify.html#UMEnv"><span class="hs-identifier">UMEnv</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="Unify.html#um_bind_fun"><span class="hs-identifier">um_bind_fun</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#BindFlag"><span class="hs-identifier hs-type">BindFlag</span></a><span>
</span><a name="line-886"></a><span>                       </span><span class="hs-comment">-- the user-supplied BindFlag function</span><span>
</span><a name="line-887"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="Unify.html#um_unif"><span class="hs-identifier">um_unif</span></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>   </span><span class="hs-comment">-- unification (True) or matching?</span><span>
</span><a name="line-888"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="Unify.html#um_inj_tf"><span class="hs-identifier">um_inj_tf</span></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>   </span><span class="hs-comment">-- checking for injectivity?</span><span>
</span><a name="line-889"></a><span>                             </span><span class="hs-comment">-- See (end of) Note [Specification of unification]</span><span>
</span><a name="line-890"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="Unify.html#um_rn_env"><span class="hs-identifier">um_rn_env</span></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-891"></a><span>
</span><a name="line-892"></a><span class="hs-keyword">data</span><span> </span><a name="UMState"><a href="Unify.html#UMState"><span class="hs-identifier">UMState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="UMState"><a href="Unify.html#UMState"><span class="hs-identifier">UMState</span></a></a><span>
</span><a name="line-893"></a><span>                   </span><span class="hs-special">{</span><span> </span><a href="Unify.html#um_tv_env"><span class="hs-identifier">um_tv_env</span></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span>
</span><a name="line-894"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="Unify.html#um_cv_env"><span class="hs-identifier">um_cv_env</span></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-895"></a><span>
</span><a name="line-896"></a><span class="hs-keyword">newtype</span><span> </span><a name="UM"><a href="Unify.html#UM"><span class="hs-identifier">UM</span></a></a><span> </span><a name="local-1627623638"><a href="#local-1627623638"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="UM"><a href="Unify.html#UM"><span class="hs-identifier">UM</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="Unify.html#unUM"><span class="hs-identifier">unUM</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#UMEnv"><span class="hs-identifier hs-type">UMEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UMState"><span class="hs-identifier hs-type">UMState</span></a><span>
</span><a name="line-897"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UnifyResultM"><span class="hs-identifier hs-type">UnifyResultM</span></a><span> </span><span class="hs-special">(</span><a href="Unify.html#UMState"><span class="hs-identifier hs-type">UMState</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627623638"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-898"></a><span>
</span><a name="line-899"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Functor"><span class="hs-identifier hs-type">Functor</span></a><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-900"></a><span>      </span><a name="local-805306541"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier">fmap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a><span>
</span><a name="line-901"></a><span>
</span><a name="line-902"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Applicative"><span class="hs-identifier hs-type">Applicative</span></a><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-903"></a><span>      </span><a name="local-805307120"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier">pure</span></a></a><span> </span><a name="local-1627624063"><a href="#local-1627624063"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-1627624064"><a href="#local-1627624064"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627624064"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627624063"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-904"></a><span>      </span><span class="hs-special">(</span><a name="local-805307119"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%2A%3E"><span class="hs-operator">&lt;*&gt;</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#ap"><span class="hs-identifier hs-var">ap</span></a><span>
</span><a name="line-905"></a><span>
</span><a name="line-906"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-907"></a><span>  </span><a name="local-805306538"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fail"><span class="hs-identifier">fail</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- failed pattern match</span><span>
</span><a name="line-908"></a><span>  </span><a name="local-1627624057"><a href="#local-1627624057"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-805306539"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator">&gt;&gt;=</span></a></a><span> </span><a name="local-1627624058"><a href="#local-1627624058"><span class="hs-identifier">k</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627624059"><a href="#local-1627624059"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627624060"><a href="#local-1627624060"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-909"></a><span>                  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-1627624061"><a href="#local-1627624061"><span class="hs-identifier">state'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627624062"><a href="#local-1627624062"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unUM</span><span> </span><a href="#local-1627624057"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1627624059"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627624060"><span class="hs-identifier hs-var">state</span></a><span>
</span><a name="line-910"></a><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">unUM</span><span> </span><span class="hs-special">(</span><a href="#local-1627624058"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1627624062"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627624059"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627624061"><span class="hs-identifier hs-var">state'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-911"></a><span>
</span><a name="line-912"></a><span class="hs-comment">-- need this instance because of a use of 'guard' above</span><span>
</span><a name="line-913"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Alternative"><span class="hs-identifier hs-type">Alternative</span></a><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-914"></a><span>  </span><a name="local-1912608663"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#empty"><span class="hs-identifier">empty</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#empty"><span class="hs-identifier hs-var">Control</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Applicative</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">)</span><span>
</span><a name="line-915"></a><span>  </span><a name="local-1627624053"><a href="#local-1627624053"><span class="hs-identifier">m1</span></a></a><span> </span><a name="local-1912608662"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%7C%3E"><span class="hs-operator">&lt;|&gt;</span></a></a><span> </span><a name="local-1627624054"><a href="#local-1627624054"><span class="hs-identifier">m2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627624055"><a href="#local-1627624055"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627624056"><a href="#local-1627624056"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-916"></a><span>                  </span><span class="hs-identifier">unUM</span><span> </span><a href="#local-1627624053"><span class="hs-identifier hs-var">m1</span></a><span> </span><a href="#local-1627624055"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627624056"><span class="hs-identifier hs-var">state</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a><span>
</span><a name="line-917"></a><span>                  </span><span class="hs-identifier">unUM</span><span> </span><a href="#local-1627624054"><span class="hs-identifier hs-var">m2</span></a><span> </span><a href="#local-1627624055"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627624056"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">)</span><span>
</span><a name="line-918"></a><span>
</span><a name="line-919"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#MonadPlus"><span class="hs-identifier hs-type">MonadPlus</span></a><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span>
</span><a name="line-920"></a><span>
</span><a name="line-921"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710</span><span>
</span><a name="line-922"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.Fail.html#MonadFail"><span class="hs-identifier hs-type">MonadFail</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">MonadFail</span></a><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-923"></a><span>    </span><a name="local-805306544"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.Fail.html#fail"><span class="hs-identifier">fail</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627624051"><a href="#local-1627624051"><span class="hs-identifier">_tvs</span></a></a><span> </span><a name="local-1627624052"><a href="#local-1627624052"><span class="hs-identifier">_subst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- failed pattern match</span><span>
</span><a name="line-924"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-925"></a><span>
</span><a name="line-926"></a><span class="hs-identifier">initUM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#BindFlag"><span class="hs-identifier hs-type">BindFlag</span></a><span class="hs-special">)</span><span>
</span><a name="line-927"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>        </span><span class="hs-comment">-- True &lt;=&gt; unify; False &lt;=&gt; match</span><span>
</span><a name="line-928"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>        </span><span class="hs-comment">-- True &lt;=&gt; doing an injectivity check</span><span>
</span><a name="line-929"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span>
</span><a name="line-930"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span>  </span><span class="hs-comment">-- subst to extend</span><span>
</span><a name="line-931"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a><span>
</span><a name="line-932"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="#local-1627623643"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UnifyResultM"><span class="hs-identifier hs-type">UnifyResultM</span></a><span> </span><a href="#local-1627623643"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-933"></a><a name="initUM"><a href="Unify.html#initUM"><span class="hs-identifier">initUM</span></a></a><span> </span><a name="local-1627623836"><a href="#local-1627623836"><span class="hs-identifier">badtvs</span></a></a><span> </span><a name="local-1627623837"><a href="#local-1627623837"><span class="hs-identifier">unif</span></a></a><span> </span><a name="local-1627623838"><a href="#local-1627623838"><span class="hs-identifier">inj_tf</span></a></a><span> </span><a name="local-1627623839"><a href="#local-1627623839"><span class="hs-identifier">rn_env</span></a></a><span> </span><a name="local-1627623840"><a href="#local-1627623840"><span class="hs-identifier">subst_env</span></a></a><span> </span><a name="local-1627623841"><a href="#local-1627623841"><span class="hs-identifier">cv_subst_env</span></a></a><span> </span><a name="local-1627623842"><a href="#local-1627623842"><span class="hs-identifier">um</span></a></a><span>
</span><a name="line-934"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unUM</span><span> </span><a href="#local-1627623842"><span class="hs-identifier hs-var">um</span></a><span> </span><a href="#local-1627623843"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627623844"><span class="hs-identifier hs-var">state</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-935"></a><span>      </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627623845"><a href="#local-1627623845"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><a href="#local-1627623845"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-936"></a><span>      </span><a href="Unify.html#MaybeApart"><span class="hs-identifier hs-var">MaybeApart</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627623846"><a href="#local-1627623846"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#MaybeApart"><span class="hs-identifier hs-var">MaybeApart</span></a><span> </span><a href="#local-1627623846"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-937"></a><span>      </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span>
</span><a name="line-938"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-939"></a><span>    </span><a name="local-1627623843"><a href="#local-1627623843"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UMEnv"><span class="hs-identifier hs-var">UMEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">um_bind_fun</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623836"><span class="hs-identifier hs-var">badtvs</span></a><span>
</span><a name="line-940"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">um_unif</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623837"><span class="hs-identifier hs-var">unif</span></a><span>
</span><a name="line-941"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">um_inj_tf</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623838"><span class="hs-identifier hs-var">inj_tf</span></a><span>
</span><a name="line-942"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">um_rn_env</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623839"><span class="hs-identifier hs-var">rn_env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-943"></a><span>    </span><a name="local-1627623844"><a href="#local-1627623844"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UMState"><span class="hs-identifier hs-var">UMState</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">um_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623840"><span class="hs-identifier hs-var">subst_env</span></a><span>
</span><a name="line-944"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">um_cv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623841"><span class="hs-identifier hs-var">cv_subst_env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-945"></a><span>
</span><a name="line-946"></a><span class="hs-identifier">tvBindFlagL</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="Unify.html#BindFlag"><span class="hs-identifier hs-type">BindFlag</span></a><span>
</span><a name="line-947"></a><a name="tvBindFlagL"><a href="Unify.html#tvBindFlagL"><span class="hs-identifier">tvBindFlagL</span></a></a><span> </span><a name="local-1627623847"><a href="#local-1627623847"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627623848"><a href="#local-1627623848"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627623849"><a href="#local-1627623849"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-948"></a><span>  </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623849"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="VarEnv.html#inRnEnvL"><span class="hs-identifier hs-var">inRnEnvL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">um_rn_env</span><span> </span><a href="#local-1627623848"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623847"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-949"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><a href="Unify.html#Skolem"><span class="hs-identifier hs-var">Skolem</span></a><span>
</span><a name="line-950"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">um_bind_fun</span><span> </span><a href="#local-1627623848"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627623847"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-951"></a><span>
</span><a name="line-952"></a><span class="hs-identifier">tvBindFlagR</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="Unify.html#BindFlag"><span class="hs-identifier hs-type">BindFlag</span></a><span>
</span><a name="line-953"></a><a name="tvBindFlagR"><a href="Unify.html#tvBindFlagR"><span class="hs-identifier">tvBindFlagR</span></a></a><span> </span><a name="local-1627623850"><a href="#local-1627623850"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627623851"><a href="#local-1627623851"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627623852"><a href="#local-1627623852"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-954"></a><span>  </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623852"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="VarEnv.html#inRnEnvR"><span class="hs-identifier hs-var">inRnEnvR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">um_rn_env</span><span> </span><a href="#local-1627623851"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623850"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-955"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><a href="Unify.html#Skolem"><span class="hs-identifier hs-var">Skolem</span></a><span>
</span><a name="line-956"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">um_bind_fun</span><span> </span><a href="#local-1627623851"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627623850"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-957"></a><span>
</span><a name="line-958"></a><span class="hs-identifier">getTvSubstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span>
</span><a name="line-959"></a><a name="getTvSubstEnv"><a href="Unify.html#getTvSubstEnv"><span class="hs-identifier">getTvSubstEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-1627623853"><a href="#local-1627623853"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623853"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">um_tv_env</span><span> </span><a href="#local-1627623853"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">)</span><span>
</span><a name="line-960"></a><span>
</span><a name="line-961"></a><span class="hs-identifier">getCvSubstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="TyCoRep.html#CvSubstEnv"><span class="hs-identifier hs-type">CvSubstEnv</span></a><span>
</span><a name="line-962"></a><a name="getCvSubstEnv"><a href="Unify.html#getCvSubstEnv"><span class="hs-identifier">getCvSubstEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-1627623854"><a href="#local-1627623854"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623854"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">um_cv_env</span><span> </span><a href="#local-1627623854"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">)</span><span>
</span><a name="line-963"></a><span>
</span><a name="line-964"></a><span class="hs-identifier">extendTvEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-965"></a><a name="extendTvEnv"><a href="Unify.html#extendTvEnv"><span class="hs-identifier">extendTvEnv</span></a></a><span> </span><a name="local-1627623855"><a href="#local-1627623855"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-1627623856"><a href="#local-1627623856"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-1627623857"><a href="#local-1627623857"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-966"></a><span>  </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623857"><span class="hs-identifier hs-var">state</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">um_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">um_tv_env</span><span> </span><a href="#local-1627623857"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623855"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-1627623856"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-967"></a><span>
</span><a name="line-968"></a><span class="hs-identifier">extendCvEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-969"></a><a name="extendCvEnv"><a href="Unify.html#extendCvEnv"><span class="hs-identifier">extendCvEnv</span></a></a><span> </span><a name="local-1627623858"><a href="#local-1627623858"><span class="hs-identifier">cv</span></a></a><span> </span><a name="local-1627623859"><a href="#local-1627623859"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-1627623860"><a href="#local-1627623860"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-970"></a><span>  </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623860"><span class="hs-identifier hs-var">state</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">um_cv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">um_cv_env</span><span> </span><a href="#local-1627623860"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623858"><span class="hs-identifier hs-var">cv</span></a><span> </span><a href="#local-1627623859"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-971"></a><span>
</span><a name="line-972"></a><span class="hs-identifier">umRnBndr2</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="#local-1627623642"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="#local-1627623642"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-973"></a><a name="umRnBndr2"><a href="Unify.html#umRnBndr2"><span class="hs-identifier">umRnBndr2</span></a></a><span> </span><a name="local-1627623861"><a href="#local-1627623861"><span class="hs-identifier">v1</span></a></a><span> </span><a name="local-1627623862"><a href="#local-1627623862"><span class="hs-identifier">v2</span></a></a><span> </span><a name="local-1627623863"><a href="#local-1627623863"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627623864"><a href="#local-1627623864"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627623865"><a href="#local-1627623865"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-974"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627623866"><a href="#local-1627623866"><span class="hs-identifier">rn_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#rnBndr2"><span class="hs-identifier hs-var">rnBndr2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">um_rn_env</span><span> </span><a href="#local-1627623864"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623861"><span class="hs-identifier hs-var">v1</span></a><span> </span><a href="#local-1627623862"><span class="hs-identifier hs-var">v2</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-975"></a><span>  </span><span class="hs-identifier">unUM</span><span> </span><a href="#local-1627623863"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623864"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">um_rn_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623866"><span class="hs-identifier hs-var">rn_env'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1627623865"><span class="hs-identifier hs-var">state</span></a><span>
</span><a name="line-976"></a><span>
</span><a name="line-977"></a><span class="hs-identifier">checkRnEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-978"></a><a name="checkRnEnv"><a href="Unify.html#checkRnEnv"><span class="hs-identifier">checkRnEnv</span></a></a><span> </span><a name="local-1627623867"><a href="#local-1627623867"><span class="hs-identifier">inRnEnv</span></a></a><span> </span><a name="local-1627623868"><a href="#local-1627623868"><span class="hs-identifier">varset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627623869"><a href="#local-1627623869"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627623870"><a href="#local-1627623870"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-979"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623867"><span class="hs-identifier hs-var">inRnEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">um_rn_env</span><span> </span><a href="#local-1627623869"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="VarSet.html#varSetElems"><span class="hs-identifier hs-var">varSetElems</span></a><span> </span><a href="#local-1627623868"><span class="hs-identifier hs-var">varset</span></a><span class="hs-special">)</span><span>
</span><a name="line-980"></a><span>  </span><span class="hs-keyword">then</span><span> </span><a href="Unify.html#MaybeApart"><span class="hs-identifier hs-var">MaybeApart</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623870"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-981"></a><span>  </span><span class="hs-keyword">else</span><span> </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623870"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-982"></a><span>
</span><a name="line-983"></a><span class="hs-comment">-- | Converts any SurelyApart to a MaybeApart</span><span>
</span><a name="line-984"></a><span class="hs-identifier">don'tBeSoSure</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-985"></a><a name="don%27tBeSoSure"><a href="Unify.html#don%27tBeSoSure"><span class="hs-identifier">don'tBeSoSure</span></a></a><span> </span><a name="local-1627623871"><a href="#local-1627623871"><span class="hs-identifier">um</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627623872"><a href="#local-1627623872"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627623873"><a href="#local-1627623873"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-986"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unUM</span><span> </span><a href="#local-1627623871"><span class="hs-identifier hs-var">um</span></a><span> </span><a href="#local-1627623872"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1627623873"><span class="hs-identifier hs-var">state</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-987"></a><span>    </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#MaybeApart"><span class="hs-identifier hs-var">MaybeApart</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623873"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-988"></a><span>    </span><a name="local-1627623874"><a href="#local-1627623874"><span class="hs-identifier">other</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627623874"><span class="hs-identifier hs-var">other</span></a><span>
</span><a name="line-989"></a><span>
</span><a name="line-990"></a><span class="hs-identifier">checkRnEnvR</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-991"></a><a name="checkRnEnvR"><a href="Unify.html#checkRnEnvR"><span class="hs-identifier">checkRnEnvR</span></a></a><span> </span><a name="local-1627623875"><a href="#local-1627623875"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#checkRnEnv"><span class="hs-identifier hs-var">checkRnEnv</span></a><span> </span><a href="VarEnv.html#inRnEnvR"><span class="hs-identifier hs-var">inRnEnvR</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627623875"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-992"></a><span>
</span><a name="line-993"></a><span class="hs-identifier">checkRnEnvL</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-994"></a><a name="checkRnEnvL"><a href="Unify.html#checkRnEnvL"><span class="hs-identifier">checkRnEnvL</span></a></a><span> </span><a name="local-1627623876"><a href="#local-1627623876"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#checkRnEnv"><span class="hs-identifier hs-var">checkRnEnv</span></a><span> </span><a href="VarEnv.html#inRnEnvL"><span class="hs-identifier hs-var">inRnEnvL</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627623876"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-995"></a><span>
</span><a name="line-996"></a><span class="hs-identifier">checkRnEnvRCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-997"></a><a name="checkRnEnvRCo"><a href="Unify.html#checkRnEnvRCo"><span class="hs-identifier">checkRnEnvRCo</span></a></a><span> </span><a name="local-1627623877"><a href="#local-1627623877"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#checkRnEnv"><span class="hs-identifier hs-var">checkRnEnv</span></a><span> </span><a href="VarEnv.html#inRnEnvR"><span class="hs-identifier hs-var">inRnEnvR</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a><span> </span><a href="#local-1627623877"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-998"></a><span>
</span><a name="line-999"></a><span class="hs-identifier">umRnOccL</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-1000"></a><a name="umRnOccL"><a href="Unify.html#umRnOccL"><span class="hs-identifier">umRnOccL</span></a></a><span> </span><a name="local-1627623878"><a href="#local-1627623878"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627623879"><a href="#local-1627623879"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627623880"><a href="#local-1627623880"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1001"></a><span>  </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623880"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><a href="VarEnv.html#rnOccL"><span class="hs-identifier hs-var">rnOccL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">um_rn_env</span><span> </span><a href="#local-1627623879"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623878"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1002"></a><span>
</span><a name="line-1003"></a><span class="hs-identifier">umRnOccR</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-1004"></a><a name="umRnOccR"><a href="Unify.html#umRnOccR"><span class="hs-identifier">umRnOccR</span></a></a><span> </span><a name="local-1627623881"><a href="#local-1627623881"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627623882"><a href="#local-1627623882"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627623883"><a href="#local-1627623883"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1005"></a><span>  </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623883"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><a href="VarEnv.html#rnOccR"><span class="hs-identifier hs-var">rnOccR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">um_rn_env</span><span> </span><a href="#local-1627623882"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623881"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1006"></a><span>
</span><a name="line-1007"></a><span class="hs-identifier">umSwapRn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="#local-1627623641"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="#local-1627623641"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1008"></a><a name="umSwapRn"><a href="Unify.html#umSwapRn"><span class="hs-identifier">umSwapRn</span></a></a><span> </span><a name="local-1627623884"><a href="#local-1627623884"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627623885"><a href="#local-1627623885"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627623886"><a href="#local-1627623886"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1009"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627623887"><a href="#local-1627623887"><span class="hs-identifier">rn_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#rnSwap"><span class="hs-identifier hs-var">rnSwap</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">um_rn_env</span><span> </span><a href="#local-1627623885"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1010"></a><span>  </span><span class="hs-identifier">unUM</span><span> </span><a href="#local-1627623884"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623885"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">um_rn_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623887"><span class="hs-identifier hs-var">rn_env'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-1627623886"><span class="hs-identifier hs-var">state</span></a><span>
</span><a name="line-1011"></a><span>
</span><a name="line-1012"></a><span class="hs-identifier">amIUnifying</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1013"></a><a name="amIUnifying"><a href="Unify.html#amIUnifying"><span class="hs-identifier">amIUnifying</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627623888"><a href="#local-1627623888"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627623889"><a href="#local-1627623889"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623889"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">um_unif</span><span> </span><a href="#local-1627623888"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1014"></a><span>
</span><a name="line-1015"></a><span class="hs-identifier">checkingInjectivity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1016"></a><a name="checkingInjectivity"><a href="Unify.html#checkingInjectivity"><span class="hs-identifier">checkingInjectivity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1627623890"><a href="#local-1627623890"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1627623891"><a href="#local-1627623891"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#Unifiable"><span class="hs-identifier hs-var">Unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623891"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">um_inj_tf</span><span> </span><a href="#local-1627623890"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1017"></a><span>
</span><a name="line-1018"></a><span class="hs-identifier">maybeApart</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1019"></a><a name="maybeApart"><a href="Unify.html#maybeApart"><span class="hs-identifier">maybeApart</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-1627623892"><a href="#local-1627623892"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#MaybeApart"><span class="hs-identifier hs-var">MaybeApart</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623892"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1020"></a><span>
</span><a name="line-1021"></a><span class="hs-identifier">surelyApart</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-type">UM</span></a><span> </span><a href="#local-1627623640"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1022"></a><a name="surelyApart"><a href="Unify.html#surelyApart"><span class="hs-identifier">surelyApart</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#UM"><span class="hs-identifier hs-var">UM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a><span class="hs-special">)</span><span>
</span><a name="line-1023"></a><span>
</span><a name="line-1024"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Matching a (lifted) type against a coercion
%*                                                                      *
%************************************************************************

This section defines essentially an inverse to liftCoSubst. It is defined
here to avoid a dependency from Coercion on this module.

-}</span><span>
</span><a name="line-1035"></a><span>
</span><a name="line-1036"></a><span class="hs-keyword">data</span><span> </span><a name="MatchEnv"><a href="Unify.html#MatchEnv"><span class="hs-identifier">MatchEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ME"><a href="Unify.html#ME"><span class="hs-identifier">ME</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="Unify.html#me_tmpls"><span class="hs-identifier">me_tmpls</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span>
</span><a name="line-1037"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="Unify.html#me_env"><span class="hs-identifier">me_env</span></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1038"></a><span>
</span><a name="line-1039"></a><span class="hs-comment">-- | 'liftCoMatch' is sort of inverse to 'liftCoSubst'.  In particular, if</span><span>
</span><a name="line-1040"></a><span class="hs-comment">--   @liftCoMatch vars ty co == Just s@, then @tyCoSubst s ty == co@,</span><span>
</span><a name="line-1041"></a><span class="hs-comment">--   where @==@ there means that the result of tyCoSubst has the same</span><span>
</span><a name="line-1042"></a><span class="hs-comment">--   type as the original co; but may be different under the hood.</span><span>
</span><a name="line-1043"></a><span class="hs-comment">--   That is, it matches a type against a coercion of the same</span><span>
</span><a name="line-1044"></a><span class="hs-comment">--   &quot;shape&quot;, and returns a lifting substitution which could have been</span><span>
</span><a name="line-1045"></a><span class="hs-comment">--   used to produce the given coercion from the given type.</span><span>
</span><a name="line-1046"></a><span class="hs-comment">--   Note that this function is incomplete -- it might return Nothing</span><span>
</span><a name="line-1047"></a><span class="hs-comment">--   when there does indeed exist a possible lifting context.</span><span>
</span><a name="line-1048"></a><span class="hs-comment">--</span><span>
</span><a name="line-1049"></a><span class="hs-comment">-- This function is incomplete in that it doesn't respect the equality</span><span>
</span><a name="line-1050"></a><span class="hs-comment">-- in `eqType`. That is, it's possible that this will succeed for t1 and</span><span>
</span><a name="line-1051"></a><span class="hs-comment">-- fail for t2, even when t1 `eqType` t2. That's because it depends on</span><span>
</span><a name="line-1052"></a><span class="hs-comment">-- there being a very similar structure between the type and the coercion.</span><span>
</span><a name="line-1053"></a><span class="hs-comment">-- This incompleteness shouldn't be all that surprising, especially because</span><span>
</span><a name="line-1054"></a><span class="hs-comment">-- it depends on the structure of the coercion, which is a silly thing to do.</span><span>
</span><a name="line-1055"></a><span class="hs-comment">--</span><span>
</span><a name="line-1056"></a><span class="hs-comment">-- The lifting context produced doesn't have to be exacting in the roles</span><span>
</span><a name="line-1057"></a><span class="hs-comment">-- of the mappings. This is because any use of the lifting context will</span><span>
</span><a name="line-1058"></a><span class="hs-comment">-- also require a desired role. Thus, this algorithm prefers mapping to</span><span>
</span><a name="line-1059"></a><span class="hs-comment">-- nominal coercions where it can do so.</span><span>
</span><a name="line-1060"></a><span class="hs-identifier">liftCoMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a><span>
</span><a name="line-1061"></a><a name="liftCoMatch"><a href="Unify.html#liftCoMatch"><span class="hs-identifier">liftCoMatch</span></a></a><span> </span><a name="local-1627623893"><a href="#local-1627623893"><span class="hs-identifier">tmpls</span></a></a><span> </span><a name="local-1627623894"><a href="#local-1627623894"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1627623895"><a href="#local-1627623895"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-1062"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627623903"><a href="#local-1627623903"><span class="hs-identifier">cenv1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627623896"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="VarEnv.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a><span> </span><a href="#local-1627623898"><span class="hs-identifier hs-var">ki</span></a><span> </span><a href="#local-1627623899"><span class="hs-identifier hs-var">ki_co</span></a><span> </span><a href="#local-1627623900"><span class="hs-identifier hs-var">ki_ki_co</span></a><span> </span><a href="#local-1627623900"><span class="hs-identifier hs-var">ki_ki_co</span></a><span>
</span><a name="line-1063"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1627623904"><a href="#local-1627623904"><span class="hs-identifier">cenv2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627623896"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627623903"><span class="hs-identifier hs-var">cenv1</span></a><span>       </span><a href="#local-1627623894"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1627623895"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1064"></a><span>                              </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="#local-1627623901"><span class="hs-identifier hs-var">co_lkind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="#local-1627623902"><span class="hs-identifier hs-var">co_rkind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1065"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span> </span><a href="#local-1627623897"><span class="hs-identifier hs-var">in_scope</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623904"><span class="hs-identifier hs-var">cenv2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1066"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1067"></a><span>    </span><a name="local-1627623896"><a href="#local-1627623896"><span class="hs-identifier">menv</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#ME"><span class="hs-identifier hs-var">ME</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">me_tmpls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623893"><span class="hs-identifier hs-var">tmpls</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">me_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkRnEnv2"><span class="hs-identifier hs-var">mkRnEnv2</span></a><span> </span><a href="#local-1627623897"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1068"></a><span>    </span><a name="local-1627623897"><a href="#local-1627623897"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623893"><span class="hs-identifier hs-var">tmpls</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a><span> </span><a href="#local-1627623895"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1069"></a><span>    </span><span class="hs-comment">-- Like tcMatchTy, assume all the interesting variables</span><span>
</span><a name="line-1070"></a><span>    </span><span class="hs-comment">-- in ty are in tmpls</span><span>
</span><a name="line-1071"></a><span>
</span><a name="line-1072"></a><span>    </span><a name="local-1627623898"><a href="#local-1627623898"><span class="hs-identifier">ki</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1627623894"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1073"></a><span>    </span><a name="local-1627623899"><a href="#local-1627623899"><span class="hs-identifier">ki_co</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-1627623895"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1074"></a><span>    </span><a name="local-1627623900"><a href="#local-1627623900"><span class="hs-identifier">ki_ki_co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-1075"></a><span>
</span><a name="line-1076"></a><span>    </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-1627623901"><a href="#local-1627623901"><span class="hs-identifier">co_lkind</span></a></a><span> </span><a name="local-1627623902"><a href="#local-1627623902"><span class="hs-identifier">co_rkind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-1627623899"><span class="hs-identifier hs-var">ki_co</span></a><span>
</span><a name="line-1077"></a><span>
</span><a name="line-1078"></a><span class="hs-comment">-- | 'ty_co_match' does all the actual work for 'liftCoMatch'.</span><span>
</span><a name="line-1079"></a><span class="hs-identifier">ty_co_match</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#MatchEnv"><span class="hs-identifier hs-type">MatchEnv</span></a><span>   </span><span class="hs-comment">-- ^ ambient helpful info</span><span>
</span><a name="line-1080"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span>  </span><span class="hs-comment">-- ^ incoming subst</span><span>
</span><a name="line-1081"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>       </span><span class="hs-comment">-- ^ ty, type to match</span><span>
</span><a name="line-1082"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>   </span><span class="hs-comment">-- ^ co, coercion to match against</span><span>
</span><a name="line-1083"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>   </span><span class="hs-comment">-- ^ :: kind of L type of substed ty ~N L kind of co</span><span>
</span><a name="line-1084"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>   </span><span class="hs-comment">-- ^ :: kind of R type of substed ty ~N R kind of co</span><span>
</span><a name="line-1085"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span>
</span><a name="line-1086"></a><a name="ty_co_match"><a href="Unify.html#ty_co_match"><span class="hs-identifier">ty_co_match</span></a></a><span> </span><a name="local-1627623905"><a href="#local-1627623905"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627623906"><a href="#local-1627623906"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627623907"><a href="#local-1627623907"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1627623908"><a href="#local-1627623908"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-1627623909"><a href="#local-1627623909"><span class="hs-identifier">lkco</span></a></a><span> </span><a name="local-1627623910"><a href="#local-1627623910"><span class="hs-identifier">rkco</span></a></a><span>
</span><a name="line-1087"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627623920"><a href="#local-1627623920"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreViewOneStarKind"><span class="hs-identifier hs-var">coreViewOneStarKind</span></a><span> </span><a href="#local-1627623907"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627623905"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627623906"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623920"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-1627623908"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-1627623909"><span class="hs-identifier hs-var">lkco</span></a><span> </span><a href="#local-1627623910"><span class="hs-identifier hs-var">rkco</span></a><span>
</span><a name="line-1088"></a><span>
</span><a name="line-1089"></a><span>  </span><span class="hs-comment">-- handle Refl case:</span><span>
</span><a name="line-1090"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-1627623907"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="#local-1627623911"><span class="hs-identifier hs-var">isNotInDomainOf</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627623906"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-1091"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623921"><a href="#local-1627623921"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a><span> </span><a href="#local-1627623908"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1092"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-1627623907"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627623921"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1093"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627623906"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-1094"></a><span>
</span><a name="line-1095"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1096"></a><span>    </span><span class="hs-identifier">isNotInDomainOf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="#local-1627623913"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1097"></a><span>    </span><a name="local-1627623911"><a href="#local-1627623911"><span class="hs-identifier">isNotInDomainOf</span></a></a><span> </span><a name="local-1627623914"><a href="#local-1627623914"><span class="hs-identifier">set</span></a></a><span> </span><a name="local-1627623915"><a href="#local-1627623915"><span class="hs-identifier">env</span></a></a><span>
</span><a name="line-1098"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623912"><span class="hs-identifier hs-var">noneSet</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627623916"><a href="#local-1627623916"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#elemVarEnv"><span class="hs-identifier hs-var">elemVarEnv</span></a><span> </span><a href="#local-1627623916"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-1627623915"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623914"><span class="hs-identifier hs-var">set</span></a><span>
</span><a name="line-1099"></a><span>
</span><a name="line-1100"></a><span>    </span><span class="hs-identifier">noneSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1101"></a><span>    </span><a name="local-1627623912"><a href="#local-1627623912"><span class="hs-identifier">noneSet</span></a></a><span> </span><a name="local-1627623917"><a href="#local-1627623917"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#foldVarSet"><span class="hs-identifier hs-var">foldVarSet</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627623918"><a href="#local-1627623918"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-1627623919"><a href="#local-1627623919"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627623919"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1627623917"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627623918"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1102"></a><span>
</span><a name="line-1103"></a><span class="hs-identifier">ty_co_match</span><span> </span><a name="local-1627623922"><a href="#local-1627623922"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627623923"><a href="#local-1627623923"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627623924"><a href="#local-1627623924"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1627623925"><a href="#local-1627623925"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-1627623926"><a href="#local-1627623926"><span class="hs-identifier">lkco</span></a></a><span> </span><a name="local-1627623927"><a href="#local-1627623927"><span class="hs-identifier">rkco</span></a></a><span>
</span><a name="line-1104"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-1627623928"><a href="#local-1627623928"><span class="hs-identifier">ty'</span></a></a><span> </span><a name="local-1627623929"><a href="#local-1627623929"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627623924"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1105"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627623922"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627623923"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623928"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-1627623925"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623929"><span class="hs-identifier hs-var">co'</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627623926"><span class="hs-identifier hs-var">lkco</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627623929"><span class="hs-identifier hs-var">co'</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627623927"><span class="hs-identifier hs-var">rkco</span></a><span class="hs-special">)</span><span>
</span><a name="line-1106"></a><span>
</span><a name="line-1107"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a name="local-1627623930"><a href="#local-1627623930"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-1627623931"><a href="#local-1627623931"><span class="hs-identifier">co2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627623925"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1108"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627623922"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627623923"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623924"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1627623930"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627623926"><span class="hs-identifier hs-var">lkco</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-1627623931"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623927"><span class="hs-identifier hs-var">rkco</span></a><span>
</span><a name="line-1109"></a><span>
</span><a name="line-1110"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-1627623932"><a href="#local-1627623932"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627623925"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1111"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#swapLiftCoEnv"><span class="hs-identifier hs-var">swapLiftCoEnv</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627623922"><span class="hs-identifier hs-var">menv</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#swapLiftCoEnv"><span class="hs-identifier hs-var">swapLiftCoEnv</span></a><span> </span><a href="#local-1627623923"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623924"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1627623932"><span class="hs-identifier hs-var">co'</span></a><span> </span><a href="#local-1627623927"><span class="hs-identifier hs-var">rkco</span></a><span> </span><a href="#local-1627623926"><span class="hs-identifier hs-var">lkco</span></a><span>
</span><a name="line-1112"></a><span>
</span><a name="line-1113"></a><span>  </span><span class="hs-comment">-- Match a type variable against a non-refl coercion</span><span>
</span><a name="line-1114"></a><span class="hs-identifier">ty_co_match</span><span> </span><a name="local-1627623933"><a href="#local-1627623933"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627623934"><a href="#local-1627623934"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-1627623935"><a href="#local-1627623935"><span class="hs-identifier">tv1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623936"><a href="#local-1627623936"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-1627623937"><a href="#local-1627623937"><span class="hs-identifier">lkco</span></a></a><span> </span><a name="local-1627623938"><a href="#local-1627623938"><span class="hs-identifier">rkco</span></a></a><span>
</span><a name="line-1115"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627623941"><a href="#local-1627623941"><span class="hs-identifier">co1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1627623934"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623940"><span class="hs-identifier hs-var">tv1'</span></a><span> </span><span class="hs-comment">-- tv1' is already bound to co1</span><span>
</span><a name="line-1116"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Coercion.html#eqCoercionX"><span class="hs-identifier hs-var">eqCoercionX</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#nukeRnEnvL"><span class="hs-identifier hs-var">nukeRnEnvL</span></a><span> </span><a href="#local-1627623939"><span class="hs-identifier hs-var">rn_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623941"><span class="hs-identifier hs-var">co1'</span></a><span> </span><a href="#local-1627623936"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1117"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627623934"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-1118"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>       </span><span class="hs-comment">-- no match since tv1 matches two different coercions</span><span>
</span><a name="line-1119"></a><span>
</span><a name="line-1120"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627623940"><span class="hs-identifier hs-var">tv1'</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">me_tmpls</span><span> </span><a href="#local-1627623933"><span class="hs-identifier hs-var">menv</span></a><span>           </span><span class="hs-comment">-- tv1' is a template var</span><span>
</span><a name="line-1121"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#inRnEnvR"><span class="hs-identifier hs-var">inRnEnvR</span></a><span> </span><a href="#local-1627623939"><span class="hs-identifier hs-var">rn_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfCoList"><span class="hs-identifier hs-var">tyCoVarsOfCoList</span></a><span> </span><a href="#local-1627623936"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1122"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>      </span><span class="hs-comment">-- occurs check failed</span><span>
</span><a name="line-1123"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-1627623934"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623940"><span class="hs-identifier hs-var">tv1'</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1124"></a><span>                </span><a href="Coercion.html#castCoercionKind"><span class="hs-identifier hs-var">castCoercionKind</span></a><span> </span><a href="#local-1627623936"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-1627623937"><span class="hs-identifier hs-var">lkco</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-1627623938"><span class="hs-identifier hs-var">rkco</span></a><span class="hs-special">)</span><span>
</span><a name="line-1125"></a><span>
</span><a name="line-1126"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1127"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1128"></a><span>
</span><a name="line-1129"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1130"></a><span>    </span><a name="local-1627623939"><a href="#local-1627623939"><span class="hs-identifier">rn_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">me_env</span><span> </span><a href="#local-1627623933"><span class="hs-identifier hs-var">menv</span></a><span>
</span><a name="line-1131"></a><span>    </span><a name="local-1627623940"><a href="#local-1627623940"><span class="hs-identifier">tv1'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#rnOccL"><span class="hs-identifier hs-var">rnOccL</span></a><span> </span><a href="#local-1627623939"><span class="hs-identifier hs-var">rn_env</span></a><span> </span><a href="#local-1627623935"><span class="hs-identifier hs-var">tv1</span></a><span>
</span><a name="line-1132"></a><span>
</span><a name="line-1133"></a><span>  </span><span class="hs-comment">-- just look through SubCo's. We don't really care about roles here.</span><span>
</span><a name="line-1134"></a><span class="hs-identifier">ty_co_match</span><span> </span><a name="local-1627623942"><a href="#local-1627623942"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627623943"><a href="#local-1627623943"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627623944"><a href="#local-1627623944"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-1627623945"><a href="#local-1627623945"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623946"><a href="#local-1627623946"><span class="hs-identifier">lkco</span></a></a><span> </span><a name="local-1627623947"><a href="#local-1627623947"><span class="hs-identifier">rkco</span></a></a><span>
</span><a name="line-1135"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627623942"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627623943"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623944"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1627623945"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-1627623946"><span class="hs-identifier hs-var">lkco</span></a><span> </span><a href="#local-1627623947"><span class="hs-identifier hs-var">rkco</span></a><span>
</span><a name="line-1136"></a><span>
</span><a name="line-1137"></a><span class="hs-identifier">ty_co_match</span><span> </span><a name="local-1627623948"><a href="#local-1627623948"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627623949"><a href="#local-1627623949"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-1627623950"><a href="#local-1627623950"><span class="hs-identifier">ty1a</span></a></a><span> </span><a name="local-1627623951"><a href="#local-1627623951"><span class="hs-identifier">ty1b</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623952"><a href="#local-1627623952"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-1627623953"><a href="#local-1627623953"><span class="hs-identifier">_lkco</span></a></a><span> </span><a name="local-1627623954"><a href="#local-1627623954"><span class="hs-identifier">_rkco</span></a></a><span>
</span><a name="line-1138"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623955"><a href="#local-1627623955"><span class="hs-identifier">co2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627623956"><a href="#local-1627623956"><span class="hs-identifier">arg2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var">splitAppCo_maybe</span></a><span> </span><a href="#local-1627623952"><span class="hs-identifier hs-var">co</span></a><span>     </span><span class="hs-comment">-- c.f. Unify.match on AppTy</span><span>
</span><a name="line-1139"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#ty_co_match_app"><span class="hs-identifier hs-var">ty_co_match_app</span></a><span> </span><a href="#local-1627623948"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627623949"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623950"><span class="hs-identifier hs-var">ty1a</span></a><span> </span><a href="#local-1627623951"><span class="hs-identifier hs-var">ty1b</span></a><span> </span><a href="#local-1627623955"><span class="hs-identifier hs-var">co2</span></a><span> </span><a href="#local-1627623956"><span class="hs-identifier hs-var">arg2</span></a><span>
</span><a name="line-1140"></a><span class="hs-identifier">ty_co_match</span><span> </span><a name="local-1627623957"><a href="#local-1627623957"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627623958"><a href="#local-1627623958"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627623959"><a href="#local-1627623959"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-1627623960"><a href="#local-1627623960"><span class="hs-identifier">co2</span></a></a><span> </span><a name="local-1627623961"><a href="#local-1627623961"><span class="hs-identifier">arg2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623962"><a href="#local-1627623962"><span class="hs-identifier">_lkco</span></a></a><span> </span><a name="local-1627623963"><a href="#local-1627623963"><span class="hs-identifier">_rkco</span></a></a><span>
</span><a name="line-1141"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1627623964"><a href="#local-1627623964"><span class="hs-identifier">ty1a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627623965"><a href="#local-1627623965"><span class="hs-identifier">ty1b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#repSplitAppTy_maybe"><span class="hs-identifier hs-var">repSplitAppTy_maybe</span></a><span> </span><a href="#local-1627623959"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1142"></a><span>       </span><span class="hs-comment">-- yes, the one from Type, not TcType; this is for coercion optimization</span><span>
</span><a name="line-1143"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#ty_co_match_app"><span class="hs-identifier hs-var">ty_co_match_app</span></a><span> </span><a href="#local-1627623957"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627623958"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623964"><span class="hs-identifier hs-var">ty1a</span></a><span> </span><a href="#local-1627623965"><span class="hs-identifier hs-var">ty1b</span></a><span> </span><a href="#local-1627623960"><span class="hs-identifier hs-var">co2</span></a><span> </span><a href="#local-1627623961"><span class="hs-identifier hs-var">arg2</span></a><span>
</span><a name="line-1144"></a><span>
</span><a name="line-1145"></a><span class="hs-identifier">ty_co_match</span><span> </span><a name="local-1627623966"><a href="#local-1627623966"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627623967"><a href="#local-1627623967"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-1627623968"><a href="#local-1627623968"><span class="hs-identifier">tc1</span></a></a><span> </span><a name="local-1627623969"><a href="#local-1627623969"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627623970"><a href="#local-1627623970"><span class="hs-identifier">tc2</span></a></a><span> </span><a name="local-1627623971"><a href="#local-1627623971"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623972"><a href="#local-1627623972"><span class="hs-identifier">_lkco</span></a></a><span> </span><a name="local-1627623973"><a href="#local-1627623973"><span class="hs-identifier">_rkco</span></a></a><span>
</span><a name="line-1146"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#ty_co_match_tc"><span class="hs-identifier hs-var">ty_co_match_tc</span></a><span> </span><a href="#local-1627623966"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627623967"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623968"><span class="hs-identifier hs-var">tc1</span></a><span> </span><a href="#local-1627623969"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1627623970"><span class="hs-identifier hs-var">tc2</span></a><span> </span><a href="#local-1627623971"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-1147"></a><span class="hs-identifier">ty_co_match</span><span> </span><a name="local-1627623974"><a href="#local-1627623974"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627623975"><a href="#local-1627623975"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-1627623976"><a href="#local-1627623976"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623977"><a href="#local-1627623977"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627623978"><a href="#local-1627623978"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627623979"><a href="#local-1627623979"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627623980"><a href="#local-1627623980"><span class="hs-identifier">_lkco</span></a></a><span> </span><a name="local-1627623981"><a href="#local-1627623981"><span class="hs-identifier">_rkco</span></a></a><span>
</span><a name="line-1148"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#ty_co_match_tc"><span class="hs-identifier hs-var">ty_co_match_tc</span></a><span> </span><a href="#local-1627623974"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627623975"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627623976"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627623977"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span> </span><a href="#local-1627623978"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1627623979"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-1149"></a><span>
</span><a name="line-1150"></a><span class="hs-identifier">ty_co_match</span><span> </span><a name="local-1627623982"><a href="#local-1627623982"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627623983"><a href="#local-1627623983"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-1627623984"><a href="#local-1627623984"><span class="hs-identifier">tv1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1627623985"><a href="#local-1627623985"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1151"></a><span>                       </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-1627623986"><a href="#local-1627623986"><span class="hs-identifier">tv2</span></a></a><span> </span><a name="local-1627623987"><a href="#local-1627623987"><span class="hs-identifier">kind_co2</span></a></a><span> </span><a name="local-1627623988"><a href="#local-1627623988"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1152"></a><span>                       </span><a name="local-1627623989"><a href="#local-1627623989"><span class="hs-identifier">lkco</span></a></a><span> </span><a name="local-1627623990"><a href="#local-1627623990"><span class="hs-identifier">rkco</span></a></a><span>
</span><a name="line-1153"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627623992"><a href="#local-1627623992"><span class="hs-identifier">subst1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627623982"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627623983"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-1627623984"><span class="hs-identifier hs-var">tv1</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627623987"><span class="hs-identifier hs-var">kind_co2</span></a><span>
</span><a name="line-1154"></a><span>                               </span><a href="#local-1627623991"><span class="hs-identifier hs-var">ki_ki_co</span></a><span> </span><a href="#local-1627623991"><span class="hs-identifier hs-var">ki_ki_co</span></a><span>
</span><a name="line-1155"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627623993"><a href="#local-1627623993"><span class="hs-identifier">rn_env0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">me_env</span><span> </span><a href="#local-1627623982"><span class="hs-identifier hs-var">menv</span></a><span>
</span><a name="line-1156"></a><span>             </span><a name="local-1627623994"><a href="#local-1627623994"><span class="hs-identifier">rn_env1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#rnBndr2"><span class="hs-identifier hs-var">rnBndr2</span></a><span> </span><a href="#local-1627623993"><span class="hs-identifier hs-var">rn_env0</span></a><span> </span><a href="#local-1627623984"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-1627623986"><span class="hs-identifier hs-var">tv2</span></a><span>
</span><a name="line-1157"></a><span>             </span><a name="local-1627623995"><a href="#local-1627623995"><span class="hs-identifier">menv'</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623982"><span class="hs-identifier hs-var">menv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">me_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627623994"><span class="hs-identifier hs-var">rn_env1</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1158"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627623995"><span class="hs-identifier hs-var">menv'</span></a><span> </span><a href="#local-1627623992"><span class="hs-identifier hs-var">subst1</span></a><span> </span><a href="#local-1627623985"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-1627623988"><span class="hs-identifier hs-var">co2</span></a><span> </span><a href="#local-1627623989"><span class="hs-identifier hs-var">lkco</span></a><span> </span><a href="#local-1627623990"><span class="hs-identifier hs-var">rkco</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1159"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1160"></a><span>    </span><a name="local-1627623991"><a href="#local-1627623991"><span class="hs-identifier">ki_ki_co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-1161"></a><span>
</span><a name="line-1162"></a><span class="hs-identifier">ty_co_match</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627623996"><a href="#local-1627623996"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1163"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627623996"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-comment">-- don't inspect coercions</span><span>
</span><a name="line-1164"></a><span>
</span><a name="line-1165"></a><span class="hs-identifier">ty_co_match</span><span> </span><a name="local-1627623997"><a href="#local-1627623997"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627623998"><a href="#local-1627623998"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627623999"><a href="#local-1627623999"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1627624000"><a href="#local-1627624000"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-1627624001"><a href="#local-1627624001"><span class="hs-identifier">lkco</span></a></a><span> </span><a name="local-1627624002"><a href="#local-1627624002"><span class="hs-identifier">rkco</span></a></a><span>
</span><a name="line-1166"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1627624003"><a href="#local-1627624003"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#pushRefl"><span class="hs-identifier hs-var">pushRefl</span></a><span> </span><a href="#local-1627624000"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627623997"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627623998"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627623999"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1627624003"><span class="hs-identifier hs-var">co'</span></a><span> </span><a href="#local-1627624001"><span class="hs-identifier hs-var">lkco</span></a><span> </span><a href="#local-1627624002"><span class="hs-identifier hs-var">rkco</span></a><span>
</span><a name="line-1167"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1168"></a><span>
</span><a name="line-1169"></a><span class="hs-identifier">ty_co_match_tc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#MatchEnv"><span class="hs-identifier hs-type">MatchEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span>
</span><a name="line-1170"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1171"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>
</span><a name="line-1172"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span>
</span><a name="line-1173"></a><a name="ty_co_match_tc"><a href="Unify.html#ty_co_match_tc"><span class="hs-identifier">ty_co_match_tc</span></a></a><span> </span><a name="local-1627624004"><a href="#local-1627624004"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627624005"><a href="#local-1627624005"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627624006"><a href="#local-1627624006"><span class="hs-identifier">tc1</span></a></a><span> </span><a name="local-1627624007"><a href="#local-1627624007"><span class="hs-identifier">tys1</span></a></a><span> </span><a name="local-1627624008"><a href="#local-1627624008"><span class="hs-identifier">tc2</span></a></a><span> </span><a name="local-1627624009"><a href="#local-1627624009"><span class="hs-identifier">cos2</span></a></a><span>
</span><a name="line-1174"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627624006"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627624008"><span class="hs-identifier hs-var">tc2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1175"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="Unify.html#ty_co_match_args"><span class="hs-identifier hs-var">ty_co_match_args</span></a><span> </span><a href="#local-1627624004"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627624005"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627624007"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="#local-1627624009"><span class="hs-identifier hs-var">cos2</span></a><span> </span><a href="#local-1627624010"><span class="hs-identifier hs-var">lkcos</span></a><span> </span><a href="#local-1627624011"><span class="hs-identifier hs-var">rkcos</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1176"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1177"></a><span>    </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-1627624010"><a href="#local-1627624010"><span class="hs-identifier">lkcos</span></a></a><span> </span><a name="local-1627624011"><a href="#local-1627624011"><span class="hs-identifier">rkcos</span></a></a><span>
</span><a name="line-1178"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627624009"><span class="hs-identifier hs-var">cos2</span></a><span>
</span><a name="line-1179"></a><span>
</span><a name="line-1180"></a><span class="hs-identifier">ty_co_match_app</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#MatchEnv"><span class="hs-identifier hs-type">MatchEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span>
</span><a name="line-1181"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1182"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span>
</span><a name="line-1183"></a><a name="ty_co_match_app"><a href="Unify.html#ty_co_match_app"><span class="hs-identifier">ty_co_match_app</span></a></a><span> </span><a name="local-1627624012"><a href="#local-1627624012"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627624013"><a href="#local-1627624013"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-1627624014"><a href="#local-1627624014"><span class="hs-identifier">ty1a</span></a></a><span> </span><a name="local-1627624015"><a href="#local-1627624015"><span class="hs-identifier">ty1b</span></a></a><span> </span><a name="local-1627624016"><a href="#local-1627624016"><span class="hs-identifier">co2a</span></a></a><span> </span><a name="local-1627624017"><a href="#local-1627624017"><span class="hs-identifier">co2b</span></a></a><span>
</span><a name="line-1184"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- TODO (RAE): Remove this exponential behavior.</span><span>
</span><a name="line-1185"></a><span>         </span><a name="local-1627624021"><a href="#local-1627624021"><span class="hs-identifier">subst1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627624012"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627624013"><span class="hs-identifier hs-var">subst</span></a><span>  </span><a href="#local-1627624018"><span class="hs-identifier hs-var">ki1a</span></a><span> </span><a href="#local-1627624019"><span class="hs-identifier hs-var">ki2a</span></a><span> </span><a href="#local-1627624020"><span class="hs-identifier hs-var">ki_ki_co</span></a><span> </span><a href="#local-1627624020"><span class="hs-identifier hs-var">ki_ki_co</span></a><span>
</span><a name="line-1186"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-1627624022"><a href="#local-1627624022"><span class="hs-identifier">lkco</span></a></a><span> </span><a name="local-1627624023"><a href="#local-1627624023"><span class="hs-identifier">rkco</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-1627624019"><span class="hs-identifier hs-var">ki2a</span></a><span>
</span><a name="line-1187"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1627624024"><a href="#local-1627624024"><span class="hs-identifier">subst2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627624012"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627624021"><span class="hs-identifier hs-var">subst1</span></a><span> </span><a href="#local-1627624014"><span class="hs-identifier hs-var">ty1a</span></a><span> </span><a href="#local-1627624016"><span class="hs-identifier hs-var">co2a</span></a><span> </span><a href="#local-1627624022"><span class="hs-identifier hs-var">lkco</span></a><span> </span><a href="#local-1627624023"><span class="hs-identifier hs-var">rkco</span></a><span>
</span><a name="line-1188"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627624012"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627624024"><span class="hs-identifier hs-var">subst2</span></a><span> </span><a href="#local-1627624015"><span class="hs-identifier hs-var">ty1b</span></a><span> </span><a href="#local-1627624017"><span class="hs-identifier hs-var">co2b</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-1627624022"><span class="hs-identifier hs-var">lkco</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-1627624023"><span class="hs-identifier hs-var">rkco</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1189"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1190"></a><span>    </span><a name="local-1627624018"><a href="#local-1627624018"><span class="hs-identifier">ki1a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-1627624014"><span class="hs-identifier hs-var">ty1a</span></a><span>
</span><a name="line-1191"></a><span>    </span><a name="local-1627624019"><a href="#local-1627624019"><span class="hs-identifier">ki2a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a><span> </span><a href="#local-1627624016"><span class="hs-identifier hs-var">co2a</span></a><span>
</span><a name="line-1192"></a><span>    </span><a name="local-1627624020"><a href="#local-1627624020"><span class="hs-identifier">ki_ki_co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-1193"></a><span>
</span><a name="line-1194"></a><span class="hs-identifier">ty_co_match_args</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unify.html#MatchEnv"><span class="hs-identifier hs-type">MatchEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1195"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">]</span><span>
</span><a name="line-1196"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a><span>
</span><a name="line-1197"></a><a name="ty_co_match_args"><a href="Unify.html#ty_co_match_args"><span class="hs-identifier">ty_co_match_args</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><a name="local-1627624025"><a href="#local-1627624025"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627624025"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-1198"></a><span class="hs-identifier">ty_co_match_args</span><span> </span><a name="local-1627624026"><a href="#local-1627624026"><span class="hs-identifier">menv</span></a></a><span> </span><a name="local-1627624027"><a href="#local-1627624027"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627624028"><a href="#local-1627624028"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">:</span><a name="local-1627624029"><a href="#local-1627624029"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627624030"><a href="#local-1627624030"><span class="hs-identifier">arg</span></a></a><span class="hs-glyph">:</span><a name="local-1627624031"><a href="#local-1627624031"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627624032"><a href="#local-1627624032"><span class="hs-identifier">lkco</span></a></a><span class="hs-glyph">:</span><a name="local-1627624033"><a href="#local-1627624033"><span class="hs-identifier">lkcos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627624034"><a href="#local-1627624034"><span class="hs-identifier">rkco</span></a></a><span class="hs-glyph">:</span><a name="local-1627624035"><a href="#local-1627624035"><span class="hs-identifier">rkcos</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1199"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1627624036"><a href="#local-1627624036"><span class="hs-identifier">subst'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Unify.html#ty_co_match"><span class="hs-identifier hs-var">ty_co_match</span></a><span> </span><a href="#local-1627624026"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627624027"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1627624028"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-1627624030"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-1627624032"><span class="hs-identifier hs-var">lkco</span></a><span> </span><a href="#local-1627624034"><span class="hs-identifier hs-var">rkco</span></a><span>
</span><a name="line-1200"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="Unify.html#ty_co_match_args"><span class="hs-identifier hs-var">ty_co_match_args</span></a><span> </span><a href="#local-1627624026"><span class="hs-identifier hs-var">menv</span></a><span> </span><a href="#local-1627624036"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-1627624029"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-1627624031"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-1627624033"><span class="hs-identifier hs-var">lkcos</span></a><span> </span><a href="#local-1627624035"><span class="hs-identifier hs-var">rkcos</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1201"></a><span class="hs-identifier">ty_co_match_args</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">_</span><span>     </span><span class="hs-identifier">_</span><span>        </span><span class="hs-identifier">_</span><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1202"></a><span>
</span><a name="line-1203"></a><span class="hs-identifier">pushRefl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1204"></a><a name="pushRefl"><a href="Unify.html#pushRefl"><span class="hs-identifier">pushRefl</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-1627624037"><a href="#local-1627624037"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-1627624038"><a href="#local-1627624038"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1205"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><a href="#local-1627624037"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="#local-1627624038"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1206"></a><span class="hs-identifier">pushRefl</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-1627624039"><a href="#local-1627624039"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-1627624040"><a href="#local-1627624040"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627624041"><a href="#local-1627624041"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1207"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a href="#local-1627624039"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span> </span><span class="hs-special">[</span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><a href="#local-1627624039"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-1627624040"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><a href="#local-1627624039"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-1627624041"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1208"></a><span class="hs-identifier">pushRefl</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-1627624042"><a href="#local-1627624042"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-1627624043"><a href="#local-1627624043"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1627624044"><a href="#local-1627624044"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1209"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a href="#local-1627624042"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-1627624043"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a><span> </span><a href="#local-1627624042"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-1627624043"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627624044"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1210"></a><span class="hs-identifier">pushRefl</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-1627624045"><a href="#local-1627624045"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-1627624046"><a href="#local-1627624046"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-1627624047"><a href="#local-1627624047"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1211"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkHomoForAllCos_NoRefl"><span class="hs-identifier hs-var">mkHomoForAllCos_NoRefl</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627624046"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-1627624045"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-1627624047"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1212"></a><span>    </span><span class="hs-comment">-- NB: NoRefl variant. Otherwise, we get a loop!</span><span>
</span><a name="line-1213"></a><span class="hs-identifier">pushRefl</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-1627624048"><a href="#local-1627624048"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-1627624049"><a href="#local-1627624049"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-1627624050"><a href="#local-1627624050"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#castCoercionKind"><span class="hs-identifier hs-var">castCoercionKind</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a href="#local-1627624048"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-1627624049"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627624050"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-1627624050"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1214"></a><span class="hs-identifier">pushRefl</span><span> </span><span class="hs-identifier">_</span><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1215"></a></pre></body></html>